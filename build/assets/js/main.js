/*! For license information please see main.js.LICENSE.txt */
(self.webpackChunkdevelopment_opportunities=self.webpackChunkdevelopment_opportunities||[]).push([[179],{41:function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}var o=i(409),s=i(618),l=i.n(s),c=6371008.8,u={centimeters:637100880,centimetres:637100880,degrees:57.22891354143274,feet:20902260.511392,inches:39.37*c,kilometers:6371.0088,kilometres:6371.0088,meters:c,metres:c,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:c/1852,radians:1,yards:6967335.223679999};function h(e,t,i){void 0===i&&(i={});var r={type:"Feature"};return(0===i.id||i.id)&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.properties=t||{},r.geometry=e,r}function p(e,t,i){if(void 0===i&&(i={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!g(e[0])||!g(e[1]))throw new Error("coordinates must contain numbers");return h({type:"Point",coordinates:e},t,i)}function d(e,t){void 0===t&&(t="kilometers");var i=u[t];if(!i)throw new Error(t+" units is invalid");return e*i}function f(e){return 180*(e%(2*Math.PI))/Math.PI}function m(e){return e%360*Math.PI/180}function g(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function _(e,t,i){if(null!==e)for(var r,n,a,o,s,l,c,u,h=0,p=0,d=e.type,f="FeatureCollection"===d,m="Feature"===d,g=f?e.features.length:1,y=0;y<g;y++){s=(u=!!(c=f?e.features[y].geometry:m?e.geometry:e)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var v=0;v<s;v++){var x=0,b=0;if(null!==(o=u?c.geometries[v]:c)){l=o.coordinates;var w=o.type;switch(h=!i||"Polygon"!==w&&"MultiPolygon"!==w?0:1,w){case null:break;case"Point":if(!1===t(l,p,y,x,b))return!1;p++,x++;break;case"LineString":case"MultiPoint":for(r=0;r<l.length;r++){if(!1===t(l[r],p,y,x,b))return!1;p++,"MultiPoint"===w&&x++}"LineString"===w&&x++;break;case"Polygon":case"MultiLineString":for(r=0;r<l.length;r++){for(n=0;n<l[r].length-h;n++){if(!1===t(l[r][n],p,y,x,b))return!1;p++}"MultiLineString"===w&&x++,"Polygon"===w&&b++}"Polygon"===w&&x++;break;case"MultiPolygon":for(r=0;r<l.length;r++){for(b=0,n=0;n<l[r].length;n++){for(a=0;a<l[r][n].length-h;a++){if(!1===t(l[r][n][a],p,y,x,b))return!1;p++}b++}x++}break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===_(o.geometries[r],t,i))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}var y=function(e,t){void 0===t&&(t={});var i=0,r=0,n=0;return _(e,(function(e){i+=e[0],r+=e[1],n++}),!0),p([i/n,r/n],t.properties)},v=JSON.parse('{"version":8,"sprite":"https://cdn.arcgis.com/sharing/rest/content/items/273bf8d5c8ac400183fc24e109d20bcf/resources/styles/../sprites/sprite","glyphs":"https://basemaps.arcgis.com/arcgis/rest/services/World_Basemap_v2/VectorTileServer/resources/fonts/{fontstack}/{range}.pbf","sources":{"esri":{"type":"vector","tiles":["https://basemaps.arcgis.com/arcgis/rest/services/World_Basemap_v2/VectorTileServer/tile/{z}/{y}/{x}.pbf"]},"parcels":{"type":"vector","tiles":["https://tiles.arcgis.com/tiles/qvkbeam7Wirps6zC/arcgis/rest/services/parcels/VectorTileServer/tile/{z}/{y}/{x}.pbf"]},"mapillary":{"type":"geojson","data":{"type":"FeatureCollection","features":[]}},"mly":{"type":"vector","tiles":["https://tiles.mapillary.com/maps/vtp/mly1_computed_public/2/{z}/{x}/{y}?access_token=MLY|4690399437648324|de87555bb6015affa20c3df794ebab15"],"maxzoom":14,"minzoom":14}},"layers":[{"id":"Land/Not ice","type":"fill","source":"esri","source-layer":"Land","filter":["==","_symbol",0],"minzoom":0,"layout":{},"paint":{"fill-color":{"stops":[[0,"#dce0ca"],[10,"#E6E5D6"],[15,"#f2eee9"]]}}},{"id":"Land/Ice","type":"fill","source":"esri","source-layer":"Land","filter":["==","_symbol",1],"minzoom":0,"layout":{},"paint":{"fill-color":"#E6E5D6"}},{"id":"Urban area","type":"fill","source":"esri","source-layer":"Urban area","minzoom":5,"maxzoom":15,"layout":{},"paint":{"fill-color":{"stops":[[5,"#e3dfdc"],[10,"#ECE8E3"],[15,"#f2eee9"]]},"fill-antialias":false}},{"id":"Parcel/fill","type":"fill","source":"esri","source-layer":"Parcel","minzoom":18,"layout":{},"paint":{"fill-color":"#f0ebe5"}},{"id":"Parcel/line","type":"line","source":"esri","source-layer":"Parcel","minzoom":17,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#dddbd8","line-width":{"base":1.2,"stops":[[17,0.6],[22,5]]}}},{"id":"Vegetation small scale/High density","type":"fill","source":"esri","source-layer":"Vegetation small scale","filter":["==","_symbol",0],"maxzoom":11,"layout":{},"paint":{"fill-color":"#c2e699","fill-opacity":{"stops":[[0,0.3],[5,0.28],[7,0.18],[10,0.08]]},"fill-antialias":false}},{"id":"Vegetation small scale/Low density","type":"fill","source":"esri","source-layer":"Vegetation small scale","filter":["==","_symbol",1],"maxzoom":11,"layout":{},"paint":{"fill-color":"#9ad666","fill-opacity":{"stops":[[0,0.3],[5,0.28],[7,0.18],[10,0.08]]},"fill-antialias":false}},{"id":"Indigenous","type":"fill","source":"esri","source-layer":"Indigenous","minzoom":6,"layout":{},"paint":{"fill-color":"#dbd5bd","fill-outline-color":"#d6d4c8","fill-opacity":0.35}},{"id":"Openspace or forest","type":"fill","source":"esri","source-layer":"Openspace or forest","minzoom":9,"layout":{},"paint":{"fill-color":"#CDDFB3","fill-antialias":false}},{"id":"Admin0 forest or park","type":"fill","source":"esri","source-layer":"Admin0 forest or park","minzoom":6,"layout":{},"paint":{"fill-color":"#CDDFB3","fill-opacity":{"stops":[[6,0.4],[8,1]]},"fill-antialias":false}},{"id":"Admin0 forest or park/line2","type":"line","source":"esri","source-layer":"Admin0 forest or park","minzoom":6,"layout":{},"paint":{"line-color":"#c0d3a5","line-opacity":0.3,"line-width":{"base":1.2,"stops":[[6,0.6],[15,15]]}}},{"id":"Admin0 forest or park/line","type":"line","source":"esri","source-layer":"Admin0 forest or park","minzoom":6,"layout":{},"paint":{"line-color":"#c0d3a5","line-opacity":{"stops":[[6,0.4],[8,1]]},"line-width":{"base":1.2,"stops":[[6,0.6],[9,1.1]]}}},{"id":"Admin1 forest or park","type":"fill","source":"esri","source-layer":"Admin1 forest or park","minzoom":7,"layout":{},"paint":{"fill-color":"#CDDFB3","fill-opacity":{"stops":[[6,0.4],[8,1]]},"fill-antialias":false}},{"id":"Admin1 forest or park/line2","type":"line","source":"esri","source-layer":"Admin1 forest or park","minzoom":7,"layout":{},"paint":{"line-color":"#c0d3a5","line-opacity":0.3,"line-width":{"base":1.2,"stops":[[6,0.6],[15,15]]}}},{"id":"Admin1 forest or park/line","type":"line","source":"esri","source-layer":"Admin1 forest or park","minzoom":7,"layout":{},"paint":{"line-color":"#c0d3a5","line-opacity":{"stops":[[6,0.4],[8,1]]},"line-width":{"base":1.2,"stops":[[6,0.6],[9,1.1]]}}},{"id":"Zoo","type":"fill","source":"esri","source-layer":"Zoo","minzoom":11,"layout":{},"paint":{"fill-color":{"stops":[[11,"#CDDFB3"],[17,"#A5C187"]]}}},{"id":"Military","type":"fill","source":"esri","source-layer":"Military","minzoom":6,"layout":{},"paint":{"fill-color":"#d9d9d9","fill-opacity":0.5,"fill-antialias":false}},{"id":"Port","type":"fill","source":"esri","source-layer":"Port","minzoom":12,"layout":{},"paint":{"fill-color":{"stops":[[13,"#d9d2c8"],[15,"#E6E0D9"],[19,"#ECE7E1"]]}}},{"id":"Transportation","type":"fill","source":"esri","source-layer":"Transportation","minzoom":13,"layout":{},"paint":{"fill-color":{"stops":[[13,"#ddd3c5"],[15,"#E8E1D7"],[19,"#EDE7E0"]]}}},{"id":"Industry","type":"fill","source":"esri","source-layer":"Industry","minzoom":12,"layout":{},"paint":{"fill-color":{"stops":[[13,"#d9d2c8"],[15,"#E2DCD4"],[19,"#ECE7E1"]]}}},{"id":"Golf course","type":"fill","source":"esri","source-layer":"Golf course","minzoom":11,"layout":{},"paint":{"fill-color":"#D6E6C3"}},{"id":"Airport/Airport property","type":"fill","source":"esri","source-layer":"Airport","filter":["==","_symbol",1],"minzoom":9,"layout":{},"paint":{"fill-color":{"stops":[[9,"#d9d6d2"],[11,"#e3e1df"],[15,"#EAE7E4"]]},"fill-outline-color":"#DDDBD9"}},{"id":"Airport/Airport runway","type":"fill","source":"esri","source-layer":"Airport","filter":["==","_symbol",0],"minzoom":11,"layout":{},"paint":{"fill-color":{"stops":[[11,"#dddbd9"],[22,"#8D8C8A"]]}}},{"id":"Retail","type":"fill","source":"esri","source-layer":"Retail","minzoom":13,"layout":{},"paint":{"fill-color":{"stops":[[11,"#f7c2b5"],[15,"#F5D8CF"],[19,"#F3E8E2"]]}}},{"id":"Water and wastewater","type":"fill","source":"esri","source-layer":"Water and wastewater","minzoom":13,"layout":{},"paint":{"fill-color":{"stops":[[13,"#ddd3c5"],[15,"#E8E1D7"],[19,"#EDE7E0"]]}}},{"id":"Freight","type":"fill","source":"esri","source-layer":"Freight","minzoom":12,"layout":{},"paint":{"fill-color":{"stops":[[13,"#d9d2c8"],[15,"#E2DCD4"],[19,"#EDE7E0"]]}}},{"id":"Cemetery","type":"fill","source":"esri","source-layer":"Cemetery","minzoom":13,"layout":{},"paint":{"fill-color":"#d3e6b9"}},{"id":"Finance","type":"fill","source":"esri","source-layer":"Finance","minzoom":13,"layout":{},"paint":{"fill-color":{"stops":[[11,"#f7c2b5"],[15,"#F5D8CF"],[19,"#F3E8E2"]]}}},{"id":"Government","type":"fill","source":"esri","source-layer":"Government","minzoom":13,"layout":{},"paint":{"fill-color":{"stops":[[13,"#ddd3c5"],[15,"#E8E1D7"],[19,"#EDE7E0"]]}}},{"id":"Emergency","type":"fill","source":"esri","source-layer":"Emergency","minzoom":13,"layout":{},"paint":{"fill-color":"#E8E7E5"}},{"id":"Landmark","type":"fill","source":"esri","source-layer":"Landmark","minzoom":13,"layout":{},"paint":{"fill-color":{"stops":[[10,"#d7ede6"],[15,"#E5EEE8"],[19,"#EBEEE8"]]}}},{"id":"Pedestrian","type":"fill","source":"esri","source-layer":"Pedestrian","minzoom":13,"layout":{},"paint":{"fill-color":"#E8E7E5","fill-outline-color":"#bcb7ae"}},{"id":"Education","type":"fill","source":"esri","source-layer":"Education","minzoom":11,"layout":{},"paint":{"fill-color":{"stops":[[11,"#dde2a9"],[15,"#E8E8C9"],[19,"#EEEBDB"]]}}},{"id":"Medical","type":"fill","source":"esri","source-layer":"Medical","minzoom":11,"layout":{},"paint":{"fill-color":{"stops":[[11,"#c7dff4"],[15,"#DDE7EF"],[19,"#E7EAEC"]]}}},{"id":"Park or farming","type":"fill","source":"esri","source-layer":"Park or farming","minzoom":11,"layout":{},"paint":{"fill-color":{"stops":[[11,"#CDDFB3"],[17,"#A5C187"]]}}},{"id":"Beach","type":"fill","source":"esri","source-layer":"Beach","minzoom":13,"layout":{},"paint":{"fill-pattern":"Special area of interest/Sand"}},{"id":"Special area of interest/Garden path","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",12],"minzoom":14,"layout":{"visibility":"none"},"paint":{"fill-color":"#f5f5f1","fill-outline-color":"#EBE8E8"}},{"id":"Special area of interest/Green openspace","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",11],"minzoom":14,"layout":{},"paint":{"fill-color":{"stops":[[14,"#c5e0a9"],[17,"#A5C187"]]}}},{"id":"Special area of interest/Grass","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",8],"minzoom":14,"layout":{},"paint":{"fill-color":{"stops":[[14,"#b4d197"],[17,"#84A661"]]}}},{"id":"Special area of interest/Grass/line","type":"line","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",8],"minzoom":14,"layout":{},"paint":{"line-color":{"stops":[[14,"#a4c683"],[17,"#739551"]]},"line-width":{"stops":[[15,1.1],[22,10]]},"line-blur":{"stops":[[15,1],[22,5]]}}},{"id":"Special area of interest/Grass/pattern","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",8],"minzoom":14,"layout":{},"paint":{"fill-pattern":"Special area of interest/Grass","fill-opacity":0.5}},{"id":"Special area of interest/Grass/pattern/1","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",8],"minzoom":14,"layout":{},"paint":{"fill-pattern":"Special area of interest/Small stipple"}},{"id":"Special area of interest/Baseball field or other grounds","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",1],"minzoom":14,"layout":{},"paint":{"fill-color":"#91a761"}},{"id":"Special area of interest/Baseball field or other grounds/pattern","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",1],"minzoom":14,"layout":{},"paint":{"fill-pattern":"Special area of interest/Baseball field or other grounds"}},{"id":"Special area of interest/Groundcover","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",13],"minzoom":14,"layout":{},"paint":{"fill-color":"#97be82"}},{"id":"Special area of interest/Groundcover/pattern","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",13],"minzoom":14,"layout":{},"paint":{"fill-pattern":"Special area of interest/Groundcover","fill-opacity":0.5}},{"id":"Special area of interest/Field or court exterior","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",5],"minzoom":14,"layout":{},"paint":{"fill-color":"#6E866E"}},{"id":"Special area of interest/Football field or court","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",4],"minzoom":14,"layout":{},"paint":{"fill-color":"#7fa57a"}},{"id":"Special area of interest/Football field or court/line","type":"line","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",4],"minzoom":14,"layout":{},"paint":{"line-color":"#e3e0da","line-opacity":0.8,"line-width":{"base":1.2,"stops":[[15,0.5],[20,4]]}}},{"id":"Special area of interest/Hardcourt","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",10],"minzoom":14,"layout":{},"paint":{"fill-color":{"stops":[[15,"#dddbd9"],[22,"#8D8C8A"]]}}},{"id":"Special area of interest/Hardcourt/line","type":"line","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",10],"minzoom":14,"layout":{},"paint":{"line-color":"#e3e0da","line-opacity":0.8,"line-width":{"base":1.2,"stops":[[15,0.5],[20,4]]}}},{"id":"Special area of interest/Mulch or dirt","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",14],"minzoom":14,"layout":{},"paint":{"fill-pattern":"Special area of interest/Mulch or dirt"}},{"id":"Special area of interest/Mulch or dirt/line","type":"line","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",14],"minzoom":14,"layout":{},"paint":{"line-color":"#c9b58b","line-width":{"stops":[[15,1.1],[22,10]]},"line-blur":{"stops":[[15,1],[22,5]]}}},{"id":"Special area of interest/Athletic track","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",0],"minzoom":14,"layout":{},"paint":{"fill-color":{"stops":[[14,"#d49a87"],[17,"#cb7169"]]}}},{"id":"Special area of interest/Athletic track/line","type":"line","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",0],"minzoom":14,"layout":{},"paint":{"line-color":"#e3e0da","line-opacity":0.8,"line-width":{"base":1.2,"stops":[[15,0.5],[20,4]]}}},{"id":"Special area of interest/Sand","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",6],"minzoom":14,"layout":{},"paint":{"fill-pattern":"Special area of interest/Sand"}},{"id":"Special area of interest/Parking/line","type":"line","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",15],"minzoom":15,"layout":{},"paint":{"line-color":{"stops":[[15,"#d1cfcd"],[22,"#7c7b79"]]},"line-opacity":0.8,"line-width":{"stops":[[15,1.1],[22,10]]},"line-blur":{"stops":[[15,1],[22,5]]}}},{"id":"Special area of interest/Parking","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",15],"minzoom":15,"layout":{},"paint":{"fill-color":{"stops":[[15,"#dddbd9"],[22,"#8D8C8A"]]}}},{"id":"Special area of interest/Parking/stipple","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",15],"minzoom":15,"layout":{},"paint":{"fill-pattern":"Special area of interest/Small stipple"}},{"id":"Special area of interest/Rock or gravel","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",16],"minzoom":14,"layout":{},"paint":{"fill-pattern":"Special area of interest/Rock or gravel"}},{"id":"Water line small scale","type":"line","source":"esri","source-layer":"Water line small scale","minzoom":1,"maxzoom":5,"layout":{"line-join":"round"},"paint":{"line-color":{"stops":[[1,"#B7D7D9"],[10.6,"#6BC4F0"]]},"line-width":{"base":1.2,"stops":[[1,0.5],[5,0.5]]}}},{"id":"Water line medium scale","type":"line","source":"esri","source-layer":"Water line medium scale","minzoom":5,"maxzoom":7,"layout":{"line-join":"round"},"paint":{"line-color":{"stops":[[1,"#B7D7D9"],[10.6,"#6BC4F0"]]},"line-width":{"base":1.2,"stops":[[5,0.5],[7,0.7]]}}},{"id":"Water line large scale","type":"line","source":"esri","source-layer":"Water line large scale","minzoom":7,"maxzoom":11,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[1,"#B7D7D9"],[10.6,"#6BC4F0"]]},"line-width":{"base":1.2,"stops":[[7,0.5],[11,0.7]]}}},{"id":"Water line/Waterfall","type":"line","source":"esri","source-layer":"Water line","filter":["==","_symbol",5],"minzoom":11,"layout":{"line-join":"round"},"paint":{"line-color":"#6BC4F0","line-width":0.8,"line-dasharray":[5,5]}},{"id":"Water line/Dam or weir","type":"line","source":"esri","source-layer":"Water line","filter":["==","_symbol",2],"minzoom":11,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#afafaf","line-width":{"base":1.2,"stops":[[11,0.7],[14,0.7],[17,2]]}}},{"id":"Water line/Levee/1","type":"line","source":"esri","source-layer":"Water line","filter":["==","_symbol",3],"minzoom":11,"layout":{"line-join":"round"},"paint":{"line-color":"#c3c3c3","line-width":{"base":1.2,"stops":[[11,0.7],[14,0.7],[20,2.5]]}}},{"id":"Water line/Levee/0","type":"symbol","source":"esri","source-layer":"Water line","filter":["==","_symbol",3],"minzoom":13,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"icon-image":"Water line/Levee/0","symbol-spacing":13.3,"icon-rotation-alignment":"map","icon-allow-overlap":true,"icon-padding":1},"paint":{}},{"id":"Water line/Canal or ditch","type":"line","source":"esri","source-layer":"Water line","filter":["==","_symbol",1],"minzoom":11,"layout":{"line-cap":"round"},"paint":{"line-color":"#6BC4F0","line-width":{"base":1.2,"stops":[[11,0.7],[14,0.7],[17,2]]}}},{"id":"Water line/Stream or river intermittent","type":"line","source":"esri","source-layer":"Water line","filter":["==","_symbol",4],"minzoom":11,"layout":{},"paint":{"line-color":"#6BC4F0","line-dasharray":[7,3],"line-width":{"base":1.2,"stops":[[11,0.7],[14,0.7],[17,2]]}}},{"id":"Water line/Stream or river","type":"line","source":"esri","source-layer":"Water line","filter":["==","_symbol",0],"minzoom":11,"layout":{"line-cap":"round"},"paint":{"line-color":"#6BC4F0","line-width":{"base":1.2,"stops":[[11,0.7],[14,0.7],[17,2]]}}},{"id":"Marine area/1","type":"fill","source":"esri","source-layer":"Marine area","minzoom":0,"layout":{},"paint":{"fill-color":{"stops":[[5,"#53B9EA"],[10.6,"#6BC4F0"]]},"fill-antialias":false}},{"id":"Bathymetry/depth 2 (shallow water)","type":"fill","source":"esri","source-layer":"Bathymetry","filter":["==","_symbol",0],"maxzoom":11,"layout":{},"paint":{"fill-color":{"stops":[[5,"#5BBDEC"],[10.6,"#6BC4F0"]]},"fill-antialias":false}},{"id":"Bathymetry/depth 3","type":"fill","source":"esri","source-layer":"Bathymetry","filter":["==","_symbol",1],"maxzoom":11,"layout":{},"paint":{"fill-color":{"stops":[[5,"#63C0EE"],[10.6,"#6BC4F0"]]},"fill-antialias":false}},{"id":"Bathymetry/depth 4","type":"fill","source":"esri","source-layer":"Bathymetry","filter":["==","_symbol",2],"maxzoom":11,"layout":{},"paint":{"fill-color":{"stops":[[5,"#6BC4F0"],[10.6,"#6BC4F0"]]},"fill-antialias":false}},{"id":"Bathymetry/depth 5","type":"fill","source":"esri","source-layer":"Bathymetry","filter":["==","_symbol",3],"maxzoom":11,"layout":{},"paint":{"fill-color":{"stops":[[5,"#72C8F1"],[10.6,"#6BC4F0"]]},"fill-antialias":false}},{"id":"Bathymetry/depth 6","type":"fill","source":"esri","source-layer":"Bathymetry","filter":["==","_symbol",4],"maxzoom":11,"layout":{},"paint":{"fill-color":{"stops":[[5,"#7ACBF3"],[10.6,"#6BC4F0"]]},"fill-antialias":false}},{"id":"Bathymetry/depth 7 (deep water)","type":"fill","source":"esri","source-layer":"Bathymetry","filter":["==","_symbol",5],"maxzoom":11,"layout":{},"paint":{"fill-color":{"stops":[[5,"#82CFF5"],[10.6,"#6BC4F0"]]},"fill-antialias":false}},{"id":"Water area small scale","type":"fill","source":"esri","source-layer":"Water area small scale","minzoom":1,"maxzoom":5,"layout":{},"paint":{"fill-color":{"stops":[[5,"#53B9EA"],[10.6,"#6BC4F0"]]},"fill-outline-color":"#53B9EA"}},{"id":"Water area medium scale/Lake intermittent","type":"fill","source":"esri","source-layer":"Water area medium scale","filter":["==","_symbol",1],"minzoom":5,"maxzoom":7,"layout":{},"paint":{"fill-pattern":"Water area/Lake or river intermittent"}},{"id":"Water area medium scale/Lake or river","type":"fill","source":"esri","source-layer":"Water area medium scale","filter":["==","_symbol",0],"minzoom":5,"maxzoom":7,"layout":{},"paint":{"fill-color":{"stops":[[5,"#53B9EA"],[10.6,"#6BC4F0"]]},"fill-outline-color":"#53B9EA"}},{"id":"Water area large scale/Lake intermittent","type":"fill","source":"esri","source-layer":"Water area large scale","filter":["==","_symbol",1],"minzoom":7,"maxzoom":11,"layout":{},"paint":{"fill-pattern":"Water area/Lake or river intermittent"}},{"id":"Water area large scale/Lake or river","type":"fill","source":"esri","source-layer":"Water area large scale","filter":["==","_symbol",0],"minzoom":7,"maxzoom":11,"layout":{},"paint":{"fill-color":{"stops":[[5,"#53B9EA"],[10.6,"#6BC4F0"]]},"fill-outline-color":{"stops":[[8,"#53B9EA"],[9,"#6BC4F0"]]}}},{"id":"Water area/Lake, river or bay","type":"fill","source":"esri","source-layer":"Water area","filter":["==","_symbol",7],"minzoom":11,"layout":{},"paint":{"fill-color":"#6BC4F0","fill-outline-color":"#6BC4F0"}},{"id":"Water area/Lake or river intermittent","type":"fill","source":"esri","source-layer":"Water area","filter":["==","_symbol",6],"minzoom":11,"layout":{},"paint":{"fill-pattern":"Water area/Lake or river intermittent"}},{"id":"Water area/Inundated area","type":"fill","source":"esri","source-layer":"Water area","filter":["==","_symbol",4],"minzoom":11,"layout":{},"paint":{"fill-pattern":"Water area/Inundated area"}},{"id":"Water area/Swamp or marsh","type":"fill","source":"esri","source-layer":"Water area","filter":["==","_symbol",3],"minzoom":11,"layout":{},"paint":{"fill-pattern":"Water area/Swamp or marsh","fill-opacity":0.45}},{"id":"Water area/Playa","type":"fill","source":"esri","source-layer":"Water area","filter":["==","_symbol",1],"minzoom":11,"layout":{},"paint":{"fill-pattern":"Water area/Playa"}},{"id":"Water area/Ice mass","type":"fill","source":"esri","source-layer":"Water area","filter":["==","_symbol",2],"minzoom":11,"layout":{},"paint":{"fill-pattern":"Water area/Ice mass","fill-opacity":0.5}},{"id":"Water area/Dam or weir","type":"fill","source":"esri","source-layer":"Water area","filter":["==","_symbol",5],"minzoom":11,"layout":{},"paint":{"fill-color":"#e5e5dd","fill-outline-color":"#d9d9d1"}},{"id":"Special area of interest/Bike, walk or pedestrian/line","type":"line","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",2],"minzoom":15,"layout":{},"paint":{"line-color":"#bcb7ae","line-width":{"stops":[[15,1.1],[22,10]]},"line-blur":{"stops":[[15,1],[22,5]]}}},{"id":"Special area of interest/Bike, walk or pedestrian","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",2],"minzoom":15,"layout":{},"paint":{"fill-color":"#E8E7E5","fill-outline-color":"#dbd9d5"}},{"id":"Special area of interest/Bike, walk or pedestrian/pattern","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",2],"minzoom":15,"layout":{},"paint":{"fill-pattern":"Special area of interest/Small stipple"}},{"id":"Special area of interest/Water","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",7],"minzoom":14,"layout":{},"paint":{"fill-color":"#6BC4F0"}},{"id":"Special area of interest/Water/line","type":"line","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",7],"minzoom":14,"layout":{},"paint":{"line-color":"#5db6e2","line-width":{"stops":[[15,1.1],[22,7]]},"line-blur":{"stops":[[15,1],[22,3.5]]}}},{"id":"Ferry/Ferry","type":"line","source":"esri","source-layer":"Ferry","filter":["all",["==","_symbol",0],["!in","Viz",2]],"minzoom":11,"layout":{"line-join":"round"},"paint":{"line-color":"#c1e1f0","line-opacity":0.8,"line-width":{"base":1.2,"stops":[[11,1.3],[14,1.5],[17,1.5]]},"line-dasharray":[3,4]}},{"id":"Railroad/2","type":"line","source":"esri","source-layer":"Railroad","minzoom":11,"layout":{"line-join":"round"},"paint":{"line-color":{"stops":[[11,"#dedcd9"],[17,"#B8B1AA"]]},"line-width":{"base":1.2,"stops":[[11,2.5],[14,2.5],[17,4]]}}},{"id":"Railroad/1","type":"line","source":"esri","source-layer":"Railroad","minzoom":11,"layout":{"line-join":"round"},"paint":{"line-dasharray":[6,7.5],"line-color":{"stops":[[11,"#E3E0D7"],[17,"#DBD8CB"]]},"line-width":{"base":1.2,"stops":[[11,0.75],[15,0.75],[17,2]]}}},{"id":"Ferry/Rail ferry/2","type":"line","source":"esri","source-layer":"Ferry","filter":["all",["==","_symbol",1],["!in","Viz",2]],"minzoom":11,"layout":{"line-join":"round"},"paint":{"line-color":{"stops":[[11,"#dedcd9"],[17,"#B8B1AA"]]},"line-width":{"base":1.2,"stops":[[11,2.5],[14,2.5],[17,4]]}}},{"id":"Ferry/Rail ferry/1","type":"line","source":"esri","source-layer":"Ferry","filter":["all",["==","_symbol",1],["!in","Viz",2]],"minzoom":11,"layout":{"line-join":"round"},"paint":{"line-dasharray":[6,7.5],"line-color":{"stops":[[11,"#E3E0D7"],[17,"#DBD8CB"]]},"line-width":{"base":1.2,"stops":[[11,0.75],[15,0.75],[17,2]]}}},{"id":"Special area of interest line/Sports field","type":"line","source":"esri","source-layer":"Special area of interest line","filter":["==","_symbol",6],"minzoom":15,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#e3e0da","line-opacity":0.8,"line-width":{"base":1.2,"stops":[[15,0.5],[20,4]]}}},{"id":"Road/4WD/1","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",10],["!in","Viz",2]],"minzoom":13,"layout":{"line-join":"round"},"paint":{"line-color":"#e3e1dc","line-dasharray":[2,1],"line-width":{"base":1.2,"stops":[[11,1.5],[14,2.3],[17,8.3],[20,50]]}}},{"id":"Road/Minor, ramp or traffic circle/1","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",6],["!in","Viz",2]],"minzoom":9,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[9,"#E2DFD6"],[10,"#dedbd1"],[12,"#e3e1dc"]]},"line-width":{"base":1.2,"stops":[[9.9,1],[14,4],[16,11.5],[17,19],[20,58]]}}},{"id":"Road/Minor/1","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",5],["!in","Viz",2]],"minzoom":9,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[9,"#E2DFD6"],[10,"#dedbd1"],[12,"#e3e1dc"]]},"line-width":{"base":1.2,"stops":[[9,1],[10,3.3],[14,5.5],[16,11.5],[17,19],[20,58]]}}},{"id":"Road/Major, ramp or traffic circle/1","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",4],["!in","Viz",2]],"minzoom":9,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[9,"#dedbd1"],[12,"#e3e1dc"]]},"line-width":{"base":1.2,"stops":[[9,3.3],[14,7.3],[16,12.3],[17,22],[20,63]]}}},{"id":"Road/Major/1","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",3],["!in","Viz",2]],"minzoom":8,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[8,"#dedbd1"],[12,"#e3e1dc"]]},"line-width":{"base":1,"stops":[[8,3.3],[14,7.3],[16,12.3],[17,22],[20,63]]}}},{"id":"Road/Service/1","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",8],["!in","Viz",2]],"minzoom":13,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#e3e1dc","line-width":{"base":1.2,"stops":[[11,2],[14,2.5],[17,10.3],[20,45]]}}},{"id":"Trail or path/1","type":"line","source":"esri","source-layer":"Trail or path","minzoom":15,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[15,"#dddbd5"],[17,"#e3e1dc"]]},"line-width":{"base":1.2,"stops":[[15,2.5],[16,3],[17,5],[20,20],[22,31]]}}},{"id":"Road/Pedestrian/1","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",9],["!in","Viz",2]],"minzoom":15,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[15,"#dddbd5"],[17,"#e3e1dc"]]},"line-width":{"base":1.2,"stops":[[15,2.5],[16,3],[17,5],[20,20],[22,31]]}}},{"id":"Road/Local/1","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",7],["!in","Viz",2]],"minzoom":12,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#e3e1dc","line-width":{"base":1.4,"stops":[[11,1.1],[14,3],[16,8],[17,16],[20,48]]}}},{"id":"Trail or path/0","type":"line","source":"esri","source-layer":"Trail or path","minzoom":15,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[15,"#f8f8f7"],[18,"#ffffff"]]},"line-dasharray":{"stops":[[15,[3,3]],[17,[2,2]]]},"line-width":{"base":1.2,"stops":[[15,1.3],[17,2.5]]}}},{"id":"Road/Pedestrian/0","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",9],["!in","Viz",2]],"minzoom":15,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[15,"#f8f8f7"],[18,"#ffffff"]]},"line-dasharray":{"stops":[[15,[3,3]],[17,[2,2]]]},"line-width":{"base":1.2,"stops":[[15,1.3],[17,2.5]]}}},{"id":"Road/4WD/0","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",10],["!in","Viz",2]],"minzoom":13,"layout":{"line-join":"round"},"paint":{"line-color":"#FFFFFF","line-width":{"base":1.2,"stops":[[11,0.75],[14,1.3],[17,7.3],[20,48]]}}},{"id":"Road/Service/0","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",8],["!in","Viz",2]],"minzoom":13,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#FFFFFF","line-width":{"base":1.2,"stops":[[11,0.75],[14,1.3],[17,8.3],[20,43]]}}},{"id":"Road/Local/0","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",7],["!in","Viz",2]],"minzoom":12,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[12,"#fcfbf9"],[13,"#ffffff"]]},"line-width":{"base":1.4,"stops":[[11,1.1],[14,2],[16,6],[17,14],[20,45]]}}},{"id":"Road/Minor, ramp or traffic circle/0","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",6],["!in","Viz",2]],"minzoom":9,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[9,"#f0efea"],[13,"#ffffff"]]},"line-width":{"base":1.2,"stops":[[9,0.75],[14,2],[16,9.5],[17,17],[20,55]]}}},{"id":"Road/Minor/0","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",5],["!in","Viz",2]],"minzoom":9,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[9,"#f0efea"],[13,"#ffffff"]]},"line-width":{"base":1.2,"stops":[[9,1.3],[14,4.5],[16,9.5],[17,17],[20,55]]}}},{"id":"Road/Major, ramp or traffic circle/0","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",4],["!in","Viz",2]],"minzoom":9,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[9,"#f0efea"],[13,"#ffffff"]]},"line-width":{"base":1.2,"stops":[[9,1.3],[14,5.3],[16,10.3],[17,20],[20,60]]}}},{"id":"Road/Major/0","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",3],["!in","Viz",2]],"minzoom":8,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[9,"#f0efea"],[13,"#ffffff"]]},"line-width":{"base":1.2,"stops":[[8,1.3],[14,5.3],[16,10.3],[17,20],[20,60]]}}},{"id":"Road/Freeway Motorway, ramp or traffic circle/1","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",2],["!in","Viz",2]],"minzoom":6,"layout":{"line-join":"round","line-cap":"round"},"paint":{"line-color":"#ffffff","line-width":{"base":1.2,"stops":[[9,0.3],[14,8.3],[16,14.3],[17,30],[20,52]]}}},{"id":"Road/Highway/1","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",1],["!in","Viz",2]],"minzoom":6,"layout":{"line-join":"round"},"paint":{"line-color":"#ffffff","line-width":{"base":1.2,"stops":[[6,0.3],[14,8.3],[16,14.3],[17,30],[20,52]]}}},{"id":"Road/Freeway Motorway/1","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",0],["!in","Viz",2]],"minzoom":5,"layout":{"line-join":"round"},"paint":{"line-color":"#ffffff","line-width":{"base":1.2,"stops":[[5,0.3],[14,8.3],[16,14.3],[17,30],[20,52]]}}},{"id":"Road/Freeway Motorway, ramp or traffic circle/0","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",2],["!in","Viz",2]],"minzoom":6,"layout":{"line-join":"round","line-cap":"round"},"paint":{"line-color":{"stops":[[6,"#F6CA91"],[8,"#F6CA91"],[12,"#F6CA91"]]},"line-width":{"base":1.2,"stops":[[9,0.7],[14,6.3],[16,12.3],[17,28],[20,50]]}}},{"id":"Road/Highway/0","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",1],["!in","Viz",2]],"minzoom":6,"layout":{"line-join":"round"},"paint":{"line-color":{"stops":[[6,"#F6CA91"],[8,"#F6CA91"],[12,"#F6CA91"]]},"line-width":{"base":1.2,"stops":[[6,0.7],[14,6.3],[16,12.3],[17,28],[20,50]]}}},{"id":"Road/Freeway Motorway/0","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",0],["!in","Viz",2]],"minzoom":5,"layout":{"line-join":"round"},"paint":{"line-color":"#F6CA91","line-width":{"base":1.2,"stops":[[5,0.7],[14,6.3],[16,12.3],[17,28],[20,50]]}}},{"id":"Special area of interest line/Dock or pier","type":"line","source":"esri","source-layer":"Special area of interest line","filter":["==","_symbol",0],"minzoom":15,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#E8E7E5","line-width":{"base":1.2,"stops":[[15,0.5],[20,4]]}}},{"id":"Special area of interest line/Fence (chain link)/1","type":"line","source":"esri","source-layer":"Special area of interest line","filter":["==","_symbol",1],"minzoom":16,"layout":{"line-join":"round"},"paint":{"line-color":"#686868","line-opacity":0.5,"line-width":{"base":1.2,"stops":[[16,0.7],[20,3]]}}},{"id":"Special area of interest line/Fence (chain link)/0","type":"symbol","source":"esri","source-layer":"Special area of interest line","filter":["==","_symbol",1],"minzoom":16,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"icon-image":"Special area of interest line/Fence (chain link)/0","symbol-spacing":{"stops":[[16,7],[22,20]]},"icon-rotation-alignment":"map","icon-allow-overlap":true,"icon-padding":1,"icon-size":{"stops":[[16,0.25],[22,1]]}},"paint":{}},{"id":"Special area of interest line/Fence (metal)/1","type":"line","source":"esri","source-layer":"Special area of interest line","filter":["==","_symbol",2],"minzoom":16,"layout":{"line-join":"round"},"paint":{"line-color":"#686868","line-opacity":0.5,"line-width":{"base":1.2,"stops":[[16,0.7],[20,3]]}}},{"id":"Special area of interest line/Fence (metal)/0","type":"symbol","source":"esri","source-layer":"Special area of interest line","filter":["==","_symbol",2],"minzoom":16,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"icon-image":"Special area of interest line/Fence (metal)/0","symbol-spacing":{"stops":[[16,7],[22,20]]},"icon-rotation-alignment":"map","icon-allow-overlap":true,"icon-padding":1,"icon-size":{"stops":[[16,0.2],[22,0.9]]}},"paint":{}},{"id":"Special area of interest line/Fence (wood)/1","type":"line","source":"esri","source-layer":"Special area of interest line","filter":["==","_symbol",3],"minzoom":16,"layout":{"line-join":"round"},"paint":{"line-color":"#CDAA66","line-opacity":0.5,"line-width":{"base":1.2,"stops":[[16,0.7],[20,3]]}}},{"id":"Special area of interest line/Fence (wood)/0","type":"symbol","source":"esri","source-layer":"Special area of interest line","filter":["==","_symbol",3],"minzoom":16,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"icon-image":"Special area of interest line/Fence (wood)/0","symbol-spacing":{"stops":[[16,7],[22,20]]},"icon-rotation-alignment":"map","icon-allow-overlap":true,"icon-padding":1,"icon-size":{"stops":[[16,0.2],[22,0.9]]}},"paint":{}},{"id":"Special area of interest line/Gate/2","type":"line","source":"esri","source-layer":"Special area of interest line","filter":["==","_symbol",4],"minzoom":16,"layout":{"line-join":"round"},"paint":{"line-color":"#686868","line-width":{"base":1.2,"stops":[[16,2],[20,7]]}}},{"id":"Special area of interest line/Gate/1","type":"line","source":"esri","source-layer":"Special area of interest line","filter":["==","_symbol",4],"minzoom":16,"layout":{"line-join":"round"},"paint":{"line-color":"#E1E1E1","line-width":{"base":1.2,"stops":[[16,1],[20,5]]}}},{"id":"Special area of interest line/Gate/0","type":"line","source":"esri","source-layer":"Special area of interest line","filter":["==","_symbol",4],"minzoom":16,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#686868","line-dasharray":[5,15],"line-width":0.7}},{"id":"Special area of interest line/Wall/2","type":"line","source":"esri","source-layer":"Special area of interest line","filter":["==","_symbol",7],"minzoom":16,"layout":{"line-join":"round"},"paint":{"line-color":"#BCB7AE","line-width":{"base":1.2,"stops":[[16,4],[20,7]]}}},{"id":"Special area of interest line/Wall/1","type":"line","source":"esri","source-layer":"Special area of interest line","filter":["==","_symbol",7],"minzoom":16,"layout":{"line-join":"round"},"paint":{"line-color":"#e3e3e1","line-width":{"base":1.2,"stops":[[16,2],[20,5]]}}},{"id":"Special area of interest line/Wall/0","type":"line","source":"esri","source-layer":"Special area of interest line","filter":["==","_symbol",7],"minzoom":16,"layout":{"line-join":"round"},"paint":{"line-color":"#BCB7AE","line-width":0.5}},{"id":"Building/1","type":"fill","source":"esri","source-layer":"Building","minzoom":18,"layout":{},"paint":{"fill-color":"#6f6c68","fill-opacity":0.15,"fill-translate":{"stops":[[18,[2,2]],[20,[10,10]]]},"fill-translate-anchor":"viewport"}},{"id":"Building/General","type":"fill","source":"esri","source-layer":"Building","minzoom":15,"layout":{},"paint":{"fill-color":{"stops":[[15,"#ebe7e2"],[20,"#D1C4BA"]]}}},{"id":"Building/pattern","type":"fill","source":"esri","source-layer":"Building","minzoom":16,"layout":{},"paint":{"fill-pattern":"Building","fill-opacity":0.15}},{"id":"Building/line","type":"line","source":"esri","source-layer":"Building","minzoom":15,"layout":{},"paint":{"line-color":{"stops":[[15,"#dbd4cb"],[22,"#ac9c92"]]},"line-width":{"stops":[[15,0.5],[20,1.5]]}}},{"id":"Special area of interest line/Parking lot","type":"line","source":"esri","source-layer":"Special area of interest line","filter":["==","_symbol",5],"minzoom":15,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#E8E7E5","line-width":{"base":1.2,"stops":[[15,0.5],[20,4]]}}},{"id":"Road tunnel/4WD/1","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",10],["!in","Viz",2]],"minzoom":13,"layout":{"line-join":"round"},"paint":{"line-color":"#e3e1dc","line-dasharray":[2,1],"line-opacity":0.5,"line-width":{"base":1.2,"stops":[[11,1.5],[14,2.3],[17,8.3],[20,49]]}}},{"id":"Road tunnel/Minor, ramp or traffic circle/1","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",6],["!in","Viz",2]],"minzoom":9,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[9,"#E2DFD6"],[10,"#dedbd1"],[12,"#e3e1dc"]]},"line-opacity":0.5,"line-width":{"base":1.2,"stops":[[9.9,1],[14,4],[16,11.5],[17,19],[20,57]]}}},{"id":"Road tunnel/Minor/1","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",5],["!in","Viz",2]],"minzoom":9,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[9,"#E2DFD6"],[10,"#dedbd1"],[12,"#e3e1dc"]]},"line-opacity":0.5,"line-width":{"base":1.2,"stops":[[9,1],[10,3.3],[14,5.5],[16,11.5],[17,19],[20,57]]}}},{"id":"Road tunnel/Major, ramp or traffic circle/1","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",4],["!in","Viz",2]],"minzoom":9,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[9,"#dedbd1"],[12,"#e3e1dc"]]},"line-opacity":0.5,"line-width":{"base":1.2,"stops":[[9,3.3],[14,7.3],[16,12.3],[17,22],[20,62]]}}},{"id":"Road tunnel/Major/1","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",3],["!in","Viz",2]],"minzoom":8,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[8,"#dedbd1"],[12,"#e3e1dc"]]},"line-opacity":0.5,"line-width":{"base":1,"stops":[[8,3.3],[14,7.3],[16,12.3],[17,22],[20,62]]}}},{"id":"Road tunnel/Pedestrian/0","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",9],["!in","Viz",2]],"minzoom":15,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#FFFFFF","line-opacity":0.5,"line-width":{"base":1.2,"stops":[[14,1.6],[16,2],[17,8],[20,45]]}}},{"id":"Road tunnel/4WD/0","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",10],["!in","Viz",2]],"minzoom":13,"layout":{"line-join":"round"},"paint":{"line-color":"#FFFFFF","line-opacity":0.5,"line-width":{"base":1.2,"stops":[[11,0.75],[14,1.3],[17,7.3],[20,48]]}}},{"id":"Road tunnel/Service/0","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",8],["!in","Viz",2]],"minzoom":13,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#FFFFFF","line-opacity":0.5,"line-width":{"base":1.2,"stops":[[11,0.75],[14,1.3],[17,8.3],[20,48]]}}},{"id":"Road tunnel/Local/0","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",7],["!in","Viz",2]],"minzoom":12,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[12,"#fcfbf9"],[13,"#ffffff"]]},"line-opacity":0.5,"line-width":{"base":1.4,"stops":[[11,1.1],[14,2],[16,6],[17,14],[20,55]]}}},{"id":"Road tunnel/Minor, ramp or traffic circle/0","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",6],["!in","Viz",2]],"minzoom":9,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[9,"#f0efea"],[13,"#ffffff"]]},"line-opacity":0.5,"line-width":{"base":1.2,"stops":[[9,0.75],[14,2],[16,9.5],[17,17],[20,55]]}}},{"id":"Road tunnel/Minor/0","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",5],["!in","Viz",2]],"minzoom":9,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[9,"#f0efea"],[13,"#ffffff"]]},"line-opacity":0.5,"line-width":{"base":1.2,"stops":[[9,1.3],[14,4.5],[16,9.5],[17,17],[20,55]]}}},{"id":"Road tunnel/Major, ramp or traffic circle/0","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",4],["!in","Viz",2]],"minzoom":9,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[9,"#f0efea"],[13,"#ffffff"]]},"line-opacity":0.5,"line-width":{"base":1.2,"stops":[[9,1.3],[14,5.3],[16,10.3],[17,20],[20,60]]}}},{"id":"Road tunnel/Major/0","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",3],["!in","Viz",2]],"minzoom":8,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[9,"#f0efea"],[13,"#ffffff"]]},"line-opacity":0.5,"line-width":{"base":1.2,"stops":[[8,1.3],[14,5.3],[16,10.3],[17,20],[20,60]]}}},{"id":"Road tunnel/Freeway Motorway, ramp or traffic circle/1","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",2],["!in","Viz",2]],"minzoom":6,"layout":{"line-join":"round","line-cap":"round"},"paint":{"line-color":"#ffffff","line-opacity":0.5,"line-width":{"base":1.2,"stops":[[9,0.3],[14,8.3],[16,14.3],[17,30],[20,52]]}}},{"id":"Road tunnel/Highway/1","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",1],["!in","Viz",2]],"minzoom":6,"layout":{"line-join":"round"},"paint":{"line-color":"#ffffff","line-opacity":0.5,"line-width":{"base":1.2,"stops":[[6,0.3],[14,8.3],[16,14.3],[17,30],[20,52]]}}},{"id":"Road tunnel/Freeway Motorway/1","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",0],["!in","Viz",2]],"minzoom":5,"layout":{"line-join":"round"},"paint":{"line-color":"#ffffff","line-opacity":0.5,"line-width":{"base":1.2,"stops":[[5,0.3],[14,8.3],[16,14.3],[17,30],[20,52]]}}},{"id":"Road tunnel/Freeway Motorway, ramp or traffic circle/0","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",2],["!in","Viz",2]],"minzoom":6,"layout":{"line-join":"round","line-cap":"round"},"paint":{"line-color":{"stops":[[6,"#F6CA91"],[8,"#F6CA91"],[12,"#F6CA91"]]},"line-opacity":0.5,"line-width":{"base":1.2,"stops":[[9,0.7],[14,6.3],[16,12.3],[17,28],[20,50]]}}},{"id":"Road tunnel/Highway/0","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",1],["!in","Viz",2]],"minzoom":6,"layout":{"line-join":"round"},"paint":{"line-color":{"stops":[[6,"#F6CA91"],[8,"#F6CA91"],[12,"#F6CA91"]]},"line-opacity":0.5,"line-width":{"base":1.2,"stops":[[6,0.7],[14,6.3],[16,12.3],[17,28],[20,50]]}}},{"id":"Road tunnel/Freeway Motorway/0","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",0],["!in","Viz",2]],"minzoom":5,"layout":{"line-join":"round"},"paint":{"line-color":"#F6CA91","line-opacity":0.5,"line-width":{"base":1.2,"stops":[[5,0.7],[14,6.3],[16,12.3],[17,28],[20,50]]}}},{"id":"Special area of interest/Gutter","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["in","_symbol",9,3],"minzoom":14,"layout":{},"paint":{"fill-color":"#E8E7E5","fill-outline-color":"#bcb7ae"}},{"id":"Boundary line/Disputed admin2","type":"line","source":"esri","source-layer":"Boundary line","filter":["all",["==","_symbol",8],["!in","Viz",2]],"minzoom":9,"layout":{"line-join":"round"},"paint":{"line-color":{"stops":[[1,"#f5f5f5"],[3,"#fafafa"],[9,"#ffffff"]]},"line-width":{"base":1.2,"stops":[[1,0.65],[14,1.3],[17,2.5]]},"line-dasharray":[5,5]}},{"id":"Boundary line/Disputed admin1/1","type":"line","source":"esri","source-layer":"Boundary line","minzoom":3,"filter":["all",["==","_symbol",7],["!in","Viz",2]],"layout":{"line-join":"round"},"paint":{"line-color":"#c6c4b6","line-opacity":0.95,"line-width":{"base":1,"stops":[[4,0.5],[14,7],[17,7]]}}},{"id":"Boundary line/Disputed admin0/1","type":"line","source":"esri","source-layer":"Boundary line","filter":["all",["==","_symbol",6],["!in","Viz",2],["!in","DisputeID",8,16,90,96,0]],"minzoom":1,"layout":{"line-join":"round"},"paint":{"line-color":"#c6c4b6","line-opacity":0.95,"line-width":{"base":1,"stops":[[1,0.5],[14,9.3],[17,9.3]]}}},{"id":"Boundary line/Disputed admin1/0","type":"line","source":"esri","source-layer":"Boundary line","minzoom":3,"filter":["all",["==","_symbol",7],["!in","Viz",2]],"layout":{"line-join":"round"},"paint":{"line-color":{"stops":[[1,"#f5f5f5"],[3,"#fafafa"],[9,"#ffffff"]]},"line-width":{"base":1.2,"stops":[[1,0.65],[14,1.3],[17,2.5]]},"line-dasharray":[5,5]}},{"id":"Boundary line/Disputed admin0/0","type":"line","source":"esri","source-layer":"Boundary line","filter":["all",["==","_symbol",6],["!in","Viz",2],["!in","DisputeID",8,16,90,96,0]],"minzoom":1,"layout":{"line-join":"round"},"paint":{"line-color":{"stops":[[1,"#f5f5f5"],[3,"#fafafa"],[9,"#ffffff"]]},"line-width":{"base":1.2,"stops":[[1,0.65],[14,1.3],[17,2.5]]},"line-dasharray":[5,5]}},{"id":"Boundary line/Admin2/1","type":"line","source":"esri","source-layer":"Boundary line","filter":["all",["==","_symbol",2],["!in","Viz",2]],"minzoom":10,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#ede7e0","line-opacity":0.6,"line-width":{"base":1.2,"stops":[[8,2.3],[14,5.5],[17,7.5]]}}},{"id":"Boundary line/Admin1/1","type":"line","source":"esri","source-layer":"Boundary line","filter":["all",["==","_symbol",1],["!in","Viz",2]],"minzoom":3,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[3,"#DEE1CC"],[10,"#d1ceb8"]]},"line-opacity":0.5,"line-width":{"base":1,"stops":[[3,0.5],[14,9],[17,10]]}}},{"id":"Boundary line/Admin0/1","type":"line","source":"esri","source-layer":"Boundary line","filter":["all",["==","_symbol",0],["!in","Viz",2]],"minzoom":1,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#d1cfc2","line-width":{"base":1,"stops":[[1,0.5],[14,11.3],[17,12.3]]}}},{"id":"Boundary line/Admin5","type":"line","source":"esri","source-layer":"Boundary line","filter":["all",["==","_symbol",5],["!in","Viz",2]],"minzoom":16,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#9C9C9C","line-width":{"base":1.2,"stops":[[14,1],[17,1]]},"line-dasharray":[6,4]}},{"id":"Boundary line/Admin4","type":"line","source":"esri","source-layer":"Boundary line","filter":["all",["==","_symbol",4],["!in","Viz",2]],"minzoom":16,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#9C9C9C","line-width":{"base":1.2,"stops":[[14,1],[17,1]]},"line-dasharray":[6,4]}},{"id":"Boundary line/Admin3","type":"line","source":"esri","source-layer":"Boundary line","filter":["all",["==","_symbol",3],["!in","Viz",2]],"minzoom":16,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#9C9C9C","line-width":{"base":1.2,"stops":[[14,1],[17,1]]},"line-dasharray":[6,4]}},{"id":"Boundary line/Admin2/0","type":"line","source":"esri","source-layer":"Boundary line","filter":["all",["==","_symbol",2],["!in","Viz",2]],"minzoom":9,"layout":{"line-join":"round"},"paint":{"line-color":"#888577","line-dasharray":[7,5],"line-width":{"base":1.2,"stops":[[8,0.5],[14,1]]}}},{"id":"Boundary line/Admin1/0","type":"line","source":"esri","source-layer":"Boundary line","filter":["all",["==","_symbol",1],["!in","Viz",2]],"minzoom":3,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[3,"#c1bdb5"],[4,"#9b9382"]]},"line-width":{"base":1,"stops":[[4,0.5],[14,1.3],[17,1.3]]}}},{"id":"Boundary line/Admin0/0","type":"line","source":"esri","source-layer":"Boundary line","filter":["all",["==","_symbol",0],["!in","Viz",2]],"minzoom":1,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[1,"#b9b9b9"],[7,"#434242"]]},"line-width":{"base":1.2,"stops":[[1,0.5],[14,1.3],[17,2]]}}},{"id":"Coastline","type":"line","source":"esri","source-layer":"Coastline","maxzoom":9,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[0,"#53B9EA"],[7,"#53B9EA"],[9,"#6BC4F0"]]},"line-width":{"base":1.2,"stops":[[0,0.5],[9,1.3]]}}},{"id":"Tree/Elm","type":"symbol","source":"esri","source-layer":"Tree","filter":["==","_symbol",0],"minzoom":16,"layout":{"symbol-avoid-edges":true,"icon-image":"Tree/Elm","icon-allow-overlap":true,"icon-padding":1,"icon-size":{"stops":[[16,0.07],[17,0.18],[18,0.3],[20,1]]}},"paint":{"icon-opacity":{"stops":[[16,0.4],[17,0.6],[20,0.9]]}}},{"id":"Tree/Eucalyptus","type":"symbol","source":"esri","source-layer":"Tree","filter":["==","_symbol",1],"minzoom":16,"layout":{"symbol-avoid-edges":true,"icon-image":"Tree/Eucalyptus","icon-allow-overlap":true,"icon-padding":1,"icon-size":{"stops":[[16,0.07],[17,0.18],[18,0.3],[20,1]]}},"paint":{"icon-opacity":{"stops":[[16,0.4],[17,0.6],[20,0.9]]}}},{"id":"Tree/Maple","type":"symbol","source":"esri","source-layer":"Tree","filter":["==","_symbol",2],"minzoom":16,"layout":{"symbol-avoid-edges":true,"icon-image":"Tree/Maple","icon-allow-overlap":true,"icon-padding":1,"icon-size":{"stops":[[16,0.07],[17,0.18],[18,0.3],[20,1]]}},"paint":{"icon-opacity":{"stops":[[16,0.4],[17,0.6],[20,0.9]]}}},{"id":"Tree/Oak","type":"symbol","source":"esri","source-layer":"Tree","filter":["==","_symbol",3],"minzoom":16,"layout":{"symbol-avoid-edges":true,"icon-image":"Tree/Oak","icon-allow-overlap":true,"icon-padding":1,"icon-size":{"stops":[[16,0.07],[17,0.18],[18,0.3],[20,1]]}},"paint":{"icon-opacity":{"stops":[[16,0.4],[17,0.6],[20,0.9]]}}},{"id":"Tree/Orange","type":"symbol","source":"esri","source-layer":"Tree","filter":["==","_symbol",4],"minzoom":16,"layout":{"symbol-avoid-edges":true,"icon-image":"Tree/Orange","icon-allow-overlap":true,"icon-padding":1,"icon-size":{"stops":[[16,0.07],[17,0.18],[18,0.3],[20,1]]}},"paint":{"icon-opacity":{"stops":[[16,0.4],[17,0.6],[20,0.9]]}}},{"id":"Tree/Palm","type":"symbol","source":"esri","source-layer":"Tree","filter":["==","_symbol",5],"minzoom":16,"layout":{"symbol-avoid-edges":true,"icon-image":"Tree/Palm","icon-allow-overlap":true,"icon-padding":1,"icon-size":{"stops":[[16,0.07],[17,0.18],[18,0.3],[20,1]]}},"paint":{"icon-opacity":{"stops":[[16,0.4],[17,0.6],[20,0.9]]}}},{"id":"Tree/Pine","type":"symbol","source":"esri","source-layer":"Tree","filter":["==","_symbol",6],"minzoom":16,"layout":{"symbol-avoid-edges":true,"icon-image":"Tree/Pine","icon-allow-overlap":true,"icon-padding":1,"icon-size":{"stops":[[16,0.07],[17,0.18],[18,0.3],[20,1]]}},"paint":{"icon-opacity":{"stops":[[16,0.4],[17,0.6],[20,0.9]]}}},{"id":"Tree/Spruce","type":"symbol","source":"esri","source-layer":"Tree","filter":["==","_symbol",7],"minzoom":16,"layout":{"symbol-avoid-edges":true,"icon-image":"Tree/Spruce","icon-allow-overlap":true,"icon-padding":1,"icon-size":{"stops":[[16,0.07],[17,0.18],[18,0.3],[20,1]]}},"paint":{"icon-opacity":{"stops":[[16,0.4],[17,0.6],[20,0.9]]}}},{"id":"Shrub","type":"symbol","source":"esri","source-layer":"Shrub","minzoom":16,"layout":{"symbol-avoid-edges":true,"icon-image":"Shrub","icon-allow-overlap":true,"icon-padding":1,"icon-size":{"stops":[[16,0.07],[17,0.18],[18,0.3],[20,1]]}},"paint":{"icon-opacity":{"stops":[[16,0.4],[17,0.6],[20,0.9]]}}},{"id":"Pavement marking/Arrow","type":"symbol","source":"esri","source-layer":"Pavement marking","minzoom":17,"filter":["==","_symbol",0],"layout":{"icon-rotation-alignment":"map","icon-image":"Pavement marking/Arrow","icon-size":{"stops":[[17,0.5],[22,1]]},"icon-rotate":{"type":"identity","property":"angle","default":0},"icon-allow-overlap":true},"paint":{"icon-color":"#B2B2B2"}},{"id":"Pavement marking/Handicap","type":"symbol","source":"esri","source-layer":"Pavement marking","minzoom":18,"filter":["==","_symbol",1],"layout":{"icon-rotation-alignment":"map","icon-image":"Pavement marking/Handicap","icon-size":{"stops":[[18,0.5],[20,1],[22,1.25]]},"icon-rotate":{"type":"identity","property":"angle","default":0},"icon-allow-overlap":true},"paint":{"icon-color":"#296AA3","icon-opacity":{"stops":[[18,0.65],[20,1]]}}},{"id":"Pavement marking/Left turn","type":"symbol","source":"esri","source-layer":"Pavement marking","minzoom":17,"filter":["==","_symbol",2],"layout":{"icon-rotation-alignment":"map","icon-image":"Pavement marking/Left turn","icon-size":{"stops":[[17,0.5],[22,1]]},"icon-rotate":{"type":"identity","property":"angle","default":0},"icon-allow-overlap":true},"paint":{"icon-color":"#B2B2B2"}},{"id":"Pavement marking/Right turn","type":"symbol","source":"esri","source-layer":"Pavement marking","minzoom":17,"filter":["==","_symbol",3],"layout":{"icon-rotation-alignment":"map","icon-image":"Pavement marking/Right turn","icon-size":{"stops":[[17,0.5],[22,1]]},"icon-rotate":{"type":"identity","property":"angle","default":0},"icon-allow-overlap":true},"paint":{"icon-color":"#B2B2B2"}},{"id":"Pavement marking/Two-way left turn","type":"symbol","source":"esri","source-layer":"Pavement marking","minzoom":17,"filter":["==","_symbol",4],"layout":{"icon-rotation-alignment":"map","icon-image":"Pavement marking/Two-way left turn","icon-size":{"stops":[[17,0.5],[22,1]]},"icon-rotate":{"type":"identity","property":"angle","default":0},"icon-allow-overlap":true},"paint":{"icon-color":"#B2B2B2"}},{"id":"Pavement marking/U-turn","type":"symbol","source":"esri","source-layer":"Pavement marking","minzoom":17,"filter":["==","_symbol",5],"layout":{"icon-rotation-alignment":"map","icon-image":"Pavement marking/U-turn","icon-size":{"stops":[[17,0.5],[22,1]]},"icon-rotate":{"type":"identity","property":"angle","default":0},"icon-allow-overlap":true},"paint":{"icon-color":"#B2B2B2"}},{"id":"Water point/Sea or ocean","type":"symbol","source":"esri","source-layer":"Water point","filter":["==","_label_class",0],"minzoom":9,"layout":{"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":{"stops":[[9,8.5],[15,15.5]]},"text-letter-spacing":0.3,"text-line-height":1.6,"text-max-width":4,"text-field":"{_name_global}","text-padding":15},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#FFFFFF","text-halo-width":1}},{"id":"Water point/Island","type":"symbol","source":"esri","source-layer":"Water point","filter":["==","_label_class",7],"minzoom":9,"layout":{"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":{"stops":[[9,8.5],[15,10]]},"text-letter-spacing":0.1,"text-max-width":4,"text-field":"{_name_global}","text-padding":15},"paint":{"text-color":"#595959","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":1}},{"id":"Water point/Dam or weir","type":"symbol","source":"esri","source-layer":"Water point","filter":["==","_label_class",5],"minzoom":9,"layout":{"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[9,8.5],[15,10]]},"text-letter-spacing":0.1,"text-max-width":4,"text-field":"{_name_global}","text-padding":15},"paint":{"text-color":"#171310","text-halo-color":"#EBE7E2","text-halo-width":0.7,"text-halo-blur":1}},{"id":"Water point/Playa","type":"symbol","source":"esri","source-layer":"Water point","filter":["==","_label_class",6],"minzoom":9,"layout":{"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":{"stops":[[9,8.5],[15,10]]},"text-letter-spacing":0.1,"text-max-width":4,"text-field":"{_name_global}","text-padding":15},"paint":{"text-color":"#171310","text-halo-color":"#EBE7E2","text-halo-width":0.7,"text-halo-blur":1}},{"id":"Water point/Canal or ditch","type":"symbol","source":"esri","source-layer":"Water point","filter":["==","_label_class",4],"minzoom":9,"layout":{"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":{"stops":[[9,8.5],[15,10]]},"text-letter-spacing":0.13,"text-max-width":4,"text-field":"{_name_global}","text-padding":15},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":1}},{"id":"Water point/Stream or river","type":"symbol","source":"esri","source-layer":"Water point","filter":["==","_label_class",3],"minzoom":9,"layout":{"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":{"stops":[[9,8.5],[15,10]]},"text-letter-spacing":0.1,"text-max-width":4,"text-field":"{_name_global}","text-padding":15},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":0.5}},{"id":"Water point/Lake or reservoir","type":"symbol","source":"esri","source-layer":"Water point","filter":["==","_label_class",2],"minzoom":9,"layout":{"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":{"stops":[[9,8.5],[15,10]]},"text-letter-spacing":0.1,"text-max-width":4,"text-field":"{_name_global}","text-padding":15},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#FFFFFF","text-halo-width":0.5}},{"id":"Water point/Bay or inlet","type":"symbol","source":"esri","source-layer":"Water point","filter":["==","_label_class",1],"minzoom":9,"layout":{"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":{"stops":[[9,8.5],[15,10]]},"text-letter-spacing":0.1,"text-max-width":4,"text-field":"{_name_global}","text-padding":15},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":0.5}},{"id":"Ferry/label/Ferry","type":"symbol","source":"esri","source-layer":"Ferry/label","filter":["all",["==","_label_class",0],["!in","Viz",2]],"minzoom":12,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":10,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name_global}","text-padding":30},"paint":{"text-color":"#ffffff","text-halo-width":1.2,"text-halo-color":"#6BC4F0","text-halo-blur":1}},{"id":"Water line/label/Default","type":"symbol","source":"esri","source-layer":"Water line/label","minzoom":11,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":9.5,"text-letter-spacing":0.07,"text-max-width":8,"text-max-angle":35,"text-field":"{_name_global}","text-padding":1,"text-offset":[0,-0.5],"symbol-spacing":800},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":0.5}},{"id":"Water line large scale/label/Default","type":"symbol","source":"esri","source-layer":"Water line large scale/label","minzoom":7,"maxzoom":11,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":9.3,"text-letter-spacing":0.01,"text-max-width":8,"text-max-angle":{"stops":[[7,25],[11,35]]},"text-field":"{_name}","text-padding":1,"text-offset":[0,-0.5],"symbol-spacing":800},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":0.5}},{"id":"Water line medium scale/label/Default","type":"symbol","source":"esri","source-layer":"Water line medium scale/label","minzoom":5,"maxzoom":7,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":9.3,"text-letter-spacing":0.1,"text-max-width":8,"text-max-angle":{"stops":[[5,15],[6,25]]},"text-field":"{_name}","text-padding":1,"text-offset":[0,-0.5],"symbol-spacing":800},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":0.5}},{"id":"Water line small scale/label/Default","type":"symbol","source":"esri","source-layer":"Water line small scale/label","minzoom":4,"maxzoom":5,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":8.5,"text-letter-spacing":0.1,"text-max-width":8,"text-max-angle":18,"text-field":"{_name}","text-padding":1,"text-offset":[0,-0.5],"symbol-spacing":800},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":0.5}},{"id":"Marine park/label/Default","type":"symbol","source":"esri","source-layer":"Marine park/label","minzoom":11,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#3a7795"}},{"id":"Water area/label/Dam or weir","type":"symbol","source":"esri","source-layer":"Water area/label","filter":["==","_label_class",8],"minzoom":11,"layout":{"text-font":["Montserrat SemiBold"],"text-size":9.5,"text-letter-spacing":0.08,"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#171310","text-halo-color":"#EBE7E2","text-halo-width":0.5,"text-halo-blur":1}},{"id":"Water area/label/Playa","type":"symbol","source":"esri","source-layer":"Water area/label","filter":["==","_label_class",9],"minzoom":11,"layout":{"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":9.5,"text-letter-spacing":0.08,"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#171310","text-halo-color":"#EBE7E2","text-halo-width":0.5,"text-halo-blur":1}},{"id":"Water area/label/Canal or ditch","type":"symbol","source":"esri","source-layer":"Water area/label","filter":["==","_label_class",2],"minzoom":11,"layout":{"text-font":["Avenir Next LT Pro Demi Italic"],"symbol-placement":"line","symbol-spacing":1000,"text-size":10.5,"text-letter-spacing":0.13,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true,"text-max-width":5},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":0.5}},{"id":"Water area/label/Small river","type":"symbol","source":"esri","source-layer":"Water area/label","filter":["==","_label_class",7],"minzoom":11,"layout":{"text-font":["Avenir Next LT Pro Demi Italic"],"symbol-placement":"line","symbol-spacing":1000,"text-size":10.5,"text-letter-spacing":0.13,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true,"text-max-width":8},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":0.5}},{"id":"Water area/label/Large river","type":"symbol","source":"esri","source-layer":"Water area/label","filter":["==","_label_class",4],"minzoom":11,"layout":{"text-font":["Avenir Next LT Pro Demi Italic"],"symbol-placement":"line","symbol-spacing":1000,"text-size":10.5,"text-letter-spacing":0.13,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true,"text-max-width":8},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":0.5}},{"id":"Water area/label/Small lake or reservoir","type":"symbol","source":"esri","source-layer":"Water area/label","filter":["==","_label_class",6],"minzoom":11,"layout":{"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":10.5,"text-letter-spacing":0.13,"text-line-height":1,"text-max-width":4,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":0.5}},{"id":"Water area/label/Large lake or reservoir","type":"symbol","source":"esri","source-layer":"Water area/label","filter":["==","_label_class",3],"minzoom":11,"layout":{"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":10.5,"text-letter-spacing":0.13,"text-line-height":1.5,"text-max-width":4,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":0.5}},{"id":"Water area/label/Bay or inlet","type":"symbol","source":"esri","source-layer":"Water area/label","filter":["==","_label_class",1],"minzoom":11,"layout":{"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":10.5,"text-letter-spacing":0.13,"text-line-height":1.5,"text-max-width":4,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":0.5}},{"id":"Water area/label/Small island","type":"symbol","source":"esri","source-layer":"Water area/label","filter":["==","_label_class",0],"minzoom":11,"layout":{"text-size":10.5,"text-letter-spacing":0.1,"text-max-width":4,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Demi Italic"]},"paint":{"text-color":"#595959","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":1}},{"id":"Water area/label/Large island","type":"symbol","source":"esri","source-layer":"Water area/label","filter":["==","_label_class",5],"minzoom":11,"layout":{"text-size":10.5,"text-letter-spacing":0.13,"text-line-height":1.5,"text-max-width":4,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Demi Italic"]},"paint":{"text-color":"#595959","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":1}},{"id":"Water area large scale/label/River","type":"symbol","source":"esri","source-layer":"Water area large scale/label","filter":["==","_label_class",1],"minzoom":7,"maxzoom":11,"layout":{"text-font":["Avenir Next LT Pro Demi Italic"],"symbol-placement":"line","symbol-spacing":1000,"text-size":9.3,"text-letter-spacing":0.1,"text-field":"{_name}","text-padding":15,"symbol-avoid-edges":true,"text-max-width":4},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":0.5}},{"id":"Water area large scale/label/Lake or lake intermittent","type":"symbol","source":"esri","source-layer":"Water area large scale/label","filter":["==","_label_class",0],"minzoom":7,"maxzoom":11,"layout":{"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":9.3,"text-letter-spacing":0.1,"text-max-width":4,"text-field":"{_name}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":0.5}},{"id":"Water area medium scale/label/Default","type":"symbol","source":"esri","source-layer":"Water area medium scale/label","minzoom":5,"maxzoom":7,"layout":{"text-max-width":4,"text-field":"{_name}","text-padding":15,"symbol-avoid-edges":true,"text-letter-spacing":0.08,"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":9.3},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":0.5}},{"id":"Water area small scale/label/Default","type":"symbol","source":"esri","source-layer":"Water area small scale/label","minzoom":1,"maxzoom":5,"layout":{"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":9.3,"text-letter-spacing":0.08,"text-max-width":4,"text-field":"{_name}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":0.5}},{"id":"Marine area/label/Default","type":"symbol","source":"esri","source-layer":"Marine area/label","minzoom":11,"layout":{"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":10.5,"text-letter-spacing":0.13,"text-line-height":1.5,"text-max-width":4,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#82CFF5","text-halo-width":1}},{"id":"Marine waterbody/label/small","type":"symbol","source":"esri","source-layer":"Marine waterbody/label","filter":["==","_label_class",4],"minzoom":1,"maxzoom":10,"layout":{"text-font":["Avenir Next LT Pro Demi Italic"],"text-letter-spacing":{"stops":[[1,0.12],[10,0.25]]},"text-line-height":1.5,"text-max-width":6,"text-field":"{_name}","text-padding":15,"symbol-avoid-edges":true,"text-size":{"stops":[[1,8],[6,9.3]]}},"paint":{"text-color":{"stops":[[1,"#0d6c9a"],[6,"#0d6c9a"]]},"text-halo-blur":1,"text-halo-color":"#82CFF5","text-halo-width":0.5}},{"id":"Marine waterbody/label/medium","type":"symbol","source":"esri","source-layer":"Marine waterbody/label","filter":["==","_label_class",3],"minzoom":1,"maxzoom":10,"layout":{"text-font":["Avenir Next LT Pro Demi Italic"],"text-letter-spacing":{"stops":[[1,0.15],[10,0.3]]},"text-line-height":1.5,"text-max-width":6,"text-field":"{_name}","text-padding":15,"symbol-avoid-edges":true,"text-size":{"stops":[[1,8],[6,9.3]]}},"paint":{"text-color":{"stops":[[1,"#0d6c9a"],[6,"#0d6c9a"]]},"text-halo-blur":1,"text-halo-color":"#82CFF5","text-halo-width":0.5}},{"id":"Marine waterbody/label/large","type":"symbol","source":"esri","source-layer":"Marine waterbody/label","filter":["==","_label_class",2],"minzoom":1,"maxzoom":10,"layout":{"text-font":["Avenir Next LT Pro Demi Italic"],"text-letter-spacing":{"stops":[[1,0.18],[10,0.4]]},"text-line-height":1.5,"text-max-width":6,"text-field":"{_name}","text-padding":15,"symbol-avoid-edges":true,"text-size":{"stops":[[1,8],[6,10]]}},"paint":{"text-color":{"stops":[[1,"#0d6c9a"],[6,"#0d6c9a"]]},"text-halo-blur":1,"text-halo-color":"#82CFF5","text-halo-width":0.5}},{"id":"Marine waterbody/label/x large","type":"symbol","source":"esri","source-layer":"Marine waterbody/label","filter":["==","_label_class",1],"minzoom":1,"maxzoom":10,"layout":{"text-font":["Avenir Next LT Pro Demi Italic"],"text-letter-spacing":{"stops":[[1,0.2],[10,1.5]]},"text-line-height":1.5,"text-max-width":6,"text-field":"{_name}","text-padding":15,"symbol-avoid-edges":true,"text-size":{"stops":[[1,8],[6,11]]}},"paint":{"text-color":{"stops":[[1,"#0d6c9a"],[6,"#0d6c9a"]]},"text-halo-blur":1,"text-halo-color":"#82CFF5","text-halo-width":0.5}},{"id":"Marine waterbody/label/2x large","type":"symbol","source":"esri","source-layer":"Marine waterbody/label","filter":["==","_label_class",0],"minzoom":1,"maxzoom":10,"layout":{"text-font":["Avenir Next LT Pro Demi Italic"],"text-letter-spacing":{"stops":[[1,0.3],[10,2]]},"text-line-height":1.6,"text-max-width":6,"text-field":"{_name}","text-padding":15,"symbol-avoid-edges":true,"text-size":{"stops":[[1,10],[4,18]]}},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#82CFF5","text-halo-width":0.5}},{"id":"Ferry/label/Rail ferry","type":"symbol","source":"esri","source-layer":"Ferry/label","filter":["all",["==","_label_class",1],["!in","Viz",2]],"minzoom":12,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":9,"text-letter-spacing":0.1,"text-max-width":8,"text-field":"{_name_global}","text-padding":5,"text-offset":[0,-0.6],"symbol-spacing":1000},"paint":{"text-color":"#4E4E4E","text-halo-color":"#FFFFFF","text-halo-width":1}},{"id":"Railroad/label/Default","type":"symbol","source":"esri","source-layer":"Railroad/label","minzoom":14,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":9,"text-letter-spacing":0.1,"text-max-width":8,"text-field":"{_name_global}","text-padding":5,"text-offset":[0,-0.6],"symbol-spacing":1000},"paint":{"text-color":"#4E4E4E","text-halo-color":"#EBE7E2","text-halo-width":1}},{"id":"Trail or path/label/Default","type":"symbol","source":"esri","source-layer":"Trail or path/label","minzoom":15,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"symbol-spacing":400,"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":9.3,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name_global}","text-padding":5},"paint":{"text-color":"#595959","text-halo-color":"#FFFFFF","text-halo-width":1}},{"id":"Road tunnel/label/Pedestrian","type":"symbol","source":"esri","source-layer":"Road tunnel/label","filter":["all",["==","_label_class",6],["!in","Viz",2]],"minzoom":15,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"symbol-spacing":400,"text-font":["Montserrat SemiBold"],"text-size":9.3,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name_global}","text-padding":5},"paint":{"text-color":"#595959","text-halo-color":"#FFFFFF","text-halo-width":1,"text-halo-blur":1}},{"id":"Road tunnel/label/Local, service, 4WD","type":"symbol","source":"esri","source-layer":"Road tunnel/label","filter":["all",["==","_label_class",5],["!in","Viz",2]],"minzoom":12,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"symbol-spacing":400,"text-font":["Montserrat SemiBold"],"text-size":9.5,"text-letter-spacing":0.09,"text-max-width":8,"text-field":"{_name_global}","text-padding":{"stops":[[12,5],[15,5],[16,15]]}},"paint":{"text-color":"#595959","text-halo-color":"#FFFFFF","text-halo-width":1,"text-halo-blur":1}},{"id":"Road tunnel/label/Minor","type":"symbol","source":"esri","source-layer":"Road tunnel/label","filter":["all",["==","_label_class",4],["!in","Viz",2]],"minzoom":10,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"symbol-spacing":400,"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[10,9.5],[14,10.5],[18,12.5]]},"text-letter-spacing":0.09,"text-max-width":8,"text-field":"{_name_global}","text-padding":{"stops":[[10,5],[15,5],[16,15]]}},"paint":{"text-color":"#595959","text-halo-color":"#FFFFFF","text-halo-width":1,"text-halo-blur":1}},{"id":"Road tunnel/label/Major, alt name","type":"symbol","source":"esri","source-layer":"Road tunnel/label","filter":["all",["==","_label_class",3],["!in","Viz",2]],"minzoom":10,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"symbol-spacing":400,"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[10,9.5],[14,10.5],[18,12.5]]},"text-letter-spacing":0.09,"text-max-width":8,"text-field":"{_name}","text-padding":{"stops":[[10,5],[15,5],[16,15]]}},"paint":{"text-color":"#4e4e4e","text-halo-color":"#FFFFFF","text-halo-width":1,"text-halo-blur":1}},{"id":"Road tunnel/label/Major","type":"symbol","source":"esri","source-layer":"Road tunnel/label","filter":["all",["==","_label_class",2],["!in","Viz",2]],"minzoom":10,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"symbol-spacing":400,"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[10,9.5],[14,10.5],[18,12.5]]},"text-letter-spacing":0.09,"text-max-width":8,"text-field":"{_name}","text-padding":{"stops":[[10,5],[15,5],[16,15]]}},"paint":{"text-color":"#4E4E4E","text-halo-color":"#FFFFFF","text-halo-width":1,"text-halo-blur":1}},{"id":"Road tunnel/label/Highway","type":"symbol","source":"esri","source-layer":"Road tunnel/label","filter":["all",["==","_label_class",7],["!in","Viz",2]],"minzoom":10,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"symbol-spacing":400,"text-font":["Avenir Next LT Pro Bold"],"text-size":{"stops":[[10,9.5],[14,10.5],[18,14.5]]},"text-letter-spacing":0.09,"text-max-width":8,"text-field":"{_name_global}","text-padding":{"stops":[[10,5],[15,5],[16,15]]}},"paint":{"text-color":"#4E4E4E","text-halo-color":"#FFFFFF","text-halo-width":1,"text-halo-blur":1}},{"id":"Road tunnel/label/Freeway Motorway, alt name","type":"symbol","source":"esri","source-layer":"Road tunnel/label","filter":["all",["==","_label_class",1],["!in","Viz",2]],"minzoom":10,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"symbol-spacing":400,"text-font":["Avenir Next LT Pro Bold"],"text-size":{"stops":[[10,9.5],[14,10.5],[18,14.5]]},"text-letter-spacing":0.09,"text-max-width":8,"text-field":"{_name_global}","text-padding":{"stops":[[10,5],[15,5],[16,15]]}},"paint":{"text-color":"#4E4E4E","text-halo-color":"#FFFFFF","text-halo-width":1,"text-halo-blur":1}},{"id":"Road tunnel/label/Freeway Motorway","type":"symbol","source":"esri","source-layer":"Road tunnel/label","filter":["all",["==","_label_class",0],["!in","Viz",2]],"minzoom":10,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"symbol-spacing":400,"text-font":["Avenir Next LT Pro Bold"],"text-size":{"stops":[[10,9.5],[14,10.5],[18,14.5]]},"text-letter-spacing":0.09,"text-max-width":8,"text-field":"{_name_global}","text-padding":{"stops":[[10,5],[15,5],[16,15]]}},"paint":{"text-color":"#4E4E4E","text-halo-color":"#FFFFFF","text-halo-width":1,"text-halo-blur":1}},{"id":"Road/label/Local","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",5],["!in","Viz",2]],"minzoom":12,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"symbol-spacing":400,"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[10,9.5],[14,10.5],[18,11.5]]},"text-letter-spacing":0.09,"text-max-width":8,"text-field":"{_name_global}","text-padding":{"stops":[[12,5],[15,5],[16,15]]}},"paint":{"text-color":"#595959","text-halo-color":"#FFFFFF","text-halo-width":1}},{"id":"Road/label/Minor","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",4],["!in","Viz",2]],"minzoom":10,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"symbol-spacing":400,"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[10,9.5],[14,10.5],[18,12.5]]},"text-letter-spacing":0.09,"text-max-width":8,"text-field":"{_name_global}","text-padding":{"stops":[[10,5],[15,5],[16,15]]}},"paint":{"text-color":"#595959","text-halo-color":"#FFFFFF","text-halo-width":1}},{"id":"Road/label/Major, alt name","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",3],["!in","Viz",2]],"minzoom":10,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"symbol-spacing":400,"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[10,9.5],[14,10.5],[18,12.5]]},"text-letter-spacing":0.09,"text-max-width":8,"text-field":"{_name}","text-padding":{"stops":[[10,5],[15,5],[16,15]]}},"paint":{"text-color":"#4E4E4E","text-halo-color":"#FFFFFF","text-halo-width":1}},{"id":"Road/label/Major","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",2],["!in","Viz",2]],"minzoom":10,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"symbol-spacing":400,"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[10,9.5],[14,10.5],[18,12.5]]},"text-letter-spacing":0.09,"text-max-width":8,"text-field":"{_name_global}","text-padding":{"stops":[[10,5],[15,5],[16,15]]}},"paint":{"text-color":"#4E4E4E","text-halo-color":"#FFFFFF","text-halo-width":1}},{"id":"Road/label/Highway","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",75],["!in","Viz",2]],"minzoom":10,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"symbol-spacing":400,"text-font":["Avenir Next LT Pro Bold"],"text-size":{"stops":[[10,9.5],[14,10.5],[18,14.5]]},"text-letter-spacing":0.09,"text-max-width":8,"text-field":"{_name_global}","text-padding":{"stops":[[10,5],[15,5],[16,15]]}},"paint":{"text-color":"#4E4E4E","text-halo-color":"#FFFFFF","text-halo-width":1}},{"id":"Road/label/Freeway Motorway, alt name","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",1],["!in","Viz",2]],"minzoom":10,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"symbol-spacing":400,"text-font":["Avenir Next LT Pro Bold"],"text-size":{"stops":[[10,9.5],[14,10.5],[18,14.5]]},"text-letter-spacing":0.09,"text-max-width":8,"text-field":"{_name}","text-padding":{"stops":[[10,5],[15,5],[16,15]]}},"paint":{"text-color":"#4E4E4E","text-halo-color":"#FFFFFF","text-halo-width":1}},{"id":"Road/label/Freeway Motorway","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",0],["!in","Viz",2]],"minzoom":10,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"symbol-spacing":400,"text-font":["Avenir Next LT Pro Bold"],"text-size":{"stops":[[10,9.5],[14,10.5],[18,14.5]]},"text-letter-spacing":0.09,"text-max-width":8,"text-field":"{_name_global}","text-padding":{"stops":[[10,5],[15,5],[16,15]]}},"paint":{"text-color":"#4E4E4E","text-halo-color":"#FFFFFF","text-halo-width":1}},{"id":"Road/label/Rectangle white black (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",32],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":9.3,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle white black (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Rectangle white black","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",31],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":9.3,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle white black/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Secondary Hwy red white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",16],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Secondary Hwy red white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Secondary Hwy red white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",15],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Secondary Hwy red white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/U-shaped yellow black (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",24],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/U-shaped yellow black (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/U-shaped yellow black","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",23],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/U-shaped yellow black/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/U-shaped red white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",26],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/U-shaped red white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/U-shaped red white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",25],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/U-shaped red white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/U-shaped blue white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",28],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/U-shaped blue white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/U-shaped blue white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",27],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/U-shaped blue white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/V-shaped white black (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",30],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/V-shaped white black (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/V-shaped white black","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",29],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/V-shaped white black/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/U-shaped white black (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",18],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/U-shaped white black (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/U-shaped white black","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",17],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/U-shaped white black/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/U-shaped white green (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",20],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/U-shaped white green (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/U-shaped white green","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",19],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/U-shaped white green/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/U-shaped green leaf (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",22],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/U-shaped green leaf (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/U-shaped green leaf","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",21],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/U-shaped green leaf/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Rectangle yellow black (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",38],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle yellow black (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Rectangle yellow black","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",37],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle yellow black/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Rectangle red white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",36],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle red white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Rectangle red white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",35],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle red white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Rectangle blue white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",34],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle blue white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Rectangle blue white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",33],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle blue white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Rectangle green white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",40],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle green white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Rectangle green white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",39],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle green white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Rectangle green yellow (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",42],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle green yellow (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#f1dfb7"}},{"id":"Road/label/Rectangle green yellow","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",41],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle green yellow/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#f1dfb7"}},{"id":"Road/label/Pentagon inverse white black (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",44],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":9.3,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Pentagon inverse white black/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Pentagon inverse white black","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",43],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":9.3,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Pentagon inverse white black (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Pentagon white black (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",46],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Pentagon white black (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Pentagon white black","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",45],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Pentagon white black/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Pentagon yellow black (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",50],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Pentagon yellow black (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Pentagon yellow black","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",49],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Pentagon yellow black/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Pentagon green white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",51],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Pentagon green white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Pentagon green white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",52],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Pentagon green white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Pentagon green yellow","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",53],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Pentagon green yellow/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#f1dfb7"}},{"id":"Road/label/Pentagon green yellow (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",54],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Pentagon green yellow (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#f1dfb7"}},{"id":"Road/label/Pentagon blue white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",48],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":9.3,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Pentagon blue white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Pentagon blue white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",47],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":9.3,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Pentagon blue white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Hexagon white black (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",56],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Hexagon white black (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Hexagon white black","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",55],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Hexagon white black/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Hexagon blue white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",57],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Hexagon blue white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Hexagon blue white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",58],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Hexagon blue white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Hexagon red white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",59],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Hexagon red white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Hexagon red white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",60],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Hexagon red white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Hexagon green white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",62],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Hexagon green white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Hexagon green white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",61],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Hexagon green white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Hexagon orange black","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",63],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Hexagon orange black/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Hexagon orange black (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",64],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Hexagon orange black (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Rectangle hexagon blue white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",66],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle hexagon blue white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Rectangle hexagon blue white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",65],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle hexagon blue white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Rectangle hexagon red white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",68],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle hexagon red white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Rectangle hexagon red white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",67],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle hexagon red white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Rectangle hexagon green white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",70],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle hexagon green white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Rectangle hexagon green white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",69],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle hexagon green white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Rectangle hexagon brown white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",72],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle hexagon brown white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Rectangle hexagon brown white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",71],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle hexagon brown white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Octagon green white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",74],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Octagon green white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Octagon green white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",73],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Octagon green white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Shield white black (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",10],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":9.3,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Shield white black (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Shield white black","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",9],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":9.3,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Shield white black/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Secondary Hwy green white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",14],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":9.3,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Secondary Hwy green white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Secondary Hwy green white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",13],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":9.3,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Secondary Hwy green white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Secondary Hwy white black (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",12],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Secondary Hwy white black (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Secondary Hwy white black","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",11],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Secondary Hwy white black/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Shield blue white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",8],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Shield blue white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Shield blue white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",7],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Shield blue white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Pedestrian","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",6],["!in","Viz",2]],"minzoom":15,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"symbol-spacing":400,"text-font":["Montserrat SemiBold"],"text-size":9.3,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name_global}","text-padding":5},"paint":{"text-color":"#595959","text-halo-color":"#FFFFFF","text-halo-width":1}},{"id":"Building/label/Default","type":"symbol","source":"esri","source-layer":"Building/label","minzoom":15,"layout":{"visibility":"none","text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#5a3514","text-halo-color":"#EBE7E2","text-halo-width":0.7,"text-halo-blur":1}},{"id":"Cemetery/label/Default","type":"symbol","source":"esri","source-layer":"Cemetery/label","minzoom":13,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#2d4e28","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Freight/label/Default","type":"symbol","source":"esri","source-layer":"Freight/label","minzoom":12,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#4a2b1b","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Water and wastewater/label/Default","type":"symbol","source":"esri","source-layer":"Water and wastewater/label","minzoom":13,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#4a2b1b","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Port/label/Default","type":"symbol","source":"esri","source-layer":"Port/label","minzoom":12,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#4a2b1b","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Industry/label/Default","type":"symbol","source":"esri","source-layer":"Industry/label","minzoom":12,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#4a2b1b","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Government/label/Default","type":"symbol","source":"esri","source-layer":"Government/label","minzoom":13,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15},"paint":{"text-color":"#4a2b1b","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Finance/label/Default","type":"symbol","source":"esri","source-layer":"Finance/label","minzoom":13,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#9d5a48","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Emergency/label/Default","type":"symbol","source":"esri","source-layer":"Emergency/label","minzoom":13,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#33302f","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Indigenous/label/Default","type":"symbol","source":"esri","source-layer":"Indigenous/label","minzoom":7,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[9,8.5],[15,9.5],[20,12.5],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#533d32","text-halo-color":"#e8e6d6","text-halo-width":1,"text-halo-blur":1}},{"id":"Military/label/Default","type":"symbol","source":"esri","source-layer":"Military/label","minzoom":6,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[9,8.5],[15,9.5],[20,12.5],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":25,"symbol-avoid-edges":true},"paint":{"text-color":"#242221","text-halo-color":"#E0E0D9","text-halo-width":1,"text-halo-blur":1}},{"id":"Transportation/label/Default","type":"symbol","source":"esri","source-layer":"Transportation/label","minzoom":13,"layout":{"visibility":"none","text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#242221","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Pedestrian/label/Default","type":"symbol","source":"esri","source-layer":"Pedestrian/label","minzoom":13,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15},"paint":{"text-color":"#242221","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Beach/label/Default","type":"symbol","source":"esri","source-layer":"Beach/label","minzoom":13,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":0.08,"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#806b3c","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Golf course/label/Default","type":"symbol","source":"esri","source-layer":"Golf course/label","minzoom":11,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#2d4e28","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Zoo/label/Default","type":"symbol","source":"esri","source-layer":"Zoo/label","minzoom":11,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#2d4e28","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Retail/label/Default","type":"symbol","source":"esri","source-layer":"Retail/label","minzoom":13,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#9d5a48","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Landmark/label/Default","type":"symbol","source":"esri","source-layer":"Landmark/label","minzoom":13,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#446757","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Openspace or forest/label/Default","type":"symbol","source":"esri","source-layer":"Openspace or forest/label","minzoom":10,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":25},"paint":{"text-color":"#006200","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Park or farming/label/Default","type":"symbol","source":"esri","source-layer":"Park or farming/label","minzoom":11,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":25},"paint":{"text-color":"#006200","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Point of interest/Park","type":"symbol","source":"esri","source-layer":"Point of interest","filter":["==","_label_class",1],"minzoom":9,"layout":{"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15},"paint":{"text-color":"#006200","text-halo-width":1,"text-halo-color":"#EBE7E2","text-halo-blur":1}},{"id":"Education/label/Default","type":"symbol","source":"esri","source-layer":"Education/label","minzoom":11,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#505000","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Medical/label/Default","type":"symbol","source":"esri","source-layer":"Medical/label","minzoom":11,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#3d5d69","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Admin1 forest or park/label/Default","type":"symbol","source":"esri","source-layer":"Admin1 forest or park/label","minzoom":7,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[9,8.5],[15,9.5],[20,12.5],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":25},"paint":{"text-color":"#006200","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Admin0 forest or park/label/Default","type":"symbol","source":"esri","source-layer":"Admin0 forest or park/label","minzoom":6,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[9,8.5],[15,9.5],[20,12.5],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":25,"symbol-avoid-edges":true},"paint":{"text-color":"#006200","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Airport/label/Airport property","type":"symbol","source":"esri","source-layer":"Airport/label","minzoom":9,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[9,8.5],[15,9.5],[20,12.5],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#5f5e5c","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Admin2 area/label/small","type":"symbol","source":"esri","source-layer":"Admin2 area/label","filter":["==","_label_class",1],"minzoom":9,"maxzoom":11,"layout":{"text-letter-spacing":0.2,"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":11,"text-max-width":8,"text-field":"{_name}","text-padding":1,"symbol-avoid-edges":true,"text-transform":"uppercase"},"paint":{"text-color":"#80755f","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Admin2 area/label/large","type":"symbol","source":"esri","source-layer":"Admin2 area/label","filter":["==","_label_class",0],"minzoom":9,"maxzoom":11,"layout":{"text-letter-spacing":0.2,"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":13,"text-max-width":8,"text-field":"{_name}","text-padding":1,"symbol-avoid-edges":true,"text-transform":"uppercase"},"paint":{"text-color":"#80755f","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Admin1 area/label/x small","type":"symbol","source":"esri","source-layer":"Admin1 area/label","filter":["==","_label_class",5],"minzoom":4,"maxzoom":10,"layout":{"text-font":["Montserrat SemiBold"],"text-transform":"uppercase","text-max-width":8,"text-field":"{_name}","text-padding":1,"symbol-avoid-edges":true,"text-size":{"stops":[[4,8.5],[5,9.5],[6,10.3],[9,11]]},"text-letter-spacing":{"stops":[[4,0.1],[8,0.2]]}},"paint":{"text-color":{"stops":[[4,"#554434"],[6,"#39240e"]]},"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Admin1 area/label/small","type":"symbol","source":"esri","source-layer":"Admin1 area/label","filter":["==","_label_class",4],"minzoom":4,"maxzoom":10,"layout":{"text-font":["Montserrat SemiBold"],"text-transform":"uppercase","text-max-width":8,"text-field":"{_name}","text-padding":1,"symbol-avoid-edges":true,"text-size":{"stops":[[4,8.5],[5,9.5],[6,10.5],[9,11.5]]},"text-letter-spacing":{"stops":[[4,0.1],[8,0.2]]}},"paint":{"text-color":{"stops":[[4,"#554434"],[6,"#39240e"]]},"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Admin1 area/label/medium","type":"symbol","source":"esri","source-layer":"Admin1 area/label","filter":["==","_label_class",3],"minzoom":4,"maxzoom":10,"layout":{"text-font":["Montserrat SemiBold"],"text-transform":"uppercase","text-max-width":8,"text-field":"{_name}","text-padding":1,"symbol-avoid-edges":true,"text-size":{"stops":[[4,9.5],[5,10.5],[6,11.3],[9,12]]},"text-letter-spacing":{"stops":[[4,0.15],[8,0.4]]}},"paint":{"text-color":{"stops":[[4,"#554434"],[6,"#39240e"]]},"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Admin1 area/label/large","type":"symbol","source":"esri","source-layer":"Admin1 area/label","filter":["==","_label_class",2],"minzoom":4,"maxzoom":10,"layout":{"text-font":["Montserrat SemiBold"],"text-transform":"uppercase","text-max-width":8,"text-field":"{_name}","text-padding":1,"symbol-avoid-edges":true,"text-size":{"stops":[[4,9.5],[5,11.3],[6,13],[9,17]]},"text-letter-spacing":{"stops":[[4,0.1],[8,0.5]]}},"paint":{"text-color":{"stops":[[4,"#554434"],[6,"#39240e"]]},"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Admin1 area/label/x large","type":"symbol","source":"esri","source-layer":"Admin1 area/label","filter":["==","_label_class",1],"minzoom":4,"maxzoom":10,"layout":{"text-font":["Montserrat SemiBold"],"text-transform":"uppercase","text-max-width":8,"text-field":"{_name}","text-padding":1,"symbol-avoid-edges":true,"text-size":{"stops":[[4,10.3],[5,12],[6,13.5],[9,19]]},"text-letter-spacing":{"stops":[[4,0.15],[8,0.6]]}},"paint":{"text-color":{"stops":[[4,"#554434"],[6,"#39240e"]]},"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Admin1 area/label/2x large","type":"symbol","source":"esri","source-layer":"Admin1 area/label","filter":["==","_label_class",0],"minzoom":4,"maxzoom":10,"layout":{"text-font":["Montserrat SemiBold"],"text-transform":"uppercase","text-max-width":8,"text-field":"{_name}","text-padding":1,"symbol-avoid-edges":true,"text-size":{"stops":[[4,11.5],[5,12.3],[6,14],[9,19]]},"text-letter-spacing":{"stops":[[4,0.15],[8,0.75]]}},"paint":{"text-color":{"stops":[[4,"#554434"],[6,"#39240e"]]},"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Point of interest/General","type":"symbol","source":"esri","source-layer":"Point of interest","filter":["==","_label_class",0],"minzoom":9,"layout":{"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15},"paint":{"text-color":{"stops":[[9,"#5a3514"],[11,"#5a3514"]]},"text-halo-width":1,"text-halo-color":"#EBE7E2","text-halo-blur":1}},{"id":"Point of interest/Bus station","type":"symbol","source":"esri","source-layer":"Point of interest","filter":["==","_symbol",2],"minzoom":12,"layout":{"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15},"paint":{"text-color":{"stops":[[9,"#5a3514"],[11,"#5a3514"]]},"text-halo-width":1,"text-halo-color":"#EBE7E2","text-halo-blur":1}},{"id":"Point of interest/Rail station","type":"symbol","source":"esri","source-layer":"Point of interest","filter":["==","_symbol",3],"minzoom":12,"layout":{"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15},"paint":{"text-color":{"stops":[[9,"#5a3514"],[11,"#5a3514"]]},"text-halo-width":1,"text-halo-color":"#EBE7E2","text-halo-blur":1}},{"id":"Neighborhood","type":"symbol","source":"esri","source-layer":"Neighborhood","minzoom":14,"maxzoom":17,"layout":{"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[10,10],[16,14]]},"text-letter-spacing":0.08,"text-max-width":8,"text-field":"{_name_global}","text-padding":1},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City large scale/town small","type":"symbol","source":"esri","source-layer":"City large scale","filter":["==","_label_class",5],"minzoom":10,"maxzoom":17,"layout":{"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[10,11],[16,15]]},"text-letter-spacing":0.08,"text-max-width":8,"text-field":"{_name_global}","text-padding":15},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City large scale/town large","type":"symbol","source":"esri","source-layer":"City large scale","filter":["==","_label_class",4],"minzoom":10,"maxzoom":17,"layout":{"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[10,11],[16,17]]},"text-letter-spacing":0.09,"text-max-width":8,"text-field":"{_name_global}","text-padding":1},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City large scale/small","type":"symbol","source":"esri","source-layer":"City large scale","filter":["==","_label_class",3],"minzoom":10,"maxzoom":17,"layout":{"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-letter-spacing":0.1,"text-max-width":8,"text-field":"{_name_global}","text-padding":1,"text-size":{"stops":[[10,12],[16,18]]}},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City large scale/medium","type":"symbol","source":"esri","source-layer":"City large scale","filter":["==","_label_class",2],"minzoom":10,"maxzoom":17,"layout":{"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-letter-spacing":0.1,"text-max-width":8,"text-field":"{_name_global}","text-padding":1,"text-size":{"stops":[[10,13],[16,20]]}},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City large scale/large","type":"symbol","source":"esri","source-layer":"City large scale","filter":["==","_label_class",1],"minzoom":10,"maxzoom":17,"layout":{"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-letter-spacing":0.1,"text-max-width":8,"text-field":"{_name_global}","text-padding":1,"text-size":{"stops":[[10,14],[16,26]]}},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City large scale/x large","type":"symbol","source":"esri","source-layer":"City large scale","filter":["==","_label_class",0],"minzoom":10,"maxzoom":17,"layout":{"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-letter-spacing":0.1,"text-max-width":8,"text-field":"{_name_global}","text-padding":1,"text-size":{"stops":[[10,14.5],[16,31]]}},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/town small non capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",17],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-size":11,"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left"},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/town large non capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",15],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-size":11,"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left"},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/small non capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",12],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-size":11.5,"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left"},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/medium non capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",9],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left","text-size":{"stops":[[4,12.3],[6,12.3],[8,13]]}},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/other capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",18],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-size":11.5,"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left"},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/town large other capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",14],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-size":11.5,"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left"},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/small other capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",11],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-size":11.5,"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left"},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/medium other capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",8],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left","text-size":{"stops":[[4,12.3],[6,12.3],[8,13]]}},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Admin0 point/x small","type":"symbol","source":"esri","source-layer":"Admin0 point","filter":["==","_label_class",5],"minzoom":5,"maxzoom":10,"layout":{"text-font":["Avenir Next LT Pro Bold"],"text-max-width":8,"text-field":"{_name}","text-padding":1,"symbol-avoid-edges":true,"text-letter-spacing":{"stops":[[5,0.13],[8,0.5]]},"text-size":{"stops":[[5,13],[10,18]]}},"paint":{"text-color":"#0f010f","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Admin0 point/small","type":"symbol","source":"esri","source-layer":"Admin0 point","filter":["==","_label_class",4],"minzoom":4,"maxzoom":10,"layout":{"text-font":["Avenir Next LT Pro Bold"],"text-max-width":8,"text-field":"{_name}","text-padding":1,"symbol-avoid-edges":true,"text-letter-spacing":{"stops":[[4,0.13],[8,0.5]]},"text-size":{"stops":[[4,13],[10,18]]}},"paint":{"text-color":"#0f010f","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Admin0 point/medium","type":"symbol","source":"esri","source-layer":"Admin0 point","filter":["==","_label_class",3],"minzoom":2,"maxzoom":10,"layout":{"text-font":["Avenir Next LT Pro Bold"],"text-max-width":8,"text-field":"{_name}","text-padding":1,"symbol-avoid-edges":true,"text-letter-spacing":{"stops":[[2,0.13],[8,0.5]]},"text-size":{"stops":[[2,10],[4,14],[10,22]]}},"paint":{"text-color":"#0f010f","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Admin0 point/large","type":"symbol","source":"esri","source-layer":"Admin0 point","filter":["==","_label_class",2],"minzoom":2,"maxzoom":10,"layout":{"text-font":["Avenir Next LT Pro Bold"],"text-max-width":8,"text-field":"{_name}","text-padding":1,"symbol-avoid-edges":true,"text-letter-spacing":{"stops":[[2,0.13],[8,0.5]]},"text-size":{"stops":[[2,11],[4,14],[6,22]]}},"paint":{"text-color":"#0f010f","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Admin0 point/x large","type":"symbol","source":"esri","source-layer":"Admin0 point","filter":["==","_label_class",1],"minzoom":2,"maxzoom":8,"layout":{"text-max-width":8,"text-field":"{_name}","text-padding":1,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-line-height":1.5,"text-letter-spacing":{"stops":[[2,0.15],[6,0.5]]},"text-size":{"stops":[[2,11.5],[4,15],[6,23]]}},"paint":{"text-color":"#0f010f","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/town small admin0 capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",16],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left","text-size":{"stops":[[4,12.3],[6,13.5],[8,14.3]]}},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/town large admin0 capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",13],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left","text-size":{"stops":[[4,12.3],[6,13.5],[8,14.3]]}},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/small admin0 capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",10],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left","text-size":{"stops":[[4,12.3],[6,13.5],[8,14.3]]}},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/medium admin0 capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",7],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left","text-size":{"stops":[[4,12.3],[6,13.5],[8,14.3]]}},"paint":{"text-color":"#343434","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/large other capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",5],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left","text-size":{"stops":[[4,12.3],[6,12.3],[8,13]]}},"paint":{"text-color":{"stops":[[2,"#343434"],[3,"#000000"]]},"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/x large admin2 capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",2],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left","text-size":{"stops":[[4,12.3],[6,13.5],[8,14.3]]}},"paint":{"text-color":{"stops":[[2,"#343434"],[3,"#000000"]]},"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/large non capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",6],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left","text-size":{"stops":[[4,12.3],[6,12.3],[8,13]]}},"paint":{"text-color":{"stops":[[2,"#343434"],[3,"#000000"]]},"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/large admin0 capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",4],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left","text-size":{"stops":[[4,12.3],[6,13.5],[8,14.3]]}},"paint":{"text-color":{"stops":[[2,"#2d2d2d"],[3,"#000000"]]},"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/x large non capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",3],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left","text-size":{"stops":[[4,12.3],[6,13.5],[8,14.3]]}},"paint":{"text-color":{"stops":[[2,"#343434"],[3,"#000000"]]},"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/x large admin1 capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",1],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left","text-size":{"stops":[[4,12.3],[6,13.5],[8,14.3]]}},"paint":{"text-color":{"stops":[[2,"#343434"],[3,"#000000"]]},"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/x large admin0 capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",0],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left","text-size":{"stops":[[4,12.3],[6,13.5],[8,14.3]]}},"paint":{"text-color":{"stops":[[2,"#2d2d2d"],[3,"#000000"]]},"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Admin0 point/2x large","type":"symbol","source":"esri","source-layer":"Admin0 point","filter":["==","_label_class",0],"minzoom":2,"maxzoom":6,"layout":{"text-max-width":8,"text-field":"{_name}","text-padding":1,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-line-height":1.7,"text-letter-spacing":{"stops":[[2,0.3],[5,0.5]]},"text-size":{"stops":[[2,14],[4,22.5],[5,28]]}},"paint":{"text-color":"#0f010f","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Continent","type":"symbol","source":"esri","source-layer":"Continent","maxzoom":2,"layout":{"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":{"stops":[[0,8.3],[1,10.3]]},"text-letter-spacing":0.35,"text-max-width":8,"text-line-height":1.75,"text-field":"{_name_global}","text-padding":1,"text-transform":"uppercase"},"paint":{"text-color":"#363636","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Disputed label point/Island","type":"symbol","source":"esri","source-layer":"Disputed label point","filter":["all",["==","_label_class",1],["in","DisputeID",0]],"minzoom":6,"layout":{"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":{"stops":[[6,7],[15,10]]},"text-letter-spacing":0.13,"text-line-height":1.5,"text-max-width":4,"text-field":"{_name}","text-padding":1},"paint":{"text-color":"#595959","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":1}},{"id":"Disputed label point/Waterbody","type":"symbol","source":"esri","source-layer":"Disputed label point","filter":["all",["==","_label_class",0],["in","DisputeID",1006]],"minzoom":2,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":{"stops":[[2,8],[6,9.3]]},"text-letter-spacing":0.1,"text-max-width":6,"text-field":"{_name}","text-padding":1},"paint":{"text-color":{"stops":[[1,"#0d6c9a"],[6,"#0d6c9a"]]},"text-halo-blur":1,"text-halo-color":"#82CFF5","text-halo-width":0.5}},{"id":"Disputed label point/Admin0","type":"symbol","source":"esri","source-layer":"Disputed label point","filter":["all",["==","_label_class",2],["in","DisputeID",1021]],"minzoom":2,"layout":{"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":{"stops":[[2,10],[4,14],[10,22]]},"text-letter-spacing":{"stops":[[2,0.13],[8,0.5]]},"text-max-width":8,"text-field":"{_name}","text-padding":1},"paint":{"text-color":"#1f1d1f","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"mapillary-images","type":"circle","source":"mly","source-layer":"image","maxzoom":22,"minzoom":11,"filter":["all",["==","is_pano",true],["==","organization_id",518073312556755]],"layout":{"visibility":"visible"},"paint":{"circle-radius":{"base":1,"stops":[[13,0.1],[14,0.5],[17,2],[18.5,4],[19,7],[19.5,10]]},"circle-color":"rgba(20,20,120,0)"}},{"id":"mapillary-location","type":"symbol","source":"mapillary","layout":{"icon-rotate":["get","bearing"],"icon-rotation-alignment":"map","icon-image":"video"}},{"id":"parcels","type":"line","source":"parcels","source-layer":"parcels","minzoom":11,"layout":{"visibility":"visible"},"paint":{"line-color":{"stops":[[14,"#222"],[17,"#333"],[17.1,"#444"],[18,"#333"]]},"line-width":{"base":1,"stops":[[12,0.1],[14,0.75],[17,1.5],[20,4]]},"line-opacity":{"base":1,"stops":[[12,0],[12.1,0.5],[22,1]]}}},{"id":"parcels-highlight","type":"line","source":"parcels","source-layer":"parcels","minzoom":11,"filter":["==","parcelno",""],"layout":{"visibility":"visible"},"paint":{"line-color":"#feb70d","line-width":{"base":1,"stops":[[12,0.5],[14,2],[15,3],[22,10]]},"line-opacity":{"base":1,"stops":[[12,0],[12.1,0.1],[12.5,1],[22,1]]}}},{"id":"parcels-fill","type":"fill","source":"parcels","source-layer":"parcels","interactive":true,"minzoom":12,"layout":{"visibility":"visible"},"paint":{"fill-color":"rgba(0,0,0,0)"}}],"metadata":{"arcgisStyleUrl":"https://www.arcgis.com/sharing/rest/content/items/273bf8d5c8ac400183fc24e109d20bcf/resources/styles/root.json","arcgisOriginalItemTitle":"Community"}}'),x=function(){function e(t,i){var n,a,s;r(this,e),s=function(e,t){var i=Array.from(t);return e.filter((function(e,t,r){return t===r.findIndex((function(t){return isPropValuesEqual(t,e,i)}))}))},(a="getUniqueItemsByProperties")in(n=this)?Object.defineProperty(n,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[a]=s,this.app=i,this.svCoords={lng:-83.1,lat:42.36},this.svBearing=180,this.map=new o.Map({container:t,style:v,center:[this.svCoords.lng,this.svCoords.lat],zoom:12}),this.init(this)}return a(e,[{key:"init",value:function(e){e.map.addControl(new o.NavigationControl),e.map.on("load",(function(){e.map.addSource("markers",{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[12.695600612967427,56.04351888068181]},properties:{}}}),e.map.addSource("zoning",{type:"vector",tiles:["https://tiles.arcgis.com/tiles/qvkbeam7Wirps6zC/arcgis/rest/services/Zoning_Vector_Tiles/VectorTileServer/tile/{z}/{y}/{x}.pbf"],maxzoom:19}),e.map.addSource("peoplemover",{type:"geojson",data:"https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/Detroit_People_Mover_Route/FeatureServer/0/query?outFields=*&outSR=4326&where=1%3D1&f=geojson"}),e.map.addSource("mogobikes",{type:"geojson",data:"https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/MoGo_Bike_Share_Locations/FeatureServer/0/query?outFields=*&outSR=4326&where=1%3D1&f=geojson"}),e.map.addSource("smartroutes",{type:"geojson",data:"https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/SMART_Bus_Routes/FeatureServer/0/query?outFields=*&outSR=4326&where=1%3D1&f=geojson"}),e.map.addSource("qlineroute",{type:"geojson",data:"https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/QLine_Route/FeatureServer/0/query?outFields=*&outSR=4326&where=1%3D1&f=geojson"}),e.map.addSource("qlinestops",{type:"geojson",data:"https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/QLine_Stops/FeatureServer/0/query?outFields=*&outSR=4326&where=1%3D1&f=geojson"}),e.map.addSource("police-stations",{type:"geojson",data:"https://services2.arcgis.com/qvkbeam7Wirps6zC/ArcGIS/rest/services/Precinct_Buildings/FeatureServer/0/query?where=1%3D1&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=&returnGeometry=true&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pgeojson&token="}),e.map.addSource("fire-stations",{type:"geojson",data:"https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/Firehouse_Locations/FeatureServer/0/query?where=1%3D1&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnGeometry=true&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pgeojson&token="}),e.map.addSource("active-parks",{type:"geojson",data:"https://services2.arcgis.com/qvkbeam7Wirps6zC/ArcGIS/rest/services/Parks_Marijuana/FeatureServer/0/query?where=1%3D1&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnGeometry=true&returnCentroid=false&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pgeojson&token="}),e.map.addSource("marijuana-legacy-structure",{type:"geojson",data:"https://services2.arcgis.com/qvkbeam7Wirps6zC/ArcGIS/rest/services/City_Owned_Land_and_Structures_Set_Aside_for_Adult_Use_Marijuana/FeatureServer/1/query?where=1%3D1&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnGeometry=true&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pgeojson&token="}),e.map.addSource("marijuana-legacy-land",{type:"geojson",data:"https://services2.arcgis.com/qvkbeam7Wirps6zC/ArcGIS/rest/services/City_Owned_Land_and_Structures_Set_Aside_for_Adult_Use_Marijuana/FeatureServer/2/query?where=1%3D1&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnGeometry=true&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pgeojson&token="}),e.map.addSource("public-properties",{type:"vector",bounds:[-83.2847,42.2657,-82.9238,42.4499],minzoom:0,maxzoom:19,scheme:"xyz",url:"https://vectortileservices2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/DevelopmentOpportunitiesLayers/VectorTileServer",tiles:["https://vectortileservices2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/DevelopmentOpportunitiesLayers/VectorTileServer/tile/{z}/{y}/{x}.pbf"]}),e.map.addSource("opp-zones",{type:"geojson",data:"https://opendata.arcgis.com/datasets/4e50576fb1ee4a2db4208c220747831b_0.geojson"}),e.map.addSource("snf",{type:"geojson",data:"https://opendata.arcgis.com/datasets/dafad9fc0e854d9fb03d9cb00ea5e69c_0.geojson"}),e.map.addSource("tmah",{type:"geojson",data:"https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/Targeted_Multifamily_Affordable_Housing/FeatureServer/0/query?where=1%3D1&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnGeometry=true&returnCentroid=false&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pgeojson&token="}),e.map.addLayer({id:"r-zoning",type:"line",source:"zoning","source-layer":"Zoning",paint:{"line-color":["match",["get","ZONING_REV"],"R1","#FCF3CF","R2","#F9E79F","R3","#F4D03F","R4","#F1C40F","R5","#D4AC0D","R6","#B7950B","#ccc"],"line-width":3},filter:["in","ZONING_REV"]}),e.map.addLayer({id:"b-zoning",type:"line",source:"zoning","source-layer":"Zoning",paint:{"line-color":["match",["get","ZONING_REV"],"B1","#F1948A","B2","#EC7063","B3","#E74C3C","B4","#A93226","B5","#922B21","B6","#7B241C","#ccc"],"line-width":3},filter:["in","ZONING_REV"]}),e.map.addLayer({id:"m-zoning",type:"line",source:"zoning","source-layer":"Zoning",paint:{"line-color":["match",["get","ZONING_REV"],"M1","#EBDEF0","M2","#C39BD3","M3","#9B59B6","M4","#7D3C98","M5","#4A235A","#ccc"],"line-width":3},filter:["in","ZONING_REV"]}),e.map.addLayer({id:"s-zoning",type:"line",source:"zoning","source-layer":"Zoning",paint:{"line-color":["match",["get","ZONING_REV"],"P1","#CCD1D1","PC","#884EA0","PCA","#2471A3","PD","#3498DB","PR","#1E8449","SD1","#D4E6F1","SD2","#7FB3D5","SD3","#D7BDE2","SD4","#45B39D","SD5","#ff8f00","TM","#A2D9CE","W1","#82E0AA","#ccc"],"line-width":3},filter:["in","ZONING_REV"]}),e.map.addLayer({id:"peoplemover",type:"line",source:"peoplemover",layout:{visibility:"none"},paint:{"line-color":"#2c5490","line-width":2}}),e.map.addLayer({id:"smartroutes",type:"line",source:"smartroutes",layout:{visibility:"none"},paint:{"line-color":"#eb7609","line-width":2}}),e.map.addLayer({id:"mogobikes",type:"circle",source:"mogobikes",layout:{visibility:"none"},paint:{"circle-radius":{base:5,stops:[[12,5],[22,120]]},"circle-color":"#ee382a"}}),e.map.addLayer({id:"qlinestops",type:"circle",source:"qlinestops",layout:{visibility:"none"},paint:{"circle-radius":{base:5,stops:[[12,5],[22,120]]},"circle-color":"#7fb6ab"}}),e.map.addLayer({id:"qlineroute",type:"line",source:"qlineroute",layout:{visibility:"none"},paint:{"line-color":"#7fb6ab","line-width":2}}),e.map.addLayer({id:"fire-stations",type:"circle",source:"fire-stations",layout:{visibility:"none"},paint:{"circle-radius":{base:5,stops:[[12,5],[22,120]]},"circle-color":"#8f0408"}}),e.map.addLayer({id:"police-stations",type:"circle",source:"police-stations",layout:{visibility:"none"},paint:{"circle-radius":{base:5,stops:[[12,5],[22,120]]},"circle-color":"#00158b"}}),e.map.addLayer({id:"parks-fill",type:"fill",source:"active-parks",layout:{visibility:"none"},paint:{"fill-color":"#28f572","fill-opacity":.5}}),e.map.addLayer({id:"parks-line",type:"line",source:"active-parks",layout:{visibility:"none"},paint:{"line-color":"#28f572"}}),e.map.addLayer({id:"city-structures",type:"fill",source:"public-properties","source-layer":"City Real Estate Surplus Buildings",layout:{visibility:"none"},paint:{"fill-color":"#009980","fill-opacity":.7}}),e.map.addLayer({id:"city-land",type:"fill",source:"public-properties","source-layer":"City Real Estate Surplus Land",layout:{visibility:"none"},paint:{"fill-color":"#00f8cf","fill-opacity":.7}}),e.map.addLayer({id:"dlba-structures",type:"fill",source:"public-properties","source-layer":"dlba_structures",layout:{visibility:"none"},paint:{"fill-color":"#009980","fill-opacity":.7}}),e.map.addLayer({id:"dlba-land",type:"fill",source:"public-properties","source-layer":"dlba_land",layout:{visibility:"none"},paint:{"fill-color":"#00f8cf","fill-opacity":.7}}),e.map.addLayer({id:"marijuana-legacy-land",type:"circle",source:"marijuana-legacy-land",layout:{visibility:"none"},paint:{"circle-radius":{base:5,stops:[[12,5],[22,120]]},"circle-color":"#002e00"}}),e.map.addLayer({id:"marijuana-legacy-structure",type:"circle",source:"marijuana-legacy-structure",layout:{visibility:"none"},paint:{"circle-radius":{base:5,stops:[[12,5],[22,120]]},"circle-color":"#028302"}}),e.map.addLayer({id:"opp-zones-fill",type:"fill",source:"opp-zones",layout:{visibility:"none"},paint:{"fill-color":"#83027d","fill-opacity":.5}}),e.map.addLayer({id:"opp-zones-line",type:"line",source:"opp-zones",layout:{visibility:"none"},paint:{"line-color":"#83027d"}}),e.map.addLayer({id:"snf-fill",type:"fill",source:"snf",layout:{visibility:"none"},paint:{"fill-color":"#804d24","fill-opacity":.5}}),e.map.addLayer({id:"snf-line",type:"line",source:"snf",layout:{visibility:"none"},paint:{"line-color":"#804d24"}}),e.map.addLayer({id:"tmah-fill",type:"fill",source:"tmah",layout:{visibility:"none"},paint:{"fill-color":"#0060dd","fill-opacity":.5}}),e.map.addLayer({id:"tmah-line",type:"line",source:"tmah",layout:{visibility:"none"},paint:{"line-color":"#0060dd"}}),e.map.loadImage("https://detroitmi.gov/sites/detroitmi.localhost/files/styles/default/public/2021-02/video.png",(function(t,i){if(t)throw t;e.map.addImage("video",i)})),e.map.on("style.load",(function(){e.map.loadImage(videoIcon,(function(t,i){if(t)throw t;e.map.addImage("video",i),e.map.setFilter("parcels-highlight",["==","parcelno",e.app.parcel?e.app.parcel:""]),e.svCoords&&e.map.getSource("mapillary").setData({type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[e.svCoords.lon,e.svCoords.lat]},properties:{bearing:e.svBearing-90}}]})}))})),e.map.on("click","parcels-fill",(function(t){var i=e.map.queryRenderedFeatures(t.point,{layers:["parcels-fill"]});e.app.parcel=i[0].properties.parcelno,e.map.flyTo({center:[t.lngLat.lng,t.lngLat.lat],zoom:18,essential:!0}),i[0]._geometry?e.app.centroid=y(i[0]._geometry):e.app.centroid=y(i[0].geometry),e.app.coords=e.app.centroid.geometry.coordinates,e.map.setFilter("parcels-highlight",["==","parcelno",e.app.parcel?e.app.parcel:""])})),e.map.on("moveend",(function(t){try{switch(!0){case"WheelEvent"===t.originalEvent:case"MouseEvent"===t.originalEvent:break;default:if(e.map.getZoom()>17.5&&null!=e.app.parcel){var i=e.map.queryRenderedFeatures({layers:["mapillary-images"]}),r=l()(i,"properties.id");e.app.imageKeys=r,e.app.checkSpecialProperties(e.app.parcel,e.app)}}}catch(n){console.log(n)}})),e.map.on("click",(function(t){document.getElementById("initial-loader-overlay").className="active",e.map.queryRenderedFeatures(t.point,{layers:["parcels-fill"]}).length<1&&(e.app.panel.dashLast="city",e.app.panel.createPanel(e.app.panel,"dash"))})),document.querySelector("#initial-loader-overlay").className=""}))}},{key:"changeVisibility",value:function(e,t,i){e.forEach((function(e){i.map.setLayoutProperty(e,"visibility",t)}))}}]),e}(),b=function(){function e(t,i){r(this,e),this.form=null,this.expansion={forSale:!1,transportation:!1,publicAssests:!1,planningHousing:!1,zoning:!1,zoningB:!1,zoningM:!1,zoningS:!1},this.app=i,this.container=document.getElementById(t),this.buidlForm(document.getElementById(t),this)}return a(e,[{key:"checkLock",value:function(e){return 1==e.lock}},{key:"changeLock",value:function(e){1==e.lock?e.lock=!1:e.lock=!0}},{key:"removeForm",value:function(e){e.removeChild(e.childNodes[1])}},{key:"updateFilters",value:function(e,t){var i="none";if(e.target.checked)i="visible",t.app.filters.includes(e.target.id)||t.app.filters.push(e.target.id);else if(t.app.filters.includes(e.target.id)){var r=t.app.filters.filter((function(t,i,r){return t!=e.target.id}));t.app.filters=r}if(e.target.name.includes("zoning-data")){var n=t.buildNewZoningFilter(e,t,i);t.app.map.map.setFilter("".concat(e.target.name.charAt(0),"-zoning"),n)}else{var a=e.target.value.split(",");t.app.map.changeVisibility(a,i,t.app.map)}"parent-filter"==e.target.className&&t.changeSubsets(e,t)}},{key:"buildNewZoningFilter",value:function(e,t,i){var r=e.target.value.split(","),n=["in","ZONING_REV"];if("visible"==i)t.app.zoning[e.target.name.charAt(0)].length>0&&(t.app.zoning[e.target.name.charAt(0)].shift(),t.app.zoning[e.target.name.charAt(0)].shift()),r.forEach((function(i){t.app.zoning[e.target.name.charAt(0)].includes(i)||t.app.zoning[e.target.name.charAt(0)].push(i)})),t.app.zoning[e.target.name.charAt(0)].forEach((function(e){n.push(e)}));else{var a=t.app.zoning[e.target.name.charAt(0)];r.forEach((function(e){if(a.includes(e)){var t=a.filter((function(t,i,r){return t!=e}));a=t}})),n=a}return t.app.zoning[e.target.name.charAt(0)]=n,n}},{key:"changeSubsets",value:function(e,t){var i=e.target.value.split(",");if(e.target.checked)i.forEach((function(e){t.app.filters.includes(e)||t.app.filters.push(e)}));else{var r=t.app.filters,n=t.app.filters;i.forEach((function(e){r.includes(e)&&(n=n.filter((function(t,i,r){return t!=e})))})),t.app.filters=n}t.removeForm(t.container),t.buidlForm(t.container,t)}},{key:"buidlForm",value:function(e,t){t.form=document.createElement("form");var i=document.createElement("article"),r=document.createElement("input"),n=document.createElement("label"),a=document.createElement("button"),o=document.createElement("article"),s=document.createElement("input"),l=document.createElement("span"),c=document.createElement("label"),u=document.createElement("div"),h=document.createElement("input"),p=document.createElement("span"),d=document.createElement("label"),f=document.createElement("div"),m=document.createElement("input"),g=document.createElement("span"),_=document.createElement("label"),y=document.createElement("div"),v=document.createElement("input"),x=document.createElement("span"),b=document.createElement("label"),w=document.createElement("div");i.className="parent-filter-container",r.type="checkbox",r.value="city-land,dlba-land,city-structures,dlba-structures,marijuana-legacy-structure,marijuana-legacy-land",r.id="forSale-all",r.name="forSale-data",t.app.filters.includes("forSale-all")?r.checked=!0:r.checked=!1,r.className="parent-filter",n.innerText="Public Properties for Sale",n.setAttribute("for","forSale-all"),a.type="expand",r.addEventListener("change",(function(e){t.updateFilters(e,t)})),t.expansion.forSale?a.innerHTML='<i class="fas fa-minus"></i>':a.innerHTML='<i class="fas fa-plus"></i>',a.addEventListener("click",(function(e){t.expansion.forSale?t.expansion.forSale=!1:t.expansion.forSale=!0,t.removeForm(t.container),t.buidlForm(t.container,t)})),t.expansion.forSale?o.className="filter-subset active":o.className="filter-subset",s.type="checkbox",s.name="forSale-data",s.id="public-land",s.value="city-land,dlba-land",t.app.filters.includes("city-land")?s.checked=!0:s.checked=!1,s.addEventListener("change",(function(e){t.updateFilters(e,t)})),c.innerText="Public Land",c.setAttribute("for","public-land"),l.className="circle public-land",c.appendChild(l),u.appendChild(s),u.appendChild(c),o.appendChild(u),h.type="checkbox",h.name="forSale-data",h.id="public-structure",h.value="city-structures,dlba-structures",t.app.filters.includes("city-structures")?h.checked=!0:h.checked=!1,h.addEventListener("change",(function(e){t.updateFilters(e,t)})),d.innerText="Public Structure",d.setAttribute("for","public-structure"),p.className="circle public-structure",d.appendChild(p),f.appendChild(h),f.appendChild(d),o.appendChild(f),m.type="checkbox",m.name="forSale-data",m.id="marijuana-legacy-land",m.value="marijuana-legacy-land",t.app.filters.includes("marijuana-legacy-land")?m.checked=!0:m.checked=!1,m.addEventListener("change",(function(e){t.updateFilters(e,t)})),_.innerText="Marijuana Legacy Land",_.setAttribute("for","marijuana-legacy-land"),g.className="circle marijuana-land",_.appendChild(g),y.appendChild(m),y.appendChild(_),o.appendChild(y),v.type="checkbox",v.name="forSale-data",v.id="marijuana-legacy-structure",v.value="marijuana-legacy-structure",t.app.filters.includes("marijuana-legacy-structure")?v.checked=!0:v.checked=!1,v.addEventListener("change",(function(e){t.updateFilters(e,t)})),b.innerText="Marijuana Legacy Structures",b.setAttribute("for","marijuana-legacy-structure"),x.className="circle marijuana-structure",b.appendChild(x),w.appendChild(v),w.appendChild(b),o.appendChild(w),i.appendChild(r),i.appendChild(n),i.appendChild(a),t.form.appendChild(i),t.form.appendChild(o);var S=document.createElement("article"),M=document.createElement("input"),T=document.createElement("label"),E=document.createElement("button"),C=document.createElement("article"),A=document.createElement("input"),I=document.createElement("span"),P=document.createElement("label"),z=document.createElement("div"),R=document.createElement("input"),k=document.createElement("span"),L=document.createElement("label"),D=document.createElement("div"),B=document.createElement("input"),F=document.createElement("span"),O=document.createElement("label"),N=document.createElement("div");S.className="parent-filter-container",M.type="checkbox",M.value="fire-stations,police-stations,parks-fill,parks-line",M.id="publicAssests-all",M.name="publicAssests-data",t.app.filters.includes("publicAssests-all")?M.checked=!0:M.checked=!1,M.className="parent-filter",T.innerText="Public Assets",T.setAttribute("for","publicAssests-all"),E.type="expand",M.addEventListener("change",(function(e){t.updateFilters(e,t)})),t.expansion.publicAssests?E.innerHTML='<i class="fas fa-minus"></i>':E.innerHTML='<i class="fas fa-plus"></i>',E.addEventListener("click",(function(e){t.expansion.publicAssests?t.expansion.publicAssests=!1:t.expansion.publicAssests=!0,t.removeForm(t.container),t.buidlForm(t.container,t)})),t.expansion.publicAssests?C.className="filter-subset active":C.className="filter-subset",A.type="checkbox",A.name="publicAssests-data",A.id="fire-stations",A.value="fire-stations",t.app.filters.includes("fire-stations")?A.checked=!0:A.checked=!1,A.addEventListener("change",(function(e){t.updateFilters(e,t)})),P.innerText="Fire Stations",P.setAttribute("for","fire-stations"),I.className="circle fire",P.appendChild(I),z.appendChild(A),z.appendChild(P),C.appendChild(z),R.type="checkbox",R.name="publicAssests-data",R.id="police-stations",R.value="police-stations",t.app.filters.includes("police-stations")?R.checked=!0:R.checked=!1,R.addEventListener("change",(function(e){t.updateFilters(e,t)})),L.innerText="Police Stations",L.setAttribute("for","police-stations"),k.className="circle police",L.appendChild(k),D.appendChild(R),D.appendChild(L),C.appendChild(D),B.type="checkbox",B.name="publicAssests-data",B.id="active-parks",B.value="parks-fill,parks-line",t.app.filters.includes("parks-fill")?B.checked=!0:B.checked=!1,B.addEventListener("change",(function(e){t.updateFilters(e,t)})),O.innerText="Active Parks",O.setAttribute("for","active-parks"),F.className="square parks",O.appendChild(F),N.appendChild(B),N.appendChild(O),C.appendChild(N),S.appendChild(M),S.appendChild(T),S.appendChild(E),t.form.appendChild(S),t.form.appendChild(C);var V=document.createElement("article"),U=document.createElement("input"),$=document.createElement("label"),j=document.createElement("button"),q=document.createElement("article"),G=document.createElement("input"),H=document.createElement("span"),W=document.createElement("label"),Z=document.createElement("div"),X=document.createElement("input"),Y=document.createElement("span"),K=document.createElement("label"),J=document.createElement("div"),Q=document.createElement("input"),ee=document.createElement("span"),te=document.createElement("label"),ie=document.createElement("div");V.className="parent-filter-container",U.type="checkbox",U.value="opp-zones-fill,opp-zones-line,snf-fill,snf-line,tmah-fill,tmah-line",U.id="planningHousing-all",U.name="planningHousing-data",t.app.filters.includes("planningHousing-all")?U.checked=!0:U.checked=!1,U.className="parent-filter",$.innerText="Planning and Housing",$.setAttribute("for","planningHousing-all"),j.type="expand",U.addEventListener("change",(function(e){t.updateFilters(e,t)})),t.expansion.planningHousing?j.innerHTML='<i class="fas fa-minus"></i>':j.innerHTML='<i class="fas fa-plus"></i>',j.addEventListener("click",(function(e){t.expansion.planningHousing?t.expansion.planningHousing=!1:t.expansion.planningHousing=!0,t.removeForm(t.container),t.buidlForm(t.container,t)})),t.expansion.planningHousing?q.className="filter-subset active":q.className="filter-subset",G.type="checkbox",G.name="trans-data",G.id="opp-zones",G.value="opp-zones-fill,opp-zones-line",t.app.filters.includes("opp-zones-fill")?G.checked=!0:G.checked=!1,G.addEventListener("change",(function(e){t.updateFilters(e,t)})),W.innerText="Opportunity Zones",W.setAttribute("for","opp-zones"),H.className="square opp-zones",W.appendChild(H),Z.appendChild(G),Z.appendChild(W),q.appendChild(Z),X.type="checkbox",X.name="trans-data",X.id="snf",X.value="snf-fill,snf-line",t.app.filters.includes("snf-fill")?X.checked=!0:X.checked=!1,X.addEventListener("change",(function(e){t.updateFilters(e,t)})),K.innerText="Strategic Neighborhood Fund",K.setAttribute("for","snf"),Y.className="square snf",K.appendChild(Y),J.appendChild(X),J.appendChild(K),q.appendChild(J),Q.type="checkbox",Q.name="trans-data",Q.id="tmah",Q.value="tmah-fill,tmah-line",t.app.filters.includes("tmah-fill")?Q.checked=!0:Q.checked=!1,Q.addEventListener("change",(function(e){t.updateFilters(e,t)})),te.innerText="Targeted Multifamily Housing Areas",te.setAttribute("for","tmah"),ee.className="square tmah",te.appendChild(ee),ie.appendChild(Q),ie.appendChild(te),q.appendChild(ie),V.appendChild(U),V.appendChild($),V.appendChild(j),t.form.appendChild(V),t.form.appendChild(q);var re=document.createElement("article"),ne=document.createElement("input"),ae=document.createElement("label"),oe=document.createElement("button"),se=document.createElement("article"),le=document.createElement("input"),ce=document.createElement("span"),ue=document.createElement("label"),he=document.createElement("div"),pe=document.createElement("input"),de=document.createElement("span"),fe=document.createElement("label"),me=document.createElement("div"),ge=document.createElement("input"),_e=document.createElement("span"),ye=document.createElement("label"),ve=document.createElement("div"),xe=document.createElement("input"),be=document.createElement("span"),we=document.createElement("label"),Se=document.createElement("div");re.className="parent-filter-container",ne.type="checkbox",ne.value="smartroutes,qlineroute,qlinestops,peoplemover,mogobikes",ne.id="transportation-all",ne.name="trans-data",t.app.filters.includes("transportation-all")?ne.checked=!0:ne.checked=!1,ne.className="parent-filter",ae.innerText="Transportation",ae.setAttribute("for","transportation-all"),oe.type="expand",ne.addEventListener("change",(function(e){t.updateFilters(e,t)})),t.expansion.transportation?oe.innerHTML='<i class="fas fa-minus"></i>':oe.innerHTML='<i class="fas fa-plus"></i>',oe.addEventListener("click",(function(e){t.expansion.transportation?t.expansion.transportation=!1:t.expansion.transportation=!0,t.removeForm(t.container),t.buidlForm(t.container,t)})),t.expansion.transportation?se.className="filter-subset active":se.className="filter-subset",le.type="checkbox",le.name="trans-data",le.id="qlineroute",le.value="qlineroute,qlinestops",t.app.filters.includes("qlineroute")?le.checked=!0:le.checked=!1,le.addEventListener("change",(function(e){t.updateFilters(e,t)})),ue.innerText="Q-Line",ue.setAttribute("for","qlineroute"),ce.className="line qline",ue.appendChild(ce),he.appendChild(le),he.appendChild(ue),se.appendChild(he),pe.type="checkbox",pe.name="trans-data",pe.id="smartroutes",pe.value="smartroutes",t.app.filters.includes("smartroutes")?pe.checked=!0:pe.checked=!1,pe.addEventListener("change",(function(e){t.updateFilters(e,t)})),fe.innerText="Smart Buses",fe.setAttribute("for","smartroutes"),de.className="line smart-bus",fe.appendChild(de),me.appendChild(pe),me.appendChild(fe),se.appendChild(me),ge.type="checkbox",ge.name="trans-data",ge.id="peoplemover",ge.value="peoplemover",t.app.filters.includes("peoplemover")?ge.checked=!0:ge.checked=!1,ge.addEventListener("change",(function(e){t.updateFilters(e,t)})),ye.innerText="People Mover",ye.setAttribute("for","peoplemover"),_e.className="line p-mover",ye.appendChild(_e),ve.appendChild(ge),ve.appendChild(ye),se.appendChild(ve),xe.type="checkbox",xe.name="trans-data",xe.id="mogobikes",xe.value="mogobikes",t.app.filters.includes("mogobikes")?xe.checked=!0:xe.checked=!1,xe.addEventListener("change",(function(e){t.updateFilters(e,t)})),we.innerText="MoGo Bike Station",we.setAttribute("for","mogobikes"),be.className="circle mogo",we.appendChild(be),Se.appendChild(xe),Se.appendChild(we),se.appendChild(Se),re.appendChild(ne),re.appendChild(ae),re.appendChild(oe),t.form.appendChild(re),t.form.appendChild(se);var Me=document.createElement("article"),Te=document.createElement("input"),Ee=document.createElement("label"),Ce=document.createElement("button"),Ae=document.createElement("article"),Ie=document.createElement("input"),Pe=document.createElement("span"),ze=document.createElement("label"),Re=document.createElement("div"),ke=document.createElement("input"),Le=document.createElement("span"),De=document.createElement("label"),Be=document.createElement("div"),Fe=document.createElement("input"),Oe=document.createElement("span"),Ne=document.createElement("label"),Ve=document.createElement("div"),Ue=document.createElement("input"),$e=document.createElement("span"),je=document.createElement("label"),qe=document.createElement("div"),Ge=document.createElement("input"),He=document.createElement("span"),We=document.createElement("label"),Ze=document.createElement("div"),Xe=document.createElement("input"),Ye=document.createElement("span"),Ke=document.createElement("label"),Je=document.createElement("div");Me.className="parent-filter-container",Te.type="checkbox",Te.value="R1,R2,R3,R4,R5,R6",Te.id="r-zoning-all",Te.name="r-zoning-data",t.app.filters.includes("r-zoning-all")?Te.checked=!0:Te.checked=!1,Te.className="parent-filter",Ee.innerText="Residential Zoning",Ee.setAttribute("for","r-zoning-all"),Ce.type="expand",Te.addEventListener("change",(function(e){t.updateFilters(e,t)})),t.expansion.zoning?Ce.innerHTML='<i class="fas fa-minus"></i>':Ce.innerHTML='<i class="fas fa-plus"></i>',Ce.addEventListener("click",(function(e){t.expansion.zoning?t.expansion.zoning=!1:t.expansion.zoning=!0,t.removeForm(t.container),t.buidlForm(t.container,t)})),t.expansion.zoning?Ae.className="filter-subset active":Ae.className="filter-subset",Ie.type="checkbox",Ie.name="r-zoning-data",Ie.id="R1",Ie.value="R1",t.app.filters.includes("R1")?Ie.checked=!0:Ie.checked=!1,Ie.addEventListener("change",(function(e){t.updateFilters(e,t)})),ze.innerText="R1 - Zoning",ze.setAttribute("for","R1"),Pe.className="line R1",ze.appendChild(Pe),Re.appendChild(Ie),Re.appendChild(ze),Ae.appendChild(Re),ke.type="checkbox",ke.name="r-zoning-data",ke.id="R2",ke.value="R2",t.app.filters.includes("R2")?ke.checked=!0:ke.checked=!1,ke.addEventListener("change",(function(e){t.updateFilters(e,t)})),De.innerText="R2 - Zoning",De.setAttribute("for","R2"),Le.className="line R2",De.appendChild(Le),Be.appendChild(ke),Be.appendChild(De),Ae.appendChild(Be),Fe.type="checkbox",Fe.name="r-zoning-data",Fe.id="R3",Fe.value="R3",t.app.filters.includes("R3")?Fe.checked=!0:Fe.checked=!1,Fe.addEventListener("change",(function(e){t.updateFilters(e,t)})),Ne.innerText="R3 - Zoning",Ne.setAttribute("for","R3"),Oe.className="line R3",Ne.appendChild(Oe),Ve.appendChild(Fe),Ve.appendChild(Ne),Ae.appendChild(Ve),Ue.type="checkbox",Ue.name="r-zoning-data",Ue.id="R4",Ue.value="R4",t.app.filters.includes("R4")?Ue.checked=!0:Ue.checked=!1,Ue.addEventListener("change",(function(e){t.updateFilters(e,t)})),je.innerText="R4 - Zoning",je.setAttribute("for","R4"),$e.className="line R4",je.appendChild($e),qe.appendChild(Ue),qe.appendChild(je),Ae.appendChild(qe),Ge.type="checkbox",Ge.name="r-zoning-data",Ge.id="R5",Ge.value="R5",t.app.filters.includes("R5")?Ge.checked=!0:Ge.checked=!1,Ge.addEventListener("change",(function(e){t.updateFilters(e,t)})),We.innerText="R5 - Zoning",We.setAttribute("for","R5"),He.className="line R5",We.appendChild(He),Ze.appendChild(Ge),Ze.appendChild(We),Ae.appendChild(Ze),Xe.type="checkbox",Xe.name="r-zoning-data",Xe.id="R6",Xe.value="R6",t.app.filters.includes("R6")?Xe.checked=!0:Xe.checked=!1,Xe.addEventListener("change",(function(e){t.updateFilters(e,t)})),Ke.innerText="R6 - Zoning",Ke.setAttribute("for","R6"),Ye.className="line R6",Ke.appendChild(Ye),Je.appendChild(Xe),Je.appendChild(Ke),Ae.appendChild(Je),Me.appendChild(Te),Me.appendChild(Ee),Me.appendChild(Ce),t.form.appendChild(Me),t.form.appendChild(Ae);var Qe=document.createElement("article"),et=document.createElement("input"),tt=document.createElement("label"),it=document.createElement("button"),rt=document.createElement("article"),nt=document.createElement("input"),at=document.createElement("span"),ot=document.createElement("label"),st=document.createElement("div"),lt=document.createElement("input"),ct=document.createElement("span"),ut=document.createElement("label"),ht=document.createElement("div"),pt=document.createElement("input"),dt=document.createElement("span"),ft=document.createElement("label"),mt=document.createElement("div"),gt=document.createElement("input"),_t=document.createElement("span"),yt=document.createElement("label"),vt=document.createElement("div"),xt=document.createElement("input"),bt=document.createElement("span"),wt=document.createElement("label"),St=document.createElement("div"),Mt=document.createElement("input"),Tt=document.createElement("span"),Et=document.createElement("label"),Ct=document.createElement("div");Qe.className="parent-filter-container",et.type="checkbox",et.value="B1,B2,B3,B4,B5,B6",et.id="b-zoning-all",et.name="b-zoning-data",t.app.filters.includes("b-zoning-all")?et.checked=!0:et.checked=!1,et.className="parent-filter",tt.innerText="Business Zoning",tt.setAttribute("for","b-zoning-all"),it.type="expand",et.addEventListener("change",(function(e){t.updateFilters(e,t)})),t.expansion.zoningB?it.innerHTML='<i class="fas fa-minus"></i>':it.innerHTML='<i class="fas fa-plus"></i>',it.addEventListener("click",(function(e){t.expansion.zoningB?t.expansion.zoningB=!1:t.expansion.zoningB=!0,t.removeForm(t.container),t.buidlForm(t.container,t)})),t.expansion.zoningB?rt.className="filter-subset active":rt.className="filter-subset",nt.type="checkbox",nt.name="b-zoning-data",nt.id="B1",nt.value="B1",t.app.filters.includes("B1")?nt.checked=!0:nt.checked=!1,nt.addEventListener("change",(function(e){t.updateFilters(e,t)})),ot.innerText="B1 - Zoning",ot.setAttribute("for","B1"),at.className="line B1",ot.appendChild(at),st.appendChild(nt),st.appendChild(ot),rt.appendChild(st),lt.type="checkbox",lt.name="b-zoning-data",lt.id="B2",lt.value="B2",t.app.filters.includes("B2")?lt.checked=!0:lt.checked=!1,lt.addEventListener("change",(function(e){t.updateFilters(e,t)})),ut.innerText="B2 - Zoning",ut.setAttribute("for","B2"),ct.className="line B2",ut.appendChild(ct),ht.appendChild(lt),ht.appendChild(ut),rt.appendChild(ht),pt.type="checkbox",pt.name="b-zoning-data",pt.id="B3",pt.value="B3",t.app.filters.includes("B3")?pt.checked=!0:pt.checked=!1,pt.addEventListener("change",(function(e){t.updateFilters(e,t)})),ft.innerText="B3 - Zoning",ft.setAttribute("for","B3"),dt.className="line B3",ft.appendChild(dt),mt.appendChild(pt),mt.appendChild(ft),rt.appendChild(mt),gt.type="checkbox",gt.name="b-zoning-data",gt.id="B4",gt.value="B4",t.app.filters.includes("B4")?gt.checked=!0:gt.checked=!1,gt.addEventListener("change",(function(e){t.updateFilters(e,t)})),yt.innerText="B4 - Zoning",yt.setAttribute("for","B4"),_t.className="line B4",yt.appendChild(_t),vt.appendChild(gt),vt.appendChild(yt),rt.appendChild(vt),xt.type="checkbox",xt.name="b-zoning-data",xt.id="B5",xt.value="B5",t.app.filters.includes("B5")?xt.checked=!0:xt.checked=!1,xt.addEventListener("change",(function(e){t.updateFilters(e,t)})),wt.innerText="B5 - Zoning",wt.setAttribute("for","B5"),bt.className="line B5",wt.appendChild(bt),St.appendChild(xt),St.appendChild(wt),rt.appendChild(St),Mt.type="checkbox",Mt.name="b-zoning-data",Mt.id="B6",Mt.value="B6",t.app.filters.includes("B6")?Mt.checked=!0:Mt.checked=!1,Mt.addEventListener("change",(function(e){t.updateFilters(e,t)})),Et.innerText="B6 - Zoning",Et.setAttribute("for","B6"),Tt.className="line B6",Et.appendChild(Tt),Ct.appendChild(Mt),Ct.appendChild(Et),rt.appendChild(Ct),Qe.appendChild(et),Qe.appendChild(tt),Qe.appendChild(it),t.form.appendChild(Qe),t.form.appendChild(rt);var At=document.createElement("article"),It=document.createElement("input"),Pt=document.createElement("label"),zt=document.createElement("button"),Rt=document.createElement("article"),kt=document.createElement("input"),Lt=document.createElement("span"),Dt=document.createElement("label"),Bt=document.createElement("div"),Ft=document.createElement("input"),Ot=document.createElement("span"),Nt=document.createElement("label"),Vt=document.createElement("div"),Ut=document.createElement("input"),$t=document.createElement("span"),jt=document.createElement("label"),qt=document.createElement("div"),Gt=document.createElement("input"),Ht=document.createElement("span"),Wt=document.createElement("label"),Zt=document.createElement("div"),Xt=document.createElement("input"),Yt=document.createElement("span"),Kt=document.createElement("label"),Jt=document.createElement("div");At.className="parent-filter-container",It.type="checkbox",It.value="M1,M2,M3,M4,M5",It.id="m-zoning-all",It.name="m-zoning-data",t.app.filters.includes("m-zoning-all")?It.checked=!0:It.checked=!1,It.className="parent-filter",Pt.innerText="Industrial Zoning",Pt.setAttribute("for","m-zoning-all"),zt.type="expand",It.addEventListener("change",(function(e){t.updateFilters(e,t)})),t.expansion.zoningM?zt.innerHTML='<i class="fas fa-minus"></i>':zt.innerHTML='<i class="fas fa-plus"></i>',zt.addEventListener("click",(function(e){t.expansion.zoningM?t.expansion.zoningM=!1:t.expansion.zoningM=!0,t.removeForm(t.container),t.buidlForm(t.container,t)})),t.expansion.zoningM?Rt.className="filter-subset active":Rt.className="filter-subset",kt.type="checkbox",kt.name="m-zoning-data",kt.id="M1",kt.value="M1",t.app.filters.includes("M1")?kt.checked=!0:kt.checked=!1,kt.addEventListener("change",(function(e){t.updateFilters(e,t)})),Dt.innerText="M1 - Zoning",Dt.setAttribute("for","M1"),Lt.className="line M1",Dt.appendChild(Lt),Bt.appendChild(kt),Bt.appendChild(Dt),Rt.appendChild(Bt),Ft.type="checkbox",Ft.name="m-zoning-data",Ft.id="M2",Ft.value="M2",t.app.filters.includes("M2")?Ft.checked=!0:Ft.checked=!1,Ft.addEventListener("change",(function(e){t.updateFilters(e,t)})),Nt.innerText="M2 - Zoning",Nt.setAttribute("for","M2"),Ot.className="line M2",Nt.appendChild(Ot),Vt.appendChild(Ft),Vt.appendChild(Nt),Rt.appendChild(Vt),Ut.type="checkbox",Ut.name="m-zoning-data",Ut.id="M3",Ut.value="M3",t.app.filters.includes("M3")?Ut.checked=!0:Ut.checked=!1,Ut.addEventListener("change",(function(e){t.updateFilters(e,t)})),jt.innerText="M3 - Zoning",jt.setAttribute("for","M3"),$t.className="line M3",jt.appendChild($t),qt.appendChild(Ut),qt.appendChild(jt),Rt.appendChild(qt),Gt.type="checkbox",Gt.name="m-zoning-data",Gt.id="M4",Gt.value="M4",t.app.filters.includes("M4")?Gt.checked=!0:Gt.checked=!1,Gt.addEventListener("change",(function(e){t.updateFilters(e,t)})),Wt.innerText="M4 - Zoning",Wt.setAttribute("for","M4"),Ht.className="line M4",Wt.appendChild(Ht),Zt.appendChild(Gt),Zt.appendChild(Wt),Rt.appendChild(Zt),Xt.type="checkbox",Xt.name="m-zoning-data",Xt.id="M5",Xt.value="M5",t.app.filters.includes("M5")?Xt.checked=!0:Xt.checked=!1,Xt.addEventListener("change",(function(e){t.updateFilters(e,t)})),Kt.innerText="M5 - Zoning",Kt.setAttribute("for","M5"),Yt.className="line M5",Kt.appendChild(Yt),Jt.appendChild(Xt),Jt.appendChild(Kt),Rt.appendChild(Jt),At.appendChild(It),At.appendChild(Pt),At.appendChild(zt),t.form.appendChild(At),t.form.appendChild(Rt);var Qt=document.createElement("article"),ei=document.createElement("input"),ti=document.createElement("label"),ii=document.createElement("button"),ri=document.createElement("article"),ni=document.createElement("input"),ai=document.createElement("span"),oi=document.createElement("label"),si=document.createElement("div"),li=document.createElement("input"),ci=document.createElement("span"),ui=document.createElement("label"),hi=document.createElement("div"),pi=document.createElement("input"),di=document.createElement("span"),fi=document.createElement("label"),mi=document.createElement("div"),gi=document.createElement("input"),_i=document.createElement("span"),yi=document.createElement("label"),vi=document.createElement("div"),xi=document.createElement("input"),bi=document.createElement("span"),wi=document.createElement("label"),Si=document.createElement("div"),Mi=document.createElement("input"),Ti=document.createElement("span"),Ei=document.createElement("label"),Ci=document.createElement("div"),Ai=document.createElement("input"),Ii=document.createElement("span"),Pi=document.createElement("label"),zi=document.createElement("div"),Ri=document.createElement("input"),ki=document.createElement("span"),Li=document.createElement("label"),Di=document.createElement("div"),Bi=document.createElement("input"),Fi=document.createElement("span"),Oi=document.createElement("label"),Ni=document.createElement("div"),Vi=document.createElement("input"),Ui=document.createElement("span"),$i=document.createElement("label"),ji=document.createElement("div"),qi=document.createElement("input"),Gi=document.createElement("span"),Hi=document.createElement("label"),Wi=document.createElement("div"),Zi=document.createElement("input"),Xi=document.createElement("span"),Yi=document.createElement("label"),Ki=document.createElement("div");Qt.className="parent-filter-container",ei.type="checkbox",ei.value="P1,PC,PCA,PD,PR,SD1,SD2,SD3,SD4,SD5,TM,W5",ei.id="s-zoning-all",ei.name="s-zoning-data",t.app.filters.includes("s-zoning-all")?ei.checked=!0:ei.checked=!1,ei.className="parent-filter",ti.innerText="Special Zoning",ti.setAttribute("for","s-zoning-all"),ii.type="expand",ei.addEventListener("change",(function(e){t.updateFilters(e,t)})),t.expansion.zoningS?ii.innerHTML='<i class="fas fa-minus"></i>':ii.innerHTML='<i class="fas fa-plus"></i>',ii.addEventListener("click",(function(e){t.expansion.zoningS?t.expansion.zoningS=!1:t.expansion.zoningS=!0,t.removeForm(t.container),t.buidlForm(t.container,t)})),t.expansion.zoningS?ri.className="filter-subset active":ri.className="filter-subset",ni.type="checkbox",ni.name="s-zoning-data",ni.id="P1",ni.value="P1",t.app.filters.includes("P1")?ni.checked=!0:ni.checked=!1,ni.addEventListener("change",(function(e){t.updateFilters(e,t)})),oi.innerText="P1 - Zoning",oi.setAttribute("for","P1"),ai.className="line P1",oi.appendChild(ai),si.appendChild(ni),si.appendChild(oi),ri.appendChild(si),li.type="checkbox",li.name="s-zoning-data",li.id="PC",li.value="PC",t.app.filters.includes("PC")?li.checked=!0:li.checked=!1,li.addEventListener("change",(function(e){t.updateFilters(e,t)})),ui.innerText="PC - Zoning",ui.setAttribute("for","PC"),ci.className="line PC",ui.appendChild(ci),hi.appendChild(li),hi.appendChild(ui),ri.appendChild(hi),pi.type="checkbox",pi.name="s-zoning-data",pi.id="PCA",pi.value="PCA",t.app.filters.includes("PCA")?pi.checked=!0:pi.checked=!1,pi.addEventListener("change",(function(e){t.updateFilters(e,t)})),fi.innerText="PCA - Zoning",fi.setAttribute("for","PCA"),di.className="line PCA",fi.appendChild(di),mi.appendChild(pi),mi.appendChild(fi),ri.appendChild(mi),gi.type="checkbox",gi.name="s-zoning-data",gi.id="PD",gi.value="PD",t.app.filters.includes("PD")?gi.checked=!0:gi.checked=!1,gi.addEventListener("change",(function(e){t.updateFilters(e,t)})),yi.innerText="PD - Zoning",yi.setAttribute("for","PD"),_i.className="line PD",yi.appendChild(_i),vi.appendChild(gi),vi.appendChild(yi),ri.appendChild(vi),xi.type="checkbox",xi.name="s-zoning-data",xi.id="PR",xi.value="PR",t.app.filters.includes("PR")?xi.checked=!0:xi.checked=!1,xi.addEventListener("change",(function(e){t.updateFilters(e,t)})),wi.innerText="PR - Zoning",wi.setAttribute("for","PR"),bi.className="line PR",wi.appendChild(bi),Si.appendChild(xi),Si.appendChild(wi),ri.appendChild(Si),Mi.type="checkbox",Mi.name="s-zoning-data",Mi.id="SD1",Mi.value="SD1",t.app.filters.includes("SD1")?Mi.checked=!0:Mi.checked=!1,Mi.addEventListener("change",(function(e){t.updateFilters(e,t)})),Ei.innerText="SD1 - Zoning",Ei.setAttribute("for","SD1"),Ti.className="line SD1",Ei.appendChild(Ti),Ci.appendChild(Mi),Ci.appendChild(Ei),ri.appendChild(Ci),Ai.type="checkbox",Ai.name="s-zoning-data",Ai.id="SD2",Ai.value="SD2",t.app.filters.includes("SD2")?Ai.checked=!0:Ai.checked=!1,Ai.addEventListener("change",(function(e){t.updateFilters(e,t)})),Pi.innerText="SD2 - Zoning",Pi.setAttribute("for","SD2"),Ii.className="line SD2",Pi.appendChild(Ii),zi.appendChild(Ai),zi.appendChild(Pi),ri.appendChild(zi),Ri.type="checkbox",Ri.name="s-zoning-data",Ri.id="SD3",Ri.value="SD3",t.app.filters.includes("SD3")?Ri.checked=!0:Ri.checked=!1,Ri.addEventListener("change",(function(e){t.updateFilters(e,t)})),Li.innerText="SD3 - Zoning",Li.setAttribute("for","SD3"),ki.className="line SD3",Li.appendChild(ki),Di.appendChild(Ri),Di.appendChild(Li),ri.appendChild(Di),Bi.type="checkbox",Bi.name="s-zoning-data",Bi.id="SD4",Bi.value="SD4",t.app.filters.includes("SD4")?Bi.checked=!0:Bi.checked=!1,Bi.addEventListener("change",(function(e){t.updateFilters(e,t)})),Oi.innerText="SD4 - Zoning",Oi.setAttribute("for","SD4"),Fi.className="line SD4",Oi.appendChild(Fi),Ni.appendChild(Bi),Ni.appendChild(Oi),ri.appendChild(Ni),Vi.type="checkbox",Vi.name="s-zoning-data",Vi.id="SD5",Vi.value="SD5",t.app.filters.includes("SD5")?Vi.checked=!0:Vi.checked=!1,Vi.addEventListener("change",(function(e){t.updateFilters(e,t)})),$i.innerText="SD5 - Zoning",$i.setAttribute("for","SD5"),Ui.className="line SD5",$i.appendChild(Ui),ji.appendChild(Vi),ji.appendChild($i),ri.appendChild(ji),qi.type="checkbox",qi.name="s-zoning-data",qi.id="TM",qi.value="TM",t.app.filters.includes("TM")?qi.checked=!0:qi.checked=!1,qi.addEventListener("change",(function(e){t.updateFilters(e,t)})),Hi.innerText="TM - Zoning",Hi.setAttribute("for","TM"),Gi.className="line TM",Hi.appendChild(Gi),Wi.appendChild(qi),Wi.appendChild(Hi),ri.appendChild(Wi),Zi.type="checkbox",Zi.name="s-zoning-data",Zi.id="W5",Zi.value="W5",t.app.filters.includes("W5")?Zi.checked=!0:Zi.checked=!1,Zi.addEventListener("change",(function(e){t.updateFilters(e,t)})),Yi.innerText="W5 - Zoning",Yi.setAttribute("for","W5"),Xi.className="line W5",Yi.appendChild(Xi),Ki.appendChild(Zi),Ki.appendChild(Yi),ri.appendChild(Ki),Qt.appendChild(ei),Qt.appendChild(ti),Qt.appendChild(ii),t.form.appendChild(Qt),t.form.appendChild(ri),t.form.addEventListener("submit",(function(e){e.preventDefault(),console.log(e)})),e.appendChild(t.form)}}]),e}(),w=function(e,t){return w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},w(e,t)};function S(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}w(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}function M(e,t,i,r){return new(i||(i=Promise))((function(n,a){function o(e){try{l(r.next(e))}catch(t){a(t)}}function s(e){try{l(r.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,s)}l((r=r.apply(e,t||[])).next())}))}function T(e,t){var i,r,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,r&&(n=2&a[0]?r.return:a[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,a[1])).done)return n;switch(r=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(s){a=[6,s],r=0}finally{i=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function E(e){var t="function"===typeof Symbol&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function C(e,t){var i="function"===typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,n,a=i.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)o.push(r.value)}catch(s){n={error:s}}finally{try{r&&!r.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return o}function A(e,t){for(var i=0,r=t.length,n=e.length;i<r;i++,n++)e[n]=t[i];return e}function I(e){return this instanceof I?(this.v=e,this):new I(e)}function P(e,t,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,n=i.apply(e,t||[]),a=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(e){n[e]&&(r[e]=function(t){return new Promise((function(i,r){a.push([e,t,i,r])>1||s(e,t)}))})}function s(e,t){try{(i=n[e](t)).value instanceof I?Promise.resolve(i.value.v).then(l,c):u(a[0][2],i)}catch(r){u(a[0][3],r)}var i}function l(e){s("next",e)}function c(e){s("throw",e)}function u(e,t){e(t),a.shift(),a.length&&s(a[0][0],a[0][1])}}function z(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,i=e[Symbol.asyncIterator];return i?i.call(e):(e=E(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(i){t[i]=e[i]&&function(t){return new Promise((function(r,n){(function(e,t,i,r){Promise.resolve(r).then((function(t){e({value:t,done:i})}),t)})(r,n,(t=e[i](t)).done,t.value)}))}}}function R(e){return"function"===typeof e}function k(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var L=k((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function D(e,t){if(e){var i=e.indexOf(t);0<=i&&e.splice(i,1)}}var B=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._teardowns=null}return e.prototype.unsubscribe=function(){var e,t,i,r,n;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var o=E(a),s=o.next();!s.done;s=o.next()){s.value.remove(this)}}catch(d){e={error:d}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}else a.remove(this);var l=this.initialTeardown;if(R(l))try{l()}catch(f){n=f instanceof L?f.errors:[f]}var c=this._teardowns;if(c){this._teardowns=null;try{for(var u=E(c),h=u.next();!h.done;h=u.next()){var p=h.value;try{N(p)}catch(Ix){n=null!==n&&void 0!==n?n:[],Ix instanceof L?n=A(A([],C(n)),C(Ix.errors)):n.push(Ix)}}}catch(m){i={error:m}}finally{try{h&&!h.done&&(r=u.return)&&r.call(u)}finally{if(i)throw i.error}}}if(n)throw new L(n)}},e.prototype.add=function(t){var i;if(t&&t!==this)if(this.closed)N(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._teardowns=null!==(i=this._teardowns)&&void 0!==i?i:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&D(t,e)},e.prototype.remove=function(t){var i=this._teardowns;i&&D(i,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}(),F=B.EMPTY;function O(e){return e instanceof B||e&&"closed"in e&&R(e.remove)&&R(e.add)&&R(e.unsubscribe)}function N(e){R(e)?e():e.unsubscribe()}var V={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},U={setTimeout:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=U.delegate;return((null===i||void 0===i?void 0:i.setTimeout)||setTimeout).apply(void 0,A([],C(e)))},clearTimeout:function(e){var t=U.delegate;return((null===t||void 0===t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function $(e){U.setTimeout((function(){throw e}))}function j(){}var q=G("C",void 0,void 0);function G(e,t,i){return{kind:e,value:t,error:i}}var H=null;function W(e){if(V.useDeprecatedSynchronousErrorHandling){var t=!H;if(t&&(H={errorThrown:!1,error:null}),e(),t){var i=H,r=i.errorThrown,n=i.error;if(H=null,r)throw n}}else e()}var Z=function(e){function t(t){var i=e.call(this)||this;return i.isStopped=!1,t?(i.destination=t,O(t)&&t.add(i)):i.destination=Q,i}return S(t,e),t.create=function(e,t,i){return new X(e,t,i)},t.prototype.next=function(e){this.isStopped?J(function(e){return G("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?J(G("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?J(q,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(B),X=function(e){function t(t,i,r){var n,a=e.call(this)||this;if(R(t))n=t;else if(t){var o;n=t.next,i=t.error,r=t.complete,a&&V.useDeprecatedNextContext?(o=Object.create(t)).unsubscribe=function(){return a.unsubscribe()}:o=t,n=null===n||void 0===n?void 0:n.bind(o),i=null===i||void 0===i?void 0:i.bind(o),r=null===r||void 0===r?void 0:r.bind(o)}return a.destination={next:n?Y(n):j,error:Y(null!==i&&void 0!==i?i:K),complete:r?Y(r):j},a}return S(t,e),t}(Z);function Y(e,t){return function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];try{e.apply(void 0,A([],C(t)))}catch(Ix){$(Ix)}}}function K(e){throw e}function J(e,t){var i=V.onStoppedNotification;i&&U.setTimeout((function(){return i(e,t)}))}var Q={closed:!0,next:j,error:K,complete:j},ee="function"===typeof Symbol&&Symbol.observable||"@@observable";function te(e){return e}function ie(e){return 0===e.length?te:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var re=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var i=new e;return i.source=this,i.operator=t,i},e.prototype.subscribe=function(e,t,i){var r,n=this,a=(r=e)&&r instanceof Z||function(e){return e&&R(e.next)&&R(e.error)&&R(e.complete)}(r)&&O(r)?e:new X(e,t,i);return W((function(){var e=n,t=e.operator,i=e.source;a.add(t?t.call(a,i):i?n._subscribe(a):n._trySubscribe(a))})),a},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(Ix){e.error(Ix)}},e.prototype.forEach=function(e,t){var i=this;return new(t=ne(t))((function(t,r){var n;n=i.subscribe((function(t){try{e(t)}catch(Ix){r(Ix),null===n||void 0===n||n.unsubscribe()}}),r,t)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[ee]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return ie(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=ne(e))((function(e,i){var r;t.subscribe((function(e){return r=e}),(function(e){return i(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function ne(e){var t;return null!==(t=null!==e&&void 0!==e?e:V.Promise)&&void 0!==t?t:Promise}function ae(e){return R(null===e||void 0===e?void 0:e.lift)}function oe(e){return function(t){if(ae(t))return t.lift((function(t){try{return e(t,this)}catch(Ix){this.error(Ix)}}));throw new TypeError("Unable to lift unknown Observable type")}}var se=function(e){function t(t,i,r,n,a){var o=e.call(this,t)||this;return o.onFinalize=a,o._next=i?function(e){try{i(e)}catch(Ix){t.error(Ix)}}:e.prototype._next,o._error=n?function(e){try{n(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,o._complete=r?function(){try{r()}catch(Ix){t.error(Ix)}finally{this.unsubscribe()}}:e.prototype._complete,o}return S(t,e),t.prototype.unsubscribe=function(){var t,i=this.closed;e.prototype.unsubscribe.call(this),!i&&(null===(t=this.onFinalize)||void 0===t||t.call(this))},t}(Z);function le(){return oe((function(e,t){var i=null;e._refCount++;var r=new se(t,void 0,void 0,void 0,(function(){if(!e||e._refCount<=0||0<--e._refCount)i=null;else{var r=e._connection,n=i;i=null,!r||n&&r!==n||r.unsubscribe(),t.unsubscribe()}}));e.subscribe(r),r.closed||(i=e.connect())}))}var ce=function(e){function t(t,i){var r=e.call(this)||this;return r.source=t,r.subjectFactory=i,r._subject=null,r._refCount=0,r._connection=null,ae(t)&&(r.lift=t.lift),r}return S(t,e),t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype._teardown=function(){this._refCount=0;var e=this._connection;this._subject=this._connection=null,null===e||void 0===e||e.unsubscribe()},t.prototype.connect=function(){var e=this,t=this._connection;if(!t){t=this._connection=new B;var i=this.getSubject();t.add(this.source.subscribe(new se(i,void 0,(function(){e._teardown(),i.complete()}),(function(t){e._teardown(),i.error(t)}),(function(){return e._teardown()})))),t.closed&&(this._connection=null,t=B.EMPTY)}return t},t.prototype.refCount=function(){return le()(this)},t}(re),ue=k((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),he=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return S(t,e),t.prototype.lift=function(e){var t=new pe(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new ue},t.prototype.next=function(e){var t=this;W((function(){var i,r;if(t._throwIfClosed(),!t.isStopped){var n=t.observers.slice();try{for(var a=E(n),o=a.next();!o.done;o=a.next()){o.value.next(e)}}catch(s){i={error:s}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}}}))},t.prototype.error=function(e){var t=this;W((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var i=t.observers;i.length;)i.shift().error(e)}}))},t.prototype.complete=function(){var e=this;W((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,i=t.hasError,r=t.isStopped,n=t.observers;return i||r?F:(n.push(e),new B((function(){return D(n,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,i=t.hasError,r=t.thrownError,n=t.isStopped;i?e.error(r):n&&e.complete()},t.prototype.asObservable=function(){var e=new re;return e.source=this,e},t.create=function(e,t){return new pe(e,t)},t}(re),pe=function(e){function t(t,i){var r=e.call(this)||this;return r.destination=t,r.source=i,r}return S(t,e),t.prototype.next=function(e){var t,i;null===(i=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===i||i.call(t,e)},t.prototype.error=function(e){var t,i;null===(i=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===i||i.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,i;return null!==(i=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==i?i:F},t}(he),de=function(e){function t(t){var i=e.call(this)||this;return i._value=t,i}return S(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var i=e.prototype._subscribe.call(this,t);return!i.closed&&t.next(this._value),i},t.prototype.getValue=function(){var e=this,t=e.hasError,i=e.thrownError,r=e._value;if(t)throw i;return this._throwIfClosed(),r},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(he),fe={now:function(){return(fe.delegate||Date).now()},delegate:void 0},me=function(e){function t(t,i,r){void 0===t&&(t=1/0),void 0===i&&(i=1/0),void 0===r&&(r=fe);var n=e.call(this)||this;return n._bufferSize=t,n._windowTime=i,n._timestampProvider=r,n._buffer=[],n._infiniteTimeWindow=!0,n._infiniteTimeWindow=i===1/0,n._bufferSize=Math.max(1,t),n._windowTime=Math.max(1,i),n}return S(t,e),t.prototype.next=function(t){var i=this,r=i.isStopped,n=i._buffer,a=i._infiniteTimeWindow,o=i._timestampProvider,s=i._windowTime;r||(n.push(t),!a&&n.push(o.now()+s)),this._trimBuffer(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),i=this._infiniteTimeWindow,r=this._buffer.slice(),n=0;n<r.length&&!e.closed;n+=i?1:2)e.next(r[n]);return this._checkFinalizedStatuses(e),t},t.prototype._trimBuffer=function(){var e=this,t=e._bufferSize,i=e._timestampProvider,r=e._buffer,n=e._infiniteTimeWindow,a=(n?1:2)*t;if(t<1/0&&a<r.length&&r.splice(0,r.length-a),!n){for(var o=i.now(),s=0,l=1;l<r.length&&r[l]<=o;l+=2)s=l;s&&r.splice(0,s+1)}},t}(he),ge=function(e){function t(t,i){return e.call(this)||this}return S(t,e),t.prototype.schedule=function(e,t){return this},t}(B),_e={setInterval:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=_e.delegate;return((null===i||void 0===i?void 0:i.setInterval)||setInterval).apply(void 0,A([],C(e)))},clearInterval:function(e){var t=_e.delegate;return((null===t||void 0===t?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0},ye=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.scheduler=t,r.work=i,r.pending=!1,r}return S(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var i=this.id,r=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(r,i,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(r,this.id,t),this},t.prototype.requestAsyncId=function(e,t,i){return void 0===i&&(i=0),_e.setInterval(e.flush.bind(e,this),i)},t.prototype.recycleAsyncId=function(e,t,i){if(void 0===i&&(i=0),null!=i&&this.delay===i&&!1===this.pending)return t;_e.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(e,t);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var i,r=!1;try{this.work(e)}catch(n){r=!0,i=!!n&&n||new Error(n)}if(r)return this.unsubscribe(),i},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,i=this.scheduler,r=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,D(r,this),null!=t&&(this.id=this.recycleAsyncId(i,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(ge),ve=function(){function e(t,i){void 0===i&&(i=e.now),this.schedulerActionCtor=t,this.now=i}return e.prototype.schedule=function(e,t,i){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(i,t)},e.now=fe.now,e}(),xe=function(e){function t(t,i){void 0===i&&(i=ve.now);var r=e.call(this,t,i)||this;return r.actions=[],r._active=!1,r._scheduled=void 0,r}return S(t,e),t.prototype.flush=function(e){var t=this.actions;if(this._active)t.push(e);else{var i;this._active=!0;do{if(i=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,i){for(;e=t.shift();)e.unsubscribe();throw i}}},t}(ve),be=new xe(ye),we=be,Se=new re((function(e){return e.complete()}));function Me(e){return e?function(e){return new re((function(t){return e.schedule((function(){return t.complete()}))}))}(e):Se}function Te(e,t){return new re((function(i){var r=0;return t.schedule((function(){r===e.length?i.complete():(i.next(e[r++]),i.closed||this.schedule())}))}))}var Ee=function(e){return e&&"number"===typeof e.length&&"function"!==typeof e};function Ce(e){return R(null===e||void 0===e?void 0:e.then)}var Ae="function"===typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function Ie(e,t,i,r){void 0===r&&(r=0);var n=t.schedule((function(){try{i.call(this)}catch(Ix){e.error(Ix)}}),r);return e.add(n),n}function Pe(e,t){if(!e)throw new Error("Iterable cannot be null");return new re((function(i){var r=new B;return r.add(t.schedule((function(){var n=e[Symbol.asyncIterator]();r.add(t.schedule((function(){var e=this;n.next().then((function(t){t.done?i.complete():(i.next(t.value),e.schedule())}))})))}))),r}))}function ze(e){return R(e[ee])}function Re(e){return R(null===e||void 0===e?void 0:e[Ae])}function ke(e){return Symbol.asyncIterator&&R(null===e||void 0===e?void 0:e[Symbol.asyncIterator])}function Le(e){return new TypeError("You provided "+(null!==e&&"object"===typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function De(e){return P(this,arguments,(function(){var t,i,r;return T(this,(function(n){switch(n.label){case 0:t=e.getReader(),n.label=1;case 1:n.trys.push([1,,9,10]),n.label=2;case 2:return[4,I(t.read())];case 3:return i=n.sent(),r=i.value,i.done?[4,I(void 0)]:[3,5];case 4:return[2,n.sent()];case 5:return[4,I(r)];case 6:return[4,n.sent()];case 7:return n.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function Be(e){return R(null===e||void 0===e?void 0:e.getReader)}function Fe(e,t){if(null!=e){if(ze(e))return function(e,t){return new re((function(i){var r=new B;return r.add(t.schedule((function(){var n=e[ee]();r.add(n.subscribe({next:function(e){r.add(t.schedule((function(){return i.next(e)})))},error:function(e){r.add(t.schedule((function(){return i.error(e)})))},complete:function(){r.add(t.schedule((function(){return i.complete()})))}}))}))),r}))}(e,t);if(Ee(e))return Te(e,t);if(Ce(e))return function(e,t){return new re((function(i){return t.schedule((function(){return e.then((function(e){i.add(t.schedule((function(){i.next(e),i.add(t.schedule((function(){return i.complete()})))})))}),(function(e){i.add(t.schedule((function(){return i.error(e)})))}))}))}))}(e,t);if(ke(e))return Pe(e,t);if(Re(e))return function(e,t){return new re((function(i){var r;return i.add(t.schedule((function(){r=e[Ae](),Ie(i,t,(function(){var e=r.next(),t=e.value;e.done?i.complete():(i.next(t),this.schedule())}))}))),function(){return R(null===r||void 0===r?void 0:r.return)&&r.return()}}))}(e,t);if(Be(e))return function(e,t){return Pe(De(e),t)}(e,t)}throw Le(e)}function Oe(e,t){return t?Fe(e,t):Ne(e)}function Ne(e){if(e instanceof re)return e;if(null!=e){if(ze(e))return r=e,new re((function(e){var t=r[ee]();if(R(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(Ee(e))return Ve(e);if(Ce(e))return i=e,new re((function(e){i.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,$)}));if(ke(e))return Ue(e);if(Re(e))return t=e,new re((function(e){var i,r;try{for(var n=E(t),a=n.next();!a.done;a=n.next()){var o=a.value;if(e.next(o),e.closed)return}}catch(s){i={error:s}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}e.complete()}));if(Be(e))return Ue(De(e))}var t,i,r;throw Le(e)}function Ve(e){return new re((function(t){for(var i=0;i<e.length&&!t.closed;i++)t.next(e[i]);t.complete()}))}function Ue(e){return new re((function(t){(function(e,t){var i,r,n,a;return M(this,void 0,void 0,(function(){var o,s;return T(this,(function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),i=z(e),l.label=1;case 1:return[4,i.next()];case 2:if((r=l.sent()).done)return[3,4];if(o=r.value,t.next(o),t.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=l.sent(),n={error:s},[3,11];case 6:return l.trys.push([6,,9,10]),r&&!r.done&&(a=i.return)?[4,a.call(i)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(n)throw n.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}function $e(e,t){return t?Te(e,t):Ve(e)}function je(e){return e&&R(e.schedule)}function qe(e){return e[e.length-1]}function Ge(e){return R(qe(e))?e.pop():void 0}function He(e){return je(qe(e))?e.pop():void 0}function We(e,t){return"number"===typeof qe(e)?e.pop():t}function Ze(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=He(e);return i?Te(e,i):$e(e)}function Xe(e,t){var i=R(e)?e:function(){return e},r=function(e){return e.error(i())};return new re(t?function(e){return t.schedule(r,0,e)}:r)}var Ye=k((function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}}));function Ke(e){return e instanceof Date&&!isNaN(e)}var Je=k((function(e){return function(t){void 0===t&&(t=null),e(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}}));function Qe(e,t){var i=Ke(e)?{first:e}:"number"===typeof e?{each:e}:e,r=i.first,n=i.each,a=i.with,o=void 0===a?et:a,s=i.scheduler,l=void 0===s?null!==t&&void 0!==t?t:be:s,c=i.meta,u=void 0===c?null:c;if(null==r&&null==n)throw new TypeError("No timeout provided.");return oe((function(e,t){var i,a,s=null,c=0,h=function(e){a=Ie(t,l,(function(){i.unsubscribe(),Ne(o({meta:u,lastValue:s,seen:c})).subscribe(t)}),e)};i=e.subscribe(new se(t,(function(e){null===a||void 0===a||a.unsubscribe(),c++,t.next(s=e),n>0&&h(n)}),void 0,void 0,(function(){(null===a||void 0===a?void 0:a.closed)||null===a||void 0===a||a.unsubscribe(),s=null}))),h(null!=r?"number"===typeof r?r:+r-l.now():n)}))}function et(e){throw new Je(e)}function tt(e,t){return oe((function(i,r){var n=0;i.subscribe(new se(r,(function(i){r.next(e.call(t,i,n++))})))}))}var it=Array.isArray;function rt(e){return tt((function(t){return function(e,t){return it(t)?e.apply(void 0,A([],C(t))):e(t)}(e,t)}))}var nt=Array.isArray,at=Object.getPrototypeOf,ot=Object.prototype,st=Object.keys;function lt(e){if(1===e.length){var t=e[0];if(nt(t))return{args:t,keys:null};if((r=t)&&"object"===typeof r&&at(r)===ot){var i=st(t);return{args:i.map((function(e){return t[e]})),keys:i}}}var r;return{args:e,keys:null}}function ct(e,t){return e.reduce((function(e,i,r){return e[i]=t[r],e}),{})}function ut(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=He(e),r=Ge(e),n=lt(e),a=n.args,o=n.keys;if(0===a.length)return Oe([],i);var s=new re(ht(a,i,o?function(e){return ct(o,e)}:te));return r?s.pipe(rt(r)):s}function ht(e,t,i){return void 0===i&&(i=te),function(r){pt(t,(function(){for(var n=e.length,a=new Array(n),o=n,s=n,l=function(n){pt(t,(function(){var l=Oe(e[n],t),c=!1;l.subscribe(new se(r,(function(e){a[n]=e,c||(c=!0,s--),s||r.next(i(a.slice()))}),(function(){--o||r.complete()})))}),r)},c=0;c<n;c++)l(c)}),r)}}function pt(e,t,i){e?i.add(e.schedule(t)):t()}function dt(e,t,i,r,n,a,o,s){var l=[],c=0,u=0,h=!1,p=function(){!h||l.length||c||t.complete()},d=function(e){return c<r?f(e):l.push(e)},f=function(e){a&&t.next(e),c++;var s=!1;Ne(i(e,u++)).subscribe(new se(t,(function(e){null===n||void 0===n||n(e),a?d(e):t.next(e)}),(function(){s=!0}),void 0,(function(){if(s)try{c--;for(var e=function(){var e=l.shift();o?t.add(o.schedule((function(){return f(e)}))):f(e)};l.length&&c<r;)e();p()}catch(Ix){t.error(Ix)}})))};return e.subscribe(new se(t,d,(function(){h=!0,p()}))),function(){null===s||void 0===s||s()}}function ft(e,t,i){return void 0===i&&(i=1/0),R(t)?ft((function(i,r){return tt((function(e,n){return t(i,e,r,n)}))(Ne(e(i,r)))}),i):("number"===typeof t&&(i=t),oe((function(t,r){return dt(t,r,e,i)})))}function mt(e){return void 0===e&&(e=1/0),ft(te,e)}function gt(){return mt(1)}function _t(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return gt()($e(e,He(e)))}var yt=["addListener","removeListener"],vt=["addEventListener","removeEventListener"],xt=["on","off"];function bt(e,t,i,r){if(R(i)&&(r=i,i=void 0),r)return bt(e,t,i).pipe(rt(r));var n=C(function(e){return R(e.addEventListener)&&R(e.removeEventListener)}(e)?vt.map((function(r){return function(n){return e[r](t,n,i)}})):function(e){return R(e.addListener)&&R(e.removeListener)}(e)?yt.map(wt(e,t)):function(e){return R(e.on)&&R(e.off)}(e)?xt.map(wt(e,t)):[],2),a=n[0],o=n[1];if(!a&&Ee(e))return ft((function(e){return bt(e,t,i)}))($e(e));if(!a)throw new TypeError("Invalid event target");return new re((function(e){var t=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return e.next(1<t.length?t:t[0])};return a(t),function(){return o(t)}}))}function wt(e,t){return function(i){return function(r){return e[i](t,r)}}}function St(e,t,i){void 0===e&&(e=0),void 0===i&&(i=we);var r=-1;return null!=t&&(je(t)?i=t:r=t),new re((function(t){var n=Ke(e)?+e-i.now():e;n<0&&(n=0);var a=0;return i.schedule((function(){t.closed||(t.next(a++),0<=r?this.schedule(void 0,r):t.complete())}),n)}))}function Mt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=He(e),r=We(e,1/0),n=e;return n.length?1===n.length?Ne(n[0]):mt(r)($e(n,i)):Se}var Tt=Array.isArray;function Et(e){return 1===e.length&&Tt(e[0])?e[0]:e}function Ct(e,t){return oe((function(i,r){var n=0;i.subscribe(new se(r,(function(i){return e.call(t,i,n++)&&r.next(i)})))}))}function At(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=Ge(e),r=Et(e);return r.length?new re((function(e){var t=r.map((function(){return[]})),n=r.map((function(){return!1}));e.add((function(){t=n=null}));for(var a=function(a){Ne(r[a]).subscribe(new se(e,(function(r){if(t[a].push(r),t.every((function(e){return e.length}))){var o=t.map((function(e){return e.shift()}));e.next(i?i.apply(void 0,A([],C(o))):o),t.some((function(e,t){return!e.length&&n[t]}))&&e.complete()}}),(function(){n[a]=!0,!t[a].length&&e.complete()})))},o=0;!e.closed&&o<r.length;o++)a(o);return function(){t=n=null}})):Se}function It(e,t){return void 0===t&&(t=we),i=function(){return St(e,t)},oe((function(e,t){var r=!1,n=null,a=null,o=!1,s=function(){if(null===a||void 0===a||a.unsubscribe(),a=null,r){r=!1;var e=n;n=null,t.next(e)}o&&t.complete()},l=function(){a=null,o&&t.complete()};e.subscribe(new se(t,(function(e){r=!0,n=e,a||Ne(i(e)).subscribe(a=new se(t,s,l))}),(function(){o=!0,(!r||!a||a.closed)&&t.complete()})))}));var i}function Pt(e,t){return void 0===t&&(t=null),t=null!==t&&void 0!==t?t:e,oe((function(i,r){var n=[],a=0;i.subscribe(new se(r,(function(i){var o,s,l,c,u=null;a++%t===0&&n.push([]);try{for(var h=E(n),p=h.next();!p.done;p=h.next()){(m=p.value).push(i),e<=m.length&&(u=null!==u&&void 0!==u?u:[]).push(m)}}catch(g){o={error:g}}finally{try{p&&!p.done&&(s=h.return)&&s.call(h)}finally{if(o)throw o.error}}if(u)try{for(var d=E(u),f=d.next();!f.done;f=d.next()){var m=f.value;D(n,m),r.next(m)}}catch(_){l={error:_}}finally{try{f&&!f.done&&(c=d.return)&&c.call(d)}finally{if(l)throw l.error}}}),(function(){var e,t;try{for(var i=E(n),a=i.next();!a.done;a=i.next()){var o=a.value;r.next(o)}}catch(s){e={error:s}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}r.complete()}),void 0,(function(){n=null})))}))}function zt(e){return oe((function(t,i){var r,n=null,a=!1;n=t.subscribe(new se(i,void 0,void 0,(function(o){r=Ne(e(o,zt(e)(t))),n?(n.unsubscribe(),n=null,r.subscribe(i)):a=!0}))),a&&(n.unsubscribe(),n=null,r.subscribe(i))}))}function Rt(e,t,i,r,n){return function(a,o){var s=i,l=t,c=0;a.subscribe(new se(o,(function(t){var i=c++;l=s?e(l,t,i):(s=!0,t),r&&o.next(l)}),n&&function(){s&&o.next(l),o.complete()}))}}function kt(e,t){return oe(Rt(e,t,arguments.length>=2,!1,!0))}function Lt(e,t){return R(t)?ft(e,t,1):ft(e,1)}var Dt={connector:function(){return new he}};function Bt(e,t){void 0===t&&(t=Dt);var i=t.connector;return oe((function(t,r){var n,a=i();Oe(e((n=a,new re((function(e){return n.subscribe(e)}))))).subscribe(r),r.add(t.subscribe(a))}))}function Ft(e,t){return void 0===t&&(t=be),oe((function(i,r){var n=null,a=null,o=null,s=function(){if(n){n.unsubscribe(),n=null;var e=a;a=null,r.next(e)}};function l(){var i=o+e,a=t.now();if(a<i)return n=this.schedule(void 0,i-a),void r.add(n);s()}i.subscribe(new se(r,(function(i){a=i,o=t.now(),n||(n=t.schedule(l,e),r.add(n))}),(function(){s(),r.complete()}),void 0,(function(){a=n=null})))}))}function Ot(e){return oe((function(t,i){var r=!1;t.subscribe(new se(i,(function(e){r=!0,i.next(e)}),(function(){r||i.next(e),i.complete()})))}))}function Nt(e){return e<=0?function(){return Se}:oe((function(t,i){var r=0;t.subscribe(new se(i,(function(t){++r<=e&&(i.next(t),e<=r&&i.complete())})))}))}function Vt(e,t){return void 0===t&&(t=te),e=null!==e&&void 0!==e?e:Ut,oe((function(i,r){var n,a=!0;i.subscribe(new se(r,(function(i){var o=t(i);!a&&e(n,o)||(a=!1,n=o,r.next(i))})))}))}function Ut(e,t){return e===t}function $t(e){return void 0===e&&(e=jt),oe((function(t,i){var r=!1;t.subscribe(new se(i,(function(e){r=!0,i.next(e)}),(function(){return r?i.complete():i.error(e())})))}))}function jt(){return new Ye}function qt(e,t,i){return void 0===t&&(t=1/0),t=(t||0)<1?1/0:t,oe((function(r,n){return dt(r,n,e,t,void 0,!0,i)}))}function Gt(e){return oe((function(t,i){try{t.subscribe(i)}finally{i.add(e)}}))}function Ht(e,t){var i=arguments.length>=2;return function(r){return r.pipe(e?Ct((function(t,i){return e(t,i,r)})):te,Nt(1),i?Ot(t):$t((function(){return new Ye})))}}function Wt(e){return e<=0?function(){return Se}:oe((function(t,i){var r=[];t.subscribe(new se(i,(function(t){r.push(t),e<r.length&&r.shift()}),(function(){var e,t;try{for(var n=E(r),a=n.next();!a.done;a=n.next()){var o=a.value;i.next(o)}}catch(s){e={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}i.complete()}),void 0,(function(){r=null})))}))}function Zt(e,t){var i=arguments.length>=2;return function(r){return r.pipe(e?Ct((function(t,i){return e(t,i,r)})):te,Wt(1),i?Ot(t):$t((function(){return new Ye})))}}function Xt(e,t){var i=R(e)?e:function(){return e};return R(t)?Bt(t,{connector:i}):function(e){return new ce(e,i)}}function Yt(){return oe((function(e,t){var i,r=!1;e.subscribe(new se(t,(function(e){var n=i;i=e,r&&t.next([n,e]),r=!0})))}))}function Kt(e){return e?function(t){return Bt(e)(t)}:function(e){return Xt(new he)(e)}}function Jt(e,t,i,r){i&&!R(i)&&(r=i);var n=R(i)?i:void 0;return function(i){return Xt(new me(e,t,r),n)(i)}}function Qt(e){var t;void 0===e&&(e=1/0);var i=(t=e&&"object"===typeof e?e:{count:e}).count,r=void 0===i?1/0:i,n=t.delay,a=t.resetOnSuccess,o=void 0!==a&&a;return r<=0?te:oe((function(e,t){var i,a=0,s=function(){var l=!1;i=e.subscribe(new se(t,(function(e){o&&(a=0),t.next(e)}),void 0,(function(e){if(a++<r){var o=function(){i?(i.unsubscribe(),i=null,s()):l=!0};if(null!=n){var c="number"===typeof n?St(n):Ne(n(e,a)),u=new se(t,(function(){u.unsubscribe(),o()}),(function(){t.complete()}));c.subscribe(u)}else o()}else t.error(e)}))),l&&(i.unsubscribe(),i=null,s())};s()}))}function ei(e,t){return oe(Rt(e,t,arguments.length>=2,!0))}function ti(e){void 0===e&&(e={});var t=e.connector,i=void 0===t?function(){return new he}:t,r=e.resetOnError,n=void 0===r||r,a=e.resetOnComplete,o=void 0===a||a,s=e.resetOnRefCountZero,l=void 0===s||s;return function(e){var t=null,r=null,a=null,s=0,c=!1,u=!1,h=function(){null===r||void 0===r||r.unsubscribe(),r=null},p=function(){h(),t=a=null,c=u=!1},d=function(){var e=t;p(),null===e||void 0===e||e.unsubscribe()};return oe((function(e,f){s++,u||c||h();var m=a=null!==a&&void 0!==a?a:i();f.add((function(){0!==--s||u||c||(r=ii(d,l))})),m.subscribe(f),t||(t=new X({next:function(e){return m.next(e)},error:function(e){u=!0,h(),r=ii(p,n,e),m.error(e)},complete:function(){c=!0,h(),r=ii(p,o),m.complete()}}),Oe(e).subscribe(t))}))(e)}}function ii(e,t){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];return!0===t?(e(),null):!1===t?null:t.apply(void 0,A([],C(i))).pipe(Nt(1)).subscribe((function(){return e()}))}function ri(e){return Ct((function(t,i){return e<=i}))}function ni(e){return oe((function(t,i){var r=!1,n=0;t.subscribe(new se(i,(function(t){return(r||(r=!e(t,n++)))&&i.next(t)})))}))}function ai(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=He(e);return oe((function(t,r){(i?_t(e,t,i):_t(e,t)).subscribe(r)}))}function oi(e,t){return oe((function(i,r){var n=null,a=0,o=!1,s=function(){return o&&!n&&r.complete()};i.subscribe(new se(r,(function(i){null===n||void 0===n||n.unsubscribe();var o=0,l=a++;Ne(e(i,l)).subscribe(n=new se(r,(function(e){return r.next(t?t(i,e,l,o++):e)}),(function(){n=null,s()})))}),(function(){o=!0,s()})))}))}function si(e){return oe((function(t,i){Ne(e).subscribe(new se(i,(function(){return i.complete()}),j)),!i.closed&&t.subscribe(i)}))}function li(e,t){return void 0===t&&(t=!1),oe((function(i,r){var n=0;i.subscribe(new se(r,(function(i){var a=e(i,n++);(a||t)&&r.next(i),!a&&r.complete()})))}))}function ci(e,t,i){var r=R(e)||t||i?{next:e,error:t,complete:i}:e;return r?oe((function(e,t){var i;null===(i=r.subscribe)||void 0===i||i.call(r);var n=!0;e.subscribe(new se(t,(function(e){var i;null===(i=r.next)||void 0===i||i.call(r,e),t.next(e)}),(function(){var e;n=!1,null===(e=r.complete)||void 0===e||e.call(r),t.complete()}),(function(e){var i;n=!1,null===(i=r.error)||void 0===i||i.call(r,e),t.error(e)}),(function(){var e,t;n&&(null===(e=r.unsubscribe)||void 0===e||e.call(r)),null===(t=r.finalize)||void 0===t||t.call(r)})))})):te}function ui(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=Ge(e);return oe((function(t,r){for(var n=e.length,a=new Array(n),o=e.map((function(){return!1})),s=!1,l=function(t){Ne(e[t]).subscribe(new se(r,(function(e){a[t]=e,s||o[t]||(o[t]=!0,(s=o.every(te))&&(o=null))}),j))},c=0;c<n;c++)l(c);t.subscribe(new se(r,(function(e){if(s){var t=A([e],C(a));r.next(i?i.apply(void 0,A([],C(t))):t)}})))}))}class hi{createFilter(e){return new Function("node","return "+this._compile(e)+";")}_compile(e){if(null==e||e.length<=1)return"true";const t=e[0];return"("+("=="===t?this._compileComparisonOp("===",e[1],e[2],!1):"!="===t?this._compileComparisonOp("!==",e[1],e[2],!1):">"===t||">="===t||"<"===t||"<="===t?this._compileComparisonOp(t,e[1],e[2],!0):"in"===t?this._compileInOp(e[1],e.slice(2)):"!in"===t?this._compileNegation(this._compileInOp(e[1],e.slice(2))):"all"===t?this._compileLogicalOp(e.slice(1),"&&"):"true")+")"}_compare(e,t){return e<t?-1:e>t?1:0}_compileComparisonOp(e,t,i,r){const n=this._compilePropertyReference(t),a=JSON.stringify(i);return(r?"typeof "+n+"===typeof "+a+"&&":"")+n+e+a}_compileInOp(e,t){const i=this._compare;return JSON.stringify(t.sort(i))+".indexOf("+this._compilePropertyReference(e)+")!==-1"}_compileLogicalOp(e,t){const i=this._compile.bind(this);return e.map(i).join(t)}_compileNegation(e){return"!("+e+")"}_compilePropertyReference(e){return"node["+JSON.stringify(e)+"]"}}const pi=100,di=301,fi=302,mi=306,gi=1e3,_i=1001,yi=1002,vi=1003,xi=1006,bi=1008,wi=1009,Si=1012,Mi=1014,Ti=1015,Ei=1016,Ci=1020,Ai=1022,Ii=1023,Pi=1026,zi=1027,Ri=2300,ki=2301,Li=2302,Di=2400,Bi=2401,Fi=2402,Oi=2500,Ni=3e3,Vi=3001,Ui=3007,$i=3002,ji=7680,qi=35044,Gi=35048,Hi="300 es";class Wi{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const i=this._listeners[e];if(void 0!==i){const e=i.indexOf(t);-1!==e&&i.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const i=t.slice(0);for(let t=0,r=i.length;t<r;t++)i[t].call(this,e);e.target=null}}}let Zi=1234567;const Xi=Math.PI/180,Yi=180/Math.PI,Ki=[];for(let HS=0;HS<256;HS++)Ki[HS]=(HS<16?"0":"")+HS.toString(16);const Ji="undefined"!==typeof crypto&&"randomUUID"in crypto;function Qi(){if(Ji)return crypto.randomUUID().toUpperCase();const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(Ki[255&e]+Ki[e>>8&255]+Ki[e>>16&255]+Ki[e>>24&255]+"-"+Ki[255&t]+Ki[t>>8&255]+"-"+Ki[t>>16&15|64]+Ki[t>>24&255]+"-"+Ki[63&i|128]+Ki[i>>8&255]+"-"+Ki[i>>16&255]+Ki[i>>24&255]+Ki[255&r]+Ki[r>>8&255]+Ki[r>>16&255]+Ki[r>>24&255]).toUpperCase()}function er(e,t,i){return Math.max(t,Math.min(i,e))}function tr(e,t){return(e%t+t)%t}function ir(e,t,i){return(1-i)*e+i*t}function rr(e){return 0===(e&e-1)&&0!==e}function nr(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}var ar=Object.freeze({__proto__:null,DEG2RAD:Xi,RAD2DEG:Yi,generateUUID:Qi,clamp:er,euclideanModulo:tr,mapLinear:function(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)},inverseLerp:function(e,t,i){return e!==t?(i-e)/(t-e):0},lerp:ir,damp:function(e,t,i,r){return ir(e,t,1-Math.exp(-i*r))},pingpong:function(e,t=1){return t-Math.abs(tr(e,2*t)-t)},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(Zi=e%2147483647),Zi=16807*Zi%2147483647,(Zi-1)/2147483646},degToRad:function(e){return e*Xi},radToDeg:function(e){return e*Yi},isPowerOfTwo:rr,ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:nr,setQuaternionFromProperEuler:function(e,t,i,r,n){const a=Math.cos,o=Math.sin,s=a(i/2),l=o(i/2),c=a((t+r)/2),u=o((t+r)/2),h=a((t-r)/2),p=o((t-r)/2),d=a((r-t)/2),f=o((r-t)/2);switch(n){case"XYX":e.set(s*u,l*h,l*p,s*c);break;case"YZY":e.set(l*p,s*u,l*h,s*c);break;case"ZXZ":e.set(l*h,l*p,s*u,s*c);break;case"XZX":e.set(s*u,l*f,l*d,s*c);break;case"YXY":e.set(l*d,s*u,l*f,s*c);break;case"ZYZ":e.set(l*f,l*d,s*u,s*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}});class or{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),r=Math.sin(t),n=this.x-e.x,a=this.y-e.y;return this.x=n*i-a*r+e.x,this.y=n*r+a*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}or.prototype.isVector2=!0;class sr{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,r,n,a,o,s,l){const c=this.elements;return c[0]=e,c[1]=r,c[2]=o,c[3]=t,c[4]=n,c[5]=s,c[6]=i,c[7]=a,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,n=this.elements,a=i[0],o=i[3],s=i[6],l=i[1],c=i[4],u=i[7],h=i[2],p=i[5],d=i[8],f=r[0],m=r[3],g=r[6],_=r[1],y=r[4],v=r[7],x=r[2],b=r[5],w=r[8];return n[0]=a*f+o*_+s*x,n[3]=a*m+o*y+s*b,n[6]=a*g+o*v+s*w,n[1]=l*f+c*_+u*x,n[4]=l*m+c*y+u*b,n[7]=l*g+c*v+u*w,n[2]=h*f+p*_+d*x,n[5]=h*m+p*y+d*b,n[8]=h*g+p*v+d*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8];return t*a*c-t*o*l-i*n*c+i*o*s+r*n*l-r*a*s}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8],u=c*a-o*l,h=o*s-c*n,p=l*n-a*s,d=t*u+i*h+r*p;if(0===d)return this.set(0,0,0,0,0,0,0,0,0);const f=1/d;return e[0]=u*f,e[1]=(r*l-c*i)*f,e[2]=(o*i-r*a)*f,e[3]=h*f,e[4]=(c*t-r*s)*f,e[5]=(r*n-o*t)*f,e[6]=p*f,e[7]=(i*s-l*t)*f,e[8]=(a*t-i*n)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,n,a,o){const s=Math.cos(n),l=Math.sin(n);return this.set(i*s,i*l,-i*(s*a+l*o)+a+e,-r*l,r*s,-r*(-l*a+s*o)+o+t,0,0,1),this}scale(e,t){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this}rotate(e){const t=Math.cos(e),i=Math.sin(e),r=this.elements,n=r[0],a=r[3],o=r[6],s=r[1],l=r[4],c=r[7];return r[0]=t*n+i*s,r[3]=t*a+i*l,r[6]=t*o+i*c,r[1]=-i*n+t*s,r[4]=-i*a+t*l,r[7]=-i*o+t*c,this}translate(e,t){const i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}function lr(e){if(0===e.length)return-1/0;let t=e[0];for(let i=1,r=e.length;i<r;++i)e[i]>t&&(t=e[i]);return t}function cr(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function ur(e,t=0){let i=3735928559^t,r=1103547991^t;for(let n,a=0;a<e.length;a++)n=e.charCodeAt(a),i=Math.imul(i^n,2654435761),r=Math.imul(r^n,1597334677);return i=Math.imul(i^i>>>16,2246822507)^Math.imul(r^r>>>13,3266489909),r=Math.imul(r^r>>>16,2246822507)^Math.imul(i^i>>>13,3266489909),4294967296*(2097151&r)+(i>>>0)}let hr;sr.prototype.isMatrix3=!0;class pr{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===hr&&(hr=cr("canvas")),hr.width=e.width,hr.height=e.height;const i=hr.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=hr}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}}let dr=0;class fr extends Wi{constructor(e=fr.DEFAULT_IMAGE,t=fr.DEFAULT_MAPPING,i=1001,r=1001,n=1006,a=1008,o=1023,s=1009,l=1,c=3e3){super(),Object.defineProperty(this,"id",{value:dr++}),this.uuid=Qi(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=r,this.magFilter=n,this.minFilter=a,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=s,this.offset=new or(0,0),this.repeat=new or(1,1),this.center=new or(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new sr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this}toJSON(e){const t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const r=this.image;if(void 0===r.uuid&&(r.uuid=Qi()),!t&&void 0===e.images[r.uuid]){let t;if(Array.isArray(r)){t=[];for(let e=0,i=r.length;e<i;e++)r[e].isDataTexture?t.push(mr(r[e].image)):t.push(mr(r[e]))}else t=mr(r);e.images[r.uuid]={uuid:r.uuid,url:t}}i.image=r.uuid}return"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case gi:e.x=e.x-Math.floor(e.x);break;case _i:e.x=e.x<0?0:1;break;case yi:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case gi:e.y=e.y-Math.floor(e.y);break;case _i:e.y=e.y<0?0:1;break;case yi:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&this.version++}}function mr(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap?pr.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}fr.DEFAULT_IMAGE=void 0,fr.DEFAULT_MAPPING=300,fr.prototype.isTexture=!0;class gr{constructor(e=0,t=0,i=0,r=1){this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,n=this.w,a=e.elements;return this.x=a[0]*t+a[4]*i+a[8]*r+a[12]*n,this.y=a[1]*t+a[5]*i+a[9]*r+a[13]*n,this.z=a[2]*t+a[6]*i+a[10]*r+a[14]*n,this.w=a[3]*t+a[7]*i+a[11]*r+a[15]*n,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,n;const a=.01,o=.1,s=e.elements,l=s[0],c=s[4],u=s[8],h=s[1],p=s[5],d=s[9],f=s[2],m=s[6],g=s[10];if(Math.abs(c-h)<a&&Math.abs(u-f)<a&&Math.abs(d-m)<a){if(Math.abs(c+h)<o&&Math.abs(u+f)<o&&Math.abs(d+m)<o&&Math.abs(l+p+g-3)<o)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,s=(p+1)/2,_=(g+1)/2,y=(c+h)/4,v=(u+f)/4,x=(d+m)/4;return e>s&&e>_?e<a?(i=0,r=.707106781,n=.707106781):(i=Math.sqrt(e),r=y/i,n=v/i):s>_?s<a?(i=.707106781,r=0,n=.707106781):(r=Math.sqrt(s),i=y/r,n=x/r):_<a?(i=.707106781,r=.707106781,n=0):(n=Math.sqrt(_),i=v/n,r=x/n),this.set(i,r,n,t),this}let _=Math.sqrt((m-d)*(m-d)+(u-f)*(u-f)+(h-c)*(h-c));return Math.abs(_)<.001&&(_=1),this.x=(m-d)/_,this.y=(u-f)/_,this.z=(h-c)/_,this.w=Math.acos((l+p+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}gr.prototype.isVector4=!0;class _r extends Wi{constructor(e,t,i={}){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new gr(0,0,e,t),this.scissorTest=!1,this.viewport=new gr(0,0,e,t),this.texture=new fr(void 0,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:e,height:t,depth:1},this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:xi,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,i=1){this.width===e&&this.height===t&&this.depth===i||(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}_r.prototype.isWebGLRenderTarget=!0;(class extends _r{constructor(e,t,i){super(e,t);const r=this.texture;this.texture=[];for(let n=0;n<i;n++)this.texture[n]=r.clone()}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,n=this.texture.length;r<n;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone();return this}}).prototype.isWebGLMultipleRenderTargets=!0;class yr extends _r{constructor(e,t,i){super(e,t,i),this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}}yr.prototype.isWebGLMultisampleRenderTarget=!0;class vr{constructor(e=0,t=0,i=0,r=1){this._x=e,this._y=t,this._z=i,this._w=r}static slerp(e,t,i,r){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(e,t,r)}static slerpFlat(e,t,i,r,n,a,o){let s=i[r+0],l=i[r+1],c=i[r+2],u=i[r+3];const h=n[a+0],p=n[a+1],d=n[a+2],f=n[a+3];if(0===o)return e[t+0]=s,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(1===o)return e[t+0]=h,e[t+1]=p,e[t+2]=d,void(e[t+3]=f);if(u!==f||s!==h||l!==p||c!==d){let e=1-o;const t=s*h+l*p+c*d+u*f,i=t>=0?1:-1,r=1-t*t;if(r>Number.EPSILON){const n=Math.sqrt(r),a=Math.atan2(n,t*i);e=Math.sin(e*a)/n,o=Math.sin(o*a)/n}const n=o*i;if(s=s*e+h*n,l=l*e+p*n,c=c*e+d*n,u=u*e+f*n,e===1-o){const e=1/Math.sqrt(s*s+l*l+c*c+u*u);s*=e,l*=e,c*=e,u*=e}}e[t]=s,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,i,r,n,a){const o=i[r],s=i[r+1],l=i[r+2],c=i[r+3],u=n[a],h=n[a+1],p=n[a+2],d=n[a+3];return e[t]=o*d+c*u+s*p-l*h,e[t+1]=s*d+c*h+l*u-o*p,e[t+2]=l*d+c*p+o*h-s*u,e[t+3]=c*d-o*u-s*h-l*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=e._x,r=e._y,n=e._z,a=e._order,o=Math.cos,s=Math.sin,l=o(i/2),c=o(r/2),u=o(n/2),h=s(i/2),p=s(r/2),d=s(n/2);switch(a){case"XYZ":this._x=h*c*u+l*p*d,this._y=l*p*u-h*c*d,this._z=l*c*d+h*p*u,this._w=l*c*u-h*p*d;break;case"YXZ":this._x=h*c*u+l*p*d,this._y=l*p*u-h*c*d,this._z=l*c*d-h*p*u,this._w=l*c*u+h*p*d;break;case"ZXY":this._x=h*c*u-l*p*d,this._y=l*p*u+h*c*d,this._z=l*c*d+h*p*u,this._w=l*c*u-h*p*d;break;case"ZYX":this._x=h*c*u-l*p*d,this._y=l*p*u+h*c*d,this._z=l*c*d-h*p*u,this._w=l*c*u+h*p*d;break;case"YZX":this._x=h*c*u+l*p*d,this._y=l*p*u+h*c*d,this._z=l*c*d-h*p*u,this._w=l*c*u-h*p*d;break;case"XZY":this._x=h*c*u-l*p*d,this._y=l*p*u-h*c*d,this._z=l*c*d+h*p*u,this._w=l*c*u+h*p*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],r=t[4],n=t[8],a=t[1],o=t[5],s=t[9],l=t[2],c=t[6],u=t[10],h=i+o+u;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(c-s)*e,this._y=(n-l)*e,this._z=(a-r)*e}else if(i>o&&i>u){const e=2*Math.sqrt(1+i-o-u);this._w=(c-s)/e,this._x=.25*e,this._y=(r+a)/e,this._z=(n+l)/e}else if(o>u){const e=2*Math.sqrt(1+o-i-u);this._w=(n-l)/e,this._x=(r+a)/e,this._y=.25*e,this._z=(s+c)/e}else{const e=2*Math.sqrt(1+u-i-o);this._w=(a-r)/e,this._x=(n+l)/e,this._y=(s+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(er(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(0===i)return this;const r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,r=e._y,n=e._z,a=e._w,o=t._x,s=t._y,l=t._z,c=t._w;return this._x=i*c+a*o+r*l-n*s,this._y=r*c+a*s+n*o-i*l,this._z=n*c+a*l+i*s-r*o,this._w=a*c-i*o-r*s-n*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const i=this._x,r=this._y,n=this._z,a=this._w;let o=a*e._w+i*e._x+r*e._y+n*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=i,this._y=r,this._z=n,this;const s=1-o*o;if(s<=Number.EPSILON){const e=1-t;return this._w=e*a+t*this._w,this._x=e*i+t*this._x,this._y=e*r+t*this._y,this._z=e*n+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(s),c=Math.atan2(l,o),u=Math.sin((1-t)*c)/l,h=Math.sin(t*c)/l;return this._w=a*u+this._w*h,this._x=i*u+this._x*h,this._y=r*u+this._y*h,this._z=n*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,i){this.copy(e).slerp(t,i)}random(){const e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),r=2*Math.PI*Math.random(),n=2*Math.PI*Math.random();return this.set(t*Math.cos(r),i*Math.sin(n),i*Math.cos(n),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}vr.prototype.isQuaternion=!0;class xr{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(wr.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(wr.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6]*r,this.y=n[1]*t+n[4]*i+n[7]*r,this.z=n[2]*t+n[5]*i+n[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,n=e.elements,a=1/(n[3]*t+n[7]*i+n[11]*r+n[15]);return this.x=(n[0]*t+n[4]*i+n[8]*r+n[12])*a,this.y=(n[1]*t+n[5]*i+n[9]*r+n[13])*a,this.z=(n[2]*t+n[6]*i+n[10]*r+n[14])*a,this}applyQuaternion(e){const t=this.x,i=this.y,r=this.z,n=e.x,a=e.y,o=e.z,s=e.w,l=s*t+a*r-o*i,c=s*i+o*t-n*r,u=s*r+n*i-a*t,h=-n*t-a*i-o*r;return this.x=l*s+h*-n+c*-o-u*-a,this.y=c*s+h*-a+u*-n-l*-o,this.z=u*s+h*-o+l*-a-c*-n,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r,this.y=n[1]*t+n[5]*i+n[9]*r,this.z=n[2]*t+n[6]*i+n[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,r=e.y,n=e.z,a=t.x,o=t.y,s=t.z;return this.x=r*s-n*o,this.y=n*a-i*s,this.z=i*o-r*a,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return br.copy(this).projectOnVector(e),this.sub(br)}reflect(e){return this.sub(br.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(er(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}xr.prototype.isVector3=!0;const br=new xr,wr=new vr;class Sr{constructor(e=new xr(1/0,1/0,1/0),t=new xr(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,r=1/0,n=-1/0,a=-1/0,o=-1/0;for(let s=0,l=e.length;s<l;s+=3){const l=e[s],c=e[s+1],u=e[s+2];l<t&&(t=l),c<i&&(i=c),u<r&&(r=u),l>n&&(n=l),c>a&&(a=c),u>o&&(o=u)}return this.min.set(t,i,r),this.max.set(n,a,o),this}setFromBufferAttribute(e){let t=1/0,i=1/0,r=1/0,n=-1/0,a=-1/0,o=-1/0;for(let s=0,l=e.count;s<l;s++){const l=e.getX(s),c=e.getY(s),u=e.getZ(s);l<t&&(t=l),c<i&&(i=c),u<r&&(r=u),l>n&&(n=l),c>a&&(a=c),u>o&&(o=u)}return this.min.set(t,i,r),this.max.set(n,a,o),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Tr.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),Er.copy(t.boundingBox),Er.applyMatrix4(e.matrixWorld),this.union(Er));const i=e.children;for(let r=0,n=i.length;r<n;r++)this.expandByObject(i[r]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Tr),Tr.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(kr),Lr.subVectors(this.max,kr),Cr.subVectors(e.a,kr),Ar.subVectors(e.b,kr),Ir.subVectors(e.c,kr),Pr.subVectors(Ar,Cr),zr.subVectors(Ir,Ar),Rr.subVectors(Cr,Ir);let t=[0,-Pr.z,Pr.y,0,-zr.z,zr.y,0,-Rr.z,Rr.y,Pr.z,0,-Pr.x,zr.z,0,-zr.x,Rr.z,0,-Rr.x,-Pr.y,Pr.x,0,-zr.y,zr.x,0,-Rr.y,Rr.x,0];return!!Fr(t,Cr,Ar,Ir,Lr)&&(t=[1,0,0,0,1,0,0,0,1],!!Fr(t,Cr,Ar,Ir,Lr)&&(Dr.crossVectors(Pr,zr),t=[Dr.x,Dr.y,Dr.z],Fr(t,Cr,Ar,Ir,Lr)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Tr.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(Tr).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Mr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Mr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Mr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Mr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Mr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Mr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Mr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Mr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Mr)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}Sr.prototype.isBox3=!0;const Mr=[new xr,new xr,new xr,new xr,new xr,new xr,new xr,new xr],Tr=new xr,Er=new Sr,Cr=new xr,Ar=new xr,Ir=new xr,Pr=new xr,zr=new xr,Rr=new xr,kr=new xr,Lr=new xr,Dr=new xr,Br=new xr;function Fr(e,t,i,r,n){for(let a=0,o=e.length-3;a<=o;a+=3){Br.fromArray(e,a);const o=n.x*Math.abs(Br.x)+n.y*Math.abs(Br.y)+n.z*Math.abs(Br.z),s=t.dot(Br),l=i.dot(Br),c=r.dot(Br);if(Math.max(-Math.max(s,l,c),Math.min(s,l,c))>o)return!1}return!0}const Or=new Sr,Nr=new xr,Vr=new xr,Ur=new xr;class $r{constructor(e=new xr,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;void 0!==t?i.copy(t):Or.setFromPoints(e).getCenter(i);let r=0;for(let n=0,a=e.length;n<a;n++)r=Math.max(r,i.distanceToSquared(e[n]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){Ur.subVectors(e,this.center);const t=Ur.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),i=.5*(e-this.radius);this.center.add(Ur.multiplyScalar(i/e)),this.radius+=i}return this}union(e){return Vr.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(Nr.copy(e.center).add(Vr)),this.expandByPoint(Nr.copy(e.center).sub(Vr)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const jr=new xr,qr=new xr,Gr=new xr,Hr=new xr,Wr=new xr,Zr=new xr,Xr=new xr;class Yr{constructor(e=new xr,t=new xr(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,jr)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=jr.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(jr.copy(this.direction).multiplyScalar(t).add(this.origin),jr.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){qr.copy(e).add(t).multiplyScalar(.5),Gr.copy(t).sub(e).normalize(),Hr.copy(this.origin).sub(qr);const n=.5*e.distanceTo(t),a=-this.direction.dot(Gr),o=Hr.dot(this.direction),s=-Hr.dot(Gr),l=Hr.lengthSq(),c=Math.abs(1-a*a);let u,h,p,d;if(c>0)if(u=a*s-o,h=a*o-s,d=n*c,u>=0)if(h>=-d)if(h<=d){const e=1/c;u*=e,h*=e,p=u*(u+a*h+2*o)+h*(a*u+h+2*s)+l}else h=n,u=Math.max(0,-(a*h+o)),p=-u*u+h*(h+2*s)+l;else h=-n,u=Math.max(0,-(a*h+o)),p=-u*u+h*(h+2*s)+l;else h<=-d?(u=Math.max(0,-(-a*n+o)),h=u>0?-n:Math.min(Math.max(-n,-s),n),p=-u*u+h*(h+2*s)+l):h<=d?(u=0,h=Math.min(Math.max(-n,-s),n),p=h*(h+2*s)+l):(u=Math.max(0,-(a*n+o)),h=u>0?n:Math.min(Math.max(-n,-s),n),p=-u*u+h*(h+2*s)+l);else h=a>0?-n:n,u=Math.max(0,-(a*h+o)),p=-u*u+h*(h+2*s)+l;return i&&i.copy(this.direction).multiplyScalar(u).add(this.origin),r&&r.copy(Gr).multiplyScalar(h).add(qr),p}intersectSphere(e,t){jr.subVectors(e.center,this.origin);const i=jr.dot(this.direction),r=jr.dot(jr)-i*i,n=e.radius*e.radius;if(r>n)return null;const a=Math.sqrt(n-r),o=i-a,s=i+a;return o<0&&s<0?null:o<0?this.at(s,t):this.at(o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,n,a,o,s;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(i=(e.min.x-h.x)*l,r=(e.max.x-h.x)*l):(i=(e.max.x-h.x)*l,r=(e.min.x-h.x)*l),c>=0?(n=(e.min.y-h.y)*c,a=(e.max.y-h.y)*c):(n=(e.max.y-h.y)*c,a=(e.min.y-h.y)*c),i>a||n>r?null:((n>i||i!==i)&&(i=n),(a<r||r!==r)&&(r=a),u>=0?(o=(e.min.z-h.z)*u,s=(e.max.z-h.z)*u):(o=(e.max.z-h.z)*u,s=(e.min.z-h.z)*u),i>s||o>r?null:((o>i||i!==i)&&(i=o),(s<r||r!==r)&&(r=s),r<0?null:this.at(i>=0?i:r,t)))}intersectsBox(e){return null!==this.intersectBox(e,jr)}intersectTriangle(e,t,i,r,n){Wr.subVectors(t,e),Zr.subVectors(i,e),Xr.crossVectors(Wr,Zr);let a,o=this.direction.dot(Xr);if(o>0){if(r)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}Hr.subVectors(this.origin,e);const s=a*this.direction.dot(Zr.crossVectors(Hr,Zr));if(s<0)return null;const l=a*this.direction.dot(Wr.cross(Hr));if(l<0)return null;if(s+l>o)return null;const c=-a*Hr.dot(Xr);return c<0?null:this.at(c/o,n)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Kr{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,r,n,a,o,s,l,c,u,h,p,d,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=r,g[1]=n,g[5]=a,g[9]=o,g[13]=s,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=p,g[7]=d,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Kr).fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,r=1/Jr.setFromMatrixColumn(e,0).length(),n=1/Jr.setFromMatrixColumn(e,1).length(),a=1/Jr.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*n,t[5]=i[5]*n,t[6]=i[6]*n,t[7]=0,t[8]=i[8]*a,t[9]=i[9]*a,t[10]=i[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,i=e.x,r=e.y,n=e.z,a=Math.cos(i),o=Math.sin(i),s=Math.cos(r),l=Math.sin(r),c=Math.cos(n),u=Math.sin(n);if("XYZ"===e.order){const e=a*c,i=a*u,r=o*c,n=o*u;t[0]=s*c,t[4]=-s*u,t[8]=l,t[1]=i+r*l,t[5]=e-n*l,t[9]=-o*s,t[2]=n-e*l,t[6]=r+i*l,t[10]=a*s}else if("YXZ"===e.order){const e=s*c,i=s*u,r=l*c,n=l*u;t[0]=e+n*o,t[4]=r*o-i,t[8]=a*l,t[1]=a*u,t[5]=a*c,t[9]=-o,t[2]=i*o-r,t[6]=n+e*o,t[10]=a*s}else if("ZXY"===e.order){const e=s*c,i=s*u,r=l*c,n=l*u;t[0]=e-n*o,t[4]=-a*u,t[8]=r+i*o,t[1]=i+r*o,t[5]=a*c,t[9]=n-e*o,t[2]=-a*l,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){const e=a*c,i=a*u,r=o*c,n=o*u;t[0]=s*c,t[4]=r*l-i,t[8]=e*l+n,t[1]=s*u,t[5]=n*l+e,t[9]=i*l-r,t[2]=-l,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){const e=a*s,i=a*l,r=o*s,n=o*l;t[0]=s*c,t[4]=n-e*u,t[8]=r*u+i,t[1]=u,t[5]=a*c,t[9]=-o*c,t[2]=-l*c,t[6]=i*u+r,t[10]=e-n*u}else if("XZY"===e.order){const e=a*s,i=a*l,r=o*s,n=o*l;t[0]=s*c,t[4]=-u,t[8]=l*c,t[1]=e*u+n,t[5]=a*c,t[9]=i*u-r,t[2]=r*u-i,t[6]=o*c,t[10]=n*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(en,e,tn)}lookAt(e,t,i){const r=this.elements;return an.subVectors(e,t),0===an.lengthSq()&&(an.z=1),an.normalize(),rn.crossVectors(i,an),0===rn.lengthSq()&&(1===Math.abs(i.z)?an.x+=1e-4:an.z+=1e-4,an.normalize(),rn.crossVectors(i,an)),rn.normalize(),nn.crossVectors(an,rn),r[0]=rn.x,r[4]=nn.x,r[8]=an.x,r[1]=rn.y,r[5]=nn.y,r[9]=an.y,r[2]=rn.z,r[6]=nn.z,r[10]=an.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,n=this.elements,a=i[0],o=i[4],s=i[8],l=i[12],c=i[1],u=i[5],h=i[9],p=i[13],d=i[2],f=i[6],m=i[10],g=i[14],_=i[3],y=i[7],v=i[11],x=i[15],b=r[0],w=r[4],S=r[8],M=r[12],T=r[1],E=r[5],C=r[9],A=r[13],I=r[2],P=r[6],z=r[10],R=r[14],k=r[3],L=r[7],D=r[11],B=r[15];return n[0]=a*b+o*T+s*I+l*k,n[4]=a*w+o*E+s*P+l*L,n[8]=a*S+o*C+s*z+l*D,n[12]=a*M+o*A+s*R+l*B,n[1]=c*b+u*T+h*I+p*k,n[5]=c*w+u*E+h*P+p*L,n[9]=c*S+u*C+h*z+p*D,n[13]=c*M+u*A+h*R+p*B,n[2]=d*b+f*T+m*I+g*k,n[6]=d*w+f*E+m*P+g*L,n[10]=d*S+f*C+m*z+g*D,n[14]=d*M+f*A+m*R+g*B,n[3]=_*b+y*T+v*I+x*k,n[7]=_*w+y*E+v*P+x*L,n[11]=_*S+y*C+v*z+x*D,n[15]=_*M+y*A+v*R+x*B,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],r=e[8],n=e[12],a=e[1],o=e[5],s=e[9],l=e[13],c=e[2],u=e[6],h=e[10],p=e[14];return e[3]*(+n*s*u-r*l*u-n*o*h+i*l*h+r*o*p-i*s*p)+e[7]*(+t*s*p-t*l*h+n*a*h-r*a*p+r*l*c-n*s*c)+e[11]*(+t*l*u-t*o*p-n*a*u+i*a*p+n*o*c-i*l*c)+e[15]*(-r*o*c-t*s*u+t*o*h+r*a*u-i*a*h+i*s*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8],u=e[9],h=e[10],p=e[11],d=e[12],f=e[13],m=e[14],g=e[15],_=u*m*l-f*h*l+f*s*p-o*m*p-u*s*g+o*h*g,y=d*h*l-c*m*l-d*s*p+a*m*p+c*s*g-a*h*g,v=c*f*l-d*u*l+d*o*p-a*f*p-c*o*g+a*u*g,x=d*u*s-c*f*s-d*o*h+a*f*h+c*o*m-a*u*m,b=t*_+i*y+r*v+n*x;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/b;return e[0]=_*w,e[1]=(f*h*n-u*m*n-f*r*p+i*m*p+u*r*g-i*h*g)*w,e[2]=(o*m*n-f*s*n+f*r*l-i*m*l-o*r*g+i*s*g)*w,e[3]=(u*s*n-o*h*n-u*r*l+i*h*l+o*r*p-i*s*p)*w,e[4]=y*w,e[5]=(c*m*n-d*h*n+d*r*p-t*m*p-c*r*g+t*h*g)*w,e[6]=(d*s*n-a*m*n-d*r*l+t*m*l+a*r*g-t*s*g)*w,e[7]=(a*h*n-c*s*n+c*r*l-t*h*l-a*r*p+t*s*p)*w,e[8]=v*w,e[9]=(d*u*n-c*f*n-d*i*p+t*f*p+c*i*g-t*u*g)*w,e[10]=(a*f*n-d*o*n+d*i*l-t*f*l-a*i*g+t*o*g)*w,e[11]=(c*o*n-a*u*n-c*i*l+t*u*l+a*i*p-t*o*p)*w,e[12]=x*w,e[13]=(c*f*r-d*u*r+d*i*h-t*f*h-c*i*m+t*u*m)*w,e[14]=(d*o*r-a*f*r-d*i*s+t*f*s+a*i*m-t*o*m)*w,e[15]=(a*u*r-c*o*r+c*i*s-t*u*s-a*i*h+t*o*h)*w,this}scale(e){const t=this.elements,i=e.x,r=e.y,n=e.z;return t[0]*=i,t[4]*=r,t[8]*=n,t[1]*=i,t[5]*=r,t[9]*=n,t[2]*=i,t[6]*=r,t[10]*=n,t[3]*=i,t[7]*=r,t[11]*=n,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),r=Math.sin(t),n=1-i,a=e.x,o=e.y,s=e.z,l=n*a,c=n*o;return this.set(l*a+i,l*o-r*s,l*s+r*o,0,l*o+r*s,c*o+i,c*s-r*a,0,l*s-r*o,c*s+r*a,n*s*s+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,n,a){return this.set(1,i,n,0,e,1,a,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){const r=this.elements,n=t._x,a=t._y,o=t._z,s=t._w,l=n+n,c=a+a,u=o+o,h=n*l,p=n*c,d=n*u,f=a*c,m=a*u,g=o*u,_=s*l,y=s*c,v=s*u,x=i.x,b=i.y,w=i.z;return r[0]=(1-(f+g))*x,r[1]=(p+v)*x,r[2]=(d-y)*x,r[3]=0,r[4]=(p-v)*b,r[5]=(1-(h+g))*b,r[6]=(m+_)*b,r[7]=0,r[8]=(d+y)*w,r[9]=(m-_)*w,r[10]=(1-(h+f))*w,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){const r=this.elements;let n=Jr.set(r[0],r[1],r[2]).length();const a=Jr.set(r[4],r[5],r[6]).length(),o=Jr.set(r[8],r[9],r[10]).length();this.determinant()<0&&(n=-n),e.x=r[12],e.y=r[13],e.z=r[14],Qr.copy(this);const s=1/n,l=1/a,c=1/o;return Qr.elements[0]*=s,Qr.elements[1]*=s,Qr.elements[2]*=s,Qr.elements[4]*=l,Qr.elements[5]*=l,Qr.elements[6]*=l,Qr.elements[8]*=c,Qr.elements[9]*=c,Qr.elements[10]*=c,t.setFromRotationMatrix(Qr),i.x=n,i.y=a,i.z=o,this}makePerspective(e,t,i,r,n,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const o=this.elements,s=2*n/(t-e),l=2*n/(i-r),c=(t+e)/(t-e),u=(i+r)/(i-r),h=-(a+n)/(a-n),p=-2*a*n/(a-n);return o[0]=s,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=p,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,i,r,n,a){const o=this.elements,s=1/(t-e),l=1/(i-r),c=1/(a-n),u=(t+e)*s,h=(i+r)*l,p=(a+n)*c;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-p,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}Kr.prototype.isMatrix4=!0;const Jr=new xr,Qr=new Kr,en=new xr(0,0,0),tn=new xr(1,1,1),rn=new xr,nn=new xr,an=new xr,on=new Kr,sn=new vr;class ln{constructor(e=0,t=0,i=0,r=ln.DefaultOrder){this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r=this._order){return this._x=e,this._y=t,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const r=e.elements,n=r[0],a=r[4],o=r[8],s=r[1],l=r[5],c=r[9],u=r[2],h=r[6],p=r[10];switch(t){case"XYZ":this._y=Math.asin(er(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,p),this._z=Math.atan2(-a,n)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-er(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,p),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-u,n),this._z=0);break;case"ZXY":this._x=Math.asin(er(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,p),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(s,n));break;case"ZYX":this._y=Math.asin(-er(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,p),this._z=Math.atan2(s,n)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(er(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,n)):(this._x=0,this._y=Math.atan2(o,p));break;case"XZY":this._z=Math.asin(-er(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(o,n)):(this._x=Math.atan2(-c,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===i&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return on.makeRotationFromQuaternion(e),this.setFromRotationMatrix(on,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return sn.setFromEuler(this),this.setFromQuaternion(sn,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new xr(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}ln.prototype.isEuler=!0,ln.DefaultOrder="XYZ",ln.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class cn{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!==(this.mask&e.mask)}}let un=0;const hn=new xr,pn=new vr,dn=new Kr,fn=new xr,mn=new xr,gn=new xr,_n=new vr,yn=new xr(1,0,0),vn=new xr(0,1,0),xn=new xr(0,0,1),bn={type:"added"},wn={type:"removed"};class Sn extends Wi{constructor(){super(),Object.defineProperty(this,"id",{value:un++}),this.uuid=Qi(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Sn.DefaultUp.clone();const e=new xr,t=new ln,i=new vr,r=new xr(1,1,1);t._onChange((function(){i.setFromEuler(t,!1)})),i._onChange((function(){t.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Kr},normalMatrix:{value:new sr}}),this.matrix=new Kr,this.matrixWorld=new Kr,this.matrixAutoUpdate=Sn.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new cn,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return pn.setFromAxisAngle(e,t),this.quaternion.multiply(pn),this}rotateOnWorldAxis(e,t){return pn.setFromAxisAngle(e,t),this.quaternion.premultiply(pn),this}rotateX(e){return this.rotateOnAxis(yn,e)}rotateY(e){return this.rotateOnAxis(vn,e)}rotateZ(e){return this.rotateOnAxis(xn,e)}translateOnAxis(e,t){return hn.copy(e).applyQuaternion(this.quaternion),this.position.add(hn.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(yn,e)}translateY(e){return this.translateOnAxis(vn,e)}translateZ(e){return this.translateOnAxis(xn,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(dn.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?fn.copy(e):fn.set(e,t,i);const r=this.parent;this.updateWorldMatrix(!0,!1),mn.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?dn.lookAt(mn,fn,this.up):dn.lookAt(fn,mn,this.up),this.quaternion.setFromRotationMatrix(dn),r&&(dn.extractRotation(r.matrixWorld),pn.setFromRotationMatrix(dn),this.quaternion.premultiply(pn.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(bn)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(wn)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(wn)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),dn.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),dn.multiply(e.parent.matrixWorld)),e.applyMatrix4(dn),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,r=this.children.length;i<r;i++){const r=this.children[i].getObjectByProperty(e,t);if(void 0!==r)return r}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(mn,e,gn),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(mn,_n,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(!0===e&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,i=e.length;t<i;t++)e[t].updateWorldMatrix(!1,!0)}}toJSON(e){const t=void 0===e||"string"===typeof e,i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};function n(t,i){return void 0===t[i.uuid]&&(t[i.uuid]=i.toJSON(e)),i.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=n(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const i=t.shapes;if(Array.isArray(i))for(let t=0,r=i.length;t<r;t++){const r=i[t];n(e.shapes,r)}else n(e.shapes,i)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(n(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let i=0,r=this.material.length;i<r;i++)t.push(n(e.materials,this.material[i]));r.material=t}else r.material=n(e.materials,this.material);if(this.children.length>0){r.children=[];for(let t=0;t<this.children.length;t++)r.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let t=0;t<this.animations.length;t++){const i=this.animations[t];r.animations.push(n(e.animations,i))}}if(t){const t=a(e.geometries),r=a(e.materials),n=a(e.textures),o=a(e.images),s=a(e.shapes),l=a(e.skeletons),c=a(e.animations);t.length>0&&(i.geometries=t),r.length>0&&(i.materials=r),n.length>0&&(i.textures=n),o.length>0&&(i.images=o),s.length>0&&(i.shapes=s),l.length>0&&(i.skeletons=l),c.length>0&&(i.animations=c)}return i.object=r,i;function a(e){const t=[];for(const i in e){const r=e[i];delete r.metadata,t.push(r)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let i=0;i<e.children.length;i++){const t=e.children[i];this.add(t.clone())}return this}}Sn.DefaultUp=new xr(0,1,0),Sn.DefaultMatrixAutoUpdate=!0,Sn.prototype.isObject3D=!0;const Mn=new xr,Tn=new xr,En=new xr,Cn=new xr,An=new xr,In=new xr,Pn=new xr,zn=new xr,Rn=new xr,kn=new xr;class Ln{constructor(e=new xr,t=new xr,i=new xr){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),Mn.subVectors(e,t),r.cross(Mn);const n=r.lengthSq();return n>0?r.multiplyScalar(1/Math.sqrt(n)):r.set(0,0,0)}static getBarycoord(e,t,i,r,n){Mn.subVectors(r,t),Tn.subVectors(i,t),En.subVectors(e,t);const a=Mn.dot(Mn),o=Mn.dot(Tn),s=Mn.dot(En),l=Tn.dot(Tn),c=Tn.dot(En),u=a*l-o*o;if(0===u)return n.set(-2,-1,-1);const h=1/u,p=(l*s-o*c)*h,d=(a*c-o*s)*h;return n.set(1-p-d,d,p)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,Cn),Cn.x>=0&&Cn.y>=0&&Cn.x+Cn.y<=1}static getUV(e,t,i,r,n,a,o,s){return this.getBarycoord(e,t,i,r,Cn),s.set(0,0),s.addScaledVector(n,Cn.x),s.addScaledVector(a,Cn.y),s.addScaledVector(o,Cn.z),s}static isFrontFacing(e,t,i,r){return Mn.subVectors(i,t),Tn.subVectors(e,t),Mn.cross(Tn).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Mn.subVectors(this.c,this.b),Tn.subVectors(this.a,this.b),.5*Mn.cross(Tn).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Ln.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Ln.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,r,n){return Ln.getUV(e,this.a,this.b,this.c,t,i,r,n)}containsPoint(e){return Ln.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Ln.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,r=this.b,n=this.c;let a,o;An.subVectors(r,i),In.subVectors(n,i),zn.subVectors(e,i);const s=An.dot(zn),l=In.dot(zn);if(s<=0&&l<=0)return t.copy(i);Rn.subVectors(e,r);const c=An.dot(Rn),u=In.dot(Rn);if(c>=0&&u<=c)return t.copy(r);const h=s*u-c*l;if(h<=0&&s>=0&&c<=0)return a=s/(s-c),t.copy(i).addScaledVector(An,a);kn.subVectors(e,n);const p=An.dot(kn),d=In.dot(kn);if(d>=0&&p<=d)return t.copy(n);const f=p*l-s*d;if(f<=0&&l>=0&&d<=0)return o=l/(l-d),t.copy(i).addScaledVector(In,o);const m=c*d-p*u;if(m<=0&&u-c>=0&&p-d>=0)return Pn.subVectors(n,r),o=(u-c)/(u-c+(p-d)),t.copy(r).addScaledVector(Pn,o);const g=1/(m+f+h);return a=f*g,o=h*g,t.copy(i).addScaledVector(An,a).addScaledVector(In,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let Dn=0;class Bn extends Wi{constructor(){super(),Object.defineProperty(this,"id",{value:Dn++}),this.uuid=Qi(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.format=Ii,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=pi,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ji,this.stencilZFail=ji,this.stencilZPass=ji,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!==e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const i=e[t];if(void 0===i){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"===t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===i;continue}const r=this[t];void 0!==r?r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){const t=void 0===e||"string"===typeof e;t&&(e={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){const t=[];for(const i in e){const r=e[i];delete r.metadata,t.push(r)}return t}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(i.blending=this.blending),0!==this.side&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.format!==Ii&&(i.format=this.format),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),t){const t=r(e.textures),n=r(e.images);t.length>0&&(i.textures=t),n.length>0&&(i.images=n)}return i}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.format=e.format,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(null!==t){const e=t.length;i=new Array(e);for(let r=0;r!==e;++r)i[r]=t[r].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}Bn.prototype.isMaterial=!0;const Fn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},On={h:0,s:0,l:0},Nn={h:0,s:0,l:0};function Vn(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e}function Un(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function $n(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class jn{constructor(e,t,i){return void 0===t&&void 0===i?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):"number"===typeof e?this.setHex(e):"string"===typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,i){return this.r=e,this.g=t,this.b=i,this}setHSL(e,t,i){if(e=tr(e,1),t=er(t,0,1),i=er(i,0,1),0===t)this.r=this.g=this.b=i;else{const r=i<=.5?i*(1+t):i+t-i*t,n=2*i-r;this.r=Vn(n,r,e+1/3),this.g=Vn(n,r,e),this.b=Vn(n,r,e-1/3)}return this}setStyle(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;const r=i[1],n=i[2];switch(r){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,t(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,t(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n)){const i=parseFloat(e[1])/360,r=parseInt(e[2],10)/100,n=parseInt(e[3],10)/100;return t(e[4]),this.setHSL(i,r,n)}}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=i[1],t=e.length;if(3===t)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===t)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=Fn[e.toLowerCase()];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){const i=t>0?1/t:1;return this.r=Math.pow(e.r,i),this.g=Math.pow(e.g,i),this.b=Math.pow(e.b,i),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=Un(e.r),this.g=Un(e.g),this.b=Un(e.b),this}copyLinearToSRGB(e){return this.r=$n(e.r),this.g=$n(e.g),this.b=$n(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){const t=this.r,i=this.g,r=this.b,n=Math.max(t,i,r),a=Math.min(t,i,r);let o,s;const l=(a+n)/2;if(a===n)o=0,s=0;else{const e=n-a;switch(s=l<=.5?e/(n+a):e/(2-n-a),n){case t:o=(i-r)/e+(i<r?6:0);break;case i:o=(r-t)/e+2;break;case r:o=(t-i)/e+4}o/=6}return e.h=o,e.s=s,e.l=l,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,t,i){return this.getHSL(On),On.h+=e,On.s+=t,On.l+=i,this.setHSL(On.h,On.s,On.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(On),e.getHSL(Nn);const i=ir(On.h,Nn.h,t),r=ir(On.s,Nn.s,t),n=ir(On.l,Nn.l,t);return this.setHSL(i,r,n),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}jn.NAMES=Fn,jn.prototype.isColor=!0,jn.prototype.r=1,jn.prototype.g=1,jn.prototype.b=1;class qn extends Bn{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new jn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}qn.prototype.isMeshBasicMaterial=!0;const Gn=new xr,Hn=new or;class Wn{constructor(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===i,this.usage=qi,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,n=this.itemSize;r<n;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let i=0;for(let r=0,n=e.length;r<n;r++){let n=e[r];void 0===n&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),n=new jn),t[i++]=n.r,t[i++]=n.g,t[i++]=n.b}return this}copyVector2sArray(e){const t=this.array;let i=0;for(let r=0,n=e.length;r<n;r++){let n=e[r];void 0===n&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),n=new or),t[i++]=n.x,t[i++]=n.y}return this}copyVector3sArray(e){const t=this.array;let i=0;for(let r=0,n=e.length;r<n;r++){let n=e[r];void 0===n&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),n=new xr),t[i++]=n.x,t[i++]=n.y,t[i++]=n.z}return this}copyVector4sArray(e){const t=this.array;let i=0;for(let r=0,n=e.length;r<n;r++){let n=e[r];void 0===n&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),n=new gr),t[i++]=n.x,t[i++]=n.y,t[i++]=n.z,t[i++]=n.w}return this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,i=this.count;t<i;t++)Hn.fromBufferAttribute(this,t),Hn.applyMatrix3(e),this.setXY(t,Hn.x,Hn.y);else if(3===this.itemSize)for(let t=0,i=this.count;t<i;t++)Gn.fromBufferAttribute(this,t),Gn.applyMatrix3(e),this.setXYZ(t,Gn.x,Gn.y,Gn.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)Gn.x=this.getX(t),Gn.y=this.getY(t),Gn.z=this.getZ(t),Gn.applyMatrix4(e),this.setXYZ(t,Gn.x,Gn.y,Gn.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Gn.x=this.getX(t),Gn.y=this.getY(t),Gn.z=this.getZ(t),Gn.applyNormalMatrix(e),this.setXYZ(t,Gn.x,Gn.y,Gn.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Gn.x=this.getX(t),Gn.y=this.getY(t),Gn.z=this.getZ(t),Gn.transformDirection(e),this.setXYZ(t,Gn.x,Gn.y,Gn.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=n,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==qi&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}Wn.prototype.isBufferAttribute=!0;class Zn extends Wn{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class Xn extends Wn{constructor(e,t,i){super(new Uint32Array(e),t,i)}}(class extends Wn{constructor(e,t,i){super(new Uint16Array(e),t,i)}}).prototype.isFloat16BufferAttribute=!0;class Yn extends Wn{constructor(e,t,i){super(new Float32Array(e),t,i)}}let Kn=0;const Jn=new Kr,Qn=new Sn,ea=new xr,ta=new Sr,ia=new Sr,ra=new xr;class na extends Wi{constructor(){super(),Object.defineProperty(this,"id",{value:Kn++}),this.uuid=Qi(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(lr(e)>65535?Xn:Zn)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const t=(new sr).getNormalMatrix(e);i.applyNormalMatrix(t),i.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Jn.makeRotationFromQuaternion(e),this.applyMatrix4(Jn),this}rotateX(e){return Jn.makeRotationX(e),this.applyMatrix4(Jn),this}rotateY(e){return Jn.makeRotationY(e),this.applyMatrix4(Jn),this}rotateZ(e){return Jn.makeRotationZ(e),this.applyMatrix4(Jn),this}translate(e,t,i){return Jn.makeTranslation(e,t,i),this.applyMatrix4(Jn),this}scale(e,t,i){return Jn.makeScale(e,t,i),this.applyMatrix4(Jn),this}lookAt(e){return Qn.lookAt(e),Qn.updateMatrix(),this.applyMatrix4(Qn.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(ea).negate(),this.translate(ea.x,ea.y,ea.z),this}setFromPoints(e){const t=[];for(let i=0,r=e.length;i<r;i++){const r=e[i];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new Yn(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Sr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new xr(-1/0,-1/0,-1/0),new xr(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++){const e=t[i];ta.setFromBufferAttribute(e),this.morphTargetsRelative?(ra.addVectors(this.boundingBox.min,ta.min),this.boundingBox.expandByPoint(ra),ra.addVectors(this.boundingBox.max,ta.max),this.boundingBox.expandByPoint(ra)):(this.boundingBox.expandByPoint(ta.min),this.boundingBox.expandByPoint(ta.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new $r);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new xr,1/0);if(e){const i=this.boundingSphere.center;if(ta.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const i=t[e];ia.setFromBufferAttribute(i),this.morphTargetsRelative?(ra.addVectors(ta.min,ia.min),ta.expandByPoint(ra),ra.addVectors(ta.max,ia.max),ta.expandByPoint(ra)):(ta.expandByPoint(ia.min),ta.expandByPoint(ia.max))}ta.getCenter(i);let r=0;for(let t=0,n=e.count;t<n;t++)ra.fromBufferAttribute(e,t),r=Math.max(r,i.distanceToSquared(ra));if(t)for(let n=0,a=t.length;n<a;n++){const a=t[n],o=this.morphTargetsRelative;for(let t=0,n=a.count;t<n;t++)ra.fromBufferAttribute(a,t),o&&(ea.fromBufferAttribute(e,t),ra.add(ea)),r=Math.max(r,i.distanceToSquared(ra))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=e.array,r=t.position.array,n=t.normal.array,a=t.uv.array,o=r.length/3;void 0===t.tangent&&this.setAttribute("tangent",new Wn(new Float32Array(4*o),4));const s=t.tangent.array,l=[],c=[];for(let T=0;T<o;T++)l[T]=new xr,c[T]=new xr;const u=new xr,h=new xr,p=new xr,d=new or,f=new or,m=new or,g=new xr,_=new xr;function y(e,t,i){u.fromArray(r,3*e),h.fromArray(r,3*t),p.fromArray(r,3*i),d.fromArray(a,2*e),f.fromArray(a,2*t),m.fromArray(a,2*i),h.sub(u),p.sub(u),f.sub(d),m.sub(d);const n=1/(f.x*m.y-m.x*f.y);isFinite(n)&&(g.copy(h).multiplyScalar(m.y).addScaledVector(p,-f.y).multiplyScalar(n),_.copy(p).multiplyScalar(f.x).addScaledVector(h,-m.x).multiplyScalar(n),l[e].add(g),l[t].add(g),l[i].add(g),c[e].add(_),c[t].add(_),c[i].add(_))}let v=this.groups;0===v.length&&(v=[{start:0,count:i.length}]);for(let T=0,E=v.length;T<E;++T){const e=v[T],t=e.start;for(let r=t,n=t+e.count;r<n;r+=3)y(i[r+0],i[r+1],i[r+2])}const x=new xr,b=new xr,w=new xr,S=new xr;function M(e){w.fromArray(n,3*e),S.copy(w);const t=l[e];x.copy(t),x.sub(w.multiplyScalar(w.dot(t))).normalize(),b.crossVectors(S,t);const i=b.dot(c[e])<0?-1:1;s[4*e]=x.x,s[4*e+1]=x.y,s[4*e+2]=x.z,s[4*e+3]=i}for(let T=0,E=v.length;T<E;++T){const e=v[T],t=e.start;for(let r=t,n=t+e.count;r<n;r+=3)M(i[r+0]),M(i[r+1]),M(i[r+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let i=this.getAttribute("normal");if(void 0===i)i=new Wn(new Float32Array(3*t.count),3),this.setAttribute("normal",i);else for(let e=0,t=i.count;e<t;e++)i.setXYZ(e,0,0,0);const r=new xr,n=new xr,a=new xr,o=new xr,s=new xr,l=new xr,c=new xr,u=new xr;if(e)for(let h=0,p=e.count;h<p;h+=3){const p=e.getX(h+0),d=e.getX(h+1),f=e.getX(h+2);r.fromBufferAttribute(t,p),n.fromBufferAttribute(t,d),a.fromBufferAttribute(t,f),c.subVectors(a,n),u.subVectors(r,n),c.cross(u),o.fromBufferAttribute(i,p),s.fromBufferAttribute(i,d),l.fromBufferAttribute(i,f),o.add(c),s.add(c),l.add(c),i.setXYZ(p,o.x,o.y,o.z),i.setXYZ(d,s.x,s.y,s.z),i.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,h=t.count;e<h;e+=3)r.fromBufferAttribute(t,e+0),n.fromBufferAttribute(t,e+1),a.fromBufferAttribute(t,e+2),c.subVectors(a,n),u.subVectors(r,n),c.cross(u),i.setXYZ(e+0,c.x,c.y,c.z),i.setXYZ(e+1,c.x,c.y,c.z),i.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(e,t){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const i=this.attributes;for(const r in i){if(void 0===e.attributes[r])continue;const n=i[r].array,a=e.attributes[r],o=a.array,s=a.itemSize*t,l=Math.min(o.length,n.length-s);for(let e=0,t=s;e<l;e++,t++)n[t]=o[e]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)ra.fromBufferAttribute(e,t),ra.normalize(),e.setXYZ(t,ra.x,ra.y,ra.z)}toNonIndexed(){function e(e,t){const i=e.array,r=e.itemSize,n=e.normalized,a=new i.constructor(t.length*r);let o=0,s=0;for(let l=0,c=t.length;l<c;l++){o=e.isInterleavedBufferAttribute?t[l]*e.data.stride+e.offset:t[l]*r;for(let e=0;e<r;e++)a[s++]=i[o++]}return new Wn(a,r,n)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new na,i=this.index.array,r=this.attributes;for(const o in r){const n=e(r[o],i);t.setAttribute(o,n)}const n=this.morphAttributes;for(const o in n){const r=[],a=n[o];for(let t=0,n=a.length;t<n;t++){const n=e(a[t],i);r.push(n)}t.morphAttributes[o]=r}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,s=a.length;o<s;o++){const e=a[o];t.addGroup(e.start,e.count,e.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const i in t)void 0!==t[i]&&(e[i]=t[i]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const s in i){const t=i[s];e.data.attributes[s]=t.toJSON(e.data)}const r={};let n=!1;for(const s in this.morphAttributes){const t=this.morphAttributes[s],i=[];for(let r=0,n=t.length;r<n;r++){const n=t[r];i.push(n.toJSON(e.data))}i.length>0&&(r[s]=i,n=!0)}n&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return null!==o&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;null!==i&&this.setIndex(i.clone(t));const r=e.attributes;for(const l in r){const e=r[l];this.setAttribute(l,e.clone(t))}const n=e.morphAttributes;for(const l in n){const e=[],i=n[l];for(let r=0,n=i.length;r<n;r++)e.push(i[r].clone(t));this.morphAttributes[l]=e}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let l=0,c=a.length;l<c;l++){const e=a[l];this.addGroup(e.start,e.count,e.materialIndex)}const o=e.boundingBox;null!==o&&(this.boundingBox=o.clone());const s=e.boundingSphere;return null!==s&&(this.boundingSphere=s.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}na.prototype.isBufferGeometry=!0;const aa=new Kr,oa=new Yr,sa=new $r,la=new xr,ca=new xr,ua=new xr,ha=new xr,pa=new xr,da=new xr,fa=new xr,ma=new xr,ga=new xr,_a=new or,ya=new or,va=new or,xa=new xr,ba=new xr;class wa extends Sn{constructor(e=new na,t=new qn){super(),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const e=t[i[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,i=e.length;t<i;t++){const i=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){const i=this.geometry,r=this.material,n=this.matrixWorld;if(void 0===r)return;if(null===i.boundingSphere&&i.computeBoundingSphere(),sa.copy(i.boundingSphere),sa.applyMatrix4(n),!1===e.ray.intersectsSphere(sa))return;if(aa.copy(n).invert(),oa.copy(e.ray).applyMatrix4(aa),null!==i.boundingBox&&!1===oa.intersectsBox(i.boundingBox))return;let a;if(i.isBufferGeometry){const n=i.index,o=i.attributes.position,s=i.morphAttributes.position,l=i.morphTargetsRelative,c=i.attributes.uv,u=i.attributes.uv2,h=i.groups,p=i.drawRange;if(null!==n)if(Array.isArray(r))for(let i=0,d=h.length;i<d;i++){const d=h[i],f=r[d.materialIndex];for(let i=Math.max(d.start,p.start),r=Math.min(n.count,Math.min(d.start+d.count,p.start+p.count));i<r;i+=3){const r=n.getX(i),h=n.getX(i+1),p=n.getX(i+2);a=Sa(this,f,e,oa,o,s,l,c,u,r,h,p),a&&(a.faceIndex=Math.floor(i/3),a.face.materialIndex=d.materialIndex,t.push(a))}}else{for(let i=Math.max(0,p.start),h=Math.min(n.count,p.start+p.count);i<h;i+=3){const h=n.getX(i),p=n.getX(i+1),d=n.getX(i+2);a=Sa(this,r,e,oa,o,s,l,c,u,h,p,d),a&&(a.faceIndex=Math.floor(i/3),t.push(a))}}else if(void 0!==o)if(Array.isArray(r))for(let i=0,d=h.length;i<d;i++){const n=h[i],d=r[n.materialIndex];for(let i=Math.max(n.start,p.start),r=Math.min(o.count,Math.min(n.start+n.count,p.start+p.count));i<r;i+=3){a=Sa(this,d,e,oa,o,s,l,c,u,i,i+1,i+2),a&&(a.faceIndex=Math.floor(i/3),a.face.materialIndex=n.materialIndex,t.push(a))}}else{for(let i=Math.max(0,p.start),n=Math.min(o.count,p.start+p.count);i<n;i+=3){a=Sa(this,r,e,oa,o,s,l,c,u,i,i+1,i+2),a&&(a.faceIndex=Math.floor(i/3),t.push(a))}}}else i.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function Sa(e,t,i,r,n,a,o,s,l,c,u,h){la.fromBufferAttribute(n,c),ca.fromBufferAttribute(n,u),ua.fromBufferAttribute(n,h);const p=e.morphTargetInfluences;if(a&&p){fa.set(0,0,0),ma.set(0,0,0),ga.set(0,0,0);for(let e=0,t=a.length;e<t;e++){const t=p[e],i=a[e];0!==t&&(ha.fromBufferAttribute(i,c),pa.fromBufferAttribute(i,u),da.fromBufferAttribute(i,h),o?(fa.addScaledVector(ha,t),ma.addScaledVector(pa,t),ga.addScaledVector(da,t)):(fa.addScaledVector(ha.sub(la),t),ma.addScaledVector(pa.sub(ca),t),ga.addScaledVector(da.sub(ua),t)))}la.add(fa),ca.add(ma),ua.add(ga)}e.isSkinnedMesh&&(e.boneTransform(c,la),e.boneTransform(u,ca),e.boneTransform(h,ua));const d=function(e,t,i,r,n,a,o,s){let l;if(l=1===t.side?r.intersectTriangle(o,a,n,!0,s):r.intersectTriangle(n,a,o,2!==t.side,s),null===l)return null;ba.copy(s),ba.applyMatrix4(e.matrixWorld);const c=i.ray.origin.distanceTo(ba);return c<i.near||c>i.far?null:{distance:c,point:ba.clone(),object:e}}(e,t,i,r,la,ca,ua,xa);if(d){s&&(_a.fromBufferAttribute(s,c),ya.fromBufferAttribute(s,u),va.fromBufferAttribute(s,h),d.uv=Ln.getUV(xa,la,ca,ua,_a,ya,va,new or)),l&&(_a.fromBufferAttribute(l,c),ya.fromBufferAttribute(l,u),va.fromBufferAttribute(l,h),d.uv2=Ln.getUV(xa,la,ca,ua,_a,ya,va,new or));const e={a:c,b:u,c:h,normal:new xr,materialIndex:0};Ln.getNormal(la,ca,ua,e.normal),d.face=e}return d}wa.prototype.isMesh=!0;class Ma extends na{constructor(e=1,t=1,i=1,r=1,n=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:n,depthSegments:a};const o=this;r=Math.floor(r),n=Math.floor(n),a=Math.floor(a);const s=[],l=[],c=[],u=[];let h=0,p=0;function d(e,t,i,r,n,a,d,f,m,g,_){const y=a/m,v=d/g,x=a/2,b=d/2,w=f/2,S=m+1,M=g+1;let T=0,E=0;const C=new xr;for(let o=0;o<M;o++){const a=o*v-b;for(let s=0;s<S;s++){const h=s*y-x;C[e]=h*r,C[t]=a*n,C[i]=w,l.push(C.x,C.y,C.z),C[e]=0,C[t]=0,C[i]=f>0?1:-1,c.push(C.x,C.y,C.z),u.push(s/m),u.push(1-o/g),T+=1}}for(let o=0;o<g;o++)for(let e=0;e<m;e++){const t=h+e+S*o,i=h+e+S*(o+1),r=h+(e+1)+S*(o+1),n=h+(e+1)+S*o;s.push(t,i,n),s.push(i,r,n),E+=6}o.addGroup(p,E,_),p+=E,h+=T}d("z","y","x",-1,-1,i,t,e,a,n,0),d("z","y","x",1,-1,i,t,-e,a,n,1),d("x","z","y",1,1,e,i,t,r,a,2),d("x","z","y",1,-1,e,i,-t,r,a,3),d("x","y","z",1,-1,e,t,i,r,n,4),d("x","y","z",-1,-1,e,t,-i,r,n,5),this.setIndex(s),this.setAttribute("position",new Yn(l,3)),this.setAttribute("normal",new Yn(c,3)),this.setAttribute("uv",new Yn(u,2))}static fromJSON(e){return new Ma(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Ta(e){const t={};for(const i in e){t[i]={};for(const r in e[i]){const n=e[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?t[i][r]=n.clone():Array.isArray(n)?t[i][r]=n.slice():t[i][r]=n}}return t}function Ea(e){const t={};for(let i=0;i<e.length;i++){const r=Ta(e[i]);for(const e in r)t[e]=r[e]}return t}const Ca={clone:Ta,merge:Ea};class Aa extends Bn{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Ta(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const i=this.uniforms[r].value;i&&i.isTexture?t.uniforms[r]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[r]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[r]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[r]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[r]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[r]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[r]={type:"m4",value:i.toArray()}:t.uniforms[r]={value:i}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const i={};for(const r in this.extensions)!0===this.extensions[r]&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}Aa.prototype.isShaderMaterial=!0;class Ia extends Sn{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new Kr,this.projectionMatrix=new Kr,this.projectionMatrixInverse=new Kr}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}Ia.prototype.isCamera=!0;class Pa extends Ia{constructor(e=50,t=1,i=.1,r=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Yi*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*Xi*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Yi*Math.atan(Math.tan(.5*Xi*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,r,n,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*Xi*this.fov)/this.zoom,i=2*t,r=this.aspect*i,n=-.5*r;const a=this.view;if(null!==this.view&&this.view.enabled){const e=a.fullWidth,o=a.fullHeight;n+=a.offsetX*r/e,t-=a.offsetY*i/o,r*=a.width/e,i*=a.height/o}const o=this.filmOffset;0!==o&&(n+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+r,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}Pa.prototype.isPerspectiveCamera=!0;const za=90;class Ra extends Sn{constructor(e,t,i){if(super(),this.type="CubeCamera",!0!==i.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=i;const r=new Pa(za,1,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new xr(1,0,0)),this.add(r);const n=new Pa(za,1,e,t);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new xr(-1,0,0)),this.add(n);const a=new Pa(za,1,e,t);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(new xr(0,1,0)),this.add(a);const o=new Pa(za,1,e,t);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new xr(0,-1,0)),this.add(o);const s=new Pa(za,1,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new xr(0,0,1)),this.add(s);const l=new Pa(za,1,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new xr(0,0,-1)),this.add(l)}update(e,t){null===this.parent&&this.updateMatrixWorld();const i=this.renderTarget,[r,n,a,o,s,l]=this.children,c=e.xr.enabled,u=e.getRenderTarget();e.xr.enabled=!1;const h=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,r),e.setRenderTarget(i,1),e.render(t,n),e.setRenderTarget(i,2),e.render(t,a),e.setRenderTarget(i,3),e.render(t,o),e.setRenderTarget(i,4),e.render(t,s),i.texture.generateMipmaps=h,e.setRenderTarget(i,5),e.render(t,l),e.setRenderTarget(u),e.xr.enabled=c}}class ka extends fr{constructor(e,t,i,r,n,a,o,s,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:di,i,r,n,a,o,s,l,c),this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}ka.prototype.isCubeTexture=!0;class La extends _r{constructor(e,t,i){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=i),super(e,e,t),t=t||{},this.texture=new ka(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:xi,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=Ii,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},r=new Ma(5,5,5),n=new Aa({name:"CubemapFromEquirect",uniforms:Ta(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:1,blending:0});n.uniforms.tEquirect.value=t;const a=new wa(r,n),o=t.minFilter;t.minFilter===bi&&(t.minFilter=xi);return new Ra(1,10,this).update(e,a),t.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(e,t,i,r){const n=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,i,r);e.setRenderTarget(n)}}La.prototype.isWebGLCubeRenderTarget=!0;const Da=new xr,Ba=new xr,Fa=new sr;class Oa{constructor(e=new xr(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const r=Da.subVectors(i,t).cross(Ba.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const i=e.delta(Da),r=this.normal.dot(i);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const n=-(e.start.dot(this.normal)+this.constant)/r;return n<0||n>1?null:t.copy(i).multiplyScalar(n).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||Fa.getNormalMatrix(e),r=this.coplanarPoint(Da).applyMatrix4(e),n=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(n),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}Oa.prototype.isPlane=!0;const Na=new $r,Va=new xr;class Ua{constructor(e=new Oa,t=new Oa,i=new Oa,r=new Oa,n=new Oa,a=new Oa){this.planes=[e,t,i,r,n,a]}set(e,t,i,r,n,a){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(i),o[3].copy(r),o[4].copy(n),o[5].copy(a),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){const t=this.planes,i=e.elements,r=i[0],n=i[1],a=i[2],o=i[3],s=i[4],l=i[5],c=i[6],u=i[7],h=i[8],p=i[9],d=i[10],f=i[11],m=i[12],g=i[13],_=i[14],y=i[15];return t[0].setComponents(o-r,u-s,f-h,y-m).normalize(),t[1].setComponents(o+r,u+s,f+h,y+m).normalize(),t[2].setComponents(o+n,u+l,f+p,y+g).normalize(),t[3].setComponents(o-n,u-l,f-p,y-g).normalize(),t[4].setComponents(o-a,u-c,f-d,y-_).normalize(),t[5].setComponents(o+a,u+c,f+d,y+_).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Na.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Na)}intersectsSprite(e){return Na.center.set(0,0,0),Na.radius=.7071067811865476,Na.applyMatrix4(e.matrixWorld),this.intersectsSphere(Na)}intersectsSphere(e){const t=this.planes,i=e.center,r=-e.radius;for(let n=0;n<6;n++){if(t[n].distanceToPoint(i)<r)return!1}return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const r=t[i];if(Va.x=r.normal.x>0?e.max.x:e.min.x,Va.y=r.normal.y>0?e.max.y:e.min.y,Va.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(Va)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function $a(){let e=null,t=!1,i=null,r=null;function n(t,a){i(t,a),r=e.requestAnimationFrame(n)}return{start:function(){!0!==t&&null!==i&&(r=e.requestAnimationFrame(n),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){i=e},setContext:function(t){e=t}}}function ja(e,t){const i=t.isWebGL2,r=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const i=r.get(t);i&&(e.deleteBuffer(i.buffer),r.delete(t))},update:function(t,n){if(t.isGLBufferAttribute){const e=r.get(t);return void((!e||e.version<t.version)&&r.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const a=r.get(t);void 0===a?r.set(t,function(t,r){const n=t.array,a=t.usage,o=e.createBuffer();e.bindBuffer(r,o),e.bufferData(r,n,a),t.onUploadCallback();let s=5126;return n instanceof Float32Array?s=5126:n instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):n instanceof Uint16Array?t.isFloat16BufferAttribute?i?s=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):s=5123:n instanceof Int16Array?s=5122:n instanceof Uint32Array?s=5125:n instanceof Int32Array?s=5124:n instanceof Int8Array?s=5120:(n instanceof Uint8Array||n instanceof Uint8ClampedArray)&&(s=5121),{buffer:o,type:s,bytesPerElement:n.BYTES_PER_ELEMENT,version:t.version}}(t,n)):a.version<t.version&&(!function(t,r,n){const a=r.array,o=r.updateRange;e.bindBuffer(n,t),-1===o.count?e.bufferSubData(n,0,a):(i?e.bufferSubData(n,o.offset*a.BYTES_PER_ELEMENT,a,o.offset,o.count):e.bufferSubData(n,o.offset*a.BYTES_PER_ELEMENT,a.subarray(o.offset,o.offset+o.count)),o.count=-1)}(a.buffer,t,n),a.version=t.version)}}}class qa extends na{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};const n=e/2,a=t/2,o=Math.floor(i),s=Math.floor(r),l=o+1,c=s+1,u=e/o,h=t/s,p=[],d=[],f=[],m=[];for(let g=0;g<c;g++){const e=g*h-a;for(let t=0;t<l;t++){const i=t*u-n;d.push(i,-e,0),f.push(0,0,1),m.push(t/o),m.push(1-g/s)}}for(let g=0;g<s;g++)for(let e=0;e<o;e++){const t=e+l*g,i=e+l*(g+1),r=e+1+l*(g+1),n=e+1+l*g;p.push(t,i,n),p.push(i,r,n)}this.setIndex(p),this.setAttribute("position",new Yn(d,3)),this.setAttribute("normal",new Yn(f,3)),this.setAttribute("uv",new Yn(m,2))}static fromJSON(e){return new qa(e.width,e.height,e.widthSegments,e.heightSegments)}}const Ga={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec;\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\t\treflectVec = reflect( - viewDir, normal );\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#else\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\n\t\t\t#endif\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tlightMapIrradiance *= PI;\n\t#endif\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= specularColorMapTexelToLinear( texture2D( specularColorMap, vUv ) ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= sheenColorMapTexelToLinear( texture2D( sheenColorMap, vUv ) ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1, 2 ) * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform vec2 morphTargetsTextureSize;\n\t\tvec3 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset, const in int stride ) {\n\t\t\tfloat texelIndex = float( vertexIndex * stride + offset );\n\t\t\tfloat y = floor( texelIndex / morphTargetsTextureSize.x );\n\t\t\tfloat x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tvec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );\n\t\t\treturn texture( morphTargetsTexture, morphUV ).xyz;\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\t#ifndef USE_MORPHNORMALS\n\t\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 1 ) * morphTargetInfluences[ i ];\n\t\t\t#else\n\t\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 2 ) * morphTargetInfluences[ i ];\n\t\t\t#endif\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( float roughness, float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 diffuseColor, vec3 specularColor, float specularF90,\n\t\tvec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,\n\t\tvec3 attenuationColor, float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - clearcoat * Fcc ) + clearcoatSpecular * clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},Ha={common:{diffuse:{value:new jn(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new sr},uv2Transform:{value:new sr},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new or(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new jn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new jn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new sr}},sprite:{diffuse:{value:new jn(16777215)},opacity:{value:1},center:{value:new or(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new sr}}},Wa={basic:{uniforms:Ea([Ha.common,Ha.specularmap,Ha.envmap,Ha.aomap,Ha.lightmap,Ha.fog]),vertexShader:Ga.meshbasic_vert,fragmentShader:Ga.meshbasic_frag},lambert:{uniforms:Ea([Ha.common,Ha.specularmap,Ha.envmap,Ha.aomap,Ha.lightmap,Ha.emissivemap,Ha.fog,Ha.lights,{emissive:{value:new jn(0)}}]),vertexShader:Ga.meshlambert_vert,fragmentShader:Ga.meshlambert_frag},phong:{uniforms:Ea([Ha.common,Ha.specularmap,Ha.envmap,Ha.aomap,Ha.lightmap,Ha.emissivemap,Ha.bumpmap,Ha.normalmap,Ha.displacementmap,Ha.fog,Ha.lights,{emissive:{value:new jn(0)},specular:{value:new jn(1118481)},shininess:{value:30}}]),vertexShader:Ga.meshphong_vert,fragmentShader:Ga.meshphong_frag},standard:{uniforms:Ea([Ha.common,Ha.envmap,Ha.aomap,Ha.lightmap,Ha.emissivemap,Ha.bumpmap,Ha.normalmap,Ha.displacementmap,Ha.roughnessmap,Ha.metalnessmap,Ha.fog,Ha.lights,{emissive:{value:new jn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ga.meshphysical_vert,fragmentShader:Ga.meshphysical_frag},toon:{uniforms:Ea([Ha.common,Ha.aomap,Ha.lightmap,Ha.emissivemap,Ha.bumpmap,Ha.normalmap,Ha.displacementmap,Ha.gradientmap,Ha.fog,Ha.lights,{emissive:{value:new jn(0)}}]),vertexShader:Ga.meshtoon_vert,fragmentShader:Ga.meshtoon_frag},matcap:{uniforms:Ea([Ha.common,Ha.bumpmap,Ha.normalmap,Ha.displacementmap,Ha.fog,{matcap:{value:null}}]),vertexShader:Ga.meshmatcap_vert,fragmentShader:Ga.meshmatcap_frag},points:{uniforms:Ea([Ha.points,Ha.fog]),vertexShader:Ga.points_vert,fragmentShader:Ga.points_frag},dashed:{uniforms:Ea([Ha.common,Ha.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ga.linedashed_vert,fragmentShader:Ga.linedashed_frag},depth:{uniforms:Ea([Ha.common,Ha.displacementmap]),vertexShader:Ga.depth_vert,fragmentShader:Ga.depth_frag},normal:{uniforms:Ea([Ha.common,Ha.bumpmap,Ha.normalmap,Ha.displacementmap,{opacity:{value:1}}]),vertexShader:Ga.meshnormal_vert,fragmentShader:Ga.meshnormal_frag},sprite:{uniforms:Ea([Ha.sprite,Ha.fog]),vertexShader:Ga.sprite_vert,fragmentShader:Ga.sprite_frag},background:{uniforms:{uvTransform:{value:new sr},t2D:{value:null}},vertexShader:Ga.background_vert,fragmentShader:Ga.background_frag},cube:{uniforms:Ea([Ha.envmap,{opacity:{value:1}}]),vertexShader:Ga.cube_vert,fragmentShader:Ga.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ga.equirect_vert,fragmentShader:Ga.equirect_frag},distanceRGBA:{uniforms:Ea([Ha.common,Ha.displacementmap,{referencePosition:{value:new xr},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ga.distanceRGBA_vert,fragmentShader:Ga.distanceRGBA_frag},shadow:{uniforms:Ea([Ha.lights,Ha.fog,{color:{value:new jn(0)},opacity:{value:1}}]),vertexShader:Ga.shadow_vert,fragmentShader:Ga.shadow_frag}};function Za(e,t,i,r,n){const a=new jn(0);let o,s,l=0,c=null,u=0,h=null;function p(e,t){i.buffers.color.setClear(e.r,e.g,e.b,t,n)}return{getClearColor:function(){return a},setClearColor:function(e,t=1){a.set(e),l=t,p(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(e){l=e,p(a,l)},render:function(i,n){let d=!1,f=!0===n.isScene?n.background:null;f&&f.isTexture&&(f=t.get(f));const m=e.xr,g=m.getSession&&m.getSession();g&&"additive"===g.environmentBlendMode&&(f=null),null===f?p(a,l):f&&f.isColor&&(p(f,1),d=!0),(e.autoClear||d)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),f&&(f.isCubeTexture||f.mapping===mi)?(void 0===s&&(s=new wa(new Ma(1,1,1),new Aa({name:"BackgroundCubeMaterial",uniforms:Ta(Wa.cube.uniforms),vertexShader:Wa.cube.vertexShader,fragmentShader:Wa.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),s.geometry.deleteAttribute("normal"),s.geometry.deleteAttribute("uv"),s.onBeforeRender=function(e,t,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(s.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(s)),s.material.uniforms.envMap.value=f,s.material.uniforms.flipEnvMap.value=f.isCubeTexture&&!1===f.isRenderTargetTexture?-1:1,c===f&&u===f.version&&h===e.toneMapping||(s.material.needsUpdate=!0,c=f,u=f.version,h=e.toneMapping),i.unshift(s,s.geometry,s.material,0,0,null)):f&&f.isTexture&&(void 0===o&&(o=new wa(new qa(2,2),new Aa({name:"BackgroundMaterial",uniforms:Ta(Wa.background.uniforms),vertexShader:Wa.background.vertexShader,fragmentShader:Wa.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(o)),o.material.uniforms.t2D.value=f,!0===f.matrixAutoUpdate&&f.updateMatrix(),o.material.uniforms.uvTransform.value.copy(f.matrix),c===f&&u===f.version&&h===e.toneMapping||(o.material.needsUpdate=!0,c=f,u=f.version,h=e.toneMapping),i.unshift(o,o.geometry,o.material,0,0,null))}}}function Xa(e,t,i,r){const n=e.getParameter(34921),a=r.isWebGL2?null:t.get("OES_vertex_array_object"),o=r.isWebGL2||null!==a,s={},l=p(null);let c=l;function u(t){return r.isWebGL2?e.bindVertexArray(t):a.bindVertexArrayOES(t)}function h(t){return r.isWebGL2?e.deleteVertexArray(t):a.deleteVertexArrayOES(t)}function p(e){const t=[],i=[],r=[];for(let a=0;a<n;a++)t[a]=0,i[a]=0,r[a]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:i,attributeDivisors:r,object:e,attributes:{},index:null}}function d(){const e=c.newAttributes;for(let t=0,i=e.length;t<i;t++)e[t]=0}function f(e){m(e,0)}function m(i,n){const a=c.newAttributes,o=c.enabledAttributes,s=c.attributeDivisors;if(a[i]=1,0===o[i]&&(e.enableVertexAttribArray(i),o[i]=1),s[i]!==n){(r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,n),s[i]=n}}function g(){const t=c.newAttributes,i=c.enabledAttributes;for(let r=0,n=i.length;r<n;r++)i[r]!==t[r]&&(e.disableVertexAttribArray(r),i[r]=0)}function _(t,i,n,a,o,s){!0!==r.isWebGL2||5124!==n&&5125!==n?e.vertexAttribPointer(t,i,n,a,o,s):e.vertexAttribIPointer(t,i,n,o,s)}function y(){v(),c!==l&&(c=l,u(c.object))}function v(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(n,l,h,y,v){let x=!1;if(o){const t=function(t,i,n){const o=!0===n.wireframe;let l=s[t.id];void 0===l&&(l={},s[t.id]=l);let c=l[i.id];void 0===c&&(c={},l[i.id]=c);let u=c[o];void 0===u&&(u=p(r.isWebGL2?e.createVertexArray():a.createVertexArrayOES()),c[o]=u);return u}(y,h,l);c!==t&&(c=t,u(c.object)),x=function(e,t){const i=c.attributes,r=e.attributes;let n=0;for(const a in r){const e=i[a],t=r[a];if(void 0===e)return!0;if(e.attribute!==t)return!0;if(e.data!==t.data)return!0;n++}return c.attributesNum!==n||c.index!==t}(y,v),x&&function(e,t){const i={},r=e.attributes;let n=0;for(const a in r){const e=r[a],t={};t.attribute=e,e.data&&(t.data=e.data),i[a]=t,n++}c.attributes=i,c.attributesNum=n,c.index=t}(y,v)}else{const e=!0===l.wireframe;c.geometry===y.id&&c.program===h.id&&c.wireframe===e||(c.geometry=y.id,c.program=h.id,c.wireframe=e,x=!0)}!0===n.isInstancedMesh&&(x=!0),null!==v&&i.update(v,34963),x&&(!function(n,a,o,s){if(!1===r.isWebGL2&&(n.isInstancedMesh||s.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;d();const l=s.attributes,c=o.getAttributes(),u=a.defaultAttributeValues;for(const t in c){const r=c[t];if(r.location>=0){let a=l[t];if(void 0===a&&("instanceMatrix"===t&&n.instanceMatrix&&(a=n.instanceMatrix),"instanceColor"===t&&n.instanceColor&&(a=n.instanceColor)),void 0!==a){const t=a.normalized,o=a.itemSize,l=i.get(a);if(void 0===l)continue;const c=l.buffer,u=l.type,h=l.bytesPerElement;if(a.isInterleavedBufferAttribute){const i=a.data,l=i.stride,p=a.offset;if(i&&i.isInstancedInterleavedBuffer){for(let e=0;e<r.locationSize;e++)m(r.location+e,i.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=i.meshPerAttribute*i.count)}else for(let e=0;e<r.locationSize;e++)f(r.location+e);e.bindBuffer(34962,c);for(let e=0;e<r.locationSize;e++)_(r.location+e,o/r.locationSize,u,t,l*h,(p+o/r.locationSize*e)*h)}else{if(a.isInstancedBufferAttribute){for(let e=0;e<r.locationSize;e++)m(r.location+e,a.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=a.meshPerAttribute*a.count)}else for(let e=0;e<r.locationSize;e++)f(r.location+e);e.bindBuffer(34962,c);for(let e=0;e<r.locationSize;e++)_(r.location+e,o/r.locationSize,u,t,o*h,o/r.locationSize*e*h)}}else if(void 0!==u){const i=u[t];if(void 0!==i)switch(i.length){case 2:e.vertexAttrib2fv(r.location,i);break;case 3:e.vertexAttrib3fv(r.location,i);break;case 4:e.vertexAttrib4fv(r.location,i);break;default:e.vertexAttrib1fv(r.location,i)}}}}g()}(n,l,h,y),null!==v&&e.bindBuffer(34963,i.get(v).buffer))},reset:y,resetDefaultState:v,dispose:function(){y();for(const e in s){const t=s[e];for(const e in t){const i=t[e];for(const e in i)h(i[e].object),delete i[e];delete t[e]}delete s[e]}},releaseStatesOfGeometry:function(e){if(void 0===s[e.id])return;const t=s[e.id];for(const i in t){const e=t[i];for(const t in e)h(e[t].object),delete e[t];delete t[i]}delete s[e.id]},releaseStatesOfProgram:function(e){for(const t in s){const i=s[t];if(void 0===i[e.id])continue;const r=i[e.id];for(const e in r)h(r[e].object),delete r[e];delete i[e.id]}},initAttributes:d,enableAttribute:f,disableUnusedAttributes:g}}function Ya(e,t,i,r){const n=r.isWebGL2;let a;this.setMode=function(e){a=e},this.render=function(t,r){e.drawArrays(a,t,r),i.update(r,a,1)},this.renderInstances=function(r,o,s){if(0===s)return;let l,c;if(n)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](a,r,o,s),i.update(o,a,s)}}function Ka(e,t,i){let r;function n(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const a="undefined"!==typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!==typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;let o=void 0!==i.precision?i.precision:"highp";const s=n(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);const l=a||t.has("WEBGL_draw_buffers"),c=!0===i.logarithmicDepthBuffer,u=e.getParameter(34930),h=e.getParameter(35660),p=e.getParameter(3379),d=e.getParameter(34076),f=e.getParameter(34921),m=e.getParameter(36347),g=e.getParameter(36348),_=e.getParameter(36349),y=h>0,v=a||t.has("OES_texture_float");return{isWebGL2:a,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===t.has("EXT_texture_filter_anisotropic")){const i=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:n,precision:o,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:h,maxTextureSize:p,maxCubemapSize:d,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:_,vertexTextures:y,floatFragmentTextures:v,floatVertexTextures:y&&v,maxSamples:a?e.getParameter(36183):0}}function Ja(e){const t=this;let i=null,r=0,n=!1,a=!1;const o=new Oa,s=new sr,l={value:null,needsUpdate:!1};function c(){l.value!==i&&(l.value=i,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function u(e,i,r,n){const a=null!==e?e.length:0;let c=null;if(0!==a){if(c=l.value,!0!==n||null===c){const t=r+4*a,n=i.matrixWorldInverse;s.getNormalMatrix(n),(null===c||c.length<t)&&(c=new Float32Array(t));for(let i=0,l=r;i!==a;++i,l+=4)o.copy(e[i]).applyMatrix4(n,s),o.normal.toArray(c,l),c[l+3]=o.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=a,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,a){const o=0!==e.length||t||0!==r||n;return n=t,i=u(e,a,0),r=e.length,o},this.beginShadows=function(){a=!0,u(null)},this.endShadows=function(){a=!1,c()},this.setState=function(t,o,s){const h=t.clippingPlanes,p=t.clipIntersection,d=t.clipShadows,f=e.get(t);if(!n||null===h||0===h.length||a&&!d)a?u(null):c();else{const e=a?0:r,t=4*e;let n=f.clippingState||null;l.value=n,n=u(h,o,t,s);for(let r=0;r!==t;++r)n[r]=i[r];f.clippingState=n,this.numIntersection=p?this.numPlanes:0,this.numPlanes+=e}}}function Qa(e){let t=new WeakMap;function i(e,t){return 303===t?e.mapping=di:304===t&&(e.mapping=fi),e}function r(e){const i=e.target;i.removeEventListener("dispose",r);const n=t.get(i);void 0!==n&&(t.delete(i),n.dispose())}return{get:function(n){if(n&&n.isTexture&&!1===n.isRenderTargetTexture){const a=n.mapping;if(303===a||304===a){if(t.has(n)){return i(t.get(n).texture,n.mapping)}{const a=n.image;if(a&&a.height>0){const o=e.getRenderTarget(),s=new La(a.height/2);return s.fromEquirectangularTexture(e,n),t.set(n,s),e.setRenderTarget(o),n.addEventListener("dispose",r),i(s.texture,n.mapping)}return null}}}return n},dispose:function(){t=new WeakMap}}}Wa.physical={uniforms:Ea([Wa.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new or(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new jn(0)},sheenColorMap:{value:null},sheenRoughness:{value:0},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new or},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new jn(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularColor:{value:new jn(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Ga.meshphysical_vert,fragmentShader:Ga.meshphysical_frag};class eo extends Ia{constructor(e=-1,t=1,i=1,r=-1,n=.1,a=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=n,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,n,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let n=i-e,a=i+e,o=r+t,s=r-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;n+=e*this.view.offsetX,a=n+e*this.view.width,o-=t*this.view.offsetY,s=o-t*this.view.height}this.projectionMatrix.makeOrthographic(n,a,o,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}eo.prototype.isOrthographicCamera=!0;class to extends Aa{constructor(e){super(e),this.type="RawShaderMaterial"}}to.prototype.isRawShaderMaterial=!0;const io=Math.pow(2,8),ro=[.125,.215,.35,.446,.526,.582],no=5+ro.length,ao=20,oo={[Ni]:0,[Vi]:1,[$i]:2,3004:3,3005:4,3006:5,[Ui]:6},so=new eo,{_lodPlanes:lo,_sizeLods:co,_sigmas:uo}=vo(),ho=new jn;let po=null;const fo=(1+Math.sqrt(5))/2,mo=1/fo,go=[new xr(1,1,1),new xr(-1,1,1),new xr(1,1,-1),new xr(-1,1,-1),new xr(0,fo,mo),new xr(0,fo,-mo),new xr(mo,0,fo),new xr(-mo,0,fo),new xr(fo,mo,0),new xr(-fo,mo,0)];class _o{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=function(e){const t=new Float32Array(e),i=new xr(0,1,0);return new to({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i},inputEncoding:{value:oo[3e3]},outputEncoding:{value:oo[3e3]}},vertexShader:Mo(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t${To()}\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:0,depthTest:!1,depthWrite:!1})}(ao),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){po=this._renderer.getRenderTarget();const n=this._allocateTargets();return this._sceneToCubeUV(e,i,r,n),t>0&&this._blur(n,0,0,t),this._applyPMREM(n),this._cleanup(n),n}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=So(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=wo(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let e=0;e<lo.length;e++)lo[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(po),e.scissorTest=!1,bo(e,0,0,e.width,e.height)}_fromTexture(e){po=this._renderer.getRenderTarget();const t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}_allocateTargets(e){const t={magFilter:vi,minFilter:vi,generateMipmaps:!1,type:wi,format:1023,encoding:yo(e)?e.encoding:$i,depthBuffer:!1},i=xo(t);return i.depthBuffer=!e,this._pingPongRenderTarget=xo(t),i}_compileMaterial(e){const t=new wa(lo[0],e);this._renderer.compile(t,so)}_sceneToCubeUV(e,t,i,r){const n=new Pa(90,1,t,i),a=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],s=this._renderer,l=s.autoClear,c=s.outputEncoding,u=s.toneMapping;s.getClearColor(ho),s.toneMapping=0,s.outputEncoding=Ni,s.autoClear=!1;const h=new qn({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),p=new wa(new Ma,h);let d=!1;const f=e.background;f?f.isColor&&(h.color.copy(f),e.background=null,d=!0):(h.color.copy(ho),d=!0);for(let m=0;m<6;m++){const t=m%3;0==t?(n.up.set(0,a[m],0),n.lookAt(o[m],0,0)):1==t?(n.up.set(0,0,a[m]),n.lookAt(0,o[m],0)):(n.up.set(0,a[m],0),n.lookAt(0,0,o[m])),bo(r,t*io,m>2?io:0,io,io),s.setRenderTarget(r),d&&s.render(p,n),s.render(e,n)}p.geometry.dispose(),p.material.dispose(),s.toneMapping=u,s.outputEncoding=c,s.autoClear=l,e.background=f}_setEncoding(e,t){!0===this._renderer.capabilities.isWebGL2&&t.format===Ii&&t.type===wi&&t.encoding===Vi?e.value=oo[3e3]:e.value=oo[t.encoding]}_textureToCubeUV(e,t){const i=this._renderer,r=e.mapping===di||e.mapping===fi;r?null==this._cubemapShader&&(this._cubemapShader=So()):null==this._equirectShader&&(this._equirectShader=wo());const n=r?this._cubemapShader:this._equirectShader,a=new wa(lo[0],n),o=n.uniforms;o.envMap.value=e,r||o.texelSize.value.set(1/e.image.width,1/e.image.height),this._setEncoding(o.inputEncoding,e),this._setEncoding(o.outputEncoding,t.texture),bo(t,0,0,3*io,2*io),i.setRenderTarget(t),i.render(a,so)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let r=1;r<no;r++){const t=Math.sqrt(uo[r]*uo[r]-uo[r-1]*uo[r-1]),i=go[(r-1)%go.length];this._blur(e,r-1,r,t,i)}t.autoClear=i}_blur(e,t,i,r,n){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,i,r,"latitudinal",n),this._halfBlur(a,e,i,i,r,"longitudinal",n)}_halfBlur(e,t,i,r,n,a,o){const s=this._renderer,l=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new wa(lo[r],l),u=l.uniforms,h=co[i]-1,p=isFinite(n)?Math.PI/(2*h):2*Math.PI/39,d=n/p,f=isFinite(n)?1+Math.floor(3*d):ao;f>ao&&console.warn(`sigmaRadians, ${n}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let y=0;y<ao;++y){const e=y/d,t=Math.exp(-e*e/2);m.push(t),0==y?g+=t:y<f&&(g+=2*t)}for(let y=0;y<m.length;y++)m[y]=m[y]/g;u.envMap.value=e.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value="latitudinal"===a,o&&(u.poleAxis.value=o),u.dTheta.value=p,u.mipInt.value=8-i,this._setEncoding(u.inputEncoding,e.texture),this._setEncoding(u.outputEncoding,e.texture);const _=co[r];bo(t,3*Math.max(0,io-2*_),(0===r?0:2*io)+2*_*(r>4?r-8+4:0),3*_,2*_),s.setRenderTarget(t),s.render(c,so)}}function yo(e){return void 0!==e&&e.type===wi&&(e.encoding===Ni||e.encoding===Vi||e.encoding===Ui)}function vo(){const e=[],t=[],i=[];let r=8;for(let n=0;n<no;n++){const a=Math.pow(2,r);t.push(a);let o=1/a;n>4?o=ro[n-8+4-1]:0==n&&(o=0),i.push(o);const s=1/(a-1),l=-s/2,c=1+s/2,u=[l,l,c,l,c,c,l,l,c,c,l,c],h=6,p=6,d=3,f=2,m=1,g=new Float32Array(d*p*h),_=new Float32Array(f*p*h),y=new Float32Array(m*p*h);for(let e=0;e<h;e++){const t=e%3*2/3-1,i=e>2?0:-1,r=[t,i,0,t+2/3,i,0,t+2/3,i+1,0,t,i,0,t+2/3,i+1,0,t,i+1,0];g.set(r,d*p*e),_.set(u,f*p*e);const n=[e,e,e,e,e,e];y.set(n,m*p*e)}const v=new na;v.setAttribute("position",new Wn(g,d)),v.setAttribute("uv",new Wn(_,f)),v.setAttribute("faceIndex",new Wn(y,m)),e.push(v),r>4&&r--}return{_lodPlanes:e,_sizeLods:t,_sigmas:i}}function xo(e){const t=new _r(3*io,3*io,e);return t.texture.mapping=mi,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function bo(e,t,i,r,n){e.viewport.set(t,i,r,n),e.scissor.set(t,i,r,n)}function wo(){const e=new or(1,1);return new to({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:e},inputEncoding:{value:oo[3e3]},outputEncoding:{value:oo[3e3]}},vertexShader:Mo(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t${To()}\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:0,depthTest:!1,depthWrite:!1})}function So(){return new to({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:oo[3e3]},outputEncoding:{value:oo[3e3]}},vertexShader:Mo(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t${To()}\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:0,depthTest:!1,depthWrite:!1})}function Mo(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function To(){return"\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t"}function Eo(e){let t=new WeakMap,i=null;function r(e){const i=e.target;i.removeEventListener("dispose",r);const n=t.get(i);void 0!==n&&(t.delete(i),n.dispose())}return{get:function(n){if(n&&n.isTexture&&!1===n.isRenderTargetTexture){const a=n.mapping,o=303===a||304===a,s=a===di||a===fi;if(o||s){if(t.has(n))return t.get(n).texture;{const a=n.image;if(o&&a&&a.height>0||s&&a&&function(e){let t=0;const i=6;for(let r=0;r<i;r++)void 0!==e[r]&&t++;return t===i}(a)){const a=e.getRenderTarget();null===i&&(i=new _o(e));const s=o?i.fromEquirectangular(n):i.fromCubemap(n);return t.set(n,s),e.setRenderTarget(a),n.addEventListener("dispose",r),s.texture}return null}}}return n},dispose:function(){t=new WeakMap,null!==i&&(i.dispose(),i=null)}}}function Co(e){const t={};function i(i){if(void 0!==t[i])return t[i];let r;switch(i){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(i)}return t[i]=r,r}return{has:function(e){return null!==i(e)},init:function(e){e.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float")},get:function(e){const t=i(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Ao(e,t,i,r){const n={},a=new WeakMap;function o(e){const s=e.target;null!==s.index&&t.remove(s.index);for(const i in s.attributes)t.remove(s.attributes[i]);s.removeEventListener("dispose",o),delete n[s.id];const l=a.get(s);l&&(t.remove(l),a.delete(s)),r.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,i.memory.geometries--}function s(e){const i=[],r=e.index,n=e.attributes.position;let o=0;if(null!==r){const e=r.array;o=r.version;for(let t=0,r=e.length;t<r;t+=3){const r=e[t+0],n=e[t+1],a=e[t+2];i.push(r,n,n,a,a,r)}}else{const e=n.array;o=n.version;for(let t=0,r=e.length/3-1;t<r;t+=3){const e=t+0,r=t+1,n=t+2;i.push(e,r,r,n,n,e)}}const s=new(lr(i)>65535?Xn:Zn)(i,1);s.version=o;const l=a.get(e);l&&t.remove(l),a.set(e,s)}return{get:function(e,t){return!0===n[t.id]||(t.addEventListener("dispose",o),n[t.id]=!0,i.memory.geometries++),t},update:function(e){const i=e.attributes;for(const n in i)t.update(i[n],34962);const r=e.morphAttributes;for(const n in r){const e=r[n];for(let i=0,r=e.length;i<r;i++)t.update(e[i],34962)}},getWireframeAttribute:function(e){const t=a.get(e);if(t){const i=e.index;null!==i&&t.version<i.version&&s(e)}else s(e);return a.get(e)}}}function Io(e,t,i,r){const n=r.isWebGL2;let a,o,s;this.setMode=function(e){a=e},this.setIndex=function(e){o=e.type,s=e.bytesPerElement},this.render=function(t,r){e.drawElements(a,r,o,t*s),i.update(r,a,1)},this.renderInstances=function(r,l,c){if(0===c)return;let u,h;if(n)u=e,h="drawElementsInstanced";else if(u=t.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[h](a,l,o,r*s,c),i.update(l,a,c)}}function Po(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,i,r){switch(t.calls++,i){case 4:t.triangles+=r*(e/3);break;case 1:t.lines+=r*(e/2);break;case 3:t.lines+=r*(e-1);break;case 2:t.lines+=r*e;break;case 0:t.points+=r*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}class zo extends fr{constructor(e=null,t=1,i=1,r=1){super(null),this.image={data:e,width:t,height:i,depth:r},this.magFilter=vi,this.minFilter=vi,this.wrapR=_i,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}function Ro(e,t){return e[0]-t[0]}function ko(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Lo(e,t){let i=1;const r=t.isInterleavedBufferAttribute?t.data.array:t.array;r instanceof Int8Array?i=127:r instanceof Int16Array?i=32767:r instanceof Int32Array?i=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",r),e.divideScalar(i)}function Do(e,t,i){const r={},n=new Float32Array(8),a=new WeakMap,o=new xr,s=[];for(let l=0;l<8;l++)s[l]=[l,0];return{update:function(l,c,u,h){const p=l.morphTargetInfluences;if(!0===t.isWebGL2){const r=c.morphAttributes.position.length;let n=a.get(c);if(void 0===n||n.count!==r){void 0!==n&&n.texture.dispose();const e=void 0!==c.morphAttributes.normal,i=c.morphAttributes.position,s=c.morphAttributes.normal||[],l=!0===e?2:1;let u=c.attributes.position.count*l,h=1;u>t.maxTextureSize&&(h=Math.ceil(u/t.maxTextureSize),u=t.maxTextureSize);const p=new Float32Array(u*h*4*r),d=new zo(p,u,h,r);d.format=Ii,d.type=Ti;const f=4*l;for(let t=0;t<r;t++){const r=i[t],n=s[t],a=u*h*4*t;for(let t=0;t<r.count;t++){o.fromBufferAttribute(r,t),!0===r.normalized&&Lo(o,r);const i=t*f;p[a+i+0]=o.x,p[a+i+1]=o.y,p[a+i+2]=o.z,p[a+i+3]=0,!0===e&&(o.fromBufferAttribute(n,t),!0===n.normalized&&Lo(o,n),p[a+i+4]=o.x,p[a+i+5]=o.y,p[a+i+6]=o.z,p[a+i+7]=0)}}n={count:r,texture:d,size:new or(u,h)},a.set(c,n)}let s=0;for(let e=0;e<p.length;e++)s+=p[e];const l=c.morphTargetsRelative?1:1-s;h.getUniforms().setValue(e,"morphTargetBaseInfluence",l),h.getUniforms().setValue(e,"morphTargetInfluences",p),h.getUniforms().setValue(e,"morphTargetsTexture",n.texture,i),h.getUniforms().setValue(e,"morphTargetsTextureSize",n.size)}else{const t=void 0===p?0:p.length;let i=r[c.id];if(void 0===i||i.length!==t){i=[];for(let e=0;e<t;e++)i[e]=[e,0];r[c.id]=i}for(let e=0;e<t;e++){const t=i[e];t[0]=e,t[1]=p[e]}i.sort(ko);for(let e=0;e<8;e++)e<t&&i[e][1]?(s[e][0]=i[e][0],s[e][1]=i[e][1]):(s[e][0]=Number.MAX_SAFE_INTEGER,s[e][1]=0);s.sort(Ro);const a=c.morphAttributes.position,o=c.morphAttributes.normal;let l=0;for(let e=0;e<8;e++){const t=s[e],i=t[0],r=t[1];i!==Number.MAX_SAFE_INTEGER&&r?(a&&c.getAttribute("morphTarget"+e)!==a[i]&&c.setAttribute("morphTarget"+e,a[i]),o&&c.getAttribute("morphNormal"+e)!==o[i]&&c.setAttribute("morphNormal"+e,o[i]),n[e]=r,l+=r):(a&&!0===c.hasAttribute("morphTarget"+e)&&c.deleteAttribute("morphTarget"+e),o&&!0===c.hasAttribute("morphNormal"+e)&&c.deleteAttribute("morphNormal"+e),n[e]=0)}const u=c.morphTargetsRelative?1:1-l;h.getUniforms().setValue(e,"morphTargetBaseInfluence",u),h.getUniforms().setValue(e,"morphTargetInfluences",n)}}}}function Bo(e,t,i,r){let n=new WeakMap;function a(e){const t=e.target;t.removeEventListener("dispose",a),i.remove(t.instanceMatrix),null!==t.instanceColor&&i.remove(t.instanceColor)}return{update:function(e){const o=r.render.frame,s=e.geometry,l=t.get(e,s);return n.get(l)!==o&&(t.update(l),n.set(l,o)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",a)&&e.addEventListener("dispose",a),i.update(e.instanceMatrix,34962),null!==e.instanceColor&&i.update(e.instanceColor,34962)),l},dispose:function(){n=new WeakMap}}}zo.prototype.isDataTexture2DArray=!0;class Fo extends fr{constructor(e=null,t=1,i=1,r=1){super(null),this.image={data:e,width:t,height:i,depth:r},this.magFilter=vi,this.minFilter=vi,this.wrapR=_i,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Fo.prototype.isDataTexture3D=!0;const Oo=new fr,No=new zo,Vo=new Fo,Uo=new ka,$o=[],jo=[],qo=new Float32Array(16),Go=new Float32Array(9),Ho=new Float32Array(4);function Wo(e,t,i){const r=e[0];if(r<=0||r>0)return e;const n=t*i;let a=$o[n];if(void 0===a&&(a=new Float32Array(n),$o[n]=a),0!==t){r.toArray(a,0);for(let r=1,n=0;r!==t;++r)n+=i,e[r].toArray(a,n)}return a}function Zo(e,t){if(e.length!==t.length)return!1;for(let i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return!1;return!0}function Xo(e,t){for(let i=0,r=t.length;i<r;i++)e[i]=t[i]}function Yo(e,t){let i=jo[t];void 0===i&&(i=new Int32Array(t),jo[t]=i);for(let r=0;r!==t;++r)i[r]=e.allocateTextureUnit();return i}function Ko(e,t){const i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function Jo(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Zo(i,t))return;e.uniform2fv(this.addr,t),Xo(i,t)}}function Qo(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(void 0!==t.r)i[0]===t.r&&i[1]===t.g&&i[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(Zo(i,t))return;e.uniform3fv(this.addr,t),Xo(i,t)}}function es(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z&&i[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Zo(i,t))return;e.uniform4fv(this.addr,t),Xo(i,t)}}function ts(e,t){const i=this.cache,r=t.elements;if(void 0===r){if(Zo(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),Xo(i,t)}else{if(Zo(i,r))return;Ho.set(r),e.uniformMatrix2fv(this.addr,!1,Ho),Xo(i,r)}}function is(e,t){const i=this.cache,r=t.elements;if(void 0===r){if(Zo(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),Xo(i,t)}else{if(Zo(i,r))return;Go.set(r),e.uniformMatrix3fv(this.addr,!1,Go),Xo(i,r)}}function rs(e,t){const i=this.cache,r=t.elements;if(void 0===r){if(Zo(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),Xo(i,t)}else{if(Zo(i,r))return;qo.set(r),e.uniformMatrix4fv(this.addr,!1,qo),Xo(i,r)}}function ns(e,t){const i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function as(e,t){const i=this.cache;Zo(i,t)||(e.uniform2iv(this.addr,t),Xo(i,t))}function os(e,t){const i=this.cache;Zo(i,t)||(e.uniform3iv(this.addr,t),Xo(i,t))}function ss(e,t){const i=this.cache;Zo(i,t)||(e.uniform4iv(this.addr,t),Xo(i,t))}function ls(e,t){const i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function cs(e,t){const i=this.cache;Zo(i,t)||(e.uniform2uiv(this.addr,t),Xo(i,t))}function us(e,t){const i=this.cache;Zo(i,t)||(e.uniform3uiv(this.addr,t),Xo(i,t))}function hs(e,t){const i=this.cache;Zo(i,t)||(e.uniform4uiv(this.addr,t),Xo(i,t))}function ps(e,t,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.safeSetTexture2D(t||Oo,n)}function ds(e,t,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(t||Vo,n)}function fs(e,t,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.safeSetTextureCube(t||Uo,n)}function ms(e,t,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2DArray(t||No,n)}function gs(e,t){e.uniform1fv(this.addr,t)}function _s(e,t){const i=Wo(t,this.size,2);e.uniform2fv(this.addr,i)}function ys(e,t){const i=Wo(t,this.size,3);e.uniform3fv(this.addr,i)}function vs(e,t){const i=Wo(t,this.size,4);e.uniform4fv(this.addr,i)}function xs(e,t){const i=Wo(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function bs(e,t){const i=Wo(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function ws(e,t){const i=Wo(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function Ss(e,t){e.uniform1iv(this.addr,t)}function Ms(e,t){e.uniform2iv(this.addr,t)}function Ts(e,t){e.uniform3iv(this.addr,t)}function Es(e,t){e.uniform4iv(this.addr,t)}function Cs(e,t){e.uniform1uiv(this.addr,t)}function As(e,t){e.uniform2uiv(this.addr,t)}function Is(e,t){e.uniform3uiv(this.addr,t)}function Ps(e,t){e.uniform4uiv(this.addr,t)}function zs(e,t,i){const r=t.length,n=Yo(i,r);e.uniform1iv(this.addr,n);for(let a=0;a!==r;++a)i.safeSetTexture2D(t[a]||Oo,n[a])}function Rs(e,t,i){const r=t.length,n=Yo(i,r);e.uniform1iv(this.addr,n);for(let a=0;a!==r;++a)i.safeSetTextureCube(t[a]||Uo,n[a])}function ks(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Ko;case 35664:return Jo;case 35665:return Qo;case 35666:return es;case 35674:return ts;case 35675:return is;case 35676:return rs;case 5124:case 35670:return ns;case 35667:case 35671:return as;case 35668:case 35672:return os;case 35669:case 35673:return ss;case 5125:return ls;case 36294:return cs;case 36295:return us;case 36296:return hs;case 35678:case 36198:case 36298:case 36306:case 35682:return ps;case 35679:case 36299:case 36307:return ds;case 35680:case 36300:case 36308:case 36293:return fs;case 36289:case 36303:case 36311:case 36292:return ms}}(t.type)}function Ls(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return gs;case 35664:return _s;case 35665:return ys;case 35666:return vs;case 35674:return xs;case 35675:return bs;case 35676:return ws;case 5124:case 35670:return Ss;case 35667:case 35671:return Ms;case 35668:case 35672:return Ts;case 35669:case 35673:return Es;case 5125:return Cs;case 36294:return As;case 36295:return Is;case 36296:return Ps;case 35678:case 36198:case 36298:case 36306:case 35682:return zs;case 35680:case 36300:case 36308:case 36293:return Rs}}(t.type)}function Ds(e){this.id=e,this.seq=[],this.map={}}Ls.prototype.updateCache=function(e){const t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),Xo(t,e)},Ds.prototype.setValue=function(e,t,i){const r=this.seq;for(let n=0,a=r.length;n!==a;++n){const a=r[n];a.setValue(e,t[a.id],i)}};const Bs=/(\w+)(\])?(\[|\.)?/g;function Fs(e,t){e.seq.push(t),e.map[t.id]=t}function Os(e,t,i){const r=e.name,n=r.length;for(Bs.lastIndex=0;;){const a=Bs.exec(r),o=Bs.lastIndex;let s=a[1];const l="]"===a[2],c=a[3];if(l&&(s|=0),void 0===c||"["===c&&o+2===n){Fs(i,void 0===c?new ks(s,e,t):new Ls(s,e,t));break}{let e=i.map[s];void 0===e&&(e=new Ds(s),Fs(i,e)),i=e}}}function Ns(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,35718);for(let r=0;r<i;++r){const i=e.getActiveUniform(t,r);Os(i,e.getUniformLocation(t,i.name),this)}}function Vs(e,t,i){const r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),r}Ns.prototype.setValue=function(e,t,i,r){const n=this.map[t];void 0!==n&&n.setValue(e,i,r)},Ns.prototype.setOptional=function(e,t,i){const r=t[i];void 0!==r&&this.setValue(e,i,r)},Ns.upload=function(e,t,i,r){for(let n=0,a=t.length;n!==a;++n){const a=t[n],o=i[a.id];!1!==o.needsUpdate&&a.setValue(e,o.value,r)}},Ns.seqWithValue=function(e,t){const i=[];for(let r=0,n=e.length;r!==n;++r){const n=e[r];n.id in t&&i.push(n)}return i};let Us=0;function $s(e){switch(e){case Ni:return["Linear","( value )"];case Vi:return["sRGB","( value )"];case $i:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case Ui:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function js(e,t,i){const r=e.getShaderParameter(t,35713),n=e.getShaderInfoLog(t).trim();return r&&""===n?"":i.toUpperCase()+"\n\n"+n+"\n\n"+function(e){const t=e.split("\n");for(let i=0;i<t.length;i++)t[i]=i+1+": "+t[i];return t.join("\n")}(e.getShaderSource(t))}function qs(e,t){const i=$s(t);return"vec4 "+e+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function Gs(e,t){const i=$s(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function Hs(e,t){let i;switch(t){case 1:i="Linear";break;case 2:i="Reinhard";break;case 3:i="OptimizedCineon";break;case 4:i="ACESFilmic";break;case 5:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function Ws(e){return""!==e}function Zs(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Xs(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const Ys=/^[ \t]*#include +<([\w\d./]+)>/gm;function Ks(e){return e.replace(Ys,Js)}function Js(e,t){const i=Ga[t];if(void 0===i)throw new Error("Can not resolve #include <"+t+">");return Ks(i)}const Qs=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,el=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function tl(e){return e.replace(el,rl).replace(Qs,il)}function il(e,t,i,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),rl(e,t,i,r)}function rl(e,t,i,r){let n="";for(let a=parseInt(t);a<parseInt(i);a++)n+=r.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return n}function nl(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function al(e,t,i,r){const n=e.getContext(),a=i.defines;let o=i.vertexShader,s=i.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(i),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case di:case fi:t="ENVMAP_TYPE_CUBE";break;case mi:case 307:t="ENVMAP_TYPE_CUBE_UV"}return t}(i),u=function(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case fi:case 307:t="ENVMAP_MODE_REFRACTION"}return t}(i),h=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(i),p=e.gammaFactor>0?e.gammaFactor:1,d=i.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Ws).join("\n")}(i),f=function(e){const t=[];for(const i in e){const r=e[i];!1!==r&&t.push("#define "+i+" "+r)}return t.join("\n")}(a),m=n.createProgram();let g,_,y=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(g=[f].filter(Ws).join("\n"),g.length>0&&(g+="\n"),_=[d,f].filter(Ws).join("\n"),_.length>0&&(_+="\n")):(g=[nl(i),"#define SHADER_NAME "+i.shaderName,f,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+p,"#define MAX_BONES "+i.maxBones,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.morphTargets&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargets&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Ws).join("\n"),_=[d,nl(i),"#define SHADER_NAME "+i.shaderName,f,"#define GAMMA_FACTOR "+p,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+u:"",i.envMap?"#define "+h:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(i.extensionShaderTextureLOD||i.envMap)&&i.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==i.toneMapping?"#define TONE_MAPPING":"",0!==i.toneMapping?Ga.tonemapping_pars_fragment:"",0!==i.toneMapping?Hs("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.format===Ai?"#define OPAQUE":"",Ga.encodings_pars_fragment,i.map?qs("mapTexelToLinear",i.mapEncoding):"",i.matcap?qs("matcapTexelToLinear",i.matcapEncoding):"",i.envMap?qs("envMapTexelToLinear",i.envMapEncoding):"",i.emissiveMap?qs("emissiveMapTexelToLinear",i.emissiveMapEncoding):"",i.specularColorMap?qs("specularColorMapTexelToLinear",i.specularColorMapEncoding):"",i.sheenColorMap?qs("sheenColorMapTexelToLinear",i.sheenColorMapEncoding):"",i.lightMap?qs("lightMapTexelToLinear",i.lightMapEncoding):"",Gs("linearToOutputTexel",i.outputEncoding),i.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(Ws).join("\n")),o=Ks(o),o=Zs(o,i),o=Xs(o,i),s=Ks(s),s=Zs(s,i),s=Xs(s,i),o=tl(o),s=tl(s),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(y="#version 300 es\n",g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,_=["#define varying in",i.glslVersion===Hi?"":"out highp vec4 pc_fragColor;",i.glslVersion===Hi?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+_);const v=y+_+s,x=Vs(n,35633,y+g+o),b=Vs(n,35632,v);if(n.attachShader(m,x),n.attachShader(m,b),void 0!==i.index0AttributeName?n.bindAttribLocation(m,0,i.index0AttributeName):!0===i.morphTargets&&n.bindAttribLocation(m,0,"position"),n.linkProgram(m),e.debug.checkShaderErrors){const e=n.getProgramInfoLog(m).trim(),t=n.getShaderInfoLog(x).trim(),i=n.getShaderInfoLog(b).trim();let r=!0,a=!0;if(!1===n.getProgramParameter(m,35714)){r=!1;const t=js(n,x,"vertex"),i=js(n,b,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(m,35715)+"\n\nProgram Info Log: "+e+"\n"+t+"\n"+i)}else""!==e?console.warn("THREE.WebGLProgram: Program Info Log:",e):""!==t&&""!==i||(a=!1);a&&(this.diagnostics={runnable:r,programLog:e,vertexShader:{log:t,prefix:g},fragmentShader:{log:i,prefix:_}})}let w,S;return n.deleteShader(x),n.deleteShader(b),this.getUniforms=function(){return void 0===w&&(w=new Ns(n,m)),w},this.getAttributes=function(){return void 0===S&&(S=function(e,t){const i={},r=e.getProgramParameter(t,35721);for(let n=0;n<r;n++){const r=e.getActiveAttrib(t,n),a=r.name;let o=1;35674===r.type&&(o=2),35675===r.type&&(o=3),35676===r.type&&(o=4),i[a]={type:r.type,location:e.getAttribLocation(t,a),locationSize:o}}return i}(n,m)),S},this.destroy=function(){r.releaseStatesOfProgram(this),n.deleteProgram(m),this.program=void 0},this.name=i.shaderName,this.id=Us++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=x,this.fragmentShader=b,this}function ol(e,t,i,r,n,a,o){const s=[],l=n.isWebGL2,c=n.logarithmicDepthBuffer,u=n.floatVertexTextures,h=n.maxVertexUniforms,p=n.vertexTextures;let d=n.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},m=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoat","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap",,"roughnessMap","metalnessMap","gradientMap","alphaMap","alphaTest","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","morphTargetsCount","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","format","specularIntensityMap","specularColorMap","specularColorMapEncoding","transmission","transmissionMap","thicknessMap","sheen","sheenColorMap","sheenColorMapEncoding","sheenRoughnessMap"];function g(e){let t;return e&&e.isTexture?t=e.encoding:e&&e.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=Ni,l&&e&&e.isTexture&&e.format===Ii&&e.type===wi&&e.encoding===Vi&&(t=Ni),t}return{getParameters:function(a,s,m,_,y){const v=_.fog,x=a.isMeshStandardMaterial?_.environment:null,b=(a.isMeshStandardMaterial?i:t).get(a.envMap||x),w=f[a.type],S=y.isSkinnedMesh?function(e){const t=e.skeleton.bones;if(u)return 1024;{const e=h,i=Math.floor((e-20)/4),r=Math.min(i,t.length);return r<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+r+"."),0):r}}(y):0;let M,T;if(null!==a.precision&&(d=n.getMaxPrecision(a.precision),d!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",d,"instead.")),w){const e=Wa[w];M=e.vertexShader,T=e.fragmentShader}else M=a.vertexShader,T=a.fragmentShader;const E=e.getRenderTarget(),C=a.alphaTest>0,A=a.clearcoat>0;return{isWebGL2:l,shaderID:w,shaderName:a.type,vertexShader:M,fragmentShader:T,defines:a.defines,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:d,instancing:!0===y.isInstancedMesh,instancingColor:!0===y.isInstancedMesh&&null!==y.instanceColor,supportsVertexTextures:p,outputEncoding:null!==E?g(E.texture):e.outputEncoding,map:!!a.map,mapEncoding:g(a.map),matcap:!!a.matcap,matcapEncoding:g(a.matcap),envMap:!!b,envMapMode:b&&b.mapping,envMapEncoding:g(b),envMapCubeUV:!!b&&(b.mapping===mi||307===b.mapping),lightMap:!!a.lightMap,lightMapEncoding:g(a.lightMap),aoMap:!!a.aoMap,emissiveMap:!!a.emissiveMap,emissiveMapEncoding:g(a.emissiveMap),bumpMap:!!a.bumpMap,normalMap:!!a.normalMap,objectSpaceNormalMap:1===a.normalMapType,tangentSpaceNormalMap:0===a.normalMapType,clearcoat:A,clearcoatMap:A&&!!a.clearcoatMap,clearcoatRoughnessMap:A&&!!a.clearcoatRoughnessMap,clearcoatNormalMap:A&&!!a.clearcoatNormalMap,displacementMap:!!a.displacementMap,roughnessMap:!!a.roughnessMap,metalnessMap:!!a.metalnessMap,specularMap:!!a.specularMap,specularIntensityMap:!!a.specularIntensityMap,specularColorMap:!!a.specularColorMap,specularColorMapEncoding:g(a.specularColorMap),alphaMap:!!a.alphaMap,alphaTest:C,gradientMap:!!a.gradientMap,sheen:a.sheen>0,sheenColorMap:!!a.sheenColorMap,sheenColorMapEncoding:g(a.sheenColorMap),sheenRoughnessMap:!!a.sheenRoughnessMap,transmission:a.transmission>0,transmissionMap:!!a.transmissionMap,thicknessMap:!!a.thicknessMap,combine:a.combine,vertexTangents:!!a.normalMap&&!!y.geometry&&!!y.geometry.attributes.tangent,vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!y.geometry&&!!y.geometry.attributes.color&&4===y.geometry.attributes.color.itemSize,vertexUvs:!!a.map||!!a.bumpMap||!!a.normalMap||!!a.specularMap||!!a.alphaMap||!!a.emissiveMap||!!a.roughnessMap||!!a.metalnessMap||!!a.clearcoatMap||!!a.clearcoatRoughnessMap||!!a.clearcoatNormalMap||!!a.displacementMap||!!a.transmissionMap||!!a.thicknessMap||!!a.specularIntensityMap||!!a.specularColorMap||!!a.sheenColorMap||a.sheenRoughnessMap,uvsVertexOnly:!(a.map||a.bumpMap||a.normalMap||a.specularMap||a.alphaMap||a.emissiveMap||a.roughnessMap||a.metalnessMap||a.clearcoatNormalMap||a.transmission>0||a.transmissionMap||a.thicknessMap||a.specularIntensityMap||a.specularColorMap||!!a.sheen>0||a.sheenColorMap||a.sheenRoughnessMap)&&!!a.displacementMap,fog:!!v,useFog:a.fog,fogExp2:v&&v.isFogExp2,flatShading:!!a.flatShading,sizeAttenuation:a.sizeAttenuation,logarithmicDepthBuffer:c,skinning:!0===y.isSkinnedMesh&&S>0,maxBones:S,useVertexTexture:u,morphTargets:!!y.geometry&&!!y.geometry.morphAttributes.position,morphNormals:!!y.geometry&&!!y.geometry.morphAttributes.normal,morphTargetsCount:y.geometry&&y.geometry.morphAttributes.position?y.geometry.morphAttributes.position.length:0,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,format:a.format,dithering:a.dithering,shadowMapEnabled:e.shadowMap.enabled&&m.length>0,shadowMapType:e.shadowMap.type,toneMapping:a.toneMapped?e.toneMapping:0,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:a.premultipliedAlpha,doubleSided:2===a.side,flipSided:1===a.side,depthPacking:void 0!==a.depthPacking&&a.depthPacking,index0AttributeName:a.index0AttributeName,extensionDerivatives:a.extensions&&a.extensions.derivatives,extensionFragDepth:a.extensions&&a.extensions.fragDepth,extensionDrawBuffers:a.extensions&&a.extensions.drawBuffers,extensionShaderTextureLOD:a.extensions&&a.extensions.shaderTextureLOD,rendererExtensionFragDepth:l||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:l||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:l||r.has("EXT_shader_texture_lod"),customProgramCacheKey:a.customProgramCacheKey()}},getProgramCacheKey:function(t){const i=[];if(t.shaderID?i.push(t.shaderID):(i.push(ur(t.fragmentShader)),i.push(ur(t.vertexShader))),void 0!==t.defines)for(const e in t.defines)i.push(e),i.push(t.defines[e]);if(!1===t.isRawShaderMaterial){for(let e=0;e<m.length;e++)i.push(t[m[e]]);i.push(e.outputEncoding),i.push(e.gammaFactor)}return i.push(t.customProgramCacheKey),i.join()},getUniforms:function(e){const t=f[e.type];let i;if(t){const e=Wa[t];i=Ca.clone(e.uniforms)}else i=e.uniforms;return i},acquireProgram:function(t,i){let r;for(let e=0,n=s.length;e<n;e++){const t=s[e];if(t.cacheKey===i){r=t,++r.usedTimes;break}}return void 0===r&&(r=new al(e,i,t,a),s.push(r)),r},releaseProgram:function(e){if(0===--e.usedTimes){const t=s.indexOf(e);s[t]=s[s.length-1],s.pop(),e.destroy()}},programs:s}}function sl(){let e=new WeakMap;return{get:function(t){let i=e.get(t);return void 0===i&&(i={},e.set(t,i)),i},remove:function(t){e.delete(t)},update:function(t,i,r){e.get(t)[i]=r},dispose:function(){e=new WeakMap}}}function ll(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function cl(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function ul(e){const t=[];let i=0;const r=[],n=[],a=[],o={id:-1};function s(r,n,a,s,l,c){let u=t[i];const h=e.get(a);return void 0===u?(u={id:r.id,object:r,geometry:n,material:a,program:h.program||o,groupOrder:s,renderOrder:r.renderOrder,z:l,group:c},t[i]=u):(u.id=r.id,u.object=r,u.geometry=n,u.material=a,u.program=h.program||o,u.groupOrder=s,u.renderOrder=r.renderOrder,u.z=l,u.group=c),i++,u}return{opaque:r,transmissive:n,transparent:a,init:function(){i=0,r.length=0,n.length=0,a.length=0},push:function(e,t,i,o,l,c){const u=s(e,t,i,o,l,c);i.transmission>0?n.push(u):!0===i.transparent?a.push(u):r.push(u)},unshift:function(e,t,i,o,l,c){const u=s(e,t,i,o,l,c);i.transmission>0?n.unshift(u):!0===i.transparent?a.unshift(u):r.unshift(u)},finish:function(){for(let e=i,r=t.length;e<r;e++){const i=t[e];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.program=null,i.group=null}},sort:function(e,t){r.length>1&&r.sort(e||ll),n.length>1&&n.sort(t||cl),a.length>1&&a.sort(t||cl)}}}function hl(e){let t=new WeakMap;return{get:function(i,r){let n;return!1===t.has(i)?(n=new ul(e),t.set(i,[n])):r>=t.get(i).length?(n=new ul(e),t.get(i).push(n)):n=t.get(i)[r],n},dispose:function(){t=new WeakMap}}}function pl(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new xr,color:new jn};break;case"SpotLight":i={position:new xr,direction:new xr,color:new jn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new xr,color:new jn,distance:0,decay:0};break;case"HemisphereLight":i={direction:new xr,skyColor:new jn,groundColor:new jn};break;case"RectAreaLight":i={color:new jn,position:new xr,halfWidth:new xr,halfHeight:new xr}}return e[t.id]=i,i}}}let dl=0;function fl(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function ml(e,t){const i=new pl,r=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let i;switch(t.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new or};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new or,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=i,i}}}(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let l=0;l<9;l++)n.probe.push(new xr);const a=new xr,o=new Kr,s=new Kr;return{setup:function(a,o){let s=0,l=0,c=0;for(let e=0;e<9;e++)n.probe[e].set(0,0,0);let u=0,h=0,p=0,d=0,f=0,m=0,g=0,_=0;a.sort(fl);const y=!0!==o?Math.PI:1;for(let e=0,t=a.length;e<t;e++){const t=a[e],o=t.color,v=t.intensity,x=t.distance,b=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)s+=o.r*v*y,l+=o.g*v*y,c+=o.b*v*y;else if(t.isLightProbe)for(let e=0;e<9;e++)n.probe[e].addScaledVector(t.sh.coefficients[e],v);else if(t.isDirectionalLight){const e=i.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*y),t.castShadow){const e=t.shadow,i=r.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,n.directionalShadow[u]=i,n.directionalShadowMap[u]=b,n.directionalShadowMatrix[u]=t.shadow.matrix,m++}n.directional[u]=e,u++}else if(t.isSpotLight){const e=i.get(t);if(e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(o).multiplyScalar(v*y),e.distance=x,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,t.castShadow){const e=t.shadow,i=r.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,n.spotShadow[p]=i,n.spotShadowMap[p]=b,n.spotShadowMatrix[p]=t.shadow.matrix,_++}n.spot[p]=e,p++}else if(t.isRectAreaLight){const e=i.get(t);e.color.copy(o).multiplyScalar(v),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),n.rectArea[d]=e,d++}else if(t.isPointLight){const e=i.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*y),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,i=r.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,i.shadowCameraNear=e.camera.near,i.shadowCameraFar=e.camera.far,n.pointShadow[h]=i,n.pointShadowMap[h]=b,n.pointShadowMatrix[h]=t.shadow.matrix,g++}n.point[h]=e,h++}else if(t.isHemisphereLight){const e=i.get(t);e.skyColor.copy(t.color).multiplyScalar(v*y),e.groundColor.copy(t.groundColor).multiplyScalar(v*y),n.hemi[f]=e,f++}}d>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(n.rectAreaLTC1=Ha.LTC_FLOAT_1,n.rectAreaLTC2=Ha.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(n.rectAreaLTC1=Ha.LTC_HALF_1,n.rectAreaLTC2=Ha.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),n.ambient[0]=s,n.ambient[1]=l,n.ambient[2]=c;const v=n.hash;v.directionalLength===u&&v.pointLength===h&&v.spotLength===p&&v.rectAreaLength===d&&v.hemiLength===f&&v.numDirectionalShadows===m&&v.numPointShadows===g&&v.numSpotShadows===_||(n.directional.length=u,n.spot.length=p,n.rectArea.length=d,n.point.length=h,n.hemi.length=f,n.directionalShadow.length=m,n.directionalShadowMap.length=m,n.pointShadow.length=g,n.pointShadowMap.length=g,n.spotShadow.length=_,n.spotShadowMap.length=_,n.directionalShadowMatrix.length=m,n.pointShadowMatrix.length=g,n.spotShadowMatrix.length=_,v.directionalLength=u,v.pointLength=h,v.spotLength=p,v.rectAreaLength=d,v.hemiLength=f,v.numDirectionalShadows=m,v.numPointShadows=g,v.numSpotShadows=_,n.version=dl++)},setupView:function(e,t){let i=0,r=0,l=0,c=0,u=0;const h=t.matrixWorldInverse;for(let p=0,d=e.length;p<d;p++){const t=e[p];if(t.isDirectionalLight){const e=n.directional[i];e.direction.setFromMatrixPosition(t.matrixWorld),a.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(a),e.direction.transformDirection(h),i++}else if(t.isSpotLight){const e=n.spot[l];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(h),e.direction.setFromMatrixPosition(t.matrixWorld),a.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(a),e.direction.transformDirection(h),l++}else if(t.isRectAreaLight){const e=n.rectArea[c];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(h),s.identity(),o.copy(t.matrixWorld),o.premultiply(h),s.extractRotation(o),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),e.halfWidth.applyMatrix4(s),e.halfHeight.applyMatrix4(s),c++}else if(t.isPointLight){const e=n.point[r];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(h),r++}else if(t.isHemisphereLight){const e=n.hemi[u];e.direction.setFromMatrixPosition(t.matrixWorld),e.direction.transformDirection(h),e.direction.normalize(),u++}}},state:n}}function gl(e,t){const i=new ml(e,t),r=[],n=[];return{init:function(){r.length=0,n.length=0},state:{lightsArray:r,shadowsArray:n,lights:i},setupLights:function(e){i.setup(r,e)},setupLightsView:function(e){i.setupView(r,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){n.push(e)}}}function _l(e,t){let i=new WeakMap;return{get:function(r,n=0){let a;return!1===i.has(r)?(a=new gl(e,t),i.set(r,[a])):n>=i.get(r).length?(a=new gl(e,t),i.get(r).push(a)):a=i.get(r)[n],a},dispose:function(){i=new WeakMap}}}class yl extends Bn{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}yl.prototype.isMeshDepthMaterial=!0;class vl extends Bn{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new xr,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}vl.prototype.isMeshDistanceMaterial=!0;function xl(e,t,i){let r=new Ua;const n=new or,a=new or,o=new gr,s=new yl({depthPacking:3201}),l=new vl,c={},u=i.maxTextureSize,h={0:1,1:0,2:2},p=new Aa({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new or},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),d=p.clone();d.defines.HORIZONTAL_PASS=1;const f=new na;f.setAttribute("position",new Wn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new wa(f,p),g=this;function _(i,r){const n=t.update(m);p.defines.VSM_SAMPLES!==i.blurSamples&&(p.defines.VSM_SAMPLES=i.blurSamples,d.defines.VSM_SAMPLES=i.blurSamples,p.needsUpdate=!0,d.needsUpdate=!0),p.uniforms.shadow_pass.value=i.map.texture,p.uniforms.resolution.value=i.mapSize,p.uniforms.radius.value=i.radius,e.setRenderTarget(i.mapPass),e.clear(),e.renderBufferDirect(r,null,n,p,m,null),d.uniforms.shadow_pass.value=i.mapPass.texture,d.uniforms.resolution.value=i.mapSize,d.uniforms.radius.value=i.radius,e.setRenderTarget(i.map),e.clear(),e.renderBufferDirect(r,null,n,d,m,null)}function y(t,i,r,n,a,o,u){let p=null;const d=!0===n.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(p=void 0!==d?d:!0===n.isPointLight?l:s,e.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length||r.displacementMap&&0!==r.displacementScale||r.alphaMap&&r.alphaTest>0){const e=p.uuid,t=r.uuid;let i=c[e];void 0===i&&(i={},c[e]=i);let n=i[t];void 0===n&&(n=p.clone(),i[t]=n),p=n}return p.visible=r.visible,p.wireframe=r.wireframe,p.side=3===u?null!==r.shadowSide?r.shadowSide:r.side:null!==r.shadowSide?r.shadowSide:h[r.side],p.alphaMap=r.alphaMap,p.alphaTest=r.alphaTest,p.clipShadows=r.clipShadows,p.clippingPlanes=r.clippingPlanes,p.clipIntersection=r.clipIntersection,p.displacementMap=r.displacementMap,p.displacementScale=r.displacementScale,p.displacementBias=r.displacementBias,p.wireframeLinewidth=r.wireframeLinewidth,p.linewidth=r.linewidth,!0===n.isPointLight&&!0===p.isMeshDistanceMaterial&&(p.referencePosition.setFromMatrixPosition(n.matrixWorld),p.nearDistance=a,p.farDistance=o),p}function v(i,n,a,o,s){if(!1===i.visible)return;if(i.layers.test(n.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&3===s)&&(!i.frustumCulled||r.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,i.matrixWorld);const r=t.update(i),n=i.material;if(Array.isArray(n)){const t=r.groups;for(let l=0,c=t.length;l<c;l++){const c=t[l],u=n[c.materialIndex];if(u&&u.visible){const t=y(i,0,u,o,a.near,a.far,s);e.renderBufferDirect(a,null,r,t,i,c)}}}else if(n.visible){const t=y(i,0,n,o,a.near,a.far,s);e.renderBufferDirect(a,null,r,t,i,null)}}const l=i.children;for(let e=0,t=l.length;e<t;e++)v(l[e],n,a,o,s)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(t,i,s){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),p=e.state;p.setBlending(0),p.buffers.color.setClear(1,1,1,1),p.buffers.depth.setTest(!0),p.setScissorTest(!1);for(let d=0,f=t.length;d<f;d++){const l=t[d],c=l.shadow;if(void 0===c){console.warn("THREE.WebGLShadowMap:",l,"has no shadow.");continue}if(!1===c.autoUpdate&&!1===c.needsUpdate)continue;n.copy(c.mapSize);const h=c.getFrameExtents();if(n.multiply(h),a.copy(c.mapSize),(n.x>u||n.y>u)&&(n.x>u&&(a.x=Math.floor(u/h.x),n.x=a.x*h.x,c.mapSize.x=a.x),n.y>u&&(a.y=Math.floor(u/h.y),n.y=a.y*h.y,c.mapSize.y=a.y)),null===c.map&&!c.isPointLightShadow&&3===this.type){const e={minFilter:xi,magFilter:xi,format:Ii};c.map=new _r(n.x,n.y,e),c.map.texture.name=l.name+".shadowMap",c.mapPass=new _r(n.x,n.y,e),c.camera.updateProjectionMatrix()}if(null===c.map){const e={minFilter:vi,magFilter:vi,format:Ii};c.map=new _r(n.x,n.y,e),c.map.texture.name=l.name+".shadowMap",c.camera.updateProjectionMatrix()}e.setRenderTarget(c.map),e.clear();const f=c.getViewportCount();for(let e=0;e<f;e++){const t=c.getViewport(e);o.set(a.x*t.x,a.y*t.y,a.x*t.z,a.y*t.w),p.viewport(o),c.updateMatrices(l,e),r=c.getFrustum(),v(i,s,c.camera,l,this.type)}c.isPointLightShadow||3!==this.type||_(c,s),c.needsUpdate=!1}g.needsUpdate=!1,e.setRenderTarget(l,c,h)}}function bl(e,t,i){const r=i.isWebGL2;const n=new function(){let t=!1;const i=new gr;let r=null;const n=new gr(0,0,0,0);return{setMask:function(i){r===i||t||(e.colorMask(i,i,i,i),r=i)},setLocked:function(e){t=e},setClear:function(t,r,a,o,s){!0===s&&(t*=o,r*=o,a*=o),i.set(t,r,a,o),!1===n.equals(i)&&(e.clearColor(t,r,a,o),n.copy(i))},reset:function(){t=!1,r=null,n.set(-1,0,0,0)}}},a=new function(){let t=!1,i=null,r=null,n=null;return{setTest:function(e){e?F(2929):O(2929)},setMask:function(r){i===r||t||(e.depthMask(r),i=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case 0:e.depthFunc(512);break;case 1:e.depthFunc(519);break;case 2:e.depthFunc(513);break;case 3:default:e.depthFunc(515);break;case 4:e.depthFunc(514);break;case 5:e.depthFunc(518);break;case 6:e.depthFunc(516);break;case 7:e.depthFunc(517)}else e.depthFunc(515);r=t}},setLocked:function(e){t=e},setClear:function(t){n!==t&&(e.clearDepth(t),n=t)},reset:function(){t=!1,i=null,r=null,n=null}}},o=new function(){let t=!1,i=null,r=null,n=null,a=null,o=null,s=null,l=null,c=null;return{setTest:function(e){t||(e?F(2960):O(2960))},setMask:function(r){i===r||t||(e.stencilMask(r),i=r)},setFunc:function(t,i,o){r===t&&n===i&&a===o||(e.stencilFunc(t,i,o),r=t,n=i,a=o)},setOp:function(t,i,r){o===t&&s===i&&l===r||(e.stencilOp(t,i,r),o=t,s=i,l=r)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,i=null,r=null,n=null,a=null,o=null,s=null,l=null,c=null}}};let s={},l=null,c={},u=null,h=!1,p=null,d=null,f=null,m=null,g=null,_=null,y=null,v=!1,x=null,b=null,w=null,S=null,M=null;const T=e.getParameter(35661);let E=!1,C=0;const A=e.getParameter(7938);-1!==A.indexOf("WebGL")?(C=parseFloat(/^WebGL (\d)/.exec(A)[1]),E=C>=1):-1!==A.indexOf("OpenGL ES")&&(C=parseFloat(/^OpenGL ES (\d)/.exec(A)[1]),E=C>=2);let I=null,P={};const z=e.getParameter(3088),R=e.getParameter(2978),k=(new gr).fromArray(z),L=(new gr).fromArray(R);function D(t,i,r){const n=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let o=0;o<r;o++)e.texImage2D(i+o,0,6408,1,1,0,6408,5121,n);return a}const B={};function F(t){!0!==s[t]&&(e.enable(t),s[t]=!0)}function O(t){!1!==s[t]&&(e.disable(t),s[t]=!1)}B[3553]=D(3553,3553,1),B[34067]=D(34067,34069,6),n.setClear(0,0,0,1),a.setClear(1),o.setClear(0),F(2929),a.setFunc(3),$(!1),j(1),F(2884),U(0);const N={[pi]:32774,101:32778,102:32779};if(r)N[103]=32775,N[104]=32776;else{const e=t.get("EXT_blend_minmax");null!==e&&(N[103]=e.MIN_EXT,N[104]=e.MAX_EXT)}const V={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function U(t,i,r,n,a,o,s,l){if(0!==t){if(!1===h&&(F(3042),h=!0),5===t)a=a||i,o=o||r,s=s||n,i===d&&a===g||(e.blendEquationSeparate(N[i],N[a]),d=i,g=a),r===f&&n===m&&o===_&&s===y||(e.blendFuncSeparate(V[r],V[n],V[o],V[s]),f=r,m=n,_=o,y=s),p=t,v=null;else if(t!==p||l!==v){if(d===pi&&g===pi||(e.blendEquation(32774),d=pi,g=pi),l)switch(t){case 1:e.blendFuncSeparate(1,771,1,771);break;case 2:e.blendFunc(1,1);break;case 3:e.blendFuncSeparate(0,0,769,771);break;case 4:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(770,771,1,771);break;case 2:e.blendFunc(770,1);break;case 3:e.blendFunc(0,769);break;case 4:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}f=null,m=null,_=null,y=null,p=t,v=l}}else!0===h&&(O(3042),h=!1)}function $(t){x!==t&&(t?e.frontFace(2304):e.frontFace(2305),x=t)}function j(t){0!==t?(F(2884),t!==b&&(1===t?e.cullFace(1029):2===t?e.cullFace(1028):e.cullFace(1032))):O(2884),b=t}function q(t,i,r){t?(F(32823),S===i&&M===r||(e.polygonOffset(i,r),S=i,M=r)):O(32823)}function G(t){void 0===t&&(t=33984+T-1),I!==t&&(e.activeTexture(t),I=t)}return{buffers:{color:n,depth:a,stencil:o},enable:F,disable:O,bindFramebuffer:function(t,i){return null===i&&null!==l&&(i=l),c[t]!==i&&(e.bindFramebuffer(t,i),c[t]=i,r&&(36009===t&&(c[36160]=i),36160===t&&(c[36009]=i)),!0)},bindXRFramebuffer:function(t){t!==l&&(e.bindFramebuffer(36160,t),l=t)},useProgram:function(t){return u!==t&&(e.useProgram(t),u=t,!0)},setBlending:U,setMaterial:function(e,t){2===e.side?O(2884):F(2884);let i=1===e.side;t&&(i=!i),$(i),1===e.blending&&!1===e.transparent?U(0):U(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),a.setFunc(e.depthFunc),a.setTest(e.depthTest),a.setMask(e.depthWrite),n.setMask(e.colorWrite);const r=e.stencilWrite;o.setTest(r),r&&(o.setMask(e.stencilWriteMask),o.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),o.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),q(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?F(32926):O(32926)},setFlipSided:$,setCullFace:j,setLineWidth:function(t){t!==w&&(E&&e.lineWidth(t),w=t)},setPolygonOffset:q,setScissorTest:function(e){e?F(3089):O(3089)},activeTexture:G,bindTexture:function(t,i){null===I&&G();let r=P[I];void 0===r&&(r={type:void 0,texture:void 0},P[I]=r),r.type===t&&r.texture===i||(e.bindTexture(t,i||B[t]),r.type=t,r.texture=i)},unbindTexture:function(){const t=P[I];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(t){!1===k.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),k.copy(t))},viewport:function(t){!1===L.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),L.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===r&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),s={},I=null,P={},l=null,c={},u=null,h=!1,p=null,d=null,f=null,m=null,g=null,_=null,y=null,v=!1,x=null,b=null,w=null,S=null,M=null,k.set(0,0,e.canvas.width,e.canvas.height),L.set(0,0,e.canvas.width,e.canvas.height),n.reset(),a.reset(),o.reset()}}}function wl(e,t,i,r,n,a,o){const s=n.isWebGL2,l=n.maxTextures,c=n.maxCubemapSize,u=n.maxTextureSize,h=n.maxSamples,p=new WeakMap;let d,f=!1;try{f="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(Ix){}function m(e,t){return f?new OffscreenCanvas(e,t):cr("canvas")}function g(e,t,i,r){let n=1;if((e.width>r||e.height>r)&&(n=r/Math.max(e.width,e.height)),n<1||!0===t){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){const r=t?nr:Math.floor,a=r(n*e.width),o=r(n*e.height);void 0===d&&(d=m(a,o));const s=i?m(a,o):d;s.width=a,s.height=o;return s.getContext("2d").drawImage(e,0,0,a,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+a+"x"+o+")."),s}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function _(e){return rr(e.width)&&rr(e.height)}function y(e,t){return e.generateMipmaps&&t&&e.minFilter!==vi&&e.minFilter!==xi}function v(t,i,n,a,o=1){e.generateMipmap(t);r.get(i).__maxMipLevel=Math.log2(Math.max(n,a,o))}function x(i,r,n,a){if(!1===s)return r;if(null!==i){if(void 0!==e[i])return e[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let o=r;return 6403===r&&(5126===n&&(o=33326),5131===n&&(o=33325),5121===n&&(o=33321)),6407===r&&(5126===n&&(o=34837),5131===n&&(o=34843),5121===n&&(o=32849)),6408===r&&(5126===n&&(o=34836),5131===n&&(o=34842),5121===n&&(o=a===Vi?35907:32856)),33325!==o&&33326!==o&&34842!==o&&34836!==o||t.get("EXT_color_buffer_float"),o}function b(e){return e===vi||1004===e||1005===e?9728:9729}function w(t){const i=t.target;i.removeEventListener("dispose",w),function(t){const i=r.get(t);if(void 0===i.__webglInit)return;e.deleteTexture(i.__webglTexture),r.remove(t)}(i),i.isVideoTexture&&p.delete(i),o.memory.textures--}function S(t){const i=t.target;i.removeEventListener("dispose",S),function(t){const i=t.texture,n=r.get(t),a=r.get(i);if(!t)return;void 0!==a.__webglTexture&&(e.deleteTexture(a.__webglTexture),o.memory.textures--);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(let r=0;r<6;r++)e.deleteFramebuffer(n.__webglFramebuffer[r]),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[r]);else e.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer&&e.deleteRenderbuffer(n.__webglColorRenderbuffer),n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer);if(t.isWebGLMultipleRenderTargets)for(let s=0,l=i.length;s<l;s++){const t=r.get(i[s]);t.__webglTexture&&(e.deleteTexture(t.__webglTexture),o.memory.textures--),r.remove(i[s])}r.remove(i),r.remove(t)}(i)}let M=0;function T(e,t){const n=r.get(e);if(e.isVideoTexture&&function(e){const t=o.render.frame;p.get(e)!==t&&(p.set(e,t),e.update())}(e),e.version>0&&n.__version!==e.version){const i=e.image;if(void 0===i)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==i.complete)return void z(n,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.activeTexture(33984+t),i.bindTexture(3553,n.__webglTexture)}function E(t,n){const o=r.get(t);t.version>0&&o.__version!==t.version?function(t,r,n){if(6!==r.image.length)return;P(t,r),i.activeTexture(33984+n),i.bindTexture(34067,t.__webglTexture),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),e.pixelStorei(37443,0);const o=r&&(r.isCompressedTexture||r.image[0].isCompressedTexture),l=r.image[0]&&r.image[0].isDataTexture,u=[];for(let e=0;e<6;e++)u[e]=o||l?l?r.image[e].image:r.image[e]:g(r.image[e],!1,!0,c);const h=u[0],p=_(h)||s,d=a.convert(r.format),f=a.convert(r.type),m=x(r.internalFormat,d,f,r.encoding);let b;if(I(34067,r,p),o){for(let e=0;e<6;e++){b=u[e].mipmaps;for(let t=0;t<b.length;t++){const n=b[t];r.format!==Ii&&r.format!==Ai?null!==d?i.compressedTexImage2D(34069+e,t,m,n.width,n.height,0,n.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(34069+e,t,m,n.width,n.height,0,d,f,n.data)}}t.__maxMipLevel=b.length-1}else{b=r.mipmaps;for(let e=0;e<6;e++)if(l){i.texImage2D(34069+e,0,m,u[e].width,u[e].height,0,d,f,u[e].data);for(let t=0;t<b.length;t++){const r=b[t].image[e].image;i.texImage2D(34069+e,t+1,m,r.width,r.height,0,d,f,r.data)}}else{i.texImage2D(34069+e,0,m,d,f,u[e]);for(let t=0;t<b.length;t++){const r=b[t];i.texImage2D(34069+e,t+1,m,d,f,r.image[e])}}t.__maxMipLevel=b.length}y(r,p)&&v(34067,r,h.width,h.height);t.__version=r.version,r.onUpdate&&r.onUpdate(r)}(o,t,n):(i.activeTexture(33984+n),i.bindTexture(34067,o.__webglTexture))}const C={[gi]:10497,[_i]:33071,[yi]:33648},A={[vi]:9728,1004:9984,1005:9986,[xi]:9729,1007:9985,[bi]:9987};function I(i,a,o){if(o?(e.texParameteri(i,10242,C[a.wrapS]),e.texParameteri(i,10243,C[a.wrapT]),32879!==i&&35866!==i||e.texParameteri(i,32882,C[a.wrapR]),e.texParameteri(i,10240,A[a.magFilter]),e.texParameteri(i,10241,A[a.minFilter])):(e.texParameteri(i,10242,33071),e.texParameteri(i,10243,33071),32879!==i&&35866!==i||e.texParameteri(i,32882,33071),a.wrapS===_i&&a.wrapT===_i||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(i,10240,b(a.magFilter)),e.texParameteri(i,10241,b(a.minFilter)),a.minFilter!==vi&&a.minFilter!==xi&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){const o=t.get("EXT_texture_filter_anisotropic");if(a.type===Ti&&!1===t.has("OES_texture_float_linear"))return;if(!1===s&&a.type===Ei&&!1===t.has("OES_texture_half_float_linear"))return;(a.anisotropy>1||r.get(a).__currentAnisotropy)&&(e.texParameterf(i,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,n.getMaxAnisotropy())),r.get(a).__currentAnisotropy=a.anisotropy)}}function P(t,i){void 0===t.__webglInit&&(t.__webglInit=!0,i.addEventListener("dispose",w),t.__webglTexture=e.createTexture(),o.memory.textures++)}function z(t,r,n){let o=3553;r.isDataTexture2DArray&&(o=35866),r.isDataTexture3D&&(o=32879),P(t,r),i.activeTexture(33984+n),i.bindTexture(o,t.__webglTexture),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),e.pixelStorei(37443,0);const l=function(e){return!s&&(e.wrapS!==_i||e.wrapT!==_i||e.minFilter!==vi&&e.minFilter!==xi)}(r)&&!1===_(r.image),c=g(r.image,l,!1,u),h=_(c)||s,p=a.convert(r.format);let d,f=a.convert(r.type),m=x(r.internalFormat,p,f,r.encoding);I(o,r,h);const b=r.mipmaps;if(r.isDepthTexture)m=6402,s?m=r.type===Ti?36012:r.type===Mi?33190:r.type===Ci?35056:33189:r.type===Ti&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===Pi&&6402===m&&r.type!==Si&&r.type!==Mi&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=Si,f=a.convert(r.type)),r.format===zi&&6402===m&&(m=34041,r.type!==Ci&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=Ci,f=a.convert(r.type))),i.texImage2D(3553,0,m,c.width,c.height,0,p,f,null);else if(r.isDataTexture)if(b.length>0&&h){for(let e=0,t=b.length;e<t;e++)d=b[e],i.texImage2D(3553,e,m,d.width,d.height,0,p,f,d.data);r.generateMipmaps=!1,t.__maxMipLevel=b.length-1}else i.texImage2D(3553,0,m,c.width,c.height,0,p,f,c.data),t.__maxMipLevel=0;else if(r.isCompressedTexture){for(let e=0,t=b.length;e<t;e++)d=b[e],r.format!==Ii&&r.format!==Ai?null!==p?i.compressedTexImage2D(3553,e,m,d.width,d.height,0,d.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(3553,e,m,d.width,d.height,0,p,f,d.data);t.__maxMipLevel=b.length-1}else if(r.isDataTexture2DArray)i.texImage3D(35866,0,m,c.width,c.height,c.depth,0,p,f,c.data),t.__maxMipLevel=0;else if(r.isDataTexture3D)i.texImage3D(32879,0,m,c.width,c.height,c.depth,0,p,f,c.data),t.__maxMipLevel=0;else if(b.length>0&&h){for(let e=0,t=b.length;e<t;e++)d=b[e],i.texImage2D(3553,e,m,p,f,d);r.generateMipmaps=!1,t.__maxMipLevel=b.length-1}else i.texImage2D(3553,0,m,p,f,c),t.__maxMipLevel=0;y(r,h)&&v(o,r,c.width,c.height),t.__version=r.version,r.onUpdate&&r.onUpdate(r)}function R(t,n,o,s,l){const c=a.convert(o.format),u=a.convert(o.type),h=x(o.internalFormat,c,u,o.encoding);32879===l||35866===l?i.texImage3D(l,0,h,n.width,n.height,n.depth,0,c,u,null):i.texImage2D(l,0,h,n.width,n.height,0,c,u,null),i.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,s,l,r.get(o).__webglTexture,0),i.bindFramebuffer(36160,null)}function k(t,i,r){if(e.bindRenderbuffer(36161,t),i.depthBuffer&&!i.stencilBuffer){let n=33189;if(r){const t=i.depthTexture;t&&t.isDepthTexture&&(t.type===Ti?n=36012:t.type===Mi&&(n=33190));const r=D(i);e.renderbufferStorageMultisample(36161,r,n,i.width,i.height)}else e.renderbufferStorage(36161,n,i.width,i.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(i.depthBuffer&&i.stencilBuffer){if(r){const t=D(i);e.renderbufferStorageMultisample(36161,t,35056,i.width,i.height)}else e.renderbufferStorage(36161,34041,i.width,i.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{const t=!0===i.isWebGLMultipleRenderTargets?i.texture[0]:i.texture,n=a.convert(t.format),o=a.convert(t.type),s=x(t.internalFormat,n,o,t.encoding);if(r){const t=D(i);e.renderbufferStorageMultisample(36161,t,s,i.width,i.height)}else e.renderbufferStorage(36161,s,i.width,i.height)}e.bindRenderbuffer(36161,null)}function L(t){const n=r.get(t),a=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(a)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,n){if(n&&n.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,t),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),T(n.depthTexture,0);const a=r.get(n.depthTexture).__webglTexture;if(n.depthTexture.format===Pi)e.framebufferTexture2D(36160,36096,3553,a,0);else{if(n.depthTexture.format!==zi)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,a,0)}}(n.__webglFramebuffer,t)}else if(a){n.__webglDepthbuffer=[];for(let r=0;r<6;r++)i.bindFramebuffer(36160,n.__webglFramebuffer[r]),n.__webglDepthbuffer[r]=e.createRenderbuffer(),k(n.__webglDepthbuffer[r],t,!1)}else i.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=e.createRenderbuffer(),k(n.__webglDepthbuffer,t,!1);i.bindFramebuffer(36160,null)}function D(e){return s&&e.isWebGLMultisampleRenderTarget?Math.min(h,e.samples):0}let B=!1,F=!1;this.allocateTextureUnit=function(){const e=M;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),M+=1,e},this.resetTextureUnits=function(){M=0},this.setTexture2D=T,this.setTexture2DArray=function(e,t){const n=r.get(e);e.version>0&&n.__version!==e.version?z(n,e,t):(i.activeTexture(33984+t),i.bindTexture(35866,n.__webglTexture))},this.setTexture3D=function(e,t){const n=r.get(e);e.version>0&&n.__version!==e.version?z(n,e,t):(i.activeTexture(33984+t),i.bindTexture(32879,n.__webglTexture))},this.setTextureCube=E,this.setupRenderTarget=function(t){const l=t.texture,c=r.get(t),u=r.get(l);t.addEventListener("dispose",S),!0!==t.isWebGLMultipleRenderTargets&&(u.__webglTexture=e.createTexture(),u.__version=l.version,o.memory.textures++);const h=!0===t.isWebGLCubeRenderTarget,p=!0===t.isWebGLMultipleRenderTargets,d=!0===t.isWebGLMultisampleRenderTarget,f=l.isDataTexture3D||l.isDataTexture2DArray,m=_(t)||s;if(!s||l.format!==Ai||l.type!==Ti&&l.type!==Ei||(l.format=Ii,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),h){c.__webglFramebuffer=[];for(let t=0;t<6;t++)c.__webglFramebuffer[t]=e.createFramebuffer()}else if(c.__webglFramebuffer=e.createFramebuffer(),p)if(n.drawBuffers){const i=t.texture;for(let t=0,n=i.length;t<n;t++){const n=r.get(i[t]);void 0===n.__webglTexture&&(n.__webglTexture=e.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(d)if(s){c.__webglMultisampledFramebuffer=e.createFramebuffer(),c.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,c.__webglColorRenderbuffer);const r=a.convert(l.format),n=a.convert(l.type),o=x(l.internalFormat,r,n,l.encoding),s=D(t);e.renderbufferStorageMultisample(36161,s,o,t.width,t.height),i.bindFramebuffer(36160,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,c.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(c.__webglDepthRenderbuffer=e.createRenderbuffer(),k(c.__webglDepthRenderbuffer,t,!0)),i.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(h){i.bindTexture(34067,u.__webglTexture),I(34067,l,m);for(let e=0;e<6;e++)R(c.__webglFramebuffer[e],t,l,36064,34069+e);y(l,m)&&v(34067,l,t.width,t.height),i.unbindTexture()}else if(p){const e=t.texture;for(let n=0,a=e.length;n<a;n++){const a=e[n],o=r.get(a);i.bindTexture(3553,o.__webglTexture),I(3553,a,m),R(c.__webglFramebuffer,t,a,36064+n,3553),y(a,m)&&v(3553,a,t.width,t.height)}i.unbindTexture()}else{let e=3553;if(f)if(s){e=l.isDataTexture3D?32879:35866}else console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.");i.bindTexture(e,u.__webglTexture),I(e,l,m),R(c.__webglFramebuffer,t,l,36064,e),y(l,m)&&v(e,l,t.width,t.height,t.depth),i.unbindTexture()}t.depthBuffer&&L(t)},this.updateRenderTargetMipmap=function(e){const t=_(e)||s,n=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(let a=0,o=n.length;a<o;a++){const o=n[a];if(y(o,t)){const t=e.isWebGLCubeRenderTarget?34067:3553,n=r.get(o).__webglTexture;i.bindTexture(t,n),v(t,o,e.width,e.height),i.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(s){const n=t.width,a=t.height;let o=16384;t.depthBuffer&&(o|=256),t.stencilBuffer&&(o|=1024);const s=r.get(t);i.bindFramebuffer(36008,s.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,s.__webglFramebuffer),e.blitFramebuffer(0,0,n,a,0,0,n,a,o,9728),i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,s.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===B&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),B=!0),e=e.texture),T(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===F&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),F=!0),e=e.texture),E(e,t)}}function Sl(e,t,i){const r=i.isWebGL2;return{convert:function(e){let i;if(e===wi)return 5121;if(1017===e)return 32819;if(1018===e)return 32820;if(1019===e)return 33635;if(1010===e)return 5120;if(1011===e)return 5122;if(e===Si)return 5123;if(1013===e)return 5124;if(e===Mi)return 5125;if(e===Ti)return 5126;if(e===Ei)return r?5131:(i=t.get("OES_texture_half_float"),null!==i?i.HALF_FLOAT_OES:null);if(1021===e)return 6406;if(e===Ai)return 6407;if(e===Ii)return 6408;if(1024===e)return 6409;if(1025===e)return 6410;if(e===Pi)return 6402;if(e===zi)return 34041;if(1028===e)return 6403;if(1029===e)return 36244;if(1030===e)return 33319;if(1031===e)return 33320;if(1032===e)return 36248;if(1033===e)return 36249;if(33776===e||33777===e||33778===e||33779===e){if(i=t.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(33776===e)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===e)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===e)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===e)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===e||35841===e||35842===e||35843===e){if(i=t.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(35840===e)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===e)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===e)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===e)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===e)return i=t.get("WEBGL_compressed_texture_etc1"),null!==i?i.COMPRESSED_RGB_ETC1_WEBGL:null;if((37492===e||37496===e)&&(i=t.get("WEBGL_compressed_texture_etc"),null!==i)){if(37492===e)return i.COMPRESSED_RGB8_ETC2;if(37496===e)return i.COMPRESSED_RGBA8_ETC2_EAC}return 37808===e||37809===e||37810===e||37811===e||37812===e||37813===e||37814===e||37815===e||37816===e||37817===e||37818===e||37819===e||37820===e||37821===e||37840===e||37841===e||37842===e||37843===e||37844===e||37845===e||37846===e||37847===e||37848===e||37849===e||37850===e||37851===e||37852===e||37853===e?(i=t.get("WEBGL_compressed_texture_astc"),null!==i?e:null):36492===e?(i=t.get("EXT_texture_compression_bptc"),null!==i?e:null):e===Ci?r?34042:(i=t.get("WEBGL_depth_texture"),null!==i?i.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class Ml extends Pa{constructor(e=[]){super(),this.cameras=e}}Ml.prototype.isArrayCamera=!0;class Tl extends Sn{constructor(){super(),this.type="Group"}}Tl.prototype.isGroup=!0;const El={type:"move"};class Cl{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Tl,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Tl,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new xr,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new xr),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Tl,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new xr,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new xr),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,i){let r=null,n=null,a=null;const o=this._targetRay,s=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(null!==o&&(r=t.getPose(e.targetRaySpace,i),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(El))),l&&e.hand){a=!0;for(const a of e.hand.values()){const e=t.getJointPose(a,i);if(void 0===l.joints[a.jointName]){const e=new Tl;e.matrixAutoUpdate=!1,e.visible=!1,l.joints[a.jointName]=e,l.add(e)}const r=l.joints[a.jointName];null!==e&&(r.matrix.fromArray(e.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.jointRadius=e.radius),r.visible=null!==e}const r=l.joints["index-finger-tip"],n=l.joints["thumb-tip"],o=r.position.distanceTo(n.position),s=.02,c=.005;l.inputState.pinching&&o>s+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&o<=s-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&(n=t.getPose(e.gripSpace,i),null!==n&&(s.matrix.fromArray(n.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),n.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(n.linearVelocity)):s.hasLinearVelocity=!1,n.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(n.angularVelocity)):s.hasAngularVelocity=!1));return null!==o&&(o.visible=null!==r),null!==s&&(s.visible=null!==n),null!==l&&(l.visible=null!==a),this}}class Al extends Wi{constructor(e,t){super();const i=this,r=e.state;let n=null,a=1,o=null,s="local-floor",l=null,c=null,u=null,h=null,p=null,d=!1,f=null,m=null,g=null,_=null,y=null,v=null;const x=[],b=new Map,w=new Pa;w.layers.enable(1),w.viewport=new gr;const S=new Pa;S.layers.enable(2),S.viewport=new gr;const M=[w,S],T=new Ml;T.layers.enable(1),T.layers.enable(2);let E=null,C=null;function A(e){const t=b.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function I(){b.forEach((function(e,t){e.disconnect(t)})),b.clear(),E=null,C=null,r.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),u&&t.deleteFramebuffer(u),f&&t.deleteFramebuffer(f),m&&t.deleteRenderbuffer(m),g&&t.deleteRenderbuffer(g),u=null,f=null,m=null,g=null,p=null,h=null,c=null,n=null,D.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function P(e){const t=n.inputSources;for(let i=0;i<x.length;i++)b.set(t[i],x[i]);for(let i=0;i<e.removed.length;i++){const t=e.removed[i],r=b.get(t);r&&(r.dispatchEvent({type:"disconnected",data:t}),b.delete(t))}for(let i=0;i<e.added.length;i++){const t=e.added[i],r=b.get(t);r&&r.dispatchEvent({type:"connected",data:t})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=x[e];return void 0===t&&(t=new Cl,x[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=x[e];return void 0===t&&(t=new Cl,x[e]=t),t.getGripSpace()},this.getHand=function(e){let t=x[e];return void 0===t&&(t=new Cl,x[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){a=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){s=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getBaseLayer=function(){return null!==h?h:p},this.getBinding=function(){return c},this.getFrame=function(){return _},this.getSession=function(){return n},this.setSession=async function(e){if(n=e,null!==n){n.addEventListener("select",A),n.addEventListener("selectstart",A),n.addEventListener("selectend",A),n.addEventListener("squeeze",A),n.addEventListener("squeezestart",A),n.addEventListener("squeezeend",A),n.addEventListener("end",I),n.addEventListener("inputsourceschange",P);const e=t.getContextAttributes();if(!0!==e.xrCompatible&&await t.makeXRCompatible(),void 0===n.renderState.layers){const i={antialias:e.antialias,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:a};p=new XRWebGLLayer(n,t,i),n.updateRenderState({baseLayer:p})}else if(t instanceof WebGLRenderingContext){const i={antialias:!0,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:a};p=new XRWebGLLayer(n,t,i),n.updateRenderState({layers:[p]})}else{d=e.antialias;let i=null;e.depth&&(v=256,e.stencil&&(v|=1024),y=e.stencil?33306:36096,i=e.stencil?35056:33190);const o={colorFormat:e.alpha?32856:32849,depthFormat:i,scaleFactor:a};c=new XRWebGLBinding(n,t),h=c.createProjectionLayer(o),u=t.createFramebuffer(),n.updateRenderState({layers:[h]}),d&&(f=t.createFramebuffer(),m=t.createRenderbuffer(),t.bindRenderbuffer(36161,m),t.renderbufferStorageMultisample(36161,4,32856,h.textureWidth,h.textureHeight),r.bindFramebuffer(36160,f),t.framebufferRenderbuffer(36160,36064,36161,m),t.bindRenderbuffer(36161,null),null!==i&&(g=t.createRenderbuffer(),t.bindRenderbuffer(36161,g),t.renderbufferStorageMultisample(36161,4,i,h.textureWidth,h.textureHeight),t.framebufferRenderbuffer(36160,y,36161,g),t.bindRenderbuffer(36161,null)),r.bindFramebuffer(36160,null))}o=await n.requestReferenceSpace(s),D.setContext(n),D.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};const z=new xr,R=new xr;function k(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===n)return;T.near=S.near=w.near=e.near,T.far=S.far=w.far=e.far,E===T.near&&C===T.far||(n.updateRenderState({depthNear:T.near,depthFar:T.far}),E=T.near,C=T.far);const t=e.parent,i=T.cameras;k(T,t);for(let n=0;n<i.length;n++)k(i[n],t);T.matrixWorld.decompose(T.position,T.quaternion,T.scale),e.position.copy(T.position),e.quaternion.copy(T.quaternion),e.scale.copy(T.scale),e.matrix.copy(T.matrix),e.matrixWorld.copy(T.matrixWorld);const r=e.children;for(let n=0,a=r.length;n<a;n++)r[n].updateMatrixWorld(!0);2===i.length?function(e,t,i){z.setFromMatrixPosition(t.matrixWorld),R.setFromMatrixPosition(i.matrixWorld);const r=z.distanceTo(R),n=t.projectionMatrix.elements,a=i.projectionMatrix.elements,o=n[14]/(n[10]-1),s=n[14]/(n[10]+1),l=(n[9]+1)/n[5],c=(n[9]-1)/n[5],u=(n[8]-1)/n[0],h=(a[8]+1)/a[0],p=o*u,d=o*h,f=r/(-u+h),m=f*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=o+f,_=s+f,y=p-m,v=d+(r-m),x=l*s/_*g,b=c*s/_*g;e.projectionMatrix.makePerspective(y,v,x,b,g,_)}(T,w,S):T.projectionMatrix.copy(w.projectionMatrix)},this.getCamera=function(){return T},this.getFoveation=function(){return null!==h?h.fixedFoveation:null!==p?p.fixedFoveation:void 0},this.setFoveation=function(e){null!==h&&(h.fixedFoveation=e),null!==p&&void 0!==p.fixedFoveation&&(p.fixedFoveation=e)};let L=null;const D=new $a;D.setAnimationLoop((function(e,i){if(l=i.getViewerPose(o),_=i,null!==l){const e=l.views;null!==p&&r.bindXRFramebuffer(p.framebuffer);let i=!1;e.length!==T.cameras.length&&(T.cameras.length=0,i=!0);for(let n=0;n<e.length;n++){const a=e[n];let o=null;if(null!==p)o=p.getViewport(a);else{const e=c.getViewSubImage(h,a);r.bindXRFramebuffer(u),void 0!==e.depthStencilTexture&&t.framebufferTexture2D(36160,y,3553,e.depthStencilTexture,0),t.framebufferTexture2D(36160,36064,3553,e.colorTexture,0),o=e.viewport}const s=M[n];s.matrix.fromArray(a.transform.matrix),s.projectionMatrix.fromArray(a.projectionMatrix),s.viewport.set(o.x,o.y,o.width,o.height),0===n&&T.matrix.copy(s.matrix),!0===i&&T.cameras.push(s)}d&&(r.bindXRFramebuffer(f),null!==v&&t.clear(v))}const a=n.inputSources;for(let t=0;t<x.length;t++){const e=x[t],r=a[t];e.update(r,i,o)}if(L&&L(e,i),d){const e=h.textureWidth,i=h.textureHeight;r.bindFramebuffer(36008,f),r.bindFramebuffer(36009,u),t.invalidateFramebuffer(36008,[y]),t.invalidateFramebuffer(36009,[y]),t.blitFramebuffer(0,0,e,i,0,0,e,i,16384,9728),t.invalidateFramebuffer(36008,[36064]),r.bindFramebuffer(36008,null),r.bindFramebuffer(36009,null),r.bindFramebuffer(36160,f)}_=null})),this.setAnimationLoop=function(e){L=e},this.dispose=function(){}}}function Il(e){function t(t,i){t.opacity.value=i.opacity,i.color&&t.diffuse.value.copy(i.color),i.emissive&&t.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(t.map.value=i.map),i.alphaMap&&(t.alphaMap.value=i.alphaMap),i.specularMap&&(t.specularMap.value=i.specularMap),i.alphaTest>0&&(t.alphaTest.value=i.alphaTest);const r=e.get(i).envMap;if(r){t.envMap.value=r,t.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,t.reflectivity.value=i.reflectivity,t.ior.value=i.ior,t.refractionRatio.value=i.refractionRatio;const n=e.get(r).__maxMipLevel;void 0!==n&&(t.maxMipLevel.value=n)}let n,a;i.lightMap&&(t.lightMap.value=i.lightMap,t.lightMapIntensity.value=i.lightMapIntensity),i.aoMap&&(t.aoMap.value=i.aoMap,t.aoMapIntensity.value=i.aoMapIntensity),i.map?n=i.map:i.specularMap?n=i.specularMap:i.displacementMap?n=i.displacementMap:i.normalMap?n=i.normalMap:i.bumpMap?n=i.bumpMap:i.roughnessMap?n=i.roughnessMap:i.metalnessMap?n=i.metalnessMap:i.alphaMap?n=i.alphaMap:i.emissiveMap?n=i.emissiveMap:i.clearcoatMap?n=i.clearcoatMap:i.clearcoatNormalMap?n=i.clearcoatNormalMap:i.clearcoatRoughnessMap?n=i.clearcoatRoughnessMap:i.specularIntensityMap?n=i.specularIntensityMap:i.specularColorMap?n=i.specularColorMap:i.transmissionMap?n=i.transmissionMap:i.thicknessMap?n=i.thicknessMap:i.sheenColorMap?n=i.sheenColorMap:i.sheenRoughnessMap&&(n=i.sheenRoughnessMap),void 0!==n&&(n.isWebGLRenderTarget&&(n=n.texture),!0===n.matrixAutoUpdate&&n.updateMatrix(),t.uvTransform.value.copy(n.matrix)),i.aoMap?a=i.aoMap:i.lightMap&&(a=i.lightMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),t.uv2Transform.value.copy(a.matrix))}function i(t,i){t.roughness.value=i.roughness,t.metalness.value=i.metalness,i.roughnessMap&&(t.roughnessMap.value=i.roughnessMap),i.metalnessMap&&(t.metalnessMap.value=i.metalnessMap),i.emissiveMap&&(t.emissiveMap.value=i.emissiveMap),i.bumpMap&&(t.bumpMap.value=i.bumpMap,t.bumpScale.value=i.bumpScale,1===i.side&&(t.bumpScale.value*=-1)),i.normalMap&&(t.normalMap.value=i.normalMap,t.normalScale.value.copy(i.normalScale),1===i.side&&t.normalScale.value.negate()),i.displacementMap&&(t.displacementMap.value=i.displacementMap,t.displacementScale.value=i.displacementScale,t.displacementBias.value=i.displacementBias);e.get(i).envMap&&(t.envMapIntensity.value=i.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,r,n,a,o){r.isMeshBasicMaterial?t(e,r):r.isMeshLambertMaterial?(t(e,r),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(e,r)):r.isMeshToonMaterial?(t(e,r),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap);t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshPhongMaterial?(t(e,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshStandardMaterial?(t(e,r),r.isMeshPhysicalMaterial?function(e,t,r){i(e,t),e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,1===t.side&&e.clearcoatNormalScale.value.negate()));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=r.texture,e.transmissionSamplerSize.value.set(r.width,r.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap);t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap)}(e,r,o):i(e,r)):r.isMeshMatcapMaterial?(t(e,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshDepthMaterial?(t(e,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshDistanceMaterial?(t(e,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,r)):r.isMeshNormalMaterial?(t(e,r),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,r)):r.isPointsMaterial?function(e,t,i,r){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*i,e.scale.value=.5*r,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest);let n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,r,n,a):r.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest);let i;t.map?i=t.map:t.alphaMap&&(i=t.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(e,r):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function Pl(e={}){const t=void 0!==e.canvas?e.canvas:function(){const e=cr("canvas");return e.style.display="block",e}(),i=void 0!==e.context?e.context:null,r=void 0!==e.alpha&&e.alpha,n=void 0===e.depth||e.depth,a=void 0===e.stencil||e.stencil,o=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",u=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let h=null,p=null;const d=[],f=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Ni,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const m=this;let g=!1,_=0,y=0,v=null,x=-1,b=null;const w=new gr,S=new gr;let M=null,T=t.width,E=t.height,C=1,A=null,I=null;const P=new gr(0,0,T,E),z=new gr(0,0,T,E);let R=!1;const k=[],L=new Ua;let D=!1,B=!1,F=null;const O=new Kr,N=new xr,V={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function U(){return null===v?C:1}let $,j,q,G,H,W,Z,X,Y,K,J,Q,ee,te,ie,re,ne,ae,oe,se,le,ce,ue,he=i;function pe(e,i){for(let r=0;r<e.length;r++){const n=e[r],a=t.getContext(n,i);if(null!==a)return a}return null}try{const e={alpha:r,depth:n,stencil:a,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if(t.addEventListener("webglcontextlost",me,!1),t.addEventListener("webglcontextrestored",ge,!1),null===he){const t=["webgl2","webgl","experimental-webgl"];if(!0===m.isWebGL1Renderer&&t.shift(),he=pe(t,e),null===he)throw pe(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===he.getShaderPrecisionFormat&&(he.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Ae){throw console.error("THREE.WebGLRenderer: "+Ae.message),Ae}function de(){$=new Co(he),j=new Ka(he,$,e),$.init(j),ce=new Sl(he,$,j),q=new bl(he,$,j),k[0]=1029,G=new Po(he),H=new sl,W=new wl(he,$,q,H,j,ce,G),Z=new Qa(m),X=new Eo(m),Y=new ja(he,j),ue=new Xa(he,$,Y,j),K=new Ao(he,Y,G,ue),J=new Bo(he,K,Y,G),oe=new Do(he,j,W),re=new Ja(H),Q=new ol(m,Z,X,$,j,ue,re),ee=new Il(H),te=new hl(H),ie=new _l($,j),ae=new Za(m,Z,q,J,s),ne=new xl(m,J,j),se=new Ya(he,$,G,j),le=new Io(he,$,G,j),G.programs=Q.programs,m.capabilities=j,m.extensions=$,m.properties=H,m.renderLists=te,m.shadowMap=ne,m.state=q,m.info=G}de();const fe=new Al(m,he);function me(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function ge(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;const e=G.autoReset,t=ne.enabled,i=ne.autoUpdate,r=ne.needsUpdate,n=ne.type;de(),G.autoReset=e,ne.enabled=t,ne.autoUpdate=i,ne.needsUpdate=r,ne.type=n}function _e(e){const t=e.target;t.removeEventListener("dispose",_e),function(e){(function(e){const t=H.get(e).programs;void 0!==t&&t.forEach((function(e){Q.releaseProgram(e)}))})(e),H.remove(e)}(t)}this.xr=fe,this.getContext=function(){return he},this.getContextAttributes=function(){return he.getContextAttributes()},this.forceContextLoss=function(){const e=$.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=$.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return C},this.setPixelRatio=function(e){void 0!==e&&(C=e,this.setSize(T,E,!1))},this.getSize=function(e){return e.set(T,E)},this.setSize=function(e,i,r){fe.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(T=e,E=i,t.width=Math.floor(e*C),t.height=Math.floor(i*C),!1!==r&&(t.style.width=e+"px",t.style.height=i+"px"),this.setViewport(0,0,e,i))},this.getDrawingBufferSize=function(e){return e.set(T*C,E*C).floor()},this.setDrawingBufferSize=function(e,i,r){T=e,E=i,C=r,t.width=Math.floor(e*r),t.height=Math.floor(i*r),this.setViewport(0,0,e,i)},this.getCurrentViewport=function(e){return e.copy(w)},this.getViewport=function(e){return e.copy(P)},this.setViewport=function(e,t,i,r){e.isVector4?P.set(e.x,e.y,e.z,e.w):P.set(e,t,i,r),q.viewport(w.copy(P).multiplyScalar(C).floor())},this.getScissor=function(e){return e.copy(z)},this.setScissor=function(e,t,i,r){e.isVector4?z.set(e.x,e.y,e.z,e.w):z.set(e,t,i,r),q.scissor(S.copy(z).multiplyScalar(C).floor())},this.getScissorTest=function(){return R},this.setScissorTest=function(e){q.setScissorTest(R=e)},this.setOpaqueSort=function(e){A=e},this.setTransparentSort=function(e){I=e},this.getClearColor=function(e){return e.copy(ae.getClearColor())},this.setClearColor=function(){ae.setClearColor.apply(ae,arguments)},this.getClearAlpha=function(){return ae.getClearAlpha()},this.setClearAlpha=function(){ae.setClearAlpha.apply(ae,arguments)},this.clear=function(e,t,i){let r=0;(void 0===e||e)&&(r|=16384),(void 0===t||t)&&(r|=256),(void 0===i||i)&&(r|=1024),he.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",me,!1),t.removeEventListener("webglcontextrestored",ge,!1),te.dispose(),ie.dispose(),H.dispose(),Z.dispose(),X.dispose(),J.dispose(),ue.dispose(),fe.dispose(),fe.removeEventListener("sessionstart",ve),fe.removeEventListener("sessionend",xe),F&&(F.dispose(),F=null),be.stop()},this.renderBufferDirect=function(e,t,i,r,n,a){null===t&&(t=V);const o=n.isMesh&&n.matrixWorld.determinant()<0,s=function(e,t,i,r,n){!0!==t.isScene&&(t=V);W.resetTextureUnits();const a=t.fog,o=r.isMeshStandardMaterial?t.environment:null,s=null===v?m.outputEncoding:v.texture.encoding,l=(r.isMeshStandardMaterial?X:Z).get(r.envMap||o),c=!0===r.vertexColors&&!!i.attributes.color&&4===i.attributes.color.itemSize,u=!!r.normalMap&&!!i.attributes.tangent,h=!!i.morphAttributes.position,d=!!i.morphAttributes.normal,f=i.morphAttributes.position?i.morphAttributes.position.length:0,g=H.get(r),_=p.state.lights;if(!0===D&&(!0===B||e!==b)){const t=e===b&&r.id===x;re.setState(r,e,t)}let y=!1;r.version===g.__version?g.needsLights&&g.lightsStateVersion!==_.state.version||g.outputEncoding!==s||n.isInstancedMesh&&!1===g.instancing?y=!0:n.isInstancedMesh||!0!==g.instancing?n.isSkinnedMesh&&!1===g.skinning?y=!0:n.isSkinnedMesh||!0!==g.skinning?g.envMap!==l||r.fog&&g.fog!==a?y=!0:void 0===g.numClippingPlanes||g.numClippingPlanes===re.numPlanes&&g.numIntersection===re.numIntersection?(g.vertexAlphas!==c||g.vertexTangents!==u||g.morphTargets!==h||g.morphNormals!==d||!0===j.isWebGL2&&g.morphTargetsCount!==f)&&(y=!0):y=!0:y=!0:y=!0:(y=!0,g.__version=r.version);let w=g.currentProgram;!0===y&&(w=Ee(r,t,n));let S=!1,M=!1,T=!1;const A=w.getUniforms(),I=g.uniforms;q.useProgram(w.program)&&(S=!0,M=!0,T=!0);r.id!==x&&(x=r.id,M=!0);if(S||b!==e){if(A.setValue(he,"projectionMatrix",e.projectionMatrix),j.logarithmicDepthBuffer&&A.setValue(he,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),b!==e&&(b=e,M=!0,T=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshStandardMaterial||r.envMap){const t=A.map.cameraPosition;void 0!==t&&t.setValue(he,N.setFromMatrixPosition(e.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&A.setValue(he,"isOrthographic",!0===e.isOrthographicCamera),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.isShadowMaterial||n.isSkinnedMesh)&&A.setValue(he,"viewMatrix",e.matrixWorldInverse)}if(n.isSkinnedMesh){A.setOptional(he,n,"bindMatrix"),A.setOptional(he,n,"bindMatrixInverse");const e=n.skeleton;e&&(j.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),A.setValue(he,"boneTexture",e.boneTexture,W),A.setValue(he,"boneTextureSize",e.boneTextureSize)):A.setOptional(he,e,"boneMatrices"))}!i||void 0===i.morphAttributes.position&&void 0===i.morphAttributes.normal||oe.update(n,i,r,w);(M||g.receiveShadow!==n.receiveShadow)&&(g.receiveShadow=n.receiveShadow,A.setValue(he,"receiveShadow",n.receiveShadow));M&&(A.setValue(he,"toneMappingExposure",m.toneMappingExposure),g.needsLights&&(z=T,(P=I).ambientLightColor.needsUpdate=z,P.lightProbe.needsUpdate=z,P.directionalLights.needsUpdate=z,P.directionalLightShadows.needsUpdate=z,P.pointLights.needsUpdate=z,P.pointLightShadows.needsUpdate=z,P.spotLights.needsUpdate=z,P.spotLightShadows.needsUpdate=z,P.rectAreaLights.needsUpdate=z,P.hemisphereLights.needsUpdate=z),a&&r.fog&&ee.refreshFogUniforms(I,a),ee.refreshMaterialUniforms(I,r,C,E,F),Ns.upload(he,g.uniformsList,I,W));var P,z;r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(Ns.upload(he,g.uniformsList,I,W),r.uniformsNeedUpdate=!1);r.isSpriteMaterial&&A.setValue(he,"center",n.center);return A.setValue(he,"modelViewMatrix",n.modelViewMatrix),A.setValue(he,"normalMatrix",n.normalMatrix),A.setValue(he,"modelMatrix",n.matrixWorld),w}(e,t,i,r,n);q.setMaterial(r,o);let l=i.index;const c=i.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let u,h=1;!0===r.wireframe&&(l=K.getWireframeAttribute(i),h=2),ue.setup(n,r,s,i,l);let d=se;null!==l&&(u=Y.get(l),d=le,d.setIndex(u));const f=null!==l?l.count:c.count,g=i.drawRange.start*h,_=i.drawRange.count*h,y=null!==a?a.start*h:0,w=null!==a?a.count*h:1/0,S=Math.max(g,y),M=Math.min(f,g+_,y+w)-1,T=Math.max(0,M-S+1);if(0!==T){if(n.isMesh)!0===r.wireframe?(q.setLineWidth(r.wireframeLinewidth*U()),d.setMode(1)):d.setMode(4);else if(n.isLine){let e=r.linewidth;void 0===e&&(e=1),q.setLineWidth(e*U()),n.isLineSegments?d.setMode(1):n.isLineLoop?d.setMode(2):d.setMode(3)}else n.isPoints?d.setMode(0):n.isSprite&&d.setMode(4);if(n.isInstancedMesh)d.renderInstances(S,T,n.count);else if(i.isInstancedBufferGeometry){const e=Math.min(i.instanceCount,i._maxInstanceCount);d.renderInstances(S,T,e)}else d.render(S,T)}},this.compile=function(e,t){p=ie.get(e),p.init(),f.push(p),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(p.pushLight(e),e.castShadow&&p.pushShadow(e))})),p.setupLights(m.physicallyCorrectLights),e.traverse((function(t){const i=t.material;if(i)if(Array.isArray(i))for(let r=0;r<i.length;r++){Ee(i[r],e,t)}else Ee(i,e,t)})),f.pop(),p=null};let ye=null;function ve(){be.stop()}function xe(){be.start()}const be=new $a;function we(e,t,i,r){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)i=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)p.pushLight(e),e.castShadow&&p.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||L.intersectsSprite(e)){r&&N.setFromMatrixPosition(e.matrixWorld).applyMatrix4(O);const t=J.update(e),n=e.material;n.visible&&h.push(e,t,n,i,N.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==G.render.frame&&(e.skeleton.update(),e.skeleton.frame=G.render.frame),!e.frustumCulled||L.intersectsObject(e))){r&&N.setFromMatrixPosition(e.matrixWorld).applyMatrix4(O);const t=J.update(e),n=e.material;if(Array.isArray(n)){const r=t.groups;for(let a=0,o=r.length;a<o;a++){const o=r[a],s=n[o.materialIndex];s&&s.visible&&h.push(e,t,s,i,N.z,o)}}else n.visible&&h.push(e,t,n,i,N.z,null)}const n=e.children;for(let a=0,o=n.length;a<o;a++)we(n[a],t,i,r)}function Se(e,t,i,r){const n=e.opaque,a=e.transmissive,s=e.transparent;p.setupLightsView(i),a.length>0&&function(e,t,i){if(null===F){const e=!0===o&&!0===j.isWebGL2;F=new(e?yr:_r)(1024,1024,{generateMipmaps:!0,type:null!==ce.convert(Ei)?Ei:wi,minFilter:bi,magFilter:vi,wrapS:_i,wrapT:_i})}const r=m.getRenderTarget();m.setRenderTarget(F),m.clear();const n=m.toneMapping;m.toneMapping=0,Me(e,t,i),m.toneMapping=n,W.updateMultisampleRenderTarget(F),W.updateRenderTargetMipmap(F),m.setRenderTarget(r)}(n,t,i),r&&q.viewport(w.copy(r)),n.length>0&&Me(n,t,i),a.length>0&&Me(a,t,i),s.length>0&&Me(s,t,i)}function Me(e,t,i){const r=!0===t.isScene?t.overrideMaterial:null;for(let n=0,a=e.length;n<a;n++){const a=e[n],o=a.object,s=a.geometry,l=null===r?a.material:r,c=a.group;o.layers.test(i.layers)&&Te(o,t,i,s,l,c)}}function Te(e,t,i,r,n,a){e.onBeforeRender(m,t,i,r,n,a),e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),n.onBeforeRender(m,t,i,r,e,a),!0===n.transparent&&2===n.side?(n.side=1,n.needsUpdate=!0,m.renderBufferDirect(i,t,r,n,e,a),n.side=0,n.needsUpdate=!0,m.renderBufferDirect(i,t,r,n,e,a),n.side=2):m.renderBufferDirect(i,t,r,n,e,a),e.onAfterRender(m,t,i,r,n,a)}function Ee(e,t,i){!0!==t.isScene&&(t=V);const r=H.get(e),n=p.state.lights,a=p.state.shadowsArray,o=n.state.version,s=Q.getParameters(e,n.state,a,t,i),l=Q.getProgramCacheKey(s);let c=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=(e.isMeshStandardMaterial?X:Z).get(e.envMap||r.environment),void 0===c&&(e.addEventListener("dispose",_e),c=new Map,r.programs=c);let u=c.get(l);if(void 0!==u){if(r.currentProgram===u&&r.lightsStateVersion===o)return Ce(e,s),u}else s.uniforms=Q.getUniforms(e),e.onBuild(i,s,m),e.onBeforeCompile(s,m),u=Q.acquireProgram(s,l),c.set(l,u),r.uniforms=s.uniforms;const h=r.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=re.uniform),Ce(e,s),r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=o,r.needsLights&&(h.ambientLightColor.value=n.state.ambient,h.lightProbe.value=n.state.probe,h.directionalLights.value=n.state.directional,h.directionalLightShadows.value=n.state.directionalShadow,h.spotLights.value=n.state.spot,h.spotLightShadows.value=n.state.spotShadow,h.rectAreaLights.value=n.state.rectArea,h.ltc_1.value=n.state.rectAreaLTC1,h.ltc_2.value=n.state.rectAreaLTC2,h.pointLights.value=n.state.point,h.pointLightShadows.value=n.state.pointShadow,h.hemisphereLights.value=n.state.hemi,h.directionalShadowMap.value=n.state.directionalShadowMap,h.directionalShadowMatrix.value=n.state.directionalShadowMatrix,h.spotShadowMap.value=n.state.spotShadowMap,h.spotShadowMatrix.value=n.state.spotShadowMatrix,h.pointShadowMap.value=n.state.pointShadowMap,h.pointShadowMatrix.value=n.state.pointShadowMatrix);const d=u.getUniforms(),f=Ns.seqWithValue(d.seq,h);return r.currentProgram=u,r.uniformsList=f,u}function Ce(e,t){const i=H.get(e);i.outputEncoding=t.outputEncoding,i.instancing=t.instancing,i.skinning=t.skinning,i.morphTargets=t.morphTargets,i.morphNormals=t.morphNormals,i.morphTargetsCount=t.morphTargetsCount,i.numClippingPlanes=t.numClippingPlanes,i.numIntersection=t.numClipIntersection,i.vertexAlphas=t.vertexAlphas,i.vertexTangents=t.vertexTangents}be.setAnimationLoop((function(e){ye&&ye(e)})),"undefined"!==typeof window&&be.setContext(window),this.setAnimationLoop=function(e){ye=e,fe.setAnimationLoop(e),null===e?be.stop():be.start()},fe.addEventListener("sessionstart",ve),fe.addEventListener("sessionend",xe),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===g)return;!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===fe.enabled&&!0===fe.isPresenting&&(!0===fe.cameraAutoUpdate&&fe.updateCamera(t),t=fe.getCamera()),!0===e.isScene&&e.onBeforeRender(m,e,t,v),p=ie.get(e,f.length),p.init(),f.push(p),O.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),L.setFromProjectionMatrix(O),B=this.localClippingEnabled,D=re.init(this.clippingPlanes,B,t),h=te.get(e,d.length),h.init(),d.push(h),we(e,t,0,m.sortObjects),h.finish(),!0===m.sortObjects&&h.sort(A,I),!0===D&&re.beginShadows();const i=p.state.shadowsArray;if(ne.render(i,e,t),!0===D&&re.endShadows(),!0===this.info.autoReset&&this.info.reset(),ae.render(h,e),p.setupLights(m.physicallyCorrectLights),t.isArrayCamera){const i=t.cameras;for(let t=0,r=i.length;t<r;t++){const r=i[t];Se(h,e,r,r.viewport)}}else Se(h,e,t);null!==v&&(W.updateMultisampleRenderTarget(v),W.updateRenderTargetMipmap(v)),!0===e.isScene&&e.onAfterRender(m,e,t),q.buffers.depth.setTest(!0),q.buffers.depth.setMask(!0),q.buffers.color.setMask(!0),q.setPolygonOffset(!1),ue.resetDefaultState(),x=-1,b=null,f.pop(),p=f.length>0?f[f.length-1]:null,d.pop(),h=d.length>0?d[d.length-1]:null},this.getActiveCubeFace=function(){return _},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return v},this.setRenderTarget=function(e,t=0,i=0){v=e,_=t,y=i,e&&void 0===H.get(e).__webglFramebuffer&&W.setupRenderTarget(e);let r=null,n=!1,a=!1;if(e){const i=e.texture;(i.isDataTexture3D||i.isDataTexture2DArray)&&(a=!0);const o=H.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=o[t],n=!0):r=e.isWebGLMultisampleRenderTarget?H.get(e).__webglMultisampledFramebuffer:o,w.copy(e.viewport),S.copy(e.scissor),M=e.scissorTest}else w.copy(P).multiplyScalar(C).floor(),S.copy(z).multiplyScalar(C).floor(),M=R;if(q.bindFramebuffer(36160,r)&&j.drawBuffers){let t=!1;if(e)if(e.isWebGLMultipleRenderTargets){const i=e.texture;if(k.length!==i.length||36064!==k[0]){for(let e=0,t=i.length;e<t;e++)k[e]=36064+e;k.length=i.length,t=!0}}else 1===k.length&&36064===k[0]||(k[0]=36064,k.length=1,t=!0);else 1===k.length&&1029===k[0]||(k[0]=1029,k.length=1,t=!0);t&&(j.isWebGL2?he.drawBuffers(k):$.get("WEBGL_draw_buffers").drawBuffersWEBGL(k))}if(q.viewport(w),q.scissor(S),q.setScissorTest(M),n){const r=H.get(e.texture);he.framebufferTexture2D(36160,36064,34069+t,r.__webglTexture,i)}else if(a){const r=H.get(e.texture),n=t||0;he.framebufferTextureLayer(36160,36064,r.__webglTexture,i||0,n)}x=-1},this.readRenderTargetPixels=function(e,t,i,r,n,a,o){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let s=H.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(s=s[o]),s){q.bindFramebuffer(36160,s);try{const o=e.texture,s=o.format,l=o.type;if(s!==Ii&&ce.convert(s)!==he.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===Ei&&($.has("EXT_color_buffer_half_float")||j.isWebGL2&&$.has("EXT_color_buffer_float"));if(l!==wi&&ce.convert(l)!==he.getParameter(35738)&&(l!==Ti||!(j.isWebGL2||$.has("OES_texture_float")||$.has("WEBGL_color_buffer_float")))&&!c)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===he.checkFramebufferStatus(36160)?t>=0&&t<=e.width-r&&i>=0&&i<=e.height-n&&he.readPixels(t,i,r,n,ce.convert(s),ce.convert(l),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const e=null!==v?H.get(v).__webglFramebuffer:null;q.bindFramebuffer(36160,e)}}},this.copyFramebufferToTexture=function(e,t,i=0){const r=Math.pow(2,-i),n=Math.floor(t.image.width*r),a=Math.floor(t.image.height*r);let o=ce.convert(t.format);j.isWebGL2&&(6407===o&&(o=32849),6408===o&&(o=32856)),W.setTexture2D(t,0),he.copyTexImage2D(3553,i,o,e.x,e.y,n,a,0),q.unbindTexture()},this.copyTextureToTexture=function(e,t,i,r=0){const n=t.image.width,a=t.image.height,o=ce.convert(i.format),s=ce.convert(i.type);W.setTexture2D(i,0),he.pixelStorei(37440,i.flipY),he.pixelStorei(37441,i.premultiplyAlpha),he.pixelStorei(3317,i.unpackAlignment),t.isDataTexture?he.texSubImage2D(3553,r,e.x,e.y,n,a,o,s,t.image.data):t.isCompressedTexture?he.compressedTexSubImage2D(3553,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):he.texSubImage2D(3553,r,e.x,e.y,o,s,t.image),0===r&&i.generateMipmaps&&he.generateMipmap(3553),q.unbindTexture()},this.copyTextureToTexture3D=function(e,t,i,r,n=0){if(m.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const a=e.max.x-e.min.x+1,o=e.max.y-e.min.y+1,s=e.max.z-e.min.z+1,l=ce.convert(r.format),c=ce.convert(r.type);let u;if(r.isDataTexture3D)W.setTexture3D(r,0),u=32879;else{if(!r.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");W.setTexture2DArray(r,0),u=35866}he.pixelStorei(37440,r.flipY),he.pixelStorei(37441,r.premultiplyAlpha),he.pixelStorei(3317,r.unpackAlignment);const h=he.getParameter(3314),p=he.getParameter(32878),d=he.getParameter(3316),f=he.getParameter(3315),g=he.getParameter(32877),_=i.isCompressedTexture?i.mipmaps[0]:i.image;he.pixelStorei(3314,_.width),he.pixelStorei(32878,_.height),he.pixelStorei(3316,e.min.x),he.pixelStorei(3315,e.min.y),he.pixelStorei(32877,e.min.z),i.isDataTexture||i.isDataTexture3D?he.texSubImage3D(u,n,t.x,t.y,t.z,a,o,s,l,c,_.data):i.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),he.compressedTexSubImage3D(u,n,t.x,t.y,t.z,a,o,s,l,_.data)):he.texSubImage3D(u,n,t.x,t.y,t.z,a,o,s,l,c,_),he.pixelStorei(3314,h),he.pixelStorei(32878,p),he.pixelStorei(3316,d),he.pixelStorei(3315,f),he.pixelStorei(32877,g),0===n&&r.generateMipmaps&&he.generateMipmap(u),q.unbindTexture()},this.initTexture=function(e){W.setTexture2D(e,0),q.unbindTexture()},this.resetState=function(){_=0,y=0,v=null,q.reset(),ue.reset()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Pl.prototype.isWebGLRenderer=!0;(class extends Pl{}).prototype.isWebGL1Renderer=!0;class zl extends Sn{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}zl.prototype.isScene=!0;class Rl{constructor(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=qi,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Qi()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let r=0,n=this.stride;r<n;r++)this.array[e+r]=t.array[i+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Qi()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Qi()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}Rl.prototype.isInterleavedBuffer=!0;const kl=new xr;class Ll{constructor(e,t,i,r=!1){this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=!0===r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)kl.x=this.getX(t),kl.y=this.getY(t),kl.z=this.getZ(t),kl.applyMatrix4(e),this.setXYZ(t,kl.x,kl.y,kl.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)kl.x=this.getX(t),kl.y=this.getY(t),kl.z=this.getZ(t),kl.applyNormalMatrix(e),this.setXYZ(t,kl.x,kl.y,kl.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)kl.x=this.getX(t),kl.y=this.getY(t),kl.z=this.getZ(t),kl.transformDirection(e),this.setXYZ(t,kl.x,kl.y,kl.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,t,i,r,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=n,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return new Wn(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Ll(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}Ll.prototype.isInterleavedBufferAttribute=!0;class Dl extends Bn{constructor(e){super(),this.type="SpriteMaterial",this.color=new jn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}let Bl;Dl.prototype.isSpriteMaterial=!0;const Fl=new xr,Ol=new xr,Nl=new xr,Vl=new or,Ul=new or,$l=new Kr,jl=new xr,ql=new xr,Gl=new xr,Hl=new or,Wl=new or,Zl=new or;class Xl extends Sn{constructor(e){if(super(),this.type="Sprite",void 0===Bl){Bl=new na;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new Rl(e,5);Bl.setIndex([0,1,2,0,2,3]),Bl.setAttribute("position",new Ll(t,3,0,!1)),Bl.setAttribute("uv",new Ll(t,2,3,!1))}this.geometry=Bl,this.material=void 0!==e?e:new Dl,this.center=new or(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ol.setFromMatrixScale(this.matrixWorld),$l.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Nl.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Ol.multiplyScalar(-Nl.z);const i=this.material.rotation;let r,n;0!==i&&(n=Math.cos(i),r=Math.sin(i));const a=this.center;Yl(jl.set(-.5,-.5,0),Nl,a,Ol,r,n),Yl(ql.set(.5,-.5,0),Nl,a,Ol,r,n),Yl(Gl.set(.5,.5,0),Nl,a,Ol,r,n),Hl.set(0,0),Wl.set(1,0),Zl.set(1,1);let o=e.ray.intersectTriangle(jl,ql,Gl,!1,Fl);if(null===o&&(Yl(ql.set(-.5,.5,0),Nl,a,Ol,r,n),Wl.set(0,1),o=e.ray.intersectTriangle(jl,Gl,ql,!1,Fl),null===o))return;const s=e.ray.origin.distanceTo(Fl);s<e.near||s>e.far||t.push({distance:s,point:Fl.clone(),uv:Ln.getUV(Fl,jl,ql,Gl,Hl,Wl,Zl,new or),face:null,object:this})}copy(e){return super.copy(e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function Yl(e,t,i,r,n,a){Vl.subVectors(e,i).addScalar(.5).multiply(r),void 0!==n?(Ul.x=a*Vl.x-n*Vl.y,Ul.y=n*Vl.x+a*Vl.y):Ul.copy(Vl),e.copy(t),e.x+=Ul.x,e.y+=Ul.y,e.applyMatrix4($l)}Xl.prototype.isSprite=!0;const Kl=new xr,Jl=new gr,Ql=new gr,ec=new xr,tc=new Kr;class ic extends wa{constructor(e,t){super(e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Kr,this.bindMatrixInverse=new Kr}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new gr,t=this.geometry.attributes.skinWeight;for(let i=0,r=t.count;i<r;i++){e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.w=t.getW(i);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const i=this.skeleton,r=this.geometry;Jl.fromBufferAttribute(r.attributes.skinIndex,e),Ql.fromBufferAttribute(r.attributes.skinWeight,e),Kl.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let n=0;n<4;n++){const e=Ql.getComponent(n);if(0!==e){const r=Jl.getComponent(n);tc.multiplyMatrices(i.bones[r].matrixWorld,i.boneInverses[r]),t.addScaledVector(ec.copy(Kl).applyMatrix4(tc),e)}}return t.applyMatrix4(this.bindMatrixInverse)}}ic.prototype.isSkinnedMesh=!0;(class extends Sn{constructor(){super(),this.type="Bone"}}).prototype.isBone=!0;(class extends fr{constructor(e=null,t=1,i=1,r,n,a,o,s,l=1003,c=1003,u,h){super(null,a,o,s,l,c,r,n,u,h),this.image={data:e,width:t,height:i},this.magFilter=l,this.minFilter=c,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}).prototype.isDataTexture=!0;class rc extends Wn{constructor(e,t,i,r=1){"number"===typeof i&&(r=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,i),this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}rc.prototype.isInstancedBufferAttribute=!0;const nc=new Kr,ac=new Kr,oc=[],sc=new wa;(class extends wa{constructor(e,t,i){super(e,t),this.instanceMatrix=new rc(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const i=this.matrixWorld,r=this.count;if(sc.geometry=this.geometry,sc.material=this.material,void 0!==sc.material)for(let n=0;n<r;n++){this.getMatrixAt(n,nc),ac.multiplyMatrices(i,nc),sc.matrixWorld=ac,sc.raycast(e,oc);for(let e=0,i=oc.length;e<i;e++){const i=oc[e];i.instanceId=n,i.object=this,t.push(i)}oc.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new rc(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}).prototype.isInstancedMesh=!0;class lc extends Bn{constructor(e){super(),this.type="LineBasicMaterial",this.color=new jn(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}lc.prototype.isLineBasicMaterial=!0;const cc=new xr,uc=new xr,hc=new Kr,pc=new Yr,dc=new $r;class fc extends Sn{constructor(e=new na,t=new lc){super(),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,i=[0];for(let e=1,r=t.count;e<r;e++)cc.fromBufferAttribute(t,e-1),uc.fromBufferAttribute(t,e),i[e]=i[e-1],i[e]+=cc.distanceTo(uc);e.setAttribute("lineDistance",new Yn(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,n=e.params.Line.threshold,a=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),dc.copy(i.boundingSphere),dc.applyMatrix4(r),dc.radius+=n,!1===e.ray.intersectsSphere(dc))return;hc.copy(r).invert(),pc.copy(e.ray).applyMatrix4(hc);const o=n/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,l=new xr,c=new xr,u=new xr,h=new xr,p=this.isLineSegments?2:1;if(i.isBufferGeometry){const r=i.index,n=i.attributes.position;if(null!==r){for(let i=Math.max(0,a.start),o=Math.min(r.count,a.start+a.count)-1;i<o;i+=p){const a=r.getX(i),o=r.getX(i+1);l.fromBufferAttribute(n,a),c.fromBufferAttribute(n,o);if(pc.distanceSqToSegment(l,c,h,u)>s)continue;h.applyMatrix4(this.matrixWorld);const p=e.ray.origin.distanceTo(h);p<e.near||p>e.far||t.push({distance:p,point:u.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else{for(let i=Math.max(0,a.start),r=Math.min(n.count,a.start+a.count)-1;i<r;i+=p){l.fromBufferAttribute(n,i),c.fromBufferAttribute(n,i+1);if(pc.distanceSqToSegment(l,c,h,u)>s)continue;h.applyMatrix4(this.matrixWorld);const r=e.ray.origin.distanceTo(h);r<e.near||r>e.far||t.push({distance:r,point:u.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}}else i.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const e=t[i[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,i=e.length;t<i;t++){const i=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}fc.prototype.isLine=!0;const mc=new xr,gc=new xr;class _c extends fc{constructor(e,t){super(e,t),this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,i=[];for(let e=0,r=t.count;e<r;e+=2)mc.fromBufferAttribute(t,e),gc.fromBufferAttribute(t,e+1),i[e]=0===e?0:i[e-1],i[e+1]=i[e]+mc.distanceTo(gc);e.setAttribute("lineDistance",new Yn(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}_c.prototype.isLineSegments=!0;(class extends fc{constructor(e,t){super(e,t),this.type="LineLoop"}}).prototype.isLineLoop=!0;class yc extends Bn{constructor(e){super(),this.type="PointsMaterial",this.color=new jn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}yc.prototype.isPointsMaterial=!0;const vc=new Kr,xc=new Yr,bc=new $r,wc=new xr;class Sc extends Sn{constructor(e=new na,t=new yc){super(),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,n=e.params.Points.threshold,a=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),bc.copy(i.boundingSphere),bc.applyMatrix4(r),bc.radius+=n,!1===e.ray.intersectsSphere(bc))return;vc.copy(r).invert(),xc.copy(e.ray).applyMatrix4(vc);const o=n/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o;if(i.isBufferGeometry){const n=i.index,o=i.attributes.position;if(null!==n){for(let i=Math.max(0,a.start),l=Math.min(n.count,a.start+a.count);i<l;i++){const a=n.getX(i);wc.fromBufferAttribute(o,a),Mc(wc,a,s,r,e,t,this)}}else{for(let i=Math.max(0,a.start),n=Math.min(o.count,a.start+a.count);i<n;i++)wc.fromBufferAttribute(o,i),Mc(wc,i,s,r,e,t,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const e=t[i[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,i=e.length;t<i;t++){const i=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function Mc(e,t,i,r,n,a,o){const s=xc.distanceSqToPoint(e);if(s<i){const i=new xr;xc.closestPointToPoint(e,i),i.applyMatrix4(r);const l=n.ray.origin.distanceTo(i);if(l<n.near||l>n.far)return;a.push({distance:l,distanceToRay:Math.sqrt(s),point:i,index:t,face:null,object:o})}}Sc.prototype.isPoints=!0;(class extends fr{constructor(e,t,i,r,n,a,o,s,l){super(e,t,i,r,n,a,o,s,l),this.format=void 0!==o?o:Ai,this.minFilter=void 0!==a?a:xi,this.magFilter=void 0!==n?n:xi,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){c.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}).prototype.isVideoTexture=!0;(class extends fr{constructor(e,t,i,r,n,a,o,s,l,c,u,h){super(null,a,o,s,l,c,r,n,u,h),this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}).prototype.isCompressedTexture=!0;(class extends fr{constructor(e,t,i,r,n,a,o,s,l){super(e,t,i,r,n,a,o,s,l),this.needsUpdate=!0}}).prototype.isCanvasTexture=!0;(class extends fr{constructor(e,t,i,r,n,a,o,s,l,c){if((c=void 0!==c?c:Pi)!==Pi&&c!==zi)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&c===Pi&&(i=Si),void 0===i&&c===zi&&(i=Ci),super(null,r,n,a,o,s,c,i,l),this.image={width:e,height:t},this.magFilter=void 0!==o?o:vi,this.minFilter=void 0!==s?s:vi,this.flipY=!1,this.generateMipmaps=!1}}).prototype.isDepthTexture=!0;new xr,new xr,new xr,new Ln;class Tc{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,r=this.getPoint(0),n=0;t.push(0);for(let a=1;a<=e;a++)i=this.getPoint(a/e),n+=i.distanceTo(r),t.push(n),r=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let r=0;const n=i.length;let a;a=t||e*i[n-1];let o,s=0,l=n-1;for(;s<=l;)if(r=Math.floor(s+(l-s)/2),o=i[r]-a,o<0)s=r+1;else{if(!(o>0)){l=r;break}l=r-1}if(r=l,i[r]===a)return r/(n-1);const c=i[r];return(r+(a-c)/(i[r+1]-c))/(n-1)}getTangent(e,t){const i=1e-4;let r=e-i,n=e+i;r<0&&(r=0),n>1&&(n=1);const a=this.getPoint(r),o=this.getPoint(n),s=t||(a.isVector2?new or:new xr);return s.copy(o).sub(a).normalize(),s}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new xr,r=[],n=[],a=[],o=new xr,s=new Kr;for(let p=0;p<=e;p++){const t=p/e;r[p]=this.getTangentAt(t,new xr)}n[0]=new xr,a[0]=new xr;let l=Number.MAX_VALUE;const c=Math.abs(r[0].x),u=Math.abs(r[0].y),h=Math.abs(r[0].z);c<=l&&(l=c,i.set(1,0,0)),u<=l&&(l=u,i.set(0,1,0)),h<=l&&i.set(0,0,1),o.crossVectors(r[0],i).normalize(),n[0].crossVectors(r[0],o),a[0].crossVectors(r[0],n[0]);for(let p=1;p<=e;p++){if(n[p]=n[p-1].clone(),a[p]=a[p-1].clone(),o.crossVectors(r[p-1],r[p]),o.length()>Number.EPSILON){o.normalize();const e=Math.acos(er(r[p-1].dot(r[p]),-1,1));n[p].applyMatrix4(s.makeRotationAxis(o,e))}a[p].crossVectors(r[p],n[p])}if(!0===t){let t=Math.acos(er(n[0].dot(n[e]),-1,1));t/=e,r[0].dot(o.crossVectors(n[0],n[e]))>0&&(t=-t);for(let i=1;i<=e;i++)n[i].applyMatrix4(s.makeRotationAxis(r[i],t*i)),a[i].crossVectors(r[i],n[i])}return{tangents:r,normals:n,binormals:a}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Ec extends Tc{constructor(e=0,t=0,i=1,r=1,n=0,a=2*Math.PI,o=!1,s=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=n,this.aEndAngle=a,this.aClockwise=o,this.aRotation=s}getPoint(e,t){const i=t||new or,r=2*Math.PI;let n=this.aEndAngle-this.aStartAngle;const a=Math.abs(n)<Number.EPSILON;for(;n<0;)n+=r;for(;n>r;)n-=r;n<Number.EPSILON&&(n=a?0:r),!0!==this.aClockwise||a||(n===r?n=-r:n-=r);const o=this.aStartAngle+e*n;let s=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),i=s-this.aX,r=l-this.aY;s=i*e-r*t+this.aX,l=i*t+r*e+this.aY}return i.set(s,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}Ec.prototype.isEllipseCurve=!0;class Cc extends Ec{constructor(e,t,i,r,n,a){super(e,t,i,i,r,n,a),this.type="ArcCurve"}}function Ac(){let e=0,t=0,i=0,r=0;function n(n,a,o,s){e=n,t=o,i=-3*n+3*a-2*o-s,r=2*n-2*a+o+s}return{initCatmullRom:function(e,t,i,r,a){n(t,i,a*(i-e),a*(r-t))},initNonuniformCatmullRom:function(e,t,i,r,a,o,s){let l=(t-e)/a-(i-e)/(a+o)+(i-t)/o,c=(i-t)/o-(r-t)/(o+s)+(r-i)/s;l*=o,c*=o,n(t,i,l,c)},calc:function(n){const a=n*n;return e+t*n+i*a+r*(a*n)}}}Cc.prototype.isArcCurve=!0;const Ic=new xr,Pc=new Ac,zc=new Ac,Rc=new Ac;class kc extends Tc{constructor(e=[],t=!1,i="centripetal",r=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=r}getPoint(e,t=new xr){const i=t,r=this.points,n=r.length,a=(n-(this.closed?0:1))*e;let o,s,l=Math.floor(a),c=a-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/n)+1)*n:0===c&&l===n-1&&(l=n-2,c=1),this.closed||l>0?o=r[(l-1)%n]:(Ic.subVectors(r[0],r[1]).add(r[0]),o=Ic);const u=r[l%n],h=r[(l+1)%n];if(this.closed||l+2<n?s=r[(l+2)%n]:(Ic.subVectors(r[n-1],r[n-2]).add(r[n-1]),s=Ic),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(o.distanceToSquared(u),e),i=Math.pow(u.distanceToSquared(h),e),r=Math.pow(h.distanceToSquared(s),e);i<1e-4&&(i=1),t<1e-4&&(t=i),r<1e-4&&(r=i),Pc.initNonuniformCatmullRom(o.x,u.x,h.x,s.x,t,i,r),zc.initNonuniformCatmullRom(o.y,u.y,h.y,s.y,t,i,r),Rc.initNonuniformCatmullRom(o.z,u.z,h.z,s.z,t,i,r)}else"catmullrom"===this.curveType&&(Pc.initCatmullRom(o.x,u.x,h.x,s.x,this.tension),zc.initCatmullRom(o.y,u.y,h.y,s.y,this.tension),Rc.initCatmullRom(o.z,u.z,h.z,s.z,this.tension));return i.set(Pc.calc(c),zc.calc(c),Rc.calc(c)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push((new xr).fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function Lc(e,t,i,r,n){const a=.5*(r-t),o=.5*(n-i),s=e*e;return(2*i-2*r+a+o)*(e*s)+(-3*i+3*r-2*a-o)*s+a*e+i}function Dc(e,t,i,r){return function(e,t){const i=1-e;return i*i*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,i)+function(e,t){return e*e*t}(e,r)}function Bc(e,t,i,r,n){return function(e,t){const i=1-e;return i*i*i*t}(e,t)+function(e,t){const i=1-e;return 3*i*i*e*t}(e,i)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,n)}kc.prototype.isCatmullRomCurve3=!0;class Fc extends Tc{constructor(e=new or,t=new or,i=new or,r=new or){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new or){const i=t,r=this.v0,n=this.v1,a=this.v2,o=this.v3;return i.set(Bc(e,r.x,n.x,a.x,o.x),Bc(e,r.y,n.y,a.y,o.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}Fc.prototype.isCubicBezierCurve=!0;class Oc extends Tc{constructor(e=new xr,t=new xr,i=new xr,r=new xr){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new xr){const i=t,r=this.v0,n=this.v1,a=this.v2,o=this.v3;return i.set(Bc(e,r.x,n.x,a.x,o.x),Bc(e,r.y,n.y,a.y,o.y),Bc(e,r.z,n.z,a.z,o.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}Oc.prototype.isCubicBezierCurve3=!0;class Nc extends Tc{constructor(e=new or,t=new or){super(),this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new or){const i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const i=t||new or;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Nc.prototype.isLineCurve=!0;class Vc extends Tc{constructor(e=new or,t=new or,i=new or){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new or){const i=t,r=this.v0,n=this.v1,a=this.v2;return i.set(Dc(e,r.x,n.x,a.x),Dc(e,r.y,n.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Vc.prototype.isQuadraticBezierCurve=!0;class Uc extends Tc{constructor(e=new xr,t=new xr,i=new xr){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new xr){const i=t,r=this.v0,n=this.v1,a=this.v2;return i.set(Dc(e,r.x,n.x,a.x),Dc(e,r.y,n.y,a.y),Dc(e,r.z,n.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Uc.prototype.isQuadraticBezierCurve3=!0;class $c extends Tc{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,t=new or){const i=t,r=this.points,n=(r.length-1)*e,a=Math.floor(n),o=n-a,s=r[0===a?a:a-1],l=r[a],c=r[a>r.length-2?r.length-1:a+1],u=r[a>r.length-3?r.length-1:a+2];return i.set(Lc(o,s.x,l.x,c.x,u.x),Lc(o,s.y,l.y,c.y,u.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push((new or).fromArray(i))}return this}}$c.prototype.isSplineCurve=!0;var jc=Object.freeze({__proto__:null,ArcCurve:Cc,CatmullRomCurve3:kc,CubicBezierCurve:Fc,CubicBezierCurve3:Oc,EllipseCurve:Ec,LineCurve:Nc,LineCurve3:class extends Tc{constructor(e=new xr,t=new xr){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new xr){const i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},QuadraticBezierCurve:Vc,QuadraticBezierCurve3:Uc,SplineCurve:$c});class qc extends Tc{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Nc(t,e))}getPoint(e,t){const i=e*this.getLength(),r=this.getCurveLengths();let n=0;for(;n<r.length;){if(r[n]>=i){const e=r[n]-i,a=this.curves[n],o=a.getLength(),s=0===o?0:1-e/o;return a.getPointAt(s,t)}n++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let r=0,n=this.curves;r<n.length;r++){const a=n[r],o=a&&a.isEllipseCurve?2*e:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?e*a.points.length:e,s=a.getPoints(o);for(let e=0;e<s.length;e++){const r=s[e];i&&i.equals(r)||(t.push(r),i=r)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const i=this.curves[t];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const i=e.curves[t];this.curves.push((new jc[i.type]).fromJSON(i))}return this}}class Gc extends qc{constructor(e){super(),this.type="Path",this.currentPoint=new or,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new Nc(this.currentPoint.clone(),new or(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,r){const n=new Vc(this.currentPoint.clone(),new or(e,t),new or(i,r));return this.curves.push(n),this.currentPoint.set(i,r),this}bezierCurveTo(e,t,i,r,n,a){const o=new Fc(this.currentPoint.clone(),new or(e,t),new or(i,r),new or(n,a));return this.curves.push(o),this.currentPoint.set(n,a),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new $c(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,r,n,a){const o=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+o,t+s,i,r,n,a),this}absarc(e,t,i,r,n,a){return this.absellipse(e,t,i,i,r,n,a),this}ellipse(e,t,i,r,n,a,o,s){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,i,r,n,a,o,s),this}absellipse(e,t,i,r,n,a,o,s){const l=new Ec(e,t,i,r,n,a,o,s);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Hc extends Gc{constructor(e){super(e),this.uuid=Qi(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const i=e.holes[t];this.holes.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){const i=this.holes[t];e.holes.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const i=e.holes[t];this.holes.push((new Gc).fromJSON(i))}return this}}const Wc=function(e,t,i=2){const r=t&&t.length,n=r?t[0]*i:e.length;let a=Zc(e,0,n,i,!0);const o=[];if(!a||a.next===a.prev)return o;let s,l,c,u,h,p,d;if(r&&(a=function(e,t,i,r){const n=[];let a,o,s,l,c;for(a=0,o=t.length;a<o;a++)s=t[a]*r,l=a<o-1?t[a+1]*r:e.length,c=Zc(e,s,l,r,!1),c===c.next&&(c.steiner=!0),n.push(au(c));for(n.sort(tu),a=0;a<n.length;a++)iu(n[a],i),i=Xc(i,i.next);return i}(e,t,a,i)),e.length>80*i){s=c=e[0],l=u=e[1];for(let t=i;t<n;t+=i)h=e[t],p=e[t+1],h<s&&(s=h),p<l&&(l=p),h>c&&(c=h),p>u&&(u=p);d=Math.max(c-s,u-l),d=0!==d?1/d:0}return Yc(a,o,i,s,l,d),o};function Zc(e,t,i,r,n){let a,o;if(n===function(e,t,i,r){let n=0;for(let a=t,o=i-r;a<i;a+=r)n+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return n}(e,t,i,r)>0)for(a=t;a<i;a+=r)o=mu(a,e[a],e[a+1],o);else for(a=i-r;a>=t;a-=r)o=mu(a,e[a],e[a+1],o);return o&&cu(o,o.next)&&(gu(o),o=o.next),o}function Xc(e,t){if(!e)return e;t||(t=e);let i,r=e;do{if(i=!1,r.steiner||!cu(r,r.next)&&0!==lu(r.prev,r,r.next))r=r.next;else{if(gu(r),r=t=r.prev,r===r.next)break;i=!0}}while(i||r!==t);return t}function Yc(e,t,i,r,n,a,o){if(!e)return;!o&&a&&function(e,t,i,r){let n=e;do{null===n.z&&(n.z=nu(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){let t,i,r,n,a,o,s,l,c=1;do{for(i=e,e=null,a=null,o=0;i;){for(o++,r=i,s=0,t=0;t<c&&(s++,r=r.nextZ,r);t++);for(l=c;s>0||l>0&&r;)0!==s&&(0===l||!r||i.z<=r.z)?(n=i,i=i.nextZ,s--):(n=r,r=r.nextZ,l--),a?a.nextZ=n:e=n,n.prevZ=a,a=n;i=r}a.nextZ=null,c*=2}while(o>1)}(n)}(e,r,n,a);let s,l,c=e;for(;e.prev!==e.next;)if(s=e.prev,l=e.next,a?Jc(e,r,n,a):Kc(e))t.push(s.i/i),t.push(e.i/i),t.push(l.i/i),gu(e),e=l.next,c=l.next;else if((e=l)===c){o?1===o?Yc(e=Qc(Xc(e),t,i),t,i,r,n,a,2):2===o&&eu(e,t,i,r,n,a):Yc(Xc(e),t,i,r,n,a,1);break}}function Kc(e){const t=e.prev,i=e,r=e.next;if(lu(t,i,r)>=0)return!1;let n=e.next.next;for(;n!==e.prev;){if(ou(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&lu(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function Jc(e,t,i,r){const n=e.prev,a=e,o=e.next;if(lu(n,a,o)>=0)return!1;const s=n.x<a.x?n.x<o.x?n.x:o.x:a.x<o.x?a.x:o.x,l=n.y<a.y?n.y<o.y?n.y:o.y:a.y<o.y?a.y:o.y,c=n.x>a.x?n.x>o.x?n.x:o.x:a.x>o.x?a.x:o.x,u=n.y>a.y?n.y>o.y?n.y:o.y:a.y>o.y?a.y:o.y,h=nu(s,l,t,i,r),p=nu(c,u,t,i,r);let d=e.prevZ,f=e.nextZ;for(;d&&d.z>=h&&f&&f.z<=p;){if(d!==e.prev&&d!==e.next&&ou(n.x,n.y,a.x,a.y,o.x,o.y,d.x,d.y)&&lu(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,f!==e.prev&&f!==e.next&&ou(n.x,n.y,a.x,a.y,o.x,o.y,f.x,f.y)&&lu(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;d&&d.z>=h;){if(d!==e.prev&&d!==e.next&&ou(n.x,n.y,a.x,a.y,o.x,o.y,d.x,d.y)&&lu(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;f&&f.z<=p;){if(f!==e.prev&&f!==e.next&&ou(n.x,n.y,a.x,a.y,o.x,o.y,f.x,f.y)&&lu(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function Qc(e,t,i){let r=e;do{const n=r.prev,a=r.next.next;!cu(n,a)&&uu(n,r,r.next,a)&&du(n,a)&&du(a,n)&&(t.push(n.i/i),t.push(r.i/i),t.push(a.i/i),gu(r),gu(r.next),r=e=a),r=r.next}while(r!==e);return Xc(r)}function eu(e,t,i,r,n,a){let o=e;do{let e=o.next.next;for(;e!==o.prev;){if(o.i!==e.i&&su(o,e)){let s=fu(o,e);return o=Xc(o,o.next),s=Xc(s,s.next),Yc(o,t,i,r,n,a),void Yc(s,t,i,r,n,a)}e=e.next}o=o.next}while(o!==e)}function tu(e,t){return e.x-t.x}function iu(e,t){if(t=function(e,t){let i=t;const r=e.x,n=e.y;let a,o=-1/0;do{if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){const e=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=r&&e>o){if(o=e,e===r){if(n===i.y)return i;if(n===i.next.y)return i.next}a=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!a)return null;if(r===o)return a;const s=a,l=a.x,c=a.y;let u,h=1/0;i=a;do{r>=i.x&&i.x>=l&&r!==i.x&&ou(n<c?r:o,n,l,c,n<c?o:r,n,i.x,i.y)&&(u=Math.abs(n-i.y)/(r-i.x),du(i,e)&&(u<h||u===h&&(i.x>a.x||i.x===a.x&&ru(a,i)))&&(a=i,h=u)),i=i.next}while(i!==s);return a}(e,t),t){const i=fu(t,e);Xc(t,t.next),Xc(i,i.next)}}function ru(e,t){return lu(e.prev,e,t.prev)<0&&lu(t.next,e,e.next)<0}function nu(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function au(e){let t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function ou(e,t,i,r,n,a,o,s){return(n-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(r-s)-(i-o)*(t-s)>=0&&(i-o)*(a-s)-(n-o)*(r-s)>=0}function su(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&uu(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(du(e,t)&&du(t,e)&&function(e,t){let i=e,r=!1;const n=(e.x+t.x)/2,a=(e.y+t.y)/2;do{i.y>a!==i.next.y>a&&i.next.y!==i.y&&n<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}(e,t)&&(lu(e.prev,e,t.prev)||lu(e,t.prev,t))||cu(e,t)&&lu(e.prev,e,e.next)>0&&lu(t.prev,t,t.next)>0)}function lu(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function cu(e,t){return e.x===t.x&&e.y===t.y}function uu(e,t,i,r){const n=pu(lu(e,t,i)),a=pu(lu(e,t,r)),o=pu(lu(i,r,e)),s=pu(lu(i,r,t));return n!==a&&o!==s||(!(0!==n||!hu(e,i,t))||(!(0!==a||!hu(e,r,t))||(!(0!==o||!hu(i,e,r))||!(0!==s||!hu(i,t,r)))))}function hu(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function pu(e){return e>0?1:e<0?-1:0}function du(e,t){return lu(e.prev,e,e.next)<0?lu(e,t,e.next)>=0&&lu(e,e.prev,t)>=0:lu(e,t,e.prev)<0||lu(e,e.next,t)<0}function fu(e,t){const i=new _u(e.i,e.x,e.y),r=new _u(t.i,t.x,t.y),n=e.next,a=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,a.next=r,r.prev=a,r}function mu(e,t,i,r){const n=new _u(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function gu(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function _u(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class yu{static area(e){const t=e.length;let i=0;for(let r=t-1,n=0;n<t;r=n++)i+=e[r].x*e[n].y-e[n].x*e[r].y;return.5*i}static isClockWise(e){return yu.area(e)<0}static triangulateShape(e,t){const i=[],r=[],n=[];vu(e),xu(i,e);let a=e.length;t.forEach(vu);for(let s=0;s<t.length;s++)r.push(a),a+=t[s].length,xu(i,t[s]);const o=Wc(i,r);for(let s=0;s<o.length;s+=3)n.push(o.slice(s,s+3));return n}}function vu(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function xu(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}class bu extends na{constructor(e=new Hc([new or(.5,.5),new or(-.5,.5),new or(-.5,-.5),new or(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,r=[],n=[];for(let o=0,s=e.length;o<s;o++){a(e[o])}function a(e){const a=[],o=void 0!==t.curveSegments?t.curveSegments:12,s=void 0!==t.steps?t.steps:1;let l=void 0!==t.depth?t.depth:1,c=void 0===t.bevelEnabled||t.bevelEnabled,u=void 0!==t.bevelThickness?t.bevelThickness:.2,h=void 0!==t.bevelSize?t.bevelSize:u-.1,p=void 0!==t.bevelOffset?t.bevelOffset:0,d=void 0!==t.bevelSegments?t.bevelSegments:3;const f=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:wu;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=t.amount);let g,_,y,v,x,b=!1;f&&(g=f.getSpacedPoints(s),b=!0,c=!1,_=f.computeFrenetFrames(s,!1),y=new xr,v=new xr,x=new xr),c||(d=0,u=0,h=0,p=0);const w=e.extractPoints(o);let S=w.shape;const M=w.holes;if(!yu.isClockWise(S)){S=S.reverse();for(let e=0,t=M.length;e<t;e++){const t=M[e];yu.isClockWise(t)&&(M[e]=t.reverse())}}const T=yu.triangulateShape(S,M),E=S;for(let t=0,i=M.length;t<i;t++){const e=M[t];S=S.concat(e)}function C(e,t,i){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(i).add(e)}const A=S.length,I=T.length;function P(e,t,i){let r,n,a;const o=e.x-t.x,s=e.y-t.y,l=i.x-e.x,c=i.y-e.y,u=o*o+s*s,h=o*c-s*l;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),p=Math.sqrt(l*l+c*c),d=t.x-s/h,f=t.y+o/h,m=((i.x-c/p-d)*c-(i.y+l/p-f)*l)/(o*c-s*l);r=d+o*m-e.x,n=f+s*m-e.y;const g=r*r+n*n;if(g<=2)return new or(r,n);a=Math.sqrt(g/2)}else{let e=!1;o>Number.EPSILON?l>Number.EPSILON&&(e=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(s)===Math.sign(c)&&(e=!0),e?(r=-s,n=o,a=Math.sqrt(u)):(r=o,n=s,a=Math.sqrt(u/2))}return new or(r/a,n/a)}const z=[];for(let t=0,i=E.length,r=i-1,n=t+1;t<i;t++,r++,n++)r===i&&(r=0),n===i&&(n=0),z[t]=P(E[t],E[r],E[n]);const R=[];let k,L=z.concat();for(let t=0,i=M.length;t<i;t++){const e=M[t];k=[];for(let t=0,i=e.length,r=i-1,n=t+1;t<i;t++,r++,n++)r===i&&(r=0),n===i&&(n=0),k[t]=P(e[t],e[r],e[n]);R.push(k),L=L.concat(k)}for(let t=0;t<d;t++){const e=t/d,i=u*Math.cos(e*Math.PI/2),r=h*Math.sin(e*Math.PI/2)+p;for(let t=0,n=E.length;t<n;t++){const e=C(E[t],z[t],r);F(e.x,e.y,-i)}for(let t=0,n=M.length;t<n;t++){const e=M[t];k=R[t];for(let t=0,n=e.length;t<n;t++){const n=C(e[t],k[t],r);F(n.x,n.y,-i)}}}const D=h+p;for(let t=0;t<A;t++){const e=c?C(S[t],L[t],D):S[t];b?(v.copy(_.normals[0]).multiplyScalar(e.x),y.copy(_.binormals[0]).multiplyScalar(e.y),x.copy(g[0]).add(v).add(y),F(x.x,x.y,x.z)):F(e.x,e.y,0)}for(let t=1;t<=s;t++)for(let e=0;e<A;e++){const i=c?C(S[e],L[e],D):S[e];b?(v.copy(_.normals[t]).multiplyScalar(i.x),y.copy(_.binormals[t]).multiplyScalar(i.y),x.copy(g[t]).add(v).add(y),F(x.x,x.y,x.z)):F(i.x,i.y,l/s*t)}for(let t=d-1;t>=0;t--){const e=t/d,i=u*Math.cos(e*Math.PI/2),r=h*Math.sin(e*Math.PI/2)+p;for(let t=0,n=E.length;t<n;t++){const e=C(E[t],z[t],r);F(e.x,e.y,l+i)}for(let t=0,n=M.length;t<n;t++){const e=M[t];k=R[t];for(let t=0,n=e.length;t<n;t++){const n=C(e[t],k[t],r);b?F(n.x,n.y+g[s-1].y,g[s-1].x+i):F(n.x,n.y,l+i)}}}function B(e,t){let i=e.length;for(;--i>=0;){const r=i;let n=i-1;n<0&&(n=e.length-1);for(let e=0,i=s+2*d;e<i;e++){const i=A*e,a=A*(e+1);N(t+r+i,t+n+i,t+n+a,t+r+a)}}}function F(e,t,i){a.push(e),a.push(t),a.push(i)}function O(e,t,n){V(e),V(t),V(n);const a=r.length/3,o=m.generateTopUV(i,r,a-3,a-2,a-1);U(o[0]),U(o[1]),U(o[2])}function N(e,t,n,a){V(e),V(t),V(a),V(t),V(n),V(a);const o=r.length/3,s=m.generateSideWallUV(i,r,o-6,o-3,o-2,o-1);U(s[0]),U(s[1]),U(s[3]),U(s[1]),U(s[2]),U(s[3])}function V(e){r.push(a[3*e+0]),r.push(a[3*e+1]),r.push(a[3*e+2])}function U(e){n.push(e.x),n.push(e.y)}!function(){const e=r.length/3;if(c){let e=0,t=A*e;for(let i=0;i<I;i++){const e=T[i];O(e[2]+t,e[1]+t,e[0]+t)}e=s+2*d,t=A*e;for(let i=0;i<I;i++){const e=T[i];O(e[0]+t,e[1]+t,e[2]+t)}}else{for(let e=0;e<I;e++){const t=T[e];O(t[2],t[1],t[0])}for(let e=0;e<I;e++){const t=T[e];O(t[0]+A*s,t[1]+A*s,t[2]+A*s)}}i.addGroup(e,r.length/3-e,0)}(),function(){const e=r.length/3;let t=0;B(E,t),t+=E.length;for(let i=0,r=M.length;i<r;i++){const e=M[i];B(e,t),t+=e.length}i.addGroup(e,r.length/3-e,1)}()}this.setAttribute("position",new Yn(r,3)),this.setAttribute("uv",new Yn(n,2)),this.computeVertexNormals()}toJSON(){const e=super.toJSON();return function(e,t,i){if(i.shapes=[],Array.isArray(e))for(let r=0,n=e.length;r<n;r++){const t=e[r];i.shapes.push(t.uuid)}else i.shapes.push(e.uuid);void 0!==t.extrudePath&&(i.options.extrudePath=t.extrudePath.toJSON());return i}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const i=[];for(let n=0,a=e.shapes.length;n<a;n++){const r=t[e.shapes[n]];i.push(r)}const r=e.options.extrudePath;return void 0!==r&&(e.options.extrudePath=(new jc[r.type]).fromJSON(r)),new bu(i,e.options)}}const wu={generateTopUV:function(e,t,i,r,n){const a=t[3*i],o=t[3*i+1],s=t[3*r],l=t[3*r+1],c=t[3*n],u=t[3*n+1];return[new or(a,o),new or(s,l),new or(c,u)]},generateSideWallUV:function(e,t,i,r,n,a){const o=t[3*i],s=t[3*i+1],l=t[3*i+2],c=t[3*r],u=t[3*r+1],h=t[3*r+2],p=t[3*n],d=t[3*n+1],f=t[3*n+2],m=t[3*a],g=t[3*a+1],_=t[3*a+2];return Math.abs(s-u)<Math.abs(o-c)?[new or(o,1-l),new or(c,1-h),new or(p,1-f),new or(m,1-_)]:[new or(s,1-l),new or(u,1-h),new or(d,1-f),new or(g,1-_)]}};class Su extends na{constructor(e=new Hc([new or(0,.5),new or(-.5,-.5),new or(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],r=[],n=[],a=[];let o=0,s=0;if(!1===Array.isArray(e))l(e);else for(let c=0;c<e.length;c++)l(e[c]),this.addGroup(o,s,c),o+=s,s=0;function l(e){const o=r.length/3,l=e.extractPoints(t);let c=l.shape;const u=l.holes;!1===yu.isClockWise(c)&&(c=c.reverse());for(let t=0,i=u.length;t<i;t++){const e=u[t];!0===yu.isClockWise(e)&&(u[t]=e.reverse())}const h=yu.triangulateShape(c,u);for(let t=0,i=u.length;t<i;t++){const e=u[t];c=c.concat(e)}for(let t=0,i=c.length;t<i;t++){const e=c[t];r.push(e.x,e.y,0),n.push(0,0,1),a.push(e.x,e.y)}for(let t=0,r=h.length;t<r;t++){const e=h[t],r=e[0]+o,n=e[1]+o,a=e[2]+o;i.push(r,n,a),s+=3}}this.setIndex(i),this.setAttribute("position",new Yn(r,3)),this.setAttribute("normal",new Yn(n,3)),this.setAttribute("uv",new Yn(a,2))}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let i=0,r=e.length;i<r;i++){const r=e[i];t.shapes.push(r.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){const i=[];for(let r=0,n=e.shapes.length;r<n;r++){const n=t[e.shapes[r]];i.push(n)}return new Su(i,e.curveSegments)}}class Mu extends na{constructor(e=1,t=32,i=16,r=0,n=2*Math.PI,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:n,thetaStart:a,thetaLength:o},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const s=Math.min(a+o,Math.PI);let l=0;const c=[],u=new xr,h=new xr,p=[],d=[],f=[],m=[];for(let g=0;g<=i;g++){const p=[],_=g/i;let y=0;0==g&&0==a?y=.5/t:g==i&&s==Math.PI&&(y=-.5/t);for(let i=0;i<=t;i++){const s=i/t;u.x=-e*Math.cos(r+s*n)*Math.sin(a+_*o),u.y=e*Math.cos(a+_*o),u.z=e*Math.sin(r+s*n)*Math.sin(a+_*o),d.push(u.x,u.y,u.z),h.copy(u).normalize(),f.push(h.x,h.y,h.z),m.push(s+y,1-_),p.push(l++)}c.push(p)}for(let g=0;g<i;g++)for(let e=0;e<t;e++){const t=c[g][e+1],r=c[g][e],n=c[g+1][e],o=c[g+1][e+1];(0!==g||a>0)&&p.push(t,r,o),(g!==i-1||s<Math.PI)&&p.push(r,n,o)}this.setIndex(p),this.setAttribute("position",new Yn(d,3)),this.setAttribute("normal",new Yn(f,3)),this.setAttribute("uv",new Yn(m,2))}static fromJSON(e){return new Mu(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}(class extends Bn{constructor(e){super(),this.type="ShadowMaterial",this.color=new jn(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}).prototype.isShadowMaterial=!0;class Tu extends Bn{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new jn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new or(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}Tu.prototype.isMeshStandardMaterial=!0;(class extends Tu{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new or(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return er(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.sheenColor=new jn(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new jn(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new jn(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!==e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!==e>0&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!==e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}).prototype.isMeshPhysicalMaterial=!0;(class extends Bn{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new jn(16777215),this.specular=new jn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new or(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}).prototype.isMeshPhongMaterial=!0;(class extends Bn{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new jn(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new or(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}).prototype.isMeshToonMaterial=!0;(class extends Bn{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new or(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}).prototype.isMeshNormalMaterial=!0;(class extends Bn{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new jn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}).prototype.isMeshLambertMaterial=!0;(class extends Bn{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new jn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new or(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}).prototype.isMeshMatcapMaterial=!0;(class extends lc{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}).prototype.isLineDashedMaterial=!0;const Eu={arraySlice:function(e,t,i){return Eu.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==i?i:e.length)):e.slice(t,i)},convertArray:function(e,t,i){return!e||!i&&e.constructor===t?e:"number"===typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){const t=e.length,i=new Array(t);for(let r=0;r!==t;++r)i[r]=r;return i.sort((function(t,i){return e[t]-e[i]})),i},sortedArray:function(e,t,i){const r=e.length,n=new e.constructor(r);for(let a=0,o=0;o!==r;++a){const r=i[a]*t;for(let i=0;i!==t;++i)n[o++]=e[r+i]}return n},flattenJSON:function(e,t,i,r){let n=1,a=e[0];for(;void 0!==a&&void 0===a[r];)a=e[n++];if(void 0===a)return;let o=a[r];if(void 0!==o)if(Array.isArray(o))do{o=a[r],void 0!==o&&(t.push(a.time),i.push.apply(i,o)),a=e[n++]}while(void 0!==a);else if(void 0!==o.toArray)do{o=a[r],void 0!==o&&(t.push(a.time),o.toArray(i,i.length)),a=e[n++]}while(void 0!==a);else do{o=a[r],void 0!==o&&(t.push(a.time),i.push(o)),a=e[n++]}while(void 0!==a)},subclip:function(e,t,i,r,n=30){const a=e.clone();a.name=t;const o=[];for(let l=0;l<a.tracks.length;++l){const e=a.tracks[l],t=e.getValueSize(),s=[],c=[];for(let a=0;a<e.times.length;++a){const o=e.times[a]*n;if(!(o<i||o>=r)){s.push(e.times[a]);for(let i=0;i<t;++i)c.push(e.values[a*t+i])}}0!==s.length&&(e.times=Eu.convertArray(s,e.times.constructor),e.values=Eu.convertArray(c,e.values.constructor),o.push(e))}a.tracks=o;let s=1/0;for(let l=0;l<a.tracks.length;++l)s>a.tracks[l].times[0]&&(s=a.tracks[l].times[0]);for(let l=0;l<a.tracks.length;++l)a.tracks[l].shift(-1*s);return a.resetDuration(),a},makeClipAdditive:function(e,t=0,i=e,r=30){r<=0&&(r=30);const n=i.tracks.length,a=t/r;for(let o=0;o<n;++o){const t=i.tracks[o],r=t.ValueTypeName;if("bool"===r||"string"===r)continue;const n=e.tracks.find((function(e){return e.name===t.name&&e.ValueTypeName===r}));if(void 0===n)continue;let s=0;const l=t.getValueSize();t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(s=l/3);let c=0;const u=n.getValueSize();n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);const h=t.times.length-1;let p;if(a<=t.times[0]){const e=s,i=l-s;p=Eu.arraySlice(t.values,e,i)}else if(a>=t.times[h]){const e=h*l+s,i=e+l-s;p=Eu.arraySlice(t.values,e,i)}else{const e=t.createInterpolant(),i=s,r=l-s;e.evaluate(a),p=Eu.arraySlice(e.resultBuffer,i,r)}if("quaternion"===r){(new vr).fromArray(p).normalize().conjugate().toArray(p)}const d=n.times.length;for(let e=0;e<d;++e){const t=e*u+c;if("quaternion"===r)vr.multiplyQuaternionsFlat(n.values,t,p,0,n.values,t);else{const e=u-2*c;for(let i=0;i<e;++i)n.values[t+i]-=p[i]}}}return e.blendMode=2501,e}};class Cu{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,r=t[i],n=t[i-1];e:{t:{let a;i:{r:if(!(e<r)){for(let a=i+2;;){if(void 0===r){if(e<n)break r;return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,e,n)}if(i===a)break;if(n=r,r=t[++i],e<r)break t}a=t.length;break i}if(e>=n)break e;{const o=t[1];e<o&&(i=2,n=o);for(let a=i-2;;){if(void 0===n)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(i===a)break;if(r=n,n=t[--i-1],e>=n)break t}a=i,i=0}}for(;i<a;){const r=i+a>>>1;e<t[r]?a=r:i=r+1}if(r=t[i],n=t[i-1],void 0===n)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,n,e)}this._cachedIndex=i,this.intervalChanged_(i,n,r)}return this.interpolate_(i,n,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=e*r;for(let a=0;a!==r;++a)t[a]=i[n+a];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}Cu.prototype.beforeStart_=Cu.prototype.copySampleValue_,Cu.prototype.afterEnd_=Cu.prototype.copySampleValue_;class Au extends Cu{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Di,endingEnd:Di}}intervalChanged_(e,t,i){const r=this.parameterPositions;let n=e-2,a=e+1,o=r[n],s=r[a];if(void 0===o)switch(this.getSettings_().endingStart){case Bi:n=e,o=2*t-i;break;case Fi:n=r.length-2,o=t+r[n]-r[n+1];break;default:n=e,o=i}if(void 0===s)switch(this.getSettings_().endingEnd){case Bi:a=e,s=2*i-t;break;case Fi:a=1,s=i+r[1]-r[0];break;default:a=e-1,s=t}const l=.5*(i-t),c=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(s-i),this._offsetPrev=n*c,this._offsetNext=a*c}interpolate_(e,t,i,r){const n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,p=this._weightNext,d=(i-t)/(r-t),f=d*d,m=f*d,g=-h*m+2*h*f-h*d,_=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*d+1,y=(-1-p)*m+(1.5+p)*f+.5*d,v=p*m-p*f;for(let x=0;x!==o;++x)n[x]=g*a[c+x]+_*a[l+x]+y*a[s+x]+v*a[u+x];return n}}class Iu extends Cu{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,c=(i-t)/(r-t),u=1-c;for(let h=0;h!==o;++h)n[h]=a[l+h]*u+a[s+h]*c;return n}}class Pu extends Cu{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class zu{constructor(e,t,i,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Eu.convertArray(t,this.TimeBufferType),this.values=Eu.convertArray(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:Eu.convertArray(e.times,Array),values:Eu.convertArray(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(i.interpolation=t)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new Pu(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Iu(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Au(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Ri:t=this.InterpolantFactoryMethodDiscrete;break;case ki:t=this.InterpolantFactoryMethodLinear;break;case Li:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ri;case this.InterpolantFactoryMethodLinear:return ki;case this.InterpolantFactoryMethodSmooth:return Li}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){const i=this.times,r=i.length;let n=0,a=r-1;for(;n!==r&&i[n]<e;)++n;for(;-1!==a&&i[a]>t;)--a;if(++a,0!==n||a!==r){n>=a&&(a=Math.max(a,1),n=a-1);const e=this.getValueSize();this.times=Eu.arraySlice(i,n,a),this.values=Eu.arraySlice(this.values,n*e,a*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,r=this.values,n=i.length;0===n&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let o=0;o!==n;o++){const t=i[o];if("number"===typeof t&&isNaN(t)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,t),e=!1;break}if(null!==a&&a>t){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,t,a),e=!1;break}a=t}if(void 0!==r&&Eu.isTypedArray(r))for(let o=0,s=r.length;o!==s;++o){const t=r[o];if(isNaN(t)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,t),e=!1;break}}return e}optimize(){const e=Eu.arraySlice(this.times),t=Eu.arraySlice(this.values),i=this.getValueSize(),r=this.getInterpolation()===Li,n=e.length-1;let a=1;for(let o=1;o<n;++o){let n=!1;const s=e[o];if(s!==e[o+1]&&(1!==o||s!==e[0]))if(r)n=!0;else{const e=o*i,r=e-i,a=e+i;for(let o=0;o!==i;++o){const i=t[e+o];if(i!==t[r+o]||i!==t[a+o]){n=!0;break}}}if(n){if(o!==a){e[a]=e[o];const r=o*i,n=a*i;for(let e=0;e!==i;++e)t[n+e]=t[r+e]}++a}}if(n>0){e[a]=e[n];for(let e=n*i,r=a*i,o=0;o!==i;++o)t[r+o]=t[e+o];++a}return a!==e.length?(this.times=Eu.arraySlice(e,0,a),this.values=Eu.arraySlice(t,0,a*i)):(this.times=e,this.values=t),this}clone(){const e=Eu.arraySlice(this.times,0),t=Eu.arraySlice(this.values,0),i=new(0,this.constructor)(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}zu.prototype.TimeBufferType=Float32Array,zu.prototype.ValueBufferType=Float32Array,zu.prototype.DefaultInterpolation=ki;class Ru extends zu{}Ru.prototype.ValueTypeName="bool",Ru.prototype.ValueBufferType=Array,Ru.prototype.DefaultInterpolation=Ri,Ru.prototype.InterpolantFactoryMethodLinear=void 0,Ru.prototype.InterpolantFactoryMethodSmooth=void 0;class ku extends zu{}ku.prototype.ValueTypeName="color";class Lu extends zu{}Lu.prototype.ValueTypeName="number";class Du extends Cu{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=(i-t)/(r-t);let l=e*o;for(let c=l+o;l!==c;l+=4)vr.slerpFlat(n,0,a,l-o,a,l,s);return n}}class Bu extends zu{InterpolantFactoryMethodLinear(e){return new Du(this.times,this.values,this.getValueSize(),e)}}Bu.prototype.ValueTypeName="quaternion",Bu.prototype.DefaultInterpolation=ki,Bu.prototype.InterpolantFactoryMethodSmooth=void 0;class Fu extends zu{}Fu.prototype.ValueTypeName="string",Fu.prototype.ValueBufferType=Array,Fu.prototype.DefaultInterpolation=Ri,Fu.prototype.InterpolantFactoryMethodLinear=void 0,Fu.prototype.InterpolantFactoryMethodSmooth=void 0;class Ou extends zu{}Ou.prototype.ValueTypeName="vector";class Nu{constructor(e,t=-1,i,r=2500){this.name=e,this.tracks=i,this.duration=t,this.blendMode=r,this.uuid=Qi(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,r=1/(e.fps||1);for(let a=0,o=i.length;a!==o;++a)t.push(Vu(i[a]).scale(r));const n=new this(e.name,e.duration,t,e.blendMode);return n.uuid=e.uuid,n}static toJSON(e){const t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let n=0,a=i.length;n!==a;++n)t.push(zu.toJSON(i[n]));return r}static CreateFromMorphTargetSequence(e,t,i,r){const n=t.length,a=[];for(let o=0;o<n;o++){let e=[],s=[];e.push((o+n-1)%n,o,(o+1)%n),s.push(0,1,0);const l=Eu.getKeyframeOrder(e);e=Eu.sortedArray(e,1,l),s=Eu.sortedArray(s,1,l),r||0!==e[0]||(e.push(n),s.push(s[0])),a.push(new Lu(".morphTargetInfluences["+t[o].name+"]",e,s).scale(1/i))}return new this(e,-1,a)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const t=e;i=t.geometry&&t.geometry.animations||t.animations}for(let r=0;r<i.length;r++)if(i[r].name===t)return i[r];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const r={},n=/^([\w-]*?)([\d]+)$/;for(let o=0,s=e.length;o<s;o++){const t=e[o],i=t.name.match(n);if(i&&i.length>1){const e=i[1];let n=r[e];n||(r[e]=n=[]),n.push(t)}}const a=[];for(const o in r)a.push(this.CreateFromMorphTargetSequence(o,r[o],t,i));return a}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(e,t,i,r,n){if(0!==i.length){const a=[],o=[];Eu.flattenJSON(i,a,o,r),0!==a.length&&n.push(new e(t,a,o))}},r=[],n=e.name||"default",a=e.fps||30,o=e.blendMode;let s=e.length||-1;const l=e.hierarchy||[];for(let c=0;c<l.length;c++){const e=l[c].keys;if(e&&0!==e.length)if(e[0].morphTargets){const t={};let i;for(i=0;i<e.length;i++)if(e[i].morphTargets)for(let r=0;r<e[i].morphTargets.length;r++)t[e[i].morphTargets[r]]=-1;for(const n in t){const t=[],a=[];for(let r=0;r!==e[i].morphTargets.length;++r){const r=e[i];t.push(r.time),a.push(r.morphTarget===n?1:0)}r.push(new Lu(".morphTargetInfluence["+n+"]",t,a))}s=t.length*(a||1)}else{const n=".bones["+t[c].name+"]";i(Ou,n+".position",e,"pos",r),i(Bu,n+".quaternion",e,"rot",r),i(Ou,n+".scale",e,"scl",r)}}if(0===r.length)return null;return new this(n,s,r,o)}resetDuration(){let e=0;for(let t=0,i=this.tracks.length;t!==i;++t){const i=this.tracks[t];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Vu(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Lu;case"vector":case"vector2":case"vector3":case"vector4":return Ou;case"color":return ku;case"quaternion":return Bu;case"bool":case"boolean":return Ru;case"string":return Fu}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],i=[];Eu.flattenJSON(e.keys,t,i,"value"),e.times=t,e.values=i}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const Uu={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};const $u=new class{constructor(e,t,i){const r=this;let n,a=!1,o=0,s=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){s++,!1===a&&void 0!==r.onStart&&r.onStart(e,o,s),a=!0},this.itemEnd=function(e){o++,void 0!==r.onProgress&&r.onProgress(e,o,s),o===s&&(a=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return n?n(e):e},this.setURLModifier=function(e){return n=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,i=l.length;t<i;t+=2){const i=l[t],r=l[t+1];if(i.global&&(i.lastIndex=0),i.test(e))return r}return null}}};class ju{constructor(e){this.manager=void 0!==e?e:$u,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise((function(r,n){i.load(e,r,t,n)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const qu={};class Gu extends ju{constructor(e){super(e)}load(e,t,i,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const n=Uu.get(e);if(void 0!==n)return this.manager.itemStart(e),setTimeout((()=>{t&&t(n),this.manager.itemEnd(e)}),0),n;if(void 0!==qu[e])return void qu[e].push({onLoad:t,onProgress:i,onError:r});qu[e]=[],qu[e].push({onLoad:t,onProgress:i,onError:r});const a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"});fetch(a).then((t=>{if(200===t.status||0===t.status){0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");const i=qu[e],r=t.body.getReader(),n=t.headers.get("Content-Length"),a=n?parseInt(n):0,o=0!==a;let s=0;return new ReadableStream({start(e){!function t(){r.read().then((({done:r,value:n})=>{if(r)e.close();else{s+=n.byteLength;const r=new ProgressEvent("progress",{lengthComputable:o,loaded:s,total:a});for(let e=0,t=i.length;e<t;e++){const t=i[e];t.onProgress&&t.onProgress(r)}e.enqueue(n),t()}}))}()}})}throw Error(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`)})).then((e=>{const t=new Response(e);switch(this.responseType){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((e=>(new DOMParser).parseFromString(e,this.mimeType)));case"json":return t.json();default:return t.text()}})).then((t=>{Uu.add(e,t);const i=qu[e];delete qu[e];for(let e=0,r=i.length;e<r;e++){const r=i[e];r.onLoad&&r.onLoad(t)}this.manager.itemEnd(e)})).catch((t=>{const i=qu[e];delete qu[e];for(let e=0,r=i.length;e<r;e++){const r=i[e];r.onError&&r.onError(t)}this.manager.itemError(e),this.manager.itemEnd(e)})),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Hu extends ju{constructor(e){super(e)}load(e,t,i,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const n=this,a=Uu.get(e);if(void 0!==a)return n.manager.itemStart(e),setTimeout((function(){t&&t(a),n.manager.itemEnd(e)}),0),a;const o=cr("img");function s(){c(),Uu.add(e,this),t&&t(this),n.manager.itemEnd(e)}function l(t){c(),r&&r(t),n.manager.itemError(e),n.manager.itemEnd(e)}function c(){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",s,!1),o.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),n.manager.itemStart(e),o.src=e,o}}class Wu extends ju{constructor(e){super(e)}load(e,t,i,r){const n=new ka,a=new Hu(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let o=0;function s(i){a.load(e[i],(function(e){n.images[i]=e,o++,6===o&&(n.needsUpdate=!0,t&&t(n))}),void 0,r)}for(let l=0;l<e.length;++l)s(l);return n}}class Zu extends ju{constructor(e){super(e)}load(e,t,i,r){const n=new fr,a=new Hu(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,(function(e){n.image=e,n.needsUpdate=!0,void 0!==t&&t(n)}),i,r),n}}class Xu extends Sn{constructor(e,t=1){super(),this.type="Light",this.color=new jn(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}Xu.prototype.isLight=!0;(class extends Xu{constructor(e,t,i){super(e,i),this.type="HemisphereLight",this.position.copy(Sn.DefaultUp),this.updateMatrix(),this.groundColor=new jn(t)}copy(e){return Xu.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}).prototype.isHemisphereLight=!0;const Yu=new Kr,Ku=new xr,Ju=new xr;class Qu{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new or(512,512),this.map=null,this.mapPass=null,this.matrix=new Kr,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Ua,this._frameExtents=new or(1,1),this._viewportCount=1,this._viewports=[new gr(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;Ku.setFromMatrixPosition(e.matrixWorld),t.position.copy(Ku),Ju.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Ju),t.updateMatrixWorld(),Yu.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Yu),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(t.projectionMatrix),i.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class eh extends Qu{constructor(){super(new Pa(50,1,.5,500)),this.focus=1}updateMatrices(e){const t=this.camera,i=2*Yi*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,n=e.distance||t.far;i===t.fov&&r===t.aspect&&n===t.far||(t.fov=i,t.aspect=r,t.far=n,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}eh.prototype.isSpotLightShadow=!0;(class extends Xu{constructor(e,t,i=0,r=Math.PI/3,n=0,a=1){super(e,t),this.type="SpotLight",this.position.copy(Sn.DefaultUp),this.updateMatrix(),this.target=new Sn,this.distance=i,this.angle=r,this.penumbra=n,this.decay=a,this.shadow=new eh}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}).prototype.isSpotLight=!0;const th=new Kr,ih=new xr,rh=new xr;class nh extends Qu{constructor(){super(new Pa(90,1,.5,500)),this._frameExtents=new or(4,2),this._viewportCount=6,this._viewports=[new gr(2,1,1,1),new gr(0,1,1,1),new gr(3,1,1,1),new gr(1,1,1,1),new gr(3,0,1,1),new gr(1,0,1,1)],this._cubeDirections=[new xr(1,0,0),new xr(-1,0,0),new xr(0,0,1),new xr(0,0,-1),new xr(0,1,0),new xr(0,-1,0)],this._cubeUps=[new xr(0,1,0),new xr(0,1,0),new xr(0,1,0),new xr(0,1,0),new xr(0,0,1),new xr(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,r=this.matrix,n=e.distance||i.far;n!==i.far&&(i.far=n,i.updateProjectionMatrix()),ih.setFromMatrixPosition(e.matrixWorld),i.position.copy(ih),rh.copy(i.position),rh.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(rh),i.updateMatrixWorld(),r.makeTranslation(-ih.x,-ih.y,-ih.z),th.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(th)}}nh.prototype.isPointLightShadow=!0;(class extends Xu{constructor(e,t,i=0,r=1){super(e,t),this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new nh}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}).prototype.isPointLight=!0;class ah extends Qu{constructor(){super(new eo(-5,5,5,-5,.5,500))}}ah.prototype.isDirectionalLightShadow=!0;(class extends Xu{constructor(e,t){super(e,t),this.type="DirectionalLight",this.position.copy(Sn.DefaultUp),this.updateMatrix(),this.target=new Sn,this.shadow=new ah}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}).prototype.isDirectionalLight=!0;(class extends Xu{constructor(e,t){super(e,t),this.type="AmbientLight"}}).prototype.isAmbientLight=!0;(class extends Xu{constructor(e,t,i=10,r=10){super(e,t),this.type="RectAreaLight",this.width=i,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}).prototype.isRectAreaLight=!0;class oh{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new xr)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,r=e.y,n=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*r),t.addScaledVector(a[2],.488603*n),t.addScaledVector(a[3],.488603*i),t.addScaledVector(a[4],i*r*1.092548),t.addScaledVector(a[5],r*n*1.092548),t.addScaledVector(a[6],.315392*(3*n*n-1)),t.addScaledVector(a[7],i*n*1.092548),t.addScaledVector(a[8],.546274*(i*i-r*r)),t}getIrradianceAt(e,t){const i=e.x,r=e.y,n=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],1.023328*r),t.addScaledVector(a[2],1.023328*n),t.addScaledVector(a[3],1.023328*i),t.addScaledVector(a[4],.858086*i*r),t.addScaledVector(a[5],.858086*r*n),t.addScaledVector(a[6],.743125*n*n-.247708),t.addScaledVector(a[7],.858086*i*n),t.addScaledVector(a[8],.429043*(i*i-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].fromArray(e,t+3*r);return this}toArray(e=[],t=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].toArray(e,t+3*r);return e}static getBasisAt(e,t){const i=e.x,r=e.y,n=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*n,t[3]=.488603*i,t[4]=1.092548*i*r,t[5]=1.092548*r*n,t[6]=.315392*(3*n*n-1),t[7]=1.092548*i*n,t[8]=.546274*(i*i-r*r)}}oh.prototype.isSphericalHarmonics3=!0;class sh extends Xu{constructor(e=new oh,t=1){super(void 0,t),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}sh.prototype.isLightProbe=!0;(class extends na{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}).prototype.isInstancedBufferGeometry=!0;let lh;(class extends ju{constructor(e){super(e),"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const n=this,a=Uu.get(e);if(void 0!==a)return n.manager.itemStart(e),setTimeout((function(){t&&t(a),n.manager.itemEnd(e)}),0),a;const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(e,o).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(n.options,{colorSpaceConversion:"none"}))})).then((function(i){Uu.add(e,i),t&&t(i),n.manager.itemEnd(e)})).catch((function(t){r&&r(t),n.manager.itemError(e),n.manager.itemEnd(e)})),n.manager.itemStart(e)}}).prototype.isImageBitmapLoader=!0;const ch=function(){return void 0===lh&&(lh=new(window.AudioContext||window.webkitAudioContext)),lh};class uh extends ju{constructor(e){super(e)}load(e,t,i,r){const n=this,a=new Gu(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(i){try{const e=i.slice(0);ch().decodeAudioData(e,(function(e){t(e)}))}catch(a){r?r(a):console.error(a),n.manager.itemError(e)}}),i,r)}}(class extends sh{constructor(e,t,i=1){super(void 0,i);const r=(new jn).set(e),n=(new jn).set(t),a=new xr(r.r,r.g,r.b),o=new xr(n.r,n.g,n.b),s=Math.sqrt(Math.PI),l=s*Math.sqrt(.75);this.sh.coefficients[0].copy(a).add(o).multiplyScalar(s),this.sh.coefficients[1].copy(a).sub(o).multiplyScalar(l)}}).prototype.isHemisphereLightProbe=!0;(class extends sh{constructor(e,t=1){super(void 0,t);const i=(new jn).set(e);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}).prototype.isAmbientLightProbe=!0;class hh{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=ph(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=ph();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function ph(){return("undefined"===typeof performance?Date:performance).now()}class dh{constructor(e,t,i){let r,n,a;switch(this.binding=e,this.valueSize=i,t){case"quaternion":r=this._slerp,n=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":r=this._select,n=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:r=this._lerp,n=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=n,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,r=this.valueSize,n=e*r+r;let a=this.cumulativeWeight;if(0===a){for(let e=0;e!==r;++e)i[n+e]=i[e];a=t}else{a+=t;const e=t/a;this._mixBufferRegion(i,n,0,e,r)}this.cumulativeWeight=a}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,r=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,r=e*t+t,n=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,n<1){const e=t*this._origIndex;this._mixBufferRegion(i,r,e,1-n,t)}a>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*t,1,t);for(let s=t,l=t+t;s!==l;++s)if(i[s]!==i[s+t]){o.setValue(i,r);break}}saveOriginalState(){const e=this.binding,t=this.buffer,i=this.valueSize,r=i*this._origIndex;e.getValue(t,r);for(let n=i,a=r;n!==a;++n)t[n]=t[r+n%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,r,n){if(r>=.5)for(let a=0;a!==n;++a)e[t+a]=e[i+a]}_slerp(e,t,i,r){vr.slerpFlat(e,t,e,t,e,i,r)}_slerpAdditive(e,t,i,r,n){const a=this._workIndex*n;vr.multiplyQuaternionsFlat(e,a,e,t,e,i),vr.slerpFlat(e,t,e,t,e,a,r)}_lerp(e,t,i,r,n){const a=1-r;for(let o=0;o!==n;++o){const n=t+o;e[n]=e[n]*a+e[i+o]*r}}_lerpAdditive(e,t,i,r,n){for(let a=0;a!==n;++a){const n=t+a;e[n]=e[n]+e[i+a]*r}}}const fh="\\[\\]\\.:\\/",mh=new RegExp("[\\[\\]\\.:\\/]","g"),gh="[^\\[\\]\\.:\\/]",_h="[^"+fh.replace("\\.","")+"]",yh=/((?:WC+[\/:])*)/.source.replace("WC",gh),vh=/(WCOD+)?/.source.replace("WCOD",_h),xh=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",gh),bh=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",gh),wh=new RegExp("^"+yh+vh+xh+bh+"$"),Sh=["material","materials","bones"];class Mh{constructor(e,t,i){this.path=t,this.parsedPath=i||Mh.parseTrackName(t),this.node=Mh.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new Mh.Composite(e,t,i):new Mh(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(mh,"")}static parseTrackName(e){const t=wh.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const e=i.nodeName.substring(r+1);-1!==Sh.indexOf(e)&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=e)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(void 0!==i)return i}if(e.children){const i=function(e){for(let r=0;r<e.length;r++){const n=e[r];if(n.name===t||n.uuid===t)return n;const a=i(n.children);if(a)return a}return null},r=i(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)e[t++]=i[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,r=t.propertyName;let n=t.propertyIndex;if(e||(e=Mh.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(i){let r=t.objectIndex;switch(i){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===r){r=t;break}break;default:if(void 0===e[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[i]}if(void 0!==r){if(void 0===e[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[r]}}const a=e[r];if(void 0===a){const i=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+r+" but it wasn't found.",e)}let o=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let s=this.BindingType.Direct;if(void 0!==n){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[n]&&(n=e.morphTargetDictionary[n])}s=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=n}else void 0!==a.fromArray&&void 0!==a.toArray?(s=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(s=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=r;this.getValue=this.GetterByBindingType[s],this.setValue=this.SetterByBindingTypeAndVersioning[s][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Mh.Composite=class{constructor(e,t,i){const r=i||Mh.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,r=this._bindings[i];void 0!==r&&r.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,n=i.length;r!==n;++r)i[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}},Mh.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Mh.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Mh.prototype.GetterByBindingType=[Mh.prototype._getValue_direct,Mh.prototype._getValue_array,Mh.prototype._getValue_arrayElement,Mh.prototype._getValue_toArray],Mh.prototype.SetterByBindingTypeAndVersioning=[[Mh.prototype._setValue_direct,Mh.prototype._setValue_direct_setNeedsUpdate,Mh.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Mh.prototype._setValue_array,Mh.prototype._setValue_array_setNeedsUpdate,Mh.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Mh.prototype._setValue_arrayElement,Mh.prototype._setValue_arrayElement_setNeedsUpdate,Mh.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Mh.prototype._setValue_fromArray,Mh.prototype._setValue_fromArray_setNeedsUpdate,Mh.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Th{constructor(e,t,i=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=r;const n=t.tracks,a=n.length,o=new Array(a),s={endingStart:Di,endingEnd:Di};for(let l=0;l!==a;++l){const e=n[l].createInterpolant(null);o[l]=e,e.settings=s}this._interpolantSettings=s,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){const i=this._clip.duration,r=e._clip.duration,n=r/i,a=i/r;e.warp(1,n,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const r=this._mixer,n=r.time,a=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);const s=o.parameterPositions,l=o.sampleValues;return s[0]=n,s[1]=n+i,l[0]=e/a,l[1]=t/a,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,r){if(!this.enabled)return void this._updateWeight(e);const n=this._startTime;if(null!==n){const r=(e-n)*i;if(r<0||0===i)return;this._startTime=null,t=i*r}t*=this._updateTimeScale(e);const a=this._updateTime(t),o=this._updateWeight(e);if(o>0){const e=this._interpolants,t=this._propertyBindings;if(2501===this.blendMode)for(let i=0,r=e.length;i!==r;++i)e[i].evaluate(a),t[i].accumulateAdditive(o);else for(let i=0,n=e.length;i!==n;++i)e[i].evaluate(a),t[i].accumulate(r,o)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(null!==i){const r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;if(null!==i){t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let r=this.time+e,n=this._loopCount;const a=2202===i;if(0===e)return-1===n?r:a&&1===(1&n)?t-r:r;if(2200===i){-1===n&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else{if(!(r<0)){this.time=r;break e}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===n&&(e>=0?(n=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),r>=t||r<0){const i=Math.floor(r/t);r-=t*i,n+=Math.abs(i);const o=this.repetitions-n;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===o){const t=e<0;this._setEndings(t,!t,a)}else this._setEndings(!1,!1,a);this._loopCount=n,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=r;if(a&&1===(1&n))return t-r}return r}_setEndings(e,t,i){const r=this._interpolantSettings;i?(r.endingStart=Bi,r.endingEnd=Bi):(r.endingStart=e?this.zeroSlopeAtStart?Bi:Di:Fi,r.endingEnd=t?this.zeroSlopeAtEnd?Bi:Di:Fi)}_scheduleFading(e,t,i){const r=this._mixer,n=r.time;let a=this._weightInterpolant;null===a&&(a=r._lendControlInterpolant(),this._weightInterpolant=a);const o=a.parameterPositions,s=a.sampleValues;return o[0]=n,s[0]=t,o[1]=n+e,s[1]=i,this}}(class extends Wi{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,r=e._clip.tracks,n=r.length,a=e._propertyBindings,o=e._interpolants,s=i.uuid,l=this._bindingsByRootAndName;let c=l[s];void 0===c&&(c={},l[s]=c);for(let u=0;u!==n;++u){const e=r[u],n=e.name;let l=c[n];if(void 0!==l)a[u]=l;else{if(l=a[u],void 0!==l){null===l._cacheIndex&&(++l.referenceCount,this._addInactiveBinding(l,s,n));continue}const r=t&&t._propertyBindings[u].binding.parsedPath;l=new dh(Mh.create(i,n,r),e.ValueTypeName,e.getValueSize()),++l.referenceCount,this._addInactiveBinding(l,s,n),a[u]=l}o[u].resultBuffer=l.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,i=e._clip.uuid,r=this._actionsByClip[i];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,i,t)}const t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const i=t[e];0===i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const i=t[e];0===--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,i){const r=this._actions,n=this._actionsByClip;let a=n[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,n[t]=a;else{const t=a.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=r.length,r.push(e),a.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],r=e._cacheIndex;i._cacheIndex=r,t[r]=i,t.pop(),e._cacheIndex=null;const n=e._clip.uuid,a=this._actionsByClip,o=a[n],s=o.knownActions,l=s[s.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,s[c]=l,s.pop(),e._byClipCacheIndex=null;delete o.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete a[n],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){const e=t[i];0===--e.referenceCount&&this._removeInactiveBinding(e)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,r=this._nActiveActions++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,r=--this._nActiveActions,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_addInactiveBinding(e,t,i){const r=this._bindingsByRootAndName,n=this._bindings;let a=r[t];void 0===a&&(a={},r[t]=a),a[i]=e,e._cacheIndex=n.length,n.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,r=i.rootNode.uuid,n=i.path,a=this._bindingsByRootAndName,o=a[r],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete o[n],0===Object.keys(o).length&&delete a[r]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return void 0===i&&(i=new Iu(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,n=t[r];e.__cacheIndex=r,t[r]=e,n.__cacheIndex=i,t[i]=n}clipAction(e,t,i){const r=t||this._root,n=r.uuid;let a="string"===typeof e?Nu.findByName(r,e):e;const o=null!==a?a.uuid:e,s=this._actionsByClip[o];let l=null;if(void 0===i&&(i=null!==a?a.blendMode:Oi),void 0!==s){const e=s.actionByRoot[n];if(void 0!==e&&e.blendMode===i)return e;l=s.knownActions[0],null===a&&(a=l._clip)}if(null===a)return null;const c=new Th(this,a,t,i);return this._bindAction(c,l),this._addInactiveAction(c,o,n),c}existingAction(e,t){const i=t||this._root,r=i.uuid,n="string"===typeof e?Nu.findByName(i,e):e,a=n?n.uuid:e,o=this._actionsByClip[a];return void 0!==o&&o.actionByRoot[r]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,r=this.time+=e,n=Math.sign(e),a=this._accuIndex^=1;for(let l=0;l!==i;++l){t[l]._update(r,e,n,a)}const o=this._bindings,s=this._nActiveBindings;for(let l=0;l!==s;++l)o[l].apply(a);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,r=this._actionsByClip,n=r[i];if(void 0!==n){const e=n.knownActions;for(let i=0,r=e.length;i!==r;++i){const r=e[i];this._deactivateAction(r);const n=r._cacheIndex,a=t[t.length-1];r._cacheIndex=null,r._byClipCacheIndex=null,a._cacheIndex=n,t[n]=a,t.pop(),this._removeInactiveBindingsForAction(r)}delete r[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const n in i){const e=i[n].actionByRoot[t];void 0!==e&&(this._deactivateAction(e),this._removeInactiveAction(e))}const r=this._bindingsByRootAndName[t];if(void 0!==r)for(const n in r){const e=r[n];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(e,t){const i=this.existingAction(e,t);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}).prototype._controlInterpolantsResultBuffer=new Float32Array(1);(class extends Rl{constructor(e,t,i=1){super(e,t),this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}).prototype.isInstancedInterleavedBuffer=!0;class Eh{constructor(e,t,i=0,r=1/0){this.ray=new Yr(e,t),this.near=i,this.far=r,this.camera=null,this.layers=new cn,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return Ah(e,this,i,t),i.sort(Ch),i}intersectObjects(e,t=!0,i=[]){for(let r=0,n=e.length;r<n;r++)Ah(e[r],this,i,t);return i.sort(Ch),i}}function Ch(e,t){return e.distance-t.distance}function Ah(e,t,i,r){if(e.layers.test(t.layers)&&e.raycast(t,i),!0===r){const r=e.children;for(let e=0,n=r.length;e<n;e++)Ah(r[e],t,i,!0)}}const Ih=new xr,Ph=new Kr,zh=new Kr;function Rh(e){const t=[];e&&e.isBone&&t.push(e);for(let i=0;i<e.children.length;i++)t.push.apply(t,Rh(e.children[i]));return t}const kh=new Float32Array(1);new Int32Array(kh.buffer),Tc.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Tc.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Gc.prototype.fromPoints=function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)},class extends _c{constructor(e=10,t=10,i=4473924,r=8947848){i=new jn(i),r=new jn(r);const n=t/2,a=e/t,o=e/2,s=[],l=[];for(let u=0,h=0,p=-o;u<=t;u++,p+=a){s.push(-o,0,p,o,0,p),s.push(p,0,-o,p,0,o);const e=u===n?i:r;e.toArray(l,h),h+=3,e.toArray(l,h),h+=3,e.toArray(l,h),h+=3,e.toArray(l,h),h+=3}const c=new na;c.setAttribute("position",new Yn(s,3)),c.setAttribute("color",new Yn(l,3));super(c,new lc({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},class extends _c{constructor(e){const t=Rh(e),i=new na,r=[],n=[],a=new jn(0,0,1),o=new jn(0,1,0);for(let s=0;s<t.length;s++){const e=t[s];e.parent&&e.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),n.push(a.r,a.g,a.b),n.push(o.r,o.g,o.b))}i.setAttribute("position",new Yn(r,3)),i.setAttribute("color",new Yn(n,3));super(i,new lc({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,i=this.geometry,r=i.getAttribute("position");zh.copy(this.root.matrixWorld).invert();for(let n=0,a=0;n<t.length;n++){const e=t[n];e.parent&&e.parent.isBone&&(Ph.multiplyMatrices(zh,e.matrixWorld),Ih.setFromMatrixPosition(Ph),r.setXYZ(a,Ih.x,Ih.y,Ih.z),Ph.multiplyMatrices(zh,e.parent.matrixWorld),Ih.setFromMatrixPosition(Ph),r.setXYZ(a+1,Ih.x,Ih.y,Ih.z),a+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},ju.prototype.extractUrlBase=function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),class{static decodeText(e){if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let r=0,n=e.length;r<n;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch(i){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}static resolveURL(e,t){return"string"!==typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}.extractUrlBase(e)},ju.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Sr.prototype.center=function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Sr.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Sr.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},Sr.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},Sr.prototype.size=function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)},$r.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Ua.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},sr.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},sr.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},sr.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},sr.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},sr.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},sr.prototype.getInverse=function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},Kr.prototype.extractPosition=function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},Kr.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},Kr.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new xr).setFromMatrixColumn(this,3)},Kr.prototype.setRotationFromQuaternion=function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},Kr.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},Kr.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Kr.prototype.multiplyVector4=function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Kr.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},Kr.prototype.rotateAxis=function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},Kr.prototype.crossVector=function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Kr.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},Kr.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},Kr.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},Kr.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},Kr.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},Kr.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Kr.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},Kr.prototype.makeFrustum=function(e,t,i,r,n,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,r,i,n,a)},Kr.prototype.getInverse=function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},Oa.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},vr.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},vr.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},Yr.prototype.isIntersectionBox=function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},Yr.prototype.isIntersectionPlane=function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},Yr.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},Ln.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},Ln.prototype.barycoordFromPoint=function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},Ln.prototype.midpoint=function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},Ln.prototypenormal=function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},Ln.prototype.plane=function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)},Ln.barycoordFromPoint=function(e,t,i,r,n){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Ln.getBarycoord(e,t,i,r,n)},Ln.normal=function(e,t,i,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Ln.getNormal(e,t,i,r)},Hc.prototype.extractAllPoints=function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},Hc.prototype.extrude=function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new bu(this,e)},Hc.prototype.makeGeometry=function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Su(this,e)},or.prototype.fromAttribute=function(e,t,i){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},or.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},or.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},xr.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},xr.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},xr.prototype.getPositionFromMatrix=function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},xr.prototype.getScaleFromMatrix=function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},xr.prototype.getColumnFromMatrix=function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},xr.prototype.applyProjection=function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},xr.prototype.fromAttribute=function(e,t,i){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},xr.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},xr.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},gr.prototype.fromAttribute=function(e,t,i){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},gr.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Sn.prototype.getChildByName=function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},Sn.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},Sn.prototype.translate=function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},Sn.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},Sn.prototype.applyMatrix=function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(Sn.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),wa.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(wa.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),ic.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Pa.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(Xu.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(Wn.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Gi},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Gi)}}}),Wn.prototype.setDynamic=function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?Gi:qi),this},Wn.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Wn.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},na.prototype.addIndex=function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},na.prototype.addAttribute=function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new Wn(arguments[1],arguments[2])))},na.prototype.addDrawCall=function(e,t,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},na.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},na.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},na.prototype.removeAttribute=function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},na.prototype.applyMatrix=function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(na.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Rl.prototype.setDynamic=function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?Gi:qi),this},Rl.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},bu.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},bu.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},bu.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},zl.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},Object.defineProperties(Bn.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new jn}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(Aa.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Pl.prototype.clearTarget=function(e,t,i,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,i,r)},Pl.prototype.animate=function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},Pl.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},Pl.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},Pl.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},Pl.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},Pl.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},Pl.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},Pl.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},Pl.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},Pl.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},Pl.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},Pl.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},Pl.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},Pl.prototype.enableScissorTest=function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},Pl.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},Pl.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},Pl.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},Pl.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},Pl.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},Pl.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},Pl.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},Pl.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},Pl.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},Pl.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(Pl.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?Vi:Ni}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(xl.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(_r.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),class extends Sn{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const t=this;return(new uh).load(e,(function(e){t.setBuffer(e)})),this},Ra.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},Ra.prototype.clear=function(e,t,i,r){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,i,r)},pr.crossOrigin=void 0,pr.loadTexture=function(e,t,i,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const n=new Zu;n.setCrossOrigin(this.crossOrigin);const a=n.load(e,i,void 0,r);return t&&(a.mapping=t),a},pr.loadTextureCube=function(e,t,i,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const n=new Wu;n.setCrossOrigin(this.crossOrigin);const a=n.load(e,i,void 0,r);return t&&(a.mapping=t),a},pr.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},pr.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"134"}})),"undefined"!==typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="134");const Lh=Math.PI/180,Dh=180/Math.PI,Bh=6378137,Fh=6356752.31424518;function Oh(e,t,i,r,n,a){const o=Vh(e,t,i);return function(e,t,i,r,n,a){const o=Vh(r,n,a),s=[e-o[0],t-o[1],i-o[2]];r*=Lh,n*=Lh;const l=Math.cos(r),c=Math.sin(r),u=Math.cos(n),h=Math.sin(n),p=-c*s[0]+l*s[1],d=-h*l*s[0]-h*c*s[1]+u*s[2],f=u*l*s[0]+u*c*s[1]+h*s[2];return[p,d,f]}(o[0],o[1],o[2],r,n,a)}function Nh(e,t,i,r,n,a){const o=function(e,t,i,r,n,a){const o=Vh(r,n,a);r*=Lh,n*=Lh;const s=Math.cos(r),l=Math.sin(r),c=Math.cos(n),u=Math.sin(n),h=-l*e-u*s*t+c*s*i+o[0],p=s*e-u*l*t+c*l*i+o[1],d=c*t+u*i+o[2];return[h,p,d]}(e,t,i,r,n,a);return function(e,t,i){const r=Bh,n=Fh,a=r*r,o=n*n,s=a-o,l=Math.sqrt(s/a),c=Math.sqrt(s/o),u=Math.sqrt(e*e+t*t),h=Math.atan2(i*r,u*n),p=Math.sin(h),d=Math.cos(h),f=Math.atan2(t,e),m=Math.atan2(i+c*c*n*p*p*p,u-l*l*r*d*d*d),g=Math.sin(m),_=Math.cos(m),y=r/Math.sqrt(1-l*l*g*g);return[f*Dh,m*Dh,u/_-y]}(o[0],o[1],o[2])}function Vh(e,t,i){const r=Bh,n=Fh;e*=Lh,t*=Lh;const a=Math.cos(e),o=Math.sin(e),s=Math.cos(t),l=Math.sin(t),c=r*r,u=n*n,h=1/Math.sqrt(c*s*s+u*l*l),p=(c*h+i)*s;return[p*a,p*o,(u*h+i)*l]}class Uh{boundingBoxCorners(e,t){const i=Nh(-t,-t,0,e.lng,e.lat,0),r=Nh(t,t,0,e.lng,e.lat,0);return[{lat:i[1],lng:i[0]},{lat:r[1],lng:r[0]}]}rotationFromCompass(e,t){let i=0,r=0,n=0;switch(t){case 1:i=Math.PI/2;break;case 3:i=-Math.PI/2,n=Math.PI;break;case 6:r=-Math.PI/2,n=-Math.PI/2;break;case 8:r=Math.PI/2,n=Math.PI/2}const a=(new Kr).makeRotationZ(n),o=new ln(i,r,e*Math.PI/180,"XYZ"),s=(new Kr).makeRotationFromEuler(o),l=(new gr).setAxisAngleFromRotationMatrix(s.multiply(a));return l.multiplyScalar(l.w).toArray().slice(0,3)}}class $h{constructor(e){if(!e)throw new Error(`Incorrect core image data ${e}`);this._cache=null,this._core=e,this._spatial=null}get assetsCached(){return null!=this._core&&null!=this._spatial&&null!=this._cache&&null!=this._cache.image&&null!=this._cache.mesh}get cameraParameters(){return this._spatial.camera_parameters}get cameraType(){return this._spatial.camera_type}get capturedAt(){return this._spatial.captured_at}get clusterId(){return this._spatial.cluster?this._spatial.cluster.id:null}get clusterUrl(){return this._spatial.cluster?this._spatial.cluster.url:null}get compassAngle(){return null!=this._spatial.computed_compass_angle?this._spatial.computed_compass_angle:this._spatial.compass_angle}get complete(){return null!=this._spatial}get computedAltitude(){return this._spatial.computed_altitude}get computedCompassAngle(){return this._spatial.computed_compass_angle}get computedLngLat(){return this._core.computed_geometry}get creatorId(){return this._spatial.creator.id}get creatorUsername(){return this._spatial.creator.username}get exifOrientation(){return this._spatial.exif_orientation}get height(){return this._spatial.height}get image(){return this._cache.image}get image$(){return this._cache.image$}get id(){return this._core.id}get lngLat(){return null!=this._core.computed_geometry?this._core.computed_geometry:this._core.geometry}get merged(){return null!=this._spatial&&null!=this._spatial.merge_id}get mergeId(){return this._spatial.merge_id}get mesh(){return this._cache.mesh}get originalAltitude(){return this._spatial.altitude}get originalCompassAngle(){return this._spatial.compass_angle}get originalLngLat(){return this._core.geometry}get ownerId(){return this._spatial.owner?this._spatial.owner.id:null}get private(){return this._spatial.private}get qualityScore(){return this._spatial.quality_score}get rotation(){return this._spatial.computed_rotation}get scale(){return this._spatial.atomic_scale}get sequenceId(){return this._core.sequence?this._core.sequence.id:null}get sequenceEdges(){return this._cache.sequenceEdges}get sequenceEdges$(){return this._cache.sequenceEdges$}get spatialEdges(){return this._cache.spatialEdges}get spatialEdges$(){return this._cache.spatialEdges$}get width(){return this._spatial.width}cacheAssets$(){return this._cache.cacheAssets$(this._spatial,this.merged).pipe(tt((()=>this)))}cacheImage$(){return this._cache.cacheImage$(this._spatial).pipe(tt((()=>this)))}cacheSequenceEdges(e){this._cache.cacheSequenceEdges(e)}cacheSpatialEdges(e){this._cache.cacheSpatialEdges(e)}dispose(){null!=this._cache&&(this._cache.dispose(),this._cache=null),this._core=null,this._spatial=null}initializeCache(e){if(null!=this._cache)throw new Error(`Image cache already initialized (${this.id}).`);this._cache=e}makeComplete(e){if(null==e)throw new Error("Fill can not be null.");this._spatial=e}resetSequenceEdges(){this._cache.resetSequenceEdges()}resetSpatialEdges(){this._cache.resetSpatialEdges()}uncache(){null!=this._cache&&(this._cache.dispose(),this._cache=null)}}class jh{constructor(e){this._disposed=!1,this._provider=e,this._image=null,this._mesh=null,this._sequenceEdges={cached:!1,edges:[]},this._spatialEdges={cached:!1,edges:[]},this._imageChanged$=new he,this._image$=this._imageChanged$.pipe(ai(null),Jt(1),le()),this._iamgeSubscription=this._image$.subscribe(),this._sequenceEdgesChanged$=new he,this._sequenceEdges$=this._sequenceEdgesChanged$.pipe(ai(this._sequenceEdges),Jt(1),le()),this._sequenceEdgesSubscription=this._sequenceEdges$.subscribe((()=>{})),this._spatialEdgesChanged$=new he,this._spatialEdges$=this._spatialEdgesChanged$.pipe(ai(this._spatialEdges),Jt(1),le()),this._spatialEdgesSubscription=this._spatialEdges$.subscribe((()=>{})),this._cachingAssets$=null}get image(){return this._image}get image$(){return this._image$}get mesh(){return this._mesh}get sequenceEdges(){return this._sequenceEdges}get sequenceEdges$(){return this._sequenceEdges$}get spatialEdges(){return this._spatialEdges}get spatialEdges$(){return this._spatialEdges$}cacheAssets$(e,t){return null!=this._cachingAssets$||(this._cachingAssets$=ut(this._cacheImage$(e),this._cacheMesh$(e,t)).pipe(tt((([e,t])=>(this._image=e,this._mesh=t,this))),Gt((()=>{this._cachingAssets$=null})),Jt(1),le()),this._cachingAssets$.pipe(Ht((e=>!!e._image))).subscribe((()=>{this._imageChanged$.next(this._image)}),(()=>{}))),this._cachingAssets$}cacheImage$(e){if(null!=this._image)return Ze(this);const t=this._cacheImage$(e).pipe(Ht((e=>!!e)),ci((e=>{this._disposeImage(),this._image=e})),tt((()=>this)),Jt(1),le());return t.subscribe((()=>{this._imageChanged$.next(this._image)}),(()=>{})),t}cacheSequenceEdges(e){this._sequenceEdges={cached:!0,edges:e},this._sequenceEdgesChanged$.next(this._sequenceEdges)}cacheSpatialEdges(e){this._spatialEdges={cached:!0,edges:e},this._spatialEdgesChanged$.next(this._spatialEdges)}dispose(){this._iamgeSubscription.unsubscribe(),this._sequenceEdgesSubscription.unsubscribe(),this._spatialEdgesSubscription.unsubscribe(),this._disposeImage(),this._mesh=null,this._sequenceEdges={cached:!1,edges:[]},this._spatialEdges={cached:!1,edges:[]},this._imageChanged$.next(null),this._sequenceEdgesChanged$.next(this._sequenceEdges),this._spatialEdgesChanged$.next(this._spatialEdges),this._disposed=!0,null!=this._imageAborter&&(this._imageAborter(),this._imageAborter=null),null!=this._meshAborter&&(this._meshAborter(),this._meshAborter=null)}resetSequenceEdges(){this._sequenceEdges={cached:!1,edges:[]},this._sequenceEdgesChanged$.next(this._sequenceEdges)}resetSpatialEdges(){this._spatialEdges={cached:!1,edges:[]},this._spatialEdgesChanged$.next(this._spatialEdges)}_cacheImage$(e){return re.create((t=>{const i=new Promise(((e,t)=>{this._imageAborter=t})),r=e.thumb.url;if(r)this._provider.getImageBuffer(r,i).then((e=>{this._imageAborter=null;const i=new Image;i.crossOrigin="Anonymous",i.onload=()=>{if(this._disposed){window.URL.revokeObjectURL(i.src);const e=`Image load was aborted (${r})`;t.error(new Error(e))}else t.next(i),t.complete()},i.onerror=()=>{this._imageAborter=null,t.error(new Error(`Failed to load image (${r})`))};const n=new Blob([e]);i.src=window.URL.createObjectURL(n)}),(e=>{this._imageAborter=null,t.error(e)}));else{const i=e.thumb.id,n=`Incorrect thumb URL for ${e.id} (${i}, ${r})`;t.error(new Error(n))}}))}_cacheMesh$(e,t){return re.create((i=>{if(!t)return i.next(this._createEmptyMesh()),void i.complete();const r=e.mesh.url;if(!r){const t=e.mesh.id,n=`Incorrect mesh URL for ${e.id} (${t}, ${r})`;return console.warn(n),i.next(this._createEmptyMesh()),void i.complete()}const n=new Promise(((e,t)=>{this._meshAborter=t}));this._provider.getMesh(r,n).then((e=>{this._meshAborter=null,this._disposed||(i.next(e),i.complete())}),(e=>{this._meshAborter=null,console.error(e),i.next(this._createEmptyMesh()),i.complete()}))}))}_createEmptyMesh(){return{faces:[],vertices:[]}}_disposeImage(){null!=this._image&&window.URL.revokeObjectURL(this._image.src),this._image=null}}class qh{constructor(e){this._id=e.id,this._imageIds=e.image_ids}get id(){return this._id}get imageIds(){return this._imageIds}dispose(){this._id=null,this._imageIds=null}findNext(e){let t=this._imageIds.indexOf(e);return t+1>=this._imageIds.length||-1===t?null:this._imageIds[t+1]}findPrev(e){let t=this._imageIds.indexOf(e);return 0===t||-1===t?null:this._imageIds[t-1]}}class Gh{constructor(){this.sphericalPreferredDistance=2,this.sphericalMotion=2,this.sphericalSequencePenalty=1,this.sphericalMergeCCPenalty=4,this.stepPreferredDistance=4,this.stepMotion=3,this.stepRotation=4,this.stepSequencePenalty=2,this.stepMergeCCPenalty=6,this.similarDistance=2,this.similarRotation=3,this.turnDistance=4,this.turnMotion=2,this.turnSequencePenalty=1,this.turnMergeCCPenalty=4}}var Hh;!function(e){e[e.Next=0]="Next",e[e.Prev=1]="Prev",e[e.StepLeft=2]="StepLeft",e[e.StepRight=3]="StepRight",e[e.StepForward=4]="StepForward",e[e.StepBackward=5]="StepBackward",e[e.TurnLeft=6]="TurnLeft",e[e.TurnRight=7]="TurnRight",e[e.TurnU=8]="TurnU",e[e.Spherical=9]="Spherical",e[e.Similar=10]="Similar"}(Hh||(Hh={}));class Wh{constructor(){this.steps={},this.turns={},this.spherical={},this.steps[Hh.StepForward]={direction:Hh.StepForward,motionChange:0,useFallback:!0},this.steps[Hh.StepBackward]={direction:Hh.StepBackward,motionChange:Math.PI,useFallback:!0},this.steps[Hh.StepLeft]={direction:Hh.StepLeft,motionChange:Math.PI/2,useFallback:!1},this.steps[Hh.StepRight]={direction:Hh.StepRight,motionChange:-Math.PI/2,useFallback:!1},this.turns[Hh.TurnLeft]={direction:Hh.TurnLeft,directionChange:Math.PI/2,motionChange:Math.PI/4},this.turns[Hh.TurnRight]={direction:Hh.TurnRight,directionChange:-Math.PI/2,motionChange:-Math.PI/4},this.turns[Hh.TurnU]={direction:Hh.TurnU,directionChange:Math.PI,motionChange:null},this.spherical[Hh.StepForward]={direction:Hh.StepForward,directionChange:0,next:Hh.StepLeft,prev:Hh.StepRight},this.spherical[Hh.StepBackward]={direction:Hh.StepBackward,directionChange:Math.PI,next:Hh.StepRight,prev:Hh.StepLeft},this.spherical[Hh.StepLeft]={direction:Hh.StepLeft,directionChange:Math.PI/2,next:Hh.StepBackward,prev:Hh.StepForward},this.spherical[Hh.StepRight]={direction:Hh.StepRight,directionChange:-Math.PI/2,next:Hh.StepForward,prev:Hh.StepBackward}}}class Zh{constructor(){this.sphericalMinDistance=.1,this.sphericalMaxDistance=20,this.sphericalPreferredDistance=5,this.sphericalMaxItems=4,this.sphericalMaxStepTurnChange=Math.PI/8,this.rotationMaxDistance=this.turnMaxRigDistance,this.rotationMaxDirectionChange=Math.PI/6,this.rotationMaxVerticalDirectionChange=Math.PI/8,this.similarMaxDirectionChange=Math.PI/8,this.similarMaxDistance=12,this.similarMinTimeDifference=432e5,this.stepMaxDistance=20,this.stepMaxDirectionChange=Math.PI/6,this.stepMaxDrift=Math.PI/6,this.stepPreferredDistance=4,this.turnMaxDistance=15,this.turnMaxDirectionChange=2*Math.PI/9,this.turnMaxRigDistance=.65,this.turnMinRigDirectionChange=Math.PI/6}get maxDistance(){return Math.max(this.sphericalMaxDistance,this.similarMaxDistance,this.stepMaxDistance,this.turnMaxDistance)}}class Xh extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Xh.prototype),this.name="MapillaryError"}}class Yh extends Xh{constructor(e){super(null!=e?e:"The argument is not valid."),Object.setPrototypeOf(this,Yh.prototype),this.name="ArgumentMapillaryError"}}class Kh{constructor(){this._epsilon=1e-9}azimuthalToBearing(e){return-e+Math.PI/2}degToRad(e){return Math.PI*e/180}radToDeg(e){return 180*e/Math.PI}rotationMatrix(e){let t=new xr(e[0],e[1],e[2]),i=t.length();return i>0&&t.normalize(),(new Kr).makeRotationAxis(t,i)}rotate(e,t){let i=new xr(e[0],e[1],e[2]),r=this.rotationMatrix(t);return i.applyMatrix4(r),i}opticalCenter(e,t){let i=[-e[0],-e[1],-e[2]],r=[-t[0],-t[1],-t[2]];return this.rotate(r,i)}viewingDirection(e){let t=[-e[0],-e[1],-e[2]];return this.rotate([0,0,1],t)}wrap(e,t,i){if(i<t)throw new Error("Invalid arguments: max must be larger than min.");let r=i-t;for(;e>i||e<t;)e>i?e-=r:e<t&&(e+=r);return e}wrapAngle(e){return this.wrap(e,-Math.PI,Math.PI)}clamp(e,t,i){return e<t?t:e>i?i:e}angleBetweenVector2(e,t,i,r){let n=Math.atan2(r,i)-Math.atan2(t,e);return this.wrapAngle(n)}angleDifference(e,t){let i=t-e;return this.wrapAngle(i)}relativeRotationAngle(e,t){let i=this.rotationMatrix([-e[0],-e[1],-e[2]]),r=this.rotationMatrix(t),n=i.multiply(r).elements,a=n[0]+n[5]+n[10];return Math.acos(Math.max(Math.min((a-1)/2,1),-1))}angleToPlane(e,t){let i=(new xr).fromArray(e),r=i.length();if(r<this._epsilon)return 0;let n=i.dot((new xr).fromArray(t));return Math.asin(n/r)}azimuthal(e,t){const i=(new xr).fromArray(e),r=(new xr).fromArray(t),n=i.clone().dot(r),a=i.clone().sub(r.clone().multiplyScalar(n));return Math.atan2(a.y,a.x)}distanceFromLngLat(e,t,i,r){let n=this.degToRad(r-t),a=this.degToRad(i-e),o=Math.sin(n/2)*Math.sin(n/2)+Math.cos(this.degToRad(t))*Math.cos(this.degToRad(r))*Math.sin(a/2)*Math.sin(a/2);return 12742e3*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))}}const Jh=new Kh;function Qh(e){return"spherical"===e}function ep(e){return"fisheye"===e}function tp(e,t,i){const r=Oh(e.lng,e.lat,e.alt,i.lng,i.lat,i.alt),n=Jh.rotate(r,t);return[-n.x,-n.y,-n.z]}function ip(e,t,i,r,n){const a=[];for(let s=0;s<t.length;++s){const e=t[s],n=i[s];for(let t=0;t<=r;++t)a.push([e[0]+n[0]*t/r,e[1]+n[1]*t/r])}const o=new Ia;o.up.copy(e.upVector()),o.position.copy((new xr).fromArray(e.unprojectSfM([0,0],0))),o.lookAt((new xr).fromArray(e.unprojectSfM([0,0],10))),o.updateMatrix(),o.updateMatrixWorld(!0);return a.map((t=>{const i=e.unprojectBasic(t,1e4),r=n.worldToCamera(i,o);return[Math.abs(r[0]/r[2]),Math.abs(r[1]/r[2])]}))}class rp{constructor(e,t,i){this._spatial=new Kh,this._settings=null!=e?e:new Zh,this._directions=null!=t?t:new Wh,this._coefficients=null!=i?i:new Gh}getPotentialEdges(e,t,i){if(!e.complete)throw new Yh("Image has to be full.");if(!e.merged)return[];let r=this._spatial.viewingDirection(e.rotation),n=this._spatial.angleToPlane(r.toArray(),[0,0,1]),a=[];for(let o of t){if(!o.merged||o.id===e.id)continue;let t=Oh(o.lngLat.lng,o.lngLat.lat,o.computedAltitude,e.lngLat.lng,e.lngLat.lat,e.computedAltitude),s=new xr(t[0],t[1],t[2]),l=s.length();if(l>this._settings.maxDistance&&i.indexOf(o.id)<0)continue;let c=this._spatial.angleBetweenVector2(r.x,r.y,s.x,s.y),u=this._spatial.angleToPlane(s.toArray(),[0,0,1]),h=this._spatial.viewingDirection(o.rotation),p=this._spatial.angleBetweenVector2(r.x,r.y,h.x,h.y),d=this._spatial.angleToPlane(h.toArray(),[0,0,1])-n,f=this._spatial.relativeRotationAngle(e.rotation,o.rotation),m=this._spatial.angleBetweenVector2(1,0,s.x,s.y),g=null!=o.sequenceId&&null!=e.sequenceId&&o.sequenceId===e.sequenceId,_=o.mergeId===e.mergeId,y=o.creatorId===e.creatorId,v={capturedAt:o.capturedAt,directionChange:p,distance:l,spherical:Qh(o.cameraType),id:o.id,motionChange:c,rotation:f,sameMergeCC:_,sameSequence:g,sameUser:y,sequenceId:o.sequenceId,verticalDirectionChange:d,verticalMotion:u,worldMotionAzimuth:m};a.push(v)}return a}computeSequenceEdges(e,t){if(!e.complete)throw new Yh("Image has to be full.");if(e.sequenceId!==t.id)throw new Yh("Image and sequence does not correspond.");let i=[],r=t.findNext(e.id);null!=r&&i.push({data:{direction:Hh.Next,worldMotionAzimuth:Number.NaN},source:e.id,target:r});let n=t.findPrev(e.id);return null!=n&&i.push({data:{direction:Hh.Prev,worldMotionAzimuth:Number.NaN},source:e.id,target:n}),i}computeSimilarEdges(e,t){if(!e.complete)throw new Yh("Image has to be full.");let i=Qh(e.cameraType),r={};for(let o of t)if(null!=o.sequenceId&&!o.sameSequence){if(i){if(!o.spherical)continue}else if(!o.spherical&&Math.abs(o.directionChange)>this._settings.similarMaxDirectionChange)continue;o.distance>this._settings.similarMaxDistance||o.sameUser&&Math.abs(o.capturedAt-e.capturedAt)<this._settings.similarMinTimeDifference||(null==r[o.sequenceId]&&(r[o.sequenceId]=[]),r[o.sequenceId].push(o))}let n=[],a=Qh(e.cameraType)?e=>e.distance:e=>this._coefficients.similarDistance*e.distance+this._coefficients.similarRotation*e.rotation;for(let o in r){if(!r.hasOwnProperty(o))continue;let e=Number.MAX_VALUE,t=null;for(let i of r[o]){let r=a(i);r<e&&(e=r,t=i)}null!=t&&n.push(t)}return n.map((t=>({data:{direction:Hh.Similar,worldMotionAzimuth:t.worldMotionAzimuth},source:e.id,target:t.id})))}computeStepEdges(e,t,i,r){if(!e.complete)throw new Yh("Image has to be full.");let n=[];if(Qh(e.cameraType))return n;for(let a in this._directions.steps){if(!this._directions.steps.hasOwnProperty(a))continue;let o=this._directions.steps[a],s=Number.MAX_VALUE,l=null,c=null;for(let e of t){if(e.spherical)continue;if(Math.abs(e.directionChange)>this._settings.stepMaxDirectionChange)continue;let t=this._spatial.angleDifference(o.motionChange,e.motionChange),n=this._spatial.angleDifference(e.directionChange,t),a=Math.max(Math.abs(t),Math.abs(n));if(Math.abs(a)>this._settings.stepMaxDrift)continue;let u=e.id;if(!o.useFallback||u!==i&&u!==r||(c=e),e.distance>this._settings.stepMaxDistance)continue;t=Math.sqrt(t*t+e.verticalMotion*e.verticalMotion);let h=this._coefficients.stepPreferredDistance*Math.abs(e.distance-this._settings.stepPreferredDistance)/this._settings.stepMaxDistance+this._coefficients.stepMotion*t/this._settings.stepMaxDrift+this._coefficients.stepRotation*e.rotation/this._settings.stepMaxDirectionChange+this._coefficients.stepSequencePenalty*(e.sameSequence?0:1)+this._coefficients.stepMergeCCPenalty*(e.sameMergeCC?0:1);h<s&&(s=h,l=e)}l=null==l?c:l,null!=l&&n.push({data:{direction:o.direction,worldMotionAzimuth:l.worldMotionAzimuth},source:e.id,target:l.id})}return n}computeTurnEdges(e,t){if(!e.complete)throw new Yh("Image has to be full.");let i=[];if(Qh(e.cameraType))return i;for(let r in this._directions.turns){if(!this._directions.turns.hasOwnProperty(r))continue;let n=this._directions.turns[r],a=Number.MAX_VALUE,o=null;for(let e of t){if(e.spherical)continue;if(e.distance>this._settings.turnMaxDistance)continue;let t,i=n.direction!==Hh.TurnU&&e.distance<this._settings.turnMaxRigDistance&&Math.abs(e.directionChange)>this._settings.turnMinRigDirectionChange,r=this._spatial.angleDifference(n.directionChange,e.directionChange);if(i&&e.directionChange*n.directionChange>0&&Math.abs(e.directionChange)<Math.abs(n.directionChange))t=-Math.PI/2+Math.abs(e.directionChange);else{if(Math.abs(r)>this._settings.turnMaxDirectionChange)continue;let i=n.motionChange?this._spatial.angleDifference(n.motionChange,e.motionChange):0;i=Math.sqrt(i*i+e.verticalMotion*e.verticalMotion),t=this._coefficients.turnDistance*e.distance/this._settings.turnMaxDistance+this._coefficients.turnMotion*i/Math.PI+this._coefficients.turnSequencePenalty*(e.sameSequence?0:1)+this._coefficients.turnMergeCCPenalty*(e.sameMergeCC?0:1)}t<a&&(a=t,o=e)}null!=o&&i.push({data:{direction:n.direction,worldMotionAzimuth:o.worldMotionAzimuth},source:e.id,target:o.id})}return i}computePerspectiveToSphericalEdges(e,t){if(!e.complete)throw new Yh("Image has to be full.");if(Qh(e.cameraType))return[];let i=Number.MAX_VALUE,r=null;for(let n of t){if(!n.spherical)continue;let e=this._coefficients.sphericalPreferredDistance*Math.abs(n.distance-this._settings.sphericalPreferredDistance)/this._settings.sphericalMaxDistance+this._coefficients.sphericalMotion*Math.abs(n.motionChange)/Math.PI+this._coefficients.sphericalMergeCCPenalty*(n.sameMergeCC?0:1);e<i&&(i=e,r=n)}return null==r?[]:[{data:{direction:Hh.Spherical,worldMotionAzimuth:r.worldMotionAzimuth},source:e.id,target:r.id}]}computeSphericalEdges(e,t){if(!e.complete)throw new Yh("Image has to be full.");if(!Qh(e.cameraType))return[];let i=[],r=[],n=[];for(let c of t)if(!(c.distance>this._settings.sphericalMaxDistance))if(c.spherical){if(c.distance<this._settings.sphericalMinDistance)continue;r.push(c)}else for(let e in this._directions.spherical){if(!this._directions.spherical.hasOwnProperty(e))continue;let t=this._directions.spherical[e],i=this._spatial.angleDifference(c.directionChange,c.motionChange),r=this._spatial.angleDifference(t.directionChange,i);if(!(Math.abs(r)>this._settings.sphericalMaxStepTurnChange)){n.push([t.direction,c]);break}}let a=Math.PI/this._settings.sphericalMaxItems,o=[],s=[];for(let c=0;c<this._settings.sphericalMaxItems;c++){let t=c/this._settings.sphericalMaxItems*2*Math.PI,n=Number.MAX_VALUE,l=null;for(let e of r){let i=this._spatial.angleDifference(t,e.motionChange);if(Math.abs(i)>a)continue;let r=Number.MAX_VALUE;for(let t of o){let i=Math.abs(this._spatial.angleDifference(t,e.motionChange));i<r&&(r=i)}if(r<=a)continue;let s=this._coefficients.sphericalPreferredDistance*Math.abs(e.distance-this._settings.sphericalPreferredDistance)/this._settings.sphericalMaxDistance+this._coefficients.sphericalMotion*Math.abs(i)/a+this._coefficients.sphericalSequencePenalty*(e.sameSequence?0:1)+this._coefficients.sphericalMergeCCPenalty*(e.sameMergeCC?0:1);s<n&&(n=s,l=e)}null!=l?(o.push(l.motionChange),i.push({data:{direction:Hh.Spherical,worldMotionAzimuth:l.worldMotionAzimuth},source:e.id,target:l.id})):s.push(t)}let l={};l[Hh.Spherical]=o,l[Hh.StepForward]=[],l[Hh.StepLeft]=[],l[Hh.StepBackward]=[],l[Hh.StepRight]=[];for(let c of s){let t=[];for(let r in this._directions.spherical){if(!this._directions.spherical.hasOwnProperty(r))continue;let o=this._directions.spherical[r],s=l[Hh.Spherical].concat(l[o.direction]).concat(l[o.prev]).concat(l[o.next]),u=Number.MAX_VALUE,h=null;for(let e of n){if(e[0]!==o.direction)continue;let t=this._spatial.angleDifference(c,e[1].motionChange);if(Math.abs(t)>a)continue;let i=Number.MAX_VALUE;for(let n of s){let t=Math.abs(this._spatial.angleDifference(n,e[1].motionChange));t<i&&(i=t)}if(i<=a)continue;let r=this._coefficients.sphericalPreferredDistance*Math.abs(e[1].distance-this._settings.sphericalPreferredDistance)/this._settings.sphericalMaxDistance+this._coefficients.sphericalMotion*Math.abs(t)/a+this._coefficients.sphericalMergeCCPenalty*(e[1].sameMergeCC?0:1);r<u&&(u=r,h=e)}null!=h&&(t.push(h),i.push({data:{direction:h[0],worldMotionAzimuth:h[1].worldMotionAzimuth},source:e.id,target:h[1].id}))}for(let e of t)l[e[0]].push(e[1].motionChange)}return i}}class np extends Xh{constructor(e){super(e),Object.setPrototypeOf(this,np.prototype),this.name="GraphMapillaryError"}}class ap{constructor(e,t,i,r,n,a){this._api=e,this._cachedNodes={},this._cachedNodeTiles={},this._cachedSequenceNodes={},this._cachedSpatialEdges={},this._cachedTiles={},this._cachingFill$={},this._cachingFull$={},this._cachingSequenceNodes$={},this._cachingSequences$={},this._cachingSpatialArea$={},this._cachingTiles$={},this._changed$=new he,this._filterCreator=null!==n&&void 0!==n?n:new hi,this._filter=this._filterCreator.createFilter(void 0),this._filterSubject$=new he,this._filter$=_t(Ze(this._filter),this._filterSubject$).pipe(Jt(1),le()),this._filterSubscription=this._filter$.subscribe((()=>{})),this._defaultAlt=2,this._edgeCalculator=null!==r&&void 0!==r?r:new rp,this._graphCalculator=null!==i&&void 0!==i?i:new Uh,this._configuration=null!==a&&void 0!==a?a:{maxSequences:50,maxUnusedImages:100,maxUnusedPreStoredImages:30,maxUnusedTiles:20},this._nodes={},this._nodeIndex=null!==t&&void 0!==t?t:new ap._spatialIndex(16),this._nodeIndexTiles={},this._nodeToTile={},this._preStored={},this._requiredNodeTiles={},this._requiredSpatialArea={},this._sequences={},this._tileThreshold=20}static register(e){ap._spatialIndex=e}get api(){return this._api}get changed$(){return this._changed$}get filter$(){return this._filter$}cacheBoundingBox$(e,t){const i=this._api.data.geometry.bboxToCellIds(e,t).filter((e=>!(e in this._cachedTiles))).map((e=>e in this._cachingTiles$?this._cachingTiles$[e]:this._cacheTile$(e)));return 0===i.length&&i.push(Ze(this)),Oe(i).pipe(mt(),Zt(),ft((()=>{const i=this._nodeIndex.search({maxX:t.lng,maxY:t.lat,minX:e.lng,minY:e.lat}).map((e=>e.node)),r=[],n=[];for(const e of i)e.complete?r.push(e):n.push(e.id);const a=[];for(;n.length>0;)a.push(n.splice(0,200));return Mt(Ze(r),Oe(a.map((e=>this._api.getSpatialImages$(e).pipe(tt((e=>{const t=[];for(const i of e){if(!this.hasNode(i.node_id))continue;const e=this.getNode(i.node_id);e.complete||this._makeFull(e,i.node),t.push(e)}return t})))))).pipe(mt()))})),kt(((e,t)=>e.concat(t))))}cacheCell$(e){return(e in this._cachedTiles?Ze(this):e in this._cachingTiles$?this._cachingTiles$[e]:this._cacheTile$(e)).pipe(ft((()=>{const t=this._cachedTiles[e];t.accessed=(new Date).getTime();const i=t.nodes,r=[],n=[];for(const e of i)e.complete?r.push(e):n.push(e.id);const a=[];for(;n.length>0;)a.push(n.splice(0,200));return Mt(Ze(r),Oe(a.map((e=>this._api.getSpatialImages$(e).pipe(tt((e=>{const t=[];for(const i of e){if(!i.node){console.warn(`Image is empty (${i.node})`);continue}const e=i.node_id;if(!this.hasNode(e))continue;const r=this.getNode(e);r.complete||this._makeFull(r,i.node),t.push(r)}return t})))))).pipe(mt()))})),kt(((e,t)=>e.concat(t))))}cacheFill$(e){if(e in this._cachingFull$)throw new np(`Cannot fill node while caching full (${e}).`);if(!this.hasNode(e))throw new np(`Cannot fill node that does not exist in graph (${e}).`);if(e in this._cachingFill$)return this._cachingFill$[e];const t=this.getNode(e);if(t.complete)throw new np(`Cannot fill node that is already full (${e}).`);return this._cachingFill$[e]=this._api.getSpatialImages$([e]).pipe(ci((e=>{for(const i of e)i.node||console.warn(`Image is empty ${i.node_id}`),t.complete||this._makeFull(t,i.node),delete this._cachingFill$[i.node_id]})),tt((()=>this)),Gt((()=>{e in this._cachingFill$&&delete this._cachingFill$[e],this._changed$.next(this)})),Kt(),le()),this._cachingFill$[e]}cacheFull$(e){if(e in this._cachingFull$)return this._cachingFull$[e];if(this.hasNode(e))throw new np(`Cannot cache full node that already exist in graph (${e}).`);return this._cachingFull$[e]=this._api.getImages$([e]).pipe(ci((t=>{for(const i of t){if(!i.node)throw new np(`Image does not exist (${e}, ${i.node}).`);const t=i.node_id;if(this.hasNode(t)){const t=this.getNode(e);t.complete||this._makeFull(t,i.node)}else{if(null==i.node.sequence.id)throw new np(`Image has no sequence key (${e}).`);const r=new $h(i.node);this._makeFull(r,i.node);const n=this._api.data.geometry.lngLatToCellId(r.originalLngLat);this._preStore(n,r),this._setNode(r),delete this._cachingFull$[t]}}})),tt((()=>this)),Gt((()=>{e in this._cachingFull$&&delete this._cachingFull$[e],this._changed$.next(this)})),Kt(),le()),this._cachingFull$[e]}cacheNodeSequence$(e){if(!this.hasNode(e))throw new np(`Cannot cache sequence edges of node that does not exist in graph (${e}).`);let t=this.getNode(e);if(t.sequenceId in this._sequences)throw new np(`Sequence already cached (${e}), (${t.sequenceId}).`);return this._cacheSequence$(t.sequenceId)}cacheSequence$(e){if(e in this._sequences)throw new np(`Sequence already cached (${e})`);return this._cacheSequence$(e)}cacheSequenceEdges(e){let t=this.getNode(e);if(!(t.sequenceId in this._sequences))throw new np(`Sequence is not cached (${e}), (${t.sequenceId})`);let i=this._sequences[t.sequenceId].sequence,r=this._edgeCalculator.computeSequenceEdges(t,i);t.cacheSequenceEdges(r)}cacheSequenceNodes$(e,t){if(!this.hasSequence(e))throw new np(`Cannot cache sequence nodes of sequence that does not exist in graph (${e}).`);if(this.hasSequenceNodes(e))throw new np(`Sequence nodes already cached (${e}).`);const i=this.getSequence(e);if(i.id in this._cachingSequenceNodes$)return this._cachingSequenceNodes$[i.id];const r=[],n=i.imageIds.slice();if(t&&n.length>50){const e=n.indexOf(t),i=Math.max(0,Math.min(e-25,n.length-50));r.push(n.splice(i,50))}for(;n.length>0;)r.push(n.splice(0,200));let a=r.length;const o=Oe(r).pipe(ft((e=>this._api.getImages$(e).pipe(ci((e=>{for(const t of e){if(!t.node){console.warn(`Image empty (${t.node_id})`);continue}const e=t.node_id;if(this.hasNode(e)){const i=this.getNode(e);i.complete||this._makeFull(i,t.node)}else{null==t.node.sequence.id&&console.warn(`Sequence missing, discarding node (${t.node_id})`);const e=new $h(t.node);this._makeFull(e,t.node);const i=this._api.data.geometry.lngLatToCellId(e.originalLngLat);this._preStore(i,e),this._setNode(e)}}a--})),tt((()=>this)))),6),Zt(),Gt((()=>{delete this._cachingSequenceNodes$[i.id],0===a&&(this._cachedSequenceNodes[i.id]=!0)})),Kt(),le());return this._cachingSequenceNodes$[i.id]=o,o}cacheSpatialArea$(e){if(!this.hasNode(e))throw new np(`Cannot cache spatial area of node that does not exist in graph (${e}).`);if(e in this._cachedSpatialEdges)throw new np(`Image already spatially cached (${e}).`);if(!(e in this._requiredSpatialArea))throw new np(`Spatial area not determined (${e}).`);let t=this._requiredSpatialArea[e];if(0===Object.keys(t.cacheNodes).length)throw new np(`Spatial nodes already cached (${e}).`);if(e in this._cachingSpatialArea$)return this._cachingSpatialArea$[e];let i=[];for(;t.cacheKeys.length>0;)i.push(t.cacheKeys.splice(0,200));let r=i.length,n=[];for(let a of i){let i=this._api.getSpatialImages$(a).pipe(ci((i=>{for(const e of i){if(!e.node){console.warn(`Image is empty (${e.node_id})`);continue}const i=e.node_id,r=t.cacheNodes[i];r.complete?delete t.cacheNodes[i]:(this._makeFull(r,e.node),delete t.cacheNodes[i])}0===--r&&delete this._cachingSpatialArea$[e]})),tt((()=>this)),zt((i=>{for(let e of a)e in t.all&&delete t.all[e],e in t.cacheNodes&&delete t.cacheNodes[e];throw 0===--r&&delete this._cachingSpatialArea$[e],i})),Gt((()=>{0===Object.keys(t.cacheNodes).length&&this._changed$.next(this)})),Kt(),le());n.push(i)}return this._cachingSpatialArea$[e]=n,n}cacheSpatialEdges(e){if(e in this._cachedSpatialEdges)throw new np(`Spatial edges already cached (${e}).`);let t=this.getNode(e),i=this._sequences[t.sequenceId].sequence,r=[],n=i.findPrev(t.id);null!=n&&r.push(n);let a=i.findNext(t.id);null!=a&&r.push(a);let o=this._requiredSpatialArea[e].all,s=[],l=this._filter;for(let h in o){if(!o.hasOwnProperty(h))continue;let e=o[h];l(e)&&s.push(e)}let c=this._edgeCalculator.getPotentialEdges(t,s,r),u=this._edgeCalculator.computeStepEdges(t,c,n,a);u=u.concat(this._edgeCalculator.computeTurnEdges(t,c)),u=u.concat(this._edgeCalculator.computeSphericalEdges(t,c)),u=u.concat(this._edgeCalculator.computePerspectiveToSphericalEdges(t,c)),u=u.concat(this._edgeCalculator.computeSimilarEdges(t,c)),t.cacheSpatialEdges(u),this._cachedSpatialEdges[e]=t,delete this._requiredSpatialArea[e],delete this._cachedNodeTiles[e]}cacheTiles$(e){if(e in this._cachedNodeTiles)throw new np(`Tiles already cached (${e}).`);if(e in this._cachedSpatialEdges)throw new np(`Spatial edges already cached so tiles considered cached (${e}).`);if(!(e in this._requiredNodeTiles))throw new np(`Tiles have not been determined (${e}).`);let t=this._requiredNodeTiles[e];if(0===t.cache.length&&0===t.caching.length)throw new np(`Tiles already cached (${e}).`);if(!this.hasNode(e))throw new np(`Cannot cache tiles of node that does not exist in graph (${e}).`);let i=t.cache.slice();t.caching=this._requiredNodeTiles[e].caching.concat(i),t.cache=[];let r=[];for(let n of t.caching){const i=n in this._cachingTiles$?this._cachingTiles$[n]:this._cacheTile$(n);r.push(i.pipe(ci((i=>{let r=t.caching.indexOf(n);r>-1&&t.caching.splice(r,1),0===t.caching.length&&0===t.cache.length&&(delete this._requiredNodeTiles[e],this._cachedNodeTiles[e]=!0)})),zt((i=>{let r=t.caching.indexOf(n);throw r>-1&&t.caching.splice(r,1),0===t.caching.length&&0===t.cache.length&&(delete this._requiredNodeTiles[e],this._cachedNodeTiles[e]=!0),i})),Gt((()=>{this._changed$.next(this)})),Kt(),le()))}return r}initializeCache(e){if(e in this._cachedNodes)throw new np(`Image already in cache (${e}).`);const t=this.getNode(e),i=this._api.data;t.initializeCache(new jh(i));const r=(new Date).getTime();this._cachedNodes[e]={accessed:r,node:t},this._updateCachedTileAccess(e,r)}isCachingFill(e){return e in this._cachingFill$}isCachingFull(e){return e in this._cachingFull$}isCachingNodeSequence(e){return this.getNode(e).sequenceId in this._cachingSequences$}isCachingSequence(e){return e in this._cachingSequences$}isCachingSequenceNodes(e){return e in this._cachingSequenceNodes$}isCachingTiles(e){return e in this._requiredNodeTiles&&0===this._requiredNodeTiles[e].cache.length&&this._requiredNodeTiles[e].caching.length>0}hasInitializedCache(e){return e in this._cachedNodes}hasNode(e){let t=(new Date).getTime();return this._updateCachedNodeAccess(e,t),this._updateCachedTileAccess(e,t),e in this._nodes}hasNodeSequence(e){let t=this.getNode(e).sequenceId,i=t in this._sequences;return i&&(this._sequences[t].accessed=(new Date).getTime()),i}hasSequence(e){let t=e in this._sequences;return t&&(this._sequences[e].accessed=(new Date).getTime()),t}hasSequenceNodes(e){return e in this._cachedSequenceNodes}hasSpatialArea(e){if(!this.hasNode(e))throw new np(`Spatial area nodes cannot be determined if node not in graph (${e}).`);if(e in this._cachedSpatialEdges)return!0;if(e in this._requiredSpatialArea)return 0===Object.keys(this._requiredSpatialArea[e].cacheNodes).length;let t=this.getNode(e),i=this._graphCalculator.boundingBoxCorners(t.lngLat,this._tileThreshold),r=this._nodeIndex.search({maxX:i[1].lng,maxY:i[1].lat,minX:i[0].lng,minY:i[0].lat}),n={all:{},cacheKeys:[],cacheNodes:{}};for(let a of r)n.all[a.node.id]=a.node,a.node.complete||(n.cacheKeys.push(a.node.id),n.cacheNodes[a.node.id]=a.node);return this._requiredSpatialArea[e]=n,0===n.cacheKeys.length}hasTiles(e){if(e in this._cachedNodeTiles)return!0;if(e in this._cachedSpatialEdges)return!0;if(!this.hasNode(e))throw new np(`Image does not exist in graph (${e}).`);let t={cache:[],caching:[]};if(e in this._requiredNodeTiles)t=this._requiredNodeTiles[e];else{const i=this.getNode(e),[r,n]=this._graphCalculator.boundingBoxCorners(i.lngLat,this._tileThreshold);t.cache=this._api.data.geometry.bboxToCellIds(r,n).filter((e=>!(e in this._cachedTiles))),t.cache.length>0&&(this._requiredNodeTiles[e]=t)}return 0===t.cache.length&&0===t.caching.length}getNode(e){let t=(new Date).getTime();return this._updateCachedNodeAccess(e,t),this._updateCachedTileAccess(e,t),this._nodes[e]}getSequence(e){let t=this._sequences[e];return t.accessed=(new Date).getTime(),t.sequence}resetSpatialEdges(){let e=Object.keys(this._cachedSpatialEdges);for(let t of e){this._cachedSpatialEdges[t].resetSpatialEdges(),delete this._cachedSpatialEdges[t]}}reset(e){const t=[];for(const i of e){if(!this.hasNode(i))throw new Error(`Image does not exist ${i}`);const e=this.getNode(i);e.resetSequenceEdges(),e.resetSpatialEdges(),t.push(e)}for(let i of Object.keys(this._cachedNodes))-1===e.indexOf(i)&&(this._cachedNodes[i].node.dispose(),delete this._cachedNodes[i]);this._cachedNodeTiles={},this._cachedSpatialEdges={},this._cachedTiles={},this._cachingFill$={},this._cachingFull$={},this._cachingSequences$={},this._cachingSpatialArea$={},this._cachingTiles$={},this._nodes={},this._nodeToTile={},this._preStored={};for(const i of t){this._nodes[i.id]=i;const e=this._api.data.geometry.lngLatToCellId(i.originalLngLat);this._preStore(e,i)}this._requiredNodeTiles={},this._requiredSpatialArea={},this._sequences={},this._nodeIndexTiles={},this._nodeIndex.clear()}setFilter(e){this._filter=this._filterCreator.createFilter(e),this._filterSubject$.next(this._filter)}uncache(e,t,i){const r={};this._addNewKeys(r,this._cachingFull$),this._addNewKeys(r,this._cachingFill$),this._addNewKeys(r,this._cachingSpatialArea$),this._addNewKeys(r,this._requiredNodeTiles),this._addNewKeys(r,this._requiredSpatialArea);for(const _ of e)_ in r||(r[_]=!0);const n=this._tileThreshold,a=this._graphCalculator,o=this._api.data.geometry,s=new Set(t);for(let _ in r){if(!r.hasOwnProperty(_))continue;const e=this._nodes[_],[t,i]=a.boundingBoxCorners(e.lngLat,n),l=o.bboxToCellIds(t,i);for(const r of l)s.has(r)||s.add(r)}const l=[];for(let _ in this._cachedTiles)this._cachedTiles.hasOwnProperty(_)&&!s.has(_)&&l.push([_,this._cachedTiles[_]]);const c=l.sort(((e,t)=>t[1].accessed-e[1].accessed)).slice(this._configuration.maxUnusedTiles).map((e=>e[0]));for(let _ of c)this._uncacheTile(_,i);const u=[],h=[];for(let _ in this._preStored){if(!this._preStored.hasOwnProperty(_)||_ in this._cachingTiles$)continue;const e=this._preStored[_];for(let t in e)e.hasOwnProperty(t)&&!(t in r)&&e[t].sequenceId!==i&&(t in this._cachedNodes?u.push([this._cachedNodes[t],_]):h.push([t,_]))}const p=u.sort((([e],[t])=>t.accessed-e.accessed)).slice(this._configuration.maxUnusedPreStoredImages).map((([e,t])=>[e.node.id,t]));this._uncachePreStored(h),this._uncachePreStored(p);const d=[];for(let _ in this._cachedNodes)this._cachedNodes.hasOwnProperty(_)&&!(_ in r)&&d.push(this._cachedNodes[_]);const f=d.sort(((e,t)=>t.accessed-e.accessed)).slice(this._configuration.maxUnusedImages);for(const _ of f){_.node.uncache();const e=_.node.id;delete this._cachedNodes[e],e in this._cachedNodeTiles&&delete this._cachedNodeTiles[e],e in this._cachedSpatialEdges&&delete this._cachedSpatialEdges[e]}const m=[];for(let _ in this._sequences)this._sequences.hasOwnProperty(_)&&!(_ in this._cachingSequences$)&&_!==i&&m.push(this._sequences[_]);const g=m.sort(((e,t)=>t.accessed-e.accessed)).slice(this._configuration.maxSequences);for(const _ of g){const e=_.sequence.id;delete this._sequences[e],e in this._cachedSequenceNodes&&delete this._cachedSequenceNodes[e],_.sequence.dispose()}}updateCells$(e){const t=this._cachedTiles,i=this._cachingTiles$;return Oe(e).pipe(ft((e=>e in t?this._updateCell$(e):e in i?i[e].pipe(zt((()=>Ze(this))),ft((()=>this._updateCell$(e)))):Me())))}unsubscribe(){this._filterSubscription.unsubscribe()}_addNewKeys(e,t){for(let i in t)t.hasOwnProperty(i)&&this.hasNode(i)&&(i in e||(e[i]=!0))}_cacheSequence$(e){return e in this._cachingSequences$||(this._cachingSequences$[e]=this._api.getSequence$(e).pipe(ci((t=>{t?(t.id in this._sequences||(this._sequences[t.id]={accessed:(new Date).getTime(),sequence:new qh(t)}),delete this._cachingSequences$[e]):console.warn(`Sequence does not exist (${e})`)})),tt((()=>this)),Gt((()=>{e in this._cachingSequences$&&delete this._cachingSequences$[e],this._changed$.next(this)})),Kt(),le())),this._cachingSequences$[e]}_cacheTile$(e){return this._cachingTiles$[e]=this._api.getCoreImages$(e).pipe(ci((t=>{if(e in this._cachedTiles)return;const i=t.images;this._nodeIndexTiles[e]=[],this._cachedTiles[e]={accessed:(new Date).getTime(),nodes:[]};const r=this._cachedTiles[e].nodes,n=this._removeFromPreStore(e);for(const a of i){if(!a)break;if(null==a.sequence.id){console.warn(`Sequence missing, discarding node (${a.id})`);continue}if(null!=n&&a.id in n){const t=n[a.id];delete n[a.id],r.push(t);const i={lat:t.lngLat.lat,lng:t.lngLat.lng,node:t};this._nodeIndex.insert(i),this._nodeIndexTiles[e].push(i),this._nodeToTile[t.id]=e;continue}const t=new $h(a);r.push(t);const i={lat:t.lngLat.lat,lng:t.lngLat.lng,node:t};this._nodeIndex.insert(i),this._nodeIndexTiles[e].push(i),this._nodeToTile[t.id]=e,this._setNode(t)}delete this._cachingTiles$[e]})),tt((()=>this)),zt((t=>{throw delete this._cachingTiles$[e],t})),Kt(),le()),this._cachingTiles$[e]}_makeFull(e,t){null==t.computed_altitude&&(t.computed_altitude=this._defaultAlt),null==t.computed_rotation&&(t.computed_rotation=this._graphCalculator.rotationFromCompass(t.compass_angle,t.exif_orientation)),e.makeComplete(t)}_preStore(e,t){e in this._preStored||(this._preStored[e]={}),this._preStored[e][t.id]=t}_removeFromPreStore(e){let t=null;return e in this._preStored&&(t=this._preStored[e],delete this._preStored[e]),t}_setNode(e){let t=e.id;if(this.hasNode(t))throw new np(`Image already exist (${t}).`);this._nodes[t]=e}_uncacheTile(e,t){for(let i of this._cachedTiles[e].nodes){let r=i.id;delete this._nodeToTile[r],r in this._cachedNodes&&delete this._cachedNodes[r],r in this._cachedNodeTiles&&delete this._cachedNodeTiles[r],r in this._cachedSpatialEdges&&delete this._cachedSpatialEdges[r],i.sequenceId===t?(this._preStore(e,i),i.uncache()):(delete this._nodes[r],i.sequenceId in this._cachedSequenceNodes&&delete this._cachedSequenceNodes[i.sequenceId],i.dispose())}for(let i of this._nodeIndexTiles[e])this._nodeIndex.remove(i);delete this._nodeIndexTiles[e],delete this._cachedTiles[e]}_uncachePreStored(e){let t={};for(let[i,r]of e){i in this._nodes&&delete this._nodes[i],i in this._cachedNodes&&delete this._cachedNodes[i];let e=this._preStored[r][i];e.sequenceId in this._cachedSequenceNodes&&delete this._cachedSequenceNodes[e.sequenceId],delete this._preStored[r][i],e.dispose(),t[r]=!0}for(let i in t)t.hasOwnProperty(i)&&0===Object.keys(this._preStored[i]).length&&delete this._preStored[i]}_updateCachedTileAccess(e,t){e in this._nodeToTile&&(this._cachedTiles[this._nodeToTile[e]].accessed=t)}_updateCachedNodeAccess(e,t){e in this._cachedNodes&&(this._cachedNodes[e].accessed=t)}_updateCell$(e){return this._api.getCoreImages$(e).pipe(ft((t=>{if(!(e in this._cachedTiles))return Me();const i=this._nodeIndex,r=this._nodeIndexTiles[e],n=this._nodeToTile,a=this._cachedTiles[e];a.accessed=(new Date).getTime();const o=a.nodes,s=t.images;for(const l of s){if(null==l)break;if(this.hasNode(l.id))continue;if(null==l.sequence.id){console.warn(`Sequence missing, discarding node (${l.id})`);continue}const t=new $h(l);o.push(t);const a={lat:t.lngLat.lat,lng:t.lngLat.lng,node:t};i.insert(a),r.push(a),n[t.id]=e,this._setNode(t)}return Ze(e)})),zt((e=>(console.error(e),Me()))))}}class op{constructor(){this._hash={},this._index=new op._spatialIndex(16),this._indexChanged$=new he,this._updated$=new he}static register(e){op._spatialIndex=e}get changed$(){return this._indexChanged$}get updated$(){return this._updated$}add(e){const t=[],i=this._hash,r=this._index;for(const n of e){const e=n.id;e in i&&(r.remove(i[e]),t.push(n));const a={lat:n.lngLat.lat,lng:n.lngLat.lng,marker:n};i[e]=a,r.insert(a)}t.length>0&&this._updated$.next(t),e.length>t.length&&this._indexChanged$.next(this)}has(e){return e in this._hash}get(e){return this.has(e)?this._hash[e].marker:void 0}getAll(){return this._index.all().map((e=>e.marker))}remove(e){const t=this._hash,i=this._index;let r=!1;for(const n of e){if(!(n in t))continue;const e=t[n];i.remove(e),delete t[n],r=!0}r&&this._indexChanged$.next(this)}removeAll(){this._hash={},this._index.clear(),this._indexChanged$.next(this)}search([e,t]){return this._index.search({maxX:t.lng,maxY:t.lat,minX:e.lng,minY:e.lat}).map((e=>e.marker))}update(e){const t=this._hash,i=this._index,r=e.id;if(!(r in t))return;i.remove(t[r]);const n={lat:e.lngLat.lat,lng:e.lngLat.lng,marker:e};t[r]=n,i.insert(n)}}function sp(e,t,i,r,n){lp(e,t,i||0,r||e.length-1,n||up)}function lp(e,t,i,r,n){for(;r>i;){if(r-i>600){var a=r-i+1,o=t-i+1,s=Math.log(a),l=.5*Math.exp(2*s/3),c=.5*Math.sqrt(s*l*(a-l)/a)*(o-a/2<0?-1:1);lp(e,t,Math.max(i,Math.floor(t-o*l/a+c)),Math.min(r,Math.floor(t+(a-o)*l/a+c)),n)}var u=e[t],h=i,p=r;for(cp(e,i,t),n(e[r],u)>0&&cp(e,i,r);h<p;){for(cp(e,h,p),h++,p--;n(e[h],u)<0;)h++;for(;n(e[p],u)>0;)p--}0===n(e[i],u)?cp(e,i,p):cp(e,++p,r),p<=t&&(i=p+1),t<=p&&(r=p-1)}}function cp(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}function up(e,t){return e<t?-1:e>t?1:0}function hp(e,t,i){if(!i)return t.indexOf(e);for(let r=0;r<t.length;r++)if(i(e,t[r]))return r;return-1}function pp(e,t){dp(e,0,e.children.length,t,e)}function dp(e,t,i,r,n){n||(n=wp(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let a=t;a<i;a++){const t=e.children[a];fp(n,e.leaf?r(t):t)}return n}function fp(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function mp(e,t){return e.minX-t.minX}function gp(e,t){return e.minY-t.minY}function _p(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function yp(e){return e.maxX-e.minX+(e.maxY-e.minY)}function vp(e,t){const i=Math.max(e.minX,t.minX),r=Math.max(e.minY,t.minY),n=Math.min(e.maxX,t.maxX),a=Math.min(e.maxY,t.maxY);return Math.max(0,n-i)*Math.max(0,a-r)}function xp(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function bp(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function wp(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Sp(e,t,i,r,n){const a=[t,i];for(;a.length;){if((i=a.pop())-(t=a.pop())<=r)continue;const o=t+Math.ceil((i-t)/r/2)*r;sp(e,o,t,i,n),a.push(t,o,o,i)}}class Mp extends class{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const i=[];if(!bp(e,t))return i;const r=this.toBBox,n=[];for(;t;){for(let a=0;a<t.children.length;a++){const o=t.children[a],s=t.leaf?r(o):o;bp(e,s)&&(t.leaf?i.push(o):xp(e,s)?this._all(o,i):n.push(o))}t=n.pop()}return i}collides(e){let t=this.data;if(!bp(e,t))return!1;const i=[];for(;t;){for(let r=0;r<t.children.length;r++){const n=t.children[r],a=t.leaf?this.toBBox(n):n;if(bp(e,a)){if(t.leaf||xp(e,a))return!0;i.push(n)}}t=i.pop()}return!1}load(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(let t=0;t<e.length;t++)this.insert(e[t]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const e=this.data;this.data=t,t=e}this._insert(t,this.data.height-t.height-1,!0)}else this.data=t;return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=wp([]),this}remove(e,t){if(!e)return this;let i=this.data;const r=this.toBBox(e),n=[],a=[];let o,s,l;for(;i||n.length;){if(i||(i=n.pop(),s=n[n.length-1],o=a.pop(),l=!0),i.leaf){const r=hp(e,i.children,t);if(-1!==r)return i.children.splice(r,1),n.push(i),this._condense(n),this}l||i.leaf||!xp(i,r)?s?(o++,i=s.children[o],l=!1):i=null:(n.push(i),a.push(o),o=0,s=i,i=i.children[0])}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const i=[];for(;e;)e.leaf?t.push(...e.children):i.push(...e.children),e=i.pop();return t}_build(e,t,i,r){const n=i-t+1;let a,o=this._maxEntries;if(n<=o)return a=wp(e.slice(t,i+1)),pp(a,this.toBBox),a;r||(r=Math.ceil(Math.log(n)/Math.log(o)),o=Math.ceil(n/Math.pow(o,r-1))),a=wp([]),a.leaf=!1,a.height=r;const s=Math.ceil(n/o),l=s*Math.ceil(Math.sqrt(o));Sp(e,t,i,l,this.compareMinX);for(let c=t;c<=i;c+=l){const t=Math.min(c+l-1,i);Sp(e,c,t,s,this.compareMinY);for(let i=c;i<=t;i+=s){const n=Math.min(i+s-1,t);a.children.push(this._build(e,i,n,r-1))}}return pp(a,this.toBBox),a}_chooseSubtree(e,t,i,r){for(;r.push(t),!t.leaf&&r.length-1!==i;){let i,r=1/0,o=1/0;for(let s=0;s<t.children.length;s++){const l=t.children[s],c=_p(l),u=(n=e,a=l,(Math.max(a.maxX,n.maxX)-Math.min(a.minX,n.minX))*(Math.max(a.maxY,n.maxY)-Math.min(a.minY,n.minY))-c);u<o?(o=u,r=c<r?c:r,i=l):u===o&&c<r&&(r=c,i=l)}t=i||t.children[0]}var n,a;return t}_insert(e,t,i){const r=i?e:this.toBBox(e),n=[],a=this._chooseSubtree(r,this.data,t,n);for(a.children.push(e),fp(a,r);t>=0&&n[t].children.length>this._maxEntries;)this._split(n,t),t--;this._adjustParentBBoxes(r,n,t)}_split(e,t){const i=e[t],r=i.children.length,n=this._minEntries;this._chooseSplitAxis(i,n,r);const a=this._chooseSplitIndex(i,n,r),o=wp(i.children.splice(a,i.children.length-a));o.height=i.height,o.leaf=i.leaf,pp(i,this.toBBox),pp(o,this.toBBox),t?e[t-1].children.push(o):this._splitRoot(i,o)}_splitRoot(e,t){this.data=wp([e,t]),this.data.height=e.height+1,this.data.leaf=!1,pp(this.data,this.toBBox)}_chooseSplitIndex(e,t,i){let r,n=1/0,a=1/0;for(let o=t;o<=i-t;o++){const t=dp(e,0,o,this.toBBox),s=dp(e,o,i,this.toBBox),l=vp(t,s),c=_p(t)+_p(s);l<n?(n=l,r=o,a=c<a?c:a):l===n&&c<a&&(a=c,r=o)}return r||i-t}_chooseSplitAxis(e,t,i){const r=e.leaf?this.compareMinX:mp,n=e.leaf?this.compareMinY:gp;this._allDistMargin(e,t,i,r)<this._allDistMargin(e,t,i,n)&&e.children.sort(r)}_allDistMargin(e,t,i,r){e.children.sort(r);const n=this.toBBox,a=dp(e,0,t,n),o=dp(e,i-t,i,n);let s=yp(a)+yp(o);for(let l=t;l<i-t;l++){const t=e.children[l];fp(a,e.leaf?n(t):t),s+=yp(a)}for(let l=i-t-1;l>=t;l--){const t=e.children[l];fp(o,e.leaf?n(t):t),s+=yp(o)}return s}_adjustParentBBoxes(e,t,i){for(let r=i;r>=0;r--)fp(t[r],e)}_condense(e){for(let t,i=e.length-1;i>=0;i--)0===e[i].children.length?i>0?(t=e[i-1].children,t.splice(t.indexOf(e[i]),1)):this.clear():pp(e[i],this.toBBox)}}{compareMinX(e,t){return e.lng-t.lng}compareMinY(e,t){return e.lat-t.lat}toBBox(e){return{minX:e.lng,minY:e.lat,maxX:e.lng,maxY:e.lat}}}class Tp{constructor(e,t){this._components={};for(const i in Tp.registeredComponents){if(!Tp.registeredComponents.hasOwnProperty(i))continue;const r=Tp.registeredComponents[i];this._components[i]={active:!1,component:new r(i,e,t)}}this._coverComponent=new Tp.registeredCoverComponent("cover",e,t),this._coverComponent.activate(),this._coverActivated=!0}static register(e){void 0===Tp.registeredComponents[e.componentName]&&(Tp.registeredComponents[e.componentName]=e)}static registerCover(e){Tp.registeredCoverComponent=e}get coverActivated(){return this._coverActivated}activateCover(){if(!this._coverActivated){this._coverActivated=!0;for(const e in this._components){if(!this._components.hasOwnProperty(e))continue;const t=this._components[e];t.active&&t.component.deactivate()}}}deactivateCover(){if(this._coverActivated){this._coverActivated=!1;for(const e in this._components){if(!this._components.hasOwnProperty(e))continue;const t=this._components[e];t.active&&t.component.activate()}}}activate(e){this._checkName(e),this._components[e].active=!0,this._coverActivated||this.get(e).activate()}configure(e,t){this._checkName(e),this.get(e).configure(t)}deactivate(e){this._checkName(e),this._components[e].active=!1,this._coverActivated||this.get(e).deactivate()}get(e){return this._components[e].component}getCover(){return this._coverComponent}remove(){this._coverComponent.deactivate();for(const e in this._components)this._components.hasOwnProperty(e)&&this._components[e].component.deactivate()}_checkName(e){if(!(e in this._components))throw new Yh(`Component does not exist: ${e}`)}}Tp.registeredComponents={};var Ep="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{};function Cp(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(i){var r=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return e[i]}})})),t}var Ap=Array.isArray,Ip=Object.prototype.toString,Pp=Ap||function(e){return"[object Array]"===Ip.call(e)};Rp.NONE=0,Rp.VTEXT=1,Rp.VNODE=2,Rp.WIDGET=3,Rp.PROPS=4,Rp.ORDER=5,Rp.INSERT=6,Rp.REMOVE=7,Rp.THUNK=8;var zp=Rp;function Rp(e,t,i){this.type=Number(e),this.vNode=t,this.patch=i}Rp.prototype.version="2",Rp.prototype.type="VirtualPatch";var kp=function(e){return e&&"VirtualNode"===e.type&&"2"===e.version};var Lp=function(e){return e&&"VirtualText"===e.type&&"2"===e.version};var Dp=function(e){return e&&"Widget"===e.type};var Bp=function(e){return e&&"Thunk"===e.type};var Fp=kp,Op=Lp,Np=Dp,Vp=Bp,Up=function(e,t){var i=e,r=t;Vp(t)&&(r=$p(t,e));Vp(e)&&(i=$p(e,null));return{a:i,b:r}};function $p(e,t){var i=e.vnode;if(i||(i=e.vnode=e.render(t)),!(Fp(i)||Op(i)||Np(i)))throw new Error("thunk did not return a valid node");return i}var jp=function(e){return"object"===typeof e&&null!==e},qp=function(e){return e&&("function"===typeof e.hook&&!e.hasOwnProperty("hook")||"function"===typeof e.unhook&&!e.hasOwnProperty("unhook"))};var Gp=jp,Hp=qp,Wp=function e(t,i){var r;for(var n in t){n in i||((r=r||{})[n]=void 0);var a=t[n],o=i[n];if(a!==o)if(Gp(a)&&Gp(o))if(Zp(o)!==Zp(a))(r=r||{})[n]=o;else if(Hp(o))(r=r||{})[n]=o;else{var s=e(a,o);s&&((r=r||{})[n]=s)}else(r=r||{})[n]=o}for(var l in i)l in t||((r=r||{})[l]=i[l]);return r};function Zp(e){return Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__?e.__proto__:e.constructor?e.constructor.prototype:void 0}var Xp=Pp,Yp=zp,Kp=kp,Jp=Lp,Qp=Dp,ed=Bp,td=Up,id=Wp;function rd(e,t){var i={a:e};return nd(e,t,i,0),i}function nd(e,t,i,r){if(e!==t){var n=i[r],a=!1;if(ed(e)||ed(t))sd(e,t,i,r);else if(null==t)Qp(e)||(ad(e,i,r),n=i[r]),n=hd(n,new Yp(Yp.REMOVE,e,t));else if(Kp(t))if(Kp(e))if(e.tagName===t.tagName&&e.namespace===t.namespace&&e.key===t.key){var o=id(e.properties,t.properties);o&&(n=hd(n,new Yp(Yp.PROPS,e,o))),n=function(e,t,i,r,n){for(var a=e.children,o=function(e,t){var i=ud(t),r=i.keys,n=i.free;if(n.length===t.length)return{children:t,moves:null};var a=ud(e),o=a.keys;if(a.free.length===e.length)return{children:t,moves:null};for(var s=[],l=0,c=n.length,u=0,h=0;h<e.length;h++){var p,d=e[h];d.key?r.hasOwnProperty(d.key)?(p=r[d.key],s.push(t[p])):(p=h-u++,s.push(null)):l<c?(p=n[l++],s.push(t[p])):(p=h-u++,s.push(null))}for(var f=l>=n.length?t.length:n[l],m=0;m<t.length;m++){var g=t[m];g.key?o.hasOwnProperty(g.key)||s.push(g):m>=f&&s.push(g)}for(var _,y=s.slice(),v=0,x=[],b=[],w=0;w<t.length;){var S=t[w];for(_=y[v];null===_&&y.length;)x.push(cd(y,v,null)),_=y[v];_&&_.key===S.key?(v++,w++):S.key?(_&&_.key&&r[_.key]!==w+1?(x.push(cd(y,v,_.key)),(_=y[v])&&_.key===S.key?v++:b.push({key:S.key,to:w})):b.push({key:S.key,to:w}),w++):_&&_.key&&x.push(cd(y,v,_.key))}for(;v<y.length;)_=y[v],x.push(cd(y,v,_&&_.key));if(x.length===u&&!b.length)return{children:s,moves:null};return{children:s,moves:{removes:x,inserts:b}}}(a,t.children),s=o.children,l=a.length,c=s.length,u=l>c?l:c,h=0;h<u;h++){var p=a[h],d=s[h];n+=1,p?nd(p,d,i,n):d&&(r=hd(r,new Yp(Yp.INSERT,null,d))),Kp(p)&&p.count&&(n+=p.count)}o.moves&&(r=hd(r,new Yp(Yp.ORDER,e,o.moves)));return r}(e,t,i,n,r)}else n=hd(n,new Yp(Yp.VNODE,e,t)),a=!0;else n=hd(n,new Yp(Yp.VNODE,e,t)),a=!0;else Jp(t)?Jp(e)?e.text!==t.text&&(n=hd(n,new Yp(Yp.VTEXT,e,t))):(n=hd(n,new Yp(Yp.VTEXT,e,t)),a=!0):Qp(t)&&(Qp(e)||(a=!0),n=hd(n,new Yp(Yp.WIDGET,e,t)));n&&(i[r]=n),a&&ad(e,i,r)}}function ad(e,t,i){ld(e,t,i),od(e,t,i)}function od(e,t,i){if(Qp(e))"function"===typeof e.destroy&&(t[i]=hd(t[i],new Yp(Yp.REMOVE,e,null)));else if(Kp(e)&&(e.hasWidgets||e.hasThunks))for(var r=e.children,n=r.length,a=0;a<n;a++){var o=r[a];od(o,t,i+=1),Kp(o)&&o.count&&(i+=o.count)}else ed(e)&&sd(e,null,t,i)}function sd(e,t,i,r){var n=td(e,t),a=rd(n.a,n.b);(function(e){for(var t in e)if("a"!==t)return!0;return!1})(a)&&(i[r]=new Yp(Yp.THUNK,null,a))}function ld(e,t,i){if(Kp(e)){if(e.hooks&&(t[i]=hd(t[i],new Yp(Yp.PROPS,e,function(e){var t={};for(var i in e)t[i]=void 0;return t}(e.hooks)))),e.descendantHooks||e.hasThunks)for(var r=e.children,n=r.length,a=0;a<n;a++){var o=r[a];ld(o,t,i+=1),Kp(o)&&o.count&&(i+=o.count)}}else ed(e)&&sd(e,null,t,i)}function cd(e,t,i){return e.splice(t,1),{from:t,key:i}}function ud(e){for(var t={},i=[],r=e.length,n=0;n<r;n++){var a=e[n];a.key?t[a.key]=n:i.push(n)}return{keys:t,free:i}}function hd(e,t){return e?(Xp(e)?e.push(t):e=[e,t],e):t}var pd=rd,dd=Array.prototype.slice,fd=function(e,t){"length"in e||(e=[e]);e=dd.call(e);for(;e.length;){var i=e.shift(),r=t(i);if(r)return r;i.childNodes&&i.childNodes.length&&(e=dd.call(i.childNodes).concat(e))}};var md=gd;function gd(e,t){if(!(this instanceof gd))return new gd(e,t);this.data=e,this.nodeValue=e,this.length=e.length,this.ownerDocument=t||null}gd.prototype.nodeType=8,gd.prototype.nodeName="#comment",gd.prototype.toString=function(){return"[object Comment]"};var _d=yd;function yd(e,t){if(!(this instanceof yd))return new yd(e);this.data=e||"",this.length=this.data.length,this.ownerDocument=t||null}yd.prototype.type="DOMTextNode",yd.prototype.nodeType=3,yd.prototype.nodeName="#text",yd.prototype.toString=function(){return this.data},yd.prototype.replaceData=function(e,t,i){var r=this.data,n=r.substring(0,e),a=r.substring(e+t,r.length);this.data=n+i+a,this.length=this.data.length};var vd=function(e){var t=this,i=e.type;e.target||(e.target=t);t.listeners||(t.listeners={});var r=t.listeners[i];if(r)return r.forEach((function(i){e.currentTarget=t,"function"===typeof i?i(e):i.handleEvent(e)}));t.parentNode&&t.parentNode.dispatchEvent(e)};var xd=function(e,t){var i=this;i.listeners||(i.listeners={});i.listeners[e]||(i.listeners[e]=[]);-1===i.listeners[e].indexOf(t)&&i.listeners[e].push(t)};var bd=function(e,t){var i=this;if(!i.listeners)return;if(!i.listeners[e])return;var r=i.listeners[e],n=r.indexOf(t);-1!==n&&r.splice(n,1)};var wd=["area","base","br","col","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"];function Sd(e){switch(e.nodeType){case 3:return Ed(e.data);case 8:return"\x3c!--"+e.data+"--\x3e";default:return function(e){var t=[],i=e.tagName;"http://www.w3.org/1999/xhtml"===e.namespaceURI&&(i=i.toLowerCase());t.push("<"+i+function(e){var t=[];for(var i in e)Md(e,i)&&t.push({name:i,value:e[i]});for(var r in e._attributes)for(var n in e._attributes[r]){var a=e._attributes[r][n],o=(a.prefix?a.prefix+":":"")+n;t.push({name:o,value:a.value})}e.className&&t.push({name:"class",value:e.className});return t.length?Td(t):""}(e)+function(e){var t=e.dataset,i=[];for(var r in t)i.push({name:"data-"+r,value:t[r]});return i.length?Td(i):""}(e)),wd.indexOf(i)>-1?t.push(" />"):(t.push(">"),e.childNodes.length?t.push.apply(t,e.childNodes.map(Sd)):e.textContent||e.innerText?t.push(Ed(e.textContent||e.innerText)):e.innerHTML&&t.push(e.innerHTML),t.push("</"+i+">"));return t.join("")}(e)}}function Md(e,t){var i=typeof e[t];return"style"===t&&Object.keys(e.style).length>0||e.hasOwnProperty(t)&&("string"===i||"boolean"===i||"number"===i)&&"nodeName"!==t&&"className"!==t&&"tagName"!==t&&"textContent"!==t&&"innerText"!==t&&"namespaceURI"!==t&&"innerHTML"!==t}function Td(e){var t=[];return e.forEach((function(e){var i=e.name,r=e.value;"style"===i&&(r=function(e){if("string"===typeof e)return e;var t="";return Object.keys(e).forEach((function(i){var r=e[i];i=i.replace(/[A-Z]/g,(function(e){return"-"+e.toLowerCase()})),t+=i+":"+r+";"})),t}(r)),t.push(i+'="'+(Ed(r).replace(/"/g,"&quot;")+'"'))})),t.length?" "+t.join(" "):""}function Ed(e){var t="";return"string"===typeof e?t=e:e&&(t=e.toString()),t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var Cd=fd,Ad=vd,Id=xd,Pd=bd,zd=Sd,Rd="http://www.w3.org/1999/xhtml",kd=Ld;function Ld(e,t,i){if(!(this instanceof Ld))return new Ld(e);var r=void 0===i?Rd:i||null;this.tagName=r===Rd?String(e).toUpperCase():e,this.nodeName=this.tagName,this.className="",this.dataset={},this.childNodes=[],this.parentNode=null,this.style={},this.ownerDocument=t||null,this.namespaceURI=r,this._attributes={},"INPUT"===this.tagName&&(this.type="text")}Ld.prototype.type="DOMElement",Ld.prototype.nodeType=1,Ld.prototype.appendChild=function(e){return e.parentNode&&e.parentNode.removeChild(e),this.childNodes.push(e),e.parentNode=this,e},Ld.prototype.replaceChild=function(e,t){e.parentNode&&e.parentNode.removeChild(e);var i=this.childNodes.indexOf(t);return t.parentNode=null,this.childNodes[i]=e,e.parentNode=this,t},Ld.prototype.removeChild=function(e){var t=this.childNodes.indexOf(e);return this.childNodes.splice(t,1),e.parentNode=null,e},Ld.prototype.insertBefore=function(e,t){e.parentNode&&e.parentNode.removeChild(e);var i=null===t||void 0===t?-1:this.childNodes.indexOf(t);return i>-1?this.childNodes.splice(i,0,e):this.childNodes.push(e),e.parentNode=this,e},Ld.prototype.setAttributeNS=function(e,t,i){var r=null,n=t,a=t.indexOf(":");(a>-1&&(r=t.substr(0,a),n=t.substr(a+1)),"INPUT"===this.tagName&&"type"===t)?this.type=i:(this._attributes[e]||(this._attributes[e]={}))[n]={value:i,prefix:r}},Ld.prototype.getAttributeNS=function(e,t){var i=this._attributes[e],r=i&&i[t]&&i[t].value;return"INPUT"===this.tagName&&"type"===t?this.type:"string"!==typeof r?null:r},Ld.prototype.removeAttributeNS=function(e,t){var i=this._attributes[e];i&&delete i[t]},Ld.prototype.hasAttributeNS=function(e,t){var i=this._attributes[e];return!!i&&t in i},Ld.prototype.setAttribute=function(e,t){return this.setAttributeNS(null,e,t)},Ld.prototype.getAttribute=function(e){return this.getAttributeNS(null,e)},Ld.prototype.removeAttribute=function(e){return this.removeAttributeNS(null,e)},Ld.prototype.hasAttribute=function(e){return this.hasAttributeNS(null,e)},Ld.prototype.removeEventListener=Pd,Ld.prototype.addEventListener=Id,Ld.prototype.dispatchEvent=Ad,Ld.prototype.focus=function(){},Ld.prototype.toString=function(){return zd(this)},Ld.prototype.getElementsByClassName=function(e){var t=e.split(" "),i=[];return Cd(this,(function(e){if(1===e.nodeType){var r=(e.className||"").split(" ");t.every((function(e){return-1!==r.indexOf(e)}))&&i.push(e)}})),i},Ld.prototype.getElementsByTagName=function(e){e=e.toLowerCase();var t=[];return Cd(this.childNodes,(function(i){1!==i.nodeType||"*"!==e&&i.tagName.toLowerCase()!==e||t.push(i)})),t},Ld.prototype.contains=function(e){return Cd(this,(function(t){return e===t}))||!1};var Dd=kd,Bd=Fd;function Fd(e){if(!(this instanceof Fd))return new Fd;this.childNodes=[],this.parentNode=null,this.ownerDocument=e||null}Fd.prototype.type="DocumentFragment",Fd.prototype.nodeType=11,Fd.prototype.nodeName="#document-fragment",Fd.prototype.appendChild=Dd.prototype.appendChild,Fd.prototype.replaceChild=Dd.prototype.replaceChild,Fd.prototype.removeChild=Dd.prototype.removeChild,Fd.prototype.toString=function(){return this.childNodes.map((function(e){return String(e)})).join("")};var Od=Nd;function Nd(e){}Nd.prototype.initEvent=function(e,t,i){this.type=e,this.bubbles=t,this.cancelable=i},Nd.prototype.preventDefault=function(){};var Vd=fd,Ud=md,$d=_d,jd=kd,qd=Bd,Gd=Od,Hd=vd,Wd=xd,Zd=bd,Xd=Yd;function Yd(){if(!(this instanceof Yd))return new Yd;this.head=this.createElement("head"),this.body=this.createElement("body"),this.documentElement=this.createElement("html"),this.documentElement.appendChild(this.head),this.documentElement.appendChild(this.body),this.childNodes=[this.documentElement],this.nodeType=9}var Kd=Yd.prototype;Kd.createTextNode=function(e){return new $d(e,this)},Kd.createElementNS=function(e,t){var i=null===e?null:String(e);return new jd(t,this,i)},Kd.createElement=function(e){return new jd(e,this)},Kd.createDocumentFragment=function(){return new qd(this)},Kd.createEvent=function(e){return new Gd(e)},Kd.createComment=function(e){return new Ud(e,this)},Kd.getElementById=function(e){return e=String(e),Vd(this.childNodes,(function(t){if(String(t.id)===e)return t}))||null},Kd.getElementsByClassName=jd.prototype.getElementsByClassName,Kd.getElementsByTagName=jd.prototype.getElementsByTagName,Kd.contains=jd.prototype.contains,Kd.removeEventListener=Zd,Kd.addEventListener=Wd,Kd.dispatchEvent=Hd;var Jd,Qd=new Xd,ef="undefined"!==typeof Ep?Ep:"undefined"!==typeof window?window:{},tf=Qd;"undefined"!==typeof document?Jd=document:(Jd=ef["__GLOBAL_DOCUMENT_CACHE@4"])||(Jd=ef["__GLOBAL_DOCUMENT_CACHE@4"]=tf);var rf=jp,nf=qp,af=function(e,t,i){for(var r in t){var n=t[r];void 0===n?of(e,r,n,i):nf(n)?(of(e,r,n,i),n.hook&&n.hook(e,r,i?i[r]:void 0)):rf(n)?sf(e,t,i,r,n):e[r]=n}};function of(e,t,i,r){if(r){var n=r[t];if(nf(n))n.unhook&&n.unhook(e,t,i);else if("attributes"===t)for(var a in n)e.removeAttribute(a);else if("style"===t)for(var o in n)e.style[o]="";else e[t]="string"===typeof n?"":null}}function sf(e,t,i,r,n){var a=i?i[r]:void 0;if("attributes"!==r)if(a&&rf(a)&&lf(a)!==lf(n))e[r]=n;else{rf(e[r])||(e[r]={});var o="style"===r?"":void 0;for(var s in n){var l=n[s];e[r][s]=void 0===l?o:l}}else for(var c in n){var u=n[c];void 0===u?e.removeAttribute(c):e.setAttribute(c,u)}}function lf(e){return Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__?e.__proto__:e.constructor?e.constructor.prototype:void 0}var cf=Jd,uf=af,hf=kp,pf=Lp,df=Dp,ff=Up,mf=function e(t,i){var r=i&&i.document||cf,n=i?i.warn:null;if(t=ff(t).a,df(t))return t.init();if(pf(t))return r.createTextNode(t.text);if(!hf(t))return n&&n("Item is not a valid virtual dom node",t),null;var a=null===t.namespace?r.createElement(t.tagName):r.createElementNS(t.namespace,t.tagName),o=t.properties;uf(a,o);for(var s=t.children,l=0;l<s.length;l++){var c=e(s[l],i);c&&a.appendChild(c)}return a};var gf={};function _f(e,t,i,r,n){if(r=r||{},e){yf(i,n,n)&&(r[n]=e);var a=t.children;if(a)for(var o=e.childNodes,s=0;s<t.children.length;s++){n+=1;var l=a[s]||gf,c=n+(l.count||0);yf(i,n,c)&&_f(o[s],l,i,r,n),n=c}}return r}function yf(e,t,i){if(0===e.length)return!1;for(var r,n,a=0,o=e.length-1;a<=o;){if(n=e[r=(o+a)/2>>0],a===o)return n>=t&&n<=i;if(n<t)a=r+1;else{if(!(n>i))return!0;o=r-1}}return!1}function vf(e,t){return e>t?1:-1}var xf=Dp;var bf=af,wf=Dp,Sf=zp,Mf=function(e,t){if(xf(e)&&xf(t))return"name"in e&&"name"in t?e.id===t.id:e.init===t.init;return!1},Tf=function(e,t,i){var r=e.type,n=e.vNode,a=e.patch;switch(r){case Sf.REMOVE:return function(e,t){var i=e.parentNode;i&&i.removeChild(e);return Ef(e,t),null}(t,n);case Sf.INSERT:return function(e,t,i){var r=i.render(t,i);e&&e.appendChild(r);return e}(t,a,i);case Sf.VTEXT:return function(e,t,i,r){var n;if(3===e.nodeType)e.replaceData(0,e.length,i.text),n=e;else{var a=e.parentNode;n=r.render(i,r),a&&n!==e&&a.replaceChild(n,e)}return n}(t,0,a,i);case Sf.WIDGET:return function(e,t,i,r){var n,a=Mf(t,i);n=a?i.update(t,e)||e:r.render(i,r);var o=e.parentNode;o&&n!==e&&o.replaceChild(n,e);a||Ef(e,t);return n}(t,n,a,i);case Sf.VNODE:return function(e,t,i,r){var n=e.parentNode,a=r.render(i,r);n&&a!==e&&n.replaceChild(a,e);return a}(t,0,a,i);case Sf.ORDER:return function(e,t){for(var i,r,n,a=e.childNodes,o={},s=0;s<t.removes.length;s++)i=a[(r=t.removes[s]).from],r.key&&(o[r.key]=i),e.removeChild(i);for(var l=a.length,c=0;c<t.inserts.length;c++)i=o[(n=t.inserts[c]).key],e.insertBefore(i,n.to>=l++?null:a[n.to])}(t,a),t;case Sf.PROPS:return bf(t,a,n.properties),t;case Sf.THUNK:return function(e,t){e&&t&&e!==t&&e.parentNode&&e.parentNode.replaceChild(t,e);return t}(t,i.patch(t,a,i));default:return t}};function Ef(e,t){"function"===typeof t.destroy&&wf(t)&&t.destroy(e)}var Cf=Jd,Af=Pp,If=mf,Pf=function(e,t,i,r){return i&&0!==i.length?(i.sort(vf),_f(e,t,i,r,0)):{}},zf=Tf,Rf=function e(t,i,r){return(r=r||{}).patch=r.patch&&r.patch!==e?r.patch:kf,r.render=r.render||If,r.patch(t,i,r)};function kf(e,t,i){var r=function(e){var t=[];for(var i in e)"a"!==i&&t.push(Number(i));return t}(t);if(0===r.length)return e;var n=Pf(e,t.a,r),a=e.ownerDocument;i.document||a===Cf||(i.document=a);for(var o=0;o<r.length;o++){var s=r[o];e=Lf(e,n[s],t[s],i)}return e}function Lf(e,t,i,r){if(!t)return e;var n;if(Af(i))for(var a=0;a<i.length;a++)n=zf(i[a],t,r),t===e&&(e=n);else n=zf(i,t,r),t===e&&(e=n);return e}var Df=Rf,Bf=kp,Ff=Dp,Of=Bp,Nf=qp,Vf=jf,Uf={},$f=[];function jf(e,t,i,r,n){this.tagName=e,this.properties=t||Uf,this.children=i||$f,this.key=null!=r?String(r):void 0,this.namespace="string"===typeof n?n:null;var a,o=i&&i.length||0,s=0,l=!1,c=!1,u=!1;for(var h in t)if(t.hasOwnProperty(h)){var p=t[h];Nf(p)&&p.unhook&&(a||(a={}),a[h]=p)}for(var d=0;d<o;d++){var f=i[d];Bf(f)?(s+=f.count||0,!l&&f.hasWidgets&&(l=!0),!c&&f.hasThunks&&(c=!0),u||!f.hooks&&!f.descendantHooks||(u=!0)):!l&&Ff(f)?"function"===typeof f.destroy&&(l=!0):!c&&Of(f)&&(c=!0)}this.count=o+s,this.hasWidgets=l,this.hasThunks=c,this.hooks=a,this.descendantHooks=u}jf.prototype.version="2",jf.prototype.type="VirtualNode";var qf=Gf;function Gf(e){this.text=String(e)}Gf.prototype.version="2",Gf.prototype.type="VirtualText";var Hf=function(e){var t,i=String.prototype.split,r=/()??/.exec("")[1]===e;return t=function(t,n,a){if("[object RegExp]"!==Object.prototype.toString.call(n))return i.call(t,n,a);var o,s,l,c,u=[],h=(n.ignoreCase?"i":"")+(n.multiline?"m":"")+(n.extended?"x":"")+(n.sticky?"y":""),p=0;n=new RegExp(n.source,h+"g");for(t+="",r||(o=new RegExp("^"+n.source+"$(?!\\s)",h)),a=a===e?-1>>>0:a>>>0;(s=n.exec(t))&&!((l=s.index+s[0].length)>p&&(u.push(t.slice(p,s.index)),!r&&s.length>1&&s[0].replace(o,(function(){for(var t=1;t<arguments.length-2;t++)arguments[t]===e&&(s[t]=e)})),s.length>1&&s.index<t.length&&Array.prototype.push.apply(u,s.slice(1)),c=s[0].length,p=l,u.length>=a));)n.lastIndex===s.index&&n.lastIndex++;return p===t.length?!c&&n.test("")||u.push(""):u.push(t.slice(p)),u.length>a?u.slice(0,a):u},t}(),Wf=Hf,Zf=/([\.#]?[a-zA-Z0-9\u007F-\uFFFF_:-]+)/,Xf=/^\.|#/,Yf=function(e,t){if(!e)return"DIV";var i,r,n,a,o=!t.hasOwnProperty("id"),s=Wf(e,Zf),l=null;Xf.test(s[1])&&(l="DIV");for(a=0;a<s.length;a++)(r=s[a])&&(n=r.charAt(0),l?"."===n?(i=i||[]).push(r.substring(1,r.length)):"#"===n&&o&&(t.id=r.substring(1,r.length)):l=r);i&&(t.className&&i.push(t.className),t.className=i.join(" "));return t.namespace?l:l.toUpperCase()};var Kf=Jf;function Jf(e){if(!(this instanceof Jf))return new Jf(e);this.value=e}Jf.prototype.hook=function(e,t){e[t]!==this.value&&(e[t]=this.value)};var Qf="undefined"!==typeof window?window:"undefined"!==typeof Ep?Ep:{};var em=function(e,t){if(e in Qf)return Qf[e];return Qf[e]=t,t},tm=function(e,t,i){var r="__INDIVIDUAL_ONE_VERSION_"+e,n=em(r+"_ENFORCE_SINGLETON",t);if(n!==t)throw new Error("Can only have one copy of "+e+".\nYou already have version "+n+" installed.\nThis means you cannot install version "+t);return em(r,i)};tm("ev-store","7");var im="__EV_STORE_KEY@7";var rm=function(e){var t=e[im];t||(t=e[im]={});return t},nm=am;function am(e){if(!(this instanceof am))return new am(e);this.value=e}am.prototype.hook=function(e,t){rm(e)[t.substr(3)]=this.value},am.prototype.unhook=function(e,t){rm(e)[t.substr(3)]=void 0};var om=Pp,sm=Vf,lm=qf,cm=kp,um=Lp,hm=Dp,pm=qp,dm=Bp,fm=Yf,mm=Kf,gm=nm,_m=function(e,t,i){var r,n,a,o,s=[];!i&&(l=t,"string"===typeof l||om(l)||vm(l))&&(i=t,n={});var l;r=fm(e,n=n||t||{}),n.hasOwnProperty("key")&&(a=n.key,n.key=void 0);n.hasOwnProperty("namespace")&&(o=n.namespace,n.namespace=void 0);"INPUT"!==r||o||!n.hasOwnProperty("value")||void 0===n.value||pm(n.value)||(n.value=mm(n.value));(function(e){for(var t in e)if(e.hasOwnProperty(t)){var i=e[t];if(pm(i))continue;"ev-"===t.substr(0,3)&&(e[t]=gm(i))}})(n),void 0!==i&&null!==i&&ym(i,s,r,n);return new sm(r,n,s,a,o)};function ym(e,t,i,r){if("string"===typeof e)t.push(new lm(e));else if("number"===typeof e)t.push(new lm(String(e)));else if(vm(e))t.push(e);else{if(!om(e)){if(null===e||void 0===e)return;throw function(e){var t=new Error;return t.type="virtual-hyperscript.unexpected.virtual-element",t.message="Unexpected virtual child passed to h().\nExpected a VNode / Vthunk / VWidget / string but:\ngot:\n"+xm(e.foreignObject)+".\nThe parent vnode is:\n"+xm(e.parentVnode),t.foreignObject=e.foreignObject,t.parentVnode=e.parentVnode,t}({foreignObject:e,parentVnode:{tagName:i,properties:r}})}for(var n=0;n<e.length;n++)ym(e[n],t,i,r)}}function vm(e){return cm(e)||um(e)||hm(e)||dm(e)}function xm(e){try{return JSON.stringify(e,null,"    ")}catch(t){return String(e)}}var bm,wm,Sm={diff:pd,patch:Df,h:_m,create:mf,VNode:Vf,VText:qf};class Mm{constructor(){this._events={}}fire(e,t){if(this._listens(e))for(const i of this._events[e])i(t)}off(e,t){if(e){if(this._listens(e)){const i=this._events[e].indexOf(t);i>=0&&this._events[e].splice(i,1),this._events[e].length||delete this._events[e]}}else this._events={}}on(e,t){this._events[e]=this._events[e]||[],this._events[e].push(t)}_listens(e){return e in this._events}}class Tm{constructor(){this._subscriptions=[]}push(e){this._subscriptions.push(e)}unsubscribe(){for(const e of this._subscriptions)e.unsubscribe();this._subscriptions=[]}}class Em extends Mm{constructor(e,t,i){super(),this._activated$=new de(!1),this._configurationSubject$=new he,this._activated=!1,this._container=t,this._name=e,this._navigator=i,this._subscriptions=new Tm,this._configuration$=this._configurationSubject$.pipe(ai(this.defaultConfiguration),ei(((e,t)=>{for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e})),Jt(1),le()),this._configuration$.subscribe((()=>{}))}get activated(){return this._activated}get activated$(){return this._activated$}get defaultConfiguration(){return this._getDefaultConfiguration()}get configuration$(){return this._configuration$}get name(){return this._name}activate(e){this._activated||(void 0!==e&&this._configurationSubject$.next(e),this._activated=!0,this._activate(),this._activated$.next(!0))}configure(e){this._configurationSubject$.next(e)}deactivate(){this._activated&&(this._activated=!1,this._deactivate(),this._container.domRenderer.clear(this._name),this._container.glRenderer.clear(this._name),this._activated$.next(!1))}fire(e,t){super.fire(e,t)}off(e,t){super.off(e,t)}on(e,t){super.on(e,t)}resize(){}}!function(e){e[e.Hidden=0]="Hidden",e[e.Loading=1]="Loading",e[e.Visible=2]="Visible"}(bm||(bm={}));class Cm extends Em{constructor(e,t,i){super(e,t,i)}_activate(){const e=this.configuration$.pipe(Ht((e=>!!e.id)),Ct((e=>!e.src)),oi((e=>this._getImageSrc$(e.id).pipe(zt((e=>(console.error(e),Me())))))),Jt(1),le()),t=this._subscriptions;t.push(e.pipe(tt((e=>({src:e})))).subscribe((e=>{this._configurationSubject$.next(e)}))),t.push(ut(this.configuration$,e).pipe(Ct((([e,t])=>!!e.src&&e.src!==t)),Ht()).subscribe((([,e])=>{window.URL.revokeObjectURL(e)}))),t.push(this._configuration$.pipe(Vt(void 0,(e=>e.state)),oi((e=>ut(Ze(e.state),this._navigator.stateService.currentImage$))),oi((([e,t])=>{const i=ut(Ze(t.id),t.image$.pipe(Ct((e=>!!e)),tt((e=>e.src))));return e===bm.Visible?i.pipe(Ht()):i})),Vt((([e,t],[i,r])=>e===i&&t===r)),tt((([e,t])=>({id:e,src:t})))).subscribe(this._configurationSubject$)),t.push(ut(this._configuration$,this._container.configurationService.exploreUrl$,this._container.renderService.size$).pipe(tt((([e,t,i])=>{if(!e.src)return{name:this._name,vNode:Sm.h("div",[])};const r=i.width<=640||i.height<=480?".mapillary-cover-compact":"";if(e.state===bm.Hidden){const t=Sm.h("div.mapillary-cover-container.mapillary-cover-done"+r,[this._getCoverBackgroundVNode(e)]);return{name:this._name,vNode:t}}const n=Sm.h("div.mapillary-cover-container"+r,[this._getCoverButtonVNode(e,t)]);return{name:this._name,vNode:n}}))).subscribe(this._container.domRenderer.render$))}_deactivate(){this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{state:bm.Visible}}_getCoverButtonVNode(e,t){const i=e.state===bm.Loading?"div.mapillary-cover.mapillary-cover-loading":"div.mapillary-cover",r=Sm.h("div.mapillary-cover-button",[Sm.h("div.mapillary-cover-button-icon",[])]),n=Sm.h("a.mapillary-cover-logo",{href:t,target:"_blank"},[]),a=Sm.h("div.mapillary-cover-indicator",{onclick:()=>{this.configure({state:bm.Loading})}},[]);return Sm.h(i,[this._getCoverBackgroundVNode(e),a,r,n])}_getCoverBackgroundVNode(e){const t={style:{backgroundImage:`url(${e.src})`}},i=[];return e.state===bm.Loading&&i.push(Sm.h("div.mapillary-cover-spinner",{},[])),Sm.h("div.mapillary-cover-background",t,i)}_getImageSrc$(e){return re.create((t=>{this._navigator.api.getImages$([e]).subscribe((i=>{for(const r of i){const i="number"===typeof e?e.toString():e;if(r.node_id===i)return void this._navigator.api.data.getImageBuffer(r.node.thumb.url).then((i=>{const r=new Image;r.crossOrigin="Anonymous",r.onload=()=>{t.next(r.src),t.complete()},r.onerror=()=>{t.error(new Error(`Failed to load cover image (${e})`))};const n=new Blob([i]);r.src=window.URL.createObjectURL(n)}),(e=>{t.error(e)}))}t.error(new Xh(`Non existent cover key: ${e}`))}),(e=>{t.error(e)}))}))}}Cm.componentName="cover";class Am extends Em{_activate(){this._subscriptions.push(ut(this._container.configurationService.exploreUrl$,this._navigator.stateService.currentImage$,this._container.renderService.size$).pipe(tt((([e,t,i])=>{const r=this._makeAttribution(t.creatorUsername,e,t.id,t.capturedAt,i.width);return{name:this._name,vNode:r}}))).subscribe(this._container.domRenderer.render$))}_deactivate(){this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{}}makeImageUrl(e,t){return`${e}/app/?pKey=${t}&focus=photo`}_makeAttribution(e,t,i,r,n){const a=n<=640,o=this._makeDate(r,a),s=this._makeBy(e,t,i,a),l=a?".mapillary-attribution-compact":"";return Sm.h("div.mapillary-attribution-container"+l,{},[...s,o])}_makeBy(e,t,i,r){const n=Sm.h("div.mapillary-attribution-logo",[]);return e?this._makeCreatorBy(n,e,t,i,r):this._makeGeneralBy(n,t,i,r)}_makeCreatorBy(e,t,i,r,n){const a=Sm.h("a.mapillary-attribution-icon-container",{href:i,rel:"noreferrer",target:"_blank"},[e]),o=n?`${t}`:`image by ${t}`,s=Sm.h("div.mapillary-attribution-username",{textContent:o},[]);return[a,Sm.h("a.mapillary-attribution-image-container",{href:this.makeImageUrl(i,r),rel:"noreferrer",target:"_blank"},[s])]}_makeGeneralBy(e,t,i,r){const n=Sm.h("div.mapillary-attribution-username",{textContent:"images by"},[]),a=[Sm.h("div.mapillary-attribution-icon-container",{},[e]),Sm.h("div.mapillary-attribution-username",{textContent:"contributors"},[])];r||a.unshift(n);return[Sm.h("a.mapillary-attribution-image-container",{href:this.makeImageUrl(t,i),rel:"noreferrer",target:"_blank"},a)]}_makeDate(e,t){const i=new Date(e).toDateString().split(" "),r=(i.length>3?t?[i[3]]:[i[1],i[2]+",",i[3]]:i).join(" ");return Sm.h("div.mapillary-attribution-date",{textContent:r},[])}}Am.componentName="attribution";class Im{constructor(){this._unprojectDepth=200}basicToCanvas(e,t,i,r,n){const a=r.unprojectBasic([e,t],this._unprojectDepth);return this.projectToCanvas(a,i,n)}basicToCanvasSafe(e,t,i,r,n){const a=this.basicToViewportSafe(e,t,r,n);if(null===a)return null;return this.viewportToCanvas(a[0],a[1],i)}basicToViewport(e,t,i,r){const n=i.unprojectBasic([e,t],this._unprojectDepth);return this.projectToViewport(n,r)}basicToViewportSafe(e,t,i,r){const n=i.unprojectBasic([e,t],this._unprojectDepth);if(this.worldToCamera(n,r)[2]>0)return null;return this.projectToViewport(n,r)}cameraToViewport(e,t){const i=(new xr).fromArray(e).applyMatrix4(t.projectionMatrix);return[i.x,i.y]}canvasPosition(e,t){const i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}canvasToBasic(e,t,i,r,n){const a=this.unprojectFromCanvas(e,t,i,n).toArray();return r.projectBasic(a)}canvasToViewport(e,t,i){const[r,n]=this.containerToCanvas(i);return[2*e/r-1,1-2*t/n]}containerToCanvas(e){return[e.offsetWidth,e.offsetHeight]}getBasicDistances(e,t){const i=this.viewportToBasic(-1,1,e,t),r=this.viewportToBasic(1,1,e,t),n=this.viewportToBasic(1,-1,e,t),a=this.viewportToBasic(-1,-1,e,t);let o=0,s=0,l=0,c=0;return i[1]<0&&r[1]<0&&(o=i[1]>r[1]?-i[1]:-r[1]),r[0]>1&&n[0]>1&&(s=r[0]<n[0]?r[0]-1:n[0]-1),n[1]>1&&a[1]>1&&(l=n[1]<a[1]?n[1]-1:a[1]-1),a[0]<0&&i[0]<0&&(c=a[0]>i[0]?-a[0]:-i[0]),[o,s,l,c]}getPixelDistances(e,t,i){const r=this.viewportToBasic(-1,1,t,i),n=this.viewportToBasic(1,1,t,i),a=this.viewportToBasic(1,-1,t,i),o=this.viewportToBasic(-1,-1,t,i);let s=0,l=0,c=0,u=0;const[h,p]=this.containerToCanvas(e);if(r[1]<0&&n[1]<0){const a=r[1]>n[1]?r[0]:n[0],o=this.basicToCanvas(a,0,e,t,i);s=o[1]>0?o[1]:0}if(n[0]>1&&a[0]>1){const r=n[0]<a[0]?n[1]:a[1],o=this.basicToCanvas(1,r,e,t,i);l=o[0]<h?h-o[0]:0}if(a[1]>1&&o[1]>1){const r=a[1]<o[1]?a[0]:o[0],n=this.basicToCanvas(r,1,e,t,i);c=n[1]<p?p-n[1]:0}if(o[0]<0&&r[0]<0){const n=o[0]>r[0]?o[1]:r[1],a=this.basicToCanvas(0,n,e,t,i);u=a[0]>0?a[0]:0}return[s,l,c,u]}insideElement(e,t){const i=t.getBoundingClientRect(),r=i.left+t.clientLeft,n=r+t.clientWidth,a=i.top+t.clientTop,o=a+t.clientHeight;return e.clientX>r&&e.clientX<n&&e.clientY>a&&e.clientY<o}projectToCanvas(e,t,i){const r=this.projectToViewport(e,i);return this.viewportToCanvas(r[0],r[1],t)}projectToCanvasSafe(e,t,i){if(this.worldToCamera(e,i)[2]>0)return null;const r=this.projectToViewport(e,i);return this.viewportToCanvas(r[0],r[1],t)}projectToViewport(e,t){const i=new xr(e[0],e[1],e[2]).project(t);return[i.x,i.y]}unprojectFromCanvas(e,t,i,r){const n=this.canvasToViewport(e,t,i);return this.unprojectFromViewport(n[0],n[1],r)}unprojectFromViewport(e,t,i){return new xr(e,t,1).unproject(i)}viewportToBasic(e,t,i,r){const n=new xr(e,t,1).unproject(r).toArray();return i.projectBasic(n)}viewportToCanvas(e,t,i){const[r,n]=this.containerToCanvas(i);return[r*(e+1)/2,-n*(t-1)/2]}worldToCamera(e,t){return new xr(e[0],e[1],e[2]).applyMatrix4(t.matrixWorldInverse).toArray()}}!function(e){e[e.Automatic=0]="Automatic",e[e.Large=1]="Large",e[e.Small=2]="Small"}(wm||(wm={}));class Pm extends Em{constructor(e,t,i){super(e,t,i),this._spatial=new Kh,this._viewportCoords=new Im,this._svgNamespace="http://www.w3.org/2000/svg",this._distinctThreshold=Math.PI/360,this._animationSpeed=.075}_activate(){const e=this._subscriptions,t=this._container.renderService.renderCamera$.pipe(tt((e=>{let t=this._spatial.degToRad(e.perspective.fov),i=e.perspective.aspect===Number.POSITIVE_INFINITY?Math.PI:2*Math.atan(e.perspective.aspect*Math.tan(.5*t));return[this._spatial.azimuthalToBearing(e.rotation.phi),i]})),Vt(((e,t)=>Math.abs(t[0]-e[0])<this._distinctThreshold&&Math.abs(t[1]-e[1])<this._distinctThreshold))),i=ut(this._navigator.stateService.currentState$.pipe(Vt(void 0,(e=>e.state.currentImage.id))),this._navigator.panService.panImages$).pipe(tt((([e,t])=>{const i=e.state.currentImage,r=e.state.currentTransform;if(Qh(i.cameraType))return[Math.PI,Math.PI];const n=this._computeProjectedPoints(r),a=this._spatial.degToRad(this._computeHorizontalFov(n));let o=a/2,s=a/2;for(const[l,,c]of t){const e=this._spatial.wrap(l.compassAngle-i.compassAngle,-180,180);e<0?o=this._spatial.degToRad(Math.abs(e))+c/2:s=this._spatial.degToRad(Math.abs(e))+c/2}return[o,s]})),Vt((([e,t],[i,r])=>Math.abs(i-e)<this._distinctThreshold&&Math.abs(r-t)<this._distinctThreshold))),r=ut(this._navigator.stateService.currentState$.pipe(Vt(void 0,(e=>e.state.currentImage.id))),this._container.renderService.bearing$).pipe(tt((([e,t])=>this._spatial.degToRad(e.state.currentImage.compassAngle-t)))),n=new he,a=n.pipe(ei(((e,t)=>t(e)),{alpha:0,curr:[0,0,0],prev:[0,0,0]}),tt((e=>{const t=ar.smootherstep(e.alpha,0,1),i=e.curr,r=e.prev;return[this._interpolate(r[0],i[0],t),this._interpolate(r[1],i[1],t)]})));e.push(i.pipe(tt((e=>t=>{const i=ar.smootherstep(t.alpha,0,1),r=t.curr,n=t.prev,a=[this._interpolate(n[0],r[0],i),this._interpolate(n[1],r[1],i)];return{alpha:0,curr:e.slice(),prev:a}}))).subscribe(n)),e.push(i.pipe(oi((()=>this._container.renderService.renderCameraFrame$.pipe(ri(1),ei((e=>e+this._animationSpeed),0),li((e=>e<=1+this._animationSpeed)),tt((e=>Math.min(e,1)))))),tt((e=>t=>({alpha:e,curr:t.curr.slice(),prev:t.prev.slice()})))).subscribe(n));const o=ut(r,a).pipe(tt((([e,t])=>[e,t[0],t[1]])));e.push(ut(t,o,this._configuration$,this._container.renderService.size$).pipe(tt((([[e,t],[i,r,n],a,o])=>{const s=this._createBackground(e),l=this._createFovIndicator(r,n,i),c=this._createNorth(e),u=this._createCircleSectorCompass(this._createCircleSector(Math.max(Math.PI/20,t),"#FFF")),h=a.size===wm.Small||a.size===wm.Automatic&&o.width<640?".mapillary-bearing-compact":"";return{name:this._name,vNode:Sm.h("div.mapillary-bearing-indicator-container"+h,{oncontextmenu:e=>{e.preventDefault()}},[s,l,c,u])}}))).subscribe(this._container.domRenderer.render$))}_deactivate(){this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{size:wm.Automatic}}_createFovIndicator(e,t,i){const r=this._createFovArc(e,t),n=Sm.h("g",{attributes:{transform:"translate(18,18)"},namespace:this._svgNamespace},[r]);return Sm.h("svg",{attributes:{viewBox:"0 0 36 36"},namespace:this._svgNamespace,style:{height:"36px",left:"2px",position:"absolute",top:"2px",transform:`rotateZ(${this._spatial.radToDeg(i)}deg)`,width:"36px"}},[n])}_createFovArc(e,t){const i=16.75,r=e+t;if(r>2*Math.PI-Math.PI/90)return Sm.h("circle",{attributes:{cx:"0",cy:"0","fill-opacity":"0",r:"16.75",stroke:"#FFF","stroke-width":"2.5"},namespace:this._svgNamespace},[]);let n=-Math.PI/2-e,a=n+r,o=i*Math.cos(n),s=i*Math.sin(n),l=i*Math.cos(a),c=i*Math.sin(a),u=`M ${o} ${s} A 16.75 16.75 0 ${r>=Math.PI?1:0} 1 ${l} ${c}`;return Sm.h("path",{attributes:{d:u,"fill-opacity":"0",stroke:"#FFF","stroke-width":"2.5"},namespace:this._svgNamespace},[])}_createCircleSectorCompass(e){let t=Sm.h("g",{attributes:{transform:"translate(1,1)"},namespace:this._svgNamespace},[e]);return Sm.h("svg",{attributes:{viewBox:"0 0 2 2"},namespace:this._svgNamespace,style:{height:"26px",left:"7px",position:"absolute",top:"7px",width:"26px"}},[t])}_createCircleSector(e,t){if(e>2*Math.PI-Math.PI/90)return Sm.h("circle",{attributes:{cx:"0",cy:"0",fill:t,r:"1"},namespace:this._svgNamespace},[]);let i=-Math.PI/2-e/2,r=i+e,n=Math.cos(i),a=Math.sin(i),o=Math.cos(r),s=Math.sin(r),l=`M 0 0 ${n} ${a} A 1 1 0 ${e>=Math.PI?1:0} 1 ${o} ${s}`;return Sm.h("path",{attributes:{d:l,fill:t},namespace:this._svgNamespace},[])}_createNorth(e){const t=Sm.h("div.mapillary-bearing-north",[]);return Sm.h("div.mapillary-bearing-north-container",{style:{transform:`rotateZ(${this._spatial.radToDeg(-e)}deg)`}},[t])}_createBackground(e){return Sm.h("div.mapillary-bearing-indicator-background",{style:{transform:`rotateZ(${this._spatial.radToDeg(-e)}deg)`}},[Sm.h("div.mapillary-bearing-indicator-background-circle",[]),Sm.h("div.mapillary-bearing-indicator-background-arrow-container",[Sm.h("div.mapillary-bearing-indicator-background-arrow",[])])])}_computeProjectedPoints(e){return ip(e,[[1,0]],[[0,.5]],12,this._viewportCoords)}_computeHorizontalFov(e){const t=e.map((e=>this._coordToFov(e[0])));return Math.min(...t)}_coordToFov(e){return this._spatial.radToDeg(2*Math.atan(e))}_interpolate(e,t,i){return(1-i)*e+i*t}}Pm.componentName="bearing";class zm extends Em{constructor(e,t,i){super(e,t,i)}_activate(){const e=this._subscriptions;e.push(ut(this._navigator.stateService.currentImage$.pipe(oi((e=>e.sequenceEdges$)),Ct((e=>e.cached))),this._configuration$).pipe(oi((e=>{let t=e[0],i=e[1],r=Math.max(0,Math.min(4,i.depth.sequence));return Mt(this._cache$(t.edges,Hh.Next,r),this._cache$(t.edges,Hh.Prev,r)).pipe(zt((e=>(console.error("Failed to cache sequence edges.",e),Me()))))}))).subscribe((()=>{}))),e.push(ut(this._navigator.stateService.currentImage$.pipe(oi((e=>ut(Ze(e),e.spatialEdges$.pipe(Ct((e=>e.cached))))))),this._configuration$).pipe(oi((([[e,t],i])=>{let r=t.edges,n=i.depth,a=Math.max(0,Math.min(2,n.spherical)),o=Qh(e.cameraType)?0:Math.max(0,Math.min(3,n.step)),s=Qh(e.cameraType)?0:Math.max(0,Math.min(1,n.turn)),l=this._cache$(r,Hh.Spherical,a);return Mt(this._cache$(r,Hh.StepForward,o),this._cache$(r,Hh.StepBackward,o),this._cache$(r,Hh.StepLeft,o),this._cache$(r,Hh.StepRight,o),l,this._cache$(r,Hh.TurnLeft,s),this._cache$(r,Hh.TurnRight,s),this._cache$(r,Hh.TurnU,s)).pipe(zt((e=>(console.error("Failed to cache spatial edges.",e),Me()))))}))).subscribe((()=>{})))}_deactivate(){this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{depth:{spherical:1,sequence:2,step:1,turn:0}}}_cache$(e,t,i){return At(Ze(e),Ze(i)).pipe(qt((e=>{let i=e[0],r=e[1],n=[];if(r>0)for(let a of i)a.data.direction===t&&n.push(At(this._navigator.graphService.cacheImage$(a.target).pipe(ft((e=>this._imageToEdges$(e,t)))),Ze(r-1)));return Oe(n).pipe(mt())})),ri(1))}_imageToEdges$(e,t){return([Hh.Next,Hh.Prev].indexOf(t)>-1?e.sequenceEdges$:e.spatialEdges$).pipe(Ht((e=>e.cached)),tt((e=>e.edges)))}}zm.componentName="cache";class Rm extends Xh{constructor(e){super(null!=e?e:"The request was cancelled."),Object.setPrototypeOf(this,Rm.prototype),this.name="CancelMapillaryError"}}class km{constructor(e,t){this._spatial=new Kh,this._minThresholdWidth=320,this._maxThresholdWidth=1480,this._minThresholdHeight=240,this._maxThresholdHeight=820,this._configure(e),this._resize(t),this._reset()}get minWidth(){return this._minWidth}get maxWidth(){return this._maxWidth}get containerWidth(){return this._containerWidth}get containerWidthCss(){return this._containerWidthCss}get containerMarginCss(){return this._containerMarginCss}get containerLeftCss(){return this._containerLeftCss}get containerHeight(){return this._containerHeight}get containerHeightCss(){return this._containerHeightCss}get containerBottomCss(){return this._containerBottomCss}get stepCircleSize(){return this._stepCircleSize}get stepCircleSizeCss(){return this._stepCircleSizeCss}get stepCircleMarginCss(){return this._stepCircleMarginCss}get turnCircleSize(){return this._turnCircleSize}get turnCircleSizeCss(){return this._turnCircleSizeCss}get outerRadius(){return this._outerRadius}get innerRadius(){return this._innerRadius}get shadowOffset(){return this._shadowOffset}configure(e){this._configure(e),this._reset()}resize(e){this._resize(e),this._reset()}angleToCoordinates(e){return[Math.cos(e),Math.sin(e)]}relativeAngleToCoordiantes(e,t){let i=this._spatial.wrapAngle(e-t);return this.angleToCoordinates(i)}_configure(e){this._minWidth=e.minWidth,this._maxWidth=this._getMaxWidth(e.minWidth,e.maxWidth)}_resize(e){this._elementWidth=e.width,this._elementHeight=e.height}_reset(){this._containerWidth=this._getContainerWidth(this._elementWidth,this._elementHeight),this._containerHeight=this._getContainerHeight(this.containerWidth),this._stepCircleSize=this._getStepCircleDiameter(this._containerHeight),this._turnCircleSize=this._getTurnCircleDiameter(this.containerHeight),this._outerRadius=this._getOuterRadius(this._containerHeight),this._innerRadius=this._getInnerRadius(this._containerHeight),this._shadowOffset=3,this._containerWidthCss=this._numberToCssPixels(this._containerWidth),this._containerMarginCss=this._numberToCssPixels(-.5*this._containerWidth),this._containerLeftCss=this._numberToCssPixels(Math.floor(.5*this._elementWidth)),this._containerHeightCss=this._numberToCssPixels(this._containerHeight),this._containerBottomCss=this._numberToCssPixels(Math.floor(-.08*this._containerHeight)),this._stepCircleSizeCss=this._numberToCssPixels(this._stepCircleSize),this._stepCircleMarginCss=this._numberToCssPixels(-.5*this._stepCircleSize),this._turnCircleSizeCss=this._numberToCssPixels(this._turnCircleSize)}_getContainerWidth(e,t){let i=(e-this._minThresholdWidth)/(this._maxThresholdWidth-this._minThresholdWidth),r=(t-this._minThresholdHeight)/(this._maxThresholdHeight-this._minThresholdHeight),n=Math.max(0,Math.min(1,Math.min(i,r)));return n=.04*Math.round(25*n),this._minWidth+n*(this._maxWidth-this._minWidth)}_getContainerHeight(e){return.77*e}_getStepCircleDiameter(e){return.34*e}_getTurnCircleDiameter(e){return.3*e}_getOuterRadius(e){return.31*e}_getInnerRadius(e){return.125*e}_numberToCssPixels(e){return e+"px"}_getMaxWidth(e,t){return e>t?e:t}}class Lm{constructor(e,t){this._isEdge=!1,this._spatial=new Kh,this._calculator=new km(e,t),this._image=null,this._rotation={phi:0,theta:0},this._epsilon=.5*Math.PI/180,this._highlightKey=null,this._distinguishSequence=!1,this._needsRender=!1,this._stepEdges=[],this._turnEdges=[],this._sphericalEdges=[],this._sequenceEdgeKeys=[],this._stepDirections=[Hh.StepForward,Hh.StepBackward,Hh.StepLeft,Hh.StepRight],this._turnDirections=[Hh.TurnLeft,Hh.TurnRight,Hh.TurnU],this._turnNames={},this._turnNames[Hh.TurnLeft]="mapillary-direction-turn-left",this._turnNames[Hh.TurnRight]="mapillary-direction-turn-right",this._turnNames[Hh.TurnU]="mapillary-direction-turn-around";let i=!!document.documentMode;this._isEdge=!i&&!!window.StyleMedia}get needsRender(){return this._needsRender}render(e){this._needsRender=!1;let t=this._rotation,i=[],r=[];return Qh(this._image.cameraType)?i=i.concat(this._createSphericalArrows(e,t)):(i=i.concat(this._createPerspectiveToSphericalArrows(e,t)),i=i.concat(this._createStepArrows(e,t)),r=r.concat(this._createTurnArrows(e))),this._getContainer(i,r,t)}setEdges(e,t){this._setEdges(e,t),this._setNeedsRender()}setImage(e){this._image=e,this._clearEdges(),this._setNeedsRender()}setRenderCamera(e){let t=e.rotation;Math.abs(t.phi-this._rotation.phi)<this._epsilon||(this._rotation=t,this._setNeedsRender())}setConfiguration(e){let t=!1;this._highlightKey===e.highlightId&&this._distinguishSequence===e.distinguishSequence||(this._highlightKey=e.highlightId,this._distinguishSequence=e.distinguishSequence,t=!0),this._calculator.minWidth===e.minWidth&&this._calculator.maxWidth===e.maxWidth||(this._calculator.configure(e),t=!0),t&&this._setNeedsRender()}resize(e){this._calculator.resize(e),this._setNeedsRender()}_setNeedsRender(){null!=this._image&&(this._needsRender=!0)}_clearEdges(){this._stepEdges=[],this._turnEdges=[],this._sphericalEdges=[],this._sequenceEdgeKeys=[]}_setEdges(e,t){this._stepEdges=[],this._turnEdges=[],this._sphericalEdges=[],this._sequenceEdgeKeys=[];for(let i of e.edges){let e=i.data.direction;this._stepDirections.indexOf(e)>-1?this._stepEdges.push(i):this._turnDirections.indexOf(e)>-1?this._turnEdges.push(i):i.data.direction===Hh.Spherical&&this._sphericalEdges.push(i)}if(this._distinguishSequence&&null!=t){let e=this._sphericalEdges.concat(this._stepEdges).concat(this._turnEdges);for(let i of e){let e=i.target;for(let i of t.imageIds)if(i===e){this._sequenceEdgeKeys.push(e);break}}}}_createSphericalArrows(e,t){let i=[];for(let r of this._sphericalEdges)i.push(this._createVNodeByKey(e,r.target,r.data.worldMotionAzimuth,t,this._calculator.outerRadius,"mapillary-direction-arrow-spherical"));for(let r of this._stepEdges)i.push(this._createSphericalToPerspectiveArrow(e,r.target,r.data.worldMotionAzimuth,t,r.data.direction));return i}_createSphericalToPerspectiveArrow(e,t,i,r,n){let a=Math.PI/8,o=r.phi;switch(n){case Hh.StepBackward:o=r.phi-Math.PI;break;case Hh.StepLeft:o=r.phi+Math.PI/2;break;case Hh.StepRight:o=r.phi-Math.PI/2}return Math.abs(this._spatial.wrapAngle(i-o))<a?this._createVNodeByKey(e,t,i,r,this._calculator.outerRadius,"mapillary-direction-arrow-step"):this._createVNodeInactive(t,i,r)}_createPerspectiveToSphericalArrows(e,t){let i=[];for(let r of this._sphericalEdges)i.push(this._createVNodeByKey(e,r.target,r.data.worldMotionAzimuth,t,this._calculator.innerRadius,"mapillary-direction-arrow-spherical",!0));return i}_createStepArrows(e,t){let i=[];for(let r of this._stepEdges)i.push(this._createVNodeByDirection(e,r.target,r.data.worldMotionAzimuth,t,r.data.direction));return i}_createTurnArrows(e){let t=[];for(let i of this._turnEdges){let r=i.data.direction,n=this._turnNames[r];t.push(this._createVNodeByTurn(e,i.target,n,r))}return t}_createVNodeByKey(e,t,i,r,n,a,o){return this._createVNode(t,i,r,n,a,"mapillary-direction-circle",(i=>{e.moveTo$(t).subscribe(void 0,(e=>{e instanceof Rm||console.error(e)}))}),o)}_createVNodeByDirection(e,t,i,r,n){return this._createVNode(t,i,r,this._calculator.outerRadius,"mapillary-direction-arrow-step","mapillary-direction-circle",(t=>{e.moveDir$(n).subscribe(void 0,(e=>{e instanceof Rm||console.error(e)}))}))}_createVNodeByTurn(e,t,i,r){let n={height:this._calculator.turnCircleSizeCss,transform:"rotate(0)",width:this._calculator.turnCircleSizeCss};switch(r){case Hh.TurnLeft:n.left="5px",n.top="5px";break;case Hh.TurnRight:n.right="5px",n.top="5px";break;case Hh.TurnU:n.left="5px",n.bottom="5px"}let a={attributes:{"data-id":t},onclick:t=>{e.moveDir$(r).subscribe(void 0,(e=>{e instanceof Rm||console.error(e)}))},style:n},o="mapillary-direction-turn-circle";this._sequenceEdgeKeys.indexOf(t)>-1&&(o+="-sequence"),this._highlightKey===t&&(o+="-highlight");let s=Sm.h(`div.${i}`,{},[]);return Sm.h("div."+o,a,[s])}_createVNodeInactive(e,t,i){return this._createVNode(e,t,i,this._calculator.outerRadius,"mapillary-direction-arrow-inactive","mapillary-direction-circle-inactive")}_createVNode(e,t,i,r,n,a,o,s){let l=this._calculator.angleToCoordinates(t-i.phi),c=Math.round(-r*l[1]+.5*this._calculator.containerWidth),u=Math.round(-r*l[0]+.5*this._calculator.containerHeight),h=this._calculator.relativeAngleToCoordiantes(t,i.phi),p=this._calculator.shadowOffset,d=`drop-shadow(${-p*h[1]}px ${p*h[0]}px 1px rgba(0,0,0,0.8))`,f={style:{"-webkit-filter":d,filter:d}},m=Sm.h("div."+n,f,[]),g=-this._spatial.radToDeg(t-i.phi),_=s?`translate(${c}px, ${u}px) rotate(${g}deg) translateZ(-0.01px)`:`translate(${c}px, ${u}px) rotate(${g}deg)`,y={attributes:{"data-id":e},onclick:o,style:{height:this._calculator.stepCircleSizeCss,marginLeft:this._calculator.stepCircleMarginCss,marginTop:this._calculator.stepCircleMarginCss,transform:_,width:this._calculator.stepCircleSizeCss}};return this._sequenceEdgeKeys.indexOf(e)>-1&&(a+="-sequence"),this._highlightKey===e&&(a+="-highlight"),Sm.h("div."+a,y,[m])}_getContainer(e,t,i){let r=this._isEdge?"rotateX(60deg)":`perspective(${this._calculator.containerWidthCss}) rotateX(60deg)`,n={oncontextmenu:e=>{e.preventDefault()},style:{bottom:this._calculator.containerBottomCss,height:this._calculator.containerHeightCss,left:this._calculator.containerLeftCss,marginLeft:this._calculator.containerMarginCss,transform:r,width:this._calculator.containerWidthCss}};return Sm.h("div.mapillary-direction-perspective",n,t.concat(e))}}class Dm extends Em{constructor(e,t,i,r){super(e,t,i),this._renderer=r||new Lm(this.defaultConfiguration,{height:t.container.offsetHeight,width:t.container.offsetWidth}),this._hoveredIdSubject$=new he,this._hoveredId$=this._hoveredIdSubject$.pipe(ti())}fire(e,t){super.fire(e,t)}off(e,t){super.off(e,t)}on(e,t){super.on(e,t)}_activate(){const e=this._subscriptions;e.push(this._configuration$.subscribe((e=>{this._renderer.setConfiguration(e)}))),e.push(this._container.renderService.size$.subscribe((e=>{this._renderer.resize(e)}))),e.push(this._navigator.stateService.currentImage$.pipe(ci((e=>{this._container.domRenderer.render$.next({name:this._name,vNode:Sm.h("div",{},[])}),this._renderer.setImage(e)})),ui(this._configuration$),oi((([e,t])=>ut(e.spatialEdges$,t.distinguishSequence?this._navigator.graphService.cacheSequence$(e.sequenceId).pipe(zt((t=>(console.error(`Failed to cache sequence (${e.sequenceId})`,t),Ze(null))))):Ze(null))))).subscribe((([e,t])=>{this._renderer.setEdges(e,t)}))),e.push(this._container.renderService.renderCameraFrame$.pipe(ci((e=>{this._renderer.setRenderCamera(e)})),tt((()=>this._renderer)),Ct((e=>e.needsRender)),tt((e=>({name:this._name,vNode:e.render(this._navigator)})))).subscribe(this._container.domRenderer.render$)),e.push(ut(this._container.domRenderer.element$,this._container.renderService.renderCamera$,this._container.mouseService.mouseMove$.pipe(ai(null)),this._container.mouseService.mouseUp$.pipe(ai(null))).pipe(tt((([e])=>{let t=e.getElementsByClassName("mapillary-direction-perspective");for(let i=0;i<t.length;i++){let e=t.item(i).querySelector(":hover");if(null!=e&&e.hasAttribute("data-id"))return e.getAttribute("data-id")}return null})),Vt()).subscribe(this._hoveredIdSubject$)),e.push(this._hoveredId$.subscribe((e=>{const t="hover",i={id:e,target:this,type:t};this.fire(t,i)})))}_deactivate(){this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{distinguishSequence:!1,maxWidth:460,minWidth:260}}}Dm.componentName="direction";class Bm{}Bm.fisheye={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float focal;\nuniform float k1;\nuniform float k2;\nuniform float scale_x;\nuniform float scale_y;\nuniform float radial_peak;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float x = vRstq.x;\n    float y = vRstq.y;\n    float z = vRstq.z;\n\n    float r = sqrt(x * x + y * y);\n    float theta = atan(r, z);\n\n    if (radial_peak > 0. && theta > radial_peak) {\n        theta = radial_peak;\n    }\n\n    float theta2 = theta * theta;\n    float theta_d = theta * (1.0 + theta2 * (k1 + theta2 * k2));\n    float s = focal * theta_d / r;\n\n    float u = scale_x * s * x + 0.5;\n    float v = -scale_y * s * y + 0.5;\n\n    vec4 baseColor;\n    if (u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},Bm.fisheyeCurtain={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float focal;\nuniform float k1;\nuniform float k2;\nuniform float scale_x;\nuniform float scale_y;\nuniform float radial_peak;\nuniform float curtain;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float x = vRstq.x;\n    float y = vRstq.y;\n    float z = vRstq.z;\n\n    float r2 = sqrt(x * x + y * y);\n    float theta = atan(r2, z);\n\n    if (radial_peak > 0. && theta > radial_peak) {\n        theta = radial_peak;\n    }\n\n    float theta2 = theta * theta;\n    float theta_d = theta * (1.0 + theta2 * (k1 + theta2 * k2));\n    float s = focal * theta_d / r2;\n\n    float u = scale_x * s * x + 0.5;\n    float v = -scale_y * s * y + 0.5;\n\n    vec4 baseColor;\n    if ((u < curtain || curtain >= 1.0) && u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},Bm.perspective={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float focal;\nuniform float k1;\nuniform float k2;\nuniform float scale_x;\nuniform float scale_y;\nuniform float radial_peak;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float x = vRstq.x / vRstq.z;\n    float y = vRstq.y / vRstq.z;\n    float r2 = x * x + y * y;\n\n    if (radial_peak > 0. && r2 > radial_peak * sqrt(r2)) {\n        r2 = radial_peak * radial_peak;\n    }\n\n    float d = 1.0 + k1 * r2 + k2 * r2 * r2;\n    float u = scale_x * focal * d * x + 0.5;\n    float v = - scale_y * focal * d * y + 0.5;\n\n    vec4 baseColor;\n    if (u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},Bm.perspectiveCurtain={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float focal;\nuniform float k1;\nuniform float k2;\nuniform float scale_x;\nuniform float scale_y;\nuniform float radial_peak;\nuniform float curtain;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float x = vRstq.x / vRstq.z;\n    float y = vRstq.y / vRstq.z;\n    float r2 = x * x + y * y;\n\n    if (radial_peak > 0. && r2 > radial_peak * sqrt(r2)) {\n        r2 = radial_peak * radial_peak;\n    }\n\n    float d = 1.0 + k1 * r2 + k2 * r2 * r2;\n    float u = scale_x * focal * d * x + 0.5;\n    float v = - scale_y * focal * d * y + 0.5;\n\n    vec4 baseColor;\n    if ((u < curtain || curtain >= 1.0) && u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},Bm.perspectiveDistorted={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float u = vRstq.x / vRstq.w;\n    float v = vRstq.y / vRstq.w;\n\n    vec4 baseColor;\n    if (u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},Bm.perspectiveDistortedCurtain={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float curtain;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float u = vRstq.x / vRstq.w;\n    float v = vRstq.y / vRstq.w;\n\n    vec4 baseColor;\n    if ((u < curtain || curtain >= 1.0) && u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},Bm.spherical={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#define tau 6.28318530718\n\nuniform sampler2D projectorTex;\nuniform float opacity;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vec3 b = normalize(vRstq.xyz);\n    float lat = -asin(b.y);\n    float lng = atan(b.x, b.z);\n    float x = lng / tau + 0.5;\n    float y = lat / tau * 2.0 + 0.5;\n    vec4 baseColor = texture2D(projectorTex, vec2(x, y));\n    baseColor.a = opacity;\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},Bm.sphericalCurtain={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#define tau 6.28318530718\n\nuniform sampler2D projectorTex;\nuniform float curtain;\nuniform float opacity;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vec3 b = normalize(vRstq.xyz);\n    float lat = -asin(b.y);\n    float lng = atan(b.x, b.z);\n    float x = lng / tau + 0.5;\n    float y = lat / tau * 2.0 + 0.5;\n\n    bool inverted = curtain < 0.5;\n\n    float curtainMin = inverted ? curtain + 0.5 : curtain - 0.5;\n    float curtainMax = curtain;\n\n    bool insideCurtain = inverted ?\n        x > curtainMin || x < curtainMax :\n        x > curtainMin && x < curtainMax;\n\n    vec4 baseColor;\n    if (insideCurtain) {\n        baseColor = texture2D(projectorTex, vec2(x, y));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"};class Fm{constructor(e,t){this._imagePlaneDepth=null!=e?e:200,this._imageSphereRadius=null!=t?t:200}createMesh(e,t){return Qh(t.cameraType)?this._createImageSphere(e,t):ep(t.cameraType)?this._createImagePlaneFisheye(e,t):this._createImagePlane(e,t)}createFlatMesh(e,t,i,r,n,a){let o=this._createTexture(e.image),s=this._createDistortedPlaneMaterialParameters(t,o),l=new Aa(s),c=this._getFlatImagePlaneGeoFromBasic(t,i,r,n,a);return new wa(c,l)}createCurtainMesh(e,t){return Qh(t.cameraType)?this._createSphereCurtainMesh(e,t):ep(t.cameraType)?this._createCurtainMeshFisheye(e,t):this._createCurtainMesh(e,t)}createDistortedCurtainMesh(e,t){return this._createDistortedCurtainMesh(e,t)}_createCurtainMesh(e,t){let i=this._createTexture(e.image),r=this._createCurtainPlaneMaterialParameters(t,i),n=new Aa(r),a=this._useMesh(t,e)?this._getImagePlaneGeo(t,e):this._getRegularFlatImagePlaneGeo(t);return new wa(a,n)}_createCurtainMeshFisheye(e,t){let i=this._createTexture(e.image),r=this._createCurtainPlaneMaterialParametersFisheye(t,i),n=new Aa(r),a=this._useMesh(t,e)?this._getImagePlaneGeoFisheye(t,e):this._getRegularFlatImagePlaneGeo(t);return new wa(a,n)}_createDistortedCurtainMesh(e,t){let i=this._createTexture(e.image),r=this._createDistortedCurtainPlaneMaterialParameters(t,i),n=new Aa(r),a=this._getRegularFlatImagePlaneGeo(t);return new wa(a,n)}_createSphereCurtainMesh(e,t){let i=this._createTexture(e.image),r=this._createCurtainSphereMaterialParameters(t,i),n=new Aa(r);return this._useMesh(t,e)?new wa(this._getImageSphereGeo(t,e),n):new wa(this._getFlatImageSphereGeo(t),n)}_createImageSphere(e,t){let i=this._createTexture(e.image),r=this._createSphereMaterialParameters(t,i),n=new Aa(r);return this._useMesh(t,e)?new wa(this._getImageSphereGeo(t,e),n):new wa(this._getFlatImageSphereGeo(t),n)}_createImagePlane(e,t){let i=this._createTexture(e.image),r=this._createPlaneMaterialParameters(t,i),n=new Aa(r),a=this._useMesh(t,e)?this._getImagePlaneGeo(t,e):this._getRegularFlatImagePlaneGeo(t);return new wa(a,n)}_createImagePlaneFisheye(e,t){let i=this._createTexture(e.image),r=this._createPlaneMaterialParametersFisheye(t,i),n=new Aa(r),a=this._useMesh(t,e)?this._getImagePlaneGeoFisheye(t,e):this._getRegularFlatImagePlaneGeoFisheye(t);return new wa(a,n)}_createSphereMaterialParameters(e,t){return{depthWrite:!1,fragmentShader:Bm.spherical.fragment,side:2,transparent:!0,uniforms:{opacity:{value:1},projectorMat:{value:e.rt},projectorTex:{value:t}},vertexShader:Bm.spherical.vertex}}_createCurtainSphereMaterialParameters(e,t){return{depthWrite:!1,fragmentShader:Bm.sphericalCurtain.fragment,side:2,transparent:!0,uniforms:{curtain:{value:1},opacity:{value:1},projectorMat:{value:e.rt},projectorTex:{value:t}},vertexShader:Bm.sphericalCurtain.vertex}}_createPlaneMaterialParameters(e,t){return{depthWrite:!1,fragmentShader:Bm.perspective.fragment,side:2,transparent:!0,uniforms:{focal:{value:e.focal},k1:{value:e.ck1},k2:{value:e.ck2},opacity:{value:1},projectorMat:{value:e.basicRt},projectorTex:{value:t},radial_peak:{value:e.radialPeak?e.radialPeak:0},scale_x:{value:Math.max(e.basicHeight,e.basicWidth)/e.basicWidth},scale_y:{value:Math.max(e.basicWidth,e.basicHeight)/e.basicHeight}},vertexShader:Bm.perspective.vertex}}_createPlaneMaterialParametersFisheye(e,t){return{depthWrite:!1,fragmentShader:Bm.fisheye.fragment,side:2,transparent:!0,uniforms:{focal:{value:e.focal},k1:{value:e.ck1},k2:{value:e.ck2},opacity:{value:1},projectorMat:{value:e.basicRt},projectorTex:{value:t},radial_peak:{value:e.radialPeak?e.radialPeak:0},scale_x:{value:Math.max(e.basicHeight,e.basicWidth)/e.basicWidth},scale_y:{value:Math.max(e.basicWidth,e.basicHeight)/e.basicHeight}},vertexShader:Bm.fisheye.vertex}}_createCurtainPlaneMaterialParametersFisheye(e,t){return{depthWrite:!1,fragmentShader:Bm.fisheyeCurtain.fragment,side:2,transparent:!0,uniforms:{curtain:{value:1},focal:{value:e.focal},k1:{value:e.ck1},k2:{value:e.ck2},opacity:{value:1},projectorMat:{value:e.basicRt},projectorTex:{value:t},radial_peak:{value:e.radialPeak?e.radialPeak:0},scale_x:{value:Math.max(e.basicHeight,e.basicWidth)/e.basicWidth},scale_y:{value:Math.max(e.basicWidth,e.basicHeight)/e.basicHeight}},vertexShader:Bm.fisheyeCurtain.vertex}}_createCurtainPlaneMaterialParameters(e,t){return{depthWrite:!1,fragmentShader:Bm.perspectiveCurtain.fragment,side:2,transparent:!0,uniforms:{curtain:{value:1},focal:{value:e.focal},k1:{value:e.ck1},k2:{value:e.ck2},opacity:{value:1},projectorMat:{value:e.basicRt},projectorTex:{value:t},radial_peak:{value:e.radialPeak?e.radialPeak:0},scale_x:{value:Math.max(e.basicHeight,e.basicWidth)/e.basicWidth},scale_y:{value:Math.max(e.basicWidth,e.basicHeight)/e.basicHeight}},vertexShader:Bm.perspectiveCurtain.vertex}}_createDistortedCurtainPlaneMaterialParameters(e,t){return{depthWrite:!1,fragmentShader:Bm.perspectiveDistortedCurtain.fragment,side:2,transparent:!0,uniforms:{curtain:{value:1},opacity:{value:1},projectorMat:{value:e.projectorMatrix()},projectorTex:{value:t}},vertexShader:Bm.perspectiveDistortedCurtain.vertex}}_createDistortedPlaneMaterialParameters(e,t){return{depthWrite:!1,fragmentShader:Bm.perspectiveDistorted.fragment,side:2,transparent:!0,uniforms:{opacity:{value:1},projectorMat:{value:e.projectorMatrix()},projectorTex:{value:t}},vertexShader:Bm.perspectiveDistorted.vertex}}_createTexture(e){let t=new fr(e);return t.minFilter=xi,t.needsUpdate=!0,t}_useMesh(e,t){return t.mesh.vertices.length&&e.hasValidScale}_getImageSphereGeo(e,t){const i=e.srtInverse;let r=5*e.scale,n=this._imageSphereRadius*e.scale,a=t.mesh.vertices,o=a.length/3,s=new Float32Array(a.length);for(let h=0;h<o;++h){let e=3*h,t=a[e+0],o=a[e+1],l=a[e+2],c=Math.sqrt(t*t+o*o+l*l),u=Math.max(r,Math.min(c,n))/c,p=new xr(t*u,o*u,l*u);p.applyMatrix4(i),s[e+0]=p.x,s[e+1]=p.y,s[e+2]=p.z}let l=t.mesh.faces,c=new Uint16Array(l.length);for(let h=0;h<l.length;++h)c[h]=l[h];let u=new na;return u.setAttribute("position",new Wn(s,3)),u.setIndex(new Wn(c,1)),u}_getImagePlaneGeo(e,t){const i=e.srtInverse;let r=5*e.scale,n=this._imagePlaneDepth*e.scale,a=t.mesh.vertices,o=a.length/3,s=new Float32Array(a.length);for(let h=0;h<o;++h){let e=3*h,t=a[e+0],o=a[e+1],l=a[e+2];h<4&&(t*=3,o*=3);let c=Math.max(r,Math.min(l,n)),u=c/l,p=new xr(t*u,o*u,c);p.applyMatrix4(i),s[e+0]=p.x,s[e+1]=p.y,s[e+2]=p.z}let l=t.mesh.faces,c=new Uint16Array(l.length);for(let h=0;h<l.length;++h)c[h]=l[h];let u=new na;return u.setAttribute("position",new Wn(s,3)),u.setIndex(new Wn(c,1)),u}_getImagePlaneGeoFisheye(e,t){const i=e.srtInverse;let r=5*e.scale,n=this._imagePlaneDepth*e.scale,a=t.mesh.vertices,o=a.length/3,s=new Float32Array(a.length);for(let h=0;h<o;++h){let e=3*h,t=a[e+0],o=a[e+1],l=a[e+2],c=Math.sqrt(t*t+o*o+l*l),u=Math.max(r,Math.min(c,n))/c,p=new xr(t*u,o*u,l*u);p.applyMatrix4(i),s[e+0]=p.x,s[e+1]=p.y,s[e+2]=p.z}let l=t.mesh.faces,c=new Uint16Array(l.length);for(let h=0;h<l.length;++h)c[h]=l[h];let u=new na;return u.setAttribute("position",new Wn(s,3)),u.setIndex(new Wn(c,1)),u}_getFlatImageSphereGeo(e){const t=new Mu(this._imageSphereRadius,20,40),i=e.rt.clone().invert();return t.applyMatrix4(i),t}_getRegularFlatImagePlaneGeo(e){let t=e.width,i=e.height,r=Math.max(t,i),n=t/2/r,a=i/2/r;return this._getFlatImagePlaneGeo(e,n,a)}_getFlatImagePlaneGeo(e,t,i){let r=[];return r.push(e.unprojectSfM([-t,-i],this._imagePlaneDepth)),r.push(e.unprojectSfM([t,-i],this._imagePlaneDepth)),r.push(e.unprojectSfM([t,i],this._imagePlaneDepth)),r.push(e.unprojectSfM([-t,i],this._imagePlaneDepth)),this._createFlatGeometry(r)}_getRegularFlatImagePlaneGeoFisheye(e){let t=e.width,i=e.height,r=Math.max(t,i),n=t/2/r,a=i/2/r;return this._getFlatImagePlaneGeoFisheye(e,n,a)}_getFlatImagePlaneGeoFisheye(e,t,i){let r=[];return r.push(e.unprojectSfM([-t,-i],this._imagePlaneDepth)),r.push(e.unprojectSfM([t,-i],this._imagePlaneDepth)),r.push(e.unprojectSfM([t,i],this._imagePlaneDepth)),r.push(e.unprojectSfM([-t,i],this._imagePlaneDepth)),this._createFlatGeometry(r)}_getFlatImagePlaneGeoFromBasic(e,t,i,r,n){let a=[];return a.push(e.unprojectBasic([t,r],this._imagePlaneDepth)),a.push(e.unprojectBasic([i,r],this._imagePlaneDepth)),a.push(e.unprojectBasic([i,n],this._imagePlaneDepth)),a.push(e.unprojectBasic([t,n],this._imagePlaneDepth)),this._createFlatGeometry(a)}_createFlatGeometry(e){let t=new Float32Array(12);for(let n=0;n<e.length;n++){let i=3*n;t[i+0]=e[n][0],t[i+1]=e[n][1],t[i+2]=e[n][2]}let i=new Uint16Array(6);i[0]=0,i[1]=1,i[2]=3,i[3]=1,i[4]=2,i[5]=3;let r=new na;return r.setAttribute("position",new Wn(t,3)),r.setIndex(new Wn(i,1)),r}}class Om{constructor(){this._planes={},this._planesOld={},this._planesPeriphery={},this._scene=new zl,this._sceneOld=new zl,this._scenePeriphery=new zl}get planes(){return this._planes}get planesOld(){return this._planesOld}get planesPeriphery(){return this._planesPeriphery}get scene(){return this._scene}get sceneOld(){return this._sceneOld}get scenePeriphery(){return this._scenePeriphery}updateImagePlanes(e){this._dispose(this._planesOld,this.sceneOld);for(const t in this._planes){if(!this._planes.hasOwnProperty(t))continue;const e=this._planes[t];this._scene.remove(e),this._sceneOld.add(e)}for(const t in e)e.hasOwnProperty(t)&&this._scene.add(e[t]);this._planesOld=this._planes,this._planes=e}addImagePlanes(e){for(const t in e){if(!e.hasOwnProperty(t))continue;const i=e[t];this._scene.add(i),this._planes[t]=i}}addImagePlanesOld(e){for(const t in e){if(!e.hasOwnProperty(t))continue;const i=e[t];this._sceneOld.add(i),this._planesOld[t]=i}}setImagePlanes(e){this._clear(),this.addImagePlanes(e)}addPeripheryPlanes(e){for(const t in e){if(!e.hasOwnProperty(t))continue;const i=e[t];this._scenePeriphery.add(i),this._planesPeriphery[t]=i}}setPeripheryPlanes(e){this._clearPeriphery(),this.addPeripheryPlanes(e)}setImagePlanesOld(e){this._clearOld(),this.addImagePlanesOld(e)}clear(){this._clear(),this._clearOld()}_clear(){this._dispose(this._planes,this._scene),this._planes={}}_clearOld(){this._dispose(this._planesOld,this._sceneOld),this._planesOld={}}_clearPeriphery(){this._dispose(this._planesPeriphery,this._scenePeriphery),this._planesPeriphery={}}_dispose(e,t){for(const i in e){if(!e.hasOwnProperty(i))continue;const r=e[i];t.remove(r),r.geometry.dispose(),r.material.dispose();let n=r.material.uniforms.projectorTex.value;null!=n&&n.dispose()}}}class Nm{constructor(){this._factory=new Fm,this._scene=new Om,this._alpha=0,this._alphaOld=0,this._fadeOutSpeed=.05,this._currentKey=null,this._previousKey=null,this._providerDisposers={},this._frameId=0,this._needsRender=!1}get frameId(){return this._frameId}get needsRender(){return this._needsRender}indicateNeedsRender(){this._needsRender=!0}addPeripheryPlane(e,t){const i=this._factory.createMesh(e,t),r={};r[e.id]=i,this._scene.addPeripheryPlanes(r),this._needsRender=!0}clearPeripheryPlanes(){this._scene.setPeripheryPlanes({}),this._needsRender=!0}updateFrame(e){this._updateFrameId(e.id),this._needsRender=this._updateAlpha(e.state.alpha)||this._needsRender,this._needsRender=this._updateAlphaOld(e.state.alpha)||this._needsRender,this._needsRender=this._updateImagePlanes(e.state)||this._needsRender}setTextureProvider(e,t){if(e!==this._currentKey)return;let i=t.textureCreated$.subscribe((e=>{this._updateTexture(e)})),r=t.textureUpdated$.subscribe((e=>{this._needsRender=!0}));if(e in this._providerDisposers){(0,this._providerDisposers[e])(),delete this._providerDisposers[e]}this._providerDisposers[e]=()=>{i.unsubscribe(),r.unsubscribe(),t.dispose()}}updateTextureImage(e,t){this._needsRender=!0;const i=this._extend({},this._scene.planes,this._scene.planesOld,this._scene.planesPeriphery);for(const r in i){if(!i.hasOwnProperty(r))continue;if(r!==t.id)continue;let n=i[r].material.uniforms.projectorTex.value;n.image=e,n.needsUpdate=!0}}render(e,t){const i=this._scene.planes,r=this._scene.planesOld,n=this._scene.planesPeriphery,a=Object.keys(r).length?1:this._alpha,o=Object.keys(r).length?1:Math.floor(this._alpha);for(const s in i){if(!i.hasOwnProperty(s))continue;i[s].material.uniforms.opacity.value=a}for(const s in r){if(!r.hasOwnProperty(s))continue;r[s].material.uniforms.opacity.value=this._alphaOld}for(const s in n){if(!n.hasOwnProperty(s))continue;n[s].material.uniforms.opacity.value=o}t.render(this._scene.scenePeriphery,e),t.render(this._scene.scene,e),t.render(this._scene.sceneOld,e);for(const s in i){if(!i.hasOwnProperty(s))continue;i[s].material.uniforms.opacity.value=this._alpha}t.render(this._scene.scene,e)}clearNeedsRender(){this._needsRender=!1}dispose(){this._scene.clear()}_updateFrameId(e){this._frameId=e}_updateAlpha(e){return e!==this._alpha&&(this._alpha=e,!0)}_updateAlphaOld(e){return!(e<1||0===this._alphaOld)&&(this._alphaOld=Math.max(0,this._alphaOld-this._fadeOutSpeed),!0)}_updateImagePlanes(e){if(null==e.currentImage||e.currentImage.id===this._currentKey)return!1;let t=null!=e.previousImage?e.previousImage.id:null,i=e.currentImage.id;if(this._previousKey!==t&&this._previousKey!==i&&this._previousKey in this._providerDisposers){(0,this._providerDisposers[this._previousKey])(),delete this._providerDisposers[this._previousKey]}if(null!=t){if(t!==this._currentKey&&t!==this._previousKey){let i=this._factory.createMesh(e.previousImage,e.previousTransform);const r={};r[t]=i,this._scene.updateImagePlanes(r)}this._previousKey=t}this._currentKey=i;let r=this._factory.createMesh(e.currentImage,e.currentTransform);const n={};return n[i]=r,this._scene.updateImagePlanes(n),this._alphaOld=1,!0}_updateTexture(e){this._needsRender=!0;const t=this._scene.planes;for(const i in t){if(!t.hasOwnProperty(i))continue;let r=t[i].material,n=r.uniforms.projectorTex.value;r.uniforms.projectorTex.value=null,n.dispose(),r.uniforms.projectorTex.value=e}}_extend(e,...t){for(const i of t)for(const t in i)i.hasOwnProperty(t)&&(e[t]=i[t]);return e}}var Vm;!function(e){e[e.Background=0]="Background",e[e.Opaque=1]="Opaque"}(Vm||(Vm={}));class Um{constructor(e){this._api=e,this._urls$=new Map}getImage$(e){let t;const i=new Promise(((e,i)=>{t=i}));return[re.create((r=>{this._api.data.getImageBuffer(e,i).then((e=>{t=null;const i=new Image;i.crossOrigin="Anonymous",i.onload=()=>{window.URL.revokeObjectURL(i.src),r.next(i),r.complete()},i.onerror=()=>{t=null,window.URL.revokeObjectURL(i.src),r.error(new Error("Failed to load image tile"))};const n=new Blob([e]);i.src=window.URL.createObjectURL(n)}),(e=>{t=null,r.error(e)}))})),()=>{t&&t()}]}getURLs$(e,t){const i=this._inventId(e,t);if(this._urls$.has(i))return this._urls$.get(i);const r={imageId:e,z:t},n=this._api.getImageTiles$(r).pipe(tt((e=>e.node)),Gt((()=>{this._urls$.delete(i)})),Kt(),le());return this._urls$.set(i,n),n}_inventId(e,t){return`${e}-${t}`}}class $m{constructor(){this._tiles=new Map,this._urlLevels=new Set,this._urls=new Map}add(e,t){if(this._tiles.has(e))throw new Error(`Image tile already stored (${e})`);this._tiles.set(e,t)}addURLs(e,t){const i=this._urls;for(const r of t){const e=this.inventId(r);if(this._urls.has(e))throw new Error(`URL already stored (${e})`);i.set(e,r.url)}this._urlLevels.add(e)}dispose(){this._tiles.forEach((e=>window.URL.revokeObjectURL(e.src))),this._tiles.clear(),this._urls.clear(),this._urlLevels.clear()}get(e){return this._tiles.get(e)}getURL(e){return this._urls.get(e)}has(e){return this._tiles.has(e)}hasURL(e){return this._urls.has(e)}hasURLLevel(e){return this._urlLevels.has(e)}inventId(e){return`${e.z}-${e.x}-${e.y}`}}class jm{constructor(){this._viewportCoords=new Im}computeRegionOfInterest(e,t,i){const r=this._viewportBoundaryPoints(4),n=this._viewportPointsBoundingBox(r,e,i);this._clipBoundingBox(n);const a=2/t.width,o=2/t.height,s=[[-.5*a,.5*o],[.5*a,.5*o],[.5*a,-.5*o],[-.5*a,-.5*o]],l=this._viewportPointsBoundingBox(s,e,i),c=l.minX<l.maxX;return{bbox:n,pixelHeight:l.maxY-l.minY,pixelWidth:l.maxX-l.minX+(c?0:1)}}_viewportBoundaryPoints(e){const t=[],i=[[-1,1],[1,1],[1,-1],[-1,-1]],r=[[2,0],[0,-2],[-2,0],[0,2]];for(let n=0;n<4;++n){const a=i[n],o=r[n];for(let i=0;i<e;++i)t.push([a[0]+o[0]*i/e,a[1]+o[1]*i/e])}return t}_viewportPointsBoundingBox(e,t,i){const r=e.map((e=>this._viewportCoords.viewportToBasic(e[0],e[1],i,t.perspective)));return Qh(i.cameraType)?this._boundingBoxSpherical(r):this._boundingBox(r)}_boundingBox(e){const t={maxX:Number.NEGATIVE_INFINITY,maxY:Number.NEGATIVE_INFINITY,minX:Number.POSITIVE_INFINITY,minY:Number.POSITIVE_INFINITY};for(let i=0;i<e.length;++i)t.minX=Math.min(t.minX,e[i][0]),t.maxX=Math.max(t.maxX,e[i][0]),t.minY=Math.min(t.minY,e[i][1]),t.maxY=Math.max(t.maxY,e[i][1]);return t}_boundingBoxSpherical(e){const t=[],i=[];for(let n=0;n<e.length;++n)t.push(e[n][0]),i.push(e[n][1]);t.sort(((e,t)=>this._sign(e-t))),i.sort(((e,t)=>this._sign(e-t)));const r=this._intervalSpherical(t);return{maxX:r[1],maxY:i[i.length-1],minX:r[0],minY:i[0]}}_intervalSpherical(e){let t=0,i=-1;for(let r=0;r<e.length-1;++r){const n=e[r+1]-e[r];n>t&&(t=n,i=r)}return e[0]+1-e[e.length-1]>t?[e[0],e[e.length-1]]:[e[i+1],e[i]]}_clipBoundingBox(e){e.minX=Math.max(0,Math.min(1,e.minX)),e.maxX=Math.max(0,Math.min(1,e.maxX)),e.minY=Math.max(0,Math.min(1,e.minY)),e.maxY=Math.max(0,Math.min(1,e.maxY))}_sign(e){return e>0?1:e<0?-1:0}}function qm(e,t,i){return Math.max(t,Math.min(i,e))}function Gm(e){return 1024/Hm(e)}function Hm(e){return Math.pow(2,e.z-e.max)}function Wm(e){return Math.ceil(function(e){const t=Math.max(e.w,e.h);return Math.log(t)/Math.log(2)}(e))}function Zm(e,t,i){const r=Gm(i),n=t.w,a=t.h,o=Math.ceil(n/r)-1,s=Math.ceil(a/r)-1;return{x:qm(Math.floor(n*e[0]/r),0,o),y:qm(Math.floor(a*e[1]/r),0,s)}}function Xm(e,t,i){const r=1024*(1/Hm(i)),n=r*e.x,a=r*e.y,o=Math.min(r,t.w-n);return{h:Math.min(r,t.h-a),x:n,y:a,w:o}}function Ym(e,t,i){return i*e<=t&&t<i*(e+1)}function Km(e,t){if(e.z===t.z)return e.x===t.x&&e.y===t.y;const i=e.z<t.z?e:t,r=e.z<t.z?t:e,n=1/Hm({max:r.z,z:i.z}),a=Ym(i.x,r.x,n),o=Ym(i.y,r.y,n);return a&&o}function Jm(e){return e.w>0&&e.h>0}class Qm{constructor(e,t,i,r,n,a,o){const s={h:i,w:t};Jm(s)||console.warn(`Original image size (${t}, ${i}) is invalid (${e}). Tiles will not be loaded.`),this._imageId=e,this._size=s,this._level={max:Wm(this._size),z:-1},this._holder=new Tm,this._updated$=new he,this._createdSubject$=new he,this._created$=this._createdSubject$.pipe(Jt(1),le()),this._holder.push(this._created$.subscribe((()=>{}))),this._hasSubject$=new he,this._has$=this._hasSubject$.pipe(ai(!1),Jt(1),le()),this._holder.push(this._has$.subscribe((()=>{}))),this._renderedLevel=new Set,this._rendered=new Map,this._subscriptions=new Map,this._urlSubscriptions=new Map,this._loader=n,this._store=a,this._background=r,this._renderer=o,this._aborts=[],this._render=null,this._disposed=!1}get disposed(){return this._disposed}get hasTexture$(){return this._has$}get id(){return this._imageId}get textureUpdated$(){return this._updated$}get textureCreated$(){return this._created$}abort(){this._subscriptions.forEach((e=>e.unsubscribe())),this._subscriptions.clear();for(const e of this._aborts)e();this._aborts=[]}dispose(){this._disposed?console.warn(`Texture already disposed (${this._imageId})`):(this._urlSubscriptions.forEach((e=>e.unsubscribe())),this._urlSubscriptions.clear(),this.abort(),null!=this._render&&(this._render.target.dispose(),this._render.target=null,this._render.camera=null,this._render=null),this._store.dispose(),this._holder.unsubscribe(),this._renderedLevel.clear(),this._background=null,this._renderer=null,this._disposed=!0)}setRegionOfInterest(e){if(!Jm(this._size))return;const t=1/e.pixelWidth,i=function(e,t,i){return Math.max(t,Math.min(i,Wm(e)))}({h:1/e.pixelHeight,w:t},11,this._level.max);i!==this._level.z&&(this.abort(),this._level.z=i,this._renderedLevel.clear(),this._rendered.forEach(((e,t)=>{e.z===i&&this._renderedLevel.add(t)}))),null==this._render&&this._initRender();const r=function(e,t,i,r){const n=[];if(e.x>t.x){const a=Gm(r),o=Math.ceil(i.w/a)-1;for(let t=e.x;t<=o;t++)n.push(t);for(let e=0;e<=t.x;e++)n.push(e)}else for(let o=e.x;o<=t.x;o++)n.push(o);const a=[];for(const o of n)for(let i=e.y;i<=t.y;i++)a.push({x:o,y:i});return a}(Zm([e.bbox.minX,e.bbox.minY],this._size,this._level),Zm([e.bbox.maxX,e.bbox.maxY],this._size,this._level),this._size,this._level);this._fetchTiles(i,r)}_fetchTile(e){const t=this._loader.getImage$(e.url),i=t[0],r=t[1];this._aborts.push(r);const n=this._store.inventId(e),a=i.subscribe((t=>{const i=Xm(e,this._size,this._level);this._renderToTarget(i,t),this._subscriptions.delete(n),this._removeFromArray(r,this._aborts),this._markRendered(e),this._store.add(n,t),this._updated$.next(!0)}),(e=>{this._subscriptions.delete(n),this._removeFromArray(r,this._aborts),console.error(e)}));a.closed||this._subscriptions.set(n,a)}_fetchTiles(e,t){const i=(this._store.hasURLLevel(e)?Ze(void 0):this._loader.getURLs$(this._imageId,e).pipe(ci((t=>{this._store.hasURLLevel(e)||this._store.addURLs(e,t)})))).subscribe((()=>{if(e===this._level.z){for(const i of t){const t={x:i.x,y:i.y,z:e,url:null},r=this._store.inventId(t);if(!this._renderedLevel.has(r)&&!this._subscriptions.has(r))if(this._store.has(r)){const e=Xm(i,this._size,this._level);this._renderToTarget(e,this._store.get(r)),this._markRendered(t),this._updated$.next(!0)}else t.url=this._store.getURL(r),this._fetchTile(t)}this._urlSubscriptions.delete(e)}}),(t=>{this._urlSubscriptions.delete(e),console.error(t)}));i.closed||this._urlSubscriptions.set(e,i)}_initRender(){const e=this._size.w/2,t=this._size.h/2,i=new eo(-e,e,t,-t,-1,1);i.position.z=1;const r=this._renderer.getContext(),n=r.getParameter(r.MAX_TEXTURE_SIZE),a=Math.max(this._size.w,this._size.h),o=n>a?1:n/a,s=Math.floor(o*this._size.w),l=Math.floor(o*this._size.h),c=new _r(s,l,{depthBuffer:!1,format:Ai,magFilter:xi,minFilter:xi,stencilBuffer:!1});this._render={camera:i,target:c};const u=Xm({x:0,y:0},this._size,{max:this._level.max,z:0});this._renderToTarget(u,this._background),this._createdSubject$.next(c.texture),this._hasSubject$.next(!0)}_markRendered(e){const t=Array.from(this._rendered.entries()).filter((([t,i])=>i.z!==e.z));for(const[r,n]of t)Km(e,n)&&this._rendered.delete(r);const i=this._store.inventId(e);this._rendered.set(i,e),this._renderedLevel.add(i)}_removeFromArray(e,t){const i=t.indexOf(e);-1!==i&&t.splice(i,1)}_renderToTarget(e,t){const i=new fr(t);i.minFilter=xi,i.needsUpdate=!0;const r=new qa(e.w,e.h),n=new qn({map:i,side:0}),a=new wa(r,n);a.position.x=-this._size.w/2+e.x+e.w/2,a.position.y=this._size.h/2-e.y-e.h/2;const o=new zl;o.add(a);const s=this._renderer.getRenderTarget();this._renderer.resetState(),this._renderer.setRenderTarget(this._render.target),this._renderer.render(o,this._render.camera),this._renderer.setRenderTarget(s),o.remove(a),r.dispose(),n.dispose(),i.dispose()}}var eg,tg,ig,rg;!function(e){e[e.Custom=0]="Custom",e[e.Earth=1]="Earth",e[e.Traversing=2]="Traversing",e[e.Waiting=3]="Waiting",e[e.WaitingInteractively=4]="WaitingInteractively"}(eg||(eg={}));class ng extends Em{constructor(e,t,i){super(e,t,i),this._imageTileLoader=new Um(i.api),this._roiCalculator=new jm,this._rendererOperation$=new he,this._rendererCreator$=new he,this._rendererDisposer$=new he,this._renderer$=this._rendererOperation$.pipe(ei(((e,t)=>t(e)),null),Ct((e=>null!=e)),Vt(void 0,(e=>e.frameId))),this._rendererCreator$.pipe(tt((()=>e=>{if(null!=e)throw new Error("Multiple image plane states can not be created at the same time");return new Nm}))).subscribe(this._rendererOperation$),this._rendererDisposer$.pipe(tt((()=>e=>(e.dispose(),null)))).subscribe(this._rendererOperation$)}_activate(){const e=this._subscriptions;e.push(this._renderer$.pipe(tt((e=>{const t={name:this._name,renderer:{frameId:e.frameId,needsRender:e.needsRender,render:e.render.bind(e),pass:Vm.Background}};return e.clearNeedsRender(),t}))).subscribe(this._container.glRenderer.render$)),this._rendererCreator$.next(null),e.push(this._navigator.stateService.currentState$.pipe(tt((e=>t=>(t.updateFrame(e),t)))).subscribe(this._rendererOperation$));const t=this._container.configurationService.imageTiling$.pipe(oi((e=>e?this._navigator.stateService.currentState$:new he)),Vt(void 0,(e=>e.state.currentImage.id)),ui(this._container.glRenderer.webGLRenderer$),tt((([e,t])=>{const i=e.state,r=i.currentImage,n=i.currentTransform;return new Qm(r.id,n.basicWidth,n.basicHeight,r.image,this._imageTileLoader,new $m,t)})),Jt(1),le());e.push(t.subscribe((()=>{}))),e.push(t.pipe(tt((e=>t=>(t.setTextureProvider(e.id,e),t)))).subscribe(this._rendererOperation$)),e.push(t.pipe(Yt()).subscribe((e=>{e[0].abort()})));const i=this._container.configurationService.imageTiling$.pipe(oi((e=>e?ut(this._navigator.stateService.state$,this._navigator.stateService.inTranslation$):new he)),oi((([e,t])=>(e===eg.Traversing||e===eg.Waiting||e===eg.WaitingInteractively)&&!t?this._container.renderService.renderCameraFrame$:Me())),tt((e=>({camera:e,height:e.size.height.valueOf(),lookat:e.camera.lookat.clone(),width:e.size.width.valueOf(),zoom:e.zoom.valueOf()}))),Yt(),tt((([e,t])=>{const i=e.width===t.width&&e.height===t.height&&e.zoom===t.zoom&&e.lookat.equals(t.lookat);return{camera:t.camera,stalled:i}})),Vt(((e,t)=>e.stalled===t.stalled)),Ct((e=>e.stalled)),ui(this._container.renderService.size$,this._navigator.stateService.currentTransform$));e.push(t.pipe(oi((e=>i.pipe(tt((([t,i,r])=>{const n=t.camera,a=(new Im).viewportToBasic(0,0,r,n.perspective);if(!(a[0]<0||a[1]<0||a[0]>1||a[1]>1))return[this._roiCalculator.computeRegionOfInterest(n,i,r),e]})),Ct((e=>!!e))))),Ct((e=>!e[1].disposed))).subscribe((([e,t])=>{t.setRegionOfInterest(e)})));const r=t.pipe(oi((e=>e.hasTexture$)),ai(!1),Jt(1),le());e.push(r.subscribe((()=>{}))),e.push(this._navigator.panService.panImages$.pipe(Ct((e=>0===e.length)),tt((()=>e=>(e.clearPeripheryPlanes(),e)))).subscribe(this._rendererOperation$));const n=this._navigator.panService.panImages$.pipe(oi((e=>Oe(e).pipe(ft((([e,t])=>ut(this._navigator.graphService.cacheImage$(e.id).pipe(zt((t=>(console.error(`Failed to cache periphery image (${e.id})`,t),Me())))),Ze(t))))))),ti());e.push(n.pipe(tt((([e,t])=>i=>(i.addPeripheryPlane(e,t),i)))).subscribe(this._rendererOperation$)),e.push(n.pipe(ft((([e])=>e.cacheImage$().pipe(zt((()=>Me()))))),tt((e=>t=>(t.updateTextureImage(e.image,e),t)))).subscribe(this._rendererOperation$));const a=this._navigator.stateService.currentState$.pipe(tt((e=>e.state.alpha<1)),Vt()),o=ut(this._container.mouseService.active$,this._container.touchService.active$,this._navigator.stateService.inMotion$,a).pipe(tt((([e,t,i,r])=>!(e||t||i||r))),Ct((e=>e)));e.push(this._navigator.stateService.state$.pipe(oi((e=>e===eg.Traversing?this._navigator.panService.panImages$:Me())),oi((e=>o.pipe(ui(this._container.renderService.renderCamera$,this._navigator.stateService.currentImage$,this._navigator.stateService.currentTransform$),ft((([,t,i,r])=>Ze([t,i,r,e])))))),oi((([e,t,i,r])=>{const n=e.camera.lookat.clone().sub(e.camera.position),a=[(new Kh).viewingDirection(t.rotation).angleTo(n),void 0],o=(new Im).viewportToBasic(0,0,i,e.perspective);o[0]>=0&&o[0]<=1&&o[1]>=0&&o[1]<=1&&(a[0]=Number.NEGATIVE_INFINITY);for(const[s]of r){const e=(new Kh).viewingDirection(s.rotation).angleTo(n);e<a[0]&&(a[0]=e,a[1]=s.id)}return a[1]?this._navigator.moveTo$(a[1]).pipe(zt((()=>Me()))):Me()}))).subscribe())}_deactivate(){this._rendererDisposer$.next(null),this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{}}}ng.componentName="image";class ag{constructor(e,t,i){this._component=e,this._container=t,this._navigator=i,this._enabled=!1}get isEnabled(){return this._enabled}enable(){!this._enabled&&this._component.activated&&(this._enable(),this._enabled=!0,this._component.configure(this._getConfiguration(!0)))}disable(){this._enabled&&(this._disable(),this._enabled=!1,this._component.activated&&this._component.configure(this._getConfiguration(!1)))}}class og extends ag{_enable(){const e=this._navigator.stateService.currentImage$.pipe(oi((e=>e.sequenceEdges$)));this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(ui(e)).subscribe((([e,t])=>{let i=null;switch(e.keyCode){case 38:i=Hh.Next;break;case 40:i=Hh.Prev;break;default:return}if(e.preventDefault(),e.altKey&&!e.shiftKey&&t.cached)for(const r of t.edges)if(r.data.direction===i)return void this._navigator.moveTo$(r.target).subscribe(void 0,(e=>{e instanceof Rm||console.error(e)}))}))}_disable(){this._keyDownSubscription.unsubscribe()}_getConfiguration(e){return{keySequenceNavigation:e}}}class sg extends ag{constructor(e,t,i,r){super(e,t,i),this._spatial=r}_enable(){const e=this._navigator.stateService.currentImage$.pipe(oi((e=>e.spatialEdges$)));this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(ui(e,this._navigator.stateService.currentState$)).subscribe((([e,t,i])=>{let r=Qh(i.state.currentImage.cameraType),n=null;switch(e.keyCode){case 37:n=e.shiftKey&&!r?Hh.TurnLeft:Hh.StepLeft;break;case 38:n=e.shiftKey&&!r?Hh.Spherical:Hh.StepForward;break;case 39:n=e.shiftKey&&!r?Hh.TurnRight:Hh.StepRight;break;case 40:n=e.shiftKey&&!r?Hh.TurnU:Hh.StepBackward;break;default:return}if(e.preventDefault(),!(e.altKey||!t.cached||e.shiftKey&&r))if(r){const e={};e[Hh.StepBackward]=Math.PI,e[Hh.StepForward]=0,e[Hh.StepLeft]=Math.PI/2,e[Hh.StepRight]=-Math.PI/2;const r=this._rotationFromCamera(i.state.camera).phi,a=this._spatial.wrapAngle(r+e[n]),o=Math.PI/4,s=t.edges.filter((e=>e.data.direction===Hh.Spherical||e.data.direction===n));let l=Number.MAX_VALUE,c=null;for(const t of s){const e=Math.abs(this._spatial.wrapAngle(t.data.worldMotionAzimuth-a));e<Math.min(l,o)&&(l=e,c=t.target)}if(null==c)return;this._moveTo(c)}else this._moveDir(n,t)}))}_disable(){this._keyDownSubscription.unsubscribe()}_getConfiguration(e){return{keySpatialNavigation:e}}_moveDir(e,t){for(const i of t.edges)if(i.data.direction===e)return void this._moveTo(i.target)}_moveTo(e){this._navigator.moveTo$(e).subscribe(void 0,(e=>{e instanceof Rm||console.error(e)}))}_rotationFromCamera(e){let t=e.lookat.clone().sub(e.position),i=t.clone().dot(e.up),r=t.clone().sub(e.up.clone().multiplyScalar(i));return{phi:Math.atan2(r.y,r.x),theta:Math.PI/2-this._spatial.angleToPlane(t.toArray(),[0,0,1])}}}class lg extends ag{constructor(e,t,i,r){super(e,t,i),this._viewportCoords=r}_enable(){this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(ui(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$)).subscribe((([e,t,i])=>{if(e.altKey||e.ctrlKey||e.metaKey)return;let r=0;switch(e.key){case"+":r=1;break;case"-":r=-1;break;default:return}e.preventDefault();const n=this._viewportCoords.unprojectFromViewport(0,0,t.perspective),a=i.projectBasic(n.toArray());this._navigator.stateService.zoomIn(r,a)}))}_disable(){this._keyDownSubscription.unsubscribe()}_getConfiguration(e){return{keyZoom:e}}}class cg extends ag{_enable(){this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(ui(this._navigator.playService.playing$,this._navigator.playService.direction$,this._navigator.playService.speed$,this._navigator.stateService.currentImage$.pipe(oi((e=>e.sequenceEdges$))),this._navigator.stateService.state$.pipe(tt((e=>e===eg.Earth)),Vt()))).subscribe((([e,t,i,r,n,a])=>{if(!(e.altKey||e.ctrlKey||e.metaKey)){switch(e.key){case"D":if(!e.shiftKey)return;const o=t?null:i===Hh.Next?Hh.Prev:i===Hh.Prev?Hh.Next:null;null!=o&&this._navigator.playService.setDirection(o);break;case" ":if(e.shiftKey)return;if(!a)if(t)this._navigator.playService.stop();else for(let e of n.edges)e.data.direction===i&&this._navigator.playService.play();break;case"<":this._navigator.playService.setSpeed(r-.05);break;case">":this._navigator.playService.setSpeed(r+.05);break;default:return}e.preventDefault()}}))}_disable(){this._keyDownSubscription.unsubscribe()}_getConfiguration(e){return{keyPlay:e}}}class ug extends Em{constructor(e,t,i){super(e,t,i),this._keyPlayHandler=new cg(this,t,i),this._keySequenceNavigationHandler=new og(this,t,i),this._keySpatialNavigationHandler=new sg(this,t,i,new Kh),this._keyZoomHandler=new lg(this,t,i,new Im)}get keyPlay(){return this._keyPlayHandler}get keySequenceNavigation(){return this._keySequenceNavigationHandler}get keySpatialNavigation(){return this._keySpatialNavigationHandler}get keyZoom(){return this._keyZoomHandler}_activate(){this._subscriptions.push(this._configuration$.subscribe((e=>{e.keyPlay?this._keyPlayHandler.enable():this._keyPlayHandler.disable(),e.keySequenceNavigation?this._keySequenceNavigationHandler.enable():this._keySequenceNavigationHandler.disable(),e.keySpatialNavigation?this._keySpatialNavigationHandler.enable():this._keySpatialNavigationHandler.disable(),e.keyZoom?this._keyZoomHandler.enable():this._keyZoomHandler.disable()})))}_deactivate(){this._subscriptions.unsubscribe(),this._keyPlayHandler.disable(),this._keySequenceNavigationHandler.disable(),this._keySpatialNavigationHandler.disable(),this._keyZoomHandler.disable()}_getDefaultConfiguration(){return{keyPlay:!0,keySequenceNavigation:!0,keySpatialNavigation:!0,keyZoom:!0}}}ug.componentName="keyboard";class hg{constructor(e,t){this._needsRender=!1,this._interactiveObjects=[],this._markers={},this._objectMarkers={},this._raycaster=t||new Eh,this._scene=e||new zl}get markers(){return this._markers}get needsRender(){return this._needsRender}add(e,t){e.id in this._markers&&this._dispose(e.id),e.createGeometry(t),this._scene.add(e.geometry),this._markers[e.id]=e;for(let i of e.getInteractiveObjects())this._interactiveObjects.push(i),this._objectMarkers[i.uuid]=e.id;this._needsRender=!0}clear(){for(const e in this._markers)this._markers.hasOwnProperty&&this._dispose(e);this._needsRender=!0}get(e){return this._markers[e]}getAll(){return Object.keys(this._markers).map((e=>this._markers[e]))}has(e){return e in this._markers}intersectObjects([e,t],i){this._raycaster.setFromCamera(new or(e,t),i);const r=this._raycaster.intersectObjects(this._interactiveObjects);for(const n of r)if(n.object.uuid in this._objectMarkers)return this._objectMarkers[n.object.uuid];return null}lerpAltitude(e,t,i){e in this._markers&&(this._markers[e].lerpAltitude(t,i),this._needsRender=!0)}remove(e){e in this._markers&&(this._dispose(e),this._needsRender=!0)}render(e,t){t.render(this._scene,e),this._needsRender=!1}update(e,t,i){if(!(e in this._markers))return;this._markers[e].updatePosition(t,i),this._needsRender=!0}_dispose(e){const t=this._markers[e];this._scene.remove(t.geometry);for(let i of t.getInteractiveObjects()){const t=this._interactiveObjects.indexOf(i);-1!==t?this._interactiveObjects.splice(t,1):console.warn(`Object does not exist (${i.id}) for ${e}`),delete this._objectMarkers[i.uuid]}t.disposeGeometry(),delete this._markers[e]}}class pg extends Em{constructor(e,t,i){super(e,t,i),this._graphCalculator=new Uh,this._markerScene=new hg,this._markerSet=new op,this._viewportCoords=new Im,this._relativeGroundAltitude=-2}add(e){this._markerSet.add(e)}fire(e,t){super.fire(e,t)}get(e){return this._markerSet.get(e)}getAll(){return this._markerSet.getAll()}getMarkerIdAt(e){return new Promise(((t,i)=>{this._container.renderService.renderCamera$.pipe(Ht(),tt((t=>{const i=this._viewportCoords.canvasToViewport(e[0],e[1],this._container.container);return this._markerScene.intersectObjects(i,t.perspective)}))).subscribe((e=>{t(e)}),(e=>{i(e)}))}))}has(e){return this._markerSet.has(e)}off(e,t){super.off(e,t)}on(e,t){super.on(e,t)}remove(e){this._markerSet.remove(e)}removeAll(){this._markerSet.removeAll()}_activate(){const e=this._navigator.stateService.currentState$.pipe(tt((e=>e.state.camera.position.z+this._relativeGroundAltitude)),Vt(((e,t)=>Math.abs(e-t)<.01)),Jt(1),le()),t=ut(e,this._navigator.stateService.reference$).pipe(Ht(),tt((()=>{})),Jt(1),le()),i=this._configuration$.pipe(tt((e=>({visibleBBoxSize:Math.max(1,Math.min(200,e.visibleBBoxSize))})))),r=this._navigator.stateService.currentImage$.pipe(tt((e=>e.lngLat)),Jt(1),le()),n=ut(i,r).pipe(tt((([e,t])=>this._graphCalculator.boundingBoxCorners(t,e.visibleBBoxSize/2))),Jt(1),le()),a=ut(_t(Ze(this._markerSet),this._markerSet.changed$),n).pipe(tt((([e,t])=>e.search(t)))),o=this._subscriptions;o.push(t.pipe(oi((()=>a.pipe(ui(this._navigator.stateService.reference$,e))))).subscribe((([e,t,i])=>{const r=this._markerScene,n=r.markers,a=Object.assign({},n);for(const o of e)if(o.id in n)delete a[o.id];else{const e=Oh(o.lngLat.lng,o.lngLat.lat,t.alt+i,t.lng,t.lat,t.alt);r.add(o,e)}for(const o in a)a.hasOwnProperty(o)&&r.remove(o)}))),o.push(t.pipe(oi((()=>this._markerSet.updated$.pipe(ui(n,this._navigator.stateService.reference$,e))))).subscribe((([e,[t,i],r,n])=>{const a=this._markerScene;for(const o of e){const e=a.has(o.id),s=o.lngLat.lat>t.lat&&o.lngLat.lat<i.lat&&o.lngLat.lng>t.lng&&o.lngLat.lng<i.lng;if(s){const e=Oh(o.lngLat.lng,o.lngLat.lat,r.alt+n,r.lng,r.lat,r.alt);a.add(o,e)}else!s&&e&&a.remove(o.id)}}))),o.push(this._navigator.stateService.reference$.pipe(ri(1),ui(e)).subscribe((([e,t])=>{const i=this._markerScene;for(const r of i.getAll()){const n=Oh(r.lngLat.lng,r.lngLat.lat,e.alt+t,e.lng,e.lat,e.alt);i.update(r.id,n)}}))),o.push(e.pipe(ri(1),ui(this._navigator.stateService.reference$,r)).subscribe((([e,t,i])=>{const r=this._markerScene,n=Oh(i.lng,i.lat,t.alt+e,t.lng,t.lat,t.alt);for(const a of r.getAll()){const i=Oh(a.lngLat.lng,a.lngLat.lat,t.alt+e,t.lng,t.lat,t.alt),o=i[0]-n[0],s=i[1]-n[1],l=Math.sqrt(o*o+s*s);l>50||r.lerpAltitude(a.id,e,Math.min(1,Math.max(0,1.2-1.2*l/50)))}}))),o.push(this._navigator.stateService.currentState$.pipe(tt((e=>{const t=this._markerScene;return{name:this._name,renderer:{frameId:e.id,needsRender:t.needsRender,render:t.render.bind(t),pass:Vm.Opaque}}}))).subscribe(this._container.glRenderer.render$));const s=ut(this._container.renderService.renderCamera$,this._container.mouseService.mouseMove$).pipe(tt((([e,t])=>{const i=this._container.container,[r,n]=this._viewportCoords.canvasPosition(t,i),a=this._viewportCoords.canvasToViewport(r,n,i);return this._markerScene.intersectObjects(a,e.perspective)})),Jt(1),le()),l=this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragStart$).pipe(tt((()=>!0))),c=this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragEnd$).pipe(tt((()=>!1))),u=Mt(l,c).pipe(ai(!1));o.push(Mt(l.pipe(ui(s)),ut(c,Ze(null))).pipe(ai([!1,null]),Yt()).subscribe((([e,t])=>{const i=t[0],r=i?"markerdragstart":"markerdragend",n=i?t[1]:e[1],a={marker:this._markerScene.get(n),target:this,type:r};this.fire(r,a)})));const h=Mt(this._container.mouseService.mouseDown$.pipe(tt((()=>!0))),this._container.mouseService.documentMouseUp$.pipe(tt((()=>!1)))).pipe(ai(!1));o.push(ut(this._container.mouseService.active$,s.pipe(Vt()),h,u).pipe(tt((([e,t,i,r])=>!e&&null!=t&&i||r)),Vt()).subscribe((e=>{e?(this._container.mouseService.claimMouse(this._name,1),this._container.mouseService.claimWheel(this._name,1)):(this._container.mouseService.unclaimMouse(this._name),this._container.mouseService.unclaimWheel(this._name))})));const p=this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragStart$).pipe(ui(s,this._container.renderService.renderCamera$),tt((([e,t,i])=>{const r=this._markerScene.get(t),n=this._container.container,[a,o]=this._viewportCoords.projectToCanvas(r.geometry.position.toArray(),n,i.perspective),[s,l]=this._viewportCoords.canvasPosition(e,n);return[r,[s-a,l-o],i]})),Jt(1),le());o.push(this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDrag$).pipe(ui(p,this._navigator.stateService.reference$,i)).subscribe((([e,[t,i,r],n,a])=>{if(!this._markerScene.has(t.id))return;const o=this._container.container,[s,l]=this._viewportCoords.canvasPosition(e,o),c=s-i[0],u=l-i[1],[h,p]=this._viewportCoords.canvasToViewport(c,u,o),d=new xr(h,p,1).unproject(r.perspective).sub(r.perspective.position).normalize(),f=Math.min(this._relativeGroundAltitude/d.z,a.visibleBBoxSize/2-.1);if(f<0)return;const m=d.clone().multiplyScalar(f).add(r.perspective.position);m.z=r.perspective.position.z+this._relativeGroundAltitude;const[g,_]=Nh(m.x,m.y,m.z,n.lng,n.lat,n.alt);this._markerScene.update(t.id,m.toArray(),{lat:_,lng:g}),this._markerSet.update(t);const y="markerposition",v={marker:t,target:this,type:y};this.fire(y,v)})))}_deactivate(){this._subscriptions.unsubscribe(),this._markerScene.clear()}_getDefaultConfiguration(){return{visibleBBoxSize:100}}}function dg(e,t){return e.x<=Math.max(t.p1.x,t.p2.x)&&e.x>=Math.min(t.p1.x,t.p2.x)&&e.y>=Math.max(t.p1.y,t.p2.y)&&e.y>=Math.min(t.p1.y,t.p2.y)}function fg(e,t){const i=e.p2.x-e.p1.x,r=e.p2.y-e.p1.y,n=t.p2.x-t.p1.x,a=t.p2.y-t.p1.y,o=i*a-r*n;return o*o<1e-10*(i*i+r*r)*(n*n+a*a)}function mg(e,t,i){const r=(t.y-e.y)*(i.x-t.x)-(i.y-t.y)*(t.x-e.x);return(n=r)>0?1:n<0?-1:0;var n}function gg(e,t){if(fg(e,t))return!1;const i=mg(e.p1,e.p2,t.p1),r=mg(e.p1,e.p2,t.p2),n=mg(t.p1,t.p2,e.p1),a=mg(t.p1,t.p2,e.p2);return i!==r&&n!==a||(!(0!==i||!dg(t.p1,e))||(!(0!==r||!dg(t.p2,e))||(!(0!==n||!dg(e.p1,t))||!(0!==a||!dg(e.p2,t)))))}function _g(e,t){if(fg(e,t))return;const i=e.p1.x,r=e.p2.x,n=e.p1.y,a=e.p2.y,o=t.p1.x,s=t.p2.x,l=t.p1.y,c=t.p2.y,u=(i-r)*(l-c)-(n-a)*(o-s);return{x:((i*a-n*r)*(o-s)-(i-r)*(o*c-l*s))/u,y:((i*a-n*r)*(l-c)-(n-a)*(o*c-l*s))/u}}function yg(e,t){return e>=-1&&e<=1&&t>=-1&&t<=1}function vg(e,t){return e>=0&&e<=1&&t>=0&&t<=1}function xg(e,t,i){const r=function(e){let t=[],i=[[0,0],[1,0],[1,1],[0,1]],r=[[1,0],[0,1],[-1,0],[0,-1]];for(let n=0;n<4;++n){let a=i[n],o=r[n];for(let i=0;i<e;++i)t.push([a[0]+o[0]*i/e,a[1]+o[1]*i/e])}return t}(100),n=r.map((r=>i.basicToViewportSafe(r[0],r[1],e,t))),a=[],o=[{x:-1,y:1},{x:1,y:1},{x:1,y:-1},{x:-1,y:-1}],s=[!1,!1,!1,!1];for(let v=0;v<n.length;v++){const e=n[v],t=n[(v+1)%n.length];if(null===e)continue;if(null===t){yg(e[0],e[1])&&a.push(e);continue}const[i,r]=e,[l,c]=t;if(yg(i,r))if(yg(l,c))a.push(e);else for(let n=0;n<4;n++){const t={p1:{x:i,y:r},p2:{x:l,y:c}},u={p1:o[n],p2:o[(n+1)%4]};if(gg(t,u)){const i=_g(t,u);a.push(e,[i.x,i.y]),s[n]=!0}}}const[l,c]=i.viewportToBasic(-1,1,e,t),[u,h]=i.viewportToBasic(1,1,e,t),[p,d]=i.viewportToBasic(1,-1,e,t),[f,m]=i.viewportToBasic(-1,-1,e,t);vg(l,c)&&(s[3]=s[0]=!0),vg(u,h)&&(s[0]=s[1]=!0),vg(p,d)&&(s[1]=s[2]=!0),vg(f,m)&&(s[2]=s[3]=!0);const g=[-1,-1,1,1];for(let v of a){const e=v[0],t=v[1];e>g[1]&&(g[1]=e),e<g[3]&&(g[3]=e),t>g[0]&&(g[0]=t),t<g[2]&&(g[2]=t)}const _=[1,1,-1,-1],y=[];for(let v=0;v<4;v++)s[v]?y.push(0):y.push(Math.abs(_[v]-g[v]));return y}pg.componentName="marker";class bg extends ag{constructor(e,t,i,r,n){super(e,t,i),this._spatial=n,this._viewportCoords=r}_enable(){const e=this._navigator.stateService.currentState$.pipe(tt((e=>e.state.alpha<1)),Vt());this._bounceSubscription=ut(e,this._navigator.stateService.inTranslation$,this._container.mouseService.active$,this._container.touchService.active$).pipe(tt((e=>e[0]||e[1]||e[2]||e[3])),Vt(),oi((e=>e?Me():ut(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$.pipe(Ht())))),ui(this._navigator.panService.panImages$)).subscribe((([[e,t],i])=>{if(!t.hasValidScale&&e.camera.focal<.1)return;if(0===e.perspective.aspect||e.perspective.aspect===Number.POSITIVE_INFINITY)return;const r=xg(t,e.perspective,this._viewportCoords),n=this._viewportCoords.viewportToBasic(0,0,t,e.perspective);(n[0]<0||n[0]>1)&&i.length>0&&(r[0]=r[2]=0);for(const[,d]of i){const t=xg(d,e.perspective,this._viewportCoords);for(let e=1;e<r.length;e+=2)t[e]<r[e]&&(r[e]=t[e])}if(Math.max(...r)<.01)return;const a=r[1]-r[3],o=r[0]-r[2],s=this._viewportCoords.unprojectFromViewport(0,0,e.perspective).sub(e.perspective.position),l=this._viewportCoords.unprojectFromViewport(a,0,e.perspective).sub(e.perspective.position),c=this._viewportCoords.unprojectFromViewport(0,o,e.perspective).sub(e.perspective.position);let u=(a>0?1:-1)*l.angleTo(s),h=(o>0?1:-1)*c.angleTo(s);const p=Math.PI/60;u=this._spatial.clamp(.1*u,-p,p),h=this._spatial.clamp(.1*h,-p,p),this._navigator.stateService.rotateUnbounded({phi:u,theta:h})}))}_disable(){this._bounceSubscription.unsubscribe()}_getConfiguration(){return{}}}class wg{static filteredPairwiseMouseDrag$(e,t){return this._filteredPairwiseMouseDrag$(e,t,t.mouseDragStart$,t.mouseDrag$,t.mouseDragEnd$)}static filteredPairwiseMouseRightDrag$(e,t){return this._filteredPairwiseMouseDrag$(e,t,t.mouseRightDragStart$,t.mouseRightDrag$,t.mouseRightDragEnd$)}static _filteredPairwiseMouseDrag$(e,t,i,r,n){return t.filtered$(e,i).pipe(oi((i=>Mt(_t(Ze(i),t.filtered$(e,r)),t.filtered$(e,n).pipe(tt((()=>null)))).pipe(li((e=>!!e)),ai(null)))),Yt(),Ct((e=>null!=e[0]&&null!=e[1])))}}class Sg extends ag{constructor(e,t,i,r,n){super(e,t,i),this._spatial=n,this._viewportCoords=r}_enable(){let e=this._container.mouseService.filtered$(this._component.name,this._container.mouseService.mouseDragStart$).pipe(tt((()=>!0)),ti()),t=this._container.mouseService.filtered$(this._component.name,this._container.mouseService.mouseDragEnd$).pipe(tt((()=>!1)),ti());this._activeMouseSubscription=Mt(e,t).subscribe(this._container.mouseService.activate$);const i=Mt(e,t).pipe(oi((e=>e?this._container.mouseService.documentMouseMove$:Me())));this._preventDefaultSubscription=Mt(i,this._container.touchService.touchMove$).subscribe((e=>{e.preventDefault()}));let r=this._container.touchService.singleTouchDragStart$.pipe(tt((()=>!0))),n=this._container.touchService.singleTouchDragEnd$.pipe(tt((()=>!1)));this._activeTouchSubscription=Mt(r,n).subscribe(this._container.touchService.activate$);const a=this._navigator.stateService.currentState$.pipe(tt((e=>Qh(e.state.currentImage.cameraType)||e.state.imagesAhead<1)),Vt(),oi((e=>{if(!e)return Me();const t=wg.filteredPairwiseMouseDrag$(this._component.name,this._container.mouseService),i=Mt(this._container.touchService.singleTouchDragStart$,this._container.touchService.singleTouchDrag$,this._container.touchService.singleTouchDragEnd$.pipe(tt((()=>null)))).pipe(tt((e=>null!=e&&e.touches.length>0?e.touches[0]:null)),Yt(),Ct((e=>null!=e[0]&&null!=e[1])));return Mt(t,i)})),ui(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$,this._navigator.panService.panImages$),tt((([e,t,i,r])=>{let n=e[0],a=e[1],o=a.clientX-n.clientX,s=a.clientY-n.clientY,l=this._container.container,[c,u]=this._viewportCoords.canvasPosition(a,l),h=this._viewportCoords.unprojectFromCanvas(c,u,l,t.perspective).sub(t.perspective.position),p=this._viewportCoords.unprojectFromCanvas(c-o,u,l,t.perspective).sub(t.perspective.position),d=this._viewportCoords.unprojectFromCanvas(c,u-s,l,t.perspective).sub(t.perspective.position),f=(o>0?1:-1)*p.angleTo(h),m=(s>0?-1:1)*d.angleTo(h);const g=xg(i,t.perspective,this._viewportCoords);for(const[,_]of r){const e=xg(_,t.perspective,this._viewportCoords);for(let t=0;t<g.length;t++)e[t]<g[t]&&(g[t]=e[t])}return g[0]>0&&m<0&&(m/=Math.max(1,200*g[0])),g[2]>0&&m>0&&(m/=Math.max(1,200*g[2])),g[1]>0&&f<0&&(f/=Math.max(1,200*g[1])),g[3]>0&&f>0&&(f/=Math.max(1,200*g[3])),{phi:f,theta:m}})),ti());var o;this._rotateWithoutInertiaSubscription=a.subscribe((e=>{this._navigator.stateService.rotateWithoutInertia(e)})),this._rotateSubscription=a.pipe(ei(((e,t)=>(this._drainBuffer(e),e.push([Date.now(),t]),e)),[]),(o=Mt(this._container.mouseService.filtered$(this._component.name,this._container.mouseService.mouseDragEnd$),this._container.touchService.singleTouchDragEnd$),oe((function(e,t){var i=!1,r=null;e.subscribe(new se(t,(function(e){i=!0,r=e}))),o.subscribe(new se(t,(function(){if(i){i=!1;var e=r;r=null,t.next(e)}}),j))}))),tt((e=>{const t=this._drainBuffer(e.slice()),i={phi:0,theta:0};for(const a of t)i.phi+=a[1].phi,i.theta+=a[1].theta;const r=t.length;r>0&&(i.phi/=r,i.theta/=r);const n=Math.PI/18;return i.phi=this._spatial.clamp(i.phi,-n,n),i.theta=this._spatial.clamp(i.theta,-n,n),i}))).subscribe((e=>{this._navigator.stateService.rotate(e)}))}_disable(){this._activeMouseSubscription.unsubscribe(),this._activeTouchSubscription.unsubscribe(),this._preventDefaultSubscription.unsubscribe(),this._rotateSubscription.unsubscribe(),this._rotateWithoutInertiaSubscription.unsubscribe(),this._activeMouseSubscription=null,this._activeTouchSubscription=null,this._preventDefaultSubscription=null,this._rotateSubscription=null}_getConfiguration(e){return{dragPan:e}}_drainBuffer(e){const t=Date.now();for(;e.length>0&&t-e[0][0]>50;)e.shift();return e}}class Mg extends ag{constructor(e,t,i,r,n){super(e,t,i),this._spatial=n,this._viewportCoords=r,this._subscriptions=new Tm}_enable(){const e=this._navigator.stateService.state$.pipe(tt((e=>e===eg.Earth)),Jt(1),le()),t=this._subscriptions;t.push(e.pipe(oi((e=>e?this._container.mouseService.mouseWheel$:Me()))).subscribe((e=>{e.preventDefault()}))),t.push(e.pipe(oi((e=>e?wg.filteredPairwiseMouseDrag$(this._component.name,this._container.mouseService).pipe(Ct((([e,t])=>!(e.ctrlKey&&t.ctrlKey)))):Me())),ui(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$),tt((([[e,t],i,r])=>{const n=[0,0,1],a=[0,0,-2],o=this._planeIntersection(t,n,a,i.perspective,this._container.container),s=this._planeIntersection(e,n,a,i.perspective,this._container.container);if(!o||!s)return null;return(new xr).subVectors(o,s).multiplyScalar(-1).toArray()})),Ct((e=>!!e))).subscribe((e=>{this._navigator.stateService.truck(e)}))),t.push(e.pipe(oi((e=>e?wg.filteredPairwiseMouseDrag$(this._component.name,this._container.mouseService).pipe(Ct((([e,t])=>e.ctrlKey&&t.ctrlKey))):Me())),tt((([e,t])=>this._mousePairToRotation(e,t)))).subscribe((e=>{this._navigator.stateService.orbit(e)}))),t.push(e.pipe(oi((e=>e?wg.filteredPairwiseMouseRightDrag$(this._component.name,this._container.mouseService).pipe(Ct((([e,t])=>!e.ctrlKey&&!t.ctrlKey))):Me())),tt((([e,t])=>this._mousePairToRotation(e,t)))).subscribe((e=>{this._navigator.stateService.orbit(e)}))),t.push(e.pipe(oi((e=>e?this._container.mouseService.filteredWheel$(this._component.name,this._container.mouseService.mouseWheel$):Me())),tt((e=>{let t=e.deltaY;1===e.deltaMode?t*=40:2===e.deltaMode&&(t*=800);return-t/this._viewportCoords.containerToCanvas(this._container.container)[1]}))).subscribe((e=>{this._navigator.stateService.dolly(e)})))}_disable(){this._subscriptions.unsubscribe()}_getConfiguration(){return{}}_eventToViewport(e,t){const i=this._viewportCoords.canvasPosition(e,t);return this._viewportCoords.canvasToViewport(i[0],i[1],t)}_mousePairToRotation(e,t){const[i,r]=this._eventToViewport(t,this._container.container),[n,a]=this._eventToViewport(e,this._container.container);return{phi:(n-i)*Math.PI,theta:(r-a)*Math.PI/2}}_planeIntersection(e,t,i,r,n){const[a,o]=this._viewportCoords.canvasPosition(e,n),s=this._viewportCoords.unprojectFromCanvas(a,o,n,r).sub(r.position).normalize();if(Math.abs(this._spatial.angleToPlane(s.toArray(),t))<Math.PI/90)return null;const l=r.position.clone(),c=(new xr).fromArray(t),u=(new xr).fromArray(i),h=(new xr).subVectors(u,l).dot(c)/s.clone().dot(c),p=(new xr).addVectors(l,s.multiplyScalar(h));return this._viewportCoords.worldToCamera(p.toArray(),r)[2]>0?null:p}}class Tg extends ag{constructor(e,t,i,r){super(e,t,i),this._viewportCoords=r}_enable(){this._container.mouseService.claimWheel(this._component.name,0),this._preventDefaultSubscription=this._container.mouseService.mouseWheel$.subscribe((e=>{e.preventDefault()})),this._zoomSubscription=this._container.mouseService.filteredWheel$(this._component.name,this._container.mouseService.mouseWheel$).pipe(ui(this._navigator.stateService.currentState$,((e,t)=>[e,t])),Ct((e=>{let t=e[1].state;return Qh(t.currentImage.cameraType)||t.imagesAhead<1})),tt((e=>e[0])),ui(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$,((e,t,i)=>[e,t,i]))).subscribe((e=>{let t=e[0],i=e[1],r=e[2],n=this._container.container,[a,o]=this._viewportCoords.canvasPosition(t,n),s=this._viewportCoords.unprojectFromCanvas(a,o,n,i.perspective),l=r.projectBasic(s.toArray()),c=t.deltaY;1===t.deltaMode?c*=40:2===t.deltaMode&&(c*=800);let u=-3*c/this._viewportCoords.containerToCanvas(n)[1];this._navigator.stateService.zoomIn(u,l)}))}_disable(){this._container.mouseService.unclaimWheel(this._component.name),this._preventDefaultSubscription.unsubscribe(),this._zoomSubscription.unsubscribe(),this._preventDefaultSubscription=null,this._zoomSubscription=null}_getConfiguration(e){return{scrollZoom:e}}}class Eg extends ag{constructor(e,t,i,r){super(e,t,i),this._viewportCoords=r}_enable(){this._preventDefaultSubscription=this._container.touchService.pinch$.subscribe((e=>{e.originalEvent.preventDefault()}));let e=this._container.touchService.pinchStart$.pipe(tt((e=>!0))),t=this._container.touchService.pinchEnd$.pipe(tt((e=>!1)));this._activeSubscription=Mt(e,t).subscribe(this._container.touchService.activate$),this._zoomSubscription=this._container.touchService.pinch$.pipe(ui(this._navigator.stateService.currentState$),Ct((e=>{let t=e[1].state;return Qh(t.currentImage.cameraType)||t.imagesAhead<1})),tt((e=>e[0])),ui(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$)).subscribe((([e,t,i])=>{let r=this._container.container,[n,a]=this._viewportCoords.canvasPosition(e,r),o=this._viewportCoords.unprojectFromCanvas(n,a,r,t.perspective),s=i.projectBasic(o.toArray());const[l,c]=this._viewportCoords.containerToCanvas(r);let u=3*e.distanceChange/Math.min(l,c);this._navigator.stateService.zoomIn(u,s)}))}_disable(){this._activeSubscription.unsubscribe(),this._preventDefaultSubscription.unsubscribe(),this._zoomSubscription.unsubscribe(),this._preventDefaultSubscription=null,this._zoomSubscription=null}_getConfiguration(e){return{touchZoom:e}}}class Cg extends Em{constructor(e,t,i){super(e,t,i);const r=new Kh,n=new Im;this._bounceHandler=new bg(this,t,i,n,r),this._dragPanHandler=new Sg(this,t,i,n,r),this._earthControlHandler=new Mg(this,t,i,n,r),this._scrollZoomHandler=new Tg(this,t,i,n),this._touchZoomHandler=new Eg(this,t,i,n)}get dragPan(){return this._dragPanHandler}get earthControl(){return this._earthControlHandler}get scrollZoom(){return this._scrollZoomHandler}get touchZoom(){return this._touchZoomHandler}_activate(){this._bounceHandler.enable(),this._subscriptions.push(this._configuration$.subscribe((e=>{e.dragPan?this._dragPanHandler.enable():this._dragPanHandler.disable(),e.earthControl?this._earthControlHandler.enable():this._earthControlHandler.disable(),e.scrollZoom?this._scrollZoomHandler.enable():this._scrollZoomHandler.disable(),e.touchZoom?this._touchZoomHandler.enable():this._touchZoomHandler.disable()}))),this._container.mouseService.claimMouse(this._name,0)}_deactivate(){this._container.mouseService.unclaimMouse(this._name),this._subscriptions.unsubscribe(),this._bounceHandler.disable(),this._dragPanHandler.disable(),this._earthControlHandler.disable(),this._scrollZoomHandler.disable(),this._touchZoomHandler.disable()}_getDefaultConfiguration(){return{dragPan:!0,earthControl:!0,scrollZoom:!0,touchZoom:!0}}}Cg.componentName="pointer";class Ag{constructor(e){this._document=e||document}get document(){return this._document}createElement(e,t,i){const r=this._document.createElement(e);return t&&(r.className=t),i&&i.appendChild(r),r}}class Ig extends Em{constructor(e,t,i,r){super(e,t,i),this._dom=r||new Ag,this._popups=[],this._added$=new he,this._popups$=new he}add(e){for(const t of e)-1===this._popups.indexOf(t)&&(this._popups.push(t),this._activated&&t.setParentContainer(this._popupContainer));this._added$.next(e),this._popups$.next(this._popups)}getAll(){return this._popups.slice()}remove(e){for(const t of e)this._remove(t);this._popups$.next(this._popups)}removeAll(){for(const e of this._popups.slice())this._remove(e);this._popups$.next(this._popups)}_activate(){this._popupContainer=this._dom.createElement("div","mapillary-popup-container",this._container.container);for(const i of this._popups)i.setParentContainer(this._popupContainer);const e=this._subscriptions;e.push(ut(this._container.renderService.renderCamera$,this._container.renderService.size$,this._navigator.stateService.currentTransform$).subscribe((([e,t,i])=>{for(const r of this._popups)r.update(e,t,i)})));const t=this._popups$.pipe(ai(this._popups),oi((e=>Oe(e).pipe(ft((e=>e.changed$))))),tt((e=>[e])));e.push(Mt(this._added$,t).pipe(ui(this._container.renderService.renderCamera$,this._container.renderService.size$,this._navigator.stateService.currentTransform$)).subscribe((([e,t,i,r])=>{for(const n of e)n.update(t,i,r)})))}_deactivate(){this._subscriptions.unsubscribe();for(const e of this._popups)e.remove();this._container.container.removeChild(this._popupContainer),delete this._popupContainer}_getDefaultConfiguration(){return{}}_remove(e){const t=this._popups.indexOf(e);if(-1===t)return;const i=this._popups.splice(t,1)[0];this._activated&&i.remove()}}Ig.componentName="popup",function(e){e[e.Sequence=0]="Sequence",e[e.Spatial=1]="Spatial"}(tg||(tg={})),function(e){e[e.Default=0]="Default",e[e.Playback=1]="Playback",e[e.Timeline=2]="Timeline"}(ig||(ig={}));class Pg{constructor(e){this._container=e,this._minThresholdWidth=320,this._maxThresholdWidth=1480,this._minThresholdHeight=240,this._maxThresholdHeight=820,this._stepperDefaultWidth=108,this._controlsDefaultWidth=88,this._defaultHeight=30,this._expandControls=!1,this._mode=ig.Default,this._speed=.5,this._changingSpeed=!1,this._index=null,this._changingPosition=!1,this._mouseEnterDirection$=new he,this._mouseLeaveDirection$=new he,this._notifyChanged$=new he,this._notifyChangingPositionChanged$=new he,this._notifySpeedChanged$=new he,this._notifyIndexChanged$=new he}get changed$(){return this._notifyChanged$}get changingPositionChanged$(){return this._notifyChangingPositionChanged$}get speed$(){return this._notifySpeedChanged$}get index$(){return this._notifyIndexChanged$}get mouseEnterDirection$(){return this._mouseEnterDirection$}get mouseLeaveDirection$(){return this._mouseLeaveDirection$}activate(){this._changingSubscription||(this._changingSubscription=Mt(this._container.mouseService.documentMouseUp$,this._container.touchService.touchEnd$.pipe(Ct((e=>0===e.touches.length)))).subscribe((()=>{this._changingSpeed&&(this._changingSpeed=!1),this._changingPosition&&this._setChangingPosition(!1)})))}deactivate(){this._changingSubscription&&(this._changingSpeed=!1,this._changingPosition=!1,this._expandControls=!1,this._mode=ig.Default,this._changingSubscription.unsubscribe(),this._changingSubscription=null)}render(e,t,i,r,n,a,o,s,l){if(!1===t.visible)return Sm.h("div.mapillary-sequence-container",{},[]);const c=this._createStepper(e,t,o,i,s,l),u=this._createSequenceControls(i),h=this._createPlaybackControls(i,r,s,t),p=this._createTimelineControls(i,n,a);return Sm.h("div.mapillary-sequence-container",[c,u,h,p])}getContainerWidth(e,t){let i=t.minWidth,r=t.maxWidth;r<i&&(r=i);let n=(e.width-this._minThresholdWidth)/(this._maxThresholdWidth-this._minThresholdWidth),a=(e.height-this._minThresholdHeight)/(this._maxThresholdHeight-this._minThresholdHeight);return i+Math.max(0,Math.min(1,Math.min(n,a)))*(r-i)}_createPositionInput(e,t){this._index=e;const i=e=>{this._index=Number(e.target.value),this._notifyIndexChanged$.next(this._index)},r=this._container.domContainer.getBoundingClientRect(),n=e=>{e.stopPropagation(),this._setChangingPosition(!0)},a=e=>{!0===this._changingPosition&&e.stopPropagation()},o={max:null!=t?t:1,min:0,onchange:i,oninput:i,onkeydown:e=>{"ArrowDown"!==e.key&&"ArrowLeft"!==e.key&&"ArrowRight"!==e.key&&"ArrowUp"!==e.key||e.preventDefault()},onpointerdown:n,onpointermove:a,ontouchmove:a,ontouchstart:n,style:{width:`${Math.max(276,Math.min(410,5+.8*r.width))-65}px`},type:"range",value:null!=e?e:0},s=null==e||null==t||t<=1;s&&(o.disabled="true");const l=Sm.h("input.mapillary-sequence-position",o,[]),c=s?".mapillary-sequence-position-container-inactive":".mapillary-sequence-position-container";return Sm.h("div"+c,[l])}_createSpeedInput(e){this._speed=e;const t=e=>{this._speed=Number(e.target.value)/1e3,this._notifySpeedChanged$.next(this._speed)},i=this._container.domContainer.getBoundingClientRect(),r=Math.max(276,Math.min(410,5+.8*i.width))-160,n=e=>{this._changingSpeed=!0,e.stopPropagation()},a=e=>{!0===this._changingSpeed&&e.stopPropagation()},o=Sm.h("input.mapillary-sequence-speed",{max:1e3,min:0,onchange:t,oninput:t,onkeydown:e=>{"ArrowDown"!==e.key&&"ArrowLeft"!==e.key&&"ArrowRight"!==e.key&&"ArrowUp"!==e.key||e.preventDefault()},onpointerdown:n,onpointermove:a,ontouchmove:a,ontouchstart:n,style:{width:`${r}px`},type:"range",value:1e3*e},[]);return Sm.h("div.mapillary-sequence-speed-container",[o])}_createPlaybackControls(e,t,i,r){if(this._mode!==ig.Playback)return Sm.h("div.mapillary-sequence-playback",[]);const n=Sm.h("div.mapillary-sequence-switch-icon.mapillary-sequence-icon-visible",[]),a=r.direction===Hh.Next?Hh.Prev:Hh.Next,o=r.playing,s={onclick:()=>{o||i.configure({direction:a})}},l=r.playing?".mapillary-sequence-switch-button-inactive":".mapillary-sequence-switch-button",c=Sm.h("div"+l,s,[n]),u=Sm.h("div.mapillary-sequence-slow-icon.mapillary-sequence-icon-visible",[]),h=Sm.h("div.mapillary-sequence-slow-container",[u]),p=Sm.h("div.mapillary-sequence-fast-icon.mapillary-sequence-icon-visible",[]),d=Sm.h("div.mapillary-sequence-fast-container",[p]),f=Sm.h("div.mapillary-sequence-close-icon.mapillary-sequence-icon-visible",[]),m={onclick:()=>{this._mode=ig.Default,this._notifyChanged$.next(this)}},g=Sm.h("div.mapillary-sequence-close-button",m,[f]),_=[c,h,this._createSpeedInput(t),d,g],y={style:{top:`${Math.round(e/this._stepperDefaultWidth*this._defaultHeight+10)}px`}};return Sm.h("div.mapillary-sequence-playback",y,_)}_createPlayingButton(e,t,i,r,n){let a=r.direction===Hh.Next&&null!=e||r.direction===Hh.Prev&&null!=t;a=a&&i;let o={onclick:r.playing?()=>{n.stop()}:a?()=>{n.play()}:null},s={};r.direction===Hh.Prev&&(s.style={transform:"rotate(180deg) translate(50%, 50%)"});let l=Sm.h("div.mapillary-sequence-icon",s,[]),c=r.playing?"mapillary-sequence-stop":a?"mapillary-sequence-play":"mapillary-sequence-play-inactive";return Sm.h("div."+c,o,[l])}_createSequenceControls(e){const t=Math.round(8/this._stepperDefaultWidth*e),i={onclick:()=>{this._expandControls=!this._expandControls,this._mode=ig.Default,this._notifyChanged$.next(this)},style:{"border-bottom-right-radius":`${t}px`,"border-top-right-radius":`${t}px`}},r=Sm.h("div.mapillary-sequence-expander-bar",[]),n=Sm.h("div.mapillary-sequence-expander-button",i,[r]),a=this._mode===ig.Playback?".mapillary-sequence-fast-icon-gray.mapillary-sequence-icon-visible":".mapillary-sequence-fast-icon",o=Sm.h("div"+a,[]),s={onclick:()=>{this._mode=this._mode===ig.Playback?ig.Default:ig.Playback,this._notifyChanged$.next(this)}},l=Sm.h("div.mapillary-sequence-playback-button",s,[o]),c=this._mode===ig.Timeline?".mapillary-sequence-timeline-icon-gray.mapillary-sequence-icon-visible":".mapillary-sequence-timeline-icon",u=Sm.h("div"+c,[]),h={onclick:()=>{this._mode=this._mode===ig.Timeline?ig.Default:ig.Timeline,this._notifyChanged$.next(this)}},p=Sm.h("div.mapillary-sequence-timeline-button",h,[u]),d={style:{height:this._defaultHeight/this._stepperDefaultWidth*e+"px",transform:`translate(${e/2+2}px, 0)`,width:this._controlsDefaultWidth/this._stepperDefaultWidth*e+"px"}},f=".mapillary-sequence-controls"+(this._expandControls?".mapillary-sequence-controls-expanded":"");return Sm.h("div"+f,d,[l,p,n])}_createSequenceArrows(e,t,i,r,n){let a={onclick:null!=e?()=>{n.moveDir$(Hh.Next).subscribe(void 0,(e=>{e instanceof Rm||console.error(e)}))}:null,onpointerenter:()=>{this._mouseEnterDirection$.next(Hh.Next)},onpointerleave:()=>{this._mouseLeaveDirection$.next(Hh.Next)}};const o=Math.round(8/this._stepperDefaultWidth*i);let s={onclick:null!=t?()=>{n.moveDir$(Hh.Prev).subscribe(void 0,(e=>{e instanceof Rm||console.error(e)}))}:null,onpointerenter:()=>{this._mouseEnterDirection$.next(Hh.Prev)},onpointerleave:()=>{this._mouseLeaveDirection$.next(Hh.Prev)},style:{"border-bottom-left-radius":`${o}px`,"border-top-left-radius":`${o}px`}},l=this._getStepClassName(Hh.Next,e,r.highlightId),c=this._getStepClassName(Hh.Prev,t,r.highlightId),u=Sm.h("div.mapillary-sequence-icon",[]),h=Sm.h("div.mapillary-sequence-icon",[]);return[Sm.h("div."+c,s,[h]),Sm.h("div."+l,a,[u])]}_createStepper(e,t,i,r,n,a){let o=null,s=null;for(let h of e.edges)h.data.direction===Hh.Next&&(o=h.target),h.data.direction===Hh.Prev&&(s=h.target);const l=this._createPlayingButton(o,s,i,t,n),c=this._createSequenceArrows(o,s,r,t,a);c.splice(1,0,l);const u={oncontextmenu:e=>{e.preventDefault()},style:{height:this._defaultHeight/this._stepperDefaultWidth*r+"px",width:r+"px"}};return Sm.h("div.mapillary-sequence-stepper",u,c)}_createTimelineControls(e,t,i){if(this._mode!==ig.Timeline)return Sm.h("div.mapillary-sequence-timeline",[]);const r=this._createPositionInput(t,i),n=Sm.h("div.mapillary-sequence-close-icon.mapillary-sequence-icon-visible",[]),a={onclick:()=>{this._mode=ig.Default,this._notifyChanged$.next(this)}},o=Sm.h("div.mapillary-sequence-close-button",a,[n]),s={style:{top:`${Math.round(e/this._stepperDefaultWidth*this._defaultHeight+10)}px`}};return Sm.h("div.mapillary-sequence-timeline",s,[r,o])}_getStepClassName(e,t,i){let r=e===Hh.Next?"mapillary-sequence-step-next":"mapillary-sequence-step-prev";return null==t?r+="-inactive":i===t&&(r+="-highlight"),r}_setChangingPosition(e){this._changingPosition=e,this._notifyChangingPositionChanged$.next(e)}}class zg extends Em{constructor(e,t,i,r,n){super(e,t,i),this._sequenceDOMRenderer=r||new Pg(t),this._scheduler=n,this._containerWidth$=new he,this._hoveredIdSubject$=new he,this._hoveredId$=this._hoveredIdSubject$.pipe(ti()),this._navigator.playService.playing$.pipe(ri(1),ui(this._configuration$)).subscribe((([e,t])=>{const i="playing",r={playing:e,target:this,type:i};this.fire(i,r),e!==t.playing&&(e?this.play():this.stop())})),this._navigator.playService.direction$.pipe(ri(1),ui(this._configuration$)).subscribe((([e,t])=>{e!==t.direction&&this.configure({direction:e})}))}fire(e,t){super.fire(e,t)}off(e,t){super.off(e,t)}on(e,t){super.on(e,t)}play(){this.configure({playing:!0})}stop(){this.configure({playing:!1})}_activate(){this._sequenceDOMRenderer.activate();const e=this._navigator.stateService.currentImage$.pipe(oi((e=>e.sequenceEdges$)),Jt(1),le()),t=this._navigator.stateService.currentImage$.pipe(Vt(void 0,(e=>e.sequenceId)),oi((e=>_t(Ze(null),this._navigator.graphService.cacheSequence$(e.sequenceId).pipe(Qt(3),zt((e=>(console.error("Failed to cache sequence",e),Ze(null)))))))),ai(null),Jt(1),le()),i=this._subscriptions;i.push(t.subscribe());const r=this._sequenceDOMRenderer.index$.pipe(ui(t),tt((([e,t])=>null!=t?t.imageIds[e]:null)),Ct((e=>!!e)),Vt(),Kt(),le());i.push(Mt(r.pipe(Ft(100,this._scheduler)),r.pipe(It(400,this._scheduler))).pipe(Vt(),oi((e=>this._navigator.moveTo$(e).pipe(zt((()=>Me())))))).subscribe()),i.push(this._sequenceDOMRenderer.changingPositionChanged$.pipe(Ct((e=>e))).subscribe((()=>{this._navigator.graphService.setGraphMode(tg.Sequence)}))),i.push(this._sequenceDOMRenderer.changingPositionChanged$.pipe(Ct((e=>!e))).subscribe((()=>{this._navigator.graphService.setGraphMode(tg.Spatial)}))),this._navigator.graphService.graphMode$.pipe(oi((e=>e===tg.Spatial?this._navigator.stateService.currentImage$.pipe(Nt(2)):Me())),Ct((e=>!e.spatialEdges.cached)),oi((e=>this._navigator.graphService.cacheImage$(e.id).pipe(zt((()=>Me())))))).subscribe(),i.push(this._sequenceDOMRenderer.changingPositionChanged$.pipe(Ct((e=>e))).subscribe((()=>{this._navigator.playService.stop()}))),i.push(ut(this._navigator.graphService.graphMode$,this._sequenceDOMRenderer.changingPositionChanged$.pipe(ai(!1),Vt())).pipe(ui(this._navigator.stateService.currentImage$),oi((([[e,t],i])=>t&&e===tg.Sequence?this._navigator.graphService.cacheSequenceImages$(i.sequenceId,i.id).pipe(Qt(3),zt((e=>(console.error("Failed to cache sequence images.",e),Me())))):Me()))).subscribe());const n=t.pipe(oi((e=>{if(!e)return Ze({index:null,max:null});let t=!0;return this._sequenceDOMRenderer.changingPositionChanged$.pipe(ai(!1),Vt(),oi((e=>{const i=!e&&t?0:1;return t=!1,e?r:this._navigator.stateService.currentImage$.pipe(tt((e=>e.id)),Vt(),ri(i))})),tt((t=>{const i=e.imageIds.indexOf(t);return-1===i?{index:null,max:null}:{index:i,max:e.imageIds.length-1}})))}))),a=this._navigator.stateService.state$.pipe(tt((e=>e===eg.Earth)),Vt());i.push(ut(e,this._configuration$,this._containerWidth$,this._sequenceDOMRenderer.changed$.pipe(ai(this._sequenceDOMRenderer)),this._navigator.playService.speed$,n,a).pipe(tt((([e,t,i,,r,n,a])=>{const o=this._sequenceDOMRenderer.render(e,t,i,r,n.index,n.max,!a,this,this._navigator);return{name:this._name,vNode:o}}))).subscribe(this._container.domRenderer.render$)),i.push(this._sequenceDOMRenderer.speed$.subscribe((e=>{this._navigator.playService.setSpeed(e)}))),i.push(this._configuration$.pipe(tt((e=>e.direction)),Vt()).subscribe((e=>{this._navigator.playService.setDirection(e)}))),i.push(ut(this._container.renderService.size$,this._configuration$.pipe(Vt(((e,t)=>e[0]===t[0]&&e[1]===t[1]),(e=>[e.minWidth,e.maxWidth])))).pipe(tt((([e,t])=>this._sequenceDOMRenderer.getContainerWidth(e,t)))).subscribe(this._containerWidth$)),i.push(this._configuration$.pipe(tt((e=>e.playing)),Vt()).subscribe((e=>{e?this._navigator.playService.play():this._navigator.playService.stop()}))),i.push(this._sequenceDOMRenderer.mouseEnterDirection$.pipe(oi((t=>_t(e.pipe(tt((e=>{for(let i of e.edges)if(i.data.direction===t)return i.target;return null})),si(this._sequenceDOMRenderer.mouseLeaveDirection$)),Ze(null)))),Vt()).subscribe(this._hoveredIdSubject$)),i.push(this._hoveredId$.subscribe((e=>{const t="hover",i={id:e,target:this,type:t};this.fire(t,i)})))}_deactivate(){this._subscriptions.unsubscribe(),this._sequenceDOMRenderer.deactivate()}_getDefaultConfiguration(){return{direction:Hh.Next,maxWidth:108,minWidth:70,playing:!1,visible:!0}}}zg.componentName="sequence",function(e){e[e.Motion=0]="Motion",e[e.Stationary=1]="Stationary"}(rg||(rg={}));class Rg{constructor(e,t,i,r,n,a,o,s,l,c){this._orientation=this._getValue(e,1);let u=null!=o?o.width:4,h=null!=o?o.height:3,p=this._orientation<5;this._width=this._getValue(t,p?u:h),this._height=this._getValue(i,p?h:u),this._basicAspect=p?this._width/this._height:this._height/this._width,this._basicWidth=p?t:i,this._basicHeight=p?i:t;const d=this._getCameraParameters(l,c),f=d[0],m=d[1],g=d[2];this._focal=this._getValue(f,1),this._scale=this._getValue(r,0),this._worldToCamera=this.createWorldToCamera(n,a),this._worldToCameraInverse=(new Kr).copy(this._worldToCamera).invert(),this._scaledWorldToCamera=this._createScaledWorldToCamera(this._worldToCamera,this._scale),this._scaledWorldToCameraInverse=(new Kr).copy(this._scaledWorldToCamera).invert(),this._basicWorldToCamera=this._createBasicWorldToCamera(this._worldToCamera,e),this._textureScale=s||[1,1],this._ck1=m||0,this._ck2=g||0,this._cameraType=c||"perspective",this._radialPeak=this._getRadialPeak(this._ck1,this._ck2)}get ck1(){return this._ck1}get ck2(){return this._ck2}get cameraType(){return this._cameraType}get basicAspect(){return this._basicAspect}get basicHeight(){return this._basicHeight}get basicRt(){return this._basicWorldToCamera}get basicWidth(){return this._basicWidth}get focal(){return this._focal}get height(){return this._height}get orientation(){return this._orientation}get rt(){return this._worldToCamera}get srt(){return this._scaledWorldToCamera}get srtInverse(){return this._scaledWorldToCameraInverse}get scale(){return this._scale}get hasValidScale(){return this._scale>.01&&this._scale<50}get radialPeak(){return this._radialPeak}get width(){return this._width}upVector(){let e=this._worldToCamera.elements;switch(this._orientation){case 1:default:return new xr(-e[1],-e[5],-e[9]);case 3:return new xr(e[1],e[5],e[9]);case 6:return new xr(-e[0],-e[4],-e[8]);case 8:return new xr(e[0],e[4],e[8])}}projectorMatrix(){let e=this._normalizedToTextureMatrix(),t=this._focal,i=(new Kr).set(t,0,0,0,0,t,0,0,0,0,0,0,0,0,1,0);return e.multiply(i),e.multiply(this._worldToCamera),e}projectBasic(e){let t=this.projectSfM(e);return this._sfmToBasic(t)}unprojectBasic(e,t,i){let r=this._basicToSfm(e);return this.unprojectSfM(r,t,i)}projectSfM(e){let t=new gr(e[0],e[1],e[2],1);return t.applyMatrix4(this._worldToCamera),this._bearingToSfm([t.x,t.y,t.z])}unprojectSfM(e,t,i){const r=this._sfmToBearing(e),n=(i&&!Qh(this._cameraType)?new gr(t*r[0]/r[2],t*r[1]/r[2],t,1):new gr(t*r[0],t*r[1],t*r[2],1)).applyMatrix4(this._worldToCameraInverse);return[n.x/n.w,n.y/n.w,n.z/n.w]}_sfmToBearing(e){if(Qh(this._cameraType)){let t=2*e[0]*Math.PI,i=2*-e[1]*Math.PI;return[Math.cos(i)*Math.sin(t),-Math.sin(i),Math.cos(i)*Math.cos(t)]}if(ep(this._cameraType)){let[t,i]=[e[0]/this._focal,e[1]/this._focal];const r=Math.sqrt(t*t+i*i);let n=r/this._distortionFromDistortedRadius(r,this._ck1,this._ck2,this._radialPeak),a=Math.cos(n),o=Math.sin(n);const s=r>1e-8?1/r:1;return[o*t*s,o*i*s,a]}{let[t,i]=[e[0]/this._focal,e[1]/this._focal];const r=Math.sqrt(t*t+i*i);let n=this._distortionFromDistortedRadius(r,this._ck1,this._ck2,this._radialPeak);let a=new xr(t/n,i/n,1);return a.normalize(),[a.x,a.y,a.z]}}_distortionFromDistortedRadius(e,t,i,r){let n=1;for(let a=0;a<10;a++){let a=e/n;a>r&&(a=r),n=1+t*Math.pow(a,2)+i*Math.pow(a,4)}return n}_bearingToSfm(e){if(Qh(this._cameraType)){let t=e[0],i=e[1],r=e[2],n=Math.atan2(t,r),a=Math.atan2(-i,Math.sqrt(t*t+r*r));return[n/(2*Math.PI),-a/(2*Math.PI)]}if(ep(this._cameraType)){if(e[2]>0){const[t,i,r]=e,n=Math.sqrt(t*t+i*i);let a=Math.atan2(n,r);a>this._radialPeak&&(a=this._radialPeak);const o=1+Math.pow(a,2)*(this._ck1+Math.pow(a,2)*this._ck2),s=this._focal*o*a/n;return[s*t,s*i]}return[e[0]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,e[1]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY]}if(e[2]>0){let[t,i]=[e[0]/e[2],e[1]/e[2]],r=t*t+i*i;const n=Math.pow(this._radialPeak,2);r>n&&(r=n);const a=1+this._ck1*r+this._ck2*Math.pow(r,2);return[this._focal*a*t,this._focal*a*i]}return[e[0]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,e[1]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY]}_basicToSfm(e){let t,i;switch(this._orientation){case 1:default:t=e[0],i=e[1];break;case 3:t=1-e[0],i=1-e[1];break;case 6:t=e[1],i=1-e[0];break;case 8:t=1-e[1],i=e[0]}let r=this._width,n=this._height,a=Math.max(r,n);return[t*r/a-r/a/2,i*n/a-n/a/2]}_sfmToBasic(e){let t,i,r=this._width,n=this._height,a=Math.max(r,n),o=(e[0]+r/a/2)/r*a,s=(e[1]+n/a/2)/n*a;switch(this._orientation){case 1:default:t=o,i=s;break;case 3:t=1-o,i=1-s;break;case 6:t=1-s,i=o;break;case 8:t=s,i=1-o}return[t,i]}_getValue(e,t){return null!=e&&e>0?e:t}_getCameraParameters(e,t){if(Qh(t))return[];if(!e||0===e.length)return[1,0,0];const i=3-e.length;return i<=0?e:e.concat(new Array(i).fill(0))}createWorldToCamera(e,t){const i=new xr(e[0],e[1],e[2]),r=i.length();r>0&&i.normalize();const n=new Kr;return n.makeRotationAxis(i,r),n.setPosition(new xr(t[0],t[1],t[2])),n}_createScaledWorldToCamera(e,t){const i=e.clone(),r=i.elements;return r[12]=t*r[12],r[13]=t*r[13],r[14]=t*r[14],i.scale(new xr(t,t,t)),i}_createBasicWorldToCamera(e,t){const i=new xr(0,0,1);let r=0;switch(t){case 3:r=Math.PI;break;case 6:r=Math.PI/2;break;case 8:r=3*Math.PI/2}return(new Kr).makeRotationAxis(i,r).multiply(e)}_getRadialPeak(e,t){const i=5*t,r=3*e,n=Math.pow(r,2)-4*i*1;if(n<0)return;const a=(-r-Math.sqrt(n))/2/i,o=(-r+Math.sqrt(n))/2/i,s=Math.min(a,o),l=Math.max(a,o);return s>0?Math.sqrt(s):l>0?Math.sqrt(l):void 0}_normalizedToTextureMatrix(){const e=Math.max(this._width,this._height),t=this._orientation<5?this._textureScale[0]:this._textureScale[1],i=this._orientation<5?this._textureScale[1]:this._textureScale[0],r=e/this._width*t,n=e/this._height*i;switch(this._orientation){case 1:default:return(new Kr).set(r,0,0,.5,0,-n,0,.5,0,0,1,0,0,0,0,1);case 3:return(new Kr).set(-r,0,0,.5,0,n,0,.5,0,0,1,0,0,0,0,1);case 6:return(new Kr).set(0,-n,0,.5,-r,0,0,.5,0,0,1,0,0,0,0,1);case 8:return(new Kr).set(0,n,0,.5,r,0,0,.5,0,0,1,0,0,0,0,1)}}}class kg{constructor(){this._factory=new Fm,this._scene=new Om,this._spatial=new Kh,this._currentKey=null,this._previousKey=null,this._disabled=!1,this._curtain=1,this._frameId=0,this._needsRender=!1,this._mode=null,this._currentProviderDisposers={},this._previousProviderDisposers={}}get disabled(){return this._disabled}get frameId(){return this._frameId}get needsRender(){return this._needsRender}setTextureProvider(e,t){this._setTextureProvider(e,this._currentKey,t,this._currentProviderDisposers,this._updateTexture.bind(this))}setTextureProviderPrev(e,t){this._setTextureProvider(e,this._previousKey,t,this._previousProviderDisposers,this._updateTexturePrev.bind(this))}update(e,t){this._updateFrameId(e.id),this._updateImagePlanes(e.state,t)}updateCurtain(e){this._curtain!==e&&(this._curtain=e,this._updateCurtain(),this._needsRender=!0)}updateTexture(e,t){const i=t.id===this._currentKey?this._scene.planes:t.id===this._previousKey?this._scene.planesOld:{};if(0!==Object.keys(i).length){this._needsRender=!0;for(const t in i){if(!i.hasOwnProperty(t))continue;let r=i[t].material.uniforms.projectorTex.value;r.image=e,r.needsUpdate=!0}}}updateTextureImage(e,t){if(this._currentKey!==t.id)return;this._needsRender=!0;const i=this._scene.planes;for(const r in i){if(!i.hasOwnProperty(r))continue;let t=i[r].material.uniforms.projectorTex.value;t.image=e,t.needsUpdate=!0}}render(e,t){this.disabled||t.render(this._scene.sceneOld,e),t.render(this._scene.scene,e),this._needsRender=!1}dispose(){this._scene.clear();for(const e in this._currentProviderDisposers)this._currentProviderDisposers.hasOwnProperty(e)&&this._currentProviderDisposers[e]();for(const e in this._previousProviderDisposers)this._previousProviderDisposers.hasOwnProperty(e)&&this._previousProviderDisposers[e]();this._currentProviderDisposers={},this._previousProviderDisposers={}}_getBasicCorners(e,t){let i,r;return e>t?(i=.5,r=.5*e/t):(i=.5*t/e,r=.5),[[.5-i,.5-r],[.5+i,.5+r]]}_setDisabled(e){this._disabled=null==e.currentImage||null==e.previousImage||Qh(e.currentImage.cameraType)&&!Qh(e.previousImage.cameraType)}_setTextureProvider(e,t,i,r,n){if(e!==t)return;let a=i.textureCreated$.subscribe(n),o=i.textureUpdated$.subscribe((e=>{this._needsRender=!0}));if(e in r){(0,r[e])(),delete r[e]}r[e]=()=>{a.unsubscribe(),o.unsubscribe(),i.dispose()}}_updateCurtain(){const e=this._scene.planes;for(const t in e){if(!e.hasOwnProperty(t))continue;let i=e[t].material;i.uniforms.curtain&&(i.uniforms.curtain.value=this._curtain)}}_updateFrameId(e){this._frameId=e}_updateImagePlanes(e,t){const i=null!=e.currentImage&&this._currentKey!==e.currentImage.id,r=null!=e.previousImage&&this._previousKey!==e.previousImage.id,n=this._mode!==t;if(!(i||r||n))return;this._setDisabled(e),this._needsRender=!0,this._mode=t;const a=e.motionless||t===rg.Stationary||Qh(e.currentImage.cameraType);if((this.disabled||r)&&this._previousKey in this._previousProviderDisposers&&(this._previousProviderDisposers[this._previousKey](),delete this._previousProviderDisposers[this._previousKey]),this.disabled)this._scene.setImagePlanesOld({});else if(r||n){const t=e.previousImage;this._previousKey=t.id;const i=e.currentTransform.rt.elements;let r=[i[12],i[13],i[14]];const n=e.currentTransform.basicAspect,o=e.previousTransform.basicAspect,s=n>o?[1,o/n]:[n/o,1];let l=e.currentImage.rotation,c=e.currentImage.width,u=e.currentImage.height;Qh(t.cameraType)&&(l=e.previousImage.rotation,r=this._spatial.rotate(this._spatial.opticalCenter(e.currentImage.rotation,r).toArray(),l).multiplyScalar(-1).toArray(),c=e.previousImage.width,u=e.previousImage.height);const h=new Rg(e.currentImage.exifOrientation,c,u,e.currentImage.scale,l,r,t.image,s,e.currentImage.cameraParameters,e.currentImage.cameraType);let p;if(Qh(t.cameraType))p=this._factory.createMesh(t,a||Qh(e.currentImage.cameraType)?h:e.previousTransform);else if(a){const[[t,i],[r,a]]=this._getBasicCorners(n,o);p=this._factory.createFlatMesh(e.previousImage,h,t,r,i,a)}else p=this._factory.createMesh(e.previousImage,e.previousTransform);const d={};d[t.id]=p,this._scene.setImagePlanesOld(d)}if(i||n){this._currentKey in this._currentProviderDisposers&&(this._currentProviderDisposers[this._currentKey](),delete this._currentProviderDisposers[this._currentKey]),this._currentKey=e.currentImage.id;const t={};Qh(e.currentImage.cameraType)?t[e.currentImage.id]=this._factory.createCurtainMesh(e.currentImage,e.currentTransform):t[e.currentImage.id]=a?this._factory.createDistortedCurtainMesh(e.currentImage,e.currentTransform):this._factory.createCurtainMesh(e.currentImage,e.currentTransform),this._scene.setImagePlanes(t),this._updateCurtain()}}_updateTexture(e){this._needsRender=!0;const t=this._scene.planes;for(const i in t){if(!t.hasOwnProperty(i))continue;let r=t[i].material,n=r.uniforms.projectorTex.value;r.uniforms.projectorTex.value=null,n.dispose(),r.uniforms.projectorTex.value=e}}_updateTexturePrev(e){this._needsRender=!0;const t=this._scene.planesOld;for(const i in t){if(!t.hasOwnProperty(i))continue;let r=t[i].material,n=r.uniforms.projectorTex.value;r.uniforms.projectorTex.value=null,n.dispose(),r.uniforms.projectorTex.value=e}}}class Lg{constructor(e){this._container=e,this._interacting=!1,this._notifyModeChanged$=new he,this._notifyPositionChanged$=new he,this._stopInteractionSubscription=null}get mode$(){return this._notifyModeChanged$}get position$(){return this._notifyPositionChanged$}activate(){this._stopInteractionSubscription||(this._stopInteractionSubscription=Mt(this._container.mouseService.documentMouseUp$,this._container.touchService.touchEnd$.pipe(Ct((e=>0===e.touches.length)))).subscribe((e=>{this._interacting&&(this._interacting=!1)})))}deactivate(){this._stopInteractionSubscription&&(this._interacting=!1,this._stopInteractionSubscription.unsubscribe(),this._stopInteractionSubscription=null)}render(e,t,i,r,n){const a=[];if(n){a.push(Sm.h("div.mapillary-slider-border",[]));const n=!(i||r);n&&(a.push(this._createModeButton(t)),a.push(this._createModeButton2d(t))),a.push(this._createPositionInput(e,n))}const o=this._container.domContainer.getBoundingClientRect(),s=Math.max(215,Math.min(400,o.width-100));return Sm.h("div.mapillary-slider-container",{style:{width:`${s}px`}},a)}_createModeButton(e){const t={onclick:()=>{e!==rg.Motion&&this._notifyModeChanged$.next(rg.Motion)}},i=e===rg.Stationary?"mapillary-slider-mode-button-inactive":"mapillary-slider-mode-button";return Sm.h("div."+i,t,[Sm.h("div.mapillary-slider-mode-icon",[])])}_createModeButton2d(e){const t={onclick:()=>{e!==rg.Stationary&&this._notifyModeChanged$.next(rg.Stationary)}},i=e===rg.Motion?"mapillary-slider-mode-button-2d-inactive":"mapillary-slider-mode-button-2d";return Sm.h("div."+i,t,[Sm.h("div.mapillary-slider-mode-icon-2d",[])])}_createPositionInput(e,t){const i=e=>{this._notifyPositionChanged$.next(Number(e.target.value)/1e3)},r=e=>{this._interacting=!0,e.stopPropagation()},n=e=>{this._interacting&&e.stopPropagation()},a=this._container.domContainer.getBoundingClientRect(),o=Math.max(215,Math.min(400,a.width-105))-84+(t?0:52),s=Sm.h("input.mapillary-slider-position",{max:1e3,min:0,onchange:i,oninput:i,onkeydown:e=>{"ArrowDown"!==e.key&&"ArrowLeft"!==e.key&&"ArrowRight"!==e.key&&"ArrowUp"!==e.key||e.preventDefault()},onpointerdown:r,onpointermove:n,ontouchmove:n,ontouchstart:r,style:{width:`${o}px`},type:"range",value:1e3*e},[]);return Sm.h("div.mapillary-slider-position-container",[s])}}class Dg extends Em{constructor(e,t,i,r){super(e,t,i),this._viewportCoords=r||new Im,this._domRenderer=new Lg(t),this._imageTileLoader=new Um(i.api),this._roiCalculator=new jm,this._spatial=new Kh,this._glRendererOperation$=new he,this._glRendererCreator$=new he,this._glRendererDisposer$=new he,this._glRenderer$=this._glRendererOperation$.pipe(ei(((e,t)=>t(e)),null),Ct((e=>null!=e)),Vt(void 0,(e=>e.frameId))),this._glRendererCreator$.pipe(tt((()=>e=>{if(null!=e)throw new Error("Multiple slider states can not be created at the same time");return new kg}))).subscribe(this._glRendererOperation$),this._glRendererDisposer$.pipe(tt((()=>e=>(e.dispose(),null)))).subscribe(this._glRendererOperation$)}_activate(){const e=this._subscriptions;e.push(this._domRenderer.mode$.subscribe((e=>{this.configure({mode:e})}))),e.push(this._glRenderer$.pipe(tt((e=>({name:this._name,renderer:{frameId:e.frameId,needsRender:e.needsRender,render:e.render.bind(e),pass:Vm.Background}})))).subscribe(this._container.glRenderer.render$));const t=_t(this.configuration$.pipe(tt((e=>null!=e.initialPosition?e.initialPosition:1)),Ht()),this._domRenderer.position$),i=this.configuration$.pipe(tt((e=>e.mode)),Vt()),r=this._navigator.stateService.currentState$.pipe(tt((e=>e.state.motionless)),Vt()),n=this._navigator.stateService.currentState$.pipe(tt((e=>Qh(e.state.currentImage.cameraType))),Vt()),a=ut(this._configuration$.pipe(tt((e=>e.sliderVisible))),this._navigator.stateService.currentState$.pipe(tt((e=>!(null==e.state.currentImage||null==e.state.previousImage||Qh(e.state.currentImage.cameraType)&&!Qh(e.state.previousImage.cameraType)))),Vt())).pipe(tt((([e,t])=>e&&t)),Vt());this._waitSubscription=ut(i,r,n,a).pipe(ui(this._navigator.stateService.state$)).subscribe((([[e,t,i,r],n])=>{const a=r&&(t||e===rg.Stationary||i);a&&n!==eg.WaitingInteractively?this._navigator.stateService.waitInteractively():a||n===eg.Waiting||this._navigator.stateService.wait()})),e.push(ut(t,i,r,n,a).subscribe((([e,t,i,r])=>{i||t===rg.Stationary||r?this._navigator.stateService.moveTo(1):this._navigator.stateService.moveTo(e)}))),e.push(ut(t,i,r,n,a,this._container.renderService.size$).pipe(tt((([e,t,i,r,n])=>({name:this._name,vNode:this._domRenderer.render(e,t,i,r,n)})))).subscribe(this._container.domRenderer.render$)),this._glRendererCreator$.next(null),e.push(ut(t,n,a,this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$).pipe(tt((([e,t,i,r,n])=>{if(!t)return i?e:1;const a=this._viewportCoords.viewportToBasic(-1.15,0,n,r.perspective),o=this._viewportCoords.viewportToBasic(1.15,0,n,r.perspective),s=o[0]<a[0]?o[0]+1:o[0],l=a[0]+e*(s-a[0]);return l>1?l-1:l})),tt((e=>t=>(t.updateCurtain(e),t)))).subscribe(this._glRendererOperation$)),e.push(ut(this._navigator.stateService.currentState$,i).pipe(tt((([e,t])=>i=>(i.update(e,t),i)))).subscribe(this._glRendererOperation$)),e.push(this._configuration$.pipe(Ct((e=>null!=e.ids)),oi((e=>At(At(this._catchCacheImage$(e.ids.background),this._catchCacheImage$(e.ids.foreground)).pipe(tt((e=>({background:e[0],foreground:e[1]})))),this._navigator.stateService.currentState$.pipe(Ht())).pipe(tt((e=>({images:e[0],state:e[1].state}))))))).subscribe((e=>{null!=e.state.currentImage&&null!=e.state.previousImage&&e.state.currentImage.id===e.images.foreground.id&&e.state.previousImage.id===e.images.background.id||(e.state.currentImage.id!==e.images.background.id?e.state.currentImage.id!==e.images.foreground.id||1!==e.state.trajectory.length?(this._navigator.stateService.setImages([e.images.background]),this._navigator.stateService.setImages([e.images.foreground])):this._navigator.stateService.prependImages([e.images.background]):this._navigator.stateService.setImages([e.images.foreground]))}),(e=>{console.error(e)})));const o=this._container.configurationService.imageTiling$.pipe(oi((e=>e?this._navigator.stateService.currentState$:new he)),Vt(void 0,(e=>e.state.currentImage.id)),ui(this._container.glRenderer.webGLRenderer$,this._container.renderService.size$),tt((([e,t,i])=>{const r=e.state;Math.max(i.width,i.height);const n=r.currentImage,a=r.currentTransform;return new Qm(n.id,a.basicWidth,a.basicHeight,n.image,this._imageTileLoader,new $m,t)})),Jt(1),le());e.push(o.subscribe((()=>{}))),e.push(o.pipe(tt((e=>t=>(t.setTextureProvider(e.id,e),t)))).subscribe(this._glRendererOperation$)),e.push(o.pipe(Yt()).subscribe((e=>{e[0].abort()})));const s=this._container.configurationService.imageTiling$.pipe(oi((e=>e?ut(this._container.renderService.renderCameraFrame$,this._container.renderService.size$.pipe(Ft(250))):new he)),tt((([e,t])=>[e.camera.position.clone(),e.camera.lookat.clone(),e.zoom.valueOf(),t.height.valueOf(),t.width.valueOf()])),Yt(),ni((e=>e[1][2]-e[0][2]<0||0===e[1][2])),tt((e=>{let t=e[0][0].equals(e[1][0]),i=e[0][1].equals(e[1][1]),r=e[0][2]===e[1][2],n=e[0][3]===e[1][3],a=e[0][4]===e[1][4];return t&&i&&r&&n&&a})),Vt(),Ct((e=>e)),oi((()=>this._container.renderService.renderCameraFrame$.pipe(Ht()))),ui(this._container.renderService.size$,this._navigator.stateService.currentTransform$));e.push(o.pipe(oi((e=>s.pipe(tt((([t,i,r])=>[this._roiCalculator.computeRegionOfInterest(t,i,r),e]))))),Ct((e=>!e[1].disposed))).subscribe((e=>{let t=e[0];e[1].setRegionOfInterest(t)})));const l=o.pipe(oi((e=>e.hasTexture$)),ai(!1),Jt(1),le());e.push(l.subscribe((()=>{})));const c=this._container.configurationService.imageTiling$.pipe(oi((e=>e?this._navigator.stateService.currentState$:new he)),Ct((e=>!!e.state.previousImage)),Vt(void 0,(e=>e.state.previousImage.id)),ui(this._container.glRenderer.webGLRenderer$,this._container.renderService.size$),tt((([e,t,i])=>{const r=e.state,n=r.previousImage,a=r.previousTransform;return new Qm(n.id,a.basicWidth,a.basicHeight,n.image,this._imageTileLoader,new $m,t)})),Jt(1),le());e.push(c.subscribe((()=>{}))),e.push(c.pipe(tt((e=>t=>(t.setTextureProviderPrev(e.id,e),t)))).subscribe(this._glRendererOperation$)),e.push(c.pipe(Yt()).subscribe((e=>{e[0].abort()})));const u=this._container.configurationService.imageTiling$.pipe(oi((e=>e?ut(this._container.renderService.renderCameraFrame$,this._container.renderService.size$.pipe(Ft(250))):new he)),tt((([e,t])=>[e.camera.position.clone(),e.camera.lookat.clone(),e.zoom.valueOf(),t.height.valueOf(),t.width.valueOf()])),Yt(),ni((e=>e[1][2]-e[0][2]<0||0===e[1][2])),tt((e=>{let t=e[0][0].equals(e[1][0]),i=e[0][1].equals(e[1][1]),r=e[0][2]===e[1][2],n=e[0][3]===e[1][3],a=e[0][4]===e[1][4];return t&&i&&r&&n&&a})),Vt(),Ct((e=>e)),oi((()=>this._container.renderService.renderCameraFrame$.pipe(Ht()))),ui(this._container.renderService.size$,this._navigator.stateService.currentTransform$));e.push(c.pipe(oi((e=>u.pipe(tt((([t,i,r])=>[this._roiCalculator.computeRegionOfInterest(t,i,r),e]))))),Ct((e=>!e[1].disposed)),ui(this._navigator.stateService.currentState$)).subscribe((([[e,t],i])=>{let r=null;if(Qh(i.state.previousImage.cameraType))if(Qh(i.state.currentImage.cameraType)){const t=this._spatial.viewingDirection(i.state.currentImage.rotation),n=this._spatial.viewingDirection(i.state.previousImage.rotation),a=this._spatial.angleBetweenVector2(t.x,t.y,n.x,n.y)/(2*Math.PI);r={bbox:{maxX:this._spatial.wrap(e.bbox.maxX+a,0,1),maxY:e.bbox.maxY,minX:this._spatial.wrap(e.bbox.minX+a,0,1),minY:e.bbox.minY},pixelHeight:e.pixelHeight,pixelWidth:e.pixelWidth}}else{const t=this._spatial.viewingDirection(i.state.currentImage.rotation),n=this._spatial.viewingDirection(i.state.previousImage.rotation),a=this._spatial.angleBetweenVector2(t.x,t.y,n.x,n.y)/(2*Math.PI),o=this._spatial.angleToPlane(t.toArray(),[0,0,1]),s=(this._spatial.angleToPlane(n.toArray(),[0,0,1])-o)/(2*Math.PI),l=i.state.currentTransform,c=Math.max(l.basicWidth,l.basicHeight),u=c>0?2*Math.atan(.5*l.basicWidth/(c*l.focal)):Math.PI/3,h=c>0?2*Math.atan(.5*l.basicHeight/(c*l.focal)):Math.PI/3,p=u/(2*Math.PI),d=h/Math.PI,f=(e.bbox.maxX-e.bbox.minX)*p,m=(e.bbox.maxY-e.bbox.minY)*d,g=e.pixelWidth*p,_=e.pixelHeight*d,y=(e.bbox.minX+e.bbox.maxX)/2-.5,v=(e.bbox.minY+e.bbox.maxY)/2-.5,x=.5+a+p*y-f/2,b=.5+a+p*y+f/2,w=.5+s+d*v-m/2,S=.5+s+d*v+m/2;r={bbox:{maxX:this._spatial.wrap(b,0,1),maxY:S,minX:this._spatial.wrap(x,0,1),minY:w},pixelHeight:_,pixelWidth:g}}else{const t=i.state.currentTransform.basicAspect,n=i.state.previousTransform.basicAspect,[[a,o],[s,l]]=this._getBasicCorners(t,n),c=s-a,u=l-o,h=e.pixelWidth/c,p=e.pixelHeight/u,d=(c-1)/(2*c)+e.bbox.minX/c,f=(c-1)/(2*c)+e.bbox.maxX/c,m=(u-1)/(2*u)+e.bbox.minY/u,g={maxX:f,maxY:(u-1)/(2*u)+e.bbox.maxY/u,minX:d,minY:m};this._clipBoundingBox(g),r={bbox:g,pixelHeight:p,pixelWidth:h}}t.setRegionOfInterest(r)})));const h=c.pipe(oi((e=>e.hasTexture$)),ai(!1),Jt(1),le());e.push(h.subscribe((()=>{})))}_deactivate(){this._waitSubscription.unsubscribe(),this._navigator.stateService.state$.pipe(Ht()).subscribe((e=>{e!==eg.Traversing&&this._navigator.stateService.traverse()})),this._glRendererDisposer$.next(null),this._domRenderer.deactivate(),this._subscriptions.unsubscribe(),this.configure({ids:null})}_getDefaultConfiguration(){return{initialPosition:1,mode:rg.Motion,sliderVisible:!0}}_catchCacheImage$(e){return this._navigator.graphService.cacheImage$(e).pipe(zt((t=>(console.error(`Failed to cache slider image (${e})`,t),Me()))))}_getBasicCorners(e,t){let i,r;return e>t?(i=.5,r=.5*e/t):(i=.5*t/e,r=.5),[[.5-i,.5-r],[.5+i,.5+r]]}_clipBoundingBox(e){e.minX=Math.max(0,Math.min(1,e.minX)),e.maxX=Math.max(0,Math.min(1,e.maxX)),e.minY=Math.max(0,Math.min(1,e.minY)),e.maxY=Math.max(0,Math.min(1,e.maxY))}}Dg.componentName="slider";class Bg{constructor(e,t){this._subscriptions=new Tm,this._graphService=e,this._stateService=t;const i=this._subscriptions;this._directionSubject$=new he,this._direction$=this._directionSubject$.pipe(ai(Hh.Next),Jt(1),le()),i.push(this._direction$.subscribe()),this._playing=!1,this._playingSubject$=new he,this._playing$=this._playingSubject$.pipe(ai(this._playing),Jt(1),le()),i.push(this._playing$.subscribe()),this._speed=.5,this._speedSubject$=new he,this._speed$=this._speedSubject$.pipe(ai(this._speed),Jt(1),le()),i.push(this._speed$.subscribe()),this._imagesAhead=this._mapImagesAhead(this._mapSpeed(this._speed)),this._bridging$=null}get playing(){return this._playing}get direction$(){return this._direction$}get playing$(){return this._playing$}get speed$(){return this._speed$}play(){if(this._playing)return;this._stateService.cutImages();const e=this._setSpeed(this._speed);this._stateService.setSpeed(e),this._graphModeSubscription=this._speed$.pipe(tt((e=>e>Bg.sequenceSpeed?tg.Sequence:tg.Spatial)),Vt()).subscribe((e=>{this._graphService.setGraphMode(e)})),this._cacheSubscription=ut(this._stateService.currentImage$.pipe(tt((e=>[e.sequenceId,e.id])),Vt(void 0,(([e])=>e))),this._graphService.graphMode$,this._direction$).pipe(oi((([[e,t],i,r])=>{if(r!==Hh.Next&&r!==Hh.Prev)return Ze([void 0,r]);return ut((i===tg.Sequence?this._graphService.cacheSequenceImages$(e,t):this._graphService.cacheSequence$(e)).pipe(Qt(3),zt((e=>(console.error(e),Ze(void 0))))),Ze(r))})),oi((([e,t])=>{if(void 0===e)return Me();const i=e.imageIds.slice();return t===Hh.Prev&&i.reverse(),this._stateService.currentState$.pipe(tt((e=>[e.state.trajectory[e.state.trajectory.length-1].id,e.state.imagesAhead])),ei((([e,t],[r,n])=>{void 0===e&&(e=r);const a=i.length-1;if(n>=this._imagesAhead||i[a]===e)return[e,[]];const o=i.indexOf(r),s=i.indexOf(e)+1,l=Math.min(a,o+this._imagesAhead-n)+1;return l<=s?[e,[]]:[i[l-1],i.slice(s,l)]}),[void 0,[]]),ft((([e,t])=>Oe(t))))})),ft((e=>this._graphService.cacheImage$(e).pipe(zt((()=>Me())))),6)).subscribe(),this._playingSubscription=this._stateService.currentState$.pipe(Ct((e=>e.state.imagesAhead<this._imagesAhead)),Vt(void 0,(e=>e.state.lastImage.id)),tt((e=>{const t=e.state.lastImage,i=e.state.trajectory;let r;for(let n=i.length-2;n>=0;n--){const e=i[n];if(e.sequenceId!==t.sequenceId)break;if(e.capturedAt!==t.capturedAt){r=e.capturedAt<t.capturedAt;break}}return[e.state.lastImage,r]})),ui(this._direction$),oi((([[e,t],i])=>At(([Hh.Next,Hh.Prev].indexOf(i)>-1?e.sequenceEdges$:e.spatialEdges$).pipe(Ht((e=>e.cached)),Qe(15e3)),Ze(i)).pipe(tt((([e,t])=>{for(let i of e.edges)if(i.data.direction===t)return i.target;return null})),oi((e=>null!=e?this._graphService.cacheImage$(e):Me())))))).subscribe((e=>{this._stateService.appendImagess([e])}),(e=>{console.error(e),this.stop()})),this._clearSubscription=this._stateService.currentImage$.pipe(Pt(1,10)).subscribe((e=>{this._stateService.clearPriorImages()})),this._setPlaying(!0);const t=this._stateService.currentState$.pipe(tt((e=>e.state)),Vt((([e,t],[i,r])=>e===i&&t===r),(e=>[e.currentImage.id,e.lastImage.id])),Ct((e=>e.currentImage.id===e.lastImage.id&&e.currentIndex===e.trajectory.length-1)),tt((e=>e.currentImage)));this._stopSubscription=ut(t,this._direction$).pipe(oi((([e,t])=>{const i=([Hh.Next,Hh.Prev].indexOf(t)>-1?e.sequenceEdges$:e.spatialEdges$).pipe(Ht((e=>e.cached)),Qe(15e3),zt((e=>(console.error(e),Ze({cached:!1,edges:[]})))));return ut(Ze(t),i).pipe(tt((([e,t])=>{for(const i of t.edges)if(i.data.direction===e)return!0;return!1})))})),ft((e=>e||!this._bridging$?Ze(e):this._bridging$.pipe(tt((e=>null!=e)),zt((e=>(console.error(e),Ze(!1))))))),Ht((e=>!e))).subscribe(void 0,void 0,(()=>{this.stop()})),this._stopSubscription.closed&&(this._stopSubscription=null),this._earthSubscription=this._stateService.state$.pipe(tt((e=>e===eg.Earth)),Vt(),Ht((e=>e))).subscribe(void 0,void 0,(()=>{this.stop()})),this._earthSubscription.closed&&(this._earthSubscription=null)}dispose(){this.stop(),this._subscriptions.unsubscribe()}setDirection(e){this._directionSubject$.next(e)}setSpeed(e){if((e=Math.max(0,Math.min(1,e)))===this._speed)return;const t=this._setSpeed(e);this._playing&&this._stateService.setSpeed(t),this._speedSubject$.next(this._speed)}stop(){this._playing&&(this._stopSubscription&&(this._stopSubscription.closed||this._stopSubscription.unsubscribe(),this._stopSubscription=null),this._earthSubscription&&(this._earthSubscription.closed||this._earthSubscription.unsubscribe(),this._earthSubscription=null),this._graphModeSubscription.unsubscribe(),this._graphModeSubscription=null,this._cacheSubscription.unsubscribe(),this._cacheSubscription=null,this._playingSubscription.unsubscribe(),this._playingSubscription=null,this._clearSubscription.unsubscribe(),this._clearSubscription=null,this._stateService.setSpeed(1),this._stateService.cutImages(),this._graphService.setGraphMode(tg.Spatial),this._setPlaying(!1))}_mapSpeed(e){const t=2*e-1;return Math.pow(10,t)-.2*t}_mapImagesAhead(e){return Math.round(Math.max(10,Math.min(50,8+6*e)))}_setPlaying(e){this._playing=e,this._playingSubject$.next(e)}_setSpeed(e){this._speed=e;const t=this._mapSpeed(this._speed);return this._imagesAhead=this._mapImagesAhead(t),t}}var Fg,Og;Bg.sequenceSpeed=.54,function(e){e[e.Hidden=0]="Hidden",e[e.Homogeneous=1]="Homogeneous",e[e.Cluster=2]="Cluster",e[e.ConnectedComponent=3]="ConnectedComponent",e[e.Sequence=4]="Sequence"}(Fg||(Fg={})),function(e){e[e.Hidden=0]="Hidden",e[e.Altitude=1]="Altitude",e[e.Flat=2]="Flat"}(Og||(Og={}));class Ng extends Sc{constructor(e){super(),this._originalSize=e.originalSize;const{cluster:t,color:i,scale:r,translation:n}=e;this._makeAttributes(t),this.material.size=r*this._originalSize,this.setColor(i),this.matrixAutoUpdate=!1,this.position.fromArray(n),this.updateMatrix(),this.updateMatrixWorld(!1)}dispose(){this.geometry.dispose(),this.material.dispose()}setColor(e){this.material.vertexColors=null==e,this.material.color=new jn(e),this.material.needsUpdate=!0}resize(e){this.material.size=e*this._originalSize,this.material.needsUpdate=!0}_makeAttributes(e){const t=[],i=[],r=e.points;for(const a in r){if(!r.hasOwnProperty(a))continue;const e=r[a];t.push(...e.coordinates);const n=e.color;i.push(n[0]),i.push(n[1]),i.push(n[2])}const n=this.geometry;n.setAttribute("position",new Wn(new Float32Array(t),3)),n.setAttribute("color",new Wn(new Float32Array(i),3))}}class Vg extends fc{constructor(e){super(),this._makeAttributes(e),this.matrixAutoUpdate=!1,this.updateMatrix(),this.updateMatrixWorld(!1)}dispose(){this.geometry.dispose(),this.material.dispose()}_makeAttributes(e){const t=e.slice();t.push(e[0]);let i=0;const r=new Float32Array(3*(e.length+1));for(const n of t)r[i++]=n[0],r[i++]=n[1],r[i++]=n[2];this.geometry.setAttribute("position",new Wn(r,3))}}function Ug(e,t){return e===t}function $g(e){const t=function(e){return Math.pow(2,e)}(e),i=t/2;return{min:[-i,-i,-i],max:[i,i,i]}}class jg{constructor(e,t,i,r){this.level=e,this.leafLevel=t,this.boundingBox=i,this.parent=r,this.children=[],this.items=[],r&&r.children.push(this)}get isEmpty(){return!(this.children.length||this.items.length)}add(e){const t=this;if(!t.boundingBox.containsPoint(e.position))throw new Error("Item not contained in node");if(Ug(t.level,t.leafLevel))return t.items.push(e),this;for(const i of t.children)if(i.boundingBox.containsPoint(e.position))return i.add(e);for(const i of t._generateBoundingBoxes())if(i.containsPoint(e.position)){return new jg(t.level-1,t.leafLevel,i,t).add(e)}throw new Error("Item not contained in children")}intersect(e,t,i){if(e.intersectBox(this.boundingBox,t))if(Ug(this.level,this.leafLevel))i.push(this);else for(const r of this.children)r.intersect(e,t,i)}remove(e){const t=this.items.indexOf(e);if(t<0)throw new Error(`Item does not exist ${e.uuid}`);this.items.splice(t,1)}traverse(){const e=this;if(!e.isEmpty)return;const t=e.parent;if(!t)return;const i=t.children.indexOf(e);if(i<0)throw new Error("Corrupt octree");t.children.splice(i,1),this.parent=null,t.traverse()}_generateBoundingBoxes(){const e=this.boundingBox.min,t=(this.boundingBox.max.x-e.x)/2,i=[[e.x,e.y+t,e.z+t],[e.x+t,e.y+t,e.z+t],[e.x,e.y,e.z+t],[e.x+t,e.y,e.z+t],[e.x,e.y+t,e.z],[e.x+t,e.y+t,e.z],[e.x,e.y,e.z],[e.x+t,e.y,e.z]],r=[];for(const[n,a,o]of i)r.push(new Sr(new xr(n,a,o),new xr(n+t,a+t,o+t)));return r}}class qg{constructor(e,t){if(this.rootLevel=e,this.leafLevel=t,t>e)throw new Error;this._index=new Map,this._root=this._makeRoot()}get root(){return this._root}add(e){if(!this.root.boundingBox.containsPoint(e.position))return void console.warn(`Object outside bounding box ${e.uuid}`);const t=this._root.add(e);this._index.set(e.uuid,t)}has(e){return this._index.has(e.uuid)}intersect(e){const t=[],i=new xr;return this._root.intersect(e,i,t),t.map((e=>e.items)).reduce(((e,t)=>(e.push(...t),e)),[])}reset(){this._root=this._makeRoot(),this._index.clear()}remove(e){if(!this.has(e))throw new Error(`Frame does not exist ${e.uuid}`);const t=this._index.get(e.uuid);t.remove(e),t.traverse(),this._index.delete(e.uuid)}_makeRoot(){const e=this.rootLevel,t=$g(e),i=new Sr((new xr).fromArray(t.min),(new xr).fromArray(t.max));return new jg(e,this.leafLevel,i)}}class Gg{constructor(e,t){this._objects=[],this._objectImageMap=new Map,this._octree=null!==e&&void 0!==e?e:new qg(14,6),this._raycaster=null!==t&&void 0!==t?t:new Eh,this._interactiveLayer=1,this._raycaster=t||new Eh(void 0,void 0,1,1e4),this._lineThreshold=.2,this._largeLineThreshold=.4,this._raycaster.params.Line.threshold=this._lineThreshold,this._raycaster.layers.set(this._interactiveLayer)}get interactiveLayer(){return this._interactiveLayer}get octree(){return this._octree}get raycaster(){return this._raycaster}add(e,t){const i=e.uuid;this._objectImageMap.set(i,t),this._objects.push(e),this._octree.add(e)}intersectObjects(e,t){this._raycaster.setFromCamera((new or).fromArray(e),t);const i=this._octree.intersect(this.raycaster.ray),r=this._raycaster.intersectObjects(i),n=this._objectImageMap;for(const a of r){const e=a.object.uuid;if(n.has(e))return n.get(e)}return null}remove(e){const t=this._objects,i=t.indexOf(e);if(-1!==i){const r=t.splice(i,1);for(const e of r)this._objectImageMap.delete(e.uuid);this._octree.remove(e)}else console.warn("Object does not exist")}resetIntersectionThreshold(e){this._raycaster.params.Line.threshold=e?this._largeLineThreshold:this._lineThreshold}}class Hg extends fc{constructor(e){super(e.geometry,e.material);const t=e.mode,i=e.originalOrigin,r=e.transform.unprojectBasic([0,0],0);this._relativeAltitude=i[2]-r[2],this._makeAttributes(r,i,t),this.matrixAutoUpdate=!1,this.position.fromArray(r),this.updateMatrix(),this.updateMatrixWorld(!1)}dispose(){this.geometry.dispose(),this.material.dispose()}setMode(e){const t=this.geometry.attributes.position;t.array[5]=this._modeToAltitude(e),t.needsUpdate=!0,this.geometry.computeBoundingSphere()}_makeAttributes(e,t,i){const r=new Float32Array(6);r[0]=0,r[1]=0,r[2]=0,r[3]=t[0]-e[0],r[4]=t[1]-e[1],r[5]=this._modeToAltitude(i);const n=new Wn(r,3);this.geometry.setAttribute("position",n),n.needsUpdate=!0,this.geometry.computeBoundingSphere()}_modeToAltitude(e){return e===Og.Altitude?this._relativeAltitude:0}}class Wg extends _c{constructor(e){super(e.geometry,e.material);const t=e.color,i=e.size,r=e.scale,n=e.transform,a=n.unprojectBasic([0,0],0),o=this._makePositions(i,n,a);this._makeAttributes(o,t),this.geometry.computeBoundingSphere(),this.geometry.computeBoundingBox(),this.matrixAutoUpdate=!1,this.position.fromArray(a),this.scale.set(r,r,r),this.updateMatrix(),this.updateMatrixWorld(!1)}dispose(){this.geometry.dispose(),this.material.dispose()}setColor(e){return this._updateColorAttribute(e),this}resize(e){return this.scale.set(e,e,e),this.updateMatrix(),this.updateMatrixWorld(!1),this}_makeAttributes(e,t){const i=this.geometry,r=new Wn(new Float32Array(e),3);i.setAttribute("position",r),r.needsUpdate=!0;const n=new Wn(new Float32Array(e.length),3);i.setAttribute("color",n),this._updateColorAttribute(t)}_updateColorAttribute(e){const[t,i,r]=new jn(e).toArray(),n=this.geometry.attributes.color,a=n.array,o=a.length;let s=0;for(let l=0;l<o;l++)a[s++]=t,a[s++]=i,a[s++]=r;n.needsUpdate=!0}}class Zg extends Wg{_makePositions(e,t,i){const r=[];r.push(...this._makeAxis(e,t,i)),r.push(...this._makeLat(.5,10,e,t,i));for(const n of[0,.25,.5,.75])r.push(...this._makeLng(n,10,e,t,i));return r}_makeAxis(e,t,i){const r=t.unprojectBasic([.5,1],.8*e),n=t.unprojectBasic([.5,0],1.2*e);return[r[0]-i[0],r[1]-i[1],r[2]-i[2],n[0]-i[0],n[1]-i[1],n[2]-i[2]]}_makeLat(e,t,i,r,n){const a=.8*i,[o,s,l]=n,c=[],u=r.unprojectBasic([0,e],a);u[0]-=o,u[1]-=s,u[2]-=l,c.push(...u);for(let h=1;h<=t;h++){const i=r.unprojectBasic([h/t,e],a);i[0]-=o,i[1]-=s,i[2]-=l,c.push(...i,...i)}return c.push(...u),c}_makeLng(e,t,i,r,n){const a=.8*i,[o,s,l]=n,c=[],u=r.unprojectBasic([e,0],a);u[0]-=o,u[1]-=s,u[2]-=l,c.push(...u);for(let h=0;h<=t;h++){const i=r.unprojectBasic([e,h/t],a);i[0]-=o,i[1]-=s,i[2]-=l,c.push(...i,...i)}return c.push(...u),c}}class Xg extends Wg{_makePositions(e,t,i){const r=[];return r.push(...this._makeDiags(e,t,i)),r.push(...this._makeFrame(e,8,t,i)),r}_makeDiags(e,t,i){const[r,n,a]=i,o=[0,0,0],s=[];for(const l of[[0,0],[1,0],[1,1],[0,1]]){const i=t.unprojectBasic(l,e);i[0]-=r,i[1]-=n,i[2]-=a,s.push(...o,...i)}return s}_makeFrame(e,t,i,r){const n=[];n.push(...this._subsample([0,1],[0,0],t)),n.push(...this._subsample([0,0],[1,0],t)),n.push(...this._subsample([1,0],[1,1],t));const[a,o,s]=r,l=[];for(const c of n){const t=i.unprojectBasic(c,e);t[0]-=a,t[1]-=o,t[2]-=s,l.push(...t)}return l}_interpolate(e,t,i){return e+i*(t-e)}_subsample(e,t,i){if(i<1)return[e,t];const r=[];r.push(e);for(let n=0;n<=i;n++){const a=[];for(let r=0;r<3;r++)a.push(this._interpolate(e[r],t[r],n/(i+1)));r.push(a),r.push(a)}return r.push(t),r}}function Yg(e,t,i){const[r,n,a]=t,[o,s,l]=Nh(r,n,a,i.lng,i.lat,i.alt);return Oh(o,s,l,e.lng,e.lat,e.alt)}class Kg{constructor(e,t,i){this.id=e,this._scene=t,this._intersection=i,this.cameras=new Sn,this.keys=[],this._positionLines={},this._positions=new Sn,this._cameraFrames={},this._clusters=new Map,this._connectedComponents=new Map,this._sequences=new Map,this._props={},this.clusterVisibles={},this._frameMaterial=new lc({fog:!1,vertexColors:!0}),this._positionMaterial=new lc({fog:!1,color:16711680}),this._scene.add(this.cameras,this._positions)}addImage(e){const t=e.image,i=t.id;if(this.hasImage(i))throw new Error(`Image exists ${i}`);const r=e.idMap.ccId;this._connectedComponents.has(r)||this._connectedComponents.set(r,[]);const n=e.idMap.clusterId;this._clusters.has(n)||this._clusters.set(n,[]);const a=e.idMap.sequenceId;this._sequences.has(a)||this._sequences.set(a,[]),this._props[i]={image:t,ids:{ccId:r,clusterId:n,sequenceId:a}},this.keys.push(i)}applyCameraColor(e,t){this._cameraFrames[e].setColor(t)}applyCameraSize(e){for(const t of this.cameras.children)t.resize(e)}applyFilter(e){var t;const i=this.clusterVisibles;for(const o in i)i.hasOwnProperty(o)&&(i[o]=!1);const r=this._cameraFrames,n=this._positionLines,a=this._intersection.interactiveLayer;for(const o of Object.values(this._props)){const s=o.image,l=e(s),c=s.id;n[c].visible=l;const u=r[c];this._setCameraVisibility(u,l,a),i[t=o.ids.clusterId]||(i[t]=l)}}applyPositionMode(e){this._positions.visible=e!==Og.Hidden;for(const t of this._positions.children)t.setMode(e)}dispose(){this._disposeCameras(),this._disposePositions(),this._scene=null,this._intersection=null}getCamerasByMode(e){if(e===Fg.Cluster)return this._clusters;if(e===Fg.ConnectedComponent)return this._connectedComponents;if(e===Fg.Sequence)return this._sequences;const t=Fg[Fg.Homogeneous],i=new Map;return i.set(t,this.cameras.children),i}getColorId(e,t){const i=this._props[e],r=Fg;switch(t){case r.Cluster:return i.ids.clusterId;case r.ConnectedComponent:return i.ids.ccId;case r.Sequence:return i.ids.sequenceId;default:return r[r.Homogeneous]}}hasImage(e){return-1!==this.keys.indexOf(e)}resetReference(e,t){const i=this._cameraFrames;for(const n in i){if(!i.hasOwnProperty(n))continue;const r=i[n];r.position.fromArray(Yg(e,r.position.toArray(),t))}const r=this._positionLines;for(const n in r){if(!r.hasOwnProperty(n))continue;const i=r[n];i.position.fromArray(Yg(e,i.position.toArray(),t))}}visualize(e){var t,i;const r=e.id,n=e.visible,a=e.transform,o={color:e.color,material:this._frameMaterial,scale:e.scale,size:e.maxSize,transform:a},s=Qh(a.cameraType)?new Zg(o):new Xg(o),l=this._intersection.interactiveLayer;this._setCameraVisibility(s,n,l),this.cameras.add(s),this._cameraFrames[r]=s;this._intersection.add(s,r);const c=this._props[r].ids;(t=this.clusterVisibles)[i=c.clusterId]||(t[i]=n),this._connectedComponents.get(c.ccId).push(s),this._clusters.get(c.clusterId).push(s),this._sequences.get(c.sequenceId).push(s);const u={material:this._positionMaterial,mode:e.positionMode,originalOrigin:e.originalPosition,transform:a},h=new Hg(u);h.visible=n,this._positions.add(h),this._positionLines[r]=h}_disposeCameras(){const e=this._intersection,t=this.cameras;for(const i of t.children.slice())i.dispose(),e.remove(i),t.remove(i);this._scene.remove(this.cameras)}_disposePositions(){const e=this._positions;for(const t of e.children.slice())t.dispose(),e.remove(t);this._scene.remove(this._positions)}_setCameraVisibility(e,t,i){e.visible=t,t?e.layers.enable(i):e.layers.disable(i)}}class Jg{constructor(){this._colors=new Map;const e=Fg;this._colors.set(e[e.Homogeneous],"#FFFFFF")}getColor(e){const t=this._colors;return t.has(e)||t.set(e,this._randomColor()),t.get(e)}_randomColor(){return`hsl(${Math.floor(360*Math.random())}, 100%, 50%)`}}function Qg(e){return e!==Fg.Hidden}var e_;!function(e){e[e.Hidden=0]="Hidden",e[e.Original=1]="Original",e[e.Cluster=2]="Cluster"}(e_||(e_={}));class t_{constructor(e,t){this._rayNearScale=1.1,this._originalPointSize=2,this._originalCameraSize=2,this._imageCellMap=new Map,this._scene=t||new zl,this._scene.autoUpdate=!1,this._intersection=new Gg,this._assets=new Jg,this._needsRender=!1,this._images={},this._cells={},this._cellClusters={},this._clusters={},this._cameraVisualizationMode=e.cameraVisualizationMode?e.cameraVisualizationMode:Fg.Homogeneous,this._cameraSize=e.cameraSize,this._pointSize=e.pointSize,this._pointVisualizationMode=e.pointVisualizationMode?e.pointVisualizationMode:e_.Original,this._positionMode=e.originalPositionMode,this._cellsVisible=e.cellsVisible,this._hoveredId=null,this._selectedId=null,this._colors={hover:"#FF0000",select:"#FF8000"},this._filter=()=>!0}get needsRender(){return this._needsRender}get intersection(){return this._intersection}addCluster(e,t,i){if(this.hasCluster(e.id,i))return;const r=e.id;if(!(r in this._clusters)){this._clusters[r]={points:new Sn,cellIds:[]};const i=this._getClusterVisible(r),n=this._clusters[r],a=this._pointVisualizationMode===e_.Cluster?this._assets.getColor(r):null,o=new Ng({cluster:e,color:a,originalSize:this._originalPointSize,scale:this._pointSize,translation:t});n.points.visible=i,n.points.add(o),this._scene.add(n.points)}-1===this._clusters[r].cellIds.indexOf(i)&&this._clusters[r].cellIds.push(i),i in this._cellClusters||(this._cellClusters[i]={keys:[]}),-1===this._cellClusters[i].keys.indexOf(r)&&this._cellClusters[i].keys.push(r),this._needsRender=!0}addImage(e,t,i,r){var n,a,o;const s=e.id,l={clusterId:null!==(n=e.clusterId)&&void 0!==n?n:"NO_CLUSTER_ID",sequenceId:null!==(a=e.sequenceId)&&void 0!==a?a:"NO_SEQUENCE_ID",ccId:null!==(o=e.mergeId)&&void 0!==o?o:"NO_MERGE_ID"};if(!(r in this._images)){const e=new Kg(r,this._scene,this._intersection);e.cameras.visible=Qg(this._cameraVisualizationMode),e.applyPositionMode(this._positionMode),this._images[r]=e}const c=this._images[r];if(c.hasImage(s))return;c.addImage({idMap:l,image:e});const u=c.getColorId(s,this._cameraVisualizationMode),h=this._assets.getColor(u),p=this._filter(e);if(c.visualize({id:s,color:h,positionMode:this._positionMode,scale:this._cameraSize,transform:t,visible:p,maxSize:this._originalCameraSize,originalPosition:i}),this._imageCellMap.set(s,r),s===this._selectedId&&this._highlight(s,this._colors.select,this._cameraVisualizationMode),l.clusterId in this._clusters){const e=this._getClusterVisible(l.clusterId);this._clusters[l.clusterId].points.visible=e}this._needsRender=!0}addCell(e,t){if(this.hasCell(t))return;const i=new Vg(e);this._cells[t]=new Sn,this._cells[t].visible=this._cellsVisible,this._cells[t].add(i),this._scene.add(this._cells[t]),this._needsRender=!0}deactivate(){this._filter=()=>!0,this._selectedId=null,this._hoveredId=null,this.uncache()}hasCluster(e,t){return e in this._clusters&&-1!==this._clusters[e].cellIds.indexOf(t)}hasCell(e){return e in this._cells}hasImage(e,t){return t in this._images&&this._images[t].hasImage(e)}render(e,t){t.render(this._scene,e),this._needsRender=!1}resetReference(e,t){const i=this._clusters;for(const a in i){if(!i.hasOwnProperty(a))continue;const r=i[a];r.points.position.fromArray(Yg(e,r.points.position.toArray(),t))}const r=this._cells;for(const a in r){if(!r.hasOwnProperty(a))continue;const i=r[a];i.position.fromArray(Yg(e,i.position.toArray(),t))}const n=this._images;for(const a in n){if(!n.hasOwnProperty(a))continue;n[a].resetReference(e,t)}}setCameraSize(e){if(Math.abs(e-this._cameraSize)<.001)return;const t=this._images;for(const i of Object.keys(t))t[i].applyCameraSize(e);this._intersection.raycaster.near=this._getNear(e),this._cameraSize=e,this._needsRender=!0}setFilter(e){this._filter=e;const t={};for(const r of Object.values(this._images)){r.applyFilter(e);const i=r.clusterVisibles;for(const e in i)i.hasOwnProperty(e)&&(e in t||(t[e]=!1),t[e]||(t[e]=i[e]))}const i=this._pointVisualizationMode!==e_.Hidden;for(const r in t){if(!t.hasOwnProperty(r))continue;t[r]&&(t[r]=i);const e=t[r];r in this._clusters&&(this._clusters[r].points.visible=e)}this._needsRender=!0}setHoveredImage(e){if(null!=e&&!this._imageCellMap.has(e))throw new Xh(`Image does not exist: ${e}`);this._hoveredId!==e&&(this._needsRender=!0,null!=this._hoveredId&&(this._hoveredId===this._selectedId?this._highlight(this._hoveredId,this._colors.select,this._cameraVisualizationMode):this._resetCameraColor(this._hoveredId)),this._highlight(e,this._colors.hover,this._cameraVisualizationMode),this._hoveredId=e)}setNavigationState(e){this._intersection.resetIntersectionThreshold(e)}setPointSize(e){if(Math.abs(e-this._pointSize)<.001)return;const t=this._clusters;for(const i in t)if(t.hasOwnProperty(i))for(const r of t[i].points.children)r.resize(e);this._pointSize=e,this._needsRender=!0}setPointVisualizationMode(e){if(e!==this._pointVisualizationMode){this._pointVisualizationMode=e;for(const t in this._clusters){if(!this._clusters.hasOwnProperty(t))continue;const i=this._clusters[t];i.points.visible=this._getClusterVisible(t);for(const r of i.points.children){const i=e===e_.Cluster?this._assets.getColor(t):null;r.setColor(i)}}this._needsRender=!0}}setPositionMode(e){if(e!==this._positionMode){for(const t of Object.values(this._images))t.applyPositionMode(e);this._positionMode=e,this._needsRender=!0}}setSelectedImage(e){this._selectedId!==e&&(this._needsRender=!0,null!=this._selectedId&&this._resetCameraColor(this._selectedId),this._highlight(e,this._colors.select,this._cameraVisualizationMode),this._selectedId=e)}setCellVisibility(e){if(e!==this._cellsVisible){for(const t in this._cells)this._cells.hasOwnProperty(t)&&(this._cells[t].visible=e);this._cellsVisible=e,this._needsRender=!0}}setCameraVisualizationMode(e){if(e===this._cameraVisualizationMode)return;const t=Qg(e),i=this._assets;for(const r of Object.values(this._images)){r.cameras.visible=t;r.getCamerasByMode(e).forEach(((e,t)=>{const r=i.getColor(t);for(const i of e)i.setColor(r)}))}this._highlight(this._hoveredId,this._colors.hover,e),this._highlight(this._selectedId,this._colors.select,e),this._cameraVisualizationMode=e,this._needsRender=!0}uncache(e){for(const t of Object.keys(this._cellClusters))e&&-1!==e.indexOf(t)||this._disposeReconstruction(t);for(const t of Object.keys(this._images)){if(e&&-1!==e.indexOf(t))continue;const i=this._imageCellMap,r=this._images[t].keys;for(const e of r)i.delete(e);this._images[t].dispose(),delete this._images[t]}for(const t of Object.keys(this._cells))e&&-1!==e.indexOf(t)||this._disposeCell(t);this._needsRender=!0}_getClusterVisible(e){if(this._pointVisualizationMode===e_.Hidden)return!1;let t=!1;for(const i of Object.values(this._images)){const r=i.clusterVisibles;e in r&&(t||(t=r[e]))}return t}_disposePoints(e){for(const t of this._cellClusters[e].keys){if(!(t in this._clusters))continue;const i=this._clusters[t].cellIds.indexOf(e);if(-1!==i&&(this._clusters[t].cellIds.splice(i,1),!(this._clusters[t].cellIds.length>0))){for(const e of this._clusters[t].points.children.slice())e.dispose();this._scene.remove(this._clusters[t].points),delete this._clusters[t]}}}_disposeReconstruction(e){this._disposePoints(e),delete this._cellClusters[e]}_disposeCell(e){const t=this._cells[e];for(const i of t.children.slice())i.dispose(),t.remove(i);this._scene.remove(t),delete this._cells[e]}_getNear(e){const t=this._rayNearScale*this._originalCameraSize*e;return Math.max(1,t)}_resetCameraColor(e){const t=this._imageCellMap;if(null==e||!t.has(e))return;const i=t.get(e),r=this._images[i],n=r.getColorId(e,this._cameraVisualizationMode),a=this._assets.getColor(n);r.applyCameraColor(e,a)}_highlight(e,t,i){const r=this._imageCellMap;if(null==e||!r.has(e))return;const n=r.get(e);t=i===Fg.Homogeneous?t:"#FFFFFF",this._images[n].applyCameraColor(e,t)}}class i_{constructor(e,t){this._graphService=e,this._data=t,this._cells={},this._cacheRequests={},this._clusters={},this._clusterCells={},this._cellClusters={},this._cachingCells$={},this._cachingClusters$={}}cacheClusters$(e){if(!this.hasCell(e))throw new Error("Cannot cache reconstructions of a non-existing cell.");if(this.hasClusters(e))throw new Error("Cannot cache reconstructions that already exists.");if(this.isCachingClusters(e))return this._cachingClusters$[e];const t=this.getCell(e).filter((e=>!!e.clusterId&&!!e.clusterUrl)).map((e=>({key:e.clusterId,url:e.clusterUrl}))),i=Array.from(new Map(t.map((e=>[e.key,e]))).values());let r;this._cellClusters[e]=i,this._cacheRequests[e]=[];const n=new Promise(((e,t)=>{r=t}));return this._cacheRequests[e].push(r),this._cachingClusters$[e]=this._cacheClusters$(i,e,n).pipe(Gt((()=>{e in this._cachingClusters$&&delete this._cachingClusters$[e],e in this._cacheRequests&&delete this._cacheRequests[e]})),Kt(),le()),this._cachingClusters$[e]}cacheCell$(e){if(this.hasCell(e))throw new Error("Cannot cache cell that already exists.");return this.isCachingCell(e)||(this._cachingCells$[e]=this._graphService.cacheCell$(e).pipe(zt((e=>(console.error(e),Me()))),Ct((()=>!(e in this._cells))),ci((t=>{this._cells[e]=[],this._cells[e].push(...t),delete this._cachingCells$[e]})),Gt((()=>{e in this._cachingCells$&&delete this._cachingCells$[e]})),Kt(),le())),this._cachingCells$[e]}isCachingClusters(e){return e in this._cachingClusters$}isCachingCell(e){return e in this._cachingCells$}hasClusters(e){if(e in this._cachingClusters$||!(e in this._cellClusters))return!1;for(const t of this._cellClusters[e])if(!(t.key in this._clusters))return!1;return!0}hasCell(e){return!(e in this._cachingCells$)&&e in this._cells}getClusters(e){return e in this._cellClusters?this._cellClusters[e].map((e=>this._clusters[e.key])).filter((e=>!!e)):[]}getCell(e){return e in this._cells?this._cells[e]:[]}uncache(e){for(let t of Object.keys(this._cacheRequests))if(!e||-1===e.indexOf(t)){for(const e of this._cacheRequests[t])e();delete this._cacheRequests[t]}for(let t of Object.keys(this._cellClusters))if(!e||-1===e.indexOf(t)){for(const e of this._cellClusters[t]){if(!(e.key in this._clusterCells))continue;const i=this._clusterCells[e.key].indexOf(t);-1!==i&&(this._clusterCells[e.key].splice(i,1),this._clusterCells[e.key].length>0||(delete this._clusterCells[e.key],delete this._clusters[e.key]))}delete this._cellClusters[t]}for(let t of Object.keys(this._cells))e&&-1!==e.indexOf(t)||delete this._cells[t]}updateCell$(e){if(!this.hasCell(e))throw new Error("Cannot update cell that does not exists.");return this._graphService.cacheCell$(e).pipe(zt((e=>(console.error(e),Me()))),Ct((()=>e in this._cells)),ci((t=>{this._cells[e]=[],this._cells[e].push(...t)})),Kt(),le())}updateClusters$(e){if(!this.hasCell(e))throw new Error("Cannot update reconstructions of a non-existing cell.");if(!this.hasClusters(e))throw new Error("Cannot update reconstructions for cell that is not cached.");const t=this.getCell(e).filter((e=>!!e.clusterId&&!!e.clusterUrl)).map((e=>({key:e.clusterId,url:e.clusterUrl}))),i=Array.from(new Map(t.map((e=>[e.key,e]))).values()).filter((e=>!(e.key in this._clusters)));return this._cellClusters[e].push(...i),this._cacheClusters$(i,e,null)}_cacheClusters$(e,t,i){return Oe(e).pipe(ft((e=>this._hasCluster(e.key)?Ze(this._getCluster(e.key)):this._getCluster$(e.url,e.key,i).pipe(zt((e=>(e instanceof Rm||console.error(e),Me()))))),6),Ct((()=>t in this._cellClusters)),ci((e=>{this._hasCluster(e.id)||(this._clusters[e.id]=e),e.id in this._clusterCells||(this._clusterCells[e.id]=[]),-1===this._clusterCells[e.id].indexOf(t)&&this._clusterCells[e.id].push(t)})))}_getCluster(e){return this._clusters[e]}_getCluster$(e,t,i){return re.create((r=>{this._data.getCluster(e,i).then((e=>{e.id=t,r.next(e),r.complete()}),(e=>{r.error(e)}))}))}_hasCluster(e){return e in this._clusters}}function r_(e,t,i){const r=new Set;return r.add(e),n_(r,[e],0,t,i),Array.from(r)}function n_(e,t,i,r,n){if(i>=r)return;const a=[];for(const s of t){const e=n.getAdjacent(s);a.push(...e)}const o=[];for(const s of a)e.has(s)||(e.add(s),o.push(s));n_(e,o,i+1,r,n)}class a_ extends Em{constructor(e,t,i){super(e,t,i),this._cache=new i_(i.graphService,i.api.data),this._scene=new t_(this._getDefaultConfiguration()),this._viewportCoords=new Im,this._spatial=new Kh}getFrameIdAt(e){return new Promise(((t,i)=>{this._container.renderService.renderCamera$.pipe(Ht(),tt((t=>{const i=this._viewportCoords.canvasToViewport(e[0],e[1],this._container.container);return this._scene.intersection.intersectObjects(i,t.perspective)}))).subscribe((e=>{t(e)}),(e=>{i(e)}))}))}_activate(){this._navigator.cacheService.configure({cellDepth:3});const e=this._subscriptions;e.push(this._navigator.stateService.reference$.pipe(Yt()).subscribe((([e,t])=>{this._scene.resetReference(t,e)}))),e.push(this._navigator.graphService.filter$.subscribe((e=>{this._scene.setFilter(e)})));const t=this._container.renderService.bearing$.pipe(tt((e=>6*Math.floor(e/6))),Vt(),Jt(1),le()),i=this._navigator.stateService.currentImage$.pipe(tt((e=>this._navigator.api.data.geometry.lngLatToCellId(e.originalLngLat))),Vt(),Jt(1),le()),r=this._configuration$.pipe(tt((e=>this._spatial.clamp(e.cellGridDepth,1,3))),Vt(),Jt(1),le()),n=ut(this._navigator.playService.playing$,this._navigator.playService.speed$).pipe(tt((([e,t])=>e&&t>Bg.sequenceSpeed)),Vt(),Jt(1),le()),a=this._navigator.stateService.state$.pipe(tt((e=>function(e){return e===eg.Custom||e===eg.Earth}(e))),Vt(),Jt(1),le());e.push(a.subscribe((e=>{this._scene.setNavigationState(e)})));const o=ut(a,n,t,r,this._navigator.stateService.currentImage$).pipe(Vt((([e,t,i,r,n],[a,o,s,l,c])=>{if(e!==a)return!1;const u=n.id===c.id&&t===o&&r===l;return e?u:u&&i===s})),Lt((([e,t,i,r,n])=>{if(e){const e=this._navigator.api.data.geometry,i=e.lngLatToCellId(n.originalLngLat);return Ze(t?[i]:r_(i,r,e))}const a=t?30:90;return Ze(this._cellsInFov(n,i,a))})),oi((e=>Oe(e).pipe(ft((e=>(this._cache.hasCell(e)?Ze(this._cache.getCell(e)):this._cache.cacheCell$(e)).pipe(tt((t=>({id:e,images:t}))))),6)))));e.push(o.pipe(ui(this._navigator.stateService.reference$)).subscribe((([e,t])=>{this._scene.hasCell(e.id)||this._scene.addCell(this._cellToTopocentric(e.id,t),e.id)}))),e.push(o.pipe(ui(this._navigator.stateService.reference$)).subscribe((([e,t])=>{this._addSceneImages(e,t)}))),e.push(o.pipe(Lt((e=>{const t=e.id;let i;return i=this._cache.hasClusters(t)?Oe(this._cache.getClusters(t)):this._cache.isCachingClusters(t)?this._cache.cacheClusters$(t).pipe(Zt(null,{}),oi((()=>Oe(this._cache.getClusters(t))))):this._cache.hasCell(t)?this._cache.cacheClusters$(t):Me(),ut(Ze(t),i)})),ui(this._navigator.stateService.reference$)).subscribe((([[e,t],i])=>{this._scene.hasCluster(t.id,e)||this._scene.addCluster(t,this._computeTranslation(t,i),e)}))),e.push(this._configuration$.pipe(tt((e=>{var t;e.cameraSize=this._spatial.clamp(e.cameraSize,.01,1),e.pointSize=this._spatial.clamp(e.pointSize,.01,1);const i=e.pointsVisible?null!==(t=e.pointVisualizationMode)&&void 0!==t?t:e_.Original:e_.Hidden;return{cameraSize:e.cameraSize,cameraVisualizationMode:e.cameraVisualizationMode,cellsVisible:e.cellsVisible,originalPositionMode:e.originalPositionMode,pointSize:e.pointSize,pointVisualizationMode:i}})),Vt(((e,t)=>e.cameraSize===t.cameraSize&&e.cameraVisualizationMode===t.cameraVisualizationMode&&e.cellsVisible===t.cellsVisible&&e.originalPositionMode===t.originalPositionMode&&e.pointSize===t.pointSize&&e.pointVisualizationMode===t.pointVisualizationMode))).subscribe((e=>{this._scene.setCameraSize(e.cameraSize);const t=e.cameraVisualizationMode;this._scene.setCameraVisualizationMode(t),this._scene.setCellVisibility(e.cellsVisible),this._scene.setPointSize(e.pointSize);const i=e.pointVisualizationMode;this._scene.setPointVisualizationMode(i);const r=e.originalPositionMode;this._scene.setPositionMode(r)}))),e.push(ut(i,r).subscribe((([e,t])=>{const i=r_(e,t,this._navigator.api.data.geometry);this._scene.uncache(i),this._cache.uncache(i)}))),e.push(this._navigator.playService.playing$.pipe(oi((e=>e?Me():this._container.mouseService.dblClick$)),ui(this._container.renderService.renderCamera$),oi((([e,t])=>{const i=this._container.container,[r,n]=this._viewportCoords.canvasPosition(e,i),a=this._viewportCoords.canvasToViewport(r,n,i),o=this._scene.intersection.intersectObjects(a,t.perspective);return o?this._navigator.moveTo$(o).pipe(zt((()=>Me()))):Me()}))).subscribe());const s=ut(this._configuration$,this._navigator.stateService.state$).pipe(tt((([e,t])=>(e.cameraSize=this._spatial.clamp(e.cameraSize,.01,1),{size:e.cameraSize,visible:Qg(e.cameraVisualizationMode),state:t}))),Vt(((e,t)=>e.size===t.size&&e.visible===t.visible&&e.state===t.state))),l=this._container.mouseService.mouseMove$.pipe(Jt(1),le());e.push(l.subscribe());const c=Mt(this._container.mouseService.mouseEnter$,this._container.mouseService.mouseLeave$,this._container.mouseService.windowBlur$);e.push(ut(this._navigator.playService.playing$,c,a,this._navigator.graphService.filter$).pipe(oi((([e,t])=>e||"pointerenter"!==t.type?ut(Ze(t),Ze(null),Ze(null)):ut(_t(l.pipe(Nt(1)),this._container.mouseService.mouseMove$),this._container.renderService.renderCamera$,s)))).subscribe((([e,t])=>{if("pointermove"!==e.type)return void this._scene.setHoveredImage(null);const i=this._container.container,[r,n]=this._viewportCoords.canvasPosition(e,i),a=this._viewportCoords.canvasToViewport(r,n,i),o=this._scene.intersection.intersectObjects(a,t.perspective);this._scene.setHoveredImage(o)}))),e.push(this._navigator.stateService.currentId$.subscribe((e=>{this._scene.setSelectedImage(e)}))),e.push(this._navigator.stateService.currentState$.pipe(tt((e=>{const t=this._scene;return{name:this._name,renderer:{frameId:e.id,needsRender:t.needsRender,render:t.render.bind(t),pass:Vm.Opaque}}}))).subscribe(this._container.glRenderer.render$));const u=this._navigator.graphService.dataAdded$.pipe(Ct((e=>this._cache.hasCell(e))),ft((e=>this._cache.updateCell$(e).pipe(tt((t=>({id:e,images:t}))),ui(this._navigator.stateService.reference$)))),Kt(),le());e.push(u.subscribe((([e,t])=>{this._addSceneImages(e,t)}))),e.push(u.pipe(Lt((([e])=>{const t=e.id,i=this._cache;let r;return r=i.hasClusters(t)?i.updateClusters$(t):i.isCachingClusters(t)?this._cache.cacheClusters$(t).pipe(Zt(null,{}),oi((()=>Oe(i.updateClusters$(t))))):Me(),ut(Ze(t),r)})),ui(this._navigator.stateService.reference$)).subscribe((([[e,t],i])=>{this._scene.hasCluster(t.id,e)||this._scene.addCluster(t,this._computeTranslation(t,i),e)})))}_deactivate(){this._subscriptions.unsubscribe(),this._cache.uncache(),this._scene.deactivate(),this._navigator.cacheService.configure()}_getDefaultConfiguration(){return{cameraSize:.1,cameraVisualizationMode:Fg.Homogeneous,cellGridDepth:1,originalPositionMode:Og.Hidden,pointSize:.1,pointsVisible:!0,pointVisualizationMode:e_.Original,cellsVisible:!1}}_addSceneImages(e,t){const i=e.id,r=e.images;for(const n of r)this._scene.hasImage(n.id,i)||this._scene.addImage(n,this._createTransform(n,t),this._computeOriginalPosition(n,t),i)}_cellsInFov(e,t,i){const r=this._spatial,n=this._navigator.api.data.geometry,a=n.lngLatToCellId(e.originalLngLat),o=[a],s=i/2,l=n.getAdjacent(a);for(const c of l){const i=n.getVertices(c);for(const n of i){const[i,a]=Oh(n.lng,n.lat,0,e.lngLat.lng,e.lngLat.lat,0),l=Math.atan2(a,i),u=r.radToDeg(r.azimuthalToBearing(l));Math.abs(u-t)<s&&o.push(c)}}return o}_computeOriginalPosition(e,t){return Oh(e.originalLngLat.lng,e.originalLngLat.lat,null!=e.originalAltitude?e.originalAltitude:e.computedAltitude,t.lng,t.lat,t.alt)}_cellToTopocentric(e,t){const i=this._navigator.api.data.geometry.getVertices(e).map((e=>Oh(e.lng,e.lat,-2,t.lng,t.lat,t.alt)));return i}_computeTranslation(e,t){return Oh(e.reference.lng,e.reference.lat,e.reference.alt,t.lng,t.lat,t.alt)}_createTransform(e,t){const i=tp({alt:e.computedAltitude,lat:e.lngLat.lat,lng:e.lngLat.lng},e.rotation,t);return new Rg(e.exifOrientation,e.width,e.height,e.scale,e.rotation,i,void 0,void 0,e.cameraParameters,e.cameraType)}}a_.componentName="spatial";class o_{constructor(){this._notifyChanged$=new he}get changed$(){return this._notifyChanged$}}class s_ extends Xh{constructor(e){super(null!=e?e:"The provided geometry value is incorrect"),Object.setPrototypeOf(this,s_.prototype),this.name="GeometryTagError"}}class l_ extends o_{constructor(e){super();if(e.length<2)throw new s_("A points geometry must have two or more positions.");this._points=[];for(const t of e){if(t[0]<0||t[0]>1||t[1]<0||t[1]>1)throw new s_("Basic coordinates of points must be on the interval [0, 1].");this._points.push(t.slice())}}get points(){return this._points}addPoint2d(e){const t=[Math.max(0,Math.min(1,e[0])),Math.max(0,Math.min(1,e[1]))];this._points.push(t),this._notifyChanged$.next(this)}getPoint2d(e){return this._points[e].slice()}removePoint2d(e){if(e<0||e>=this._points.length||this._points.length<3)throw new s_("Index for removed point must be valid.");this._points.splice(e,1),this._notifyChanged$.next(this)}setVertex2d(e,t,i){this.setPoint2d(e,t,i)}setPoint2d(e,t,i){const r=[Math.max(0,Math.min(1,t[0])),Math.max(0,Math.min(1,t[1]))];this._points[e]=r,this._notifyChanged$.next(this)}getPoints3d(e){return this._getPoints3d(this._points,e)}getPoint3d(e,t){return t.unprojectBasic(this._points[e],200)}getPoints2d(){return this._points.slice()}getCentroid2d(e){if(!e)throw new s_("Get centroid must be called with a transform for points geometries.");const[t,i,r,n]=this.getRect2d(e);return[t<r?(t+r)/2:(t+r+1)/2%1,(i+n)/2]}getCentroid3d(e){let t=this.getCentroid2d();return e.unprojectBasic(t,200)}getRect2d(e){let t=1,i=0,r=1,n=0;const a=this._points;for(const o of a)o[0]<t&&(t=o[0]),o[0]>i&&(i=o[0]),o[1]<r&&(r=o[1]),o[1]>n&&(n=o[1]);if(Qh(e.cameraType)){const e=[];for(let t=0;t<a.length;t++)e[t]=t;e.sort(((e,t)=>a[e][0]<a[t][0]?-1:a[e][0]>a[t][0]?1:e<t?-1:1));let r=a[e[0]][0]+1-a[e[e.length-1]][0],n=0;for(let t=0;t<e.length-1;t++){const i=e[t],o=e[t+1],s=a[o][0]-a[i][0];s>r&&(r=s,n=t+1)}n>0&&(t=a[e[n]][0],i=a[e[n-1]][0])}return[t,r,i,n]}setCentroid2d(e,t){throw new Error("Not implemented")}_getPoints3d(e,t){return e.map((e=>t.unprojectBasic(e,200)))}}class c_{constructor(e,t,i){this._geometry=e,this._transform=t,this._viewportCoords=i||new Im,this._aborted$=new he,this._created$=new he,this._glObjectsChanged$=new he,this._geometryChangedSubscription=this._geometry.changed$.subscribe((()=>{this._onGeometryChanged(),this._glObjectsChanged$.next(this)}))}get geometry(){return this._geometry}get glObjects(){return this._glObjects}get aborted$(){return this._aborted$}get created$(){return this._created$}get glObjectsChanged$(){return this._glObjectsChanged$}get geometryChanged$(){return this._geometry.changed$.pipe(tt((()=>this)))}dispose(){this._geometryChangedSubscription.unsubscribe()}_canvasToTransform(e){return`translate(-50%,-50%) translate(${Math.round(e[0])}px,${Math.round(e[1])}px)`}_colorToBackground(e){return"#"+("000000"+e.toString(16)).substr(-6)}_createOutine(e,t){const i=this._getLinePositions(e),r=new na;r.setAttribute("position",new Wn(i,3));const n=new lc({color:t,linewidth:1});return new fc(r,n)}_disposeLine(e){null!=e&&(e.geometry.dispose(),e.material.dispose())}_getLinePositions(e){const t=e.length,i=new Float32Array(3*t);for(let r=0;r<t;++r){const t=3*r,n=e[r];i[t]=n[0],i[t+1]=n[1],i[t+2]=n[2]}return i}}var u_={exports:{}};function h_(e,t,i){i=i||2;var r,n,a,o,s,l,c,u=t&&t.length,h=u?t[0]*i:e.length,p=p_(e,0,h,i,!0),d=[];if(!p||p.next===p.prev)return d;if(u&&(p=function(e,t,i,r){var n,a,o,s=[];for(n=0,a=t.length;n<a;n++)(o=p_(e,t[n]*r,n<a-1?t[n+1]*r:e.length,r,!1))===o.next&&(o.steiner=!0),s.push(S_(o));for(s.sort(v_),n=0;n<s.length;n++)i=d_(i=x_(s[n],i),i.next);return i}(e,t,p,i)),e.length>80*i){r=a=e[0],n=o=e[1];for(var f=i;f<h;f+=i)(s=e[f])<r&&(r=s),(l=e[f+1])<n&&(n=l),s>a&&(a=s),l>o&&(o=l);c=0!==(c=Math.max(a-r,o-n))?1/c:0}return f_(p,d,i,r,n,c),d}function p_(e,t,i,r,n){var a,o;if(n===B_(e,t,i,r)>0)for(a=t;a<i;a+=r)o=k_(a,e[a],e[a+1],o);else for(a=i-r;a>=t;a-=r)o=k_(a,e[a],e[a+1],o);return o&&C_(o,o.next)&&(L_(o),o=o.next),o}function d_(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!C_(r,r.next)&&0!==E_(r.prev,r,r.next))r=r.next;else{if(L_(r),(r=t=r.prev)===r.next)break;i=!0}}while(i||r!==t);return t}function f_(e,t,i,r,n,a,o){if(e){!o&&a&&function(e,t,i,r){var n=e;do{null===n.z&&(n.z=w_(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,i,r,n,a,o,s,l,c=1;do{for(i=e,e=null,a=null,o=0;i;){for(o++,r=i,s=0,t=0;t<c&&(s++,r=r.nextZ);t++);for(l=c;s>0||l>0&&r;)0!==s&&(0===l||!r||i.z<=r.z)?(n=i,i=i.nextZ,s--):(n=r,r=r.nextZ,l--),a?a.nextZ=n:e=n,n.prevZ=a,a=n;i=r}a.nextZ=null,c*=2}while(o>1)}(n)}(e,r,n,a);for(var s,l,c=e;e.prev!==e.next;)if(s=e.prev,l=e.next,a?g_(e,r,n,a):m_(e))t.push(s.i/i),t.push(e.i/i),t.push(l.i/i),L_(e),e=l.next,c=l.next;else if((e=l)===c){o?1===o?f_(e=__(d_(e),t,i),t,i,r,n,a,2):2===o&&y_(e,t,i,r,n,a):f_(d_(e),t,i,r,n,a,1);break}}}function m_(e){var t=e.prev,i=e,r=e.next;if(E_(t,i,r)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(M_(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&E_(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function g_(e,t,i,r){var n=e.prev,a=e,o=e.next;if(E_(n,a,o)>=0)return!1;for(var s=n.x<a.x?n.x<o.x?n.x:o.x:a.x<o.x?a.x:o.x,l=n.y<a.y?n.y<o.y?n.y:o.y:a.y<o.y?a.y:o.y,c=n.x>a.x?n.x>o.x?n.x:o.x:a.x>o.x?a.x:o.x,u=n.y>a.y?n.y>o.y?n.y:o.y:a.y>o.y?a.y:o.y,h=w_(s,l,t,i,r),p=w_(c,u,t,i,r),d=e.prevZ,f=e.nextZ;d&&d.z>=h&&f&&f.z<=p;){if(d!==e.prev&&d!==e.next&&M_(n.x,n.y,a.x,a.y,o.x,o.y,d.x,d.y)&&E_(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,f!==e.prev&&f!==e.next&&M_(n.x,n.y,a.x,a.y,o.x,o.y,f.x,f.y)&&E_(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;d&&d.z>=h;){if(d!==e.prev&&d!==e.next&&M_(n.x,n.y,a.x,a.y,o.x,o.y,d.x,d.y)&&E_(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;f&&f.z<=p;){if(f!==e.prev&&f!==e.next&&M_(n.x,n.y,a.x,a.y,o.x,o.y,f.x,f.y)&&E_(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function __(e,t,i){var r=e;do{var n=r.prev,a=r.next.next;!C_(n,a)&&A_(n,r,r.next,a)&&z_(n,a)&&z_(a,n)&&(t.push(n.i/i),t.push(r.i/i),t.push(a.i/i),L_(r),L_(r.next),r=e=a),r=r.next}while(r!==e);return d_(r)}function y_(e,t,i,r,n,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&T_(o,s)){var l=R_(o,s);return o=d_(o,o.next),l=d_(l,l.next),f_(o,t,i,r,n,a),void f_(l,t,i,r,n,a)}s=s.next}o=o.next}while(o!==e)}function v_(e,t){return e.x-t.x}function x_(e,t){var i=function(e,t){var i,r=t,n=e.x,a=e.y,o=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var s=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=n&&s>o){if(o=s,s===n){if(a===r.y)return r;if(a===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!i)return null;if(n===o)return i;var l,c=i,u=i.x,h=i.y,p=1/0;r=i;do{n>=r.x&&r.x>=u&&n!==r.x&&M_(a<h?n:o,a,u,h,a<h?o:n,a,r.x,r.y)&&(l=Math.abs(a-r.y)/(n-r.x),z_(r,e)&&(l<p||l===p&&(r.x>i.x||r.x===i.x&&b_(i,r)))&&(i=r,p=l)),r=r.next}while(r!==c);return i}(e,t);if(!i)return t;var r=R_(i,e),n=d_(i,i.next);return d_(r,r.next),t===i?n:t}function b_(e,t){return E_(e.prev,e,t.prev)<0&&E_(t.next,e,e.next)<0}function w_(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function S_(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function M_(e,t,i,r,n,a,o,s){return(n-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(r-s)-(i-o)*(t-s)>=0&&(i-o)*(a-s)-(n-o)*(r-s)>=0}function T_(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&A_(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(z_(e,t)&&z_(t,e)&&function(e,t){var i=e,r=!1,n=(e.x+t.x)/2,a=(e.y+t.y)/2;do{i.y>a!==i.next.y>a&&i.next.y!==i.y&&n<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}(e,t)&&(E_(e.prev,e,t.prev)||E_(e,t.prev,t))||C_(e,t)&&E_(e.prev,e,e.next)>0&&E_(t.prev,t,t.next)>0)}function E_(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function C_(e,t){return e.x===t.x&&e.y===t.y}function A_(e,t,i,r){var n=P_(E_(e,t,i)),a=P_(E_(e,t,r)),o=P_(E_(i,r,e)),s=P_(E_(i,r,t));return n!==a&&o!==s||(!(0!==n||!I_(e,i,t))||(!(0!==a||!I_(e,r,t))||(!(0!==o||!I_(i,e,r))||!(0!==s||!I_(i,t,r)))))}function I_(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function P_(e){return e>0?1:e<0?-1:0}function z_(e,t){return E_(e.prev,e,e.next)<0?E_(e,t,e.next)>=0&&E_(e,e.prev,t)>=0:E_(e,t,e.prev)<0||E_(e,e.next,t)<0}function R_(e,t){var i=new D_(e.i,e.x,e.y),r=new D_(t.i,t.x,t.y),n=e.next,a=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,a.next=r,r.prev=a,r}function k_(e,t,i,r){var n=new D_(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function L_(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function D_(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function B_(e,t,i,r){for(var n=0,a=t,o=i-r;a<i;a+=r)n+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return n}u_.exports=h_,u_.exports.default=h_,h_.deviation=function(e,t,i,r){var n=t&&t.length,a=n?t[0]*i:e.length,o=Math.abs(B_(e,0,a,i));if(n)for(var s=0,l=t.length;s<l;s++){var c=t[s]*i,u=s<l-1?t[s+1]*i:e.length;o-=Math.abs(B_(e,c,u,i))}var h=0;for(s=0;s<r.length;s+=3){var p=r[s]*i,d=r[s+1]*i,f=r[s+2]*i;h+=Math.abs((e[p]-e[f])*(e[d+1]-e[p+1])-(e[p]-e[d])*(e[f+1]-e[p+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},h_.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,n=0;n<e.length;n++){for(var a=0;a<e[n].length;a++)for(var o=0;o<t;o++)i.vertices.push(e[n][a][o]);n>0&&(r+=e[n-1].length,i.holes.push(r))}return i};var F_=u_.exports,O_={exports:{}};function N_(e,t){return e<t?-1:e>t?1:0}var V_=Cp(Object.freeze({__proto__:null,default:class{constructor(e=[],t=N_){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:i}=this,r=t[e];for(;e>0;){const n=e-1>>1,a=t[n];if(i(r,a)>=0)break;t[e]=a,e=n}t[e]=r}_down(e){const{data:t,compare:i}=this,r=this.length>>1,n=t[e];for(;e<r;){let r=1+(e<<1),a=t[r];const o=r+1;if(o<this.length&&i(t[o],a)<0&&(r=o,a=t[o]),i(a,n)>=0)break;t[e]=a,e=r}t[e]=n}}}));function U_(e,t,i){var r,n,a,o;t=t||1;for(var s=0;s<e[0].length;s++){var l=e[0][s];(!s||l[0]<r)&&(r=l[0]),(!s||l[1]<n)&&(n=l[1]),(!s||l[0]>a)&&(a=l[0]),(!s||l[1]>o)&&(o=l[1])}var c=a-r,u=o-n,h=Math.min(c,u),p=h/2;if(0===h){var d=[r,n];return d.distance=0,d}for(var f=new V_(void 0,$_),m=r;m<a;m+=h)for(var g=n;g<o;g+=h)f.push(new j_(m+p,g+p,p,e));var _=function(e){for(var t=0,i=0,r=0,n=e[0],a=0,o=n.length,s=o-1;a<o;s=a++){var l=n[a],c=n[s],u=l[0]*c[1]-c[0]*l[1];i+=(l[0]+c[0])*u,r+=(l[1]+c[1])*u,t+=3*u}return 0===t?new j_(n[0][0],n[0][1],0,e):new j_(i/t,r/t,0,e)}(e),y=new j_(r+c/2,n+u/2,0,e);y.d>_.d&&(_=y);for(var v=f.length;f.length;){var x=f.pop();x.d>_.d&&(_=x,i&&console.log("found best %d after %d probes",Math.round(1e4*x.d)/1e4,v)),x.max-_.d<=t||(p=x.h/2,f.push(new j_(x.x-p,x.y-p,p,e)),f.push(new j_(x.x+p,x.y-p,p,e)),f.push(new j_(x.x-p,x.y+p,p,e)),f.push(new j_(x.x+p,x.y+p,p,e)),v+=4)}i&&(console.log("num probes: "+v),console.log("best distance: "+_.d));var b=[_.x,_.y];return b.distance=_.d,b}function $_(e,t){return t.max-e.max}function j_(e,t,i,r){this.x=e,this.y=t,this.h=i,this.d=function(e,t,i){for(var r=!1,n=1/0,a=0;a<i.length;a++)for(var o=i[a],s=0,l=o.length,c=l-1;s<l;c=s++){var u=o[s],h=o[c];u[1]>t!==h[1]>t&&e<(h[0]-u[0])*(t-u[1])/(h[1]-u[1])+u[0]&&(r=!r),n=Math.min(n,q_(e,t,u,h))}return 0===n?0:(r?1:-1)*Math.sqrt(n)}(e,t,r),this.max=this.d+this.h*Math.SQRT2}function q_(e,t,i,r){var n=i[0],a=i[1],o=r[0]-n,s=r[1]-a;if(0!==o||0!==s){var l=((e-n)*o+(t-a)*s)/(o*o+s*s);l>1?(n=r[0],a=r[1]):l>0&&(n+=o*l,a+=s*l)}return(o=e-n)*o+(s=t-a)*s}V_.default&&(V_=V_.default),O_.exports=U_,O_.exports.default=U_;var G_=O_.exports;function H_(e,t){return e>t?1:e<t?-1:0}class W_{constructor(e=H_,t=!1){this._compare=e,this._root=null,this._size=0,this._noDuplicates=!!t}rotateLeft(e){var t=e.right;t&&(e.right=t.left,t.left&&(t.left.parent=e),t.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.left=e),e.parent=t}rotateRight(e){var t=e.left;t&&(e.left=t.right,t.right&&(t.right.parent=e),t.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.right=e),e.parent=t}_splay(e){for(;e.parent;){var t=e.parent;t.parent?t.left===e&&t.parent.left===t?(this.rotateRight(t.parent),this.rotateRight(t)):t.right===e&&t.parent.right===t?(this.rotateLeft(t.parent),this.rotateLeft(t)):t.left===e&&t.parent.right===t?(this.rotateRight(t),this.rotateLeft(t)):(this.rotateLeft(t),this.rotateRight(t)):t.left===e?this.rotateRight(t):this.rotateLeft(t)}}splay(e){for(var t,i,r,n,a;e.parent;)(i=(t=e.parent).parent)&&i.parent?((r=i.parent).left===i?r.left=e:r.right=e,e.parent=r):(e.parent=null,this._root=e),n=e.left,a=e.right,e===t.left?(i&&(i.left===t?(t.right?(i.left=t.right,i.left.parent=i):i.left=null,t.right=i,i.parent=t):(n?(i.right=n,n.parent=i):i.right=null,e.left=i,i.parent=e)),a?(t.left=a,a.parent=t):t.left=null,e.right=t,t.parent=e):(i&&(i.right===t?(t.left?(i.right=t.left,i.right.parent=i):i.right=null,t.left=i,i.parent=t):(a?(i.left=a,a.parent=i):i.left=null,e.right=i,i.parent=e)),n?(t.right=n,n.parent=t):t.right=null,e.left=t,t.parent=e)}replace(e,t){e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.parent=e.parent)}minNode(e=this._root){if(e)for(;e.left;)e=e.left;return e}maxNode(e=this._root){if(e)for(;e.right;)e=e.right;return e}insert(e,t){var i=this._root,r=null,n=this._compare;if(this._noDuplicates)for(;i;){if(r=i,0===n(i.key,e))return;i=n(i.key,e)<0?i.right:i.left}else for(;i;)r=i,i=n(i.key,e)<0?i.right:i.left;return i={key:e,data:t,left:null,right:null,parent:r},r?n(r.key,i.key)<0?r.right=i:r.left=i:this._root=i,this.splay(i),this._size++,i}find(e){for(var t=this._root,i=this._compare;t;){var r=i(t.key,e);if(r<0)t=t.right;else{if(!(r>0))return t;t=t.left}}return null}contains(e){for(var t=this._root,i=this._compare;t;){var r=i(e,t.key);if(0===r)return!0;t=r<0?t.left:t.right}return!1}remove(e){var t=this.find(e);if(!t)return!1;if(this.splay(t),t.left)if(t.right){var i=this.minNode(t.right);i.parent!==t&&(this.replace(i,i.right),i.right=t.right,i.right.parent=i),this.replace(t,i),i.left=t.left,i.left.parent=i}else this.replace(t,t.left);else this.replace(t,t.right);return this._size--,!0}removeNode(e){if(!e)return!1;if(this.splay(e),e.left)if(e.right){var t=this.minNode(e.right);t.parent!==e&&(this.replace(t,t.right),t.right=e.right,t.right.parent=t),this.replace(e,t),t.left=e.left,t.left.parent=t}else this.replace(e,e.left);else this.replace(e,e.right);return this._size--,!0}erase(e){var t=this.find(e);if(t){this.splay(t);var i=t.left,r=t.right,n=null;i&&(i.parent=null,n=this.maxNode(i),this.splay(n),this._root=n),r&&(i?n.right=r:this._root=r,r.parent=n),this._size--}}pop(){var e=this._root,t=null;if(e){for(;e.left;)e=e.left;t={key:e.key,data:e.data},this.remove(e.key)}return t}next(e){var t=e;if(t)if(t.right)for(t=t.right;t&&t.left;)t=t.left;else for(t=e.parent;t&&t.right===e;)e=t,t=t.parent;return t}prev(e){var t=e;if(t)if(t.left)for(t=t.left;t&&t.right;)t=t.right;else for(t=e.parent;t&&t.left===e;)e=t,t=t.parent;return t}forEach(e){for(var t=this._root,i=[],r=!1,n=0;!r;)t?(i.push(t),t=t.left):i.length>0?(e(t=i.pop(),n++),t=t.right):r=!0;return this}range(e,t,i,r){const n=[],a=this._compare;let o,s=this._root;for(;0!==n.length||s;)if(s)n.push(s),s=s.left;else{if(s=n.pop(),o=a(s.key,t),o>0)break;if(a(s.key,e)>=0&&i.call(r,s))return this;s=s.right}return this}keys(){for(var e=this._root,t=[],i=[],r=!1;!r;)e?(t.push(e),e=e.left):t.length>0?(e=t.pop(),i.push(e.key),e=e.right):r=!0;return i}values(){for(var e=this._root,t=[],i=[],r=!1;!r;)e?(t.push(e),e=e.left):t.length>0?(e=t.pop(),i.push(e.data),e=e.right):r=!0;return i}at(e){for(var t=this._root,i=[],r=!1,n=0;!r;)if(t)i.push(t),t=t.left;else if(i.length>0){if(t=i.pop(),n===e)return t;n++,t=t.right}else r=!0;return null}load(e=[],t=[],i=!1){if(0!==this._size)throw new Error("bulk-load: tree is not empty");const r=e.length;return i&&X_(e,t,0,r-1,this._compare),this._root=Z_(null,e,t,0,r),this._size=r,this}min(){var e=this.minNode(this._root);return e?e.key:null}max(){var e=this.maxNode(this._root);return e?e.key:null}isEmpty(){return null===this._root}get size(){return this._size}static createTree(e,t,i,r,n){return new W_(i,n).load(e,t,r)}}function Z_(e,t,i,r,n){const a=n-r;if(a>0){const o=r+Math.floor(a/2),s={key:t[o],data:i[o],parent:e};return s.left=Z_(s,t,i,r,o),s.right=Z_(s,t,i,o+1,n),s}return null}function X_(e,t,i,r,n){if(i>=r)return;const a=e[i+r>>1];let o=i-1,s=r+1;for(;;){do{o++}while(n(e[o],a)<0);do{s--}while(n(e[s],a)>0);if(o>=s)break;let i=e[o];e[o]=e[s],e[s]=i,i=t[o],t[o]=t[s],t[s]=i}X_(e,t,i,s,n),X_(e,t,s+1,r,n)}function Y_(e,t,i){null===t?(e.inOut=!1,e.otherInOut=!0):(e.isSubject===t.isSubject?(e.inOut=!t.inOut,e.otherInOut=t.otherInOut):(e.inOut=!t.otherInOut,e.otherInOut=t.isVertical()?!t.inOut:t.inOut),t&&(e.prevInResult=!K_(t,i)||t.isVertical()?t.prevInResult:t));let r=K_(e,i);e.resultTransition=r?function(e,t){let i,r=!e.inOut,n=!e.otherInOut;switch(t){case 0:i=r&&n;break;case 1:i=r||n;break;case 3:i=r^n;break;case 2:i=e.isSubject?r&&!n:n&&!r}return i?1:-1}(e,i):0}function K_(e,t){switch(e.type){case 0:switch(t){case 0:return!e.otherInOut;case 1:return e.otherInOut;case 2:return e.isSubject&&e.otherInOut||!e.isSubject&&!e.otherInOut;case 3:return!0}break;case 2:return 0===t||1===t;case 3:return 2===t;case 1:return!1}return!1}class J_{constructor(e,t,i,r,n){this.left=t,this.point=e,this.otherEvent=i,this.isSubject=r,this.type=n||0,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0}isBelow(e){const t=this.point,i=this.otherEvent.point;return this.left?(t[0]-e[0])*(i[1]-e[1])-(i[0]-e[0])*(t[1]-e[1])>0:(i[0]-e[0])*(t[1]-e[1])-(t[0]-e[0])*(i[1]-e[1])>0}isAbove(e){return!this.isBelow(e)}isVertical(){return this.point[0]===this.otherEvent.point[0]}get inResult(){return 0!==this.resultTransition}clone(){const e=new J_(this.point,this.left,this.otherEvent,this.isSubject,this.type);return e.contourId=this.contourId,e.resultTransition=this.resultTransition,e.prevInResult=this.prevInResult,e.isExteriorRing=this.isExteriorRing,e.inOut=this.inOut,e.otherInOut=this.otherInOut,e}}function Q_(e,t){return e[0]===t[0]&&e[1]===t[1]}const ey=134217729;function ty(e,t,i,r,n){let a,o,s,l,c=t[0],u=r[0],h=0,p=0;u>c===u>-c?(a=c,c=t[++h]):(a=u,u=r[++p]);let d=0;if(h<e&&p<i)for(u>c===u>-c?(o=c+a,s=a-(o-c),c=t[++h]):(o=u+a,s=a-(o-u),u=r[++p]),a=o,0!==s&&(n[d++]=s);h<e&&p<i;)u>c===u>-c?(o=a+c,l=o-a,s=a-(o-l)+(c-l),c=t[++h]):(o=a+u,l=o-a,s=a-(o-l)+(u-l),u=r[++p]),a=o,0!==s&&(n[d++]=s);for(;h<e;)o=a+c,l=o-a,s=a-(o-l)+(c-l),c=t[++h],a=o,0!==s&&(n[d++]=s);for(;p<i;)o=a+u,l=o-a,s=a-(o-l)+(u-l),u=r[++p],a=o,0!==s&&(n[d++]=s);return 0===a&&0!==d||(n[d++]=a),d}function iy(e){return new Float64Array(e)}const ry=iy(4),ny=iy(8),ay=iy(12),oy=iy(16),sy=iy(4);function ly(e,t,i,r,n,a){const o=(t-a)*(i-n),s=(e-n)*(r-a),l=o-s;if(0===o||0===s||o>0!==s>0)return l;const c=Math.abs(o+s);return Math.abs(l)>=33306690738754716e-32*c?l:-function(e,t,i,r,n,a,o){let s,l,c,u,h,p,d,f,m,g,_,y,v,x,b,w,S,M;const T=e-n,E=i-n,C=t-a,A=r-a;x=T*A,p=ey*T,d=p-(p-T),f=T-d,p=ey*A,m=p-(p-A),g=A-m,b=f*g-(x-d*m-f*m-d*g),w=C*E,p=ey*C,d=p-(p-C),f=C-d,p=ey*E,m=p-(p-E),g=E-m,S=f*g-(w-d*m-f*m-d*g),_=b-S,h=b-_,ry[0]=b-(_+h)+(h-S),y=x+_,h=y-x,v=x-(y-h)+(_-h),_=v-w,h=v-_,ry[1]=v-(_+h)+(h-w),M=y+_,h=M-y,ry[2]=y-(M-h)+(_-h),ry[3]=M;let I=function(e,t){let i=t[0];for(let r=1;r<e;r++)i+=t[r];return i}(4,ry),P=22204460492503146e-32*o;if(I>=P||-I>=P)return I;if(h=e-T,s=e-(T+h)+(h-n),h=i-E,c=i-(E+h)+(h-n),h=t-C,l=t-(C+h)+(h-a),h=r-A,u=r-(A+h)+(h-a),0===s&&0===l&&0===c&&0===u)return I;if(P=11093356479670487e-47*o+33306690738754706e-32*Math.abs(I),I+=T*u+A*s-(C*c+E*l),I>=P||-I>=P)return I;x=s*A,p=ey*s,d=p-(p-s),f=s-d,p=ey*A,m=p-(p-A),g=A-m,b=f*g-(x-d*m-f*m-d*g),w=l*E,p=ey*l,d=p-(p-l),f=l-d,p=ey*E,m=p-(p-E),g=E-m,S=f*g-(w-d*m-f*m-d*g),_=b-S,h=b-_,sy[0]=b-(_+h)+(h-S),y=x+_,h=y-x,v=x-(y-h)+(_-h),_=v-w,h=v-_,sy[1]=v-(_+h)+(h-w),M=y+_,h=M-y,sy[2]=y-(M-h)+(_-h),sy[3]=M;const z=ty(4,ry,4,sy,ny);x=T*u,p=ey*T,d=p-(p-T),f=T-d,p=ey*u,m=p-(p-u),g=u-m,b=f*g-(x-d*m-f*m-d*g),w=C*c,p=ey*C,d=p-(p-C),f=C-d,p=ey*c,m=p-(p-c),g=c-m,S=f*g-(w-d*m-f*m-d*g),_=b-S,h=b-_,sy[0]=b-(_+h)+(h-S),y=x+_,h=y-x,v=x-(y-h)+(_-h),_=v-w,h=v-_,sy[1]=v-(_+h)+(h-w),M=y+_,h=M-y,sy[2]=y-(M-h)+(_-h),sy[3]=M;const R=ty(z,ny,4,sy,ay);x=s*u,p=ey*s,d=p-(p-s),f=s-d,p=ey*u,m=p-(p-u),g=u-m,b=f*g-(x-d*m-f*m-d*g),w=l*c,p=ey*l,d=p-(p-l),f=l-d,p=ey*c,m=p-(p-c),g=c-m,S=f*g-(w-d*m-f*m-d*g),_=b-S,h=b-_,sy[0]=b-(_+h)+(h-S),y=x+_,h=y-x,v=x-(y-h)+(_-h),_=v-w,h=v-_,sy[1]=v-(_+h)+(h-w),M=y+_,h=M-y,sy[2]=y-(M-h)+(_-h),sy[3]=M;const k=ty(R,ay,4,sy,oy);return oy[k-1]}(e,t,i,r,n,a,c)}function cy(e,t,i){const r=ly(e[0],e[1],t[0],t[1],i[0],i[1]);return r>0?-1:r<0?1:0}function uy(e,t){const i=e.point,r=t.point;return i[0]>r[0]?1:i[0]<r[0]?-1:i[1]!==r[1]?i[1]>r[1]?1:-1:function(e,t,i,r){if(e.left!==t.left)return e.left?1:-1;if(0!==cy(i,e.otherEvent.point,t.otherEvent.point))return e.isBelow(t.otherEvent.point)?-1:1;return!e.isSubject&&t.isSubject?1:-1}(e,t,i)}function hy(e,t,i){const r=new J_(t,!1,e,e.isSubject),n=new J_(t,!0,e.otherEvent,e.isSubject);return Q_(e.point,e.otherEvent.point)&&console.warn("what is that, a collapsed segment?",e),r.contourId=n.contourId=e.contourId,uy(n,e.otherEvent)>0&&(e.otherEvent.left=!0,n.left=!1),e.otherEvent.otherEvent=n,e.otherEvent=r,i.push(n),i.push(r),i}function py(e,t){return e[0]*t[1]-e[1]*t[0]}function dy(e,t){return e[0]*t[0]+e[1]*t[1]}function fy(e,t,i){const r=function(e,t,i,r,n){const a=[t[0]-e[0],t[1]-e[1]],o=[r[0]-i[0],r[1]-i[1]];function s(e,t,i){return[e[0]+t*i[0],e[1]+t*i[1]]}const l=[i[0]-e[0],i[1]-e[1]];let c=py(a,o),u=c*c;const h=dy(a,a);if(u>0){const t=py(l,o)/c;if(t<0||t>1)return null;const r=py(l,a)/c;return r<0||r>1?null:0===t||1===t?n?null:[s(e,t,a)]:0===r||1===r?n?null:[s(i,r,o)]:[s(e,t,a)]}if(c=py(l,a),u=c*c,u>0)return null;const p=dy(a,l)/h,d=p+dy(a,o)/h,f=Math.min(p,d),m=Math.max(p,d);return f<=1&&m>=0?1===f?n?null:[s(e,f>0?f:0,a)]:0===m?n?null:[s(e,m<1?m:1,a)]:n&&0===f&&1===m?null:[s(e,f>0?f:0,a),s(e,m<1?m:1,a)]:null}(e.point,e.otherEvent.point,t.point,t.otherEvent.point),n=r?r.length:0;if(0===n)return 0;if(1===n&&(Q_(e.point,t.point)||Q_(e.otherEvent.point,t.otherEvent.point)))return 0;if(2===n&&e.isSubject===t.isSubject)return 0;if(1===n)return Q_(e.point,r[0])||Q_(e.otherEvent.point,r[0])||hy(e,r[0],i),Q_(t.point,r[0])||Q_(t.otherEvent.point,r[0])||hy(t,r[0],i),1;const a=[];let o=!1,s=!1;return Q_(e.point,t.point)?o=!0:1===uy(e,t)?a.push(t,e):a.push(e,t),Q_(e.otherEvent.point,t.otherEvent.point)?s=!0:1===uy(e.otherEvent,t.otherEvent)?a.push(t.otherEvent,e.otherEvent):a.push(e.otherEvent,t.otherEvent),o&&s||o?(t.type=1,e.type=t.inOut===e.inOut?2:3,o&&!s&&hy(a[1].otherEvent,a[0].point,i),2):s?(hy(a[0],a[1].point,i),3):a[0]!==a[3].otherEvent?(hy(a[0],a[1].point,i),hy(a[1],a[2].point,i),3):(hy(a[0],a[1].point,i),hy(a[3].otherEvent,a[2].point,i),3)}function my(e,t){if(e===t)return 0;if(0!==cy(e.point,e.otherEvent.point,t.point)||0!==cy(e.point,e.otherEvent.point,t.otherEvent.point))return Q_(e.point,t.point)?e.isBelow(t.otherEvent.point)?-1:1:e.point[0]===t.point[0]?e.point[1]<t.point[1]?-1:1:1===uy(e,t)?t.isAbove(e.point)?-1:1:e.isBelow(t.point)?-1:1;if(e.isSubject!==t.isSubject)return e.isSubject?-1:1;{let i=e.point,r=t.point;if(i[0]===r[0]&&i[1]===r[1])return i=e.otherEvent.point,r=t.otherEvent.point,i[0]===r[0]&&i[1]===r[1]?0:e.contourId>t.contourId?1:-1}return 1===uy(e,t)?1:-1}class gy{constructor(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null}isExterior(){return null==this.holeOf}}function _y(e,t,i,r){let n,a=e+1,o=t[e].point;const s=t.length;for(a<s&&(n=t[a].point);a<s&&n[0]===o[0]&&n[1]===o[1];){if(!i[a])return a;a++,n=t[a].point}for(a=e-1;i[a]&&a>r;)a--;return a}function yy(e,t,i){const r=new gy;if(null!=e.prevInResult){const n=e.prevInResult,a=n.outputContourId;if(n.resultTransition>0){const e=t[a];if(null!=e.holeOf){const n=e.holeOf;t[n].holeIds.push(i),r.holeOf=n,r.depth=t[a].depth}else t[a].holeIds.push(i),r.holeOf=a,r.depth=t[a].depth+1}else r.holeOf=null,r.depth=t[a].depth}else r.holeOf=null,r.depth=0;return r}function vy(e){let t,i;const r=function(e){let t,i,r,n;const a=[];for(i=0,r=e.length;i<r;i++)t=e[i],(t.left&&t.inResult||!t.left&&t.otherEvent.inResult)&&a.push(t);let o=!1;for(;!o;)for(o=!0,i=0,r=a.length;i<r;i++)i+1<r&&1===uy(a[i],a[i+1])&&(n=a[i],a[i]=a[i+1],a[i+1]=n,o=!1);for(i=0,r=a.length;i<r;i++)t=a[i],t.otherPos=i;for(i=0,r=a.length;i<r;i++)t=a[i],t.left||(n=t.otherPos,t.otherPos=t.otherEvent.otherPos,t.otherEvent.otherPos=n);return a}(e),n={},a=[];for(t=0,i=r.length;t<i;t++){if(n[t])continue;const e=a.length,i=yy(r[t],a,e),o=t=>{n[t]=!0,r[t].outputContourId=e};let s=t,l=t;const c=r[t].point;for(i.points.push(c);o(s),s=r[s].otherPos,o(s),i.points.push(r[s].point),s=_y(s,r,n,l),s!=l;);a.push(i)}return a}var xy={exports:{}};function by(e,t){if(!(this instanceof by))return new by(e,t);if(this.data=e||[],this.length=this.data.length,this.compare=t||wy,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)}function wy(e,t){return e<t?-1:e>t?1:0}xy.exports=by,xy.exports.default=by,by.prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var t=this.data,i=this.compare,r=t[e];e>0;){var n=e-1>>1,a=t[n];if(i(r,a)>=0)break;t[e]=a,e=n}t[e]=r},_down:function(e){for(var t=this.data,i=this.compare,r=this.length>>1,n=t[e];e<r;){var a=1+(e<<1),o=a+1,s=t[a];if(o<this.length&&i(t[o],s)<0&&(a=o,s=t[o]),i(s,n)>=0)break;t[e]=s,e=a}t[e]=n}};var Sy=xy.exports;const My=Math.max,Ty=Math.min;let Ey=0;function Cy(e,t,i,r,n,a){let o,s,l,c,u,h;for(o=0,s=e.length-1;o<s;o++){if(l=e[o],c=e[o+1],u=new J_(l,!1,void 0,t),h=new J_(c,!1,u,t),u.otherEvent=h,l[0]===c[0]&&l[1]===c[1])continue;u.contourId=h.contourId=i,a||(u.isExteriorRing=!1,h.isExteriorRing=!1),uy(u,h)>0?h.left=!0:u.left=!0;const s=l[0],p=l[1];n[0]=Ty(n[0],s),n[1]=Ty(n[1],p),n[2]=My(n[2],s),n[3]=My(n[3],p),r.push(u),r.push(h)}}const Ay=[];function Iy(e,t,i){"number"===typeof e[0][0][0]&&(e=[e]),"number"===typeof t[0][0][0]&&(t=[t]);let r=function(e,t,i){let r=null;return e.length*t.length===0&&(0===i?r=Ay:2===i?r=e:1!==i&&3!==i||(r=0===e.length?t:e)),r}(e,t,i);if(r)return r===Ay?null:r;const n=[1/0,1/0,-1/0,-1/0],a=[1/0,1/0,-1/0,-1/0],o=function(e,t,i,r,n){const a=new Sy(null,uy);let o,s,l,c,u,h;for(l=0,c=e.length;l<c;l++)for(o=e[l],u=0,h=o.length;u<h;u++)s=0===u,s&&Ey++,Cy(o[u],!0,Ey,a,i,s);for(l=0,c=t.length;l<c;l++)for(o=t[l],u=0,h=o.length;u<h;u++)s=0===u,2===n&&(s=!1),s&&Ey++,Cy(o[u],!1,Ey,a,r,s);return a}(e,t,n,a,i);if(r=function(e,t,i,r,n){let a=null;return(i[0]>r[2]||r[0]>i[2]||i[1]>r[3]||r[1]>i[3])&&(0===n?a=Ay:2===n?a=e:1!==n&&3!==n||(a=e.concat(t))),a}(e,t,n,a,i),r)return r===Ay?null:r;const s=function(e,t,i,r,n,a){const o=new W_(my),s=[],l=Math.min(r[2],n[2]);let c,u,h;for(;0!==e.length;){let t=e.pop();if(s.push(t),0===a&&t.point[0]>l||2===a&&t.point[0]>r[2])break;if(t.left){u=c=o.insert(t),h=o.minNode(),c=c!==h?o.prev(c):null,u=o.next(u);const i=c?c.key:null;let r;if(Y_(t,i,a),u&&2===fy(t,u.key,e)&&(Y_(t,i,a),Y_(t,u.key,a)),c&&2===fy(c.key,t,e)){let e=c;e=e!==h?o.prev(e):null,r=e?e.key:null,Y_(i,r,a),Y_(t,i,a)}}else t=t.otherEvent,u=c=o.find(t),c&&u&&(c=c!==h?o.prev(c):null,u=o.next(u),o.remove(t),u&&c&&fy(c.key,u.key,e))}return s}(o,0,0,n,a,i),l=vy(s),c=[];for(let u=0;u<l.length;u++){let e=l[u];if(e.isExterior()){let t=[e.points];for(let i=0;i<e.holeIds.length;i++){let r=e.holeIds[i];t.push(l[r].points)}c.push(t)}}return c}class Py extends o_{constructor(){super(),this._subsampleThreshold=.005}_getPoleOfInaccessibility2d(e){return G_([e],.03)}_project(e,t){const i=this._createCamera(t.upVector().toArray(),t.unprojectSfM([0,0],0),t.unprojectSfM([0,0],10));return this._deunproject(e,t,i)}_subsample(e,t=this._subsampleThreshold){const i=[],r=e.length;for(let n=0;n<r;n++){const a=e[n],o=e[(n+1)%r];i.push(a);const s=Math.sqrt(Math.pow(o[0]-a[0],2)+Math.pow(o[1]-a[1],2)),l=Math.floor(s/t),c=1/(l+1);for(let e=1;e<=l;e++){const t=e*c,r=[(1-t)*a[0]+t*o[0],(1-t)*a[1]+t*o[1]];i.push(r)}}return i}_triangulate(e,t,i,r){let n=[e.slice(0,-1)];for(let c of null!=i?i:[])n.push(c.slice(0,-1));let a=t.slice(0,-1);for(let c of null!=r?r:[])a=a.concat(c.slice(0,-1));let o=F_.flatten(n),s=F_(o.vertices,o.holes,o.dimensions),l=[];for(let c=0;c<s.length;++c){let e=a[s[c]];l.push(e[0]),l.push(e[1]),l.push(e[2])}return l}_triangulateSpherical(e,t,i){const r=[],n=1e-9;for(let a=0;a<3;a++)for(let o=0;o<3;o++){const s=a/3+(0===a?-1e-9:n),l=o/3+(0===o?-1e-9:n),c=(a+1)/3+n,u=(o+1)/3+n,h=[[s,l],[s,u],[c,u],[c,l],[s,l]],p=[(2*a+1)/6,(2*o+1)/6];r.push(...this._triangulateSubarea(e,t,h,p,i))}return r}_unproject(e,t,i=200){return e.map((e=>t.unprojectBasic(e,i)))}_createCamera(e,t,i){const r=new Ia;return r.up.copy((new xr).fromArray(e)),r.position.copy((new xr).fromArray(t)),r.lookAt((new xr).fromArray(i)),r.updateMatrix(),r.updateMatrixWorld(!0),r}_deunproject(e,t,i){return e.map((e=>{const r=t.unprojectBasic(e,1e4),n=new xr(r[0],r[1],r[2]).applyMatrix4(i.matrixWorldInverse);return[n.x/n.z,n.y/n.z]}))}_triangulateSubarea(e,t,i,r,n){const a=Iy([e,...t],[i],0);if(!a)return[];const o=[],s=this._subsampleThreshold,l=this._createCamera(n.upVector().toArray(),n.unprojectSfM([0,0],0),n.unprojectBasic(r,10));for(const c of a){const e=this._subsample(c[0],s),t=this._deunproject(e,n,l),i=this._unproject(e,n),r=[],a=[];for(let o=1;o<c.length;o++){let e=this._subsample(c[o],s);const t=this._deunproject(e,n,l),i=this._unproject(e,n);r.push(t),a.push(i)}o.push(...this._triangulate(t,i,r,a))}return o}}class zy extends Py{constructor(e){if(super(),4!==e.length)throw new s_("Rectangle needs to have four values.");if(e[1]>e[3])throw new s_("Basic Y coordinates values can not be inverted.");for(let t of e)if(t<0||t>1)throw new s_("Basic coordinates must be on the interval [0, 1].");this._anchorIndex=void 0,this._rect=e.slice(0,4),this._inverted=this._rect[0]>this._rect[2]}get anchorIndex(){return this._anchorIndex}get inverted(){return this._inverted}get rect(){return this._rect}initializeAnchorIndexing(e){if(void 0!==this._anchorIndex)throw new s_("Anchor indexing is already initialized.");if(e<0||e>3)throw new s_(`Invalid anchor index: ${e}.`);this._anchorIndex=void 0===e?0:e}terminateAnchorIndexing(){this._anchorIndex=void 0}setOppositeVertex2d(e,t){if(void 0===this._anchorIndex)throw new s_("Anchor indexing needs to be initialized.");const i=[Math.max(0,Math.min(1,e[0])),Math.max(0,Math.min(1,e[1]))],r=this._rect.slice(),n=0===this._anchorIndex?[r[0],r[3]]:1===this._anchorIndex?[r[0],r[1]]:2===this._anchorIndex?[r[2],r[1]]:[r[2],r[3]];if(Qh(t.cameraType)){const e=this._anchorIndex<2?i[0]-r[2]:i[0]-r[0];!this._inverted&&this._anchorIndex<2&&i[0]<.25&&r[2]>.75&&e<-.5||!this._inverted&&this._anchorIndex>=2&&i[0]<.25&&r[2]>.75&&e<-.5?(this._inverted=!0,this._anchorIndex=n[1]>i[1]?0:1):this._inverted&&this._anchorIndex>=2&&i[0]<.25&&r[0]>.75&&e<-.5?(this._inverted=!1,this._anchorIndex=n[0]>i[0]?n[1]>i[1]?3:2:n[1]>i[1]?0:1):!this._inverted&&this._anchorIndex>=2&&i[0]>.75&&r[0]<.25&&e>.5||!this._inverted&&this._anchorIndex<2&&i[0]>.75&&r[0]<.25&&e>.5?(this._inverted=!0,this._anchorIndex=n[1]>i[1]?3:2):this._inverted&&this._anchorIndex<2&&i[0]>.75&&r[2]<.25&&e>.5?(this._inverted=!1,this._anchorIndex=n[0]>i[0]?n[1]>i[1]?3:2:n[1]>i[1]?0:1):this._inverted&&this._anchorIndex<2&&i[0]>r[0]?(this._inverted=!1,this._anchorIndex=n[1]>i[1]?0:1):this._inverted&&this._anchorIndex>=2&&i[0]<r[2]?(this._inverted=!1,this._anchorIndex=n[1]>i[1]?3:2):this._inverted?this._anchorIndex<2?this._anchorIndex=n[1]>i[1]?0:1:this._anchorIndex=n[1]>i[1]?3:2:this._anchorIndex=n[0]<=i[0]&&n[1]>i[1]?0:n[0]<=i[0]&&n[1]<=i[1]?1:n[0]>i[0]&&n[1]<=i[1]?2:3;const t=[];0===this._anchorIndex?(t[0]=n[0],t[1]=i[1],t[2]=i[0],t[3]=n[1]):1===this._anchorIndex?(t[0]=n[0],t[1]=n[1],t[2]=i[0],t[3]=i[1]):2===this._anchorIndex?(t[0]=i[0],t[1]=n[1],t[2]=n[0],t[3]=i[1]):(t[0]=i[0],t[1]=i[1],t[2]=n[0],t[3]=n[1]),(!this._inverted&&t[0]>t[2]||this._inverted&&t[0]<t[2])&&(t[0]=r[0],t[2]=r[2]),t[1]>t[3]&&(t[1]=r[1],t[3]=r[3]),this._rect[0]=t[0],this._rect[1]=t[1],this._rect[2]=t[2],this._rect[3]=t[3]}else{this._anchorIndex=n[0]<=i[0]&&n[1]>i[1]?0:n[0]<=i[0]&&n[1]<=i[1]?1:n[0]>i[0]&&n[1]<=i[1]?2:3;const e=[];0===this._anchorIndex?(e[0]=n[0],e[1]=i[1],e[2]=i[0],e[3]=n[1]):1===this._anchorIndex?(e[0]=n[0],e[1]=n[1],e[2]=i[0],e[3]=i[1]):2===this._anchorIndex?(e[0]=i[0],e[1]=n[1],e[2]=n[0],e[3]=i[1]):(e[0]=i[0],e[1]=i[1],e[2]=n[0],e[3]=n[1]),e[0]>e[2]&&(e[0]=r[0],e[2]=r[2]),e[1]>e[3]&&(e[1]=r[1],e[3]=r[3]),this._rect[0]=e[0],this._rect[1]=e[1],this._rect[2]=e[2],this._rect[3]=e[3]}this._notifyChanged$.next(this)}setVertex2d(e,t,i){let r=this._rect.slice(),n=[Math.max(0,Math.min(1,t[0])),Math.max(0,Math.min(1,t[1]))],a=[];if(0===e?(a[0]=n[0],a[1]=r[1],a[2]=r[2],a[3]=n[1]):1===e?(a[0]=n[0],a[1]=n[1],a[2]=r[2],a[3]=r[3]):2===e?(a[0]=r[0],a[1]=n[1],a[2]=n[0],a[3]=r[3]):3===e&&(a[0]=r[0],a[1]=r[1],a[2]=n[0],a[3]=n[1]),Qh(i.cameraType)){let t=e<2&&n[0]>.75&&r[0]<.25||e>=2&&this._inverted&&n[0]>.75&&r[2]<.25,i=e<2&&this._inverted&&n[0]<.25&&r[0]>.75||e>=2&&n[0]<.25&&r[2]>.75;t||i?this._inverted=!this._inverted:(a[0]-r[0]<-.25&&(a[0]=r[0]),a[2]-r[2]>.25&&(a[2]=r[2])),(!this._inverted&&a[0]>a[2]||this._inverted&&a[0]<a[2])&&(a[0]=r[0],a[2]=r[2])}else a[0]>a[2]&&(a[0]=r[0],a[2]=r[2]);a[1]>a[3]&&(a[1]=r[1],a[3]=r[3]),this._rect[0]=a[0],this._rect[1]=a[1],this._rect[2]=a[2],this._rect[3]=a[3],this._notifyChanged$.next(this)}setCentroid2d(e,t){let i=this._rect.slice(),r=i[0],n=this._inverted?i[2]+1:i[2],a=i[1],o=i[3],s=r+(n-r)/2,l=a+(o-a)/2,c=0;if(Qh(t.cameraType))c=this._inverted?e[0]+1-s:e[0]-s;else{let t=-r,i=1-n;c=Math.max(t,Math.min(i,e[0]-s))}let u=-a,h=1-o,p=Math.max(u,Math.min(h,e[1]-l));this._rect[0]=i[0]+c,this._rect[1]=i[1]+p,this._rect[2]=i[2]+c,this._rect[3]=i[3]+p,this._rect[0]<0?(this._rect[0]+=1,this._inverted=!this._inverted):this._rect[0]>1&&(this._rect[0]-=1,this._inverted=!this._inverted),this._rect[2]<0?(this._rect[2]+=1,this._inverted=!this._inverted):this._rect[2]>1&&(this._rect[2]-=1,this._inverted=!this._inverted),this._notifyChanged$.next(this)}getPoints3d(e){return this._getPoints2d().map((t=>e.unprojectBasic(t,200)))}getVertex2d(e){return this._rectToVertices2d(this._rect)[e]}getNonAdjustedVertex2d(e){return this._rectToNonAdjustedVertices2d(this._rect)[e]}getVertex3d(e,t){return t.unprojectBasic(this._rectToVertices2d(this._rect)[e],200)}getVertices2d(){return this._rectToVertices2d(this._rect)}getVertices3d(e){return this._rectToVertices2d(this._rect).map((t=>e.unprojectBasic(t,200)))}getCentroid2d(){const e=this._rect;return[(e[0]+(this._inverted?e[2]+1:e[2]))/2,(e[1]+e[3])/2]}getCentroid3d(e){const t=this.getCentroid2d();return e.unprojectBasic(t,200)}getPoleOfInaccessibility2d(){return this._getPoleOfInaccessibility2d(this._rectToVertices2d(this._rect))}getPoleOfInaccessibility3d(e){let t=this._getPoleOfInaccessibility2d(this._rectToVertices2d(this._rect));return e.unprojectBasic(t,200)}getTriangles3d(e){return Qh(e.cameraType)?[]:this._triangulate(this._project(this._getPoints2d(),e),this.getPoints3d(e))}validate(e){let t=this._rect;return!(!this._inverted&&e[0]<t[0]||e[0]-t[2]>.25||e[1]<t[1])}_getPoints2d(){let e=this._rectToVertices2d(this._rect),t=e.length-1,i=[];for(let r=0;r<t;++r){let t=e[r][0],n=e[r][1],a=(e[r+1][0]-t)/9,o=(e[r+1][1]-n)/9;for(let e=0;e<10;++e){let r=[t+e*a,n+e*o];i.push(r)}}return i}_rectToVertices2d(e){return[[e[0],e[3]],[e[0],e[1]],[this._inverted?e[2]+1:e[2],e[1]],[this._inverted?e[2]+1:e[2],e[3]],[e[0],e[3]]]}_rectToNonAdjustedVertices2d(e){return[[e[0],e[3]],[e[0],e[1]],[e[2],e[1]],[e[2],e[3]],[e[0],e[3]]]}}class Ry extends c_{constructor(e,t,i,r){super(e,i,r),this._options={color:null==t.color?16777215:t.color,indicateCompleter:null==t.indicateCompleter||t.indicateCompleter},this._rectGeometry=new zy(this._geometry.getRect2d(i)),this._createGlObjects()}create(){this._geometry.points.length<3||(this._geometry.removePoint2d(this._geometry.points.length-1),this._created$.next(this))}dispose(){super.dispose(),this._disposeObjects()}getDOMObjects(e,t){const i={offsetHeight:t.height,offsetWidth:t.width},r=[],n=this._geometry.getPoints2d(),a=n.length;for(let o=0;o<a-1;o++){const t=o,[s,l]=n[o],c=this._viewportCoords.basicToCanvasSafe(s,l,i,this._transform,e);if(!c)continue;const u=e=>{e.stopPropagation(),this._aborted$.next(this)},h=e=>{e.stopPropagation(),this._geometry.removePoint2d(t)},p=this._canvasToTransform(c),d={onclick:0===o&&a<3?u:h,style:{transform:p}};r.push(Sm.h("div.mapillary-tag-interactor",d,[]));const f={style:{background:this._colorToBackground(this._options.color),transform:p}};r.push(Sm.h("div.mapillary-tag-vertex",f,[]))}if(a>2&&!0===this._options.indicateCompleter){const[t,n]=this._geometry.getCentroid2d(this._transform),a=this._viewportCoords.basicToCanvasSafe(t,n,i,this._transform,e);if(a){const e=e=>{e.stopPropagation(),this._geometry.removePoint2d(this._geometry.points.length-1),this._created$.next(this)},t=this._canvasToTransform(a),i={onclick:e,style:{transform:t}};r.push(Sm.h("div.mapillary-tag-completer.mapillary-tag-larger",i,[]));const n={style:{background:this._colorToBackground(this._options.color),transform:t}};r.push(Sm.h("div.mapillary-tag-vertex.mapillary-tag-larger",n,[]));const o={style:{transform:t}};r.push(Sm.h("div.mapillary-tag-dot",o,[]))}}return r}_onGeometryChanged(){this._disposeObjects(),this._rectGeometry=new zy(this._geometry.getRect2d(this._transform)),this._createGlObjects()}_createGlObjects(){this._glObjects=[];const e=this._rectGeometry.getPoints3d(this._transform);this._outline=this._createOutine(e,this._options.color),this._glObjects.push(this._outline)}_disposeObjects(){this._disposeLine(this._outline),this._outline=null,this._glObjects=null}}class ky extends Py{constructor(e,t){super();let i=e.length;if(i<3)throw new s_("A polygon must have three or more positions.");if(e[0][0]!==e[i-1][0]||e[0][1]!==e[i-1][1])throw new s_("First and last positions must be equivalent.");this._polygon=[];for(let r of e){if(r[0]<0||r[0]>1||r[1]<0||r[1]>1)throw new s_("Basic coordinates of polygon must be on the interval [0, 1].");this._polygon.push(r.slice())}if(this._holes=[],null!=t)for(let r=0;r<t.length;r++){let e=t[r],i=e.length;if(i<3)throw new s_("A polygon hole must have three or more positions.");if(e[0][0]!==e[i-1][0]||e[0][1]!==e[i-1][1])throw new s_("First and last positions of hole must be equivalent.");this._holes.push([]);for(let t of e){if(t[0]<0||t[0]>1||t[1]<0||t[1]>1)throw new s_("Basic coordinates of hole must be on the interval [0, 1].");this._holes[r].push(t.slice())}}}get polygon(){return this._polygon}get holes(){return this._holes}addVertex2d(e){let t=[Math.max(0,Math.min(1,e[0])),Math.max(0,Math.min(1,e[1]))];this._polygon.splice(this._polygon.length-1,0,t),this._notifyChanged$.next(this)}getVertex2d(e){return this._polygon[e].slice()}removeVertex2d(e){if(e<0||e>=this._polygon.length||this._polygon.length<4)throw new s_("Index for removed vertex must be valid.");if(e>0&&e<this._polygon.length-1)this._polygon.splice(e,1);else{this._polygon.splice(0,1),this._polygon.pop();let e=this._polygon[0].slice();this._polygon.push(e)}this._notifyChanged$.next(this)}setVertex2d(e,t,i){let r=[Math.max(0,Math.min(1,t[0])),Math.max(0,Math.min(1,t[1]))];0===e||e===this._polygon.length-1?(this._polygon[0]=r.slice(),this._polygon[this._polygon.length-1]=r.slice()):this._polygon[e]=r.slice(),this._notifyChanged$.next(this)}setCentroid2d(e,t){let i=this._polygon.map((e=>e[0])),r=this._polygon.map((e=>e[1])),n=Math.min.apply(Math,i),a=Math.max.apply(Math,i),o=Math.min.apply(Math,r),s=Math.max.apply(Math,r),l=this.getCentroid2d(),c=-n,u=1-a,h=-o,p=1-s,d=Math.max(c,Math.min(u,e[0]-l[0])),f=Math.max(h,Math.min(p,e[1]-l[1]));for(let m of this._polygon)m[0]+=d,m[1]+=f;this._notifyChanged$.next(this)}getPoints3d(e){return this._getPoints3d(this._subsample(this._polygon),e)}getVertex3d(e,t){return t.unprojectBasic(this._polygon[e],200)}getVertices2d(){return this._polygon.slice()}getVertices3d(e){return this._getPoints3d(this._polygon,e)}getHolePoints3d(e){return this._holes.map((t=>this._getPoints3d(this._subsample(t),e)))}getHoleVertices3d(e){return this._holes.map((t=>this._getPoints3d(t,e)))}getCentroid2d(){let e=this._polygon,t=0,i=0,r=0;for(let n=0;n<e.length-1;n++){let a=e[n][0],o=e[n][1],s=e[n+1][0],l=e[n+1][1],c=a*l-s*o;t+=c,i+=(a+s)*c,r+=(o+l)*c}return t/=2,i/=6*t,r/=6*t,[i,r]}getCentroid3d(e){let t=this.getCentroid2d();return e.unprojectBasic(t,200)}get3dDomainTriangles3d(e){return this._triangulate(this._project(this._polygon,e),this.getVertices3d(e),this._holes.map((t=>this._project(t,e))),this.getHoleVertices3d(e))}getTriangles3d(e){if(Qh(e.cameraType))return this._triangulateSpherical(this._polygon.slice(),this.holes.slice(),e);const t=this._project(this._subsample(this._polygon),e),i=this.getPoints3d(e),r=this._holes.map((t=>this._project(this._subsample(t),e))),n=this.getHolePoints3d(e);return this._triangulate(t,i,r,n)}getPoleOfInaccessibility2d(){return this._getPoleOfInaccessibility2d(this._polygon.slice())}getPoleOfInaccessibility3d(e){let t=this._getPoleOfInaccessibility2d(this._polygon.slice());return e.unprojectBasic(t,200)}_getPoints3d(e,t){return e.map((e=>t.unprojectBasic(e,200)))}}class Ly extends c_{constructor(e,t,i,r){super(e,i,r),this._options={color:null==t.color?16777215:t.color},this._createGlObjects()}create(){if(this._geometry instanceof zy)this._created$.next(this);else if(this._geometry instanceof ky){const e=this._geometry;e.removeVertex2d(e.polygon.length-2),this._created$.next(this)}}dispose(){super.dispose(),this._disposeLine(this._outline),this._disposeObjects()}getDOMObjects(e,t){const i=[],r={offsetHeight:t.height,offsetWidth:t.width},n=e=>{e.stopPropagation(),this._aborted$.next(this)};if(this._geometry instanceof zy){const t=this._geometry.anchorIndex,a=void 0===t?1:t,[o,s]=this._geometry.getVertex2d(a),l=this._viewportCoords.basicToCanvasSafe(o,s,r,this._transform,e);if(null!=l){const e=this._colorToBackground(this._options.color),t=this._canvasToTransform(l),r={style:{background:e,transform:t}},a={onclick:n,style:{transform:t}};i.push(Sm.h("div.mapillary-tag-interactor",a,[])),i.push(Sm.h("div.mapillary-tag-vertex",r,[]))}}else if(this._geometry instanceof ky){const t=this._geometry,[a,o]=t.getVertex2d(0),s=this._viewportCoords.basicToCanvasSafe(a,o,r,this._transform,e);if(null!=s){const e={onclick:t.polygon.length>4?e=>{e.stopPropagation(),t.removeVertex2d(t.polygon.length-2),this._created$.next(this)}:n,style:{transform:this._canvasToTransform(s)}},r=t.polygon.length>4?"mapillary-tag-completer":"mapillary-tag-interactor";i.push(Sm.h("div."+r,e,[]))}if(t.polygon.length>3){const[n,a]=t.getVertex2d(t.polygon.length-3),o=this._viewportCoords.basicToCanvasSafe(n,a,r,this._transform,e);if(null!=o){const e={onclick:e=>{e.stopPropagation(),t.removeVertex2d(t.polygon.length-3)},style:{transform:this._canvasToTransform(o)}};i.push(Sm.h("div.mapillary-tag-interactor",e,[]))}}const l=t.polygon.slice();l.splice(-2,2);for(const n of l){const t=this._viewportCoords.basicToCanvasSafe(n[0],n[1],r,this._transform,e);if(null!=t){const e={style:{background:this._colorToBackground(this._options.color),transform:this._canvasToTransform(t)}};i.push(Sm.h("div.mapillary-tag-vertex",e,[]))}}}return i}addPoint(e){if(this._geometry instanceof zy){if(!this._geometry.validate(e))return;this._created$.next(this)}else if(this._geometry instanceof ky){this._geometry.addVertex2d(e)}}_onGeometryChanged(){this._disposeLine(this._outline),this._disposeObjects(),this._createGlObjects()}_disposeObjects(){this._outline=null,this._glObjects=[]}_createGlObjects(){const e=this._geometry instanceof zy?this._geometry.getPoints3d(this._transform):this._geometry.getVertices3d(this._transform);this._outline=this._createOutine(e,this._options.color),this._glObjects=[this._outline]}}class Dy{constructor(e,t){this._component=e,this._navigator=t,this._tagOperation$=new he,this._createPoints$=new he,this._createPolygon$=new he,this._createRect$=new he,this._delete$=new he,this._tag$=this._tagOperation$.pipe(ei(((e,t)=>t(e)),null),ti()),this._replayedTag$=this._tag$.pipe(Jt(1),le()),this._replayedTag$.subscribe(),this._createPoints$.pipe(ui(this._component.configuration$,this._navigator.stateService.currentTransform$),tt((([e,t,i])=>()=>{const r=new l_([[e[0],e[1]],[e[0],e[1]]]);return new Ry(r,{color:t.createColor,indicateCompleter:t.indicatePointsCompleter},i)}))).subscribe(this._tagOperation$),this._createRect$.pipe(ui(this._component.configuration$,this._navigator.stateService.currentTransform$),tt((([e,t,i])=>()=>{const r=new zy([e[0],e[1],e[0],e[1]]);return new Ly(r,{color:t.createColor},i)}))).subscribe(this._tagOperation$),this._createPolygon$.pipe(ui(this._component.configuration$,this._navigator.stateService.currentTransform$),tt((([e,t,i])=>()=>{const r=new ky([[e[0],e[1]],[e[0],e[1]],[e[0],e[1]]]);return new Ly(r,{color:t.createColor},i)}))).subscribe(this._tagOperation$),this._delete$.pipe(tt((()=>()=>null))).subscribe(this._tagOperation$)}get createRect$(){return this._createRect$}get createPolygon$(){return this._createPolygon$}get createPoints$(){return this._createPoints$}get delete$(){return this._delete$}get tag$(){return this._tag$}get replayedTag$(){return this._replayedTag$}}class By{render(e,t,i,r,n){let a=[];for(const o of e)a=a.concat(o.getDOMObjects(i,r,n));return null!=t&&(a=a.concat(t.getDOMObjects(r,n))),Sm.h("div.mapillary-tag-container",{},a)}clear(){return Sm.h("div",{},[])}}class Fy{constructor(e,t){this._createTag=null,this._needsRender=!1,this._raycaster=t||new Eh,this._scene=e||new zl,this._objectTags={},this._retrievableObjects=[],this._tags={}}get needsRender(){return this._needsRender}add(e){for(let t of e)t.tag.id in this._tags&&this._remove(t.tag.id),this._add(t);this._needsRender=!0}addCreateTag(e){for(const t of e.glObjects)this._scene.add(t);this._createTag={tag:e,objects:e.glObjects},this._needsRender=!0}clear(){for(const e of Object.keys(this._tags))this._remove(e);this._needsRender=!1}get(e){return this.has(e)?this._tags[e].tag:void 0}has(e){return e in this._tags}hasCreateTag(){return null!=this._createTag}intersectObjects([e,t],i){this._raycaster.setFromCamera(new or(e,t),i);const r=this._raycaster.intersectObjects(this._retrievableObjects),n=[];for(const a of r)a.object.uuid in this._objectTags&&n.push(this._objectTags[a.object.uuid]);return n}remove(e){for(const t of e)this._remove(t);this._needsRender=!0}removeAll(){for(const e of Object.keys(this._tags))this._remove(e);this._needsRender=!0}removeCreateTag(){if(null!=this._createTag){for(const e of this._createTag.objects)this._scene.remove(e);this._createTag.tag.dispose(),this._createTag=null,this._needsRender=!0}}render(e,t){t.render(this._scene,e),this._needsRender=!1}update(){this._needsRender=!0}updateCreateTagObjects(e){if(this._createTag.tag!==e)throw new Error("Create tags do not have the same reference.");for(let t of this._createTag.objects)this._scene.remove(t);for(const t of e.glObjects)this._scene.add(t);this._createTag.objects=e.glObjects,this._needsRender=!0}updateObjects(e){const t=e.tag.id;if(this._tags[t].tag!==e)throw new Error("Tags do not have the same reference.");const i=this._tags[t];this._removeObjects(i),delete this._tags[t],this._add(e),this._needsRender=!0}_add(e){const t=e.tag.id,i={tag:e,objects:[],retrievableObjects:[]};this._tags[t]=i;for(const r of e.getGLObjects())i.objects.push(r),this._scene.add(r);for(const r of e.getRetrievableObjects())i.retrievableObjects.push(r),this._retrievableObjects.push(r),this._objectTags[r.uuid]=e.tag.id}_remove(e){const t=this._tags[e];this._removeObjects(t),t.tag.dispose(),delete this._tags[e]}_removeObjects(e){for(const t of e.objects)this._scene.remove(t);for(const t of e.retrievableObjects){const e=this._retrievableObjects.indexOf(t);-1!==e&&this._retrievableObjects.splice(e,1)}}}var Oy,Ny,Vy,Uy;!function(e){e[e.Default=0]="Default",e[e.CreatePoint=1]="CreatePoint",e[e.CreatePoints=2]="CreatePoints",e[e.CreatePolygon=3]="CreatePolygon",e[e.CreateRect=4]="CreateRect",e[e.CreateRectDrag=5]="CreateRectDrag"}(Oy||(Oy={})),function(e){e[e.None=0]="None",e[e.Centroid=1]="Centroid",e[e.Vertex=2]="Vertex"}(Ny||(Ny={}));class $y{constructor(e,t,i){this._tag=e,this._transform=t,this._viewportCoords=i||new Im,this._glObjectsChanged$=new he,this._interact$=new he}get glObjectsChanged$(){return this._glObjectsChanged$}get interact$(){return this._interact$}get tag(){return this._tag}}class jy extends $y{constructor(e,t){super(e,t),this._geometryChangedSubscription=this._tag.geometry.changed$.subscribe((()=>{this._onGeometryChanged()})),this._changedSubscription=this._tag.changed$.subscribe((()=>{this._onTagChanged()&&this._glObjectsChanged$.next(this)}))}dispose(){this._changedSubscription.unsubscribe(),this._geometryChangedSubscription.unsubscribe()}_colorToCss(e){return"#"+("000000"+e.toString(16)).substr(-6)}_createFill(){let e=this._getTriangles(),t=new Float32Array(e),i=new na;i.setAttribute("position",new Wn(t,3)),i.computeBoundingSphere();let r=new qn({side:2,transparent:!0});return this._updateFillMaterial(r),new wa(i,r)}_createLine(e){let t=this._getLinePositions(e),i=new na;i.setAttribute("position",new Wn(t,3)),i.computeBoundingSphere();let r=new lc;this._updateLineBasicMaterial(r);const n=new fc(i,r);return n.renderOrder=1,n}_createOutline(){return this._createLine(this._getPoints3d())}_disposeFill(){null!=this._fill&&(this._fill.geometry.dispose(),this._fill.material.dispose(),this._fill=null)}_disposeOutline(){null!=this._outline&&(this._outline.geometry.dispose(),this._outline.material.dispose(),this._outline=null)}_getLinePositions(e){let t=e.length,i=new Float32Array(3*t);for(let r=0;r<t;++r){let t=3*r,n=e[r];i[t+0]=n[0],i[t+1]=n[1],i[t+2]=n[2]}return i}_interact(e,t,i){return r=>{let n=r.offsetX-r.target.offsetWidth/2,a=r.offsetY-r.target.offsetHeight/2;this._interact$.next({cursor:t,offsetX:n,offsetY:a,operation:e,tag:this._tag,vertexIndex:i})}}_updateFillGeometry(){let e=this._getTriangles(),t=new Float32Array(e),i=this._fill.geometry,r=i.getAttribute("position");r.array.length===t.length?(r.set(t),r.needsUpdate=!0):(i.deleteAttribute("position"),i.setAttribute("position",new Wn(t,3))),i.computeBoundingSphere()}_updateLine(e,t){let i=this._getLinePositions(t),r=e.geometry,n=r.getAttribute("position");n.set(i),n.needsUpdate=!0,r.computeBoundingSphere()}_updateOulineGeometry(){this._updateLine(this._outline,this._getPoints3d())}}class qy extends jy{constructor(e,t){super(e,t),this._rectGeometry=new zy(this._tag.geometry.getRect2d(t)),this._fill=Qh(t.cameraType)?null:this._createFill(),this._outline=this._tag.lineWidth>=1?this._createOutline():null}dispose(){super.dispose(),this._disposeFill(),this._disposeOutline()}getDOMObjects(e,t,i){const r=[],n={offsetHeight:i.height,offsetWidth:i.width};if(!this._tag.editable)return r;const a=this._colorToCss(this._tag.lineColor),o=this._tag.geometry.getPoints2d();for(let s=0;s<o.length;s++){const[e,i]=o[s],l=this._viewportCoords.basicToCanvasSafe(e,i,n,this._transform,t);if(null==l)continue;const c="crosshair",u=this._interact(Ny.Vertex,c,s),h=`translate(-50%, -50%) translate(${Math.round(l[0])}px,${Math.round(l[1])}px)`,p={onpointerdown:u,style:{background:a,transform:h,cursor:c}};if(r.push(Sm.h("div.mapillary-tag-resizer",p,[])),!this._tag.indicateVertices)continue;const d={style:{background:a,transform:h}};r.push(Sm.h("div.mapillary-tag-vertex",d,[]))}return r}getGLObjects(){const e=[];return null!=this._fill&&e.push(this._fill),null!=this._outline&&e.push(this._outline),e}getRetrievableObjects(){return null!=this._fill?[this._fill]:[]}_onGeometryChanged(){this._rectGeometry=new zy(this._tag.geometry.getRect2d(this._transform)),null!=this._fill&&this._updateFillGeometry(),null!=this._outline&&this._updateOulineGeometry()}_onTagChanged(){let e=!1;return null!=this._fill&&this._updateFillMaterial(this._fill.material),null==this._outline?this._tag.lineWidth>=1&&(this._outline=this._createOutline(),e=!0):this._updateOutlineMaterial(),e}_getPoints3d(){return this._rectGeometry.getPoints3d(this._transform)}_getTriangles(){return this._rectGeometry.getTriangles3d(this._transform)}_updateFillMaterial(e){e.color=new jn(this._tag.fillColor),e.opacity=this._tag.fillOpacity,e.needsUpdate=!0}_updateLineBasicMaterial(e){e.color=new jn(this._tag.lineColor),e.linewidth=Math.max(this._tag.lineWidth,1),e.visible=this._tag.lineWidth>=1&&this._tag.lineOpacity>0,e.opacity=this._tag.lineOpacity,e.transparent=this._tag.lineOpacity<1,e.needsUpdate=!0}_updateOutlineMaterial(){let e=this._outline.material;this._updateLineBasicMaterial(e)}}class Gy extends Mm{constructor(e,t){super(),this._id=e,this._geometry=t,this._notifyChanged$=new he,this._notifyChanged$.subscribe((e=>{const t={target:this,type:"tag"};this.fire("tag",t)})),this._geometry.changed$.subscribe((e=>{const t="geometry",i={target:this,type:t};this.fire(t,i)}))}get id(){return this._id}get geometry(){return this._geometry}get changed$(){return this._notifyChanged$}get geometryChanged$(){return this._geometry.changed$.pipe(tt((()=>this)),ti())}fire(e,t){super.fire(e,t)}off(e,t){super.off(e,t)}on(e,t){super.on(e,t)}}class Hy extends Gy{constructor(e,t,i){super(e,t),i=i||{},this._editable=null!=i.editable&&i.editable,this._fillColor=null==i.fillColor?16777215:i.fillColor,this._fillOpacity=null==i.fillOpacity?0:i.fillOpacity,this._indicateVertices=null==i.indicateVertices||i.indicateVertices,this._lineColor=null==i.lineColor?16777215:i.lineColor,this._lineOpacity=null==i.lineOpacity?1:i.lineOpacity,this._lineWidth=null==i.lineWidth?1:i.lineWidth}get editable(){return this._editable}set editable(e){this._editable=e,this._notifyChanged$.next(this)}get fillColor(){return this._fillColor}set fillColor(e){this._fillColor=e,this._notifyChanged$.next(this)}get fillOpacity(){return this._fillOpacity}set fillOpacity(e){this._fillOpacity=e,this._notifyChanged$.next(this)}get geometry(){return this._geometry}get indicateVertices(){return this._indicateVertices}set indicateVertices(e){this._indicateVertices=e,this._notifyChanged$.next(this)}get lineColor(){return this._lineColor}set lineColor(e){this._lineColor=e,this._notifyChanged$.next(this)}get lineOpacity(){return this._lineOpacity}set lineOpacity(e){this._lineOpacity=e,this._notifyChanged$.next(this)}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth=e,this._notifyChanged$.next(this)}setOptions(e){this._editable=null==e.editable?this._editable:e.editable,this._indicateVertices=null==e.indicateVertices?this._indicateVertices:e.indicateVertices,this._lineColor=null==e.lineColor?this._lineColor:e.lineColor,this._lineWidth=null==e.lineWidth?this._lineWidth:e.lineWidth,this._fillColor=null==e.fillColor?this._fillColor:e.fillColor,this._fillOpacity=null==e.fillOpacity?this._fillOpacity:e.fillOpacity,this._notifyChanged$.next(this)}}!function(e){e[e.TwoDimensional=0]="TwoDimensional",e[e.ThreeDimensional=1]="ThreeDimensional"}(Vy||(Vy={}));class Wy extends jy{constructor(e,t){super(e,t),this._fill=Qh(t.cameraType)?e.domain===Vy.TwoDimensional&&e.geometry instanceof ky?this._createFill():null:this._createFill(),this._holes=this._tag.lineWidth>=1?this._createHoles():[],this._outline=this._tag.lineWidth>=1?this._createOutline():null}dispose(){super.dispose(),this._disposeFill(),this._disposeHoles(),this._disposeOutline()}getDOMObjects(e,t,i){const r=[],n=this._tag.geometry instanceof zy,a=!Qh(this._transform.cameraType),o={offsetHeight:i.height,offsetWidth:i.width};if(null!=this._tag.icon&&(n||a)){const[i,n]=this._tag.geometry instanceof zy?this._tag.geometry.getVertex2d(this._tag.iconIndex):this._tag.geometry.getPoleOfInaccessibility2d(),a=this._viewportCoords.basicToCanvasSafe(i,n,o,this._transform,t);if(null!=a){const t=()=>{this._interact$.next({offsetX:0,offsetY:0,operation:Ny.None,tag:this._tag})};if(e.loaded){const i=e.getDOMSprite(this._tag.icon,this._tag.iconFloat),n={onclick:e=>{e.stopPropagation(),this._tag.click$.next(this._tag)},onpointerdown:t,style:{transform:`translate(${Math.round(a[0])}px,${Math.round(a[1])}px)`}};r.push(Sm.h("div.mapillary-tag-symbol",n,[i]))}}}else if(null!=this._tag.text&&(n||a)){const[e,i]=this._tag.geometry instanceof zy?this._tag.geometry.getVertex2d(3):this._tag.geometry.getPoleOfInaccessibility2d(),n=this._viewportCoords.basicToCanvasSafe(e,i,o,this._transform,t);if(null!=n){const e=Math.round(n[0]),t=Math.round(n[1]),i=this._tag.geometry instanceof zy?`translate(${e}px,${t}px)`:`translate(-50%, -50%) translate(${e}px,${t}px)`,a={onpointerdown:()=>{this._interact$.next({offsetX:0,offsetY:0,operation:Ny.None,tag:this._tag})},style:{color:this._colorToCss(this._tag.textColor),transform:i},textContent:this._tag.text};r.push(Sm.h("span.mapillary-tag-symbol",a,[]))}}if(!this._tag.editable)return r;const s=this._colorToCss(this._tag.lineColor);if(this._tag.geometry instanceof zy){const[e,i]=this._tag.geometry.getCentroid2d(),n=this._viewportCoords.basicToCanvasSafe(e,i,o,this._transform,t);if(null!=n){const e={onpointerdown:this._interact(Ny.Centroid,"move"),style:{background:s,transform:`translate(-50%, -50%) translate(${Math.round(n[0])}px,${Math.round(n[1])}px)`}};r.push(Sm.h("div.mapillary-tag-mover",e,[]))}}const l=this._tag.geometry.getVertices2d();for(let c=0;c<l.length-1;c++){if(n&&(null!=this._tag.icon&&c===this._tag.iconIndex||null==this._tag.icon&&null!=this._tag.text&&3===c))continue;const[e,i]=l[c],a=this._viewportCoords.basicToCanvasSafe(e,i,o,this._transform,t);if(null==a)continue;const u=n?c%2===0?"nesw-resize":"nwse-resize":"crosshair",h=this._interact(Ny.Vertex,u,c),p=`translate(-50%, -50%) translate(${Math.round(a[0])}px,${Math.round(a[1])}px)`,d={onpointerdown:h,style:{background:s,transform:p,cursor:u}};if(r.push(Sm.h("div.mapillary-tag-resizer",d,[])),!this._tag.indicateVertices)continue;const f={style:{background:s,transform:p}};r.push(Sm.h("div.mapillary-tag-vertex",f,[]))}return r}getGLObjects(){const e=[];null!=this._fill&&e.push(this._fill);for(const t of this._holes)e.push(t);return null!=this._outline&&e.push(this._outline),e}getRetrievableObjects(){return null!=this._fill?[this._fill]:[]}_onGeometryChanged(){null!=this._fill&&this._updateFillGeometry(),this._holes.length>0&&this._updateHoleGeometries(),null!=this._outline&&this._updateOulineGeometry()}_onTagChanged(){let e=!1;return null!=this._fill&&this._updateFillMaterial(this._fill.material),null==this._outline?this._tag.lineWidth>=1&&(this._holes=this._createHoles(),this._outline=this._createOutline(),e=!0):(this._updateHoleMaterials(),this._updateOutlineMaterial()),e}_getPoints3d(){return this._in3dDomain()?this._tag.geometry.getVertices3d(this._transform):this._tag.geometry.getPoints3d(this._transform)}_getTriangles(){return this._in3dDomain()?this._tag.geometry.get3dDomainTriangles3d(this._transform):this._tag.geometry.getTriangles3d(this._transform)}_updateFillMaterial(e){e.color=new jn(this._tag.fillColor),e.opacity=this._tag.fillOpacity,e.needsUpdate=!0}_updateLineBasicMaterial(e){e.color=new jn(this._tag.lineColor),e.linewidth=Math.max(this._tag.lineWidth,1),e.visible=this._tag.lineWidth>=1&&this._tag.lineOpacity>0,e.opacity=this._tag.lineOpacity,e.transparent=this._tag.lineOpacity<1,e.needsUpdate=!0}_createHoles(){let e=[];if(this._tag.geometry instanceof ky){let t=this._getHoles3d();for(let i of t){let t=this._createLine(i);e.push(t)}}return e}_disposeHoles(){for(let e of this._holes)e.geometry.dispose(),e.material.dispose();this._holes=[]}_getHoles3d(){const e=this._tag.geometry;return this._in3dDomain()?e.getHoleVertices3d(this._transform):e.getHolePoints3d(this._transform)}_in3dDomain(){return this._tag.geometry instanceof ky&&this._tag.domain===Vy.ThreeDimensional}_updateHoleGeometries(){let e=this._getHoles3d();if(e.length!==this._holes.length)throw new Error("Changing the number of holes is not supported.");for(let t=0;t<this._holes.length;t++){let i=e[t],r=this._holes[t];this._updateLine(r,i)}}_updateHoleMaterials(){for(const e of this._holes)this._updateLineBasicMaterial(e.material)}_updateOutlineMaterial(){this._updateLineBasicMaterial(this._outline.material)}}!function(e){e[e.Bottom=0]="Bottom",e[e.BottomLeft=1]="BottomLeft",e[e.BottomRight=2]="BottomRight",e[e.Center=3]="Center",e[e.Left=4]="Left",e[e.Right=5]="Right",e[e.Top=6]="Top",e[e.TopLeft=7]="TopLeft",e[e.TopRight=8]="TopRight"}(Uy||(Uy={}));class Zy extends Gy{constructor(e,t,i){super(e,t);const r=null!=(i=i||{}).domain&&t instanceof ky?i.domain:Vy.TwoDimensional,n=this._twoDimensionalPolygon(r,t);this._domain=r,this._editable=null!=i.editable&&!n&&i.editable,this._fillColor=null==i.fillColor?16777215:i.fillColor,this._fillOpacity=null==i.fillOpacity?0:i.fillOpacity,this._icon=void 0===i.icon?null:i.icon,this._iconFloat=null==i.iconFloat?Uy.Center:i.iconFloat,this._iconIndex=null==i.iconIndex?3:i.iconIndex,this._indicateVertices=null==i.indicateVertices||i.indicateVertices,this._lineColor=null==i.lineColor?16777215:i.lineColor,this._lineOpacity=null==i.lineOpacity?1:i.lineOpacity,this._lineWidth=null==i.lineWidth?1:i.lineWidth,this._text=void 0===i.text?null:i.text,this._textColor=null==i.textColor?16777215:i.textColor,this._click$=new he,this._click$.subscribe((()=>{const e="click",t={target:this,type:e};this.fire(e,t)}))}get click$(){return this._click$}get domain(){return this._domain}get editable(){return this._editable}set editable(e){this._twoDimensionalPolygon(this._domain,this._geometry)||(this._editable=e,this._notifyChanged$.next(this))}get fillColor(){return this._fillColor}set fillColor(e){this._fillColor=e,this._notifyChanged$.next(this)}get fillOpacity(){return this._fillOpacity}set fillOpacity(e){this._fillOpacity=e,this._notifyChanged$.next(this)}get geometry(){return this._geometry}get icon(){return this._icon}set icon(e){this._icon=e,this._notifyChanged$.next(this)}get iconFloat(){return this._iconFloat}set iconFloat(e){this._iconFloat=e,this._notifyChanged$.next(this)}get iconIndex(){return this._iconIndex}set iconIndex(e){this._iconIndex=e,this._notifyChanged$.next(this)}get indicateVertices(){return this._indicateVertices}set indicateVertices(e){this._indicateVertices=e,this._notifyChanged$.next(this)}get lineColor(){return this._lineColor}set lineColor(e){this._lineColor=e,this._notifyChanged$.next(this)}get lineOpacity(){return this._lineOpacity}set lineOpacity(e){this._lineOpacity=e,this._notifyChanged$.next(this)}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth=e,this._notifyChanged$.next(this)}get text(){return this._text}set text(e){this._text=e,this._notifyChanged$.next(this)}get textColor(){return this._textColor}set textColor(e){this._textColor=e,this._notifyChanged$.next(this)}fire(e,t){super.fire(e,t)}off(e,t){super.off(e,t)}on(e,t){super.on(e,t)}setOptions(e){const t=this._twoDimensionalPolygon(this._domain,this._geometry);this._editable=t||null==e.editable?this._editable:e.editable,this._icon=void 0===e.icon?this._icon:e.icon,this._iconFloat=null==e.iconFloat?this._iconFloat:e.iconFloat,this._iconIndex=null==e.iconIndex?this._iconIndex:e.iconIndex,this._indicateVertices=null==e.indicateVertices?this._indicateVertices:e.indicateVertices,this._lineColor=null==e.lineColor?this._lineColor:e.lineColor,this._lineWidth=null==e.lineWidth?this._lineWidth:e.lineWidth,this._fillColor=null==e.fillColor?this._fillColor:e.fillColor,this._fillOpacity=null==e.fillOpacity?this._fillOpacity:e.fillOpacity,this._text=void 0===e.text?this._text:e.text,this._textColor=null==e.textColor?this._textColor:e.textColor,this._notifyChanged$.next(this)}_twoDimensionalPolygon(e,t){return e!==Vy.ThreeDimensional&&t instanceof ky}}class Xy extends $y{dispose(){}getDOMObjects(e,t,i){const r=this._tag,n={offsetHeight:i.height,offsetWidth:i.width},a=[],[o,s]=r.geometry.getCentroid2d(),l=this._viewportCoords.basicToCanvasSafe(o,s,n,this._transform,t);if(null!=l){const t=e=>{this._interact$.next({offsetX:0,offsetY:0,operation:Ny.None,tag:r})},i=Math.round(l[0]),n=Math.round(l[1]);if(null!=r.icon){if(e.loaded){const o=e.getDOMSprite(r.icon,Uy.Bottom),s={onpointerdown:t,style:{pointerEvents:"all",transform:`translate(${i}px,${n+8}px)`}};a.push(Sm.h("div",s,[o]))}}else if(null!=r.text){const e=`translate(-50%,0%) translate(${i}px,${n+8}px)`,o={onpointerdown:t,style:{color:this._colorToCss(r.textColor),transform:e},textContent:r.text};a.push(Sm.h("span.mapillary-tag-symbol",o,[]))}const o=this._interact(Ny.Centroid,r,"move"),s=this._colorToCss(r.color),c=`translate(-50%,-50%) translate(${i}px,${n}px)`;if(r.editable){let e={onpointerdown:o,style:{background:s,transform:c}};a.push(Sm.h("div.mapillary-tag-spot-interactor",e,[]))}const u={style:{background:s,transform:c}};a.push(Sm.h("div.mapillary-tag-vertex",u,[]))}return a}getGLObjects(){return[]}getRetrievableObjects(){return[]}_colorToCss(e){return"#"+("000000"+e.toString(16)).substr(-6)}_interact(e,t,i,r){return n=>{const a=n.offsetX-n.target.offsetWidth/2,o=n.offsetY-n.target.offsetHeight/2;this._interact$.next({cursor:i,offsetX:a,offsetY:o,operation:e,tag:t,vertexIndex:r})}}}class Yy extends Gy{constructor(e,t,i){super(e,t),i=i||{},this._color=null==i.color?16777215:i.color,this._editable=null!=i.editable&&i.editable,this._icon=void 0===i.icon?null:i.icon,this._text=void 0===i.text?null:i.text,this._textColor=null==i.textColor?16777215:i.textColor}get color(){return this._color}set color(e){this._color=e,this._notifyChanged$.next(this)}get editable(){return this._editable}set editable(e){this._editable=e,this._notifyChanged$.next(this)}get icon(){return this._icon}set icon(e){this._icon=e,this._notifyChanged$.next(this)}get text(){return this._text}set text(e){this._text=e,this._notifyChanged$.next(this)}get textColor(){return this._textColor}set textColor(e){this._textColor=e,this._notifyChanged$.next(this)}setOptions(e){this._color=null==e.color?this._color:e.color,this._editable=null==e.editable?this._editable:e.editable,this._icon=void 0===e.icon?this._icon:e.icon,this._text=void 0===e.text?this._text:e.text,this._textColor=null==e.textColor?this._textColor:e.textColor,this._notifyChanged$.next(this)}}class Ky{constructor(){this._active=!1,this._hash={},this._hashDeactivated={},this._notifyChanged$=new he}get active(){return this._active}get changed$(){return this._notifyChanged$}activate(e){if(!this._active){for(const t in this._hashDeactivated){if(!this._hashDeactivated.hasOwnProperty(t))continue;const i=this._hashDeactivated[t];this._add(i,e)}this._hashDeactivated={},this._active=!0,this._notifyChanged$.next(this)}}deactivate(){if(this._active){for(const e in this._hash)this._hash.hasOwnProperty(e)&&(this._hashDeactivated[e]=this._hash[e].tag);this._hash={},this._active=!1}}add(e,t){this._assertActivationState(!0);for(const i of e)this._add(i,t);this._notifyChanged$.next(this)}addDeactivated(e){this._assertActivationState(!1);for(const t of e){if(!(t instanceof Zy||t instanceof Yy||t instanceof Hy))throw new Error("Tag type not supported");this._hashDeactivated[t.id]=t}}get(e){return this.has(e)?this._hash[e]:void 0}getAll(){const e=this._hash;return Object.keys(e).map((t=>e[t]))}getAllDeactivated(){const e=this._hashDeactivated;return Object.keys(e).map((t=>e[t]))}getDeactivated(e){return this.hasDeactivated(e)?this._hashDeactivated[e]:void 0}has(e){return e in this._hash}hasDeactivated(e){return e in this._hashDeactivated}remove(e){this._assertActivationState(!0);const t=this._hash;for(const i of e)i in t&&delete t[i];this._notifyChanged$.next(this)}removeAll(){this._assertActivationState(!0),this._hash={},this._notifyChanged$.next(this)}removeAllDeactivated(){this._assertActivationState(!1),this._hashDeactivated={}}removeDeactivated(e){this._assertActivationState(!1);const t=this._hashDeactivated;for(const i of e)i in t&&delete t[i]}_add(e,t){if(e instanceof Zy)this._hash[e.id]=new Wy(e,t);else if(e instanceof Yy)this._hash[e.id]=new Xy(e,t);else{if(!(e instanceof Hy))throw new Error("Tag type not supported");this._hash[e.id]=new qy(e,t)}}_assertActivationState(e){if(e!==this._active)throw new Error("Tag set not in correct state for operation.")}}class Jy extends o_{constructor(e){super();let t=e[0],i=e[1];if(t<0||t>1||i<0||i>1)throw new s_("Basic coordinates must be on the interval [0, 1].");this._point=e.slice()}get point(){return this._point}getCentroid2d(){return this._point.slice()}getCentroid3d(e){return e.unprojectBasic(this._point,200)}setCentroid2d(e,t){let i=[Math.max(0,Math.min(1,e[0])),Math.max(0,Math.min(1,e[1]))];this._point[0]=i[0],this._point[1]=i[1],this._notifyChanged$.next(this)}}class Qy extends ag{constructor(e,t,i,r){super(e,t,i),this._name=`${this._component.name}-${this._getNameExtension()}`,this._viewportCoords=r}_getConfiguration(e){return{}}_mouseEventToBasic(e,t,i,r,n,a){n=null!=n?n:0,a=null!=a?a:0;const[o,s]=this._viewportCoords.canvasPosition(e,t);return this._viewportCoords.canvasToBasic(o-n,s-a,t,r,i.perspective)}}class ev extends Qy{constructor(e,t,i,r,n){super(e,t,i,r),this._tagCreator=n,this._geometryCreated$=new he}get geometryCreated$(){return this._geometryCreated$}_enable(){this._enableCreate(),this._container.container.classList.add("component-tag-create")}_disable(){this._container.container.classList.remove("component-tag-create"),this._disableCreate()}_validateBasic(e){const t=e[0],i=e[1];return 0<=t&&t<=1&&0<=i&&i<=1}_mouseEventToBasic$(e){return e.pipe(ui(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$),tt((([e,t,i])=>this._mouseEventToBasic(e,this._container.container,t,i))))}}class tv extends ev{_enableCreate(){this._container.mouseService.deferPixels(this._name,4),this._geometryCreatedSubscription=this._mouseEventToBasic$(this._container.mouseService.proximateClick$).pipe(Ct(this._validateBasic),tt((e=>new Jy(e)))).subscribe(this._geometryCreated$)}_disableCreate(){this._container.mouseService.undeferPixels(this._name),this._geometryCreatedSubscription.unsubscribe()}_getNameExtension(){return"create-point"}}class iv extends ev{_enableCreate(){this._container.mouseService.deferPixels(this._name,4);const e=this._navigator.stateService.currentTransform$.pipe(tt((()=>{})),Jt(1),le());this._deleteSubscription=e.pipe(ri(1)).subscribe(this._tagCreator.delete$);const t=this._mouseEventToBasic$(this._container.mouseService.proximateClick$).pipe(ti());this._createSubscription=e.pipe(oi((()=>t.pipe(Ct(this._validateBasic),Nt(1))))).subscribe(this._create$),this._setVertexSubscription=this._tagCreator.tag$.pipe(oi((e=>e?ut(Ze(e),Mt(this._container.mouseService.mouseMove$,this._container.mouseService.domMouseMove$),this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$):Me()))).subscribe((([e,t,i,r])=>{const n=this._mouseEventToBasic(t,this._container.container,i,r);this._setVertex2d(e,n,r)})),this._addPointSubscription=this._tagCreator.tag$.pipe(oi((e=>e?ut(Ze(e),t):Me()))).subscribe((([e,t])=>{this._addPoint(e,t)})),this._geometryCreateSubscription=this._tagCreator.tag$.pipe(oi((e=>e?e.created$.pipe(tt((e=>e.geometry))):Me()))).subscribe(this._geometryCreated$)}_disableCreate(){this._container.mouseService.undeferPixels(this._name),this._tagCreator.delete$.next(null),this._addPointSubscription.unsubscribe(),this._createSubscription.unsubscribe(),this._deleteSubscription.unsubscribe(),this._geometryCreateSubscription.unsubscribe(),this._setVertexSubscription.unsubscribe()}}class rv extends iv{get _create$(){return this._tagCreator.createPoints$}_addPoint(e,t){e.geometry.addPoint2d(t)}_getNameExtension(){return"create-points"}_setVertex2d(e,t,i){e.geometry.setPoint2d(e.geometry.points.length-1,t,i)}}class nv extends iv{get _create$(){return this._tagCreator.createPolygon$}_addPoint(e,t){e.addPoint(t)}_getNameExtension(){return"create-polygon"}_setVertex2d(e,t,i){e.geometry.setVertex2d(e.geometry.polygon.length-2,t,i)}}class av extends iv{get _create$(){return this._tagCreator.createRect$}_addPoint(e,t){const i=e.geometry;i.validate(t)||(t=i.getNonAdjustedVertex2d(3)),e.addPoint(t)}_enable(){super._enable(),this._initializeAnchorIndexingSubscription=this._tagCreator.tag$.pipe(Ct((e=>!!e))).subscribe((e=>{e.geometry.initializeAnchorIndexing()}))}_disable(){super._disable(),this._initializeAnchorIndexingSubscription.unsubscribe()}_getNameExtension(){return"create-rect"}_setVertex2d(e,t,i){e.geometry.setOppositeVertex2d(t,i)}}class ov extends ev{_enableCreate(){this._container.mouseService.claimMouse(this._name,2),this._deleteSubscription=this._navigator.stateService.currentTransform$.pipe(tt((e=>null)),ri(1)).subscribe(this._tagCreator.delete$),this._createSubscription=this._mouseEventToBasic$(this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragStart$)).pipe(Ct(this._validateBasic)).subscribe(this._tagCreator.createRect$),this._initializeAnchorIndexingSubscription=this._tagCreator.tag$.pipe(Ct((e=>!!e))).subscribe((e=>{e.geometry.initializeAnchorIndexing()}));const e=ut(Mt(this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseMove$),this._container.mouseService.filtered$(this._name,this._container.mouseService.domMouseMove$)),this._container.renderService.renderCamera$).pipe(ui(this._navigator.stateService.currentTransform$),tt((([[e,t],i])=>this._mouseEventToBasic(e,this._container.container,t,i))));this._setVertexSubscription=this._tagCreator.tag$.pipe(oi((t=>t?ut(Ze(t),e,this._navigator.stateService.currentTransform$):Me()))).subscribe((([e,t,i])=>{e.geometry.setOppositeVertex2d(t,i)}));const t=this._container.mouseService.mouseDragEnd$.pipe(ui(this._mouseEventToBasic$(this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDrag$)).pipe(Ct(this._validateBasic)),((e,t)=>t)),ti());this._addPointSubscription=this._tagCreator.tag$.pipe(oi((e=>e?ut(Ze(e),t):Me()))).subscribe((([e,t])=>{const i=e.geometry;i.validate(t)||(t=i.getNonAdjustedVertex2d(3)),e.addPoint(t)})),this._geometryCreatedSubscription=this._tagCreator.tag$.pipe(oi((e=>e?e.created$.pipe(tt((e=>e.geometry))):Me()))).subscribe(this._geometryCreated$)}_disableCreate(){this._container.mouseService.unclaimMouse(this._name),this._tagCreator.delete$.next(null),this._addPointSubscription.unsubscribe(),this._createSubscription.unsubscribe(),this._deleteSubscription.unsubscribe(),this._geometryCreatedSubscription.unsubscribe(),this._initializeAnchorIndexingSubscription.unsubscribe(),this._setVertexSubscription.unsubscribe()}_getNameExtension(){return"create-rect-drag"}}class sv extends Qy{constructor(e,t,i,r,n){super(e,t,i,r),this._tagSet=n}_enable(){const e=this._tagSet.changed$.pipe(tt((e=>e.getAll())),oi((e=>Oe(e).pipe(ft((e=>e.interact$))))),oi((e=>_t(Ze(e),this._container.mouseService.documentMouseUp$.pipe(tt((()=>({offsetX:0,offsetY:0,operation:Ny.None,tag:null}))),Ht())))),ti());Mt(this._container.mouseService.mouseMove$,this._container.mouseService.domMouseMove$).pipe(ti()),this._claimMouseSubscription=e.pipe(oi((e=>e.tag?this._container.mouseService.domMouseDragStart$:Me()))).subscribe((()=>{this._container.mouseService.claimMouse(this._name,3)})),this._cursorSubscription=e.pipe(tt((e=>e.cursor)),Vt()).subscribe((e=>{const t=["crosshair","move","nesw-resize","nwse-resize"];for(const i of t)this._container.container.classList.remove(`component-tag-edit-${i}`);e&&this._container.container.classList.add(`component-tag-edit-${e}`)})),this._unclaimMouseSubscription=this._container.mouseService.filtered$(this._name,this._container.mouseService.domMouseDragEnd$).subscribe((e=>{this._container.mouseService.unclaimMouse(this._name)})),this._preventDefaultSubscription=e.pipe(oi((e=>e.tag?this._container.mouseService.documentMouseMove$:Me()))).subscribe((e=>{e.preventDefault()})),this._updateGeometrySubscription=e.pipe(oi((e=>{if(e.operation===Ny.None||!e.tag)return Me();return ut(this._container.mouseService.filtered$(this._name,this._container.mouseService.domMouseDrag$).pipe(Ct((e=>this._viewportCoords.insideElement(e,this._container.container)))),this._container.renderService.renderCamera$).pipe(ui(Ze(e),this._navigator.stateService.currentTransform$,(([e,t],i,r)=>[e,t,i,r])))}))).subscribe((([e,t,i,r])=>{const n=this._mouseEventToBasic(e,this._container.container,t,r,i.offsetX,i.offsetY),a=i.tag.geometry;i.operation===Ny.Centroid?a.setCentroid2d(n,r):i.operation===Ny.Vertex&&a.setVertex2d(i.vertexIndex,n,r)}))}_disable(){this._claimMouseSubscription.unsubscribe(),this._cursorSubscription.unsubscribe(),this._preventDefaultSubscription.unsubscribe(),this._unclaimMouseSubscription.unsubscribe(),this._updateGeometrySubscription.unsubscribe()}_getNameExtension(){return"edit-vertex"}}class lv extends Em{constructor(e,t,i){super(e,t,i),this._tagDomRenderer=new By,this._tagScene=new Fy,this._tagSet=new Ky,this._tagCreator=new Dy(this,i),this._viewportCoords=new Im,this._createHandlers={CreatePoint:new tv(this,t,i,this._viewportCoords,this._tagCreator),CreatePoints:new rv(this,t,i,this._viewportCoords,this._tagCreator),CreatePolygon:new nv(this,t,i,this._viewportCoords,this._tagCreator),CreateRect:new av(this,t,i,this._viewportCoords,this._tagCreator),CreateRectDrag:new ov(this,t,i,this._viewportCoords,this._tagCreator),Default:void 0},this._editVertexHandler=new sv(this,t,i,this._viewportCoords,this._tagSet),this._renderTags$=this._tagSet.changed$.pipe(tt((e=>{const t=e.getAll();return t.sort(((e,t)=>{const i=e.tag.id,r=t.tag.id;return i<r?-1:i>r?1:0})),t})),ti()),this._tagChanged$=this._renderTags$.pipe(oi((e=>Oe(e).pipe(ft((e=>Mt(e.tag.changed$,e.tag.geometryChanged$)))))),ti()),this._renderTagGLChanged$=this._renderTags$.pipe(oi((e=>Oe(e).pipe(ft((e=>e.glObjectsChanged$))))),ti()),this._createGeometryChanged$=this._tagCreator.tag$.pipe(oi((e=>null!=e?e.geometryChanged$:Me())),ti()),this._createGLObjectsChanged$=this._tagCreator.tag$.pipe(oi((e=>null!=e?e.glObjectsChanged$:Me())),ti()),this._creatingConfiguration$=this._configuration$.pipe(Vt(((e,t)=>e.mode===t.mode),(e=>({createColor:e.createColor,mode:e.mode}))),Jt(1),le()),this._creatingConfiguration$.subscribe((e=>{const t="tagmode",i={mode:e.mode,target:this,type:t};this.fire(t,i)}))}add(e){this._activated?this._navigator.stateService.currentTransform$.pipe(Ht()).subscribe((t=>{this._tagSet.add(e,t);const i=e.map((e=>this._tagSet.get(e.id)));this._tagScene.add(i)})):this._tagSet.addDeactivated(e)}calculateRect(e){return new Promise(((t,i)=>{this._navigator.stateService.currentTransform$.pipe(Ht(),tt((t=>e.getRect2d(t)))).subscribe((e=>{t(e)}),(e=>{i(e)}))}))}create(){this._tagCreator.replayedTag$.pipe(Ht(),Ct((e=>!!e))).subscribe((e=>{e.create()}))}changeMode(e){this.configure({mode:e})}fire(e,t){super.fire(e,t)}get(e){if(this._activated){const t=this._tagSet.get(e);return void 0!==t?t.tag:void 0}return this._tagSet.getDeactivated(e)}getAll(){return this.activated?this._tagSet.getAll().map((e=>e.tag)):this._tagSet.getAllDeactivated()}getTagIdsAt(e){return new Promise(((t,i)=>{this._container.renderService.renderCamera$.pipe(Ht(),tt((t=>{const i=this._viewportCoords.canvasToViewport(e[0],e[1],this._container.container);return this._tagScene.intersectObjects(i,t.perspective)}))).subscribe((e=>{t(e)}),(e=>{i(e)}))}))}has(e){return this._activated?this._tagSet.has(e):this._tagSet.hasDeactivated(e)}off(e,t){super.off(e,t)}on(e,t){super.on(e,t)}remove(e){this._activated?(this._tagSet.remove(e),this._tagScene.remove(e)):this._tagSet.removeDeactivated(e)}removeAll(){this._activated?(this._tagSet.removeAll(),this._tagScene.removeAll()):this._tagSet.removeAllDeactivated()}_activate(){this._editVertexHandler.enable();const e=Oe(Object.keys(this._createHandlers)).pipe(tt((e=>this._createHandlers[e])),Ct((e=>!!e)),ft((e=>e.geometryCreated$)),ti()),t=this._subscriptions;t.push(e.subscribe((e=>{const t="geometrycreate",i={geometry:e,target:this,type:t};this.fire(t,i)}))),t.push(this._tagCreator.tag$.pipe(ni((e=>null==e)),Vt()).subscribe((e=>{const t=null!=e?"tagcreatestart":"tagcreateend",i={target:this,type:t};this.fire(t,i)}))),t.push(e.subscribe((()=>{this.changeMode(Oy.Default)}))),t.push(this._creatingConfiguration$.subscribe((e=>{this._disableCreateHandlers();const t=Oy[e.mode],i=this._createHandlers[t];i&&i.enable()}))),t.push(this._renderTags$.subscribe((()=>{const e="tags",t={target:this,type:e};this.fire(e,t)}))),t.push(this._tagCreator.tag$.pipe(oi((e=>null!=e?e.aborted$.pipe(tt((()=>null))):Me()))).subscribe((()=>{this.changeMode(Oy.Default)}))),t.push(this._tagCreator.tag$.subscribe((e=>{this._tagScene.hasCreateTag()&&this._tagScene.removeCreateTag(),null!=e&&this._tagScene.addCreateTag(e)}))),t.push(this._createGLObjectsChanged$.subscribe((e=>{this._tagScene.updateCreateTagObjects(e)}))),t.push(this._renderTagGLChanged$.subscribe((e=>{this._tagScene.updateObjects(e)}))),t.push(this._tagChanged$.subscribe((()=>{this._tagScene.update()}))),t.push(ut(this._renderTags$.pipe(ai([]),ci((()=>{this._container.domRenderer.render$.next({name:this._name,vNode:this._tagDomRenderer.clear()})}))),this._container.renderService.renderCamera$,this._container.spriteService.spriteAtlas$,this._container.renderService.size$,this._tagChanged$.pipe(ai(null)),Mt(this._tagCreator.tag$,this._createGeometryChanged$).pipe(ai(null))).pipe(tt((([e,t,i,r,,n])=>({name:this._name,vNode:this._tagDomRenderer.render(e,n,i,t.perspective,r)})))).subscribe(this._container.domRenderer.render$)),t.push(this._navigator.stateService.currentState$.pipe(tt((e=>{const t=this._tagScene;return{name:this._name,renderer:{frameId:e.id,needsRender:t.needsRender,render:t.render.bind(t),pass:Vm.Opaque}}}))).subscribe(this._container.glRenderer.render$)),this._navigator.stateService.currentTransform$.pipe(Ht()).subscribe((e=>{this._tagSet.activate(e),this._tagScene.add(this._tagSet.getAll())}))}_deactivate(){this._editVertexHandler.disable(),this._disableCreateHandlers(),this._tagScene.clear(),this._tagSet.deactivate(),this._tagCreator.delete$.next(null),this._subscriptions.unsubscribe(),this._container.container.classList.remove("component-tag-create")}_getDefaultConfiguration(){return{createColor:16777215,indicatePointsCompleter:!0,mode:Oy.Default}}_disableCreateHandlers(){const e=this._createHandlers;for(const t in e){if(!e.hasOwnProperty(t))continue;const i=e[t];i&&i.disable()}}}lv.componentName="tag";class cv extends Em{constructor(e,t,i){super(e,t,i),this._viewportCoords=new Im,this._zoomDelta$=new he}_activate(){const e=this._subscriptions;e.push(ut(this._navigator.stateService.currentState$,this._navigator.stateService.state$,this._configuration$,this._container.renderService.size$).pipe(tt((([e,t,i,r])=>{const n=e.state.zoom,a=Sm.h("div.mapillary-zoom-in-icon",[]),o=n>=3||t===eg.Waiting?Sm.h("div.mapillary-zoom-in-button-inactive",[a]):Sm.h("div.mapillary-zoom-in-button",{onclick:()=>{this._zoomDelta$.next(1)}},[a]),s=Sm.h("div.mapillary-zoom-out-icon",[]),l=n<=0||t===eg.Waiting?Sm.h("div.mapillary-zoom-out-button-inactive",[s]):Sm.h("div.mapillary-zoom-out-button",{onclick:()=>{this._zoomDelta$.next(-1)}},[s]),c=i.size===wm.Small||i.size===wm.Automatic&&r.width<640?".mapillary-zoom-compact":"";return{name:this._name,vNode:Sm.h("div.mapillary-zoom-container"+c,{oncontextmenu:e=>{e.preventDefault()}},[o,l])}}))).subscribe(this._container.domRenderer.render$)),e.push(this._zoomDelta$.pipe(ui(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$)).subscribe((([e,t,i])=>{const r=this._viewportCoords.unprojectFromViewport(0,0,t.perspective),n=i.projectBasic(r.toArray());this._navigator.stateService.zoomIn(e,n)})))}_deactivate(){this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{size:wm.Automatic}}}cv.componentName="zoom";class uv extends Em{constructor(e,t,i,r){super(e,t,i),this._canvasId=`${t.id}-${this._name}`,this._dom=r||new Ag}_activate(){const e=this._container.domRenderer.element$.pipe(tt((()=>this._dom.document.getElementById(this._canvasId))),Ct((e=>!!e)),tt((e=>{const t=e.parentElement,i=t.offsetWidth;return[e,{height:t.offsetHeight,width:i}]})),Vt(((e,t)=>e.height===t.height&&e.width===t.width),(([,e])=>e)));this._subscriptions.push(ut(e,this._navigator.stateService.currentImage$).subscribe((([[e,t],i])=>{e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(i.image,0,0,t.width,t.height)}))),this._container.domRenderer.renderAdaptive$.next({name:this._name,vNode:Sm.h(`canvas#${this._canvasId}`,[])})}_deactivate(){this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{}}}uv.componentName="imagefallback";class hv extends Em{constructor(e,t,i){super(e,t,i),this._seqNames={},this._seqNames[Hh[Hh.Prev]]="-prev",this._seqNames[Hh[Hh.Next]]="-next",this._spaTopNames={},this._spaTopNames[Hh[Hh.TurnLeft]]="-turn-left",this._spaTopNames[Hh[Hh.StepLeft]]="-left",this._spaTopNames[Hh[Hh.StepForward]]="-forward",this._spaTopNames[Hh[Hh.StepRight]]="-right",this._spaTopNames[Hh[Hh.TurnRight]]="-turn-right",this._spaBottomNames={},this._spaBottomNames[Hh[Hh.TurnU]]="-turn-around",this._spaBottomNames[Hh[Hh.StepBackward]]="-backward"}_activate(){this._subscriptions.push(ut(this._navigator.stateService.currentImage$,this._configuration$).pipe(oi((([e,t])=>ut(t.sequence?e.sequenceEdges$.pipe(tt((e=>e.edges.map((e=>e.data.direction))))):Ze([]),!Qh(e.cameraType)&&t.spatial?e.spatialEdges$.pipe(tt((e=>e.edges.map((e=>e.data.direction))))):Ze([])).pipe(tt((([e,t])=>e.concat(t)))))),tt((e=>{const t=this._createArrowRow(this._seqNames,e),i=this._createArrowRow(this._spaTopNames,e),r=this._createArrowRow(this._spaBottomNames,e),n=Sm.h("div.mapillary-navigation-sequence",t),a=Sm.h("div.NavigationSpatialTop",i),o=Sm.h("div.mapillary-navigation-spatial-bottom",r),s=Sm.h("div.mapillary-navigation-spatial",[a,o]);return{name:this._name,vNode:Sm.h("div.NavigationContainer",[n,s])}}))).subscribe(this._container.domRenderer.render$))}_deactivate(){this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{sequence:!0,spatial:!0}}_createArrowRow(e,t){const i=[];for(const r in e){if(!e.hasOwnProperty(r))continue;const n=Hh[r];-1!==t.indexOf(n)?i.push(this._createVNode(n,e[r],"visible")):i.push(this._createVNode(n,e[r],"hidden"))}return i}_createVNode(e,t,i){return Sm.h(`span.mapillary-navigation-button.mapillary-navigation${t}`,{onclick:()=>{this._navigator.moveDir$(e).subscribe(void 0,(e=>{e instanceof Rm||console.error(e)}))},style:{visibility:i}},[])}}hv.componentName="navigationfallback";function pv(e){let t=e.length;for(;--t>=0;)e[t]=0}const dv=256,fv=286,mv=30,gv=15,_v=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),yv=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),vv=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),xv=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),bv=new Array(576);pv(bv);const wv=new Array(60);pv(wv);const Sv=new Array(512);pv(Sv);const Mv=new Array(256);pv(Mv);const Tv=new Array(29);pv(Tv);const Ev=new Array(mv);function Cv(e,t,i,r,n){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=r,this.max_length=n,this.has_stree=e&&e.length}let Av,Iv,Pv;function zv(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}pv(Ev);const Rv=e=>e<256?Sv[e]:Sv[256+(e>>>7)],kv=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Lv=(e,t,i)=>{e.bi_valid>16-i?(e.bi_buf|=t<<e.bi_valid&65535,kv(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)},Dv=(e,t,i)=>{Lv(e,i[2*t],i[2*t+1])},Bv=(e,t)=>{let i=0;do{i|=1&e,e>>>=1,i<<=1}while(--t>0);return i>>>1},Fv=(e,t,i)=>{const r=new Array(16);let n,a,o=0;for(n=1;n<=gv;n++)r[n]=o=o+i[n-1]<<1;for(a=0;a<=t;a++){let t=e[2*a+1];0!==t&&(e[2*a]=Bv(r[t]++,t))}},Ov=e=>{let t;for(t=0;t<fv;t++)e.dyn_ltree[2*t]=0;for(t=0;t<mv;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0},Nv=e=>{e.bi_valid>8?kv(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Vv=(e,t,i,r)=>{const n=2*t,a=2*i;return e[n]<e[a]||e[n]===e[a]&&r[t]<=r[i]},Uv=(e,t,i)=>{const r=e.heap[i];let n=i<<1;for(;n<=e.heap_len&&(n<e.heap_len&&Vv(t,e.heap[n+1],e.heap[n],e.depth)&&n++,!Vv(t,r,e.heap[n],e.depth));)e.heap[i]=e.heap[n],i=n,n<<=1;e.heap[i]=r},$v=(e,t,i)=>{let r,n,a,o,s=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],n=e.pending_buf[e.l_buf+s],s++,0===r?Dv(e,n,t):(a=Mv[n],Dv(e,a+dv+1,t),o=_v[a],0!==o&&(n-=Tv[a],Lv(e,n,o)),r--,a=Rv(r),Dv(e,a,i),o=yv[a],0!==o&&(r-=Ev[a],Lv(e,r,o)))}while(s<e.last_lit);Dv(e,256,t)},jv=(e,t)=>{const i=t.dyn_tree,r=t.stat_desc.static_tree,n=t.stat_desc.has_stree,a=t.stat_desc.elems;let o,s,l,c=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<a;o++)0!==i[2*o]?(e.heap[++e.heap_len]=c=o,e.depth[o]=0):i[2*o+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=c<2?++c:0,i[2*l]=1,e.depth[l]=0,e.opt_len--,n&&(e.static_len-=r[2*l+1]);for(t.max_code=c,o=e.heap_len>>1;o>=1;o--)Uv(e,i,o);l=a;do{o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Uv(e,i,1),s=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=s,i[2*l]=i[2*o]+i[2*s],e.depth[l]=(e.depth[o]>=e.depth[s]?e.depth[o]:e.depth[s])+1,i[2*o+1]=i[2*s+1]=l,e.heap[1]=l++,Uv(e,i,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const i=t.dyn_tree,r=t.max_code,n=t.stat_desc.static_tree,a=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,s=t.stat_desc.extra_base,l=t.stat_desc.max_length;let c,u,h,p,d,f,m=0;for(p=0;p<=gv;p++)e.bl_count[p]=0;for(i[2*e.heap[e.heap_max]+1]=0,c=e.heap_max+1;c<573;c++)u=e.heap[c],p=i[2*i[2*u+1]+1]+1,p>l&&(p=l,m++),i[2*u+1]=p,u>r||(e.bl_count[p]++,d=0,u>=s&&(d=o[u-s]),f=i[2*u],e.opt_len+=f*(p+d),a&&(e.static_len+=f*(n[2*u+1]+d)));if(0!==m){do{for(p=l-1;0===e.bl_count[p];)p--;e.bl_count[p]--,e.bl_count[p+1]+=2,e.bl_count[l]--,m-=2}while(m>0);for(p=l;0!==p;p--)for(u=e.bl_count[p];0!==u;)h=e.heap[--c],h>r||(i[2*h+1]!==p&&(e.opt_len+=(p-i[2*h+1])*i[2*h],i[2*h+1]=p),u--)}})(e,t),Fv(i,c,e.bl_count)},qv=(e,t,i)=>{let r,n,a=-1,o=t[1],s=0,l=7,c=4;for(0===o&&(l=138,c=3),t[2*(i+1)+1]=65535,r=0;r<=i;r++)n=o,o=t[2*(r+1)+1],++s<l&&n===o||(s<c?e.bl_tree[2*n]+=s:0!==n?(n!==a&&e.bl_tree[2*n]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,a=n,0===o?(l=138,c=3):n===o?(l=6,c=3):(l=7,c=4))},Gv=(e,t,i)=>{let r,n,a=-1,o=t[1],s=0,l=7,c=4;for(0===o&&(l=138,c=3),r=0;r<=i;r++)if(n=o,o=t[2*(r+1)+1],!(++s<l&&n===o)){if(s<c)do{Dv(e,n,e.bl_tree)}while(0!==--s);else 0!==n?(n!==a&&(Dv(e,n,e.bl_tree),s--),Dv(e,16,e.bl_tree),Lv(e,s-3,2)):s<=10?(Dv(e,17,e.bl_tree),Lv(e,s-3,3)):(Dv(e,18,e.bl_tree),Lv(e,s-11,7));s=0,a=n,0===o?(l=138,c=3):n===o?(l=6,c=3):(l=7,c=4)}};let Hv=!1;const Wv=(e,t,i,r)=>{Lv(e,0+(r?1:0),3),((e,t,i,r)=>{Nv(e),r&&(kv(e,i),kv(e,~i)),e.pending_buf.set(e.window.subarray(t,t+i),e.pending),e.pending+=i})(e,t,i,!0)};var Zv=(e,t,i,r)=>{let n,a,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,i=4093624447;for(t=0;t<=31;t++,i>>>=1)if(1&i&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<dv;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),jv(e,e.l_desc),jv(e,e.d_desc),o=(e=>{let t;for(qv(e,e.dyn_ltree,e.l_desc.max_code),qv(e,e.dyn_dtree,e.d_desc.max_code),jv(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*xv[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),n=e.opt_len+3+7>>>3,a=e.static_len+3+7>>>3,a<=n&&(n=a)):n=a=i+5,i+4<=n&&-1!==t?Wv(e,t,i,r):4===e.strategy||a===n?(Lv(e,2+(r?1:0),3),$v(e,bv,wv)):(Lv(e,4+(r?1:0),3),((e,t,i,r)=>{let n;for(Lv(e,t-257,5),Lv(e,i-1,5),Lv(e,r-4,4),n=0;n<r;n++)Lv(e,e.bl_tree[2*xv[n]+1],3);Gv(e,e.dyn_ltree,t-1),Gv(e,e.dyn_dtree,i-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),$v(e,e.dyn_ltree,e.dyn_dtree)),Ov(e),r&&Nv(e)},Xv={_tr_init:e=>{Hv||((()=>{let e,t,i,r,n;const a=new Array(16);for(i=0,r=0;r<28;r++)for(Tv[r]=i,e=0;e<1<<_v[r];e++)Mv[i++]=r;for(Mv[i-1]=r,n=0,r=0;r<16;r++)for(Ev[r]=n,e=0;e<1<<yv[r];e++)Sv[n++]=r;for(n>>=7;r<mv;r++)for(Ev[r]=n<<7,e=0;e<1<<yv[r]-7;e++)Sv[256+n++]=r;for(t=0;t<=gv;t++)a[t]=0;for(e=0;e<=143;)bv[2*e+1]=8,e++,a[8]++;for(;e<=255;)bv[2*e+1]=9,e++,a[9]++;for(;e<=279;)bv[2*e+1]=7,e++,a[7]++;for(;e<=287;)bv[2*e+1]=8,e++,a[8]++;for(Fv(bv,287,a),e=0;e<mv;e++)wv[2*e+1]=5,wv[2*e]=Bv(e,5);Av=new Cv(bv,_v,257,fv,gv),Iv=new Cv(wv,yv,0,mv,gv),Pv=new Cv(new Array(0),vv,0,19,7)})(),Hv=!0),e.l_desc=new zv(e.dyn_ltree,Av),e.d_desc=new zv(e.dyn_dtree,Iv),e.bl_desc=new zv(e.bl_tree,Pv),e.bi_buf=0,e.bi_valid=0,Ov(e)},_tr_stored_block:Wv,_tr_flush_block:Zv,_tr_tally:(e,t,i)=>(e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&i,e.last_lit++,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(Mv[i]+dv+1)]++,e.dyn_dtree[2*Rv(t)]++),e.last_lit===e.lit_bufsize-1),_tr_align:e=>{Lv(e,2,3),Dv(e,256,bv),(e=>{16===e.bi_valid?(kv(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}};var Yv=(e,t,i,r)=>{let n=65535&e|0,a=e>>>16&65535|0,o=0;for(;0!==i;){o=i>2e3?2e3:i,i-=o;do{n=n+t[r++]|0,a=a+n|0}while(--o);n%=65521,a%=65521}return n|a<<16|0};const Kv=new Uint32Array((()=>{let e,t=[];for(var i=0;i<256;i++){e=i;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t})());var Jv=(e,t,i,r)=>{const n=Kv,a=r+i;e^=-1;for(let o=r;o<a;o++)e=e>>>8^n[255&(e^t[o])];return-1^e},Qv={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},ex={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:tx,_tr_stored_block:ix,_tr_flush_block:rx,_tr_tally:nx,_tr_align:ax}=Xv,{Z_NO_FLUSH:ox,Z_PARTIAL_FLUSH:sx,Z_FULL_FLUSH:lx,Z_FINISH:cx,Z_BLOCK:ux,Z_OK:hx,Z_STREAM_END:px,Z_STREAM_ERROR:dx,Z_DATA_ERROR:fx,Z_BUF_ERROR:mx,Z_DEFAULT_COMPRESSION:gx,Z_FILTERED:_x,Z_HUFFMAN_ONLY:yx,Z_RLE:vx,Z_FIXED:xx,Z_DEFAULT_STRATEGY:bx,Z_UNKNOWN:wx,Z_DEFLATED:Sx}=ex,Mx=258,Tx=262,Ex=103,Cx=113,Ax=666,Ix=(e,t)=>(e.msg=Qv[t],t),Px=e=>(e<<1)-(e>4?9:0),zx=e=>{let t=e.length;for(;--t>=0;)e[t]=0};let Rx=(e,t,i)=>(t<<e.hash_shift^i)&e.hash_mask;const kx=e=>{const t=e.state;let i=t.pending;i>e.avail_out&&(i=e.avail_out),0!==i&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+i),e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending&&(t.pending_out=0))},Lx=(e,t)=>{rx(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,kx(e.strm)},Dx=(e,t)=>{e.pending_buf[e.pending++]=t},Bx=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},Fx=(e,t,i,r)=>{let n=e.avail_in;return n>r&&(n=r),0===n?0:(e.avail_in-=n,t.set(e.input.subarray(e.next_in,e.next_in+n),i),1===e.state.wrap?e.adler=Yv(e.adler,t,n,i):2===e.state.wrap&&(e.adler=Jv(e.adler,t,n,i)),e.next_in+=n,e.total_in+=n,n)},Ox=(e,t)=>{let i,r,n=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match;const l=e.strstart>e.w_size-Tx?e.strstart-(e.w_size-Tx):0,c=e.window,u=e.w_mask,h=e.prev,p=e.strstart+Mx;let d=c[a+o-1],f=c[a+o];e.prev_length>=e.good_match&&(n>>=2),s>e.lookahead&&(s=e.lookahead);do{if(i=t,c[i+o]===f&&c[i+o-1]===d&&c[i]===c[a]&&c[++i]===c[a+1]){a+=2,i++;do{}while(c[++a]===c[++i]&&c[++a]===c[++i]&&c[++a]===c[++i]&&c[++a]===c[++i]&&c[++a]===c[++i]&&c[++a]===c[++i]&&c[++a]===c[++i]&&c[++a]===c[++i]&&a<p);if(r=Mx-(p-a),a=p-Mx,r>o){if(e.match_start=t,o=r,r>=s)break;d=c[a+o-1],f=c[a+o]}}}while((t=h[t&u])>l&&0!==--n);return o<=e.lookahead?o:e.lookahead},Nx=e=>{const t=e.w_size;let i,r,n,a,o;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Tx)){e.window.set(e.window.subarray(t,t+t),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,r=e.hash_size,i=r;do{n=e.head[--i],e.head[i]=n>=t?n-t:0}while(--r);r=t,i=r;do{n=e.prev[--i],e.prev[i]=n>=t?n-t:0}while(--r);a+=t}if(0===e.strm.avail_in)break;if(r=Fx(e.strm,e.window,e.strstart+e.lookahead,a),e.lookahead+=r,e.lookahead+e.insert>=3)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=Rx(e,e.ins_h,e.window[o+1]);e.insert&&(e.ins_h=Rx(e,e.ins_h,e.window[o+3-1]),e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Tx&&0!==e.strm.avail_in)},Vx=(e,t)=>{let i,r;for(;;){if(e.lookahead<Tx){if(Nx(e),e.lookahead<Tx&&t===ox)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=3&&(e.ins_h=Rx(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-Tx&&(e.match_length=Ox(e,i)),e.match_length>=3)if(r=nx(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=Rx(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Rx(e,e.ins_h,e.window[e.strstart+1]);else r=nx(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(Lx(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===cx?(Lx(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Lx(e,!1),0===e.strm.avail_out)?1:2},Ux=(e,t)=>{let i,r,n;for(;;){if(e.lookahead<Tx){if(Nx(e),e.lookahead<Tx&&t===ox)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=3&&(e.ins_h=Rx(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-Tx&&(e.match_length=Ox(e,i),e.match_length<=5&&(e.strategy===_x||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){n=e.strstart+e.lookahead-3,r=nx(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=n&&(e.ins_h=Rx(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!==--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(Lx(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(r=nx(e,0,e.window[e.strstart-1]),r&&Lx(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=nx(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===cx?(Lx(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Lx(e,!1),0===e.strm.avail_out)?1:2};function $x(e,t,i,r,n){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=r,this.func=n}const jx=[new $x(0,0,0,0,((e,t)=>{let i=65535;for(i>e.pending_buf_size-5&&(i=e.pending_buf_size-5);;){if(e.lookahead<=1){if(Nx(e),0===e.lookahead&&t===ox)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;const r=e.block_start+i;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,Lx(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-Tx&&(Lx(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===cx?(Lx(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(Lx(e,!1),e.strm.avail_out),1)})),new $x(4,4,8,4,Vx),new $x(4,5,16,8,Vx),new $x(4,6,32,32,Vx),new $x(4,4,16,16,Ux),new $x(8,16,32,32,Ux),new $x(8,16,128,128,Ux),new $x(8,32,128,256,Ux),new $x(32,128,258,1024,Ux),new $x(32,258,258,4096,Ux)];function qx(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Sx,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),zx(this.dyn_ltree),zx(this.dyn_dtree),zx(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),zx(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),zx(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Gx=e=>{if(!e||!e.state)return Ix(e,dx);e.total_in=e.total_out=0,e.data_type=wx;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:Cx,e.adler=2===t.wrap?0:1,t.last_flush=ox,tx(t),hx},Hx=e=>{const t=Gx(e);var i;return t===hx&&((i=e.state).window_size=2*i.w_size,zx(i.head),i.max_lazy_match=jx[i.level].max_lazy,i.good_match=jx[i.level].good_length,i.nice_match=jx[i.level].nice_length,i.max_chain_length=jx[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0),t},Wx=(e,t,i,r,n,a)=>{if(!e)return dx;let o=1;if(t===gx&&(t=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),n<1||n>9||i!==Sx||r<8||r>15||t<0||t>9||a<0||a>xx)return Ix(e,dx);8===r&&(r=9);const s=new qx;return e.state=s,s.strm=e,s.wrap=o,s.gzhead=null,s.w_bits=r,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=n+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new Uint8Array(2*s.w_size),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<n+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Uint8Array(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=t,s.strategy=a,s.method=i,Hx(e)};var Zx=(e,t)=>{let i,r;if(!e||!e.state||t>ux||t<0)return e?Ix(e,dx):dx;const n=e.state;if(!e.output||!e.input&&0!==e.avail_in||n.status===Ax&&t!==cx)return Ix(e,0===e.avail_out?mx:dx);n.strm=e;const a=n.last_flush;if(n.last_flush=t,42===n.status)if(2===n.wrap)e.adler=0,Dx(n,31),Dx(n,139),Dx(n,8),n.gzhead?(Dx(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Dx(n,255&n.gzhead.time),Dx(n,n.gzhead.time>>8&255),Dx(n,n.gzhead.time>>16&255),Dx(n,n.gzhead.time>>24&255),Dx(n,9===n.level?2:n.strategy>=yx||n.level<2?4:0),Dx(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Dx(n,255&n.gzhead.extra.length),Dx(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=Jv(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(Dx(n,0),Dx(n,0),Dx(n,0),Dx(n,0),Dx(n,0),Dx(n,9===n.level?2:n.strategy>=yx||n.level<2?4:0),Dx(n,3),n.status=Cx);else{let t=Sx+(n.w_bits-8<<4)<<8,i=-1;i=n.strategy>=yx||n.level<2?0:n.level<6?1:6===n.level?2:3,t|=i<<6,0!==n.strstart&&(t|=32),t+=31-t%31,n.status=Cx,Bx(n,t),0!==n.strstart&&(Bx(n,e.adler>>>16),Bx(n,65535&e.adler)),e.adler=1}if(69===n.status)if(n.gzhead.extra){for(i=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>i&&(e.adler=Jv(e.adler,n.pending_buf,n.pending-i,i)),kx(e),i=n.pending,n.pending!==n.pending_buf_size));)Dx(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>i&&(e.adler=Jv(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73;if(73===n.status)if(n.gzhead.name){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(e.adler=Jv(e.adler,n.pending_buf,n.pending-i,i)),kx(e),i=n.pending,n.pending===n.pending_buf_size)){r=1;break}r=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Dx(n,r)}while(0!==r);n.gzhead.hcrc&&n.pending>i&&(e.adler=Jv(e.adler,n.pending_buf,n.pending-i,i)),0===r&&(n.gzindex=0,n.status=91)}else n.status=91;if(91===n.status)if(n.gzhead.comment){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(e.adler=Jv(e.adler,n.pending_buf,n.pending-i,i)),kx(e),i=n.pending,n.pending===n.pending_buf_size)){r=1;break}r=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Dx(n,r)}while(0!==r);n.gzhead.hcrc&&n.pending>i&&(e.adler=Jv(e.adler,n.pending_buf,n.pending-i,i)),0===r&&(n.status=Ex)}else n.status=Ex;if(n.status===Ex&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&kx(e),n.pending+2<=n.pending_buf_size&&(Dx(n,255&e.adler),Dx(n,e.adler>>8&255),e.adler=0,n.status=Cx)):n.status=Cx),0!==n.pending){if(kx(e),0===e.avail_out)return n.last_flush=-1,hx}else if(0===e.avail_in&&Px(t)<=Px(a)&&t!==cx)return Ix(e,mx);if(n.status===Ax&&0!==e.avail_in)return Ix(e,mx);if(0!==e.avail_in||0!==n.lookahead||t!==ox&&n.status!==Ax){let i=n.strategy===yx?((e,t)=>{let i;for(;;){if(0===e.lookahead&&(Nx(e),0===e.lookahead)){if(t===ox)return 1;break}if(e.match_length=0,i=nx(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(Lx(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===cx?(Lx(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Lx(e,!1),0===e.strm.avail_out)?1:2})(n,t):n.strategy===vx?((e,t)=>{let i,r,n,a;const o=e.window;for(;;){if(e.lookahead<=Mx){if(Nx(e),e.lookahead<=Mx&&t===ox)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(n=e.strstart-1,r=o[n],r===o[++n]&&r===o[++n]&&r===o[++n])){a=e.strstart+Mx;do{}while(r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&n<a);e.match_length=Mx-(a-n),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(i=nx(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=nx(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(Lx(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===cx?(Lx(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Lx(e,!1),0===e.strm.avail_out)?1:2})(n,t):jx[n.level].func(n,t);if(3!==i&&4!==i||(n.status=Ax),1===i||3===i)return 0===e.avail_out&&(n.last_flush=-1),hx;if(2===i&&(t===sx?ax(n):t!==ux&&(ix(n,0,0,!1),t===lx&&(zx(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),kx(e),0===e.avail_out))return n.last_flush=-1,hx}return t!==cx?hx:n.wrap<=0?px:(2===n.wrap?(Dx(n,255&e.adler),Dx(n,e.adler>>8&255),Dx(n,e.adler>>16&255),Dx(n,e.adler>>24&255),Dx(n,255&e.total_in),Dx(n,e.total_in>>8&255),Dx(n,e.total_in>>16&255),Dx(n,e.total_in>>24&255)):(Bx(n,e.adler>>>16),Bx(n,65535&e.adler)),kx(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?hx:px)},Xx={deflateInit:(e,t)=>Wx(e,t,Sx,15,8,bx),deflateInit2:Wx,deflateReset:Hx,deflateResetKeep:Gx,deflateSetHeader:(e,t)=>e&&e.state?2!==e.state.wrap?dx:(e.state.gzhead=t,hx):dx,deflate:Zx,deflateEnd:e=>{if(!e||!e.state)return dx;const t=e.state.status;return 42!==t&&69!==t&&73!==t&&91!==t&&t!==Ex&&t!==Cx&&t!==Ax?Ix(e,dx):(e.state=null,t===Cx?Ix(e,fx):hx)},deflateSetDictionary:(e,t)=>{let i=t.length;if(!e||!e.state)return dx;const r=e.state,n=r.wrap;if(2===n||1===n&&42!==r.status||r.lookahead)return dx;if(1===n&&(e.adler=Yv(e.adler,t,i,0)),r.wrap=0,i>=r.w_size){0===n&&(zx(r.head),r.strstart=0,r.block_start=0,r.insert=0);let e=new Uint8Array(r.w_size);e.set(t.subarray(i-r.w_size,i),0),t=e,i=r.w_size}const a=e.avail_in,o=e.next_in,s=e.input;for(e.avail_in=i,e.next_in=0,e.input=t,Nx(r);r.lookahead>=3;){let e=r.strstart,t=r.lookahead-2;do{r.ins_h=Rx(r,r.ins_h,r.window[e+3-1]),r.prev[e&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=e,e++}while(--t);r.strstart=e,r.lookahead=2,Nx(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=o,e.input=s,e.avail_in=a,r.wrap=n,hx},deflateInfo:"pako deflate (from Nodeca project)"};const Yx=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Kx=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const i=t.shift();if(i){if("object"!==typeof i)throw new TypeError(i+"must be non-object");for(const t in i)Yx(i,t)&&(e[t]=i[t])}}return e},Jx=e=>{let t=0;for(let r=0,n=e.length;r<n;r++)t+=e[r].length;const i=new Uint8Array(t);for(let r=0,n=0,a=e.length;r<a;r++){let t=e[r];i.set(t,n),n+=t.length}return i};let Qx=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(GS){Qx=!1}const eb=new Uint8Array(256);for(let HS=0;HS<256;HS++)eb[HS]=HS>=252?6:HS>=248?5:HS>=240?4:HS>=224?3:HS>=192?2:1;eb[254]=eb[254]=1;var tb=e=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,i,r,n,a,o=e.length,s=0;for(n=0;n<o;n++)i=e.charCodeAt(n),55296===(64512&i)&&n+1<o&&(r=e.charCodeAt(n+1),56320===(64512&r)&&(i=65536+(i-55296<<10)+(r-56320),n++)),s+=i<128?1:i<2048?2:i<65536?3:4;for(t=new Uint8Array(s),a=0,n=0;a<s;n++)i=e.charCodeAt(n),55296===(64512&i)&&n+1<o&&(r=e.charCodeAt(n+1),56320===(64512&r)&&(i=65536+(i-55296<<10)+(r-56320),n++)),i<128?t[a++]=i:i<2048?(t[a++]=192|i>>>6,t[a++]=128|63&i):i<65536?(t[a++]=224|i>>>12,t[a++]=128|i>>>6&63,t[a++]=128|63&i):(t[a++]=240|i>>>18,t[a++]=128|i>>>12&63,t[a++]=128|i>>>6&63,t[a++]=128|63&i);return t},ib=(e,t)=>{const i=t||e.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let r,n;const a=new Array(2*i);for(n=0,r=0;r<i;){let t=e[r++];if(t<128){a[n++]=t;continue}let o=eb[t];if(o>4)a[n++]=65533,r+=o-1;else{for(t&=2===o?31:3===o?15:7;o>1&&r<i;)t=t<<6|63&e[r++],o--;o>1?a[n++]=65533:t<65536?a[n++]=t:(t-=65536,a[n++]=55296|t>>10&1023,a[n++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&Qx)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let i="";for(let r=0;r<t;r++)i+=String.fromCharCode(e[r]);return i})(a,n)},rb=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let i=t-1;for(;i>=0&&128===(192&e[i]);)i--;return i<0||0===i?t:i+eb[e[i]]>t?i:t};var nb=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const ab=Object.prototype.toString,{Z_NO_FLUSH:ob,Z_SYNC_FLUSH:sb,Z_FULL_FLUSH:lb,Z_FINISH:cb,Z_OK:ub,Z_STREAM_END:hb,Z_DEFAULT_COMPRESSION:pb,Z_DEFAULT_STRATEGY:db,Z_DEFLATED:fb}=ex;function mb(e){this.options=Kx({level:pb,method:fb,chunkSize:16384,windowBits:15,memLevel:8,strategy:db},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new nb,this.strm.avail_out=0;let i=Xx.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==ub)throw new Error(Qv[i]);if(t.header&&Xx.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"===typeof t.dictionary?tb(t.dictionary):"[object ArrayBuffer]"===ab.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,i=Xx.deflateSetDictionary(this.strm,e),i!==ub)throw new Error(Qv[i]);this._dict_set=!0}}mb.prototype.push=function(e,t){const i=this.strm,r=this.options.chunkSize;let n,a;if(this.ended)return!1;for(a=t===~~t?t:!0===t?cb:ob,"string"===typeof e?i.input=tb(e):"[object ArrayBuffer]"===ab.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(r),i.next_out=0,i.avail_out=r),(a===sb||a===lb)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(n=Xx.deflate(i,a),n===hb)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),n=Xx.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===ub;if(0!==i.avail_out){if(a>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},mb.prototype.onData=function(e){this.chunks.push(e)},mb.prototype.onEnd=function(e){e===ub&&(this.result=Jx(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var gb=function(e,t){let i,r,n,a,o,s,l,c,u,h,p,d,f,m,g,_,y,v,x,b,w,S,M,T;const E=e.state;i=e.next_in,M=e.input,r=i+(e.avail_in-5),n=e.next_out,T=e.output,a=n-(t-e.avail_out),o=n+(e.avail_out-257),s=E.dmax,l=E.wsize,c=E.whave,u=E.wnext,h=E.window,p=E.hold,d=E.bits,f=E.lencode,m=E.distcode,g=(1<<E.lenbits)-1,_=(1<<E.distbits)-1;e:do{d<15&&(p+=M[i++]<<d,d+=8,p+=M[i++]<<d,d+=8),y=f[p&g];t:for(;;){if(v=y>>>24,p>>>=v,d-=v,v=y>>>16&255,0===v)T[n++]=65535&y;else{if(!(16&v)){if(0===(64&v)){y=f[(65535&y)+(p&(1<<v)-1)];continue t}if(32&v){E.mode=12;break e}e.msg="invalid literal/length code",E.mode=30;break e}x=65535&y,v&=15,v&&(d<v&&(p+=M[i++]<<d,d+=8),x+=p&(1<<v)-1,p>>>=v,d-=v),d<15&&(p+=M[i++]<<d,d+=8,p+=M[i++]<<d,d+=8),y=m[p&_];i:for(;;){if(v=y>>>24,p>>>=v,d-=v,v=y>>>16&255,!(16&v)){if(0===(64&v)){y=m[(65535&y)+(p&(1<<v)-1)];continue i}e.msg="invalid distance code",E.mode=30;break e}if(b=65535&y,v&=15,d<v&&(p+=M[i++]<<d,d+=8,d<v&&(p+=M[i++]<<d,d+=8)),b+=p&(1<<v)-1,b>s){e.msg="invalid distance too far back",E.mode=30;break e}if(p>>>=v,d-=v,v=n-a,b>v){if(v=b-v,v>c&&E.sane){e.msg="invalid distance too far back",E.mode=30;break e}if(w=0,S=h,0===u){if(w+=l-v,v<x){x-=v;do{T[n++]=h[w++]}while(--v);w=n-b,S=T}}else if(u<v){if(w+=l+u-v,v-=u,v<x){x-=v;do{T[n++]=h[w++]}while(--v);if(w=0,u<x){v=u,x-=v;do{T[n++]=h[w++]}while(--v);w=n-b,S=T}}}else if(w+=u-v,v<x){x-=v;do{T[n++]=h[w++]}while(--v);w=n-b,S=T}for(;x>2;)T[n++]=S[w++],T[n++]=S[w++],T[n++]=S[w++],x-=3;x&&(T[n++]=S[w++],x>1&&(T[n++]=S[w++]))}else{w=n-b;do{T[n++]=T[w++],T[n++]=T[w++],T[n++]=T[w++],x-=3}while(x>2);x&&(T[n++]=T[w++],x>1&&(T[n++]=T[w++]))}break}}break}}while(i<r&&n<o);x=d>>3,i-=x,d-=x<<3,p&=(1<<d)-1,e.next_in=i,e.next_out=n,e.avail_in=i<r?r-i+5:5-(i-r),e.avail_out=n<o?o-n+257:257-(n-o),E.hold=p,E.bits=d};const _b=15,yb=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),vb=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),xb=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),bb=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var wb=(e,t,i,r,n,a,o,s)=>{const l=s.bits;let c,u,h,p,d,f,m=0,g=0,_=0,y=0,v=0,x=0,b=0,w=0,S=0,M=0,T=null,E=0;const C=new Uint16Array(16),A=new Uint16Array(16);let I,P,z,R=null,k=0;for(m=0;m<=_b;m++)C[m]=0;for(g=0;g<r;g++)C[t[i+g]]++;for(v=l,y=_b;y>=1&&0===C[y];y--);if(v>y&&(v=y),0===y)return n[a++]=20971520,n[a++]=20971520,s.bits=1,0;for(_=1;_<y&&0===C[_];_++);for(v<_&&(v=_),w=1,m=1;m<=_b;m++)if(w<<=1,w-=C[m],w<0)return-1;if(w>0&&(0===e||1!==y))return-1;for(A[1]=0,m=1;m<_b;m++)A[m+1]=A[m]+C[m];for(g=0;g<r;g++)0!==t[i+g]&&(o[A[t[i+g]]++]=g);if(0===e?(T=R=o,f=19):1===e?(T=yb,E-=257,R=vb,k-=257,f=256):(T=xb,R=bb,f=-1),M=0,g=0,m=_,d=a,x=v,b=0,h=-1,S=1<<v,p=S-1,1===e&&S>852||2===e&&S>592)return 1;for(;;){I=m-b,o[g]<f?(P=0,z=o[g]):o[g]>f?(P=R[k+o[g]],z=T[E+o[g]]):(P=96,z=0),c=1<<m-b,u=1<<x,_=u;do{u-=c,n[d+(M>>b)+u]=I<<24|P<<16|z|0}while(0!==u);for(c=1<<m-1;M&c;)c>>=1;if(0!==c?(M&=c-1,M+=c):M=0,g++,0===--C[m]){if(m===y)break;m=t[i+o[g]]}if(m>v&&(M&p)!==h){for(0===b&&(b=v),d+=_,x=m-b,w=1<<x;x+b<y&&(w-=C[x+b],!(w<=0));)x++,w<<=1;if(S+=1<<x,1===e&&S>852||2===e&&S>592)return 1;h=M&p,n[h]=v<<24|x<<16|d-a|0}}return 0!==M&&(n[d+M]=m-b<<24|64<<16|0),s.bits=v,0};const{Z_FINISH:Sb,Z_BLOCK:Mb,Z_TREES:Tb,Z_OK:Eb,Z_STREAM_END:Cb,Z_NEED_DICT:Ab,Z_STREAM_ERROR:Ib,Z_DATA_ERROR:Pb,Z_MEM_ERROR:zb,Z_BUF_ERROR:Rb,Z_DEFLATED:kb}=ex,Lb=12,Db=30,Bb=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Fb(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ob=e=>{if(!e||!e.state)return Ib;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Eb},Nb=e=>{if(!e||!e.state)return Ib;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,Ob(e)},Vb=(e,t)=>{let i;if(!e||!e.state)return Ib;const r=e.state;return t<0?(i=0,t=-t):(i=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Ib:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=i,r.wbits=t,Nb(e))},Ub=(e,t)=>{if(!e)return Ib;const i=new Fb;e.state=i,i.window=null;const r=Vb(e,t);return r!==Eb&&(e.state=null),r};let $b,jb,qb=!0;const Gb=e=>{if(qb){$b=new Int32Array(512),jb=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(wb(1,e.lens,0,288,$b,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;wb(2,e.lens,0,32,jb,0,e.work,{bits:5}),qb=!1}e.lencode=$b,e.lenbits=9,e.distcode=jb,e.distbits=5},Hb=(e,t,i,r)=>{let n;const a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),r>=a.wsize?(a.window.set(t.subarray(i-a.wsize,i),0),a.wnext=0,a.whave=a.wsize):(n=a.wsize-a.wnext,n>r&&(n=r),a.window.set(t.subarray(i-r,i-r+n),a.wnext),(r-=n)?(a.window.set(t.subarray(i-r,i),0),a.wnext=r,a.whave=a.wsize):(a.wnext+=n,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=n))),0};var Wb=(e,t)=>{let i,r,n,a,o,s,l,c,u,h,p,d,f,m,g,_,y,v,x,b,w,S,M=0;const T=new Uint8Array(4);let E,C;const A=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return Ib;i=e.state,i.mode===Lb&&(i.mode=13),o=e.next_out,n=e.output,l=e.avail_out,a=e.next_in,r=e.input,s=e.avail_in,c=i.hold,u=i.bits,h=s,p=l,S=Eb;e:for(;;)switch(i.mode){case 1:if(0===i.wrap){i.mode=13;break}for(;u<16;){if(0===s)break e;s--,c+=r[a++]<<u,u+=8}if(2&i.wrap&&35615===c){i.check=0,T[0]=255&c,T[1]=c>>>8&255,i.check=Jv(i.check,T,2,0),c=0,u=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",i.mode=Db;break}if((15&c)!==kb){e.msg="unknown compression method",i.mode=Db;break}if(c>>>=4,u-=4,w=8+(15&c),0===i.wbits)i.wbits=w;else if(w>i.wbits){e.msg="invalid window size",i.mode=Db;break}i.dmax=1<<i.wbits,e.adler=i.check=1,i.mode=512&c?10:Lb,c=0,u=0;break;case 2:for(;u<16;){if(0===s)break e;s--,c+=r[a++]<<u,u+=8}if(i.flags=c,(255&i.flags)!==kb){e.msg="unknown compression method",i.mode=Db;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=Db;break}i.head&&(i.head.text=c>>8&1),512&i.flags&&(T[0]=255&c,T[1]=c>>>8&255,i.check=Jv(i.check,T,2,0)),c=0,u=0,i.mode=3;case 3:for(;u<32;){if(0===s)break e;s--,c+=r[a++]<<u,u+=8}i.head&&(i.head.time=c),512&i.flags&&(T[0]=255&c,T[1]=c>>>8&255,T[2]=c>>>16&255,T[3]=c>>>24&255,i.check=Jv(i.check,T,4,0)),c=0,u=0,i.mode=4;case 4:for(;u<16;){if(0===s)break e;s--,c+=r[a++]<<u,u+=8}i.head&&(i.head.xflags=255&c,i.head.os=c>>8),512&i.flags&&(T[0]=255&c,T[1]=c>>>8&255,i.check=Jv(i.check,T,2,0)),c=0,u=0,i.mode=5;case 5:if(1024&i.flags){for(;u<16;){if(0===s)break e;s--,c+=r[a++]<<u,u+=8}i.length=c,i.head&&(i.head.extra_len=c),512&i.flags&&(T[0]=255&c,T[1]=c>>>8&255,i.check=Jv(i.check,T,2,0)),c=0,u=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&(d=i.length,d>s&&(d=s),d&&(i.head&&(w=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(r.subarray(a,a+d),w)),512&i.flags&&(i.check=Jv(i.check,r,d,a)),s-=d,a+=d,i.length-=d),i.length))break e;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===s)break e;d=0;do{w=r[a+d++],i.head&&w&&i.length<65536&&(i.head.name+=String.fromCharCode(w))}while(w&&d<s);if(512&i.flags&&(i.check=Jv(i.check,r,d,a)),s-=d,a+=d,w)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===s)break e;d=0;do{w=r[a+d++],i.head&&w&&i.length<65536&&(i.head.comment+=String.fromCharCode(w))}while(w&&d<s);if(512&i.flags&&(i.check=Jv(i.check,r,d,a)),s-=d,a+=d,w)break e}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;u<16;){if(0===s)break e;s--,c+=r[a++]<<u,u+=8}if(c!==(65535&i.check)){e.msg="header crc mismatch",i.mode=Db;break}c=0,u=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=Lb;break;case 10:for(;u<32;){if(0===s)break e;s--,c+=r[a++]<<u,u+=8}e.adler=i.check=Bb(c),c=0,u=0,i.mode=11;case 11:if(0===i.havedict)return e.next_out=o,e.avail_out=l,e.next_in=a,e.avail_in=s,i.hold=c,i.bits=u,Ab;e.adler=i.check=1,i.mode=Lb;case Lb:if(t===Mb||t===Tb)break e;case 13:if(i.last){c>>>=7&u,u-=7&u,i.mode=27;break}for(;u<3;){if(0===s)break e;s--,c+=r[a++]<<u,u+=8}switch(i.last=1&c,c>>>=1,u-=1,3&c){case 0:i.mode=14;break;case 1:if(Gb(i),i.mode=20,t===Tb){c>>>=2,u-=2;break e}break;case 2:i.mode=17;break;case 3:e.msg="invalid block type",i.mode=Db}c>>>=2,u-=2;break;case 14:for(c>>>=7&u,u-=7&u;u<32;){if(0===s)break e;s--,c+=r[a++]<<u,u+=8}if((65535&c)!==(c>>>16^65535)){e.msg="invalid stored block lengths",i.mode=Db;break}if(i.length=65535&c,c=0,u=0,i.mode=15,t===Tb)break e;case 15:i.mode=16;case 16:if(d=i.length,d){if(d>s&&(d=s),d>l&&(d=l),0===d)break e;n.set(r.subarray(a,a+d),o),s-=d,a+=d,l-=d,o+=d,i.length-=d;break}i.mode=Lb;break;case 17:for(;u<14;){if(0===s)break e;s--,c+=r[a++]<<u,u+=8}if(i.nlen=257+(31&c),c>>>=5,u-=5,i.ndist=1+(31&c),c>>>=5,u-=5,i.ncode=4+(15&c),c>>>=4,u-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=Db;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;u<3;){if(0===s)break e;s--,c+=r[a++]<<u,u+=8}i.lens[A[i.have++]]=7&c,c>>>=3,u-=3}for(;i.have<19;)i.lens[A[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,E={bits:i.lenbits},S=wb(0,i.lens,0,19,i.lencode,0,i.work,E),i.lenbits=E.bits,S){e.msg="invalid code lengths set",i.mode=Db;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;M=i.lencode[c&(1<<i.lenbits)-1],g=M>>>24,_=M>>>16&255,y=65535&M,!(g<=u);){if(0===s)break e;s--,c+=r[a++]<<u,u+=8}if(y<16)c>>>=g,u-=g,i.lens[i.have++]=y;else{if(16===y){for(C=g+2;u<C;){if(0===s)break e;s--,c+=r[a++]<<u,u+=8}if(c>>>=g,u-=g,0===i.have){e.msg="invalid bit length repeat",i.mode=Db;break}w=i.lens[i.have-1],d=3+(3&c),c>>>=2,u-=2}else if(17===y){for(C=g+3;u<C;){if(0===s)break e;s--,c+=r[a++]<<u,u+=8}c>>>=g,u-=g,w=0,d=3+(7&c),c>>>=3,u-=3}else{for(C=g+7;u<C;){if(0===s)break e;s--,c+=r[a++]<<u,u+=8}c>>>=g,u-=g,w=0,d=11+(127&c),c>>>=7,u-=7}if(i.have+d>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=Db;break}for(;d--;)i.lens[i.have++]=w}}if(i.mode===Db)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=Db;break}if(i.lenbits=9,E={bits:i.lenbits},S=wb(1,i.lens,0,i.nlen,i.lencode,0,i.work,E),i.lenbits=E.bits,S){e.msg="invalid literal/lengths set",i.mode=Db;break}if(i.distbits=6,i.distcode=i.distdyn,E={bits:i.distbits},S=wb(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,E),i.distbits=E.bits,S){e.msg="invalid distances set",i.mode=Db;break}if(i.mode=20,t===Tb)break e;case 20:i.mode=21;case 21:if(s>=6&&l>=258){e.next_out=o,e.avail_out=l,e.next_in=a,e.avail_in=s,i.hold=c,i.bits=u,gb(e,p),o=e.next_out,n=e.output,l=e.avail_out,a=e.next_in,r=e.input,s=e.avail_in,c=i.hold,u=i.bits,i.mode===Lb&&(i.back=-1);break}for(i.back=0;M=i.lencode[c&(1<<i.lenbits)-1],g=M>>>24,_=M>>>16&255,y=65535&M,!(g<=u);){if(0===s)break e;s--,c+=r[a++]<<u,u+=8}if(_&&0===(240&_)){for(v=g,x=_,b=y;M=i.lencode[b+((c&(1<<v+x)-1)>>v)],g=M>>>24,_=M>>>16&255,y=65535&M,!(v+g<=u);){if(0===s)break e;s--,c+=r[a++]<<u,u+=8}c>>>=v,u-=v,i.back+=v}if(c>>>=g,u-=g,i.back+=g,i.length=y,0===_){i.mode=26;break}if(32&_){i.back=-1,i.mode=Lb;break}if(64&_){e.msg="invalid literal/length code",i.mode=Db;break}i.extra=15&_,i.mode=22;case 22:if(i.extra){for(C=i.extra;u<C;){if(0===s)break e;s--,c+=r[a++]<<u,u+=8}i.length+=c&(1<<i.extra)-1,c>>>=i.extra,u-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;M=i.distcode[c&(1<<i.distbits)-1],g=M>>>24,_=M>>>16&255,y=65535&M,!(g<=u);){if(0===s)break e;s--,c+=r[a++]<<u,u+=8}if(0===(240&_)){for(v=g,x=_,b=y;M=i.distcode[b+((c&(1<<v+x)-1)>>v)],g=M>>>24,_=M>>>16&255,y=65535&M,!(v+g<=u);){if(0===s)break e;s--,c+=r[a++]<<u,u+=8}c>>>=v,u-=v,i.back+=v}if(c>>>=g,u-=g,i.back+=g,64&_){e.msg="invalid distance code",i.mode=Db;break}i.offset=y,i.extra=15&_,i.mode=24;case 24:if(i.extra){for(C=i.extra;u<C;){if(0===s)break e;s--,c+=r[a++]<<u,u+=8}i.offset+=c&(1<<i.extra)-1,c>>>=i.extra,u-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=Db;break}i.mode=25;case 25:if(0===l)break e;if(d=p-l,i.offset>d){if(d=i.offset-d,d>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=Db;break}d>i.wnext?(d-=i.wnext,f=i.wsize-d):f=i.wnext-d,d>i.length&&(d=i.length),m=i.window}else m=n,f=o-i.offset,d=i.length;d>l&&(d=l),l-=d,i.length-=d;do{n[o++]=m[f++]}while(--d);0===i.length&&(i.mode=21);break;case 26:if(0===l)break e;n[o++]=i.length,l--,i.mode=21;break;case 27:if(i.wrap){for(;u<32;){if(0===s)break e;s--,c|=r[a++]<<u,u+=8}if(p-=l,e.total_out+=p,i.total+=p,p&&(e.adler=i.check=i.flags?Jv(i.check,n,p,o-p):Yv(i.check,n,p,o-p)),p=l,(i.flags?c:Bb(c))!==i.check){e.msg="incorrect data check",i.mode=Db;break}c=0,u=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;u<32;){if(0===s)break e;s--,c+=r[a++]<<u,u+=8}if(c!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=Db;break}c=0,u=0}i.mode=29;case 29:S=Cb;break e;case Db:S=Pb;break e;case 31:return zb;default:return Ib}return e.next_out=o,e.avail_out=l,e.next_in=a,e.avail_in=s,i.hold=c,i.bits=u,(i.wsize||p!==e.avail_out&&i.mode<Db&&(i.mode<27||t!==Sb))&&Hb(e,e.output,e.next_out,p-e.avail_out),h-=e.avail_in,p-=e.avail_out,e.total_in+=h,e.total_out+=p,i.total+=p,i.wrap&&p&&(e.adler=i.check=i.flags?Jv(i.check,n,p,e.next_out-p):Yv(i.check,n,p,e.next_out-p)),e.data_type=i.bits+(i.last?64:0)+(i.mode===Lb?128:0)+(20===i.mode||15===i.mode?256:0),(0===h&&0===p||t===Sb)&&S===Eb&&(S=Rb),S},Zb={inflateReset:Nb,inflateReset2:Vb,inflateResetKeep:Ob,inflateInit:e=>Ub(e,15),inflateInit2:Ub,inflate:Wb,inflateEnd:e=>{if(!e||!e.state)return Ib;let t=e.state;return t.window&&(t.window=null),e.state=null,Eb},inflateGetHeader:(e,t)=>{if(!e||!e.state)return Ib;const i=e.state;return 0===(2&i.wrap)?Ib:(i.head=t,t.done=!1,Eb)},inflateSetDictionary:(e,t)=>{const i=t.length;let r,n,a;return e&&e.state?(r=e.state,0!==r.wrap&&11!==r.mode?Ib:11===r.mode&&(n=1,n=Yv(n,t,i,0),n!==r.check)?Pb:(a=Hb(e,t,i,i),a?(r.mode=31,zb):(r.havedict=1,Eb))):Ib},inflateInfo:"pako inflate (from Nodeca project)"};var Xb=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Yb=Object.prototype.toString,{Z_NO_FLUSH:Kb,Z_FINISH:Jb,Z_OK:Qb,Z_STREAM_END:ew,Z_NEED_DICT:tw,Z_STREAM_ERROR:iw,Z_DATA_ERROR:rw,Z_MEM_ERROR:nw}=ex;function aw(e){this.options=Kx({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0===(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new nb,this.strm.avail_out=0;let i=Zb.inflateInit2(this.strm,t.windowBits);if(i!==Qb)throw new Error(Qv[i]);if(this.header=new Xb,Zb.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"===typeof t.dictionary?t.dictionary=tb(t.dictionary):"[object ArrayBuffer]"===Yb.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(i=Zb.inflateSetDictionary(this.strm,t.dictionary),i!==Qb)))throw new Error(Qv[i])}function ow(e,t){const i=new aw(t);if(i.push(e),i.err)throw i.msg||Qv[i.err];return i.result}aw.prototype.push=function(e,t){const i=this.strm,r=this.options.chunkSize,n=this.options.dictionary;let a,o,s;if(this.ended)return!1;for(o=t===~~t?t:!0===t?Jb:Kb,"[object ArrayBuffer]"===Yb.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(0===i.avail_out&&(i.output=new Uint8Array(r),i.next_out=0,i.avail_out=r),a=Zb.inflate(i,o),a===tw&&n&&(a=Zb.inflateSetDictionary(i,n),a===Qb?a=Zb.inflate(i,o):a===rw&&(a=tw));i.avail_in>0&&a===ew&&i.state.wrap>0&&0!==e[i.next_in];)Zb.inflateReset(i),a=Zb.inflate(i,o);switch(a){case iw:case rw:case tw:case nw:return this.onEnd(a),this.ended=!0,!1}if(s=i.avail_out,i.next_out&&(0===i.avail_out||a===ew))if("string"===this.options.to){let e=rb(i.output,i.next_out),t=i.next_out-e,n=ib(i.output,e);i.next_out=t,i.avail_out=r-t,t&&i.output.set(i.output.subarray(e,e+t),0),this.onData(n)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(a!==Qb||0!==s){if(a===ew)return a=Zb.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(0===i.avail_in)break}}return!0},aw.prototype.onData=function(e){this.chunks.push(e)},aw.prototype.onEnd=function(e){e===Qb&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Jx(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var sw={Inflate:aw,inflate:ow,inflateRaw:function(e,t){return(t=t||{}).raw=!0,ow(e,t)},ungzip:ow,constants:ex};const{Inflate:lw,inflate:cw,inflateRaw:uw,ungzip:hw}=sw;var pw=cw,dw={read:function(e,t,i,r,n){var a,o,s=8*n-r-1,l=(1<<s)-1,c=l>>1,u=-7,h=i?n-1:0,p=i?-1:1,d=e[t+h];for(h+=p,a=d&(1<<-u)-1,d>>=-u,u+=s;u>0;a=256*a+e[t+h],h+=p,u-=8);for(o=a&(1<<-u)-1,a>>=-u,u+=r;u>0;o=256*o+e[t+h],h+=p,u-=8);if(0===a)a=1-c;else{if(a===l)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,r),a-=c}return(d?-1:1)*o*Math.pow(2,a-r)},write:function(e,t,i,r,n,a){var o,s,l,c=8*a-n-1,u=(1<<c)-1,h=u>>1,p=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:a-1,f=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+h>=1?p/l:p*Math.pow(2,1-h))*l>=2&&(o++,l/=2),o+h>=u?(s=0,o=u):o+h>=1?(s=(t*l-1)*Math.pow(2,n),o+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,n),o=0));n>=8;e[i+d]=255&s,d+=f,s/=256,n-=8);for(o=o<<n|s,c+=n;c>0;e[i+d]=255&o,d+=f,o/=256,c-=8);e[i+d-f]|=128*m}},fw=gw,mw=dw;function gw(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}gw.Varint=0,gw.Fixed64=1,gw.Bytes=2,gw.Fixed32=5;var _w=4294967296,yw=1/_w,vw="undefined"===typeof TextDecoder?null:new TextDecoder("utf8");function xw(e){return e.type===gw.Bytes?e.readVarint()+e.pos:e.pos+1}function bw(e,t,i){return i?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function ww(e,t,i){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(r);for(var n=i.pos-1;n>=e;n--)i.buf[n+r]=i.buf[n]}function Sw(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function Mw(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function Tw(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function Ew(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function Cw(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function Aw(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function Iw(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function Pw(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function zw(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function Rw(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function kw(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function Lw(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function Dw(e,t){return Bw(e,"GET","arraybuffer",[],null,t)}function Bw(e,t,i,r,n,a){const o=new XMLHttpRequest,s=new Promise(((a,s)=>{o.open(t,e,!0);for(const e of r)o.setRequestHeader(e.name,e.value);o.responseType=i,o.timeout=15e3,o.onload=()=>{var t;if(200!==o.status){const i=null!==(t=o.response)&&void 0!==t?t:new Xh(`Response status error: ${e}`);s(i)}o.response||s(new Xh(`Response empty: ${e}`)),a(o.response)},o.onerror=()=>{s(new Xh(`Request error: ${e}`))},o.ontimeout=()=>{s(new Xh(`Request timeout: ${e}`))},o.onabort=()=>{s(new Xh(`Request aborted: ${e}`))},o.send("POST"===t?n:null)}));return a&&a.catch((()=>{o.abort()})),s}function Fw(e,t,i){1===e?t.vertices.push(i.readFloat()):2===e?t.faces.push(i.readVarint()):console.warn(`Unsupported pbf tag (${e})`)}gw.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,a=this.pos;this.type=7&r,e(n,t,this),this.pos===a&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Rw(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=Lw(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Rw(this.buf,this.pos)+Rw(this.buf,this.pos+4)*_w;return this.pos+=8,e},readSFixed64:function(){var e=Rw(this.buf,this.pos)+Lw(this.buf,this.pos+4)*_w;return this.pos+=8,e},readFloat:function(){var e=mw.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=mw.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,i,r=this.buf;return t=127&(i=r[this.pos++]),i<128?t:(t|=(127&(i=r[this.pos++]))<<7,i<128?t:(t|=(127&(i=r[this.pos++]))<<14,i<128?t:(t|=(127&(i=r[this.pos++]))<<21,i<128?t:function(e,t,i){var r,n,a=i.buf;if(n=a[i.pos++],r=(112&n)>>4,n<128)return bw(e,r,t);if(n=a[i.pos++],r|=(127&n)<<3,n<128)return bw(e,r,t);if(n=a[i.pos++],r|=(127&n)<<10,n<128)return bw(e,r,t);if(n=a[i.pos++],r|=(127&n)<<17,n<128)return bw(e,r,t);if(n=a[i.pos++],r|=(127&n)<<24,n<128)return bw(e,r,t);if(n=a[i.pos++],r|=(1&n)<<31,n<128)return bw(e,r,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=r[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2===1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&vw?function(e,t,i){return vw.decode(e.subarray(t,i))}(this.buf,t,e):function(e,t,i){var r="",n=t;for(;n<i;){var a,o,s,l=e[n],c=null,u=l>239?4:l>223?3:l>191?2:1;if(n+u>i)break;1===u?l<128&&(c=l):2===u?128===(192&(a=e[n+1]))&&(c=(31&l)<<6|63&a)<=127&&(c=null):3===u?(a=e[n+1],o=e[n+2],128===(192&a)&&128===(192&o)&&((c=(15&l)<<12|(63&a)<<6|63&o)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(a=e[n+1],o=e[n+2],s=e[n+3],128===(192&a)&&128===(192&o)&&128===(192&s)&&((c=(15&l)<<18|(63&a)<<12|(63&o)<<6|63&s)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,r+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),r+=String.fromCharCode(c),n+=u}return r}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==gw.Bytes)return e.push(this.readVarint(t));var i=xw(this);for(e=e||[];this.pos<i;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==gw.Bytes)return e.push(this.readSVarint());var t=xw(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==gw.Bytes)return e.push(this.readBoolean());var t=xw(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==gw.Bytes)return e.push(this.readFloat());var t=xw(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==gw.Bytes)return e.push(this.readDouble());var t=xw(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==gw.Bytes)return e.push(this.readFixed32());var t=xw(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==gw.Bytes)return e.push(this.readSFixed32());var t=xw(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==gw.Bytes)return e.push(this.readFixed64());var t=xw(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==gw.Bytes)return e.push(this.readSFixed64());var t=xw(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===gw.Varint)for(;this.buf[this.pos++]>127;);else if(t===gw.Bytes)this.pos=this.readVarint()+this.pos;else if(t===gw.Fixed32)this.pos+=4;else{if(t!==gw.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),kw(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),kw(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),kw(this.buf,-1&e,this.pos),kw(this.buf,Math.floor(e*yw),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),kw(this.buf,-1&e,this.pos),kw(this.buf,Math.floor(e*yw),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var i,r;e>=0?(i=e%4294967296|0,r=e/4294967296|0):(r=~(-e/4294967296),4294967295^(i=~(-e%4294967296))?i=i+1|0:(i=0,r=r+1|0));if(e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,i){i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos]=127&e}(i,0,t),function(e,t){var i=(7&e)<<4;if(t.buf[t.pos++]|=i|((e>>>=3)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;t.buf[t.pos++]=127&e}(r,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,i){for(var r,n,a=0;a<t.length;a++){if((r=t.charCodeAt(a))>55295&&r<57344){if(!n){r>56319||a+1===t.length?(e[i++]=239,e[i++]=191,e[i++]=189):n=r;continue}if(r<56320){e[i++]=239,e[i++]=191,e[i++]=189,n=r;continue}r=n-55296<<10|r-56320|65536,n=null}else n&&(e[i++]=239,e[i++]=191,e[i++]=189,n=null);r<128?e[i++]=r:(r<2048?e[i++]=r>>6|192:(r<65536?e[i++]=r>>12|224:(e[i++]=r>>18|240,e[i++]=r>>12&63|128),e[i++]=r>>6&63|128),e[i++]=63&r|128)}return i}(this.buf,e,this.pos);var i=this.pos-t;i>=128&&ww(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(e){this.realloc(4),mw.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),mw.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var r=this.pos-i;r>=128&&ww(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,i){this.writeTag(e,gw.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,Sw,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Mw,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,Cw,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,Tw,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,Ew,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,Aw,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Iw,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,Pw,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,zw,t)},writeBytesField:function(e,t){this.writeTag(e,gw.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,gw.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,gw.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,gw.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,gw.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,gw.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,gw.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,gw.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,gw.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,gw.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};class Ow extends Mm{constructor(e){super(),this._geometry=e}get geometry(){return this._geometry}fire(e,t){super.fire(e,t)}getCoreImages(e){return Promise.reject(new Xh("Not implemented"))}getCluster(e,t){return Promise.reject(new Xh("Not implemented"))}getSpatialImages(e){return Promise.reject(new Xh("Not implemented"))}getImages(e){return Promise.reject(new Xh("Not implemented"))}getImageBuffer(e,t){return Promise.reject(new Xh("Not implemented"))}getImageTiles(e){return Promise.reject(new Xh("Not implemented"))}getMesh(e,t){return Promise.reject(new Xh("Not implemented"))}getSequence(e){return Promise.reject(new Xh("Not implemented"))}off(e,t){super.off(e,t)}on(e,t){super.on(e,t)}setAccessToken(e){throw new Xh("Not implemented")}}var Nw,Vw={exports:{}},Uw={exports:{}};Nw=Uw,function(e,t){Nw&&Nw.exports?Nw.exports=t():(e.dcodeIO=e.dcodeIO||{}).Long=t()}(Ep,(function(){function e(e,t,i){this.low=0|e,this.high=0|t,this.unsigned=!!i}function t(e){return!0===(e&&e.__isLong__)}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),e.isLong=t;var i={},r={};function n(e,t){var n,a,s;return t?(s=0<=(e>>>=0)&&e<256)&&(a=r[e])?a:(n=o(e,(0|e)<0?-1:0,!0),s&&(r[e]=n),n):(s=-128<=(e|=0)&&e<128)&&(a=i[e])?a:(n=o(e,e<0?-1:0,!1),s&&(i[e]=n),n)}function a(e,t){if(isNaN(e)||!isFinite(e))return t?m:f;if(t){if(e<0)return m;if(e>=h)return x}else{if(e<=-p)return b;if(e+1>=p)return v}return e<0?a(-e,t).neg():o(e%u|0,e/u|0,t)}function o(t,i,r){return new e(t,i,r)}e.fromInt=n,e.fromNumber=a,e.fromBits=o;var s=Math.pow;function l(e,t,i){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return f;if("number"===typeof t?(i=t,t=!1):t=!!t,(i=i||10)<2||36<i)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return l(e.substring(1),t,i).neg();for(var n=a(s(i,8)),o=f,c=0;c<e.length;c+=8){var u=Math.min(8,e.length-c),h=parseInt(e.substring(c,c+u),i);if(u<8){var p=a(s(i,u));o=o.mul(p).add(a(h))}else o=(o=o.mul(n)).add(a(h))}return o.unsigned=t,o}function c(t){return t instanceof e?t:"number"===typeof t?a(t):"string"===typeof t?l(t):o(t.low,t.high,t.unsigned)}e.fromString=l,e.fromValue=c;var u=4294967296,h=u*u,p=h/2,d=n(1<<24),f=n(0);e.ZERO=f;var m=n(0,!0);e.UZERO=m;var g=n(1);e.ONE=g;var _=n(1,!0);e.UONE=_;var y=n(-1);e.NEG_ONE=y;var v=o(-1,2147483647,!1);e.MAX_VALUE=v;var x=o(-1,-1,!0);e.MAX_UNSIGNED_VALUE=x;var b=o(0,-2147483648,!1);e.MIN_VALUE=b;var w=e.prototype;return w.toInt=function(){return this.unsigned?this.low>>>0:this.low},w.toNumber=function(){return this.unsigned?(this.high>>>0)*u+(this.low>>>0):this.high*u+(this.low>>>0)},w.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(b)){var t=a(e),i=this.div(t),r=i.mul(t).sub(this);return i.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var n=a(s(e,6),this.unsigned),o=this,l="";;){var c=o.div(n),u=(o.sub(c.mul(n)).toInt()>>>0).toString(e);if((o=c).isZero())return u+l;for(;u.length<6;)u="0"+u;l=""+u+l}},w.getHighBits=function(){return this.high},w.getHighBitsUnsigned=function(){return this.high>>>0},w.getLowBits=function(){return this.low},w.getLowBitsUnsigned=function(){return this.low>>>0},w.getNumBitsAbs=function(){if(this.isNegative())return this.eq(b)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},w.isZero=function(){return 0===this.high&&0===this.low},w.isNegative=function(){return!this.unsigned&&this.high<0},w.isPositive=function(){return this.unsigned||this.high>=0},w.isOdd=function(){return 1===(1&this.low)},w.isEven=function(){return 0===(1&this.low)},w.equals=function(e){return t(e)||(e=c(e)),(this.unsigned===e.unsigned||this.high>>>31!==1||e.high>>>31!==1)&&this.high===e.high&&this.low===e.low},w.eq=w.equals,w.notEquals=function(e){return!this.eq(e)},w.neq=w.notEquals,w.lessThan=function(e){return this.comp(e)<0},w.lt=w.lessThan,w.lessThanOrEqual=function(e){return this.comp(e)<=0},w.lte=w.lessThanOrEqual,w.greaterThan=function(e){return this.comp(e)>0},w.gt=w.greaterThan,w.greaterThanOrEqual=function(e){return this.comp(e)>=0},w.gte=w.greaterThanOrEqual,w.compare=function(e){if(t(e)||(e=c(e)),this.eq(e))return 0;var i=this.isNegative(),r=e.isNegative();return i&&!r?-1:!i&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},w.comp=w.compare,w.negate=function(){return!this.unsigned&&this.eq(b)?b:this.not().add(g)},w.neg=w.negate,w.add=function(e){t(e)||(e=c(e));var i=this.high>>>16,r=65535&this.high,n=this.low>>>16,a=65535&this.low,s=e.high>>>16,l=65535&e.high,u=e.low>>>16,h=0,p=0,d=0,f=0;return d+=(f+=a+(65535&e.low))>>>16,p+=(d+=n+u)>>>16,h+=(p+=r+l)>>>16,h+=i+s,o((d&=65535)<<16|(f&=65535),(h&=65535)<<16|(p&=65535),this.unsigned)},w.subtract=function(e){return t(e)||(e=c(e)),this.add(e.neg())},w.sub=w.subtract,w.multiply=function(e){if(this.isZero())return f;if(t(e)||(e=c(e)),e.isZero())return f;if(this.eq(b))return e.isOdd()?b:f;if(e.eq(b))return this.isOdd()?b:f;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(d)&&e.lt(d))return a(this.toNumber()*e.toNumber(),this.unsigned);var i=this.high>>>16,r=65535&this.high,n=this.low>>>16,s=65535&this.low,l=e.high>>>16,u=65535&e.high,h=e.low>>>16,p=65535&e.low,m=0,g=0,_=0,y=0;return _+=(y+=s*p)>>>16,g+=(_+=n*p)>>>16,_&=65535,g+=(_+=s*h)>>>16,m+=(g+=r*p)>>>16,g&=65535,m+=(g+=n*h)>>>16,g&=65535,m+=(g+=s*u)>>>16,m+=i*p+r*h+n*u+s*l,o((_&=65535)<<16|(y&=65535),(m&=65535)<<16|(g&=65535),this.unsigned)},w.mul=w.multiply,w.divide=function(e){if(t(e)||(e=c(e)),e.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?m:f;var i,r,n;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return m;if(e.gt(this.shru(1)))return _;n=m}else{if(this.eq(b))return e.eq(g)||e.eq(y)?b:e.eq(b)?g:(i=this.shr(1).div(e).shl(1)).eq(f)?e.isNegative()?g:y:(r=this.sub(e.mul(i)),n=i.add(r.div(e)));if(e.eq(b))return this.unsigned?m:f;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();n=f}for(r=this;r.gte(e);){i=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(i)/Math.LN2),l=o<=48?1:s(2,o-48),u=a(i),h=u.mul(e);h.isNegative()||h.gt(r);)h=(u=a(i-=l,this.unsigned)).mul(e);u.isZero()&&(u=g),n=n.add(u),r=r.sub(h)}return n},w.div=w.divide,w.modulo=function(e){return t(e)||(e=c(e)),this.sub(this.div(e).mul(e))},w.mod=w.modulo,w.not=function(){return o(~this.low,~this.high,this.unsigned)},w.and=function(e){return t(e)||(e=c(e)),o(this.low&e.low,this.high&e.high,this.unsigned)},w.or=function(e){return t(e)||(e=c(e)),o(this.low|e.low,this.high|e.high,this.unsigned)},w.xor=function(e){return t(e)||(e=c(e)),o(this.low^e.low,this.high^e.high,this.unsigned)},w.shiftLeft=function(e){return t(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?o(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):o(0,this.low<<e-32,this.unsigned)},w.shl=w.shiftLeft,w.shiftRight=function(e){return t(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?o(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):o(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},w.shr=w.shiftRight,w.shiftRightUnsigned=function(e){if(t(e)&&(e=e.toInt()),0===(e&=63))return this;var i=this.high;return e<32?o(this.low>>>e|i<<32-e,i>>>e,this.unsigned):o(32===e?i:i>>>e-32,0,this.unsigned)},w.shru=w.shiftRightUnsigned,w.toSigned=function(){return this.unsigned?o(this.low,this.high,!1):this},w.toUnsigned=function(){return this.unsigned?this:o(this.low,this.high,!0)},w.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},w.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24&255,255&e,e>>>8&255,e>>>16&255,e>>>24&255]},w.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24&255,e>>>16&255,e>>>8&255,255&e,t>>>24&255,t>>>16&255,t>>>8&255,255&t]},e})),function(e){!function(e){var t=e.S2={L:{}};t.L.LatLng=function(e,t,i){var r=parseFloat(e,10),n=parseFloat(t,10);if(isNaN(r)||isNaN(n))throw new Error("Invalid LatLng object: ("+e+", "+t+")");return!0!==i&&(r=Math.max(Math.min(r,90),-90),n=(n+180)%360+(n<-180||180===n?180:-180)),{lat:r,lng:n}},t.L.LatLng.DEG_TO_RAD=Math.PI/180,t.L.LatLng.RAD_TO_DEG=180/Math.PI,t.LatLngToXYZ=function(e){var i=t.L.LatLng.DEG_TO_RAD,r=e.lat*i,n=e.lng*i,a=Math.cos(r);return[Math.cos(n)*a,Math.sin(n)*a,Math.sin(r)]},t.XYZToLatLng=function(e){var i=t.L.LatLng.RAD_TO_DEG,r=Math.atan2(e[2],Math.sqrt(e[0]*e[0]+e[1]*e[1])),n=Math.atan2(e[1],e[0]);return t.L.LatLng(r*i,n*i)};t.XYZToFaceUV=function(e){var t=function(e){var t=[Math.abs(e[0]),Math.abs(e[1]),Math.abs(e[2])];return t[0]>t[1]?t[0]>t[2]?0:2:t[1]>t[2]?1:2}(e);e[t]<0&&(t+=3);var i=function(e,t){var i,r;switch(e){case 0:i=t[1]/t[0],r=t[2]/t[0];break;case 1:i=-t[0]/t[1],r=t[2]/t[1];break;case 2:i=-t[0]/t[2],r=-t[1]/t[2];break;case 3:i=t[2]/t[0],r=t[1]/t[0];break;case 4:i=t[2]/t[1],r=-t[0]/t[1];break;case 5:i=-t[1]/t[2],r=-t[0]/t[2];break;default:throw{error:"Invalid face"}}return[i,r]}(t,e);return[t,i]},t.FaceUVToXYZ=function(e,t){var i=t[0],r=t[1];switch(e){case 0:return[1,i,r];case 1:return[-i,1,r];case 2:return[-i,-r,1];case 3:return[-1,-r,-i];case 4:return[r,-1,-i];case 5:return[r,i,-1];default:throw{error:"Invalid face"}}};var i=function(e){return e>=.5?1/3*(4*e*e-1):1/3*(1-4*(1-e)*(1-e))};t.STToUV=function(e){return[i(e[0]),i(e[1])]};var r=function(e){return e>=0?.5*Math.sqrt(1+3*e):1-.5*Math.sqrt(1-3*e)};t.UVToST=function(e){return[r(e[0]),r(e[1])]},t.STToIJ=function(e,t){var i=1<<t,r=function(e){var t=Math.floor(e*i);return Math.max(0,Math.min(i-1,t))};return[r(e[0]),r(e[1])]},t.IJToST=function(e,t,i){var r=1<<t;return[(e[0]+i[0])/r,(e[1]+i[1])/r]};var n=function(e,t,i,r){if(0==r){1==i&&(t.x=e-1-t.x,t.y=e-1-t.y);var n=t.x;t.x=t.y,t.y=n}},a=function(e,t,i,r){var n={a:[[0,"d"],[1,"a"],[3,"b"],[2,"a"]],b:[[2,"b"],[1,"b"],[3,"a"],[0,"c"]],c:[[2,"c"],[3,"d"],[1,"c"],[0,"b"]],d:[[0,"a"],[3,"c"],[1,"d"],[2,"d"]]};"number"!==typeof r&&console.warn(new Error("called pointToHilbertQuadList without face value, defaulting to '0'").stack);for(var a=r%2?"d":"a",o=[],s=i-1;s>=0;s--){var l=1<<s,c=n[a][2*(e&l?1:0)+(t&l?1:0)];o.push(c[0]),a=c[1]}return o};t.S2Cell=function(){},t.S2Cell.FromHilbertQuadKey=function(e){var i,r,a,o,s,l,c=e.split("/"),u=parseInt(c[0]),h=c[1],p=h.length,d={x:0,y:0};for(i=p-1;i>=0;i--)r=p-i,o=0,s=0,"1"===(a=h[i])?s=1:"2"===a?(o=1,s=1):"3"===a&&(o=1),l=Math.pow(2,r-1),n(l,d,o,s),d.x+=l*o,d.y+=l*s;if(u%2===1){var f=d.x;d.x=d.y,d.y=f}return t.S2Cell.FromFaceIJ(parseInt(u),[d.x,d.y],r)},t.S2Cell.FromLatLng=function(e,i){if(!e.lat&&0!==e.lat||!e.lng&&0!==e.lng)throw new Error("Pass { lat: lat, lng: lng } to S2.S2Cell.FromLatLng");var r=t.LatLngToXYZ(e),n=t.XYZToFaceUV(r),a=t.UVToST(n[1]),o=t.STToIJ(a,i);return t.S2Cell.FromFaceIJ(n[0],o,i)},t.S2Cell.FromFaceIJ=function(e,i,r){var n=new t.S2Cell;return n.face=e,n.ij=i,n.level=r,n},t.S2Cell.prototype.toString=function(){return"F"+this.face+"ij["+this.ij[0]+","+this.ij[1]+"]@"+this.level},t.S2Cell.prototype.getLatLng=function(){var e=t.IJToST(this.ij,this.level,[.5,.5]),i=t.STToUV(e),r=t.FaceUVToXYZ(this.face,i);return t.XYZToLatLng(r)},t.S2Cell.prototype.getCornerLatLngs=function(){for(var e=[],i=[[0,0],[0,1],[1,1],[1,0]],r=0;r<4;r++){var n=t.IJToST(this.ij,this.level,i[r]),a=t.STToUV(n),o=t.FaceUVToXYZ(this.face,a);e.push(t.XYZToLatLng(o))}return e},t.S2Cell.prototype.getFaceAndQuads=function(){var e=a(this.ij[0],this.ij[1],this.level,this.face);return[this.face,e]},t.S2Cell.prototype.toHilbertQuadkey=function(){var e=a(this.ij[0],this.ij[1],this.level,this.face);return this.face.toString(10)+"/"+e.join("")},t.latLngToNeighborKeys=t.S2Cell.latLngToNeighborKeys=function(e,i,r){return t.S2Cell.FromLatLng({lat:e,lng:i},r).getNeighbors().map((function(e){return e.toHilbertQuadkey()}))},t.S2Cell.prototype.getNeighbors=function(){var e=function(e,i,r){var n=1<<r;if(i[0]>=0&&i[1]>=0&&i[0]<n&&i[1]<n)return t.S2Cell.FromFaceIJ(e,i,r);var a=t.IJToST(i,r,[.5,.5]),o=t.STToUV(a),s=t.FaceUVToXYZ(e,o),l=t.XYZToFaceUV(s);return e=l[0],o=l[1],a=t.UVToST(o),i=t.STToIJ(a,r),t.S2Cell.FromFaceIJ(e,i,r)},i=this.face,r=this.ij[0],n=this.ij[1],a=this.level;return[e(i,[r-1,n],a),e(i,[r,n-1],a),e(i,[r+1,n],a),e(i,[r,n+1],a)]},t.FACE_BITS=3,t.MAX_LEVEL=30,t.POS_BITS=2*t.MAX_LEVEL+1,t.facePosLevelToId=t.S2Cell.facePosLevelToId=t.fromFacePosLevel=function(i,r,n){var a,o,s,l=e.dcodeIO&&e.dcodeIO.Long||Uw.exports;for(n||(n=r.length),r.length>n&&(r=r.substr(0,n)),a=l.fromString(i.toString(10),!0,10).toString(2);a.length<t.FACE_BITS;)a="0"+a;for(o=l.fromString(r,!0,4).toString(2);o.length<2*n;)o="0"+o;for(s=a+o,s+="1";s.length<t.FACE_BITS+t.POS_BITS;)s+="0";return l.fromString(s,!0,2).toString(10)},t.keyToId=t.S2Cell.keyToId=t.toId=t.toCellId=t.fromKey=function(e){var i=e.split("/");return t.fromFacePosLevel(i[0],i[1],i[1].length)},t.idToKey=t.S2Cell.idToKey=t.S2Cell.toKey=t.toKey=t.fromId=t.fromCellId=t.S2Cell.toHilbertQuadkey=t.toHilbertQuadkey=function(i){for(var r=e.dcodeIO&&e.dcodeIO.Long||Uw.exports,n=r.fromString(i,!0,10).toString(2);n.length<t.FACE_BITS+t.POS_BITS;)n="0"+n;for(var a=n.lastIndexOf("1"),o=n.substring(0,3),s=n.substring(3,a),l=s.length/2,c=r.fromString(o,!0,2).toString(10),u=r.fromString(s,!0,2).toString(4);u.length<l;)u="0"+u;return c+"/"+u},t.keyToLatLng=t.S2Cell.keyToLatLng=function(e){return t.S2Cell.FromHilbertQuadKey(e).getLatLng()},t.idToLatLng=t.S2Cell.idToLatLng=function(e){var i=t.idToKey(e);return t.keyToLatLng(i)},t.S2Cell.latLngToKey=t.latLngToKey=t.latLngToQuadkey=function(e,i,r){if(isNaN(r)||r<1||r>30)throw new Error("'level' is not a number between 1 and 30 (but it should be)");return t.S2Cell.FromLatLng({lat:e,lng:i},r).toHilbertQuadkey()},t.stepKey=function(t,i){var r,n=e.dcodeIO&&e.dcodeIO.Long||Uw.exports,a=t.split("/"),o=a[0],s=a[1],l=a[1].length,c=n.fromString(s,!0,4);i>0?r=c.add(Math.abs(i)):i<0&&(r=c.subtract(Math.abs(i)));var u=r.toString(4);for("0"===u&&console.warning(new Error("face/position wrapping is not yet supported"));u.length<l;)u="0"+u;return o+"/"+u},t.S2Cell.prevKey=t.prevKey=function(e){return t.stepKey(e,-1)},t.S2Cell.nextKey=t.nextKey=function(e){return t.stepKey(e,1)}}(e.exports)}(Vw);class $w extends class{constructor(){}bboxToCellIds(e,t){throw new Xh("Not implemented")}getAdjacent(e){throw new Xh("Not implemented")}getVertices(e){throw new Xh("Not implemented")}lngLatToCellId(e){throw new Xh("Not implemented")}_approxBboxToCellIds(e,t){if(t.lat<=e.lat||t.lng<=e.lng)throw new Xh("North east needs to be top right of south west");const i=(e.lat+t.lat)/2,r=(e.lng+t.lng)/2,n=Oh(t.lng,t.lat,0,r,i,0),a=Math.max(n[0],n[1]);return this._lngLatToCellIds({lat:i,lng:r},a)}_enuToGeodetic(e,t){const[i,r]=Nh(e[0],e[1],e[2],t.lng,t.lat,0);return{lat:r,lng:i}}_getLngLatBoundingBoxCorners(e,t){return[[-t,t,0],[t,t,0],[t,-t,0],[-t,-t,0]].map((t=>this._enuToGeodetic(t,e)))}_lngLatToCellIds(e,t){const i=this.lngLatToCellId(e),r=this._getLngLatBoundingBoxCorners(e,t);for(const n of r){if(this.lngLatToCellId(n)!==i)return[i,...this.getAdjacent(i)]}return[i]}}{constructor(e=17){super(),this._level=e}bboxToCellIds(e,t){return this._approxBboxToCellIds(e,t)}getAdjacent(e){const t=Vw.exports.S2.idToKey(e),i=t.split("/")[1].length,[r,n,a,o]=this._getNeighbors(t,i),s=[t,r,n,a,o],l=Array.from(new Set([...this._getNeighbors(r,i),...this._getNeighbors(n,i),...this._getNeighbors(a,i),...this._getNeighbors(o,i)].filter((e=>!s.includes(e))))),c=[r,n,a,o];for(const u of l){let e=0;for(const t of this._getNeighbors(u,i))s.includes(t)&&e++;2===e&&c.push(u)}return c.map((e=>Vw.exports.S2.keyToId(e)))}getVertices(e){const t=Vw.exports.S2.idToKey(e);return Vw.exports.S2.S2Cell.FromHilbertQuadKey(t).getCornerLatLngs().map((e=>({lat:e.lat,lng:e.lng})))}lngLatToCellId(e){return this._lngLatToId(e,this._level)}_getNeighbors(e,t){const i=Vw.exports.S2.keyToLatLng(e);return Vw.exports.S2.latLngToNeighborKeys(i.lat,i.lng,t)}_lngLatToId(e,t){const i=Vw.exports.S2.latLngToKey(e.lat,e.lng,t);return Vw.exports.S2.keyToId(i)}}class jw{clusterReconstruction(e){const t=e.points,i=1/255;for(const n in t){if(!t.hasOwnProperty(n))continue;const e=t[n].color;e[0]*=i,e[1]*=i,e[2]*=i}const r=e.reference_lla;return{id:null,points:t,reference:{alt:r.altitude,lat:r.latitude,lng:r.longitude}}}coreImage(e){const t=this._geometry(e.geometry),i=this._geometry(e.computed_geometry),r={id:e.sequence};return{computed_geometry:i,geometry:t,id:e.id,sequence:r}}spatialImage(e){var t,i,r,n;e.camera_type=function(e){switch(e){case"equirectangular":case"spherical":return"spherical";case"fisheye":return"fisheye";default:return"perspective"}}(e.camera_type),e.merge_id=e.merge_cc?e.merge_cc.toString():null,e.private=null;const a="spherical"===e.camera_type?e.thumb_2048_url:e.thumb_1024_url;return e.thumb=null!==(t=e.thumb)&&void 0!==t?t:{id:null,url:a},e.cluster=null!==(i=e.sfm_cluster)&&void 0!==i?i:{id:null,url:null},e.creator={id:null,username:null},e.owner=null!==(r=e.owner)&&void 0!==r?r:{id:null},e.mesh=null!==(n=e.mesh)&&void 0!==n?n:{id:null,url:null},e}_geometry(e){const t=null===e||void 0===e?void 0:e.coordinates;return t?{lat:t[1],lng:t[0]}:null}}class qw{constructor(){this.imagesPath="images",this.sequencePath="image_ids",this._imageTilesPath="tiles",this.coreFields=["computed_geometry","geometry","sequence"],this.idFields=["id"],this.spatialFields=["altitude","atomic_scale","camera_parameters","camera_type","captured_at","compass_angle","computed_altitude","computed_compass_angle","computed_rotation","exif_orientation","height","merge_cc","mesh","quality_score","sfm_cluster","thumb_1024_url","thumb_2048_url","width"],this.imageTileFields=["url","z","x","y"]}images(e,t){return`image_ids=${e.join(",")}&fields=${t.join(",")}`}imagesS2(e,t){return`s2=${e}&fields=${t.join(",")}`}imageTiles(e,t){return`z=${e}&fields=${t.join(",")}`}imageTilesPath(e){return`${e}/${this._imageTilesPath}`}sequence(e){return`sequence_id=${e}`}}class Gw extends Ow{constructor(e,t,i,r){var n;super(null!==t&&void 0!==t?t:new $w),this._convert=null!==i&&void 0!==i?i:new jw,this._query=null!==r&&void 0!==r?r:new qw,this._method="GET";const a=null!==e&&void 0!==e?e:{};this._endpoint=null!==(n=a.endpoint)&&void 0!==n?n:"https://graph.mapillary.com",this._accessToken=a.accessToken}getCluster(e,t){return Dw(e,t).then((e=>{const t=function(e){const t=pw(e,{to:"string"});return JSON.parse(t)}(e);if(t.length<1)throw new Error("Cluster reconstruction empty");return this._convert.clusterReconstruction(t[0])}))}getCoreImages(e){const t=[...this._query.idFields,...this._query.coreFields],i=this._query.imagesS2(e,t),r=new URL(this._query.imagesPath,this._endpoint).href;return this._fetchGraphContract(i,r).then((t=>{const i={cell_id:e,images:[]},r=t.data;for(const e of r){const t=this._convert.coreImage(e);i.images.push(t)}return i}))}getImageBuffer(e,t){return Dw(e,t)}getImages(e){const t=[...this._query.idFields,...this._query.coreFields,...this._query.spatialFields],i=this._query.images(e,t),r=new URL(this._query.imagesPath,this._endpoint).href;return this._fetchGraphContract(i,r).then((e=>{const t=[],i=e.data;for(const r of i){const e=this._convert.coreImage(r),i=this._convert.spatialImage(r),n={node:Object.assign({},i,e),node_id:r.id};t.push(n)}return t}))}getImageTiles(e){const t=[...this._query.imageTileFields],i=this._query.imageTiles(e.z,t),r=new URL(this._query.imageTilesPath(e.imageId),this._endpoint).href;return this._fetchGraphContract(i,r).then((t=>({node:t.data,node_id:e.imageId})))}getMesh(e,t){return Dw(e,t).then((e=>function(e){return new fw(e).readFields(Fw,{faces:[],vertices:[]})}(e)))}getSequence(e){const t=this._query.sequence(e),i=new URL(this._query.sequencePath,this._endpoint).href;return this._fetchGraphContract(t,i).then((t=>({id:e,image_ids:t.data.map((e=>e.id))})))}getSpatialImages(e){const t=[...this._query.idFields,...this._query.coreFields,...this._query.spatialFields],i=this._query.images(e,t),r=new URL(this._query.imagesPath,this._endpoint).href;return this._fetchGraphContract(i,r).then((e=>{const t=[],i=e.data;for(const r of i){const e={node:this._convert.spatialImage(r),node_id:r.id};t.push(e)}return t}))}setAccessToken(e){this._accessToken=e}_createHeaders(){const e=[{name:"Accept",value:"application/json"},{name:"Content-Type",value:"application/x-www-form-urlencoded"}];return this._accessToken&&e.push({name:"Authorization",value:`OAuth ${this._accessToken}`}),e}_fetchGraphContract(e,t){return Bw(`${t}?${e}`,this._method,"json",this._createHeaders(),null,null).catch((e=>{const t=this._makeErrorMessage(e);throw new Xh(t)}))}_makeErrorMessage(e){const t=e.error;return t?`${t.code} (${t.type}, ${t.fbtrace_id}): ${t.message}`:"Failed to fetch data"}}class Hw{constructor(e,t){this._id=e,this._lngLat=t}get id(){return this._id}get geometry(){return this._geometry}get lngLat(){return this._lngLat}createGeometry(e){this._geometry||(this._createGeometry(e),this._geometry.updateMatrixWorld(!0))}disposeGeometry(){this._geometry&&(this._disposeGeometry(),this._geometry=void 0)}getInteractiveObjects(){return this._geometry?this._getInteractiveObjects():[]}lerpAltitude(e,t){this._geometry&&(this._geometry.position.z=(1-t)*this._geometry.position.z+t*e)}updatePosition(e,t){t&&(this._lngLat.lat=t.lat,this._lngLat.lng=t.lng),this._geometry&&(this._geometry.position.fromArray(e),this._geometry.updateMatrixWorld(!0))}}class Ww extends Hw{constructor(e,t,i){super(e,t),i=i||{},this._ballColor=null!=i.ballColor?i.ballColor:16711680,this._ballOpacity=null!=i.ballOpacity?i.ballOpacity:.8,this._circleToRayAngle=2,this._color=null!=i.color?i.color:16711680,this._interactive=!!i.interactive,this._opacity=null!=i.opacity?i.opacity:.4,this._radius=null!=i.radius?i.radius:1}_createGeometry(e){const t=this._radius,i=this._markerHeight(t),r=new qn({color:this._color,opacity:this._opacity,transparent:!0,depthWrite:!1}),n=new wa(this._createMarkerGeometry(t,8,8),r),a=new wa(new Mu(t/2,8,8),new qn({color:this._ballColor,opacity:this._ballOpacity,transparent:!0}));a.position.z=i,a.renderOrder=1;const o=new Sn;o.add(a),o.add(n),o.position.fromArray(e),this._geometry=o}_disposeGeometry(){for(const e of this._geometry.children)e.geometry.dispose(),e.material.dispose()}_getInteractiveObjects(){return this._interactive?[this._geometry.children[0]]:[]}_markerHeight(e){const t=Math.tan(Math.PI-this._circleToRayAngle);return e*Math.sqrt(1+t*t)}_createMarkerGeometry(e,t,i){const r=this._markerHeight(e),n=this._circleToRayAngle,a=[],o=new Float32Array(3*(t+1)*(i+1));let s=0;for(let p=0;p<=i;++p){const l=[];for(let a=0;a<=t;++a){const c=a/t*Math.PI*2,u=p/i*Math.PI;let h=e;if(u>n){const t=Math.tan(u-n);h=e*Math.sqrt(1+t*t)}const d=3*s,f=Math.sin(u);o[d+0]=h*Math.cos(c)*f,o[d+1]=h*Math.sin(c)*f,o[d+2]=h*Math.cos(u)+r,l.push(s++)}a.push(l)}const l=new Uint16Array(6*t*i);let c=0;for(let p=0;p<i;++p)for(let e=0;e<t;++e){const t=a[p][e+1],i=a[p][e],r=a[p+1][e],n=a[p+1][e+1];l[c++]=t,l[c++]=i,l[c++]=n,l[c++]=i,l[c++]=r,l[c++]=n}const u=new na,h=new Wn(o,3);return u.setAttribute("position",h),u.setIndex(new Wn(l,1)),u}}var Zw,Xw,Yw,Kw;!function(e){e[e.Custom=0]="Custom",e[e.Earth=1]="Earth",e[e.Street=2]="Street"}(Zw||(Zw={})),function(e){e[e.Letterbox=0]="Letterbox",e[e.Fill=1]="Fill"}(Xw||(Xw={})),function(e){e[e.Opaque=0]="Opaque"}(Yw||(Yw={})),function(e){e[e.Default=0]="Default",e[e.Instantaneous=1]="Instantaneous"}(Kw||(Kw={}));class Jw{constructor(e,t,i,r,n,a){this._container=e,this._observer=i,this._navigator=t,this._options=null!=n?n:{},this._key=r,this._navigable=null==r,this._componentService=a||new Tp(this._container,this._navigator),this._coverComponent=this._componentService.getCover(),this._initializeComponents(),r?(this._initilizeCoverComponent(),this._subscribeCoverComponent()):this._navigator.movedToId$.pipe(Ht((e=>null!=e))).subscribe((e=>{this._key=e,this._componentService.deactivateCover(),this._coverComponent.configure({id:this._key,state:bm.Hidden}),this._subscribeCoverComponent(),this._navigator.stateService.start(),this._navigator.cacheService.start(),this._navigator.panService.start(),this._observer.startEmit()}))}get navigable(){return this._navigable}get(e){return this._componentService.get(e)}activate(e){this._componentService.activate(e)}activateCover(){this._coverComponent.configure({state:bm.Visible})}deactivate(e){this._componentService.deactivate(e)}deactivateCover(){this._coverComponent.configure({state:bm.Loading})}remove(){this._componentService.remove(),null!=this._configurationSubscription&&this._configurationSubscription.unsubscribe()}_initializeComponents(){var e,t;const i=this._options;this._uFalse(null===(e=i.fallback)||void 0===e?void 0:e.image,"imagefallback"),this._uFalse(null===(t=i.fallback)||void 0===t?void 0:t.navigation,"navigationfallback"),this._uFalse(i.marker,"marker"),this._uFalse(i.popup,"popup"),this._uFalse(i.slider,"slider"),this._uFalse(i.spatial,"spatial"),this._uFalse(i.tag,"tag"),this._uTrue(i.attribution,"attribution"),this._uTrue(i.bearing,"bearing"),this._uTrue(i.cache,"cache"),this._uTrue(i.direction,"direction"),this._uTrue(i.image,"image"),this._uTrue(i.keyboard,"keyboard"),this._uTrue(i.pointer,"pointer"),this._uTrue(i.sequence,"sequence"),this._uTrue(i.zoom,"zoom")}_initilizeCoverComponent(){let e=this._options;this._coverComponent.configure({id:this._key}),void 0===e.cover||e.cover?this.activateCover():this.deactivateCover()}_setNavigable(e){this._navigable!==e&&(this._navigable=e,this._observer.navigable$.next(e))}_subscribeCoverComponent(){this._configurationSubscription=this._coverComponent.configuration$.pipe(Vt(void 0,(e=>e.state))).subscribe((e=>{e.state===bm.Loading?this._navigator.stateService.currentId$.pipe(Ht(),oi((t=>{const i=null==t||t!==e.id;return i&&this._setNavigable(!1),i?this._navigator.moveTo$(e.id):this._navigator.stateService.currentImage$.pipe(Ht())}))).subscribe((()=>{this._navigator.stateService.start(),this._navigator.cacheService.start(),this._navigator.panService.start(),this._observer.startEmit(),this._coverComponent.configure({state:bm.Hidden}),this._componentService.deactivateCover(),this._setNavigable(!0)}),(e=>{console.error("Failed to deactivate cover.",e),this._coverComponent.configure({state:bm.Visible})})):e.state===bm.Visible&&(this._observer.stopEmit(),this._navigator.stateService.stop(),this._navigator.cacheService.stop(),this._navigator.playService.stop(),this._navigator.panService.stop(),this._componentService.activateCover(),this._setNavigable(null==e.id))}))}_uFalse(e,t){void 0!==e?"boolean"!==typeof e?(this._componentService.configure(t,e),this._componentService.activate(t)):e?this._componentService.activate(t):this._componentService.deactivate(t):this._componentService.deactivate(t)}_uTrue(e,t){void 0!==e?"boolean"!==typeof e?(this._componentService.configure(t,e),this._componentService.activate(t)):e?this._componentService.activate(t):this._componentService.deactivate(t):this._componentService.activate(t)}}class Qw{constructor(e,t,i){this._adaptiveOperation$=new he,this._render$=new he,this._renderAdaptive$=new he,this._subscriptions=new Tm,this._renderService=t,this._currentFrame$=i;const r=this._subscriptions,n=Sm.create(Sm.h("div.mapillary-dom-renderer",[]));e.appendChild(n),this._offset$=this._adaptiveOperation$.pipe(ei(((e,t)=>t(e)),{elementHeight:e.offsetHeight,elementWidth:e.offsetWidth,imageAspect:0,renderMode:Xw.Fill}),Ct((e=>e.imageAspect>0&&e.elementWidth>0&&e.elementHeight>0)),tt((e=>{const t=e.elementWidth/e.elementHeight,i=e.imageAspect/t;let r=0,n=0;return e.renderMode===Xw.Letterbox?e.imageAspect>t?r=e.elementHeight*(1-1/i)/2:n=e.elementWidth*(1-i)/2:e.imageAspect>t?n=-e.elementWidth*(i-1)/2:r=-e.elementHeight*(1/i-1)/2,{bottom:r,left:n,right:n,top:r}})));const a=this._currentFrame$.pipe(Ct((e=>null!=e.state.currentImage)),Vt(((e,t)=>e===t),(e=>e.state.currentImage.id)),tt((e=>e.state.currentTransform.basicAspect)),tt((e=>t=>(t.imageAspect=e,t)))).subscribe(this._adaptiveOperation$),o=ut(this._renderAdaptive$.pipe(ei(((e,t)=>(null==t.vNode?delete e[t.name]:e[t.name]=t.vNode,e)),{})),this._offset$).pipe(tt((e=>{const t=[],i=e[0];for(const a in i)i.hasOwnProperty(a)&&t.push(i[a]);const r=e[1],n={style:{bottom:r.bottom+"px",left:r.left+"px","pointer-events":"none",position:"absolute",right:r.right+"px",top:r.top+"px"}};return{name:"mapillary-dom-adaptive-renderer",vNode:Sm.h("div.mapillary-dom-adaptive-renderer",n,t)}}))).subscribe(this._render$);this._vNode$=this._render$.pipe(ei(((e,t)=>(null==t.vNode?delete e[t.name]:e[t.name]=t.vNode,e)),{}),tt((e=>{const t=[];for(const i in e)e.hasOwnProperty(i)&&t.push(e[i]);return Sm.h("div.mapillary-dom-renderer",t)}))),this._vPatch$=this._vNode$.pipe(ei(((e,t)=>(e.vpatch=Sm.diff(e.vNode,t),e.vNode=t,e)),{vNode:Sm.h("div.mapillary-dom-renderer",[]),vpatch:null}),function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=e.length;if(0===i)throw new Error("list of properties cannot be empty.");return tt((function(t){for(var r=t,n=0;n<i;n++){var a=null===r||void 0===r?void 0:r[e[n]];if("undefined"===typeof a)return;r=a}return r}))}("vpatch")),this._element$=this._vPatch$.pipe(ei(((e,t)=>Sm.patch(e,t)),n),Jt(1),le()),r.push(a),r.push(o),r.push(this._element$.subscribe((()=>{}))),r.push(this._renderService.size$.pipe(tt((e=>t=>(t.elementWidth=e.width,t.elementHeight=e.height,t)))).subscribe(this._adaptiveOperation$)),r.push(this._renderService.renderMode$.pipe(tt((e=>t=>(t.renderMode=e,t)))).subscribe(this._adaptiveOperation$))}get element$(){return this._element$}get render$(){return this._render$}get renderAdaptive$(){return this._renderAdaptive$}clear(e){this._renderAdaptive$.next({name:e,vNode:null}),this._render$.next({name:e,vNode:null})}remove(){this._subscriptions.unsubscribe()}}class eS{constructor(e,t,i){this._renderFrame$=new he,this._renderCameraOperation$=new he,this._render$=new he,this._clear$=new he,this._renderOperation$=new he,this._rendererOperation$=new he,this._eraserOperation$=new he,this._triggerOperation$=new he,this._subscriptions=new Tm,this._opaqueRender$=new he,this._renderService=i;const r=this._subscriptions;this._renderer$=this._rendererOperation$.pipe(ei(((e,t)=>t(e)),{needsRender:!1,renderer:null}),Ct((e=>!!e.renderer))),this._renderCollection$=this._renderOperation$.pipe(ei(((e,t)=>t(e)),{}),ti()),this._renderCamera$=this._renderCameraOperation$.pipe(ei(((e,t)=>t(e)),{frameId:-1,needsRender:!1,perspective:null})),this._eraser$=this._eraserOperation$.pipe(ai((e=>e)),ei(((e,t)=>t(e)),{needsRender:!1}));const n=this._triggerOperation$.pipe(ai((e=>e)),ei(((e,t)=>t(e)),{needsRender:!1})),a=new jn(986895),o=ut(this._renderer$,this._renderCollection$,this._renderCamera$,this._eraser$,n).pipe(tt((([e,t,i,r,n])=>({camera:i,eraser:r,trigger:n,renderer:e,renders:Object.keys(t).map((e=>t[e]))}))),Ct((e=>{let t=e.renderer.needsRender||e.camera.needsRender||e.eraser.needsRender||e.trigger.needsRender;const i=e.camera.frameId;for(const r of e.renders){if(r.frameId!==i)return!1;t=t||r.needsRender}return t})),Vt(((e,t)=>e===t),(e=>e.eraser.needsRender||e.trigger.needsRender?-e.camera.frameId:e.camera.frameId))).subscribe((e=>{e.renderer.needsRender=!1,e.camera.needsRender=!1,e.eraser.needsRender=!1,e.trigger.needsRender=!1;const t=e.camera.perspective,i=[],r=[];for(const a of e.renders)a.pass===Vm.Background?i.push(a.render):a.pass===Vm.Opaque&&r.push(a.render);const n=e.renderer.renderer;n.resetState(),n.setClearColor(a,1),n.clear();for(const a of i)a(t,n);n.clearDepth();for(const a of r)a(t,n);n.resetState(),this._opaqueRender$.next()}));r.push(o),r.push(this._renderFrame$.pipe(tt((e=>t=>(t.frameId=e.frameId,t.perspective=e.perspective,!0===e.changed&&(t.needsRender=!0),t)))).subscribe(this._renderCameraOperation$)),this._renderFrameSubscribe();const s=this._render$.pipe(tt((e=>t=>(t[e.name]=e.renderer,t)))),l=this._clear$.pipe(tt((e=>t=>(delete t[e],t))));r.push(Mt(s,l).subscribe(this._renderOperation$)),this._webGLRenderer$=this._render$.pipe(Ht(),tt((()=>{t.appendChild(e);const r=i.element,n=new Pl({canvas:e});return n.setPixelRatio(window.devicePixelRatio),n.setSize(r.offsetWidth,r.offsetHeight),n.autoClear=!1,n})),Jt(1),le()),r.push(this._webGLRenderer$.subscribe((()=>{})));const c=this._webGLRenderer$.pipe(Ht(),tt((e=>t=>(t.needsRender=!0,t.renderer=e,t)))),u=this._renderService.size$.pipe(tt((e=>t=>(null==t.renderer||(t.renderer.setSize(e.width,e.height),t.needsRender=!0),t)))),h=this._clear$.pipe(tt((()=>e=>(null==e.renderer||(e.needsRender=!0),e))));r.push(Mt(c,u,h).subscribe(this._rendererOperation$));const p=this._renderCollection$.pipe(Ct((e=>0===Object.keys(e).length)),ti());r.push(p.subscribe((()=>{null!=this._renderFrameSubscription&&(this._renderFrameSubscription.unsubscribe(),this._renderFrameSubscription=null,this._renderFrameSubscribe())}))),r.push(p.pipe(tt((()=>e=>(e.needsRender=!0,e)))).subscribe(this._eraserOperation$))}get render$(){return this._render$}get opaqueRender$(){return this._opaqueRender$}get webGLRenderer$(){return this._webGLRenderer$}clear(e){this._clear$.next(e)}remove(){this._rendererOperation$.next((e=>{if(null!=e.renderer){const t=e.renderer.getContext().getExtension("WEBGL_lose_context");t&&t.loseContext(),e.renderer=null}return e})),null!=this._renderFrameSubscription&&this._renderFrameSubscription.unsubscribe(),this._subscriptions.unsubscribe()}triggerRerender(){this._renderService.renderCameraFrame$.pipe(ri(1),Ht()).subscribe((()=>{this._triggerOperation$.next((e=>(e.needsRender=!0,e)))}))}_renderFrameSubscribe(){this._render$.pipe(Ht(),tt((()=>e=>(e.needsRender=!0,e)))).subscribe((e=>{this._renderCameraOperation$.next(e)})),this._renderFrameSubscription=this._render$.pipe(Ht(),ft((()=>this._renderService.renderCameraFrame$))).subscribe(this._renderFrame$)}}class tS{constructor(e){null!=e?(this._position=(new xr).fromArray(e.unprojectSfM([0,0],0)),this._lookat=(new xr).fromArray(e.unprojectSfM([0,0],10)),this._up=e.upVector(),this._focal=this._getFocal(e)):(this._position=new xr(0,0,0),this._lookat=new xr(1,0,0),this._up=new xr(0,0,1),this._focal=1)}get position(){return this._position}get lookat(){return this._lookat}get up(){return this._up}get focal(){return this._focal}set focal(e){this._focal=e}lerpCameras(e,t,i){this._position.subVectors(t.position,e.position).multiplyScalar(i).add(e.position),this._lookat.subVectors(t.lookat,e.lookat).multiplyScalar(i).add(e.lookat),this._up.subVectors(t.up,e.up).multiplyScalar(i).add(e.up),this._focal=(1-i)*e.focal+i*t.focal}copy(e){this._position.copy(e.position),this._lookat.copy(e.lookat),this._up.copy(e.up),this._focal=e.focal}clone(){let e=new tS;return e.position.copy(this._position),e.lookat.copy(this._lookat),e.up.copy(this._up),e.focal=this._focal,e}diff(e){let t=this._position.distanceToSquared(e.position),i=this._lookat.distanceToSquared(e.lookat),r=this._up.distanceToSquared(e.up),n=100*Math.abs(this._focal-e.focal);return Math.max(t,i,r,n)}_getFocal(e){return Qh(e.cameraType)?.5/Math.tan(Math.PI/2):e.focal}}class iS{constructor(e,t,i){this._spatial=new Kh,this._viewportCoords=new Im,this._size={width:e,height:t},this._initialFov=60,this._alpha=-1,this._stateTransitionAlpha=-1,this._stateTransitionFov=-1,this._renderMode=i,this._zoom=0,this._frameId=-1,this._changed=!1,this._changedForFrame=-1,this._currentImageId=null,this._previousImageId=null,this._currentSpherical=!1,this._previousSpherical=!1,this._state=null,this._currentProjectedPoints=[],this._previousProjectedPoints=[],this._currentFov=this._initialFov,this._previousFov=this._initialFov,this._camera=new tS,this._perspective=new Pa(this._initialFov,this._computeAspect(e,t),.1,1e4),this._perspective.position.copy(this._camera.position),this._perspective.up.copy(this._camera.up),this._perspective.lookAt(this._camera.lookat),this._perspective.updateMatrixWorld(!0),this._perspective.matrixAutoUpdate=!1,this._rotation={phi:0,theta:0}}get alpha(){return this._alpha}get camera(){return this._camera}get changed(){return this._frameId===this._changedForFrame}get frameId(){return this._frameId}get perspective(){return this._perspective}get renderMode(){return this._renderMode}get rotation(){return this._rotation}get zoom(){return this._zoom}get size(){return this._size}getTilt(){return 90-this._spatial.radToDeg(this._rotation.theta)}fovToZoom(e){e=Math.min(90,Math.max(0,e));const t=this._computeCurrentFov(0),i=1===this._alpha?t:this._interpolateFov(t,this._computePreviousFov(0),this._alpha),r=Math.tan(i/2*Math.PI/180),n=Math.tan(e/2*Math.PI/180);return Math.log(r/n)/Math.log(2)}setFrame(e){const t=e.state;if(t.state!==this._state){if(this._state=t.state,this._state!==eg.Custom&&(this.setRenderMode(this._renderMode),this.setSize(this._size)),this._state===eg.Earth){const e=this._fovToY(this._perspective.fov,this._zoom);this._stateTransitionFov=this._yToFov(e,0)}this._changed=!0}const i=t.currentImage.id,r=t.previousImage?t.previousImage.id:null;i!==this._currentImageId&&(this._currentImageId=i,this._currentSpherical=Qh(t.currentTransform.cameraType),this._currentProjectedPoints=this._computeProjectedPoints(t.currentTransform),this._changed=!0),r!==this._previousImageId&&(this._previousImageId=r,this._previousSpherical=Qh(t.previousTransform.cameraType),this._previousProjectedPoints=this._computeProjectedPoints(t.previousTransform),this._changed=!0);const n=t.zoom;n!==this._zoom&&(this._changed=!0),this._changed&&(this._currentFov=this._computeCurrentFov(n),this._previousFov=this._computePreviousFov(n));const a=t.alpha,o=t.stateTransitionAlpha;if(this._changed||a!==this._alpha||o!==this._stateTransitionAlpha){switch(this._alpha=a,this._stateTransitionAlpha=o,this._state){case eg.Earth:{const e=this._stateTransitionFov,i=this._focalToFov(t.camera.focal),r=ar.lerp(e,i,o),a=this._fovToY(r,0);this._perspective.fov=this._yToFov(a,n);break}case eg.Custom:break;default:this._perspective.fov=this._interpolateFov(this._currentFov,this._previousFov,this._alpha),this._changed=!0}this._zoom=n,this._state!==eg.Custom&&this._perspective.updateProjectionMatrix()}const s=t.camera;this._camera.diff(s)>1e-9&&(this._camera.copy(s),this._rotation=this._computeRotation(s),this._perspective.up.copy(s.up),this._perspective.position.copy(s.position),this._perspective.matrixAutoUpdate=!0,this._perspective.lookAt(s.lookat),this._perspective.matrixAutoUpdate=!1,this._perspective.updateMatrix(),this._perspective.updateMatrixWorld(!1),this._changed=!0),this._setFrameId(e.id)}setProjectionMatrix(e){this._perspective.fov=this._focalToFov(e[5]/2),this._perspective.projectionMatrix.fromArray(e),this._perspective.projectionMatrixInverse.copy(this._perspective.projectionMatrix).invert(),this._changed=!0}setRenderMode(e){this._renderMode=e,this._state!==eg.Custom&&(this._perspective.fov=this._computeFov(),this._perspective.updateProjectionMatrix(),this._changed=!0)}setSize(e){this._size=e,this._state!==eg.Custom&&(this._perspective.aspect=this._computeAspect(e.width,e.height),this._perspective.fov=this._computeFov(),this._perspective.updateProjectionMatrix(),this._changed=!0)}_computeAspect(e,t){return 0===e?0:e/t}_computeCurrentFov(e){return 0===this._perspective.aspect?0:this._currentImageId?this._currentSpherical?this._yToFov(1,e):this._computeVerticalFov(this._currentProjectedPoints,this._renderMode,e,this.perspective.aspect):this._initialFov}_computeFov(){return this._currentFov=this._computeCurrentFov(this._zoom),this._previousFov=this._computePreviousFov(this._zoom),this._interpolateFov(this._currentFov,this._previousFov,this._alpha)}_computePreviousFov(e){return 0===this._perspective.aspect?0:this._currentImageId?this._previousImageId?this._previousSpherical?this._yToFov(1,e):this._computeVerticalFov(this._previousProjectedPoints,this._renderMode,e,this.perspective.aspect):this._currentFov:this._initialFov}_computeProjectedPoints(e){return ip(e,[[.5,0],[1,0]],[[.5,0],[0,.5]],100,this._viewportCoords)}_computeRequiredVerticalFov(e,t,i){const r=Math.max(e[0]/i,e[1]);return this._yToFov(r,t)}_computeRotation(e){let t=e.lookat.clone().sub(e.position),i=e.up.clone();return{phi:this._spatial.azimuthal(t.toArray(),i.toArray()),theta:Math.PI/2-this._spatial.angleToPlane(t.toArray(),[0,0,1])}}_computeVerticalFov(e,t,i,r){const n=e.map((e=>this._computeRequiredVerticalFov(e,i,r)));return t===Xw.Fill?.995*Math.min(...n):Math.max(...n)}_yToFov(e,t){return 2*Math.atan(e/Math.pow(2,t))*180/Math.PI}_focalToFov(e){return 2*Math.atan2(1,2*e)*180/Math.PI}_fovToY(e,t){return Math.pow(2,t)*Math.tan(Math.PI*e/360)}_interpolateFov(e,t,i){return i*e+(1-i)*t}_setFrameId(e){this._frameId=e,this._changed&&(this._changed=!1,this._changedForFrame=e)}}class rS{constructor(e,t,i,r){this._subscriptions=new Tm,this._element=e,this._currentFrame$=t,this._spatial=new Kh,i=null!=i?i:Xw.Fill,this._resize$=new he,this._projectionMatrix$=new he,this._renderCameraOperation$=new he,this._size$=new de({height:this._element.offsetHeight,width:this._element.offsetWidth});const n=this._subscriptions;n.push(this._resize$.pipe(tt((()=>({height:this._element.offsetHeight,width:this._element.offsetWidth})))).subscribe(this._size$)),this._renderMode$=new de(i),this._renderCameraHolder$=this._renderCameraOperation$.pipe(ai((e=>e)),ei(((e,t)=>t(e)),null!==r&&void 0!==r?r:new iS(this._element.offsetWidth,this._element.offsetHeight,i)),Jt(1),le()),this._renderCameraFrame$=this._currentFrame$.pipe(ui(this._renderCameraHolder$),ci((([e,t])=>{t.setFrame(e)})),tt((e=>e[1])),Jt(1),le()),this._renderCamera$=this._renderCameraFrame$.pipe(Ct((e=>e.changed)),Jt(1),le()),this._bearing$=this._renderCamera$.pipe(tt((e=>{let t=this._spatial.radToDeg(this._spatial.azimuthalToBearing(e.rotation.phi));return this._spatial.wrap(t,0,360)})),Jt(1),le()),n.push(this._size$.pipe(ri(1),tt((e=>t=>(t.setSize(e),t)))).subscribe(this._renderCameraOperation$)),n.push(this._renderMode$.pipe(ri(1),tt((e=>t=>(t.setRenderMode(e),t)))).subscribe(this._renderCameraOperation$)),n.push(this._projectionMatrix$.pipe(tt((e=>t=>(t.setProjectionMatrix(e),t)))).subscribe(this._renderCameraOperation$)),n.push(this._bearing$.subscribe((()=>{}))),n.push(this._renderCameraHolder$.subscribe((()=>{}))),n.push(this._size$.subscribe((()=>{}))),n.push(this._renderMode$.subscribe((()=>{}))),n.push(this._renderCamera$.subscribe((()=>{}))),n.push(this._renderCameraFrame$.subscribe((()=>{})))}get bearing$(){return this._bearing$}get element(){return this._element}get projectionMatrix$(){return this._projectionMatrix$}get renderCamera$(){return this._renderCamera$}get renderCameraFrame$(){return this._renderCameraFrame$}get renderMode$(){return this._renderMode$}get resize$(){return this._resize$}get size$(){return this._size$}dispose(){this._subscriptions.unsubscribe()}}class nS{constructor(e){this._keyDown$=bt(e,"keydown"),this._keyUp$=bt(e,"keyup")}get keyDown$(){return this._keyDown$}get keyUp$(){return this._keyUp$}}const aS={0:1,2:2};class oS{constructor(e,t,i,r){this._subscriptions=new Tm;const n=this._subscriptions;this._activeSubject$=new de(!1),this._active$=this._activeSubject$.pipe(Vt(),Jt(1),le()),this._claimMouse$=new he,this._claimWheel$=new he,this._deferPixelClaims$=new he,this._deferPixels$=this._deferPixelClaims$.pipe(ei(((e,t)=>(null==t.deferPixels?delete e[t.name]:e[t.name]=t.deferPixels,e)),{}),tt((e=>{let t=-1;for(const i in e){if(!e.hasOwnProperty(i))continue;const r=e[i];r>t&&(t=r)}return t})),ai(-1),Jt(1),le()),n.push(this._deferPixels$.subscribe((()=>{}))),this._documentMouseMove$=bt(r,"pointermove").pipe(Ct(this._isMousePen)),this._documentMouseUp$=bt(r,"pointerup").pipe(Ct(this._isMousePen)),this._mouseDown$=bt(t,"pointerdown").pipe(Ct(this._isMousePen)),this._mouseEnter$=bt(t,"pointerenter").pipe(Ct(this._isMousePen)),this._mouseLeave$=bt(t,"pointerleave").pipe(Ct(this._isMousePen)),this._mouseMove$=bt(t,"pointermove").pipe(Ct(this._isMousePen)),this._mouseUp$=bt(t,"pointerup").pipe(Ct(this._isMousePen)),this._mouseOut$=bt(t,"pointerout").pipe(Ct(this._isMousePen)),this._mouseOver$=bt(t,"pointerover").pipe(Ct(this._isMousePen)),this._domMouseDown$=bt(i,"pointerdown").pipe(Ct(this._isMousePen)),this._domMouseMove$=bt(i,"pointermove").pipe(Ct(this._isMousePen)),this._click$=bt(t,"click"),this._contextMenu$=bt(t,"contextmenu"),this._windowBlur$=bt(window,"blur"),this._dblClick$=Mt(bt(e,"click"),bt(t,"dblclick")).pipe(Pt(3,1),Ct((e=>{const i=e[0],r=e[1],n=e[2];return"click"===i.type&&"click"===r.type&&"dblclick"===n.type&&i.target.parentNode===t&&r.target.parentNode===t})),tt((e=>e[2])),ti()),n.push(Mt(this._domMouseDown$,this._domMouseMove$,this._dblClick$,this._contextMenu$).subscribe((e=>{e.preventDefault()}))),this._mouseWheel$=Mt(bt(t,"wheel"),bt(i,"wheel")).pipe(ti()),this._consistentContextMenu$=Mt(this._mouseDown$,this._mouseMove$,this._mouseOut$,this._mouseUp$,this._contextMenu$).pipe(Pt(3,1),Ct((e=>"pointerdown"===e[0].type&&"contextmenu"===e[1].type&&"pointerup"===e[2].type)),tt((e=>e[1])),ti());const a=Mt(this._windowBlur$,this._documentMouseMove$.pipe(Ct((e=>this._buttonReleased(e,0)))),this._documentMouseUp$.pipe(Ct((e=>0===this._mouseButton(e))))).pipe(ti()),o=this._createMouseDragInitiate$(0,this._mouseDown$,a,!0).pipe(ti());this._mouseDragStart$=this._createMouseDragStart$(o).pipe(ti()),this._mouseDrag$=this._createMouseDrag$(o,a).pipe(ti()),this._mouseDragEnd$=this._createMouseDragEnd$(this._mouseDragStart$,a).pipe(ti());const s=this._createMouseDragInitiate$(0,this._domMouseDown$,a,!1).pipe(ti());this._domMouseDragStart$=this._createMouseDragStart$(s).pipe(ti()),this._domMouseDrag$=this._createMouseDrag$(s,a).pipe(ti()),this._domMouseDragEnd$=this._createMouseDragEnd$(this._domMouseDragStart$,a).pipe(ti());const l=Mt(this._windowBlur$,this._documentMouseMove$.pipe(Ct((e=>this._buttonReleased(e,2)))),this._documentMouseUp$.pipe(Ct((e=>2===this._mouseButton(e))))).pipe(ti()),c=this._createMouseDragInitiate$(2,this._mouseDown$,l,!0).pipe(ti());this._mouseRightDragStart$=this._createMouseDragStart$(c).pipe(ti()),this._mouseRightDrag$=this._createMouseDrag$(c,l).pipe(ti()),this._mouseRightDragEnd$=this._createMouseDragEnd$(this._mouseRightDragStart$,l).pipe(ti()),this._proximateClick$=this._mouseDown$.pipe(oi((e=>this._click$.pipe(si(this._createDeferredMouseMove$(e,this._documentMouseMove$)),Nt(1)))),ti()),this._staticClick$=this._mouseDown$.pipe(oi((()=>this._click$.pipe(si(this._documentMouseMove$),Nt(1)))),ti()),n.push(this._mouseDragStart$.subscribe()),n.push(this._mouseDrag$.subscribe()),n.push(this._mouseDragEnd$.subscribe()),n.push(this._domMouseDragStart$.subscribe()),n.push(this._domMouseDrag$.subscribe()),n.push(this._domMouseDragEnd$.subscribe()),n.push(this._mouseRightDragStart$.subscribe()),n.push(this._mouseRightDrag$.subscribe()),n.push(this._mouseRightDragEnd$.subscribe()),n.push(this._staticClick$.subscribe()),this._mouseOwner$=this._createOwner$(this._claimMouse$).pipe(Jt(1),le()),this._wheelOwner$=this._createOwner$(this._claimWheel$).pipe(Jt(1),le()),n.push(this._mouseOwner$.subscribe((()=>{}))),n.push(this._wheelOwner$.subscribe((()=>{})))}get active$(){return this._active$}get activate$(){return this._activeSubject$}get documentMouseMove$(){return this._documentMouseMove$}get documentMouseUp$(){return this._documentMouseUp$}get domMouseDragStart$(){return this._domMouseDragStart$}get domMouseDrag$(){return this._domMouseDrag$}get domMouseDragEnd$(){return this._domMouseDragEnd$}get domMouseDown$(){return this._domMouseDown$}get domMouseMove$(){return this._domMouseMove$}get mouseOwner$(){return this._mouseOwner$}get mouseDown$(){return this._mouseDown$}get mouseEnter$(){return this._mouseEnter$}get mouseMove$(){return this._mouseMove$}get mouseLeave$(){return this._mouseLeave$}get mouseOut$(){return this._mouseOut$}get mouseOver$(){return this._mouseOver$}get mouseUp$(){return this._mouseUp$}get click$(){return this._click$}get dblClick$(){return this._dblClick$}get contextMenu$(){return this._consistentContextMenu$}get mouseWheel$(){return this._mouseWheel$}get mouseDragStart$(){return this._mouseDragStart$}get mouseDrag$(){return this._mouseDrag$}get mouseDragEnd$(){return this._mouseDragEnd$}get mouseRightDragStart$(){return this._mouseRightDragStart$}get mouseRightDrag$(){return this._mouseRightDrag$}get mouseRightDragEnd$(){return this._mouseRightDragEnd$}get proximateClick$(){return this._proximateClick$}get staticClick$(){return this._staticClick$}get windowBlur$(){return this._windowBlur$}dispose(){this._subscriptions.unsubscribe()}claimMouse(e,t){this._claimMouse$.next({name:e,zindex:t})}unclaimMouse(e){this._claimMouse$.next({name:e,zindex:null})}deferPixels(e,t){this._deferPixelClaims$.next({name:e,deferPixels:t})}undeferPixels(e){this._deferPixelClaims$.next({name:e,deferPixels:null})}claimWheel(e,t){this._claimWheel$.next({name:e,zindex:t})}unclaimWheel(e){this._claimWheel$.next({name:e,zindex:null})}filtered$(e,t){return this._filtered(e,t,this._mouseOwner$)}filteredWheel$(e,t){return this._filtered(e,t,this._wheelOwner$)}_createDeferredMouseMove$(e,t){return t.pipe(tt((t=>{const i=t.clientX-e.clientX,r=t.clientY-e.clientY;return[t,Math.sqrt(i*i+r*r)]})),ui(this._deferPixels$),Ct((([[,e],t])=>e>t)),tt((([[e]])=>e)))}_createMouseDrag$(e,t){return e.pipe(tt((([,e])=>e)),oi((e=>_t(Ze(e),this._documentMouseMove$).pipe(si(t)))))}_createMouseDragEnd$(e,t){return e.pipe(oi((()=>t.pipe(Ht()))))}_createMouseDragStart$(e){return e.pipe(tt((([e])=>e)))}_createMouseDragInitiate$(e,t,i,r){return t.pipe(Ct((t=>this._mouseButton(t)===e)),oi((e=>ut(Ze(e),r?this._createDeferredMouseMove$(e,this._documentMouseMove$):this._documentMouseMove$).pipe(si(i),Nt(1)))))}_createOwner$(e){return e.pipe(ei(((e,t)=>(null==t.zindex?delete e[t.name]:e[t.name]=t.zindex,e)),{}),tt((e=>{let t=null,i=-1;for(const r in e)e.hasOwnProperty(r)&&e[r]>i&&(i=e[r],t=r);return t})),ai(null))}_filtered(e,t,i){return t.pipe(ui(i),Ct((([,t])=>t===e)),tt((([e])=>e)))}_mouseButton(e){const t="pointerdown"===e.type||"pointerup"===e.type,i=window.InstallTrigger;return t&&"undefined"!==typeof i&&2===e.button&&e.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button}_buttonReleased(e,t){const i=aS[t];return void 0===e.buttons||(e.buttons&i)!==i}_isMousePen(e){const t=e.pointerType;return"mouse"===t||"pen"===t}}class sS{set json(e){this._json=e}set image(e){this._image=e,this._texture=new fr(this._image),this._texture.minFilter=vi}get loaded(){return!(!this._image||!this._json)}getGLSprite(e){if(!this.loaded)throw new Error("Sprites cannot be retrieved before the atlas is loaded.");let t=this._json[e];if(!t)return console.warn("Sprite with key"+e+"does not exist in sprite definition."),new Sn;let i=this._texture.clone();i.needsUpdate=!0;let r=this._image.width,n=this._image.height;i.offset.x=t.x/r,i.offset.y=(n-t.y-t.height)/n,i.repeat.x=t.width/r,i.repeat.y=t.height/n;let a=new Dl({map:i});return new Xl(a)}getDOMSprite(e,t){if(!this.loaded)throw new Error("Sprites cannot be retrieved before the atlas is loaded.");null==t&&(t=Uy.Center);let i=this._json[e];if(!i)return console.warn("Sprite with key"+e+"does not exist in sprite definition."),Sm.h("div",{},[]);let r=i.y,n=i.x+i.width,a=i.y+i.height,o=i.x,s=-i.x,l=-i.y,c=this._image.height,u=this._image.width;switch(t){case Uy.Bottom:case Uy.Center:case Uy.Top:s-=i.width/2;break;case Uy.BottomLeft:case Uy.Left:case Uy.TopLeft:s-=i.width;case Uy.BottomRight:case Uy.Right:case Uy.TopRight:}switch(t){case Uy.Center:case Uy.Left:case Uy.Right:l-=i.height/2;break;case Uy.Top:case Uy.TopLeft:case Uy.TopRight:l-=i.height;case Uy.Bottom:case Uy.BottomLeft:case Uy.BottomRight:}let h=1/i.pixelRatio;r*=h,n*=h,a*=h,o*=h,s*=h,l*=h,c*=h,u*=h;let p={src:this._image.src,style:{clip:`rect(${r}px, ${n}px, ${a}px, ${o}px)`,height:`${c}px`,left:`${s}px`,position:"absolute",top:`${l}px`,width:`${u}px`}};return Sm.h("img",p,[])}}class lS{constructor(e){if(this._retina=window.devicePixelRatio>1,this._spriteAtlasOperation$=new he,this._spriteAtlas$=this._spriteAtlasOperation$.pipe(ai((e=>e)),ei(((e,t)=>t(e)),new sS),Jt(1),le()),this._atlasSubscription=this._spriteAtlas$.subscribe((()=>{})),null==e)return;let t=this._retina?"@2x":"",i=new XMLHttpRequest;i.open("GET",e+t+".png",!0),i.responseType="arraybuffer",i.onload=()=>{let e=new Image;e.onload=()=>{this._spriteAtlasOperation$.next((t=>(t.image=e,t)))};let t=new Blob([i.response]);e.src=window.URL.createObjectURL(t)},i.onerror=i=>{console.error(new Error(`Failed to fetch sprite sheet (${e}${t}.png)`))},i.send();let r=new XMLHttpRequest;r.open("GET",e+t+".json",!0),r.responseType="text",r.onload=()=>{let e=JSON.parse(r.response);this._spriteAtlasOperation$.next((t=>(t.json=e,t)))},r.onerror=i=>{console.error(new Error(`Failed to fetch sheet (${e}${t}.json)`))},r.send()}get spriteAtlas$(){return this._spriteAtlas$}dispose(){this._atlasSubscription.unsubscribe()}}class cS{constructor(e,t){this._subscriptions=new Tm;const i=this._subscriptions;this._activeSubject$=new de(!1),this._active$=this._activeSubject$.pipe(Vt(),Jt(1),le()),i.push(bt(t,"touchmove").subscribe((e=>{e.preventDefault()}))),this._touchStart$=bt(e,"touchstart"),this._touchMove$=bt(e,"touchmove"),this._touchEnd$=bt(e,"touchend"),this._touchCancel$=bt(e,"touchcancel");const r=this._touchStart$.pipe(Ct((e=>1===e.touches.length&&1===e.targetTouches.length)),ti());var n;this._doubleTap$=r.pipe((n=()=>r.pipe(Ht(),oi((()=>Mt(St(300),r).pipe(Nt(1))))),oe((function(e,t){var i=null,r=null,a=function(){null===r||void 0===r||r.unsubscribe();var e=i;i=[],e&&t.next(e),Ne(n()).subscribe(r=new se(t,a,j))};a(),e.subscribe(new se(t,(function(e){return null===i||void 0===i?void 0:i.push(e)}),(function(){i&&t.next(i),t.complete()}),void 0,(function(){return i=r=null})))}))),Ct((e=>2===e.length)),tt((e=>e[e.length-1])),ti()),i.push(this._doubleTap$.subscribe((e=>{e.preventDefault()}))),this._singleTouchMove$=this._touchMove$.pipe(Ct((e=>1===e.touches.length&&1===e.targetTouches.length)),ti());let a=Mt(this._touchStart$,this._touchEnd$,this._touchCancel$).pipe(Ct((e=>1===e.touches.length&&1===e.targetTouches.length))),o=Mt(this._touchStart$,this._touchEnd$,this._touchCancel$).pipe(Ct((e=>e.touches.length>=1))),s=Mt(this._touchEnd$,this._touchCancel$).pipe(Ct((e=>0===e.touches.length)));this._singleTouchDragStart$=a.pipe(ft((()=>this._singleTouchMove$.pipe(si(Mt(s,o)),Nt(1))))),this._singleTouchDragEnd$=a.pipe(ft((()=>Mt(s,o).pipe(Ht())))),this._singleTouchDrag$=a.pipe(oi((()=>this._singleTouchMove$.pipe(ri(1),si(Mt(o,s))))));let l=Mt(this._touchStart$,this._touchEnd$,this._touchCancel$);this._pinchStart$=l.pipe(Ct((e=>2===e.touches.length&&2===e.targetTouches.length))),this._pinchEnd$=l.pipe(Ct((e=>2!==e.touches.length||2!==e.targetTouches.length))),this._pinchOperation$=new he,this._pinch$=this._pinchOperation$.pipe(ei(((e,t)=>t(e)),{changeX:0,changeY:0,clientX:0,clientY:0,distance:0,distanceChange:0,distanceX:0,distanceY:0,originalEvent:null,pageX:0,pageY:0,screenX:0,screenY:0,touch1:null,touch2:null}));const c=this._touchMove$.pipe(Ct((e=>2===e.touches.length&&2===e.targetTouches.length)),tt((e=>t=>{let i=e.touches[0],r=e.touches[1],n=Math.min(i.clientX,r.clientX),a=Math.max(i.clientX,r.clientX),o=Math.min(i.clientY,r.clientY),s=n+(a-n)/2,l=o+(Math.max(i.clientY,r.clientY)-o)/2,c=s+i.pageX-i.clientX,u=l+i.pageY-i.clientY,h=s+i.screenX-i.clientX,p=l+i.screenY-i.clientY,d=Math.abs(i.clientX-r.clientX),f=Math.abs(i.clientY-r.clientY),m=Math.sqrt(d*d+f*f),g=m-t.distance;return{changeX:d-t.distanceX,changeY:f-t.distanceY,clientX:s,clientY:l,distance:m,distanceChange:g,distanceX:d,distanceY:f,originalEvent:e,pageX:c,pageY:u,screenX:h,screenY:p,touch1:i,touch2:r}}))).subscribe(this._pinchOperation$);i.push(c),this._pinchChange$=this._pinchStart$.pipe(oi((()=>this._pinch$.pipe(ri(1),si(this._pinchEnd$)))))}get active$(){return this._active$}get activate$(){return this._activeSubject$}get doubleTap$(){return this._doubleTap$}get touchStart$(){return this._touchStart$}get touchMove$(){return this._touchMove$}get touchEnd$(){return this._touchEnd$}get touchCancel$(){return this._touchCancel$}get singleTouchDragStart$(){return this._singleTouchDragStart$}get singleTouchDrag$(){return this._singleTouchDrag$}get singleTouchDragEnd$(){return this._singleTouchDragEnd$}get pinch$(){return this._pinchChange$}get pinchStart$(){return this._pinchStart$}get pinchEnd$(){return this._pinchEnd$}dispose(){this._subscriptions.unsubscribe()}}class uS{constructor(e){var t,i,r,n;const a=null!==(i=null===(t=null===e||void 0===e?void 0:e.url)||void 0===t?void 0:t.exploreHost)&&void 0!==i?i:"www.mapillary.com",o=`${null!==(n=null===(r=null===e||void 0===e?void 0:e.url)||void 0===r?void 0:r.scheme)&&void 0!==n?n:"https"}://${a}`;this._exploreUrl$=Ze(o);const s=!1!==(null===e||void 0===e?void 0:e.imageTiling);this._imageTiling$=Ze(s)}get exploreUrl$(){return this._exploreUrl$}get imageTiling$(){return this._imageTiling$}}class hS{constructor(e,t,i){var r;if(this._onWindowResize=()=>{this._trackResize&&this.renderService.resize$.next()},this._dom=null!==i&&void 0!==i?i:new Ag,"string"===typeof e.container){if(this._container=this._dom.document.getElementById(e.container),!this._container)throw new Error(`Container "${e.container}" not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error('Invalid type: "container" must be a String or HTMLElement.');this._container=e.container}this._trackResize=!1!==e.trackResize,this.id=null!==(r=this._container.id)&&void 0!==r?r:"mapillary-fallback-container-id",this._container.classList.add("mapillary-viewer"),this._canvasContainer=this._dom.createElement("div","mapillary-interactive",this._container),this._canvas=this._dom.createElement("canvas","mapillary-canvas"),this._canvas.style.position="absolute",this._canvas.setAttribute("tabindex","0"),this._domContainer=this._dom.createElement("div","mapillary-dom",this._container),this.configurationService=new uS(e),this.renderService=new rS(this._container,t.currentState$,e.renderMode),this.glRenderer=new eS(this._canvas,this._canvasContainer,this.renderService),this.domRenderer=new Qw(this._domContainer,this.renderService,t.currentState$),this.keyboardService=new nS(this._canvasContainer),this.mouseService=new oS(this._container,this._canvasContainer,this._domContainer,document),this.touchService=new cS(this._canvasContainer,this._domContainer),this.spriteService=new lS(e.sprite),window.addEventListener("resize",this._onWindowResize,!1)}get canvas(){return this._canvas.parentNode?this._canvas:null}get canvasContainer(){return this._canvasContainer}get container(){return this._container}get domContainer(){return this._domContainer}remove(){window.removeEventListener("resize",this._onWindowResize,!1),this.spriteService.dispose(),this.touchService.dispose(),this.mouseService.dispose(),this.glRenderer.remove(),this.domRenderer.remove(),this.renderService.dispose(),this._removeNode(this._canvasContainer),this._removeNode(this._domContainer),this._container.classList.remove("mapillary-viewer")}_removeNode(e){e.parentNode&&e.parentNode.removeChild(e)}}class pS{constructor(e,t,i){this._graphService=e,this._stateService=t,this._api=i,this._subscriptions=new Tm,this._started=!1,this._cellDepth=1}get started(){return this._started}configure(e){this._cellDepth=e?Math.max(1,Math.min(3,e.cellDepth)):1}start(){if(this._started)return;const e=this._subscriptions;e.push(this._stateService.currentState$.pipe(Vt(void 0,(e=>e.state.currentImage.id)),tt((e=>{const t=e.state,i=t.trajectory,r=i.map((e=>e.id)),n=i[i.length-1].sequenceId;return[r,t.currentImage.originalLngLat,n]})),Pt(1,5),ui(this._graphService.graphMode$),oi((([e,t])=>{const i=e[0][0],r=e[0][1],n=this._api.data.geometry,a=r_(n.lngLatToCellId(r),this._cellDepth,n),o=t===tg.Sequence?e[0][2]:void 0;return this._graphService.uncache$(i,a,o)}))).subscribe((()=>{}))),e.push(this._graphService.graphMode$.pipe(ri(1),ui(this._stateService.currentState$),oi((([e,t])=>e===tg.Sequence?this._keyToEdges(t.state.currentImage.id,(e=>e.sequenceEdges$)):Oe(t.state.trajectory.map((e=>e.id)).slice(t.state.currentIndex)).pipe(ft((e=>this._keyToEdges(e,(e=>e.spatialEdges$))),6))))).subscribe((()=>{}))),e.push(this._graphService.dataAdded$.pipe(ui(this._stateService.currentId$),oi((([e,t])=>this._graphService.cacheImage$(t)))).subscribe((()=>{}))),this._started=!0}stop(){this._started&&(this._subscriptions.unsubscribe(),this._started=!1)}_keyToEdges(e,t){return this._graphService.cacheImage$(e).pipe(oi(t),Ht((e=>e.cached)),Qe(15e3),zt((t=>(console.error(`Failed to cache edges (${e}).`,t),Me()))))}}class dS{constructor(){this._loadersSubject$=new he,this._loaders$=this._loadersSubject$.pipe(ei(((e,t)=>(void 0!==t.task&&(e[t.task]=t.loading),e)),{}),ai({}),Jt(1),le())}get loading$(){return this._loaders$.pipe(tt((e=>{for(const t in e)if(e.hasOwnProperty(t)&&e[t])return!0;return!1})),Ft(100),Vt())}taskLoading$(e){return this._loaders$.pipe(tt((t=>!!t[e])),Ft(100),Vt())}startLoading(e){this._loadersSubject$.next({loading:!0,task:e})}stopLoading(e){this._loadersSubject$.next({loading:!1,task:e})}}var fS;!function(e){e[e.Disabled=0]="Disabled",e[e.Enabled=1]="Enabled",e[e.Started=2]="Started"}(fS||(fS={}));class mS{constructor(e,t,i,r,n,a){this._subscriptions=new Tm,this._graphService=e,this._stateService=t,this._graphCalculator=null!==r&&void 0!==r?r:new Uh,this._spatial=null!==n&&void 0!==n?n:new Kh,this._viewportCoords=null!==a&&void 0!==a?a:new Im,this._mode=!1!==i?fS.Enabled:fS.Disabled,this._panImagesSubject$=new he,this._panImages$=this._panImagesSubject$.pipe(ai([]),Jt(1),le()),this._subscriptions.push(this._panImages$.subscribe())}get panImages$(){return this._panImages$}dispose(){this.stop(),null!=this._panImagesSubscription&&this._panImagesSubscription.unsubscribe(),this._subscriptions.unsubscribe()}enable(){this._mode===fS.Disabled&&(this._mode=fS.Enabled,this.start())}disable(){this._mode!==fS.Disabled&&(this.stop(),this._mode=fS.Disabled)}start(){if(this._mode!==fS.Enabled)return;const e=this._stateService.currentImage$.pipe(oi((e=>{if(!e.merged||Qh(e.cameraType))return Ze([]);const t=Ze(e),i=this._graphCalculator.boundingBoxCorners(e.lngLat,20);return ut(t,this._graphService.cacheBoundingBox$(i[0],i[1]).pipe(zt((t=>(console.error(`Failed to cache periphery bounding box (${e.id})`,t),Me()))),tt((t=>{if(Qh(e.cameraType))return[];const i=[];for(const r of t)r.id!==e.id&&r.mergeId===e.mergeId&&(Qh(r.cameraType)||this._distance(r,e)>4||i.push(r));return i})))).pipe(ui(this._stateService.reference$),tt((([[e,t],i])=>{const r=this._spatial.viewingDirection(e.rotation),n=tp({lat:e.lngLat.lat,lng:e.lngLat.lng,alt:e.computedAltitude},e.rotation,i),a=this._createTransform(e,n),o=this._spatial.wrap(this._spatial.azimuthal(r.toArray(),a.upVector().toArray()),0,2*Math.PI),s=this._computeProjectedPoints(a),l=this._computeHorizontalFov(s)/180*Math.PI,c=Math.PI/8;let u,h;for(const d of t){const t=tp({lat:d.lngLat.lat,lng:d.lngLat.lng,alt:d.computedAltitude},d.rotation,i),n=this._createTransform(d,t),a=this._computeProjectedPoints(n),s=this._computeHorizontalFov(a)/180*Math.PI,p=this._spatial.viewingDirection(d.rotation),f=this._spatial.wrap(this._spatial.azimuthal(p.toArray(),n.upVector().toArray()),0,2*Math.PI),m=this._spatial.angleBetweenVector2(r.x,r.y,p.x,p.y);let g=Number.NEGATIVE_INFINITY;g=m>0?o>f?o-2*Math.PI+l/2-(f-s/2):o+l/2-(f-s/2):o<f?f+s/2-(o+2*Math.PI-l/2):f+s/2-(o-l/2);const _=Math.abs(s-g),y=this._distance(d,e)+Math.min(this._timeDifference(d,e),4)+20*Math.abs(g-c)+Math.min(5,1/Math.min(s/l,1))+(g>0?-2*_:0);g>0&&g<.5*l&&g<.5*s&&_>.5*l&&(m>0?u?y<u[0]&&(u=[y,d,n,s]):u=[y,d,n,s]:h?y<h[0]&&(h=[y,d,n,s]):h=[y,d,n,s])}const p=[];return u&&p.push([u[1],u[2],u[3]]),h&&p.push([h[1],h[2],h[3]]),p})),ai([]))})));this._panImagesSubscription=this._stateService.currentState$.pipe(tt((e=>e.state.imagesAhead>0)),Vt(),oi((t=>t?Ze([]):e))).subscribe((e=>{this._panImagesSubject$.next(e)})),this._mode=fS.Started}stop(){this._mode===fS.Started&&(this._panImagesSubscription.unsubscribe(),this._panImagesSubject$.next([]),this._mode=fS.Enabled)}_distance(e,t){const[i,r,n]=Oh(e.lngLat.lng,e.lngLat.lat,e.computedAltitude,t.lngLat.lng,t.lngLat.lat,t.computedAltitude);return Math.sqrt(i*i+r*r+n*n)}_timeDifference(e,t){return Math.abs(e.capturedAt-t.capturedAt)/2592e6}_createTransform(e,t){return new Rg(e.exifOrientation,e.width,e.height,e.scale,e.rotation,t,e.assetsCached?e.image:void 0,void 0,e.cameraParameters,e.cameraType)}_computeProjectedPoints(e){return ip(e,[[1,0]],[[0,.5]],20,this._viewportCoords)}_computeHorizontalFov(e){const t=e.map((e=>this._coordToFov(e[0])));return Math.min(...t)}_coordToFov(e){return 2*Math.atan(e)*180/Math.PI}}class gS{constructor(e){this._data=e}get data(){return this._data}getCoreImages$(e){return this._wrap$(this._data.getCoreImages(e))}getImages$(e){return this._wrap$(this._data.getImages(e))}getImageTiles$(e){return this._wrap$(this._data.getImageTiles(e))}getSequence$(e){return this._wrap$(this._data.getSequence(e))}getSpatialImages$(e){return this._wrap$(this._data.getSpatialImages(e))}setAccessToken(e){this._data.setAccessToken(e)}_wrap$(e){return re.create((t=>{e.then((e=>{t.next(e),t.complete()}),(e=>{t.error(e)}))}))}}class _S{constructor(e){this._dataAdded$=new he,this._subscriptions=new Tm,this._onDataAdded=e=>{this._graph$.pipe(Ht(),ft((t=>t.updateCells$(e.cellIds).pipe(ci((()=>{t.resetSpatialEdges()})))))).subscribe((e=>{this._dataAdded$.next(e)}))};const t=this._subscriptions;this._graph$=_t(Ze(e),e.changed$).pipe(Jt(1),le()),t.push(this._graph$.subscribe((()=>{}))),this._graphMode=tg.Spatial,this._graphModeSubject$=new he,this._graphMode$=this._graphModeSubject$.pipe(ai(this._graphMode),Jt(1),le()),t.push(this._graphMode$.subscribe((()=>{}))),this._firstGraphSubjects$=[],this._initializeCacheSubscriptions=[],this._sequenceSubscriptions=[],this._spatialSubscriptions=[],e.api.data.on("datacreate",this._onDataAdded)}get dataAdded$(){return this._dataAdded$}get filter$(){return this._graph$.pipe(Ht(),ft((e=>e.filter$)))}get graphMode$(){return this._graphMode$}cacheBoundingBox$(e,t){return this._graph$.pipe(Ht(),ft((i=>i.cacheBoundingBox$(e,t))))}cacheCell$(e){return this._graph$.pipe(Ht(),ft((t=>t.cacheCell$(e))))}cacheImage$(e){const t=new he;this._firstGraphSubjects$.push(t);const i=t.pipe(Jt(1),le()),r=i.pipe(tt((t=>t.getNode(e))),ft((e=>e.assetsCached?Ze(e):e.cacheAssets$())),Jt(1),le());let n;r.subscribe(void 0,(t=>{console.error(`Failed to cache image (${e}).`,t)})),n=this._graph$.pipe(Ht(),ft((t=>t.isCachingFull(e)||!t.hasNode(e)?t.cacheFull$(e):t.isCachingFill(e)||!t.getNode(e).complete?t.cacheFill$(e):Ze(t))),ci((t=>{if(!t.hasNode(e))throw new np(`Failed to cache image (${e})`);t.hasInitializedCache(e)||t.initializeCache(e)})),Gt((()=>{null!=n&&(this._removeFromArray(n,this._initializeCacheSubscriptions),this._removeFromArray(t,this._firstGraphSubjects$))}))).subscribe((e=>{t.next(e),t.complete()}),(e=>{t.error(e)})),n.closed||this._initializeCacheSubscriptions.push(n);const a=i.pipe(zt((()=>Me())),ft((t=>t.isCachingNodeSequence(e)||!t.hasNodeSequence(e)?t.cacheNodeSequence$(e):Ze(t))),Jt(1),le());let o;if(o=a.pipe(ci((t=>{t.getNode(e).sequenceEdges.cached||t.cacheSequenceEdges(e)})),Gt((()=>{null!=o&&this._removeFromArray(o,this._sequenceSubscriptions)}))).subscribe((()=>{}),(t=>{console.error(`Failed to cache sequence edges (${e}).`,t)})),o.closed||this._sequenceSubscriptions.push(o),this._graphMode===tg.Spatial){let t;t=i.pipe(zt((()=>Me())),qt((t=>t.hasTiles(e)?Me():Oe(t.cacheTiles$(e)).pipe(ft((t=>t.pipe(ft((t=>t.isCachingTiles(e)?Me():Ze(t))),zt((t=>(console.error(`Failed to cache tile data (${e}).`,t),Me()))))))))),Wt(1),ft((t=>t.hasSpatialArea(e)?Ze(t):Oe(t.cacheSpatialArea$(e)).pipe(ft((t=>t.pipe(zt((t=>(console.error(`Failed to cache spatial images (${e}).`,t),Me()))))))))),Wt(1),ft((t=>t.hasNodeSequence(e)?Ze(t):t.cacheNodeSequence$(e))),ci((t=>{t.getNode(e).spatialEdges.cached||t.cacheSpatialEdges(e)})),Gt((()=>{null!=t&&this._removeFromArray(t,this._spatialSubscriptions)}))).subscribe((()=>{}),(t=>{const i=`Failed to cache spatial edges (${e}).`;console.error(i,t)})),t.closed||this._spatialSubscriptions.push(t)}return r.pipe(Ht((e=>e.assetsCached)))}cacheSequence$(e){return this._graph$.pipe(Ht(),ft((t=>t.isCachingSequence(e)||!t.hasSequence(e)?t.cacheSequence$(e):Ze(t))),tt((t=>t.getSequence(e))))}cacheSequenceImages$(e,t){return this._graph$.pipe(Ht(),ft((t=>t.isCachingSequence(e)||!t.hasSequence(e)?t.cacheSequence$(e):Ze(t))),ft((i=>i.isCachingSequenceNodes(e)||!i.hasSequenceNodes(e)?i.cacheSequenceNodes$(e,t):Ze(i))),tt((t=>t.getSequence(e))))}dispose(){this._graph$.pipe(Ht()).subscribe((e=>{e.unsubscribe()})),this._subscriptions.unsubscribe()}setFilter$(e){return this._resetSubscriptions(this._spatialSubscriptions),this._graph$.pipe(Ht(),ci((t=>{t.resetSpatialEdges(),t.setFilter(e)})),tt((()=>{})))}setGraphMode(e){this._graphMode!==e&&(e===tg.Sequence&&this._resetSubscriptions(this._spatialSubscriptions),this._graphMode=e,this._graphModeSubject$.next(this._graphMode))}reset$(e){return this._abortSubjects(this._firstGraphSubjects$),this._resetSubscriptions(this._initializeCacheSubscriptions),this._resetSubscriptions(this._sequenceSubscriptions),this._resetSubscriptions(this._spatialSubscriptions),this._graph$.pipe(Ht(),ci((t=>{t.reset(e)})),tt((()=>{})))}uncache$(e,t,i){return this._graph$.pipe(Ht(),ci((r=>{r.uncache(e,t,i)})),tt((()=>{})))}_abortSubjects(e){for(const t of e.slice())this._removeFromArray(t,e),t.error(new Error("Cache image request was aborted."))}_removeFromArray(e,t){const i=t.indexOf(e);-1!==i&&t.splice(i,1)}_resetSubscriptions(e){for(const t of e.slice())this._removeFromArray(t,e),t.closed||t.unsubscribe()}}class yS{constructor(e){e.requestAnimationFrame?(this._cancelAnimationFrame=e.cancelAnimationFrame.bind(e),this._requestAnimationFrame=e.requestAnimationFrame.bind(e)):e.mozRequestAnimationFrame?(this._cancelAnimationFrame=e.mozCancelAnimationFrame.bind(e),this._requestAnimationFrame=e.mozRequestAnimationFrame.bind(e)):e.webkitRequestAnimationFrame?(this._cancelAnimationFrame=e.webkitCancelAnimationFrame.bind(e),this._requestAnimationFrame=e.webkitRequestAnimationFrame.bind(e)):e.msRequestAnimationFrame?(this._cancelAnimationFrame=e.msCancelAnimationFrame.bind(e),this._requestAnimationFrame=e.msRequestAnimationFrame.bind(e)):e.oRequestAnimationFrame?(this._cancelAnimationFrame=e.oCancelAnimationFrame.bind(e),this._requestAnimationFrame=e.oRequestAnimationFrame.bind(e)):(this._cancelAnimationFrame=e.clearTimeout.bind(e),this._requestAnimationFrame=t=>e.setTimeout(t,1e3/60))}get cancelAnimationFrame(){return this._cancelAnimationFrame}get requestAnimationFrame(){return this._requestAnimationFrame}}class vS{constructor(e){this._spatial=new Kh,this._referenceThreshold=.01,this._transitionMode=e.transitionMode,this._reference=e.reference,this._alpha=e.alpha,this._stateTransitionAlpha=0,this._camera=e.camera.clone(),this._zoom=e.zoom,this._currentIndex=e.currentIndex,this._trajectory=e.trajectory.slice(),this._trajectoryTransforms=[],this._trajectoryCameras=[];for(let t of this._trajectory){let e=this._imageToTranslation(t,this._reference),i=new Rg(t.exifOrientation,t.width,t.height,t.scale,t.rotation,e,t.image,void 0,t.cameraParameters,t.cameraType);this._trajectoryTransforms.push(i),this._trajectoryCameras.push(new tS(i))}this._currentImage=this._trajectory.length>0?this._trajectory[this._currentIndex]:null,this._previousImage=this._trajectory.length>1&&this.currentIndex>0?this._trajectory[this._currentIndex-1]:null,this._currentCamera=this._trajectoryCameras.length>0?this._trajectoryCameras[this._currentIndex].clone():new tS,this._previousCamera=this._trajectoryCameras.length>1&&this.currentIndex>0?this._trajectoryCameras[this._currentIndex-1].clone():this._currentCamera.clone()}get reference(){return this._reference}get alpha(){return this._getAlpha()}get stateTransitionAlpha(){return this._getStateTransitionAlpha()}get camera(){return this._camera}get zoom(){return this._zoom}get trajectory(){return this._trajectory}get currentIndex(){return this._currentIndex}get currentImage(){return this._currentImage}get previousImage(){return this._previousImage}get currentCamera(){return this._currentCamera}get currentTransform(){return this._trajectoryTransforms.length>0?this._trajectoryTransforms[this.currentIndex]:null}get previousTransform(){return this._trajectoryTransforms.length>1&&this.currentIndex>0?this._trajectoryTransforms[this.currentIndex-1]:null}get motionless(){return this._motionless}get transitionMode(){return this._transitionMode}move(e){}moveTo(e){}rotate(e){}rotateUnbounded(e){}rotateWithoutInertia(e){}rotateBasic(e){}rotateBasicUnbounded(e){}rotateBasicWithoutInertia(e){}rotateToBasic(e){}setSpeed(e){}zoomIn(e,t){}update(e){}setCenter(e){}setZoom(e){}dolly(e){}orbit(e){}setViewMatrix(e){}truck(e){}append(e){if(e.length<1)throw Error("Trajectory can not be empty");this._currentIndex<0?this.set(e):(this._trajectory=this._trajectory.concat(e),this._appendToTrajectories(e))}prepend(e){if(e.length<1)throw Error("Trajectory can not be empty");this._trajectory=e.slice().concat(this._trajectory),this._currentIndex+=e.length,this._setCurrentImage(),this._setReference(this._currentImage)?this._setTrajectories():this._prependToTrajectories(e),this._setCurrentCamera()}remove(e){if(e<0)throw Error("n must be a positive integer");if(this._currentIndex-1<e)throw Error("Current and previous images can not be removed");for(let t=0;t<e;t++)this._trajectory.shift(),this._trajectoryTransforms.shift(),this._trajectoryCameras.shift(),this._currentIndex--;this._setCurrentImage()}clearPrior(){this._currentIndex>0&&this.remove(this._currentIndex-1)}clear(){this.cut(),this._currentIndex>0&&this.remove(this._currentIndex-1)}cut(){for(;this._trajectory.length-1>this._currentIndex;)this._trajectory.pop(),this._trajectoryTransforms.pop(),this._trajectoryCameras.pop()}set(e){this._setTrajectory(e),this._setCurrentImage(),this._setReference(this._currentImage),this._setTrajectories(),this._setCurrentCamera()}getCenter(){return null!=this._currentImage?this.currentTransform.projectBasic(this._camera.lookat.toArray()):[.5,.5]}setTransitionMode(e){this._transitionMode=e}_getAlpha(){return 1}_getStateTransitionAlpha(){return 1}_setCurrent(){this._setCurrentImage(),this._setReference(this._currentImage)&&this._setTrajectories(),this._setCurrentCamera()}_setCurrentCamera(){this._currentCamera=this._trajectoryCameras[this._currentIndex].clone(),this._previousCamera=this._currentIndex>0?this._trajectoryCameras[this._currentIndex-1].clone():this._currentCamera.clone()}_motionlessTransition(){return null!=this._currentImage&&null!=this._previousImage&&(this._transitionMode===Kw.Instantaneous||!(this._currentImage.merged&&this._previousImage.merged&&this._withinOriginalDistance()&&this._sameConnectedComponent()))}_setReference(e){return!(Math.abs(e.lngLat.lat-this.reference.lat)<this._referenceThreshold&&Math.abs(e.lngLat.lng-this.reference.lng)<this._referenceThreshold)&&(!(null!=this._previousImage&&!this._motionlessTransition())&&(this._reference.lat=e.lngLat.lat,this._reference.lng=e.lngLat.lng,this._reference.alt=e.computedAltitude,!0))}_setCurrentImage(){this._currentImage=this._trajectory.length>0?this._trajectory[this._currentIndex]:null,this._previousImage=this._currentIndex>0?this._trajectory[this._currentIndex-1]:null}_setTrajectory(e){if(e.length<1)throw new Yh("Trajectory can not be empty");null!=this._currentImage?(this._trajectory=[this._currentImage].concat(e),this._currentIndex=1):(this._trajectory=e.slice(),this._currentIndex=0)}_setTrajectories(){this._trajectoryTransforms.length=0,this._trajectoryCameras.length=0,this._appendToTrajectories(this._trajectory)}_appendToTrajectories(e){for(let t of e){if(!t.assetsCached)throw new Yh("Assets must be cached when image is added to trajectory");let e=this._imageToTranslation(t,this.reference),i=new Rg(t.exifOrientation,t.width,t.height,t.scale,t.rotation,e,t.image,void 0,t.cameraParameters,t.cameraType);this._trajectoryTransforms.push(i),this._trajectoryCameras.push(new tS(i))}}_prependToTrajectories(e){for(let t of e.reverse()){if(!t.assetsCached)throw new Yh("Assets must be cached when added to trajectory");let e=this._imageToTranslation(t,this.reference),i=new Rg(t.exifOrientation,t.width,t.height,t.scale,t.rotation,e,t.image,void 0,t.cameraParameters,t.cameraType);this._trajectoryTransforms.unshift(i),this._trajectoryCameras.unshift(new tS(i))}}_imageToTranslation(e,t){return tp({alt:e.computedAltitude,lat:e.lngLat.lat,lng:e.lngLat.lng},e.rotation,t)}_sameConnectedComponent(){let e=this._currentImage,t=this._previousImage;return!!e&&!!t&&e.mergeId===t.mergeId}_withinOriginalDistance(){let e=this._currentImage,t=this._previousImage;return!e||!t||this._spatial.distanceFromLngLat(e.originalLngLat.lng,e.originalLngLat.lat,t.originalLngLat.lng,t.originalLngLat.lat)<25}}class xS extends vS{constructor(e){super(e)}setViewMatrix(e){const t=(new Kr).fromArray(e).invert().elements,i=new xr(t[12],t[13],t[14]),r=new xr(-t[8],-t[9],-t[10]),n=new xr(t[4],t[5],t[6]),a=this._camera;a.position.copy(i),a.lookat.copy(i.clone().add(r)),a.up.copy(n);const o=.5/Math.tan(Math.PI/3);a.focal=o}}class bS extends vS{constructor(e){super(e),this._transition=0;const t=this._camera.position.clone(),i=this._camera.lookat.clone().sub(t).normalize(),r=Math.sqrt(i.x*i.x+i.y*i.y),n=Math.atan2(i.z,r),a=new xr;if(n>-Math.PI/45)a.copy(t),t.add(new xr(i.x,i.y,0).multiplyScalar(-50)),t.z=30;else{const e=t.clone(),r=new xr(0,0,1),n=new xr(0,0,-2),o=(new xr).subVectors(n,e).dot(r)/i.dot(r),s=1e4,l=e.clone().add(i.clone().multiplyScalar(Math.min(s,o)));a.copy(l);const c=t.clone().sub(l).normalize();t.copy(l.add(c.multiplyScalar(Math.max(50,c.length()))))}const o=this._camera.position.clone(),s=o.clone().add(i.clone().normalize().multiplyScalar(10)),l=this._camera.up.clone(),c=s.clone(),u=c.clone().add(i.clone().normalize().multiplyScalar(10)),h=l.clone(),p=t.clone(),d=a.clone(),f=new xr(0,0,1),m=t.clone().add(d.clone().sub(p).normalize().multiplyScalar(-10)),g=d.clone(),_=f.clone();this._curveE=new kc([c,o,p,m]),this._curveL=new kc([u,s,d,g]),this._curveU=new kc([h,l,f,_]),this._zoom0=this._zoom,this._zoom1=0,this._camera.focal=.5/Math.tan(Math.PI/4)}get _isTransitioning(){return this._transition<1}dolly(e){if(this._isTransitioning)return;const t=this._camera,i=t.position.clone().sub(t.lookat),r=i.length()*Math.pow(2,-e),n=Math.max(1,Math.min(r,4e3));i.normalize(),i.multiplyScalar(n),t.position.copy(t.lookat).add(i)}orbit(e){if(this._isTransitioning)return;const t=this._camera,i=(new vr).setFromUnitVectors(t.up,new xr(0,0,1)),r=i.clone().invert(),n=t.position.clone().sub(t.lookat);n.applyQuaternion(i);const a=n.length();let o=Math.atan2(n.y,n.x);o+=e.phi;let s=Math.atan2(Math.sqrt(n.x*n.x+n.y*n.y),n.z);s+=e.theta;const l=Math.PI/36;s=Math.max(l,Math.min(Math.PI/2-l,s)),n.x=Math.sin(s)*Math.cos(o),n.y=Math.sin(s)*Math.sin(o),n.z=Math.cos(s),n.applyQuaternion(r),t.position.copy(t.lookat).add(n.multiplyScalar(a))}truck(e){if(this._isTransitioning)return;const t=this._camera;t.position.add((new xr).fromArray(e)),t.lookat.add((new xr).fromArray(e))}update(e){if(!this._isTransitioning)return;this._transition=Math.min(this._transition+2*e/3,1);const t=ar.smootherstep(this._transition,0,1),i=(t+1)/3,r=this._curveE.getPoint(i),n=this._curveL.getPoint(i),a=this._curveU.getPoint(i);this._camera.position.copy(r),this._camera.lookat.copy(n),this._camera.up.copy(a),this._zoom=ar.lerp(this._zoom0,this._zoom1,t),this._stateTransitionAlpha=t}_getStateTransitionAlpha(){return this._stateTransitionAlpha}}class wS{constructor(e,t){this._phi=e,this._theta=t}get phi(){return this._phi}set phi(e){this._phi=e}get theta(){return this._theta}set theta(e){this._theta=e}get isZero(){return 0===this._phi&&0===this._theta}copy(e){this._phi=e.phi,this._theta=e.theta}lerp(e,t){this._phi=(1-t)*this._phi+t*e.phi,this._theta=(1-t)*this._theta+t*e.theta}multiply(e){this._phi*=e,this._theta*=e}threshold(e){this._phi=Math.abs(this._phi)>e?this._phi:0,this._theta=Math.abs(this._theta)>e?this._theta:0}lengthSquared(){return this._phi*this._phi+this._theta*this._theta}reset(){this._phi=0,this._theta=0}}class SS extends vS{constructor(e){super(e),this._animationSpeed=1/40,this._rotationDelta=new wS(0,0),this._requestedRotationDelta=null,this._basicRotation=[0,0],this._requestedBasicRotation=null,this._requestedBasicRotationUnbounded=null,this._rotationAcceleration=.86,this._rotationIncreaseAlpha=.97,this._rotationDecreaseAlpha=.9,this._rotationThreshold=.001,this._unboundedRotationAlpha=.8,this._desiredZoom=e.zoom,this._minZoom=0,this._maxZoom=3,this._lookatDepth=10,this._desiredLookat=null,this._desiredCenter=null}rotate(e){null!=this._currentImage&&(0===e.phi&&0===e.theta||(this._desiredZoom=this._zoom,this._desiredLookat=null,this._requestedBasicRotation=null,null!=this._requestedRotationDelta?(this._requestedRotationDelta.phi=this._requestedRotationDelta.phi+e.phi,this._requestedRotationDelta.theta=this._requestedRotationDelta.theta+e.theta):this._requestedRotationDelta=new wS(e.phi,e.theta)))}rotateUnbounded(e){if(null==this._currentImage)return;if(this._requestedBasicRotation=null,this._requestedRotationDelta=null,this._applyRotation(e,this._currentCamera),this._applyRotation(e,this._previousCamera),!this._desiredLookat)return;const t=(new vr).setFromUnitVectors(this._currentCamera.up,new xr(0,0,1)),i=t.clone().invert(),r=(new xr).copy(this._desiredLookat).sub(this._camera.position).applyQuaternion(t),n=r.length();let a=Math.atan2(r.y,r.x);a+=e.phi;let o=Math.atan2(Math.sqrt(r.x*r.x+r.y*r.y),r.z);o+=e.theta,o=Math.max(.1,Math.min(Math.PI-.1,o)),r.x=Math.sin(o)*Math.cos(a),r.y=Math.sin(o)*Math.sin(a),r.z=Math.cos(o),r.applyQuaternion(i),this._desiredLookat.copy(this._camera.position).add(r.multiplyScalar(n))}rotateWithoutInertia(e){if(null==this._currentImage)return;this._desiredZoom=this._zoom,this._desiredLookat=null,this._requestedBasicRotation=null,this._requestedRotationDelta=null;const t=Math.PI/(10*Math.pow(2,this._zoom)),i={phi:this._spatial.clamp(e.phi,-t,t),theta:this._spatial.clamp(e.theta,-t,t)};this._applyRotation(i,this._currentCamera),this._applyRotation(i,this._previousCamera)}rotateBasic(e){if(null!=this._currentImage)if(this._desiredZoom=this._zoom,this._desiredLookat=null,this._requestedRotationDelta=null,null!=this._requestedBasicRotation){this._requestedBasicRotation[0]+=e[0],this._requestedBasicRotation[1]+=e[1];let t=.05/Math.pow(2,this._zoom);this._requestedBasicRotation[0]=this._spatial.clamp(this._requestedBasicRotation[0],-t,t),this._requestedBasicRotation[1]=this._spatial.clamp(this._requestedBasicRotation[1],-t,t)}else this._requestedBasicRotation=e.slice()}rotateBasicUnbounded(e){null!=this._currentImage&&(null!=this._requestedBasicRotationUnbounded?(this._requestedBasicRotationUnbounded[0]+=e[0],this._requestedBasicRotationUnbounded[1]+=e[1]):this._requestedBasicRotationUnbounded=e.slice())}rotateBasicWithoutInertia(e){if(null==this._currentImage)return;this._desiredZoom=this._zoom,this._desiredLookat=null,this._requestedRotationDelta=null,this._requestedBasicRotation=null;const t=.05/Math.pow(2,this._zoom),i=e.slice();i[0]=this._spatial.clamp(i[0],-t,t),i[1]=this._spatial.clamp(i[1],-t,t),this._applyRotationBasic(i)}rotateToBasic(e){if(null==this._currentImage)return;this._desiredZoom=this._zoom,this._desiredLookat=null,e[0]=this._spatial.clamp(e[0],0,1),e[1]=this._spatial.clamp(e[1],0,1);let t=this.currentTransform.unprojectBasic(e,this._lookatDepth);this._currentCamera.lookat.fromArray(t)}zoomIn(e,t){if(null==this._currentImage)return;this._desiredZoom=Math.max(this._minZoom,Math.min(this._maxZoom,this._desiredZoom+e));let i=this.currentTransform.projectBasic(this._currentCamera.lookat.toArray()),r=i[0],n=i[1],a=Math.pow(2,this._zoom),o=Math.pow(2,this._desiredZoom),s=t[0],l=t[1];Qh(this.currentTransform.cameraType)&&(s-r>.5?s-=1:r-s>.5&&(s=1+s));let c=s-a/o*(s-r),u=l-a/o*(l-n);Qh(this._currentImage.cameraType)?(c=this._spatial.wrap(c+this._basicRotation[0],0,1),u=this._spatial.clamp(u+this._basicRotation[1],.05,.95)):(c=this._spatial.clamp(c,0,1),u=this._spatial.clamp(u,0,1)),this._desiredLookat=(new xr).fromArray(this.currentTransform.unprojectBasic([c,u],this._lookatDepth))}setCenter(e){this._desiredLookat=null,this._requestedRotationDelta=null,this._requestedBasicRotation=null,this._desiredZoom=this._zoom;let t=[this._spatial.clamp(e[0],0,1),this._spatial.clamp(e[1],0,1)];if(null==this._currentImage)return void(this._desiredCenter=t);this._desiredCenter=null;let i=(new xr).fromArray(this.currentTransform.unprojectBasic(t,this._lookatDepth)),r=null!=this.previousTransform?this.previousTransform:this.currentTransform,n=(new xr).fromArray(r.unprojectBasic(t,this._lookatDepth));this._currentCamera.lookat.copy(i),this._previousCamera.lookat.copy(n)}setZoom(e){this._desiredLookat=null,this._requestedRotationDelta=null,this._requestedBasicRotation=null,this._zoom=this._spatial.clamp(e,this._minZoom,this._maxZoom),this._desiredZoom=this._zoom}_applyRotation(e,t){if(null==t)return;let i=(new vr).setFromUnitVectors(t.up,new xr(0,0,1)),r=i.clone().invert(),n=new xr;n.copy(t.lookat).sub(t.position),n.applyQuaternion(i);let a=n.length(),o=Math.atan2(n.y,n.x);o+=e.phi;let s=Math.atan2(Math.sqrt(n.x*n.x+n.y*n.y),n.z);s+=e.theta,s=Math.max(.1,Math.min(Math.PI-.1,s)),n.x=Math.sin(s)*Math.cos(o),n.y=Math.sin(s)*Math.sin(o),n.z=Math.cos(s),n.applyQuaternion(r),t.lookat.copy(t.position).add(n.multiplyScalar(a))}_applyRotationBasic(e){let t=this._currentImage,i=null!=this._previousImage?this.previousImage:this.currentImage,r=this._currentCamera,n=this._previousCamera,a=this.currentTransform,o=null!=this.previousTransform?this.previousTransform:this.currentTransform,s=a.projectBasic(r.lookat.toArray()),l=o.projectBasic(n.lookat.toArray());Qh(t.cameraType)?(s[0]=this._spatial.wrap(s[0]+e[0],0,1),s[1]=this._spatial.clamp(s[1]+e[1],.05,.95)):(s[0]=this._spatial.clamp(s[0]+e[0],0,1),s[1]=this._spatial.clamp(s[1]+e[1],0,1)),Qh(i.cameraType)?(l[0]=this._spatial.wrap(l[0]+e[0],0,1),l[1]=this._spatial.clamp(l[1]+e[1],.05,.95)):(l[0]=this._spatial.clamp(l[0]+e[0],0,1),l[1]=this._spatial.clamp(s[1]+e[1],0,1));let c=a.unprojectBasic(s,this._lookatDepth);r.lookat.fromArray(c);let u=o.unprojectBasic(l,this._lookatDepth);n.lookat.fromArray(u)}_updateZoom(e){let t=this._desiredZoom-this._zoom,i=t>0?1:t<0?-1:0;0!==t&&(Math.abs(t)<.002?(this._zoom=this._desiredZoom,null!=this._desiredLookat&&(this._desiredLookat=null)):this._zoom+=i*Math.max(Math.abs(5*e*t),.002))}_updateLookat(e){if(null===this._desiredLookat)return;let t=this._desiredLookat.distanceToSquared(this._currentCamera.lookat);Math.abs(t)<1e-6?(this._currentCamera.lookat.copy(this._desiredLookat),this._desiredLookat=null):this._currentCamera.lookat.lerp(this._desiredLookat,5*e)}_updateRotation(){if(null!=this._requestedRotationDelta){let e=this._rotationDelta.lengthSquared();return this._requestedRotationDelta.lengthSquared()>e?this._rotationDelta.lerp(this._requestedRotationDelta,this._rotationIncreaseAlpha):this._rotationDelta.lerp(this._requestedRotationDelta,this._rotationDecreaseAlpha),void(this._requestedRotationDelta=null)}if(this._rotationDelta.isZero)return;const e=Qh(this.currentImage.cameraType)?1:this._alpha;this._rotationDelta.multiply(this._rotationAcceleration*e),this._rotationDelta.threshold(this._rotationThreshold)}_updateRotationBasic(){if(null!=this._requestedBasicRotation){let e=this._basicRotation[0],t=this._basicRotation[1],i=this._requestedBasicRotation[0],r=this._requestedBasicRotation[1];return Math.abs(i)>Math.abs(e)?this._basicRotation[0]=(1-this._rotationIncreaseAlpha)*e+this._rotationIncreaseAlpha*i:this._basicRotation[0]=(1-this._rotationDecreaseAlpha)*e+this._rotationDecreaseAlpha*i,Math.abs(r)>Math.abs(t)?this._basicRotation[1]=(1-this._rotationIncreaseAlpha)*t+this._rotationIncreaseAlpha*r:this._basicRotation[1]=(1-this._rotationDecreaseAlpha)*t+this._rotationDecreaseAlpha*r,void(this._requestedBasicRotation=null)}if(null!=this._requestedBasicRotationUnbounded){let e=this._requestedBasicRotationUnbounded[0],t=this._requestedBasicRotationUnbounded[1];if(Math.abs(e)>0&&(this._basicRotation[0]=(1-this._unboundedRotationAlpha)*this._basicRotation[0]+this._unboundedRotationAlpha*e),Math.abs(t)>0&&(this._basicRotation[1]=(1-this._unboundedRotationAlpha)*this._basicRotation[1]+this._unboundedRotationAlpha*t),null!=this._desiredLookat){let i=this.currentTransform.projectBasic(this._desiredLookat.toArray());i[0]+=e,i[1]+=t,this._desiredLookat=(new xr).fromArray(this.currentTransform.unprojectBasic(i,this._lookatDepth))}this._requestedBasicRotationUnbounded=null}0===this._basicRotation[0]&&0===this._basicRotation[1]||(this._basicRotation[0]=this._rotationAcceleration*this._basicRotation[0],this._basicRotation[1]=this._rotationAcceleration*this._basicRotation[1],Math.abs(this._basicRotation[0])<this._rotationThreshold/Math.pow(2,this._zoom)&&Math.abs(this._basicRotation[1])<this._rotationThreshold/Math.pow(2,this._zoom)&&(this._basicRotation=[0,0]))}_clearRotation(){Qh(this._currentImage.cameraType)||(null!=this._requestedRotationDelta&&(this._requestedRotationDelta=null),this._rotationDelta.isZero||this._rotationDelta.reset(),null!=this._requestedBasicRotation&&(this._requestedBasicRotation=null),(this._basicRotation[0]>0||this._basicRotation[1]>0)&&(this._basicRotation=[0,0]))}_setDesiredCenter(){if(null==this._desiredCenter)return;let e=(new xr).fromArray(this.currentTransform.unprojectBasic(this._desiredCenter,this._lookatDepth)).sub(this._currentCamera.position);this._currentCamera.lookat.copy(this._currentCamera.position.clone().add(e)),this._previousCamera.lookat.copy(this._previousCamera.position.clone().add(e)),this._desiredCenter=null}_setDesiredZoom(){this._desiredZoom=Qh(this._currentImage.cameraType)||null==this._previousImage?this._zoom:0}}class MS extends SS{constructor(e){super(e),this._adjustCameras(),this._motionless=this._motionlessTransition()}prepend(e){super.prepend(e),this._motionless=this._motionlessTransition()}set(e){super.set(e),this._motionless=this._motionlessTransition()}move(e){this._alpha=Math.max(0,Math.min(1,this._alpha+e))}moveTo(e){this._alpha=Math.max(0,Math.min(1,e))}update(e){this._updateRotation(),this._rotationDelta.isZero||(this._applyRotation(this._rotationDelta,this._previousCamera),this._applyRotation(this._rotationDelta,this._currentCamera)),this._updateRotationBasic(),0===this._basicRotation[0]&&0===this._basicRotation[1]||this._applyRotationBasic(this._basicRotation);let t=this._animationSpeed*e/.1*6;this._updateZoom(t),this._updateLookat(t),this._camera.lerpCameras(this._previousCamera,this._currentCamera,this.alpha)}_getAlpha(){return this._motionless?Math.round(this._alpha):this._alpha}_setCurrentCamera(){super._setCurrentCamera(),this._adjustCameras()}_adjustCameras(){if(null!=this._previousImage){if(Qh(this._currentImage.cameraType)){let e=this._camera.lookat.clone().sub(this._camera.position);this._currentCamera.lookat.copy(e.clone().add(this._currentCamera.position))}if(Qh(this._previousImage.cameraType)){let e=this._currentCamera.lookat.clone().sub(this._currentCamera.position);this._previousCamera.lookat.copy(e.clone().add(this._previousCamera.position))}}}}class TS extends SS{constructor(e){super(e),this._adjustCameras(),this._motionless=this._motionlessTransition(),this._baseAlpha=this._alpha,this._speedCoefficient=1,this._smoothing=!1}append(e){let t=0===this._trajectory.length;t&&this._resetTransition(),super.append(e),t&&(this._setDesiredCenter(),this._setDesiredZoom())}prepend(e){let t=0===this._trajectory.length;t&&this._resetTransition(),super.prepend(e),t&&(this._setDesiredCenter(),this._setDesiredZoom())}set(e){super.set(e),this._desiredLookat=null,this._resetTransition(),this._clearRotation(),this._setDesiredCenter(),this._setDesiredZoom(),this._trajectory.length<3&&(this._smoothing=!0)}setSpeed(e){this._speedCoefficient=this._spatial.clamp(e,0,10)}update(e){1===this._alpha&&this._currentIndex+this._alpha<this._trajectory.length&&(this._currentIndex+=1,this._smoothing=this._trajectory.length<3&&this._currentIndex+1===this._trajectory.length,this._setCurrent(),this._resetTransition(),this._clearRotation(),this._desiredZoom=Qh(this._currentImage.cameraType)?this._zoom:0,this._desiredLookat=null);let t=this._animationSpeed*e/.1*6;this._baseAlpha=Math.min(1,this._baseAlpha+this._speedCoefficient*t),this._smoothing?this._alpha=ar.smootherstep(this._baseAlpha,0,1):this._alpha=this._baseAlpha,this._updateRotation(),this._rotationDelta.isZero||(this._applyRotation(this._rotationDelta,this._previousCamera),this._applyRotation(this._rotationDelta,this._currentCamera)),this._updateRotationBasic(),0===this._basicRotation[0]&&0===this._basicRotation[1]||this._applyRotationBasic(this._basicRotation),this._updateZoom(t),this._updateLookat(t),this._camera.lerpCameras(this._previousCamera,this._currentCamera,this.alpha)}_getAlpha(){return this._motionless?Math.ceil(this._alpha):this._alpha}_setCurrentCamera(){super._setCurrentCamera(),this._adjustCameras()}_adjustCameras(){if(null==this._previousImage)return;let e=this._camera.lookat.clone().sub(this._camera.position);this._previousCamera.lookat.copy(e.clone().add(this._previousCamera.position)),Qh(this._currentImage.cameraType)&&this._currentCamera.lookat.copy(e.clone().add(this._currentCamera.position))}_resetTransition(){this._alpha=0,this._baseAlpha=0,this._motionless=this._motionlessTransition()}}class ES extends vS{constructor(e){super(e),this._zoom=0,this._adjustCameras(),this._motionless=this._motionlessTransition()}prepend(e){super.prepend(e),this._motionless=this._motionlessTransition()}set(e){super.set(e),this._motionless=this._motionlessTransition()}move(e){this._alpha=Math.max(0,Math.min(1,this._alpha+e))}moveTo(e){this._alpha=Math.max(0,Math.min(1,e))}update(){this._camera.lerpCameras(this._previousCamera,this._currentCamera,this.alpha)}_getAlpha(){return this._motionless?Math.round(this._alpha):this._alpha}_setCurrentCamera(){super._setCurrentCamera(),this._adjustCameras()}_adjustCameras(){if(null!=this._previousImage){if(Qh(this._currentImage.cameraType)){let e=this._camera.lookat.clone().sub(this._camera.position);this._currentCamera.lookat.copy(e.clone().add(this._currentCamera.position))}if(Qh(this._previousImage.cameraType)){let e=this._currentCamera.lookat.clone().sub(this._currentCamera.position);this._previousCamera.lookat.copy(e.clone().add(this._previousCamera.position))}}}}class CS{constructor(){const e=eg[eg.Custom],t=eg[eg.Earth],i=eg[eg.Traversing],r=eg[eg.Waiting],n=eg[eg.WaitingInteractively];this._creators=new Map;const a=this._creators;a.set(e,xS),a.set(t,bS),a.set(i,TS),a.set(r,ES),a.set(n,MS),this._transitions=new Map;const o=this._transitions;o.set(e,[t,i]),o.set(t,[e,i]),o.set(i,[e,t,r,n]),o.set(r,[i,n]),o.set(n,[i,r])}getState(e){if(e instanceof xS)return eg.Custom;if(e instanceof bS)return eg.Earth;if(e instanceof TS)return eg.Traversing;if(e instanceof ES)return eg.Waiting;if(e instanceof MS)return eg.WaitingInteractively;throw new Error("Invalid state instance")}generate(e,t){return new(this._creators.get(eg[e]))(t)}transition(e,t){if(!this.validate(e,t))throw new Error("Invalid transition");return this.generate(t,e)}validate(e,t){const i=eg[this.getState(e)],r=eg[t],n=this._transitions;return n.has(i)&&n.get(i).includes(r)}}class AS{constructor(e,t){this._transitions=new CS,this._state=this._transitions.generate(e,{alpha:1,camera:new tS,currentIndex:-1,reference:{alt:0,lat:0,lng:0},trajectory:[],transitionMode:null==t?Kw.Default:t,zoom:0})}get state(){return this._transitions.getState(this._state)}get reference(){return this._state.reference}get alpha(){return this._state.alpha}get stateTransitionAlpha(){return this._state.stateTransitionAlpha}get camera(){return this._state.camera}get zoom(){return this._state.zoom}get currentImage(){return this._state.currentImage}get previousImage(){return this._state.previousImage}get currentCamera(){return this._state.currentCamera}get currentTransform(){return this._state.currentTransform}get previousTransform(){return this._state.previousTransform}get trajectory(){return this._state.trajectory}get currentIndex(){return this._state.currentIndex}get lastImage(){return this._state.trajectory[this._state.trajectory.length-1]}get imagesAhead(){return this._state.trajectory.length-1-this._state.currentIndex}get motionless(){return this._state.motionless}custom(){this._transition(eg.Custom)}earth(){this._transition(eg.Earth)}traverse(){this._transition(eg.Traversing)}wait(){this._transition(eg.Waiting)}waitInteractively(){this._transition(eg.WaitingInteractively)}getCenter(){return this._state.getCenter()}setCenter(e){this._state.setCenter(e)}setZoom(e){this._state.setZoom(e)}update(e){this._state.update(e)}append(e){this._state.append(e)}prepend(e){this._state.prepend(e)}remove(e){this._state.remove(e)}clear(){this._state.clear()}clearPrior(){this._state.clearPrior()}cut(){this._state.cut()}set(e){this._state.set(e)}setViewMatrix(e){this._state.setViewMatrix(e)}rotate(e){this._state.rotate(e)}rotateUnbounded(e){this._state.rotateUnbounded(e)}rotateWithoutInertia(e){this._state.rotateWithoutInertia(e)}rotateBasic(e){this._state.rotateBasic(e)}rotateBasicUnbounded(e){this._state.rotateBasicUnbounded(e)}rotateBasicWithoutInertia(e){this._state.rotateBasicWithoutInertia(e)}rotateToBasic(e){this._state.rotateToBasic(e)}move(e){this._state.move(e)}moveTo(e){this._state.moveTo(e)}zoomIn(e,t){this._state.zoomIn(e,t)}setSpeed(e){this._state.setSpeed(e)}setTransitionMode(e){this._state.setTransitionMode(e)}dolly(e){this._state.dolly(e)}orbit(e){this._state.orbit(e)}truck(e){this._state.truck(e)}_transition(e){if(!this._transitions.validate(this._state,e)){const t=this._transitions.getState(this._state);return void console.warn(`Transition not valid (${eg[t]} - ${eg[e]})`)}const t=this._transitions.transition(this._state,e);this._state=t}}class IS{constructor(e,t){this._appendImage$=new he,this._clock=new hh,this._subscriptions=new Tm;const i=this._subscriptions;this._start$=new he,this._frame$=new he,this._contextOperation$=new de((e=>e)),this._context$=this._contextOperation$.pipe(ei(((e,t)=>t(e)),new AS(e,t)),Jt(1),le()),this._state$=this._context$.pipe(tt((e=>e.state)),Vt(),Jt(1),le()),this._currentState$=this._frame$.pipe(ui(this._context$,((e,t)=>[e,t])),Ct((e=>null!=e[1].currentImage)),ci((e=>{e[1].update(this._clock.getDelta())})),tt((e=>({fps:60,id:e[0],state:e[1]}))),ti()),this._lastState$=this._currentState$.pipe(Jt(1),le());let r=this._currentState$.pipe(Vt(void 0,(e=>e.state.currentImage.id)),Jt(1),le()),n=new he;i.push(r.subscribe(n)),this._currentId$=new de(null),i.push(n.pipe(tt((e=>e.state.currentImage.id))).subscribe(this._currentId$)),this._currentImage$=n.pipe(tt((e=>e.state.currentImage)),Jt(1),le()),this._currentCamera$=n.pipe(tt((e=>e.state.currentCamera)),Jt(1),le()),this._currentTransform$=n.pipe(tt((e=>e.state.currentTransform)),Jt(1),le()),this._reference$=n.pipe(tt((e=>e.state.reference)),Vt(((e,t)=>e.lat===t.lat&&e.lng===t.lng),(e=>({lat:e.lat,lng:e.lng}))),Jt(1),le()),this._currentImageExternal$=r.pipe(tt((e=>e.state.currentImage)),Jt(1),le()),i.push(this._appendImage$.pipe(tt((e=>t=>(t.append([e]),t)))).subscribe(this._contextOperation$)),this._inMotionOperation$=new he,i.push(r.pipe(tt((()=>!0))).subscribe(this._inMotionOperation$)),i.push(this._inMotionOperation$.pipe(Vt(),Ct((e=>e)),oi((()=>this._currentState$.pipe(Ct((e=>0===e.state.imagesAhead)),tt((e=>[e.state.camera.clone(),e.state.zoom])),Yt(),tt((e=>{let t=e[0][0],i=e[1][0],r=e[0][1],n=e[1][1];return t.diff(i)>1e-5||Math.abs(r-n)>1e-5})),Ht((e=>!e)))))).subscribe(this._inMotionOperation$)),this._inMotion$=this._inMotionOperation$.pipe(Vt(),Jt(1),le()),this._inTranslationOperation$=new he,i.push(r.pipe(tt((()=>!0))).subscribe(this._inTranslationOperation$)),i.push(this._inTranslationOperation$.pipe(Vt(),Ct((e=>e)),oi((()=>this._currentState$.pipe(Ct((e=>0===e.state.imagesAhead)),tt((e=>e.state.camera.position.clone())),Yt(),tt((e=>0!==e[0].distanceToSquared(e[1]))),Ht((e=>!e)))))).subscribe(this._inTranslationOperation$)),this._inTranslation$=this._inTranslationOperation$.pipe(Vt(),Jt(1),le()),i.push(this._state$.subscribe((()=>{}))),i.push(this._currentImage$.subscribe((()=>{}))),i.push(this._currentCamera$.subscribe((()=>{}))),i.push(this._currentTransform$.subscribe((()=>{}))),i.push(this._reference$.subscribe((()=>{}))),i.push(this._currentImageExternal$.subscribe((()=>{}))),i.push(this._lastState$.subscribe((()=>{}))),i.push(this._inMotion$.subscribe((()=>{}))),i.push(this._inTranslation$.subscribe((()=>{}))),this._frameId=null,this._frameGenerator=new yS(window)}get currentState$(){return this._currentState$}get currentImage$(){return this._currentImage$}get currentId$(){return this._currentId$}get currentImageExternal$(){return this._currentImageExternal$}get currentCamera$(){return this._currentCamera$}get currentTransform$(){return this._currentTransform$}get state$(){return this._state$}get reference$(){return this._reference$}get inMotion$(){return this._inMotion$}get inTranslation$(){return this._inTranslation$}get appendImage$(){return this._appendImage$}dispose(){this.stop(),this._subscriptions.unsubscribe()}custom(){this._inMotionOperation$.next(!0),this._invokeContextOperation((e=>{e.custom()}))}earth(){this._inMotionOperation$.next(!0),this._invokeContextOperation((e=>{e.earth()}))}traverse(){this._inMotionOperation$.next(!0),this._invokeContextOperation((e=>{e.traverse()}))}wait(){this._invokeContextOperation((e=>{e.wait()}))}waitInteractively(){this._invokeContextOperation((e=>{e.waitInteractively()}))}appendImagess(e){this._invokeContextOperation((t=>{t.append(e)}))}prependImages(e){this._invokeContextOperation((t=>{t.prepend(e)}))}removeImages(e){this._invokeContextOperation((t=>{t.remove(e)}))}clearImages(){this._invokeContextOperation((e=>{e.clear()}))}clearPriorImages(){this._invokeContextOperation((e=>{e.clearPrior()}))}cutImages(){this._invokeContextOperation((e=>{e.cut()}))}setImages(e){this._invokeContextOperation((t=>{t.set(e)}))}setViewMatrix(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((t=>{t.setViewMatrix(e)}))}rotate(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((t=>{t.rotate(e)}))}rotateUnbounded(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((t=>{t.rotateUnbounded(e)}))}rotateWithoutInertia(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((t=>{t.rotateWithoutInertia(e)}))}rotateBasic(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((t=>{t.rotateBasic(e)}))}rotateBasicUnbounded(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((t=>{t.rotateBasicUnbounded(e)}))}rotateBasicWithoutInertia(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((t=>{t.rotateBasicWithoutInertia(e)}))}rotateToBasic(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((t=>{t.rotateToBasic(e)}))}move(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((t=>{t.move(e)}))}moveTo(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((t=>{t.moveTo(e)}))}dolly(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((t=>{t.dolly(e)}))}orbit(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((t=>{t.orbit(e)}))}truck(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((t=>{t.truck(e)}))}zoomIn(e,t){this._inMotionOperation$.next(!0),this._invokeContextOperation((i=>{i.zoomIn(e,t)}))}getCenter(){return this._lastState$.pipe(Ht(),tt((e=>e.state.getCenter())))}getZoom(){return this._lastState$.pipe(Ht(),tt((e=>e.state.zoom)))}setCenter(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((t=>{t.setCenter(e)}))}setSpeed(e){this._invokeContextOperation((t=>{t.setSpeed(e)}))}setTransitionMode(e){this._invokeContextOperation((t=>{t.setTransitionMode(e)}))}setZoom(e){this._inMotionOperation$.next(!0),this._invokeContextOperation((t=>{t.setZoom(e)}))}start(){this._clock.start(),null==this._frameId&&(this._start$.next(null),this._frameId=this._frameGenerator.requestAnimationFrame(this._frame.bind(this)),this._frame$.next(this._frameId))}stop(){this._clock.stop(),null!=this._frameId&&(this._frameGenerator.cancelAnimationFrame(this._frameId),this._frameId=null)}_invokeContextOperation(e){this._contextOperation$.next((t=>(e(t),t)))}_frame(){this._frameId=this._frameGenerator.requestAnimationFrame(this._frame.bind(this)),this._frame$.next(this._frameId)}}function PS(e){switch(e){case Zw.Custom:return eg.Custom;case Zw.Earth:return eg.Earth;case Zw.Street:return eg.Traversing;default:return null}}class zS{constructor(e,t,i,r,n,a,o,s){var l;t?this._api=t:e.dataProvider?this._api=new gS(e.dataProvider):this._api=new gS(new Gw({accessToken:e.accessToken})),this._graphService=null!==i&&void 0!==i?i:new _S(new ap(this.api)),this._loadingName="navigator",this._loadingService=null!==r&&void 0!==r?r:new dS;const c=null!==(l=e.cameraControls)&&void 0!==l?l:Zw.Street;this._stateService=null!==n&&void 0!==n?n:new IS(PS(c),e.transitionMode),this._cacheService=null!==a&&void 0!==a?a:new pS(this._graphService,this._stateService,this._api),this._playService=null!==o&&void 0!==o?o:new Bg(this._graphService,this._stateService),this._panService=null!==s&&void 0!==s?s:new mS(this._graphService,this._stateService,e.combinedPanning),this._idRequested$=new de(null),this._movedToId$=new de(null),this._request$=null,this._requestSubscription=null,this._imageRequestSubscription=null}get api(){return this._api}get cacheService(){return this._cacheService}get graphService(){return this._graphService}get loadingService(){return this._loadingService}get movedToId$(){return this._movedToId$}get panService(){return this._panService}get playService(){return this._playService}get stateService(){return this._stateService}dispose(){this._abortRequest("viewer removed"),this._cacheService.stop(),this._graphService.dispose(),this._panService.dispose(),this._playService.dispose(),this._stateService.dispose()}moveTo$(e){this._abortRequest(`to id ${e}`),this._loadingService.startLoading(this._loadingName);const t=this._moveTo$(e);return this._makeRequest$(t)}moveDir$(e){this._abortRequest(`in dir ${Hh[e]}`),this._loadingService.startLoading(this._loadingName);const t=this.stateService.currentImage$.pipe(Ht(),ft((t=>([Hh.Next,Hh.Prev].indexOf(e)>-1?t.sequenceEdges$:t.spatialEdges$).pipe(Ht(),tt((t=>{for(let i of t.edges)if(i.data.direction===e)return i.target;return null}))))),ft((t=>null==t?(this._loadingService.stopLoading(this._loadingName),Xe(new Error(`Direction (${e}) does not exist for current image.`))):this._moveTo$(t))));return this._makeRequest$(t)}setFilter$(e){return this._stateService.clearImages(),this._movedToId$.pipe(Ht(),ft((t=>null!=t?this._trajectoryIds$().pipe(ft((t=>this._graphService.setFilter$(e).pipe(ft((()=>this._cacheIds$(t)))))),Zt()):this._idRequested$.pipe(Ht(),ft((t=>null!=t?this._graphService.setFilter$(e).pipe(ft((()=>this._graphService.cacheImage$(t)))):this._graphService.setFilter$(e).pipe(tt((()=>{})))))))),tt((()=>{})))}setAccessToken$(e){return this._abortRequest("to set user token"),this._stateService.clearImages(),this._movedToId$.pipe(Ht(),ci((()=>{this._api.setAccessToken(e)})),ft((e=>null==e?this._graphService.reset$([]):this._trajectoryIds$().pipe(ft((e=>this._graphService.reset$(e).pipe(ft((()=>this._cacheIds$(e)))))),Zt(),tt((()=>{}))))))}_cacheIds$(e){return Oe(e.map((e=>this._graphService.cacheImage$(e)))).pipe(mt())}_abortRequest(e){null!=this._requestSubscription&&(this._requestSubscription.unsubscribe(),this._requestSubscription=null),null!=this._imageRequestSubscription&&(this._imageRequestSubscription.unsubscribe(),this._imageRequestSubscription=null),null!=this._request$&&(this._request$.isStopped||this._request$.hasError||this._request$.error(new Rm(`Request aborted by a subsequent request ${e}.`)),this._request$=null)}_makeRequest$(e){const t=new me(1);return this._requestSubscription=t.subscribe(void 0,(()=>{})),this._request$=t,this._imageRequestSubscription=e.subscribe((e=>{this._request$=null,t.next(e),t.complete()}),(e=>{this._request$=null,t.error(e)})),t}_moveTo$(e){return this._idRequested$.next(e),this._graphService.cacheImage$(e).pipe(ci((e=>{this._stateService.setImages([e]),this._movedToId$.next(e.id)})),Gt((()=>{this._loadingService.stopLoading(this._loadingName)})))}_trajectoryIds$(){return this._stateService.currentState$.pipe(Ht(),tt((e=>e.state.trajectory.map((e=>e.id)))))}}class RS{constructor(e,t){this._spatial=null!==t&&void 0!==t?t:new Kh,this._viewportCoords=null!==e&&void 0!==e?e:new Im}basicToCanvas(e,t,i,r){return this._viewportCoords.basicToCanvasSafe(e[0],e[1],t,r,i.perspective)}canvasToBasic(e,t,i,r){let n=this._viewportCoords.canvasToBasic(e[0],e[1],t,r,i.perspective);return(n[0]<0||n[0]>1||n[1]<0||n[1]>1)&&(n=null),n}eventToUnprojection(e,t,i,r,n){const a=this._viewportCoords.canvasPosition(e,t);return this.canvasToUnprojection(a,t,i,r,n)}canvasToUnprojection(e,t,i,r,n){const a=e[0],o=e[1],[s,l]=this._viewportCoords.canvasToViewport(a,o,t),c=new xr(s,l,1).unproject(i.perspective);let u=n.projectBasic(c.toArray());(u[0]<0||u[0]>1||u[1]<0||u[1]>1)&&(u=null);const h=c.clone().sub(i.camera.position).normalize(),p=-2/h.z;let d=null;if(p>0&&p<100&&u){const e=h.clone().multiplyScalar(p).add(i.camera.position),[t,n]=Nh(e.x,e.y,e.z,r.lng,r.lat,r.alt);d={lat:n,lng:t}}return{basicPoint:u,lngLat:d,pixelPoint:[a,o]}}cameraToLngLat(e,t){const i=e.camera.position,[r,n]=Nh(i.x,i.y,i.z,t.lng,t.lat,t.alt);return{lat:n,lng:r}}lngLatToCanvas(e,t,i,r){const n=Oh(e.lng,e.lat,0,r.lng,r.lat,r.alt);return this._viewportCoords.projectToCanvasSafe(n,t,i.perspective)}distanceBetweenLngLats(e,t){return this._spatial.distanceFromLngLat(e.lng,e.lat,t.lng,t.lat)}}class kS{constructor(e,t,i){this._subscriptions=new Tm,this._emitSubscriptions=new Tm,this._container=i,this._viewer=e,this._navigator=t,this._projection=new RS,this._started=!1,this._navigable$=new he;const r=this._subscriptions;r.push(this._navigable$.subscribe((e=>{const t="navigable",i={navigable:e,target:this._viewer,type:t};this._viewer.fire(t,i)}))),r.push(this._navigator.loadingService.loading$.subscribe((e=>{const t="dataloading",i={loading:e,target:this._viewer,type:t};this._viewer.fire(t,i)}))),r.push(this._container.glRenderer.opaqueRender$.pipe(Ht()).subscribe((()=>{const e="load",t={target:this._viewer,type:e};this._viewer.fire(e,t)})))}get started(){return this._started}get navigable$(){return this._navigable$}get projection(){return this._projection}dispose(){this.stopEmit(),this._subscriptions.unsubscribe()}project$(e){return ut(this._container.renderService.renderCamera$,this._navigator.stateService.currentImage$,this._navigator.stateService.reference$).pipe(Ht(),tt((([t,i,r])=>{if(this._projection.distanceBetweenLngLats(e,i.lngLat)>1e3)return null;const n=this._projection.lngLatToCanvas(e,this._container.container,t,r);return n?[Math.round(n[0]),Math.round(n[1])]:null})))}projectBasic$(e){return ut(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$).pipe(Ht(),tt((([t,i])=>{const r=this._projection.basicToCanvas(e,this._container.container,t,i);return r?[Math.round(r[0]),Math.round(r[1])]:null})))}startEmit(){if(this._started)return;this._started=!0;const e=this._emitSubscriptions;e.push(this._navigator.stateService.currentImageExternal$.subscribe((e=>{const t="image",i={image:e,target:this._viewer,type:t};this._viewer.fire(t,i)}))),e.push(this._navigator.stateService.currentImageExternal$.pipe(oi((e=>e.sequenceEdges$))).subscribe((e=>{const t="sequenceedges",i={status:e,target:this._viewer,type:t};this._viewer.fire(t,i)}))),e.push(this._navigator.stateService.currentImageExternal$.pipe(oi((e=>e.spatialEdges$))).subscribe((e=>{const t="spatialedges",i={status:e,target:this._viewer,type:t};this._viewer.fire(t,i)}))),e.push(this._navigator.stateService.reference$.subscribe((e=>{const t="reference",i={reference:e,target:this._viewer,type:t};this._viewer.fire(t,i)}))),e.push(ut(this._navigator.stateService.inMotion$,this._container.mouseService.active$,this._container.touchService.active$).pipe(tt((e=>e[0]||e[1]||e[2])),Vt()).subscribe((e=>{const t=e?"movestart":"moveend",i={target:this._viewer,type:t};this._viewer.fire(t,i)}))),e.push(this._container.renderService.bearing$.pipe(It(100),Vt(((e,t)=>Math.abs(t-e)<1))).subscribe((e=>{const t="bearing",i={bearing:e,target:this._viewer,type:t};this._viewer.fire(t,i)})));const t=this._container.mouseService.active$.pipe(oi((e=>e?Me():this._container.mouseService.mouseMove$)));e.push(Mt(this._mapMouseEvent$("click",this._container.mouseService.staticClick$),this._mapMouseEvent$("contextmenu",this._container.mouseService.contextMenu$),this._mapMouseEvent$("dblclick",this._container.mouseService.dblClick$),this._mapMouseEvent$("mousedown",this._container.mouseService.mouseDown$),this._mapMouseEvent$("mousemove",t),this._mapMouseEvent$("mouseout",this._container.mouseService.mouseOut$),this._mapMouseEvent$("mouseover",this._container.mouseService.mouseOver$),this._mapMouseEvent$("mouseup",this._container.mouseService.mouseUp$)).pipe(ui(this._container.renderService.renderCamera$,this._navigator.stateService.reference$,this._navigator.stateService.currentTransform$,this._navigator.stateService.state$),tt((([[e,t],i,r,n,a])=>{const o=this._projection.eventToUnprojection(t,this._container.container,i,r,n);return{basicPoint:a===eg.Traversing?o.basicPoint:null,lngLat:o.lngLat,originalEvent:t,pixelPoint:o.pixelPoint,target:this._viewer,type:e}}))).subscribe((e=>{this._viewer.fire(e.type,e)}))),e.push(this._container.renderService.renderCamera$.pipe(Vt((([e,t],[i,r])=>this._closeTo(e,i,.01)&&this._closeTo(t,r,.01)),(e=>e.camera.position.toArray()))).subscribe((()=>{const e="position",t={target:this._viewer,type:e};this._viewer.fire(e,t)}))),e.push(this._container.renderService.renderCamera$.pipe(Vt((([e,t],[i,r])=>this._closeTo(e,i,.001)&&this._closeTo(t,r,.001)),(e=>[e.rotation.phi,e.rotation.theta]))).subscribe((()=>{const e={target:this._viewer,type:"pov"};this._viewer.fire("pov",e)}))),e.push(this._container.renderService.renderCamera$.pipe(Vt(((e,t)=>this._closeTo(e,t,.01)),(e=>e.perspective.fov))).subscribe((()=>{const e={target:this._viewer,type:"fov"};this._viewer.fire("fov",e)})))}stopEmit(){this.started&&(this._emitSubscriptions.unsubscribe(),this._started=!1)}unproject$(e){return ut(this._container.renderService.renderCamera$,this._navigator.stateService.reference$,this._navigator.stateService.currentTransform$).pipe(Ht(),tt((([t,i,r])=>this._projection.canvasToUnprojection(e,this._container.container,t,i,r).lngLat)))}unprojectBasic$(e){return ut(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$).pipe(Ht(),tt((([t,i])=>this._projection.canvasToBasic(e,this._container.container,t,i))))}_closeTo(e,t,i){return Math.abs(e-t)<=i}_mapMouseEvent$(e,t){return t.pipe(tt((t=>[e,t])))}}class LS{constructor(e,t){this._container=e,this._navigator=t,this._renderers={}}add(e,t){const i=new Tm;this._renderers[e.id]={subs:i,renderer:e},i.push(ut([this._container.glRenderer.webGLRenderer$,this._navigator.stateService.reference$]).pipe(Nt(1)).subscribe((([i,r])=>{e.onAdd(t,r,i.getContext())}))),i.push(this._container.glRenderer.opaqueRender$.pipe(ui(this._container.renderService.renderCamera$,this._container.glRenderer.webGLRenderer$)).subscribe((([,t,i])=>{const r=i.getContext(),n=t.perspective.matrixWorldInverse,a=t.perspective.projectionMatrix;e.render(r,n.toArray(),a.toArray())}))),i.push(this._navigator.stateService.reference$.pipe(ri(1)).subscribe((i=>{e.onReference(t,i)})))}dispose(e){for(const t of Object.keys(this._renderers))this.remove(t,e)}has(e){return e in this._renderers}remove(e,t){this._renderers[e].subs.unsubscribe();const i=this._renderers[e].renderer;delete this._renderers[e],this._container.glRenderer.webGLRenderer$.subscribe((e=>{i.onRemove(t,e.getContext())}))}}class DS{constructor(e,t){this._container=e,this._navigator=t,this._controls=null,this._subscriptions=new Tm}attach(e,t){if(this._controls)throw new Xh("Custom camera controls already attached");this._controls=e;const i=new he,r=i.pipe(oi((()=>this._navigator.stateService.state$)),tt((e=>e===eg.Custom)),Vt()),n=this._subscriptions;n.push(r.pipe(ai(!1),Yt(),ui(this._navigator.stateService.reference$,this._container.renderService.renderCamera$)).subscribe((([[i,r],n,a])=>{r?e.onActivate(t,a.perspective.matrixWorldInverse.toArray(),a.perspective.projectionMatrix.toArray(),n):i&&e.onDeactivate(t)}))),n.push(r.pipe(oi((e=>e?this._navigator.stateService.currentState$.pipe(ri(1)):Me()))).subscribe((i=>{e.onAnimationFrame(t,i.id)}))),n.push(r.pipe(oi((e=>e?this._navigator.stateService.reference$.pipe(ri(1)):Me()))).subscribe((i=>e.onReference(t,i)))),n.push(r.pipe(oi((e=>e?this._container.renderService.size$.pipe(ri(1)):Me()))).subscribe((()=>e.onResize(t)))),n.push(ut([this._container.glRenderer.webGLRenderer$,this._container.renderService.renderCamera$,this._navigator.stateService.reference$,this._navigator.stateService.state$]).pipe(Ht()).subscribe((()=>{e.onAttach(t,(t=>{this._controls&&e===this._controls&&this._updateViewMatrix(t)}),(t=>{this._controls&&e===this._controls&&this._updateProjectionMatrix(t)})),i.next(),i.complete()})))}detach(e){const t=this._controls;return this._controls=null,this._subscriptions.unsubscribe(),new Promise((i=>{this._navigator.stateService.state$.pipe(Nt(1)).subscribe((r=>{t?(r===eg.Custom&&t.onDeactivate(e),t.onDetach(e),i(t)):i(null)}))}))}dispose(e){this.detach(e)}has(e){return!!this._controls&&e===this._controls}_updateProjectionMatrix(e){this._navigator.stateService.state$.pipe(Ht()).subscribe((t=>{if(t===eg.Custom)this._container.renderService.projectionMatrix$.next(e);else{const e="Incorrect camera control mode for projection matrix update";console.warn(e)}}))}_updateViewMatrix(e){this._navigator.stateService.state$.pipe(Ht()).subscribe((t=>{if(t===eg.Custom)this._navigator.stateService.setViewMatrix(e);else{const e="Incorrect camera control mode for view matrix update";console.warn(e)}}))}}class BS extends Mm{constructor(e){super(),this._navigator=new zS(e),this._container=new hS(e,this._navigator.stateService),this._observer=new kS(this,this._navigator,this._container),this._componentController=new Jw(this._container,this._navigator,this._observer,e.imageId,e.component),this._customRenderer=new LS(this._container,this._navigator),this._customCameraControls=new DS(this._container,this._navigator)}get dataProvider(){return this._navigator.api.data}get isNavigable(){return this._componentController.navigable}activateCombinedPanning(){this._navigator.panService.enable()}activateComponent(e){this._componentController.activate(e)}activateCover(){this._componentController.activateCover()}addCustomRenderer(e){this._customRenderer.add(e,this)}attachCustomCameraControls(e){this._customCameraControls.attach(e,this)}deactivateCombinedPanning(){this._navigator.panService.disable()}deactivateComponent(e){this._componentController.deactivate(e)}deactivateCover(){this._componentController.deactivateCover()}detachCustomCameraControls(){return this._customCameraControls.detach(this)}fire(e,t){super.fire(e,t)}getBearing(){return new Promise(((e,t)=>{this._container.renderService.bearing$.pipe(Ht()).subscribe((t=>{e(t)}),(e=>{t(e)}))}))}getCameraControls(){return new Promise(((e,t)=>{this._navigator.stateService.state$.pipe(Ht()).subscribe((t=>{switch(t){case eg.Custom:e(Zw.Custom);break;case eg.Earth:e(Zw.Earth);break;default:e(Zw.Street)}}),(e=>{t(e)}))}))}getCanvas(){return this._container.canvas}getCanvasContainer(){return this._container.canvasContainer}getCenter(){return new Promise(((e,t)=>{this._navigator.stateService.getCenter().subscribe((t=>{e(t)}),(e=>{t(e)}))}))}getComponent(e){return this._componentController.get(e)}getContainer(){return this._container.container}getFieldOfView(){return new Promise(((e,t)=>{this._container.renderService.renderCamera$.pipe(Ht()).subscribe((t=>{e(t.perspective.fov)}),(e=>{t(e)}))}))}getImage(){return new Promise(((e,t)=>{this._navigator.stateService.currentImage$.pipe(Ht()).subscribe((t=>{e(t)}),(e=>{t(e)}))}))}getPointOfView(){return new Promise(((e,t)=>{ut(this._container.renderService.renderCamera$,this._container.renderService.bearing$).pipe(Ht()).subscribe((([t,i])=>{e({bearing:i,tilt:t.getTilt()})}),(e=>{t(e)}))}))}getPosition(){return new Promise(((e,t)=>{ut(this._container.renderService.renderCamera$,this._navigator.stateService.reference$).pipe(Ht()).subscribe((([t,i])=>{e(this._observer.projection.cameraToLngLat(t,i))}),(e=>{t(e)}))}))}getReference(){return new Promise(((e,t)=>{this._navigator.stateService.reference$.pipe(Ht()).subscribe((t=>{e(t)}),(e=>{t(e)}))}))}getZoom(){return new Promise(((e,t)=>{this._navigator.stateService.getZoom().subscribe((t=>{e(t)}),(e=>{t(e)}))}))}hasCustomCameraControls(e){return this._customCameraControls.has(e)}hasCustomRenderer(e){return this._customRenderer.has(e)}moveDir(e){const t=this.isNavigable?this._navigator.moveDir$(e):Xe(new Error("Calling moveDir is not supported when viewer is not navigable."));return new Promise(((e,i)=>{t.subscribe((t=>{e(t)}),(e=>{i(e)}))}))}moveTo(e){const t=this.isNavigable?this._navigator.moveTo$(e):Xe(new Error("Calling moveTo is not supported when viewer is not navigable."));return new Promise(((e,i)=>{t.subscribe((t=>{e(t)}),(e=>{i(e)}))}))}off(e,t){super.off(e,t)}on(e,t){super.on(e,t)}project(e){return new Promise(((t,i)=>{this._observer.project$(e).subscribe((e=>{t(e)}),(e=>{i(e)}))}))}projectFromBasic(e){return new Promise(((t,i)=>{this._observer.projectBasic$(e).subscribe((e=>{t(e)}),(e=>{i(e)}))}))}remove(){this._customRenderer.dispose(this),this._customCameraControls.dispose(this),this._observer.dispose(),this._componentController.remove(),this._navigator.dispose(),this._container.remove();const e="remove",t={target:this,type:e};this.fire(e,t)}removeCustomRenderer(e){this._customRenderer.remove(e,this)}resize(){this._container.renderService.resize$.next()}setCameraControls(e){const t=PS(e);t===eg.Traversing?this._navigator.stateService.traverse():t===eg.Earth?this._navigator.stateService.earth():t===eg.Custom?this._navigator.stateService.custom():console.warn(`Unsupported camera control transition (${e})`)}setCenter(e){this._navigator.stateService.setCenter(e)}setFieldOfView(e){this._container.renderService.renderCamera$.pipe(Ht()).subscribe((t=>{const i=t.fovToZoom(e);this._navigator.stateService.setZoom(i)}))}setFilter(e){return new Promise(((t,i)=>{this._navigator.setFilter$(e).subscribe((()=>{t(void 0)}),(e=>{i(e)}))}))}setRenderMode(e){this._container.renderService.renderMode$.next(e)}setTransitionMode(e){this._navigator.stateService.setTransitionMode(e)}setAccessToken(e){const t=this.isNavigable?this._navigator.setAccessToken$(e):Xe(new Error("Calling setAccessToken is not supported when viewer is not navigable."));return new Promise(((e,i)=>{t.subscribe((()=>{e(void 0)}),(e=>{i(e)}))}))}setZoom(e){this._navigator.stateService.setZoom(e)}triggerRerender(){this._container.glRenderer.triggerRerender()}unproject(e){return new Promise(((t,i)=>{this._observer.unproject$(e).subscribe((e=>{t(e)}),(e=>{i(e)}))}))}unprojectToBasic(e){return new Promise(((t,i)=>{this._observer.unprojectBasic$(e).subscribe((e=>{t(e)}),(e=>{i(e)}))}))}}function FS(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return e.geometry.coordinates;if("Point"===e.type)return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}ap.register(Mp),op.register(Mp),Tp.registerCover(Cm),Tp.register(Am),Tp.register(Pm),Tp.register(zm),Tp.register(Dm),Tp.register(ng),Tp.register(ug),Tp.register(pg),Tp.register(Cg),Tp.register(Ig),Tp.register(zg),Tp.register(Dg),Tp.register(a_),Tp.register(lv),Tp.register(cv),Tp.register(uv),Tp.register(hv);var OS=function(e,t,i){void 0===i&&(i={});var r=FS(e),n=FS(t),a=m(n[1]-r[1]),o=m(n[0]-r[0]),s=m(r[1]),l=m(n[1]),c=Math.pow(Math.sin(a/2),2)+Math.pow(Math.sin(o/2),2)*Math.cos(s)*Math.cos(l);return d(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),i.units)},NS=i(254),VS=i.n(NS);function US(e,t,i){if(void 0===i&&(i={}),!0===i.final)return function(e,t){var i=US(t,e);return i=(i+180)%360}(e,t);var r=FS(e),n=FS(t),a=m(r[0]),o=m(n[0]),s=m(r[1]),l=m(n[1]),c=Math.sin(o-a)*Math.cos(l),u=Math.cos(s)*Math.sin(l)-Math.sin(s)*Math.cos(l)*Math.cos(o-a);return f(Math.atan2(c,u))}var $S=function(){function e(t,i){r(this,e),this.app=i,this.dateSelect=null,this.loading=!0,this.currentCoords=null,this.defaultMarker=null,this.markerComponent=null,this.sequence=null,this.container=document.getElementById(t),this.mly=null,this.mapillaryToken="MLY|4690399437648324|de87555bb6015affa20c3df794ebab15",this.markerStyle={ballColor:"white",ballOpacity:.5,color:"#feb70d",opacity:.55,interactive:!1,radius:2},this.createStreetView(this)}return a(e,[{key:"createStreetView",value:function(e){var t=document.createElement("article"),i=document.createElement("div"),r=document.createElement("div"),n=document.createElement("label"),a=document.createElement("select"),o=document.createElement("section"),s=document.createElement("article"),l=document.createElement("article");i.innerHTML='<i class="fas fa-street-view"></i> Street View',i.className="streetview-title",a.id="streetview-date",a.addEventListener("change",(function(t){e.changingImageDate(t,e)})),e.dateSelect=a,n.innerHTML='<i class="far fa-calendar-alt"></i> Date',n.setAttribute("for","streetview-date"),t.className="streetview-header",r.appendChild(n),r.className="streetview-date",r.appendChild(a),t.appendChild(i),t.appendChild(r),l.id="mly",s.innerHTML='\n        <article>\n          <div>\n            <div class="loader">\n              <div class="loader__bar"></div>\n              <div class="loader__bar"></div>\n              <div class="loader__bar"></div>\n              <div class="loader__bar"></div>\n              <div class="loader__bar"></div>\n              <div class="loader__ball"></div>\n            </div>\n            <p>LOADING</p>\n          </div>\n        </article>\n        ',e.loading?s.className="streetview-loader active":s.className="streetview-loader",o.className="streetview-imagery",o.appendChild(s),o.appendChild(l),e.container.appendChild(t),e.container.appendChild(o),e.getImageKey(e)}},{key:"setCameraIcon",value:function(e){e.app.map.map.getSource("mapillary").setData({type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[e.app.svCoords.lng,e.app.svCoords.lat]},properties:{bearing:e.app.svBearing-90}}]})}},{key:"loadImagery",value:function(e){e.setLoading(e,!1);try{e.mly=new BS({accessToken:e.mapillaryToken,component:{marker:!0,bearing:!1,cover:!0,attribution:!1,sequence:!1,cache:!0,direction:!0},container:"mly",imageId:e.app.currentImageKey.properties.id}),e.mly.deactivateCover(),e.mly.on("nodechanged",(function(t){e.app.svCoords=t.latLon})),e.mly.on("bearingchanged",(function(t){e.app.svBearing=t})),e.defaultMarker=new Ww("default-id",{lat:e.app.coords[1],lng:e.app.coords[0]},e.markerStyle),e.markerComponent=e.mly.getComponent("marker"),e.markerComponent.add([e.defaultMarker])}catch(t){console.log(t)}e.app.map.map.getSource("mapillary").setData({type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[e.app.svCoords[0],e.app.svCoords[1]]},properties:{bearing:e.app.svBearing-90}}]})}},{key:"removeImagery",value:function(e){var t=document.getElementById("mly");t.removeChild(t.childNodes[1]),t.removeChild(t.childNodes[0]),e.setLoading(e,!0)}},{key:"getImageKey",value:function(e){var t=VS()(e.app.imageKeys,(function(t){return OS(t.geometry,e.app.centroid)}));if(e.app.currentImageKey){var i=t.filter((function(t){return t.properties.sequence_id===e.app.currentImageKey.properties.sequence_id}));i.length>0?e.app.currentImageKey=i[0]:e.app.currentImageKey=t.slice(0,20).sort((function(e,t){return e.properties.captured_at<t.properties.captured_at}))[0]}else e.app.currentImageKey=t.slice(0,20).sort((function(e,t){return e.properties.captured_at<t.properties.captured_at}))[0];var r=l()(t,"properties.sequence_id").map((function(t){return{sequence_id:t.properties.sequence_id,image_id:t.properties.id,captured_at:t.properties.captured_at,readable_ts:e.getReadableDate(t.properties.captured_at)}})).sort((function(e,t){return t.captured_at>e.captured_at}));e.sequence=l()(r,"readable_ts");var n=t.sort((function(t,i){return e.buildDate(t.properties.captured_at)-e.buildDate(i.properties.captured_at)}));e.app.imageKeys=n,t.length?(e.app.svCoords=e.app.currentImageKey.geometry.coordinates,e.setCameraIcon(e),e.loadDateOptions(e),e.loadImagery(e)):e.setLoading(e,!1)}},{key:"loadDateOptions",value:function(e){e.sequence.forEach((function(t,i){var r=document.createElement("option");e.app.currentImageKey.properties.captured_at==t.captured_at&&(r.selected=!0),r.label=t.readable_ts,r.value=t.sequence_id,e.dateSelect.appendChild(r)}))}},{key:"getReadableDate",value:function(e){var t=new Date(e);return"".concat(t.toLocaleString("default",{month:"short"})," ").concat(t.getDate(),", ").concat(t.getFullYear())}},{key:"buildDate",value:function(e){return new Date(e)}},{key:"setLoading",value:function(e,t){t?(document.querySelector(".streetview-loader").className="streetview-loader active",e.loading=!0):(document.querySelector(".streetview-loader.active").className="streetview-loader",e.loading=!1)}},{key:"changingImageDate",value:function(e,t){t.setLoading(t,!0);var i=VS()(t.app.imageKeys,(function(e){return OS(e.geometry,t.app.centroid)})).filter((function(t){return t.properties.sequence_id==e.target.value}));t.mly.moveTo(i[0].properties.id).then((function(e){var i=e._core.geometry.coordinates?e._core.geometry.coordinates:[e._core.geometry.lng,e._core.geometry.lat],r=t.app.centroid;t.setBearing(t,e,t.mly,i,r)})),t.app.svCoords=t.app.currentImageKey.geometry.coordinates,t.setCameraIcon(t),t.setLoading(t,!1)}},{key:"wrap",value:function(e,t,i){for(var r=i-t;e>i||e<t;)e>i?e-=r:e<t&&(e+=r);return e}},{key:"bearingToBasic",value:function(e,t,i){var r=(t-i)/360+.5;return e.wrap(r,0,1)}},{key:"setBearing",value:function(e,t,i,r,n){if(t.fullPano){var a=t.computedCA,o=US(r,n),s=[e.bearingToBasic(e,o,a),.45];i.setCenter(s)}}}]),e}(),jS=function(){function e(t){r(this,e),this.app=t,this.calculator=null,this.filters=null,this.data=null,this.panels=[],this.dashLast="city",this.streetview=null,this.formatter=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"})}return a(e,[{key:"closePanel",value:function(e,t){var i=e.target.parentNode.parentNode.className;i=i.split(" "),e.target.parentNode.parentNode.className=i[0];try{for(;e.target.parentNode.firstChild;)e.target.parentNode.removeChild(e.target.parentNode.firstChild)}catch(r){}t.panels.pop()}},{key:"buildPropertyInfo",value:function(e){var t=null;return null!=e.app.propertyData.saledate&&(t=new Date(e.app.propertyData.saledate)),"\n        <h2>".concat(e.app.propertyData.propaddr,'</h2>\n        <section id="streetview"></section>\n        ').concat(e.checkSpecialCase(e),'\n        <section class="group">\n        <span class="header">KEY DATA<sup>*</sup></span>\n        <p><strong>Owner:</strong> ').concat(e.app.propertyData.taxpayer1,"</p>\n        <p><strong>Owner's Address:</strong> ").concat(e.app.propertyData.taxpaddr,"</p>\n        <p><strong>Zoning:</strong> ").concat(e.app.propertyData.zoning,"</p>\n        <p><strong>Council District:</strong> ").concat(e.app.propertyData.council,'</p>\n        </section>\n        <section class="group">\n        <span class="header">ADDITIONAL DATA</span>\n        ').concat(null!=t?"<p><strong>Last Sale Date:</strong> ".concat(t.getMonth()+1,"/").concat(t.getDate(),"/").concat(t.getFullYear(),"</p><p><strong>Last Sale Price:</strong> ").concat(e.formatter.format(e.app.propertyData.saleprice),"</p>"):"","\n        <p><strong>Parcel Number:</strong> ").concat(e.app.propertyData.parcelno,"</p>\n        <p><strong>Taxable Status:</strong> ").concat(e.app.propertyData.taxstatus,"</p>\n        <p><strong>Total Acreage:</strong> ").concat(e.app.propertyData.totalacreage,"</p>\n        <p><strong>Principal Residence Exemption:</strong> ").concat(e.app.propertyData.pre,"</p>\n        <p><strong>Frontage:</strong> ").concat(e.app.propertyData.frontage,"</p>\n        <p><strong>Depth:</strong> ").concat(e.app.propertyData.depth,"</p>\n        <p><strong>Ward:</strong> ").concat(e.app.propertyData.ward,"</p>\n        </section>\n        <small><sup>*</sup>City Owned Property data is sourced from the City of Detroit\u2019s Office of the Assessor. If you find any discrepancies please visit the Coleman A. Young Municipal Center at 2 Woodward Avenue - Suite 804 Detroit, Michigan 48226 or call (313) 224-3035</small>\n        ")}},{key:"createErrorMsg",value:function(e){var t=document.querySelector(".panel .panel-box"),i=document.createElement("button");i.innerText="x",i.className="close-section-btn",i.addEventListener("click",(function(t){t.preventDefault(),e.closePanel(t)})),t.innerHTML='\n        <svg xmlns="http://www.w3.org/2000/svg" width="100" height="70" viewBox="0 0 100 68">\n        <g id="large">\n            <path fill="none" stroke="#F44" d="M55.8 38.5l6.2-1.2c0-1.8-.1-3.5-.4-5.3l-6.3-.2c-.5-2-1.2-4-2.1-6l4.8-4c-.9-1.6-1.9-3-3-4.4l-5.6 3c-1.3-1.6-3-3-4.7-4.1l2-6A30 30 0 0 0 42 8l-3.3 5.4c-2-.7-4.2-1-6.2-1.2L31.3 6c-1.8 0-3.5.1-5.3.4l-.2 6.3c-2 .5-4 1.2-6 2.1l-4-4.8c-1.6.9-3 1.9-4.4 3l3 5.6c-1.6 1.3-3 3-4.1 4.7l-6-2A32.5 32.5 0 0 0 2 26l5.4 3.3c-.7 2-1 4.2-1.2 6.2L0 36.7c0 1.8.1 3.5.4 5.3l6.3.2c.5 2 1.2 4 2.1 6l-4.8 4c.9 1.6 1.9 3 3 4.4l5.6-3c1.4 1.6 3 3 4.7 4.1l-2 6A30.5 30.5 0 0 0 20 66l3.4-5.4c2 .7 4 1 6.1 1.2l1.2 6.2c1.8 0 3.5-.1 5.3-.4l.2-6.3c2-.5 4-1.2 6-2.1l4 4.8c1.6-.9 3-1.9 4.4-3l-3-5.6c1.6-1.3 3-3 4.1-4.7l6 2A32 32 0 0 0 60 48l-5.4-3.3c.7-2 1-4.2 1.2-6.2zm-13.5 4a12.5 12.5 0 1 1-22.6-11 12.5 12.5 0 0 1 22.6 11z"/>\n            <animateTransform attributeName="transform" begin="0s" dur="3s" from="0 31 37" repeatCount="indefinite" to="360 31 37" type="rotate"/>\n        </g>\n        <g id="small">\n            <path fill="none" stroke="#F44" d="M93 19.3l6-3c-.4-1.6-1-3.2-1.7-4.8L90.8 13c-.9-1.4-2-2.7-3.4-3.8l2.1-6.3A21.8 21.8 0 0 0 85 .7l-3.6 5.5c-1.7-.4-3.4-.5-5.1-.3l-3-5.9c-1.6.4-3.2 1-4.7 1.7L70 8c-1.5 1-2.8 2-3.9 3.5L60 9.4a20.6 20.6 0 0 0-2.2 4.6l5.5 3.6a15 15 0 0 0-.3 5.1l-5.9 3c.4 1.6 1 3.2 1.7 4.7L65 29c1 1.5 2.1 2.8 3.5 3.9l-2.1 6.3a21 21 0 0 0 4.5 2.2l3.6-5.6c1.7.4 3.5.5 5.2.3l2.9 5.9c1.6-.4 3.2-1 4.8-1.7L86 34c1.4-1 2.7-2.1 3.8-3.5l6.3 2.1a21.5 21.5 0 0 0 2.2-4.5l-5.6-3.6c.4-1.7.5-3.5.3-5.1zM84.5 24a7 7 0 1 1-12.8-6.2 7 7 0 0 1 12.8 6.2z"/>\n            <animateTransform attributeName="transform" begin="0s" dur="2s" from="0 78 21" repeatCount="indefinite" to="-360 78 21" type="rotate"/>\n        </g>\n        </svg>\n        <h3>No Information found.</h3>\n        ',t.prepend(i),document.querySelector("#app .panel").className="panel active"}},{key:"buildCityData",value:function(e){return'\n        <h2>City of Detroit</h2>\n        <img alt="Photo of Detroit" src="https://detroitmi.gov/sites/detroitmi.localhost/files/styles/de2e/public/2018-11/detroit1.jpg">\n        <section class="group">\n        <span class="header">DEMOGRAPHICS</span>\n        <p><strong>Population:</strong> '.concat(e.app.cityData[0].data[1][0].replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"),'</p>\n        </section>\n        <section class="group">\n        <span class="header">REAL ESTATE</span>\n        <p><strong>DLBA Properties:</strong> ').concat(e.app.cityData[2].data.count.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"),"</p>\n        <p><strong>Open BSEED Permits:</strong> ").concat(e.app.cityData[1].data.count.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"),'</p>\n        </section>\n        <section class="group">\n        <span class="header">INFRASTRUCTURE</span>\n        <p><strong>Police Stations:</strong> ').concat(e.app.cityData[3].data.count,"</p>\n        <p><strong>Fire Stations:</strong> ").concat(e.app.cityData[4].data.count,"</p>\n        <p><strong>Active Parks:</strong> ").concat(e.app.cityData[5].data.count,"</p>\n        </section>\n        ")}},{key:"buildInfo",value:function(e){return'\n        <h2>Map Information</h2>\n        <section class="group">\n        <span class="header">DATA</span>\n        <p>Opportunity Map data is sourced from the following: Detroit Open Data Portal, Detroit Land Bank Authority (DLBA), City of Detroit Assessors Office, Housing and Revitalization Department, Planning and Development Department, Buildings and Safety Engineering and Environment Department and Department of Transportation. In a few instances, DLBA data may be more up-to-date than the City of Detroit Assessors Office. For questions, please visit the <a href="https://detroitmi.gov/departments/office-chief-financial-officer/ocfo-divisions/office-assessor" target="_blank">City of Detroit Assessors Office.</a></p>\n        </section>\n        <section class="group">\n        <span class="header">GLOSSARY</span>\n        <p><strong>PUBLIC ASSETS</strong></p>\n        <p>Detroit Land Bank Authority (DLBA) and the City of Detroit (P&DD) owned properties identified as available for sale. However, please verify with the Detroit Building Authority and/or the DLBA for the most accurate information.</p>\n        <p><strong>PUBLIC LAND</strong></p>\n        <p>Detroit Land Bank Authority (DLBA) and the City of Detroit (P&DD) owned vacant parcels identified as available for sale. However, please verify with the Detroit Building Authority and/or the DLBA for the most accurate information.</p>\n        <p><strong>PUBLIC STRUCTURES</strong></p>\n        <p>Detroit Land Bank Authority (DLBA) and the City of Detroit (P&DD) owned buildings identified as available for sale. However, please verify with the Detroit Building Authority and/or the DLBA for the most accurate information.</p>\n        <p><strong>MARIJUANA LEGACY LAND</strong></p>\n        <p>The City of Detroit (P&DD) owned vacant parcels identified and specifically set aside as available for sale to certified Detroit Legacy Applicants for specific uses in the cannabis industry. Please refer to <a href="https://detroitmeansbusiness.org/homegrown/" target="_blank">Detroit Means Business</a> for more information.</p>\n        <p><strong>MARIJUANA LEGACY STRUCTURES</strong></p>\n        <p>The City of Detroit (P&DD) owned buildings identified and specifically set aside as available for sale to certified Detroit Legacy Applicants for specific uses in the cannabis industry. Please refer to <a href="https://detroitmeansbusiness.org/homegrown/" target="_blank">Detroit Means Business</a> for more information.</p>\n        <p><strong>PUBLIC SERVICE ASSETS</strong></p>\n        <ul>\n            <li>Fire Stations</li>\n            <li>Police Stations</li>\n            <li>Active Parks</li>\n        </ul>\n        <p><strong>PLANNING & HOUSING</strong></p>\n        <p>There are several planning areas for different purposes city wide, explainations are below:</p>\n        <ul>\n        <li>Targeted Multifamily Housing Areas \u2013 identify areas of the city with stronger housing markets and active commercial corridors. Developers of both market-rate and affordable housing, are encouraged to focus in these areas. To understand more, please check out the Housing & Revitalization Department <a href="https://detroitmi.gov/departments/housing-and-revitalization-department/developers-and-contractors" target="_blank">Developers Page.</a></li>\n        <li>Strategic Neighborhood Fund Investment Areas are areas that can access certain funding sources drawn from philanthropic contributions and public subsidies designed to improve Detroit neighborhoods.</li>\n        <li>Opportunity Zones are areas that can access certain federally funded incentives and economic tools to spur development.</li>\n        </ul>\n        <p><strong>ZONING</strong></p>\n        <p><strong>Residential Zoning</strong></p>\n        <ul>\n        <li>R1 Single-Family Residential District</li>\n        <li>R2 Two-Family Residential District</li>\n        <li>R3 Low Density Residential District</li>\n        <li>R4 Thoroughfare Residential District</li>\n        <li>R5 Medium Density Residential District</li>\n        <li>R6 High Density Residential District</li>\n        </ul>\n        <p><strong>Business / Commercial Zoning</strong></p>\n        <ul>\n        <li>B1 Restricted Business District</li>\n        <li>B2 Local Business and Residential District</li>\n        <li>B3 Shopping District</li>\n        <li>B4 General Business District</li>\n        <li>B5 Major Business District</li>\n        <li>B6 General Services District</li>\n        </ul>\n        <p><strong>Industrial District Zoning</strong></p>\n        <ul>\n        <li>M1 Limited Industrial District</li>\n        <li>M2 Restricted Industrial District</li>\n        <li>M3 General Industrial District</li>\n        <li>M4 Intensive Industrial District</li>\n        <li>M5 Special Industrial District</li>\n        </ul>\n        <p><strong>Special Districts</strong></p>\n        <ul>\n        <li>PD Planned Development District</li>\n        <li>P1 Open Parking District</li>\n        <li>PC Public Center District</li>\n        <li>PCA Public Center Adjacent District (Restricted Central business District)</li>\n        <li>TM Transitional-Industrial District</li>\n        <li>PR Parks and Recreation District</li>\n        <li>W1 Waterfront-Industrial District</li>\n        <li>SD1 Special Development District, Small-Scale, Mixed-Use</li>\n        <li>SD2 Special Development District, Mixed-Use</li>\n        <li>SD3 Special Development District, Technology and Research</li>\n        <li>SD4 Special Development District, Riverfront mixed use</li>\n        <li>SD5 Special Development District, Casinos</li>\n        <li>TM</li>\n        <li>W5</li>\n        </ul>\n        <p><strong>PUBLIC TRANSPORTATION</strong></p>\n        <ul>\n        <li>DDOT Buses - Detroit Department of Transportation Bus Routes</li>\n        <li>SMART Buses - Suburban Mobility Authority for Regional Transportation (SMART) is Southeast Michigan\'s only regional bus system</li>\n        <li>QLine - 3.3 mile streetcar that rides along the Woodward Corridor</li>     \n        <lip>People Mover - Elevated Train that routed throughout Downtown Detroit</li>\n        <li>MoGo Bike Sharing - Bike rentals across the greater downtown</li>\n        </ul>\n        </section>\n        '}},{key:"buildFilters",value:function(e){return'\n        <h2>Map Data Layers</h2>\n        <article id="filter-box">\n        </article>\n        '}},{key:"buildCalculator",value:function(e){return'\n        <section class="calculator">\n          <h2>Income Calculator</h2>\n          <article id="calc-box"></article>\n        </section>\n        '}},{key:"checkSpecialCase",value:function(e){var t=null;switch(e.app.specialProperty){case"city-land":t='<div class="buy-btn"><a href="https://detroitmi.gov/properties" target="_blank">Inquire to buy this land</a></div>';break;case"dlba-land":t='<div class="buy-btn"><a href="https://buildingdetroit.org/development-projects/" target="_blank">Inquire to buy this land</a></div>';break;case"city-structures":t='<div class="buy-btn"><a href="https://detroitmi.gov/properties" target="_blank">Inquire to buy this Property</a></div>';break;case"dlba-structures":t='<div class="buy-btn"><a href="https://buildingdetroit.org/development-projects/" target="_blank">Inquire to buy this Property</a></div>';break;default:t=""}return t}},{key:"createImagery",value:function(e){e.streetview=new $S("streetview",e.app)}},{key:"createPanel",value:function(e,t){var i=document.querySelector(".panel .panel-box"),r=document.createElement("button");switch(r.innerText="x",r.className="close-section-btn",r.addEventListener("click",(function(t){t.preventDefault(),e.closePanel(t,e)})),e.panels.includes(t)||e.panels.push(t),e.panels[e.panels.length-1]){case"dash":"city"==e.dashLast?i.innerHTML="".concat(e.buildCityData(e)):(i.innerHTML="".concat(e.buildPropertyInfo(e)),e.createImagery(e));break;case"filter":i.innerHTML="".concat(e.buildFilters(e)),e.filters=new b("filter-box",e.app);break;case"info":i.innerHTML="".concat(e.buildInfo(e))}i.prepend(r),document.querySelector("#app .panel").className="panel active",document.querySelector("#initial-loader-overlay").className=""}}]),e}(),qS=function(){function e(t,i){r(this,e),this.form=null,this._controller=i,this.init(document.getElementById(t),this)}return a(e,[{key:"init",value:function(e,t){var i=this,r=document.createElement("form"),n=document.createElement("label"),a=document.createElement("input"),o=(document.createElement("ul"),document.createElement("datalist")),s=document.createElement("i");r.addEventListener("submit",(function(e){i.submit(e,t)})),s.className="fas fa-map-marker-alt",n.innerText="Find Property:",n.setAttribute("for","geocoder-input"),a.type="text",a.setAttribute("list","addresses-list"),a.placeholder="Enter address",a.setAttribute("id","geocoder-input"),a.setAttribute("autocomplete","off"),a.addEventListener("keyup",(function(e){i.inputChange(e,t)})),o.setAttribute("id","addresses-list"),r.appendChild(n),r.appendChild(a),r.appendChild(s),r.appendChild(o),e.appendChild(r),this.form=r}},{key:"supplementGeocoder",value:function(e,t,i){var r=e.split(",");r=(r=r[0]).split(" ");var n="",a=r.length;r.forEach((function(e,t){n+=e,t<a&&t+1!==a&&(n+="+")}));var o="https://opengis.detroitmi.gov/opengis/rest/services/BaseUnits/BaseUnitGeocoder/GeocodeServer/findAddressCandidates?Address=&Address2=&Address3=&Neighborhood=&City=&Subregion=&Region=&Postal=&PostalExt=&CountryCode=&SingleLine=".concat(n,"&outFields=*&maxLocations=4&matchOutOfRange=true&langCode=&locationType=&sourceCountry=&category=&location=&distance=&searchExtent=&outSR=4326&magicKey=&f=json");try{fetch(o).then((function(e){return e.json()})).then((function(e){if("suggestions"===i)e.candidates.forEach((function(e){var i=document.createElement("option");""!=e.attributes.parcel_id&&(i.value=e.address,i.setAttribute("data-parsel",e.attributes.parcel_id)),i.onclick=function(e){t.selectSuggestion(e,t)},t.form.childNodes[3].appendChild(i)}));else{var r="https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/City_of_Detroit_Boundary/FeatureServer/0/query?where=&objectIds=&time=&geometry=".concat(e.candidates[0].location.x,"%2C+").concat(e.candidates[0].location.y,"&geometryType=esriGeometryPoint&inSR=4326&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=4326&returnGeometry=true&returnCentroid=false&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnDistinctValues=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=geojson&token=");try{fetch(r).then((function(e){return e.json()})).then((function(i){if(i.features.length){t._controller.panel.createErrorMsg(t._controller.panel);var r=null;e.candidates.forEach((function(e){""!=e.attributes.parcel_id&&t._controller.checkParcelValid(e.attributes.parcel_id)&&(r=e)})),null==r?e.candidates[0].location:null,t._controller.coords=[r.location.x,r.location.y],t._controller.parcel=r.attributes.parcel_id,t._controller.centroid=p([r.location.x,r.location.y]),t._controller.map.map.flyTo({center:[r.location.x,r.location.y],zoom:18,essential:!0}),t._controller.checkSpecialProperties(r.attributes.parcel_id,t._controller),t._controller.map.map.setFilter("parcels-highlight",["==","parcelno",r.attributes.parcel_id]),t.form.childNodes[1].value="",document.getElementById("initial-loader-overlay").className="active"}else t._controller.panel.createErrorMsg(t._controller.panel)}))}catch(n){t._controller.panel.createErrorMsg(t._controller.panel)}}}))}catch(s){t._controller.panel.createErrorMsg(t._controller.panel)}}},{key:"selectSuggestion",value:function(e,t){var i=null;"no-parcel"===(i="SPAN"===e.target.tagName?e.target.parentNode:e.target).attributes[0].value?(t.clearSuggestions(t),t.supplementGeocoder(i.innerText,t,"submit")):t.supplementGeocoder(i.innerText,t,"submit")}},{key:"inputChange",value:function(e,t){switch(e.key){case"Enter":""!=e.target.value&&void 0!=e.target.value&&t.supplementGeocoder(e.target.value,t,"submit");break;case"ArrowDown":case"ArrowUp":case"ArrowRight":case"ArrowLeft":break;case void 0:""!=e.target.value&&void 0!=e.target.value&&t.supplementGeocoder(e.target.value,t,"submit");break;default:t.clearSuggestions(t),t.supplementGeocoder(e.target.value,t,"suggestions")}}},{key:"clearSuggestions",value:function(e){for(;e.form.childNodes[3].firstChild;)e.form.childNodes[3].removeChild(e.form.childNodes[3].firstChild)}},{key:"submit",value:function(e,t){e.preventDefault(),t.supplementGeocoder(e.target[0].value,t,"submit")}}]),e}();window,new(function(){function e(){r(this,e),this.svCoords=null,this.svBearing=null,this.coord=null,this.imageKeys=null,this.centroid=null,this.currentImageKey=null,this.parcel=null,this.propertyData=null,this.point=null,this.map=new x("map",this),this.specialProperty=null,this.cityData=null,this.filters=[],this.zoning={r:[],b:[],m:[],s:[]},this.boundary=null,this.userControls=document.createElement("form"),this.panel=new jS(this),this.geocoder=new qS("geocoder",this),this.initialLoad(this)}return a(e,[{key:"initialLoad",value:function(e){e.getCityData(e),document.getElementById("close-welcome").addEventListener("click",(function(){document.getElementById("welcome-panel").className=""}));var t=document.createElement("button"),i=document.createElement("button"),r=document.createElement("button");t.innerHTML='<i class="fas fa-tachometer-alt"></i> <span>Dashboard</span>',t.addEventListener("click",(function(t){t.preventDefault(),e.panel.createPanel(e.panel,"dash")})),i.innerHTML='<i class="fas fa-layer-group"></i> <span>Data Layers</span>',i.addEventListener("click",(function(t){t.preventDefault(),e.panel.createPanel(e.panel,"filter")})),r.innerHTML='<i class="fas fa-info-circle"></i> <span>Info</span>',r.addEventListener("click",(function(t){t.preventDefault(),e.panel.createPanel(e.panel,"info")})),e.userControls.appendChild(t),e.userControls.appendChild(i),e.userControls.appendChild(r),document.getElementById("user-controls").appendChild(e.userControls)}},{key:"getParcelData",value:function(e){fetch("https://apis.detroitmi.gov/assessments/parcel/".concat(e.parcel)).then((function(e){return e.json()})).then((function(t){e.propertyData=t,e.panel.dashLast="parcel",e.panel.createPanel(e.panel,"dash")})).catch((function(e){}))}},{key:"getCityData",value:function(e){var t=new Promise((function(e,t){return fetch("https://api.census.gov/data/2019/pep/population?get=POP&in=state:26&for=place:22000").then((function(e){return e.json()})).then((function(t){e({id:"population",data:t})})).catch((function(e){}))})),i=new Promise((function(e,t){return fetch("https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/BuildingPermits/FeatureServer/0/query?where=1%3D1&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnGeometry=true&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=true&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=json").then((function(e){return e.json()})).then((function(t){e({id:"permits",data:t})})).catch((function(e){}))})),r=new Promise((function(e,t){return fetch("https://opengis.detroitmi.gov/opengis/rest/services/DLBA/DLBA/MapServer/10/query?where=1%3D1&text=&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&distance=&units=esriSRUnit_Foot&relationParam=&outFields=*&returnGeometry=true&returnTrueCurves=false&maxAllowableOffset=&geometryPrecision=&outSR=&havingClause=&returnIdsOnly=false&returnCountOnly=true&orderByFields=&groupByFieldsForStatistics=&outStatistics=&returnZ=false&returnM=false&gdbVersion=&historicMoment=&returnDistinctValues=false&resultOffset=&resultRecordCount=&returnExtentOnly=false&datumTransformation=&parameterValues=&rangeValues=&quantizationParameters=&featureEncoding=esriDefault&f=pjson").then((function(e){return e.json()})).then((function(t){e({id:"dlba-properties",data:t})})).catch((function(e){}))})),n=new Promise((function(e,t){return fetch("https://services2.arcgis.com/qvkbeam7Wirps6zC/ArcGIS/rest/services/Precinct_Buildings/FeatureServer/0/query?where=1%3D1&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=&returnGeometry=true&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=true&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pjson&token=").then((function(e){return e.json()})).then((function(t){e({id:"police",data:t})})).catch((function(e){}))})),a=new Promise((function(e,t){return fetch("https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/Firehouse_Locations/FeatureServer/0/query?where=1%3D1&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=&returnGeometry=true&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=true&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pjson&token=").then((function(e){return e.json()})).then((function(t){e({id:"fire",data:t})})).catch((function(e){}))})),o=new Promise((function(e,t){return fetch("https://services2.arcgis.com/qvkbeam7Wirps6zC/ArcGIS/rest/services/Parks_Marijuana/FeatureServer/0/query?where=1%3D1&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=&returnGeometry=true&returnCentroid=false&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=true&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pjson&token=").then((function(e){return e.json()})).then((function(t){e({id:"parks",data:t})})).catch((function(e){}))}));Promise.all([t,i,r,n,a,o]).then((function(t){e.cityData=t})).catch((function(e){}))}},{key:"checkSpecialProperties",value:function(e,t){var i=new Promise((function(t,i){var r="https://services2.arcgis.com/qvkbeam7Wirps6zC/ArcGIS/rest/services/DevelopmentMap/FeatureServer/0/query?where=parcel_id+%3D+%27".concat(e,"%27&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnGeometry=true&returnCentroid=false&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pjson&token=");return fetch(r).then((function(e){return e.json()})).then((function(e){t({id:"city-structures",data:e})})).catch((function(e){}))})),r=new Promise((function(t,i){var r="https://services2.arcgis.com/qvkbeam7Wirps6zC/ArcGIS/rest/services/DevelopmentMap/FeatureServer/1/query?where=parcel_id+%3D+%27".concat(e,"%27&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnGeometry=true&returnCentroid=false&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pjson&token=");return fetch(r).then((function(e){return e.json()})).then((function(e){t({id:"city-land",data:e})})).catch((function(e){}))})),n=new Promise((function(t,i){var r="https://services2.arcgis.com/qvkbeam7Wirps6zC/ArcGIS/rest/services/DevelopmentMap/FeatureServer/2/query?where=parcel_id+%3D+%27".concat(e,"%27&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnGeometry=true&returnCentroid=false&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pjson&token=");return fetch(r).then((function(e){return e.json()})).then((function(e){t({id:"city-structures",data:e})})).catch((function(e){}))})),a=new Promise((function(t,i){var r="https://services2.arcgis.com/qvkbeam7Wirps6zC/ArcGIS/rest/services/DevelopmentMap/FeatureServer/3/query?where=parcel_id+%3D+%27".concat(e,"%27&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnGeometry=true&returnCentroid=false&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pjson&token=");return fetch(r).then((function(e){return e.json()})).then((function(e){t({id:"city-land",data:e})})).catch((function(e){}))}));Promise.all([i,r,n,a]).then((function(e){e[0].data.features.length?t.specialProperty="city-structures":e[1].data.features.length?t.specialProperty="city-land":e[2].data.features.length?t.specialProperty="dlba-structures":e[3].data.features.length?t.specialProperty="dlba-land":t.specialProperty=null,t.getParcelData(t)})).catch((function(e){}))}},{key:"checkParcelValid",value:function(e){return/\d/.test(e)}}]),e}())},254:function(e,t,i){e=i.nmd(e);var r="__lodash_hash_undefined__",n=9007199254740991,a="[object Arguments]",o="[object Array]",s="[object Boolean]",l="[object Date]",c="[object Error]",u="[object Function]",h="[object Map]",p="[object Number]",d="[object Object]",f="[object Promise]",m="[object RegExp]",g="[object Set]",_="[object String]",y="[object Symbol]",v="[object WeakMap]",x="[object ArrayBuffer]",b="[object DataView]",w=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,S=/^\w*$/,M=/^\./,T=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,E=/\\(\\)?/g,C=/^\[object .+?Constructor\]$/,A=/^(?:0|[1-9]\d*)$/,I={};I["[object Float32Array]"]=I["[object Float64Array]"]=I["[object Int8Array]"]=I["[object Int16Array]"]=I["[object Int32Array]"]=I["[object Uint8Array]"]=I["[object Uint8ClampedArray]"]=I["[object Uint16Array]"]=I["[object Uint32Array]"]=!0,I[a]=I[o]=I[x]=I[s]=I[b]=I[l]=I[c]=I[u]=I[h]=I[p]=I[d]=I[m]=I[g]=I[_]=I[v]=!1;var P="object"==typeof i.g&&i.g&&i.g.Object===Object&&i.g,z="object"==typeof self&&self&&self.Object===Object&&self,R=P||z||Function("return this")(),k=t&&!t.nodeType&&t,L=k&&e&&!e.nodeType&&e,D=L&&L.exports===k&&P.process,B=function(){try{return D&&D.binding("util")}catch(e){}}(),F=B&&B.isTypedArray;function O(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}function N(e,t){for(var i=-1,r=e?e.length:0,n=Array(r);++i<r;)n[i]=t(e[i],i,e);return n}function V(e,t){for(var i=-1,r=t.length,n=e.length;++i<r;)e[n+i]=t[i];return e}function U(e,t){for(var i=-1,r=e?e.length:0;++i<r;)if(t(e[i],i,e))return!0;return!1}function $(e){return function(t){return e(t)}}function j(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(i){}return t}function q(e){var t=-1,i=Array(e.size);return e.forEach((function(e,r){i[++t]=[r,e]})),i}function G(e){var t=-1,i=Array(e.size);return e.forEach((function(e){i[++t]=e})),i}var H,W,Z,X=Array.prototype,Y=Function.prototype,K=Object.prototype,J=R["__core-js_shared__"],Q=(H=/[^.]+$/.exec(J&&J.keys&&J.keys.IE_PROTO||""))?"Symbol(src)_1."+H:"",ee=Y.toString,te=K.hasOwnProperty,ie=K.toString,re=RegExp("^"+ee.call(te).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ne=R.Symbol,ae=R.Uint8Array,oe=K.propertyIsEnumerable,se=X.splice,le=ne?ne.isConcatSpreadable:void 0,ce=(W=Object.keys,Z=Object,function(e){return W(Z(e))}),ue=Math.max,he=Ze(R,"DataView"),pe=Ze(R,"Map"),de=Ze(R,"Promise"),fe=Ze(R,"Set"),me=Ze(R,"WeakMap"),ge=Ze(Object,"create"),_e=nt(he),ye=nt(pe),ve=nt(de),xe=nt(fe),be=nt(me),we=ne?ne.prototype:void 0,Se=we?we.valueOf:void 0,Me=we?we.toString:void 0;function Te(e){var t=-1,i=e?e.length:0;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}function Ee(e){var t=-1,i=e?e.length:0;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}function Ce(e){var t=-1,i=e?e.length:0;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}function Ae(e){var t=-1,i=e?e.length:0;for(this.__data__=new Ce;++t<i;)this.add(e[t])}function Ie(e){this.__data__=new Ee(e)}function Pe(e,t){var i=ct(e)||lt(e)?function(e,t){for(var i=-1,r=Array(e);++i<e;)r[i]=t(i);return r}(e.length,String):[],r=i.length,n=!!r;for(var a in e)!t&&!te.call(e,a)||n&&("length"==a||Ke(a,r))||i.push(a);return i}function ze(e,t){for(var i=e.length;i--;)if(st(e[i][0],t))return i;return-1}Te.prototype.clear=function(){this.__data__=ge?ge(null):{}},Te.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},Te.prototype.get=function(e){var t=this.__data__;if(ge){var i=t[e];return i===r?void 0:i}return te.call(t,e)?t[e]:void 0},Te.prototype.has=function(e){var t=this.__data__;return ge?void 0!==t[e]:te.call(t,e)},Te.prototype.set=function(e,t){return this.__data__[e]=ge&&void 0===t?r:t,this},Ee.prototype.clear=function(){this.__data__=[]},Ee.prototype.delete=function(e){var t=this.__data__,i=ze(t,e);return!(i<0)&&(i==t.length-1?t.pop():se.call(t,i,1),!0)},Ee.prototype.get=function(e){var t=this.__data__,i=ze(t,e);return i<0?void 0:t[i][1]},Ee.prototype.has=function(e){return ze(this.__data__,e)>-1},Ee.prototype.set=function(e,t){var i=this.__data__,r=ze(i,e);return r<0?i.push([e,t]):i[r][1]=t,this},Ce.prototype.clear=function(){this.__data__={hash:new Te,map:new(pe||Ee),string:new Te}},Ce.prototype.delete=function(e){return We(this,e).delete(e)},Ce.prototype.get=function(e){return We(this,e).get(e)},Ce.prototype.has=function(e){return We(this,e).has(e)},Ce.prototype.set=function(e,t){return We(this,e).set(e,t),this},Ae.prototype.add=Ae.prototype.push=function(e){return this.__data__.set(e,r),this},Ae.prototype.has=function(e){return this.__data__.has(e)},Ie.prototype.clear=function(){this.__data__=new Ee},Ie.prototype.delete=function(e){return this.__data__.delete(e)},Ie.prototype.get=function(e){return this.__data__.get(e)},Ie.prototype.has=function(e){return this.__data__.has(e)},Ie.prototype.set=function(e,t){var i=this.__data__;if(i instanceof Ee){var r=i.__data__;if(!pe||r.length<199)return r.push([e,t]),this;i=this.__data__=new Ce(r)}return i.set(e,t),this};var Re,ke,Le=(Re=function(e,t){return e&&Be(e,t,_t)},function(e,t){if(null==e)return e;if(!ut(e))return Re(e,t);for(var i=e.length,r=ke?i:-1,n=Object(e);(ke?r--:++r<i)&&!1!==t(n[r],r,n););return e});function De(e,t,i,r,n){var a=-1,o=e.length;for(i||(i=Ye),n||(n=[]);++a<o;){var s=e[a];t>0&&i(s)?t>1?De(s,t-1,i,r,n):V(n,s):r||(n[n.length]=s)}return n}var Be=function(e){return function(t,i,r){for(var n=-1,a=Object(t),o=r(t),s=o.length;s--;){var l=o[e?s:++n];if(!1===i(a[l],l,a))break}return t}}();function Fe(e,t){for(var i=0,r=(t=Qe(t,e)?[t]:qe(t)).length;null!=e&&i<r;)e=e[rt(t[i++])];return i&&i==r?e:void 0}function Oe(e,t){return null!=e&&t in Object(e)}function Ne(e,t,i,r,n){return e===t||(null==e||null==t||!dt(e)&&!ft(t)?e!==e&&t!==t:function(e,t,i,r,n,u){var f=ct(e),v=ct(t),w=o,S=o;f||(w=(w=Xe(e))==a?d:w);v||(S=(S=Xe(t))==a?d:S);var M=w==d&&!j(e),T=S==d&&!j(t),E=w==S;if(E&&!M)return u||(u=new Ie),f||gt(e)?He(e,t,i,r,n,u):function(e,t,i,r,n,a,o){switch(i){case b:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case x:return!(e.byteLength!=t.byteLength||!r(new ae(e),new ae(t)));case s:case l:case p:return st(+e,+t);case c:return e.name==t.name&&e.message==t.message;case m:case _:return e==t+"";case h:var u=q;case g:var d=2&a;if(u||(u=G),e.size!=t.size&&!d)return!1;var f=o.get(e);if(f)return f==t;a|=1,o.set(e,t);var v=He(u(e),u(t),r,n,a,o);return o.delete(e),v;case y:if(Se)return Se.call(e)==Se.call(t)}return!1}(e,t,w,i,r,n,u);if(!(2&n)){var C=M&&te.call(e,"__wrapped__"),A=T&&te.call(t,"__wrapped__");if(C||A){var I=C?e.value():e,P=A?t.value():t;return u||(u=new Ie),i(I,P,r,n,u)}}if(!E)return!1;return u||(u=new Ie),function(e,t,i,r,n,a){var o=2&n,s=_t(e),l=s.length,c=_t(t).length;if(l!=c&&!o)return!1;var u=l;for(;u--;){var h=s[u];if(!(o?h in t:te.call(t,h)))return!1}var p=a.get(e);if(p&&a.get(t))return p==t;var d=!0;a.set(e,t),a.set(t,e);var f=o;for(;++u<l;){var m=e[h=s[u]],g=t[h];if(r)var _=o?r(g,m,h,t,e,a):r(m,g,h,e,t,a);if(!(void 0===_?m===g||i(m,g,r,n,a):_)){d=!1;break}f||(f="constructor"==h)}if(d&&!f){var y=e.constructor,v=t.constructor;y==v||!("constructor"in e)||!("constructor"in t)||"function"==typeof y&&y instanceof y&&"function"==typeof v&&v instanceof v||(d=!1)}return a.delete(e),a.delete(t),d}(e,t,i,r,n,u)}(e,t,Ne,i,r,n))}function Ve(e){return!(!dt(e)||function(e){return!!Q&&Q in e}(e))&&(ht(e)||j(e)?re:C).test(nt(e))}function Ue(e){return"function"==typeof e?e:null==e?yt:"object"==typeof e?ct(e)?function(e,t){if(Qe(e)&&et(t))return tt(rt(e),t);return function(i){var r=function(e,t,i){var r=null==e?void 0:Fe(e,t);return void 0===r?i:r}(i,e);return void 0===r&&r===t?function(e,t){return null!=e&&function(e,t,i){t=Qe(t,e)?[t]:qe(t);var r,n=-1,a=t.length;for(;++n<a;){var o=rt(t[n]);if(!(r=null!=e&&i(e,o)))break;e=e[o]}if(r)return r;return!!(a=e?e.length:0)&&pt(a)&&Ke(o,a)&&(ct(e)||lt(e))}(e,t,Oe)}(i,e):Ne(t,r,void 0,3)}}(e[0],e[1]):function(e){var t=function(e){var t=_t(e),i=t.length;for(;i--;){var r=t[i],n=e[r];t[i]=[r,n,et(n)]}return t}(e);if(1==t.length&&t[0][2])return tt(t[0][0],t[0][1]);return function(i){return i===e||function(e,t,i,r){var n=i.length,a=n,o=!r;if(null==e)return!a;for(e=Object(e);n--;){var s=i[n];if(o&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++n<a;){var l=(s=i[n])[0],c=e[l],u=s[1];if(o&&s[2]){if(void 0===c&&!(l in e))return!1}else{var h=new Ie;if(r)var p=r(c,u,l,e,t,h);if(!(void 0===p?Ne(u,c,r,3,h):p))return!1}}return!0}(i,e,t)}}(e):Qe(t=e)?(i=rt(t),function(e){return null==e?void 0:e[i]}):function(e){return function(t){return Fe(t,e)}}(t);var t,i}function $e(e){if(i=(t=e)&&t.constructor,r="function"==typeof i&&i.prototype||K,t!==r)return ce(e);var t,i,r,n=[];for(var a in Object(e))te.call(e,a)&&"constructor"!=a&&n.push(a);return n}function je(e,t,i){var r=-1;t=N(t.length?t:[yt],$(Ue));var n=function(e,t){var i=-1,r=ut(e)?Array(e.length):[];return Le(e,(function(e,n,a){r[++i]=t(e,n,a)})),r}(e,(function(e,i,n){return{criteria:N(t,(function(t){return t(e)})),index:++r,value:e}}));return function(e,t){var i=e.length;for(e.sort(t);i--;)e[i]=e[i].value;return e}(n,(function(e,t){return function(e,t,i){var r=-1,n=e.criteria,a=t.criteria,o=n.length,s=i.length;for(;++r<o;){var l=Ge(n[r],a[r]);if(l)return r>=s?l:l*("desc"==i[r]?-1:1)}return e.index-t.index}(e,t,i)}))}function qe(e){return ct(e)?e:it(e)}function Ge(e,t){if(e!==t){var i=void 0!==e,r=null===e,n=e===e,a=mt(e),o=void 0!==t,s=null===t,l=t===t,c=mt(t);if(!s&&!c&&!a&&e>t||a&&o&&l&&!s&&!c||r&&o&&l||!i&&l||!n)return 1;if(!r&&!a&&!c&&e<t||c&&i&&n&&!r&&!a||s&&i&&n||!o&&n||!l)return-1}return 0}function He(e,t,i,r,n,a){var o=2&n,s=e.length,l=t.length;if(s!=l&&!(o&&l>s))return!1;var c=a.get(e);if(c&&a.get(t))return c==t;var u=-1,h=!0,p=1&n?new Ae:void 0;for(a.set(e,t),a.set(t,e);++u<s;){var d=e[u],f=t[u];if(r)var m=o?r(f,d,u,t,e,a):r(d,f,u,e,t,a);if(void 0!==m){if(m)continue;h=!1;break}if(p){if(!U(t,(function(e,t){if(!p.has(t)&&(d===e||i(d,e,r,n,a)))return p.add(t)}))){h=!1;break}}else if(d!==f&&!i(d,f,r,n,a)){h=!1;break}}return a.delete(e),a.delete(t),h}function We(e,t){var i,r,n=e.__data__;return("string"==(r=typeof(i=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==i:null===i)?n["string"==typeof t?"string":"hash"]:n.map}function Ze(e,t){var i=function(e,t){return null==e?void 0:e[t]}(e,t);return Ve(i)?i:void 0}var Xe=function(e){return ie.call(e)};function Ye(e){return ct(e)||lt(e)||!!(le&&e&&e[le])}function Ke(e,t){return!!(t=null==t?n:t)&&("number"==typeof e||A.test(e))&&e>-1&&e%1==0&&e<t}function Je(e,t,i){if(!dt(i))return!1;var r=typeof t;return!!("number"==r?ut(i)&&Ke(t,i.length):"string"==r&&t in i)&&st(i[t],e)}function Qe(e,t){if(ct(e))return!1;var i=typeof e;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=e&&!mt(e))||(S.test(e)||!w.test(e)||null!=t&&e in Object(t))}function et(e){return e===e&&!dt(e)}function tt(e,t){return function(i){return null!=i&&(i[e]===t&&(void 0!==t||e in Object(i)))}}(he&&Xe(new he(new ArrayBuffer(1)))!=b||pe&&Xe(new pe)!=h||de&&Xe(de.resolve())!=f||fe&&Xe(new fe)!=g||me&&Xe(new me)!=v)&&(Xe=function(e){var t=ie.call(e),i=t==d?e.constructor:void 0,r=i?nt(i):void 0;if(r)switch(r){case _e:return b;case ye:return h;case ve:return f;case xe:return g;case be:return v}return t});var it=ot((function(e){var t;e=null==(t=e)?"":function(e){if("string"==typeof e)return e;if(mt(e))return Me?Me.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(t);var i=[];return M.test(e)&&i.push(""),e.replace(T,(function(e,t,r,n){i.push(r?n.replace(E,"$1"):t||e)})),i}));function rt(e){if("string"==typeof e||mt(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function nt(e){if(null!=e){try{return ee.call(e)}catch(t){}try{return e+""}catch(t){}}return""}var at=function(e,t){return t=ue(void 0===t?e.length-1:t,0),function(){for(var i=arguments,r=-1,n=ue(i.length-t,0),a=Array(n);++r<n;)a[r]=i[t+r];r=-1;for(var o=Array(t+1);++r<t;)o[r]=i[r];return o[t]=a,O(e,this,o)}}((function(e,t){if(null==e)return[];var i=t.length;return i>1&&Je(e,t[0],t[1])?t=[]:i>2&&Je(t[0],t[1],t[2])&&(t=[t[0]]),je(e,De(t,1),[])}));function ot(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError("Expected a function");var i=function(){var r=arguments,n=t?t.apply(this,r):r[0],a=i.cache;if(a.has(n))return a.get(n);var o=e.apply(this,r);return i.cache=a.set(n,o),o};return i.cache=new(ot.Cache||Ce),i}function st(e,t){return e===t||e!==e&&t!==t}function lt(e){return function(e){return ft(e)&&ut(e)}(e)&&te.call(e,"callee")&&(!oe.call(e,"callee")||ie.call(e)==a)}ot.Cache=Ce;var ct=Array.isArray;function ut(e){return null!=e&&pt(e.length)&&!ht(e)}function ht(e){var t=dt(e)?ie.call(e):"";return t==u||"[object GeneratorFunction]"==t}function pt(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=n}function dt(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function ft(e){return!!e&&"object"==typeof e}function mt(e){return"symbol"==typeof e||ft(e)&&ie.call(e)==y}var gt=F?$(F):function(e){return ft(e)&&pt(e.length)&&!!I[ie.call(e)]};function _t(e){return ut(e)?Pe(e):$e(e)}function yt(e){return e}e.exports=at},618:function(e,t,i){e=i.nmd(e);var r="__lodash_hash_undefined__",n=1/0,a=9007199254740991,o="[object Arguments]",s="[object Array]",l="[object Boolean]",c="[object Date]",u="[object Error]",h="[object Function]",p="[object Map]",d="[object Number]",f="[object Object]",m="[object Promise]",g="[object RegExp]",_="[object Set]",y="[object String]",v="[object Symbol]",x="[object WeakMap]",b="[object ArrayBuffer]",w="[object DataView]",S=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,M=/^\w*$/,T=/^\./,E=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,C=/\\(\\)?/g,A=/^\[object .+?Constructor\]$/,I=/^(?:0|[1-9]\d*)$/,P={};P["[object Float32Array]"]=P["[object Float64Array]"]=P["[object Int8Array]"]=P["[object Int16Array]"]=P["[object Int32Array]"]=P["[object Uint8Array]"]=P["[object Uint8ClampedArray]"]=P["[object Uint16Array]"]=P["[object Uint32Array]"]=!0,P[o]=P[s]=P[b]=P[l]=P[w]=P[c]=P[u]=P[h]=P[p]=P[d]=P[f]=P[g]=P[_]=P[y]=P[x]=!1;var z="object"==typeof i.g&&i.g&&i.g.Object===Object&&i.g,R="object"==typeof self&&self&&self.Object===Object&&self,k=z||R||Function("return this")(),L=t&&!t.nodeType&&t,D=L&&e&&!e.nodeType&&e,B=D&&D.exports===L&&z.process,F=function(){try{return B&&B.binding("util")}catch(e){}}(),O=F&&F.isTypedArray;function N(e,t){return!!(e?e.length:0)&&function(e,t,i){if(t!==t)return function(e,t,i,r){var n=e.length,a=i+(r?1:-1);for(;r?a--:++a<n;)if(t(e[a],a,e))return a;return-1}(e,$,i);var r=i-1,n=e.length;for(;++r<n;)if(e[r]===t)return r;return-1}(e,t,0)>-1}function V(e,t,i){for(var r=-1,n=e?e.length:0;++r<n;)if(i(t,e[r]))return!0;return!1}function U(e,t){for(var i=-1,r=e?e.length:0;++i<r;)if(t(e[i],i,e))return!0;return!1}function $(e){return e!==e}function j(e,t){return e.has(t)}function q(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(i){}return t}function G(e){var t=-1,i=Array(e.size);return e.forEach((function(e,r){i[++t]=[r,e]})),i}function H(e){var t=-1,i=Array(e.size);return e.forEach((function(e){i[++t]=e})),i}var W,Z,X,Y=Array.prototype,K=Function.prototype,J=Object.prototype,Q=k["__core-js_shared__"],ee=(W=/[^.]+$/.exec(Q&&Q.keys&&Q.keys.IE_PROTO||""))?"Symbol(src)_1."+W:"",te=K.toString,ie=J.hasOwnProperty,re=J.toString,ne=RegExp("^"+te.call(ie).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ae=k.Symbol,oe=k.Uint8Array,se=J.propertyIsEnumerable,le=Y.splice,ce=(Z=Object.keys,X=Object,function(e){return Z(X(e))}),ue=Ue(k,"DataView"),he=Ue(k,"Map"),pe=Ue(k,"Promise"),de=Ue(k,"Set"),fe=Ue(k,"WeakMap"),me=Ue(Object,"create"),ge=Xe(ue),_e=Xe(he),ye=Xe(pe),ve=Xe(de),xe=Xe(fe),be=ae?ae.prototype:void 0,we=be?be.valueOf:void 0,Se=be?be.toString:void 0;function Me(e){var t=-1,i=e?e.length:0;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}function Te(e){var t=-1,i=e?e.length:0;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}function Ee(e){var t=-1,i=e?e.length:0;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}function Ce(e){var t=-1,i=e?e.length:0;for(this.__data__=new Ee;++t<i;)this.add(e[t])}function Ae(e){this.__data__=new Te(e)}function Ie(e,t){var i=Qe(e)||Je(e)?function(e,t){for(var i=-1,r=Array(e);++i<e;)r[i]=t(i);return r}(e.length,String):[],r=i.length,n=!!r;for(var a in e)!t&&!ie.call(e,a)||n&&("length"==a||je(a,r))||i.push(a);return i}function Pe(e,t){for(var i=e.length;i--;)if(Ke(e[i][0],t))return i;return-1}function ze(e,t){for(var i=0,r=(t=qe(t,e)?[t]:Fe(t)).length;null!=e&&i<r;)e=e[Ze(t[i++])];return i&&i==r?e:void 0}function Re(e,t){return null!=e&&t in Object(e)}function ke(e,t,i,r,n){return e===t||(null==e||null==t||!rt(e)&&!nt(t)?e!==e&&t!==t:function(e,t,i,r,n,a){var h=Qe(e),m=Qe(t),x=s,S=s;h||(x=(x=$e(e))==o?f:x);m||(S=(S=$e(t))==o?f:S);var M=x==f&&!q(e),T=S==f&&!q(t),E=x==S;if(E&&!M)return a||(a=new Ae),h||ot(e)?Ne(e,t,i,r,n,a):function(e,t,i,r,n,a,o){switch(i){case w:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case b:return!(e.byteLength!=t.byteLength||!r(new oe(e),new oe(t)));case l:case c:case d:return Ke(+e,+t);case u:return e.name==t.name&&e.message==t.message;case g:case y:return e==t+"";case p:var s=G;case _:var h=2&a;if(s||(s=H),e.size!=t.size&&!h)return!1;var f=o.get(e);if(f)return f==t;a|=1,o.set(e,t);var m=Ne(s(e),s(t),r,n,a,o);return o.delete(e),m;case v:if(we)return we.call(e)==we.call(t)}return!1}(e,t,x,i,r,n,a);if(!(2&n)){var C=M&&ie.call(e,"__wrapped__"),A=T&&ie.call(t,"__wrapped__");if(C||A){var I=C?e.value():e,P=A?t.value():t;return a||(a=new Ae),i(I,P,r,n,a)}}if(!E)return!1;return a||(a=new Ae),function(e,t,i,r,n,a){var o=2&n,s=st(e),l=s.length,c=st(t).length;if(l!=c&&!o)return!1;var u=l;for(;u--;){var h=s[u];if(!(o?h in t:ie.call(t,h)))return!1}var p=a.get(e);if(p&&a.get(t))return p==t;var d=!0;a.set(e,t),a.set(t,e);var f=o;for(;++u<l;){var m=e[h=s[u]],g=t[h];if(r)var _=o?r(g,m,h,t,e,a):r(m,g,h,e,t,a);if(!(void 0===_?m===g||i(m,g,r,n,a):_)){d=!1;break}f||(f="constructor"==h)}if(d&&!f){var y=e.constructor,v=t.constructor;y==v||!("constructor"in e)||!("constructor"in t)||"function"==typeof y&&y instanceof y&&"function"==typeof v&&v instanceof v||(d=!1)}return a.delete(e),a.delete(t),d}(e,t,i,r,n,a)}(e,t,ke,i,r,n))}function Le(e){return!(!rt(e)||function(e){return!!ee&&ee in e}(e))&&(tt(e)||q(e)?ne:A).test(Xe(e))}function De(e){return"function"==typeof e?e:null==e?lt:"object"==typeof e?Qe(e)?function(e,t){if(qe(e)&&Ge(t))return He(Ze(e),t);return function(i){var r=function(e,t,i){var r=null==e?void 0:ze(e,t);return void 0===r?i:r}(i,e);return void 0===r&&r===t?function(e,t){return null!=e&&function(e,t,i){t=qe(t,e)?[t]:Fe(t);var r,n=-1,a=t.length;for(;++n<a;){var o=Ze(t[n]);if(!(r=null!=e&&i(e,o)))break;e=e[o]}if(r)return r;return!!(a=e?e.length:0)&&it(a)&&je(o,a)&&(Qe(e)||Je(e))}(e,t,Re)}(i,e):ke(t,r,void 0,3)}}(e[0],e[1]):function(e){var t=function(e){var t=st(e),i=t.length;for(;i--;){var r=t[i],n=e[r];t[i]=[r,n,Ge(n)]}return t}(e);if(1==t.length&&t[0][2])return He(t[0][0],t[0][1]);return function(i){return i===e||function(e,t,i,r){var n=i.length,a=n,o=!r;if(null==e)return!a;for(e=Object(e);n--;){var s=i[n];if(o&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++n<a;){var l=(s=i[n])[0],c=e[l],u=s[1];if(o&&s[2]){if(void 0===c&&!(l in e))return!1}else{var h=new Ae;if(r)var p=r(c,u,l,e,t,h);if(!(void 0===p?ke(u,c,r,3,h):p))return!1}}return!0}(i,e,t)}}(e):qe(t=e)?(i=Ze(t),function(e){return null==e?void 0:e[i]}):function(e){return function(t){return ze(t,e)}}(t);var t,i}function Be(e){if(i=(t=e)&&t.constructor,r="function"==typeof i&&i.prototype||J,t!==r)return ce(e);var t,i,r,n=[];for(var a in Object(e))ie.call(e,a)&&"constructor"!=a&&n.push(a);return n}function Fe(e){return Qe(e)?e:We(e)}Me.prototype.clear=function(){this.__data__=me?me(null):{}},Me.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},Me.prototype.get=function(e){var t=this.__data__;if(me){var i=t[e];return i===r?void 0:i}return ie.call(t,e)?t[e]:void 0},Me.prototype.has=function(e){var t=this.__data__;return me?void 0!==t[e]:ie.call(t,e)},Me.prototype.set=function(e,t){return this.__data__[e]=me&&void 0===t?r:t,this},Te.prototype.clear=function(){this.__data__=[]},Te.prototype.delete=function(e){var t=this.__data__,i=Pe(t,e);return!(i<0)&&(i==t.length-1?t.pop():le.call(t,i,1),!0)},Te.prototype.get=function(e){var t=this.__data__,i=Pe(t,e);return i<0?void 0:t[i][1]},Te.prototype.has=function(e){return Pe(this.__data__,e)>-1},Te.prototype.set=function(e,t){var i=this.__data__,r=Pe(i,e);return r<0?i.push([e,t]):i[r][1]=t,this},Ee.prototype.clear=function(){this.__data__={hash:new Me,map:new(he||Te),string:new Me}},Ee.prototype.delete=function(e){return Ve(this,e).delete(e)},Ee.prototype.get=function(e){return Ve(this,e).get(e)},Ee.prototype.has=function(e){return Ve(this,e).has(e)},Ee.prototype.set=function(e,t){return Ve(this,e).set(e,t),this},Ce.prototype.add=Ce.prototype.push=function(e){return this.__data__.set(e,r),this},Ce.prototype.has=function(e){return this.__data__.has(e)},Ae.prototype.clear=function(){this.__data__=new Te},Ae.prototype.delete=function(e){return this.__data__.delete(e)},Ae.prototype.get=function(e){return this.__data__.get(e)},Ae.prototype.has=function(e){return this.__data__.has(e)},Ae.prototype.set=function(e,t){var i=this.__data__;if(i instanceof Te){var r=i.__data__;if(!he||r.length<199)return r.push([e,t]),this;i=this.__data__=new Ee(r)}return i.set(e,t),this};var Oe=de&&1/H(new de([,-0]))[1]==n?function(e){return new de(e)}:function(){};function Ne(e,t,i,r,n,a){var o=2&n,s=e.length,l=t.length;if(s!=l&&!(o&&l>s))return!1;var c=a.get(e);if(c&&a.get(t))return c==t;var u=-1,h=!0,p=1&n?new Ce:void 0;for(a.set(e,t),a.set(t,e);++u<s;){var d=e[u],f=t[u];if(r)var m=o?r(f,d,u,t,e,a):r(d,f,u,e,t,a);if(void 0!==m){if(m)continue;h=!1;break}if(p){if(!U(t,(function(e,t){if(!p.has(t)&&(d===e||i(d,e,r,n,a)))return p.add(t)}))){h=!1;break}}else if(d!==f&&!i(d,f,r,n,a)){h=!1;break}}return a.delete(e),a.delete(t),h}function Ve(e,t){var i,r,n=e.__data__;return("string"==(r=typeof(i=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==i:null===i)?n["string"==typeof t?"string":"hash"]:n.map}function Ue(e,t){var i=function(e,t){return null==e?void 0:e[t]}(e,t);return Le(i)?i:void 0}var $e=function(e){return re.call(e)};function je(e,t){return!!(t=null==t?a:t)&&("number"==typeof e||I.test(e))&&e>-1&&e%1==0&&e<t}function qe(e,t){if(Qe(e))return!1;var i=typeof e;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=e&&!at(e))||(M.test(e)||!S.test(e)||null!=t&&e in Object(t))}function Ge(e){return e===e&&!rt(e)}function He(e,t){return function(i){return null!=i&&(i[e]===t&&(void 0!==t||e in Object(i)))}}(ue&&$e(new ue(new ArrayBuffer(1)))!=w||he&&$e(new he)!=p||pe&&$e(pe.resolve())!=m||de&&$e(new de)!=_||fe&&$e(new fe)!=x)&&($e=function(e){var t=re.call(e),i=t==f?e.constructor:void 0,r=i?Xe(i):void 0;if(r)switch(r){case ge:return w;case _e:return p;case ye:return m;case ve:return _;case xe:return x}return t});var We=Ye((function(e){var t;e=null==(t=e)?"":function(e){if("string"==typeof e)return e;if(at(e))return Se?Se.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(t);var i=[];return T.test(e)&&i.push(""),e.replace(E,(function(e,t,r,n){i.push(r?n.replace(C,"$1"):t||e)})),i}));function Ze(e){if("string"==typeof e||at(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function Xe(e){if(null!=e){try{return te.call(e)}catch(t){}try{return e+""}catch(t){}}return""}function Ye(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError("Expected a function");var i=function(){var r=arguments,n=t?t.apply(this,r):r[0],a=i.cache;if(a.has(n))return a.get(n);var o=e.apply(this,r);return i.cache=a.set(n,o),o};return i.cache=new(Ye.Cache||Ee),i}function Ke(e,t){return e===t||e!==e&&t!==t}function Je(e){return function(e){return nt(e)&&et(e)}(e)&&ie.call(e,"callee")&&(!se.call(e,"callee")||re.call(e)==o)}Ye.Cache=Ee;var Qe=Array.isArray;function et(e){return null!=e&&it(e.length)&&!tt(e)}function tt(e){var t=rt(e)?re.call(e):"";return t==h||"[object GeneratorFunction]"==t}function it(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=a}function rt(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function nt(e){return!!e&&"object"==typeof e}function at(e){return"symbol"==typeof e||nt(e)&&re.call(e)==v}var ot=O?function(e){return function(t){return e(t)}}(O):function(e){return nt(e)&&it(e.length)&&!!P[re.call(e)]};function st(e){return et(e)?Ie(e):Be(e)}function lt(e){return e}e.exports=function(e,t){return e&&e.length?function(e,t,i){var r=-1,n=N,a=e.length,o=!0,s=[],l=s;if(i)o=!1,n=V;else if(a>=200){var c=t?null:Oe(e);if(c)return H(c);o=!1,n=j,l=new Ce}else l=t?[]:s;e:for(;++r<a;){var u=e[r],h=t?t(u):u;if(u=i||0!==u?u:0,o&&h===h){for(var p=l.length;p--;)if(l[p]===h)continue e;t&&l.push(h),s.push(u)}else n(l,h,i)||(l!==s&&l.push(h),s.push(u))}return s}(e,De(t)):[]}},409:function(e){e.exports=function(){"use strict";var e,t,i;function r(r,n){if(e)if(t){var a="var sharedChunk = {}; ("+e+")(sharedChunk); ("+t+")(sharedChunk);",o={};e(o),i=n(o),"undefined"!==typeof window&&(i.workerUrl=window.URL.createObjectURL(new Blob([a],{type:"text/javascript"})))}else t=n;else e=n}return r(["exports"],(function(e){function t(e,t){return e(t={exports:{}},t.exports),t.exports}var i=r;function r(e,t,i,r){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=i,this.p2y=r}r.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},r.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},r.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},r.prototype.solveCurveX=function(e,t){var i,r,n,a,o;for(void 0===t&&(t=1e-6),n=e,o=0;o<8;o++){if(a=this.sampleCurveX(n)-e,Math.abs(a)<t)return n;var s=this.sampleCurveDerivativeX(n);if(Math.abs(s)<1e-6)break;n-=a/s}if((n=e)<(i=0))return i;if(n>(r=1))return r;for(;i<r;){if(a=this.sampleCurveX(n),Math.abs(a-e)<t)return n;e>a?i=n:r=n,n=.5*(r-i)+i}return n},r.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var n=a;function a(e,t){this.x=e,this.y=t}a.prototype={clone:function(){return new a(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,i=e.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),i=Math.sin(e),r=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=r,this},_rotateAround:function(e,t){var i=Math.cos(e),r=Math.sin(e),n=t.y+r*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-r*(this.y-t.y),this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},a.convert=function(e){return e instanceof a?e:Array.isArray(e)?new a(e[0],e[1]):e};var o="undefined"!=typeof self?self:{},s=Math.pow(2,53)-1;function l(e,t,r,n){var a=new i(e,t,r,n);return function(e){return a.solve(e)}}var c=l(.25,.1,.25,1);function u(e,t,i){return Math.min(i,Math.max(t,e))}function h(e,t,i){var r=i-t,n=((e-t)%r+r)%r+t;return n===t?i:n}function p(e){for(var t=[],i=arguments.length-1;i-- >0;)t[i]=arguments[i+1];for(var r=0,n=t;r<n.length;r+=1){var a=n[r];for(var o in a)e[o]=a[o]}return e}var d=1;function f(){return d++}function m(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function g(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function _(e,t){e.forEach((function(e){t[e]&&(t[e]=t[e].bind(t))}))}function y(e,t){return-1!==e.indexOf(t,e.length-t.length)}function v(e,t,i){var r={};for(var n in e)r[n]=t.call(i||this,e[n],n,e);return r}function x(e,t,i){var r={};for(var n in e)t.call(i||this,e[n],n,e)&&(r[n]=e[n]);return r}function b(e){return Array.isArray(e)?e.map(b):"object"==typeof e&&e?v(e,b):e}var w={};function S(e){w[e]||("undefined"!=typeof console&&console.warn(e),w[e]=!0)}function M(e,t,i){return(i.y-e.y)*(t.x-e.x)>(t.y-e.y)*(i.x-e.x)}function T(e){for(var t=0,i=0,r=e.length,n=r-1,a=void 0,o=void 0;i<r;n=i++)t+=((o=e[n]).x-(a=e[i]).x)*(a.y+o.y);return t}function E(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function C(e){var t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(function(e,i,r,n){var a=r||n;return t[i]=!a||a.toLowerCase(),""})),t["max-age"]){var i=parseInt(t["max-age"],10);isNaN(i)?delete t["max-age"]:t["max-age"]=i}return t}var A=null;function I(e){if(null==A){var t=e.navigator?e.navigator.userAgent:null;A=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return A}function P(e){try{var t=o[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(e){return!1}}var z,R,k,L,D=o.performance&&o.performance.now?o.performance.now.bind(o.performance):Date.now.bind(Date),B=o.requestAnimationFrame||o.mozRequestAnimationFrame||o.webkitRequestAnimationFrame||o.msRequestAnimationFrame,F=o.cancelAnimationFrame||o.mozCancelAnimationFrame||o.webkitCancelAnimationFrame||o.msCancelAnimationFrame,O={now:D,frame:function(e){var t=B(e);return{cancel:function(){return F(t)}}},getImageData:function(e,t){void 0===t&&(t=0);var i=o.document.createElement("canvas"),r=i.getContext("2d");if(!r)throw new Error("failed to create canvas 2d context");return i.width=e.width,i.height=e.height,r.drawImage(e,0,0,e.width,e.height),r.getImageData(-t,-t,e.width+2*t,e.height+2*t)},resolveURL:function(e){return z||(z=o.document.createElement("a")),z.href=e,z.href},hardwareConcurrency:o.navigator&&o.navigator.hardwareConcurrency||4,get devicePixelRatio(){return o.devicePixelRatio},get prefersReducedMotion(){return!!o.matchMedia&&(null==R&&(R=o.matchMedia("(prefers-reduced-motion: reduce)")),R.matches)}},N={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},V={supported:!1,testSupport:function(e){!U&&L&&($?j(e):k=e)}},U=!1,$=!1;function j(e){var t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,L),e.isContextLost())return;V.supported=!0}catch(e){}e.deleteTexture(t),U=!0}o.document&&((L=o.document.createElement("img")).onload=function(){k&&j(k),k=null,$=!0},L.onerror=function(){U=!0,k=null},L.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var q="01",G=function(e,t){this._transformRequestFn=e,this._customAccessToken=t,this._createSkuToken()};function H(e){return 0===e.indexOf("mapbox:")}G.prototype._createSkuToken=function(){var e=function(){for(var e="",t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",q,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt},G.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},G.prototype.transformRequest=function(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}},G.prototype.normalizeStyleURL=function(e,t){if(!H(e))return e;var i=Y(e);return i.path="/styles/v1"+i.path,this._makeAPIURL(i,this._customAccessToken||t)},G.prototype.normalizeGlyphsURL=function(e,t){if(!H(e))return e;var i=Y(e);return i.path="/fonts/v1"+i.path,this._makeAPIURL(i,this._customAccessToken||t)},G.prototype.normalizeSourceURL=function(e,t){if(!H(e))return e;var i=Y(e);return i.path="/v4/"+i.authority+".json",i.params.push("secure"),this._makeAPIURL(i,this._customAccessToken||t)},G.prototype.normalizeSpriteURL=function(e,t,i,r){var n=Y(e);return H(e)?(n.path="/styles/v1"+n.path+"/sprite"+t+i,this._makeAPIURL(n,this._customAccessToken||r)):(n.path+=""+t+i,K(n))},G.prototype.normalizeTileURL=function(e,t){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!H(e))return e;var i=Y(e);i.path=i.path.replace(/(\.(png|jpg)\d*)(?=$)/,(O.devicePixelRatio>=2||512===t?"@2x":"")+(V.supported?".webp":"$1")),i.path=i.path.replace(/^.+\/v4\//,"/"),i.path="/v4"+i.path;var r=this._customAccessToken||function(e){for(var t=0,i=e;t<i.length;t+=1){var r=i[t].match(/^access_token=(.*)$/);if(r)return r[1]}return null}(i.params)||N.ACCESS_TOKEN;return N.REQUIRE_ACCESS_TOKEN&&r&&this._skuToken&&i.params.push("sku="+this._skuToken),this._makeAPIURL(i,r)},G.prototype.canonicalizeTileURL=function(e,t){var i=Y(e);if(!i.path.match(/(^\/v4\/)/)||!i.path.match(/\.[\w]+$/))return e;var r="mapbox://tiles/";r+=i.path.replace("/v4/","");var n=i.params;return t&&(n=n.filter((function(e){return!e.match(/^access_token=/)}))),n.length&&(r+="?"+n.join("&")),r},G.prototype.canonicalizeTileset=function(e,t){for(var i=!!t&&H(t),r=[],n=0,a=e.tiles||[];n<a.length;n+=1){var o=a[n];Z(o)?r.push(this.canonicalizeTileURL(o,i)):r.push(o)}return r},G.prototype._makeAPIURL=function(e,t){var i="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",r=Y(N.API_URL);if(e.protocol=r.protocol,e.authority=r.authority,"http"===e.protocol){var n=e.params.indexOf("secure");n>=0&&e.params.splice(n,1)}if("/"!==r.path&&(e.path=""+r.path+e.path),!N.REQUIRE_ACCESS_TOKEN)return K(e);if(!(t=t||N.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+i);if("s"===t[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+i);return e.params=e.params.filter((function(e){return-1===e.indexOf("access_token")})),e.params.push("access_token="+t),K(e)};var W=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Z(e){return W.test(e)}var X=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Y(e){var t=e.match(X);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function K(e){var t=e.params.length?"?"+e.params.join("&"):"";return e.protocol+"://"+e.authority+e.path+t}function J(e){if(!e)return null;var t=e.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(o.atob(t[1]).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join("")))}catch(e){return null}}var Q=function(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};Q.prototype.getStorageKey=function(e){var t,i=J(N.ACCESS_TOKEN);return t=i&&i.u?o.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode(Number("0x"+t))}))):N.ACCESS_TOKEN||"",e?"mapbox.eventData."+e+":"+t:"mapbox.eventData:"+t},Q.prototype.fetchEventData=function(){var e=P("localStorage"),t=this.getStorageKey(),i=this.getStorageKey("uuid");if(e)try{var r=o.localStorage.getItem(t);r&&(this.eventData=JSON.parse(r));var n=o.localStorage.getItem(i);n&&(this.anonId=n)}catch(e){S("Unable to read from LocalStorage")}},Q.prototype.saveEventData=function(){var e=P("localStorage"),t=this.getStorageKey(),i=this.getStorageKey("uuid");if(e)try{o.localStorage.setItem(i,this.anonId),Object.keys(this.eventData).length>=1&&o.localStorage.setItem(t,JSON.stringify(this.eventData))}catch(e){S("Unable to write to LocalStorage")}},Q.prototype.processRequests=function(e){},Q.prototype.postEvent=function(e,t,i,r){var n=this;if(N.EVENTS_URL){var a=Y(N.EVENTS_URL);a.params.push("access_token="+(r||N.ACCESS_TOKEN||""));var o={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.0-rc.4",skuId:q,userId:this.anonId},s=t?p(o,t):o,l={url:K(a),headers:{"Content-Type":"text/plain"},body:JSON.stringify([s])};this.pendingRequest=be(l,(function(e){n.pendingRequest=null,i(e),n.saveEventData(),n.processRequests(r)}))}},Q.prototype.queueRequest=function(e,t){this.queue.push(e),this.processRequests(t)};var ee,te,ie=function(e){function t(){e.call(this,"map.load"),this.success={},this.skuToken=""}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postMapLoadEvent=function(e,t,i,r){this.skuToken=i,(N.EVENTS_URL&&r||N.ACCESS_TOKEN&&Array.isArray(e)&&e.some((function(e){return H(e)||Z(e)})))&&this.queueRequest({id:t,timestamp:Date.now()},r)},t.prototype.processRequests=function(e){var t=this;if(!this.pendingRequest&&0!==this.queue.length){var i=this.queue.shift(),r=i.id,n=i.timestamp;r&&this.success[r]||(this.anonId||this.fetchEventData(),g(this.anonId)||(this.anonId=m()),this.postEvent(n,{skuToken:this.skuToken},(function(e){e||r&&(t.success[r]=!0)}),e))}},t}(Q),re=new(function(e){function t(t){e.call(this,"appUserTurnstile"),this._customAccessToken=t}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postTurnstileEvent=function(e,t){N.EVENTS_URL&&N.ACCESS_TOKEN&&Array.isArray(e)&&e.some((function(e){return H(e)||Z(e)}))&&this.queueRequest(Date.now(),t)},t.prototype.processRequests=function(e){var t=this;if(!this.pendingRequest&&0!==this.queue.length){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var i=J(N.ACCESS_TOKEN),r=i?i.u:N.ACCESS_TOKEN,n=r!==this.eventData.tokenU;g(this.anonId)||(this.anonId=m(),n=!0);var a=this.queue.shift();if(this.eventData.lastSuccess){var o=new Date(this.eventData.lastSuccess),s=new Date(a),l=(a-this.eventData.lastSuccess)/864e5;n=n||l>=1||l<-1||o.getDate()!==s.getDate()}else n=!0;if(!n)return this.processRequests();this.postEvent(a,{"enabled.telemetry":!1},(function(e){e||(t.eventData.lastSuccess=a,t.eventData.tokenU=r)}),e)}},t}(Q)),ne=re.postTurnstileEvent.bind(re),ae=new ie,oe=ae.postMapLoadEvent.bind(ae),se=500,le=50;function ce(){o.caches&&!ee&&(ee=o.caches.open("mapbox-tiles"))}function ue(e){var t=e.indexOf("?");return t<0?e:e.slice(0,t)}var he,pe=1/0;function de(){return null==he&&(he=o.OffscreenCanvas&&new o.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof o.createImageBitmap),he}var fe={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(fe);var me,ge,_e=function(e){function t(t,i,r){401===i&&Z(r)&&(t+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),e.call(this,t),this.status=i,this.url=r,this.name=this.constructor.name,this.message=t}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},t}(Error),ye=E()?function(){return self.worker&&self.worker.referrer}:function(){return("blob:"===o.location.protocol?o.parent:o).location.href},ve=function(e,t){if(!(/^file:/.test(i=e.url)||/^file:/.test(ye())&&!/^\w+:/.test(i))){if(o.fetch&&o.Request&&o.AbortController&&o.Request.prototype.hasOwnProperty("signal"))return function(e,t){var i,r=new o.AbortController,n=new o.Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:ye(),signal:r.signal}),a=!1,s=!1,l=(i=n.url).indexOf("sku=")>0&&Z(i);"json"===e.type&&n.headers.set("Accept","application/json");var c=function(i,r,a){if(!s){if(i&&"SecurityError"!==i.message&&S(i),r&&a)return u(r);var c=Date.now();o.fetch(n).then((function(i){if(i.ok){var r=l?i.clone():null;return u(i,r,c)}return t(new _e(i.statusText,i.status,e.url))})).catch((function(e){20!==e.code&&t(new Error(e.message))}))}},u=function(i,r,l){("arrayBuffer"===e.type?i.arrayBuffer():"json"===e.type?i.json():i.text()).then((function(e){s||(r&&l&&function(e,t,i){if(ce(),ee){var r={status:t.status,statusText:t.statusText,headers:new o.Headers};t.headers.forEach((function(e,t){return r.headers.set(t,e)}));var n=C(t.headers.get("Cache-Control")||"");n["no-store"]||(n["max-age"]&&r.headers.set("Expires",new Date(i+1e3*n["max-age"]).toUTCString()),new Date(r.headers.get("Expires")).getTime()-i<42e4||function(e,t){if(void 0===te)try{new Response(new ReadableStream),te=!0}catch(e){te=!1}te?t(e.body):e.blob().then(t)}(t,(function(t){var i=new o.Response(t,r);ce(),ee&&ee.then((function(t){return t.put(ue(e.url),i)})).catch((function(e){return S(e.message)}))})))}}(n,r,l),a=!0,t(null,e,i.headers.get("Cache-Control"),i.headers.get("Expires")))})).catch((function(e){s||t(new Error(e.message))}))};return l?function(e,t){if(ce(),!ee)return t(null);var i=ue(e.url);ee.then((function(e){e.match(i).then((function(r){var n=function(e){if(!e)return!1;var t=new Date(e.headers.get("Expires")||0),i=C(e.headers.get("Cache-Control")||"");return t>Date.now()&&!i["no-cache"]}(r);e.delete(i),n&&e.put(i,r.clone()),t(null,r,n)})).catch(t)})).catch(t)}(n,c):c(null,null),{cancel:function(){s=!0,a||r.abort()}}}(e,t);if(E()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var i;return function(e,t){var i=new o.XMLHttpRequest;for(var r in i.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(i.responseType="arraybuffer"),e.headers)i.setRequestHeader(r,e.headers[r]);return"json"===e.type&&(i.responseType="text",i.setRequestHeader("Accept","application/json")),i.withCredentials="include"===e.credentials,i.onerror=function(){t(new Error(i.statusText))},i.onload=function(){if((i.status>=200&&i.status<300||0===i.status)&&null!==i.response){var r=i.response;if("json"===e.type)try{r=JSON.parse(i.response)}catch(e){return t(e)}t(null,r,i.getResponseHeader("Cache-Control"),i.getResponseHeader("Expires"))}else t(new _e(i.statusText,i.status,e.url))},i.send(e.body),{cancel:function(){return i.abort()}}}(e,t)},xe=function(e,t){return ve(p(e,{type:"arrayBuffer"}),t)},be=function(e,t){return ve(p(e,{method:"POST"}),t)},we="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";me=[],ge=0;var Se=function(e,t){if(V.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),ge>=N.MAX_PARALLEL_IMAGE_REQUESTS){var i={requestParameters:e,callback:t,cancelled:!1,cancel:function(){this.cancelled=!0}};return me.push(i),i}ge++;var r=!1,n=function(){if(!r)for(r=!0,ge--;me.length&&ge<N.MAX_PARALLEL_IMAGE_REQUESTS;){var e=me.shift();e.cancelled||(e.cancel=Se(e.requestParameters,e.callback).cancel)}},a=xe(e,(function(e,i,r,a){n(),e?t(e):i&&(de()?function(e,t){var i=new o.Blob([new Uint8Array(e)],{type:"image/png"});o.createImageBitmap(i).then((function(e){t(null,e)})).catch((function(e){t(new Error("Could not load image because of "+e.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))}))}(i,t):function(e,t,i,r){var n=new o.Image,a=o.URL;n.onload=function(){t(null,n),a.revokeObjectURL(n.src),n.onload=null,n.src=we},n.onerror=function(){return t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var s=new o.Blob([new Uint8Array(e)],{type:"image/png"});n.cacheControl=i,n.expires=r,n.src=e.byteLength?a.createObjectURL(s):we}(i,t,r,a))}));return{cancel:function(){a.cancel(),n()}}};function Me(e,t,i){i[e]&&-1!==i[e].indexOf(t)||(i[e]=i[e]||[],i[e].push(t))}function Te(e,t,i){if(i&&i[e]){var r=i[e].indexOf(t);-1!==r&&i[e].splice(r,1)}}var Ee=function(e,t){void 0===t&&(t={}),p(this,t),this.type=e},Ce=function(e){function t(t,i){void 0===i&&(i={}),e.call(this,"error",p({error:t},i))}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Ee),Ae=function(){};Ae.prototype.on=function(e,t){return this._listeners=this._listeners||{},Me(e,t,this._listeners),this},Ae.prototype.off=function(e,t){return Te(e,t,this._listeners),Te(e,t,this._oneTimeListeners),this},Ae.prototype.once=function(e,t){return this._oneTimeListeners=this._oneTimeListeners||{},Me(e,t,this._oneTimeListeners),this},Ae.prototype.fire=function(e,t){"string"==typeof e&&(e=new Ee(e,t||{}));var i=e.type;if(this.listens(i)){e.target=this;for(var r=0,n=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];r<n.length;r+=1)n[r].call(this,e);for(var a=0,o=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];a<o.length;a+=1){var s=o[a];Te(i,s,this._oneTimeListeners),s.call(this,e)}var l=this._eventedParent;l&&(p(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),l.fire(e))}else e instanceof Ce&&console.error(e.error);return this},Ae.prototype.listens=function(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)},Ae.prototype.setEventedParent=function(e,t){return this._eventedParent=e,this._eventedParentData=t,this};var Ie={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Pe=function(e,t,i,r){this.message=(e?e+": ":"")+i,r&&(this.identifier=r),null!=t&&t.__line__&&(this.line=t.__line__)};function ze(e){var t=e.value;return t?[new Pe(e.key,t,"constants have been deprecated as of v8")]:[]}function Re(e){for(var t=[],i=arguments.length-1;i-- >0;)t[i]=arguments[i+1];for(var r=0,n=t;r<n.length;r+=1){var a=n[r];for(var o in a)e[o]=a[o]}return e}function ke(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Le(e){if(Array.isArray(e))return e.map(Le);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){var t={};for(var i in e)t[i]=Le(e[i]);return t}return ke(e)}var De=function(e){function t(t,i){e.call(this,i),this.message=i,this.key=t}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Error),Be=function(e,t){void 0===t&&(t=[]),this.parent=e,this.bindings={};for(var i=0,r=t;i<r.length;i+=1){var n=r[i];this.bindings[n[0]]=n[1]}};Be.prototype.concat=function(e){return new Be(this,e)},Be.prototype.get=function(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(e+" not found in scope.")},Be.prototype.has=function(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)};var Fe={kind:"null"},Oe={kind:"number"},Ne={kind:"string"},Ve={kind:"boolean"},Ue={kind:"color"},$e={kind:"object"},je={kind:"value"},qe={kind:"collator"},Ge={kind:"formatted"},He={kind:"resolvedImage"};function We(e,t){return{kind:"array",itemType:e,N:t}}function Ze(e){if("array"===e.kind){var t=Ze(e.itemType);return"number"==typeof e.N?"array<"+t+", "+e.N+">":"value"===e.itemType.kind?"array":"array<"+t+">"}return e.kind}var Xe=[Fe,Oe,Ne,Ve,Ue,Ge,$e,We(je),He];function Ye(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!Ye(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(var i=0,r=Xe;i<r.length;i+=1)if(!Ye(r[i],t))return null}return"Expected "+Ze(e)+" but found "+Ze(t)+" instead."}function Ke(e,t){return t.some((function(t){return t.kind===e.kind}))}function Je(e,t){return t.some((function(t){return"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e}))}var Qe=t((function(e,t){var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(e){return(e=Math.round(e))<0?0:e>255?255:e}function n(e){return r("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function a(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function o(e,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}try{t.parseCSSColor=function(e){var t,s=e.replace(/ /g,"").toLowerCase();if(s in i)return i[s].slice();if("#"===s[0])return 4===s.length?(t=parseInt(s.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===s.length&&(t=parseInt(s.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var l=s.indexOf("("),c=s.indexOf(")");if(-1!==l&&c+1===s.length){var u=s.substr(0,l),h=s.substr(l+1,c-(l+1)).split(","),p=1;switch(u){case"rgba":if(4!==h.length)return null;p=a(h.pop());case"rgb":return 3!==h.length?null:[n(h[0]),n(h[1]),n(h[2]),p];case"hsla":if(4!==h.length)return null;p=a(h.pop());case"hsl":if(3!==h.length)return null;var d=(parseFloat(h[0])%360+360)%360/360,f=a(h[1]),m=a(h[2]),g=m<=.5?m*(f+1):m+f-m*f,_=2*m-g;return[r(255*o(_,g,d+1/3)),r(255*o(_,g,d)),r(255*o(_,g,d-1/3)),p];default:return null}}return null}}catch(e){}})).parseCSSColor,et=function(e,t,i,r){void 0===r&&(r=1),this.r=e,this.g=t,this.b=i,this.a=r};et.parse=function(e){if(e){if(e instanceof et)return e;if("string"==typeof e){var t=Qe(e);if(t)return new et(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3])}}},et.prototype.toString=function(){var e=this.toArray(),t=e[1],i=e[2],r=e[3];return"rgba("+Math.round(e[0])+","+Math.round(t)+","+Math.round(i)+","+r+")"},et.prototype.toArray=function(){var e=this.a;return 0===e?[0,0,0,0]:[255*this.r/e,255*this.g/e,255*this.b/e,e]},et.black=new et(0,0,0,1),et.white=new et(1,1,1,1),et.transparent=new et(0,0,0,0),et.red=new et(1,0,0,1);var tt=function(e,t,i){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};tt.prototype.compare=function(e,t){return this.collator.compare(e,t)},tt.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var it=function(e,t,i,r,n){this.text=e,this.image=t,this.scale=i,this.fontStack=r,this.textColor=n},rt=function(e){this.sections=e};rt.fromString=function(e){return new rt([new it(e,null,null,null,null)])},rt.prototype.isEmpty=function(){return 0===this.sections.length||!this.sections.some((function(e){return 0!==e.text.length||e.image&&0!==e.image.name.length}))},rt.factory=function(e){return e instanceof rt?e:rt.fromString(e)},rt.prototype.toString=function(){return 0===this.sections.length?"":this.sections.map((function(e){return e.text})).join("")},rt.prototype.serialize=function(){for(var e=["format"],t=0,i=this.sections;t<i.length;t+=1){var r=i[t];if(r.image)e.push(["image",r.image.name]);else{e.push(r.text);var n={};r.fontStack&&(n["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(n["font-scale"]=r.scale),r.textColor&&(n["text-color"]=["rgba"].concat(r.textColor.toArray())),e.push(n)}}return e};var nt=function(e){this.name=e.name,this.available=e.available};function at(e,t,i,r){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:"Invalid rgba value ["+[e,t,i,r].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+("number"==typeof r?[e,t,i,r]:[e,t,i]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function ot(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof et)return!0;if(e instanceof tt)return!0;if(e instanceof rt)return!0;if(e instanceof nt)return!0;if(Array.isArray(e)){for(var t=0,i=e;t<i.length;t+=1)if(!ot(i[t]))return!1;return!0}if("object"==typeof e){for(var r in e)if(!ot(e[r]))return!1;return!0}return!1}function st(e){if(null===e)return Fe;if("string"==typeof e)return Ne;if("boolean"==typeof e)return Ve;if("number"==typeof e)return Oe;if(e instanceof et)return Ue;if(e instanceof tt)return qe;if(e instanceof rt)return Ge;if(e instanceof nt)return He;if(Array.isArray(e)){for(var t,i=e.length,r=0,n=e;r<n.length;r+=1){var a=st(n[r]);if(t){if(t===a)continue;t=je;break}t=a}return We(t||je,i)}return $e}function lt(e){var t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof et||e instanceof rt||e instanceof nt?e.toString():JSON.stringify(e)}nt.prototype.toString=function(){return this.name},nt.fromString=function(e){return e?new nt({name:e,available:!1}):null},nt.prototype.serialize=function(){return["image",this.name]};var ct=function(e,t){this.type=e,this.value=t};ct.parse=function(e,t){if(2!==e.length)return t.error("'literal' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(!ot(e[1]))return t.error("invalid value");var i=e[1],r=st(i),n=t.expectedType;return"array"!==r.kind||0!==r.N||!n||"array"!==n.kind||"number"==typeof n.N&&0!==n.N||(r=n),new ct(r,i)},ct.prototype.evaluate=function(){return this.value},ct.prototype.eachChild=function(){},ct.prototype.outputDefined=function(){return!0},ct.prototype.serialize=function(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof et?["rgba"].concat(this.value.toArray()):this.value instanceof rt?this.value.serialize():this.value};var ut=function(e){this.name="ExpressionEvaluationError",this.message=e};ut.prototype.toJSON=function(){return this.message};var ht={string:Ne,number:Oe,boolean:Ve,object:$e},pt=function(e,t){this.type=e,this.args=t};pt.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var i,r=1,n=e[0];if("array"===n){var a,o;if(e.length>2){var s=e[1];if("string"!=typeof s||!(s in ht)||"object"===s)return t.error('The item type argument of "array" must be one of string, number, boolean',1);a=ht[s],r++}else a=je;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);o=e[2],r++}i=We(a,o)}else i=ht[n];for(var l=[];r<e.length;r++){var c=t.parse(e[r],r,je);if(!c)return null;l.push(c)}return new pt(i,l)},pt.prototype.evaluate=function(e){for(var t=0;t<this.args.length;t++){var i=this.args[t].evaluate(e);if(!Ye(this.type,st(i)))return i;if(t===this.args.length-1)throw new ut("Expected value to be of type "+Ze(this.type)+", but found "+Ze(st(i))+" instead.")}return null},pt.prototype.eachChild=function(e){this.args.forEach(e)},pt.prototype.outputDefined=function(){return this.args.every((function(e){return e.outputDefined()}))},pt.prototype.serialize=function(){var e=this.type,t=[e.kind];if("array"===e.kind){var i=e.itemType;if("string"===i.kind||"number"===i.kind||"boolean"===i.kind){t.push(i.kind);var r=e.N;("number"==typeof r||this.args.length>1)&&t.push(r)}}return t.concat(this.args.map((function(e){return e.serialize()})))};var dt=function(e){this.type=Ge,this.sections=e};dt.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var i=e[1];if(!Array.isArray(i)&&"object"==typeof i)return t.error("First argument must be an image or text section.");for(var r=[],n=!1,a=1;a<=e.length-1;++a){var o=e[a];if(n&&"object"==typeof o&&!Array.isArray(o)){n=!1;var s=null;if(o["font-scale"]&&!(s=t.parse(o["font-scale"],1,Oe)))return null;var l=null;if(o["text-font"]&&!(l=t.parse(o["text-font"],1,We(Ne))))return null;var c=null;if(o["text-color"]&&!(c=t.parse(o["text-color"],1,Ue)))return null;var u=r[r.length-1];u.scale=s,u.font=l,u.textColor=c}else{var h=t.parse(e[a],1,je);if(!h)return null;var p=h.type.kind;if("string"!==p&&"value"!==p&&"null"!==p&&"resolvedImage"!==p)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");n=!0,r.push({content:h,scale:null,font:null,textColor:null})}}return new dt(r)},dt.prototype.evaluate=function(e){return new rt(this.sections.map((function(t){var i=t.content.evaluate(e);return st(i)===He?new it("",i,null,null,null):new it(lt(i),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)})))},dt.prototype.eachChild=function(e){for(var t=0,i=this.sections;t<i.length;t+=1){var r=i[t];e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}},dt.prototype.outputDefined=function(){return!1},dt.prototype.serialize=function(){for(var e=["format"],t=0,i=this.sections;t<i.length;t+=1){var r=i[t];e.push(r.content.serialize());var n={};r.scale&&(n["font-scale"]=r.scale.serialize()),r.font&&(n["text-font"]=r.font.serialize()),r.textColor&&(n["text-color"]=r.textColor.serialize()),e.push(n)}return e};var ft=function(e){this.type=He,this.input=e};ft.parse=function(e,t){if(2!==e.length)return t.error("Expected two arguments.");var i=t.parse(e[1],1,Ne);return i?new ft(i):t.error("No image name provided.")},ft.prototype.evaluate=function(e){var t=this.input.evaluate(e),i=nt.fromString(t);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(t)>-1),i},ft.prototype.eachChild=function(e){e(this.input)},ft.prototype.outputDefined=function(){return!1},ft.prototype.serialize=function(){return["image",this.input.serialize()]};var mt={"to-boolean":Ve,"to-color":Ue,"to-number":Oe,"to-string":Ne},gt=function(e,t){this.type=e,this.args=t};gt.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var i=e[0];if(("to-boolean"===i||"to-string"===i)&&2!==e.length)return t.error("Expected one argument.");for(var r=mt[i],n=[],a=1;a<e.length;a++){var o=t.parse(e[a],a,je);if(!o)return null;n.push(o)}return new gt(r,n)},gt.prototype.evaluate=function(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){for(var t,i,r=0,n=this.args;r<n.length;r+=1){if(i=null,(t=n[r].evaluate(e))instanceof et)return t;if("string"==typeof t){var a=e.parseColor(t);if(a)return a}else if(Array.isArray(t)&&!(i=t.length<3||t.length>4?"Invalid rbga value "+JSON.stringify(t)+": expected an array containing either three or four numeric values.":at(t[0],t[1],t[2],t[3])))return new et(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new ut(i||"Could not parse color from value '"+("string"==typeof t?t:String(JSON.stringify(t)))+"'")}if("number"===this.type.kind){for(var o=null,s=0,l=this.args;s<l.length;s+=1){if(null===(o=l[s].evaluate(e)))return 0;var c=Number(o);if(!isNaN(c))return c}throw new ut("Could not convert "+JSON.stringify(o)+" to number.")}return"formatted"===this.type.kind?rt.fromString(lt(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?nt.fromString(lt(this.args[0].evaluate(e))):lt(this.args[0].evaluate(e))},gt.prototype.eachChild=function(e){this.args.forEach(e)},gt.prototype.outputDefined=function(){return this.args.every((function(e){return e.outputDefined()}))},gt.prototype.serialize=function(){if("formatted"===this.type.kind)return new dt([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new ft(this.args[0]).serialize();var e=["to-"+this.type.kind];return this.eachChild((function(t){e.push(t.serialize())})),e};var _t=["Unknown","Point","LineString","Polygon"],yt=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};yt.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},yt.prototype.geometryType=function(){return this.feature?"number"==typeof this.feature.type?_t[this.feature.type]:this.feature.type:null},yt.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},yt.prototype.canonicalID=function(){return this.canonical},yt.prototype.properties=function(){return this.feature&&this.feature.properties||{}},yt.prototype.parseColor=function(e){var t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=et.parse(e)),t};var vt=function(e,t,i,r){this.name=e,this.type=t,this._evaluate=i,this.args=r};vt.prototype.evaluate=function(e){return this._evaluate(e,this.args)},vt.prototype.eachChild=function(e){this.args.forEach(e)},vt.prototype.outputDefined=function(){return!1},vt.prototype.serialize=function(){return[this.name].concat(this.args.map((function(e){return e.serialize()})))},vt.parse=function(e,t){var i,r=e[0],n=vt.definitions[r];if(!n)return t.error('Unknown expression "'+r+'". If you wanted a literal array, use ["literal", [...]].',0);for(var a=Array.isArray(n)?n[0]:n.type,o=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,s=o.filter((function(t){var i=t[0];return!Array.isArray(i)||i.length===e.length-1})),l=null,c=0,u=s;c<u.length;c+=1){var h=u[c],p=h[0],d=h[1];l=new Ut(t.registry,t.path,null,t.scope);for(var f=[],m=!1,g=1;g<e.length;g++){var _=e[g],y=Array.isArray(p)?p[g-1]:p.type,v=l.parse(_,1+f.length,y);if(!v){m=!0;break}f.push(v)}if(!m)if(Array.isArray(p)&&p.length!==f.length)l.error("Expected "+p.length+" arguments, but found "+f.length+" instead.");else{for(var x=0;x<f.length;x++){var b=Array.isArray(p)?p[x]:p.type,w=f[x];l.concat(x+1).checkSubtype(b,w.type)}if(0===l.errors.length)return new vt(r,a,d,f)}}if(1===s.length)(i=t.errors).push.apply(i,l.errors);else{for(var S=(s.length?s:o).map((function(e){var t;return t=e[0],Array.isArray(t)?"("+t.map(Ze).join(", ")+")":"("+Ze(t.type)+"...)"})).join(" | "),M=[],T=1;T<e.length;T++){var E=t.parse(e[T],1+M.length);if(!E)return null;M.push(Ze(E.type))}t.error("Expected arguments of type "+S+", but found ("+M.join(", ")+") instead.")}return null},vt.register=function(e,t){for(var i in vt.definitions=t,t)e[i]=vt};var xt=function(e,t,i){this.type=qe,this.locale=i,this.caseSensitive=e,this.diacriticSensitive=t};function bt(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function wt(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function St(e,t){var i=(180+e[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,n=Math.pow(2,t.z);return[Math.round(i*n*8192),Math.round(r*n*8192)]}function Mt(e,t,i){return t[1]>e[1]!=i[1]>e[1]&&e[0]<(i[0]-t[0])*(e[1]-t[1])/(i[1]-t[1])+t[0]}function Tt(e,t){for(var i,r,n,a,o,s,l,c=!1,u=0,h=t.length;u<h;u++)for(var p=t[u],d=0,f=p.length;d<f-1;d++){if((a=(i=e)[0]-(r=p[d])[0])*(l=i[1]-(n=p[d+1])[1])-(s=i[0]-n[0])*(o=i[1]-r[1])==0&&a*s<=0&&o*l<=0)return!1;Mt(e,p[d],p[d+1])&&(c=!c)}return c}function Et(e,t){for(var i=0;i<t.length;i++)if(Tt(e,t[i]))return!0;return!1}function Ct(e,t,i,r){var n=r[0]-i[0],a=r[1]-i[1],o=(e[0]-i[0])*a-n*(e[1]-i[1]),s=(t[0]-i[0])*a-n*(t[1]-i[1]);return o>0&&s<0||o<0&&s>0}function At(e,t,i){for(var r=0,n=i;r<n.length;r+=1)for(var a=n[r],o=0;o<a.length-1;++o)if(0!=(h=[(u=a[o+1])[0]-(c=a[o])[0],u[1]-c[1]])[0]*(p=[(l=t)[0]-(s=e)[0],l[1]-s[1]])[1]-h[1]*p[0]&&Ct(s,l,c,u)&&Ct(c,u,s,l))return!0;var s,l,c,u,h,p;return!1}function It(e,t){for(var i=0;i<e.length;++i)if(!Tt(e[i],t))return!1;for(var r=0;r<e.length-1;++r)if(At(e[r],e[r+1],t))return!1;return!0}function Pt(e,t){for(var i=0;i<t.length;i++)if(It(e,t[i]))return!0;return!1}function zt(e,t,i){for(var r=[],n=0;n<e.length;n++){for(var a=[],o=0;o<e[n].length;o++){var s=St(e[n][o],i);bt(t,s),a.push(s)}r.push(a)}return r}function Rt(e,t,i){for(var r=[],n=0;n<e.length;n++){var a=zt(e[n],t,i);r.push(a)}return r}function kt(e,t,i,r){if(e[0]<i[0]||e[0]>i[2]){var n=.5*r,a=e[0]-i[0]>n?-r:i[0]-e[0]>n?r:0;0===a&&(a=e[0]-i[2]>n?-r:i[2]-e[0]>n?r:0),e[0]+=a}bt(t,e)}function Lt(e,t,i,r){for(var n=8192*Math.pow(2,r.z),a=[8192*r.x,8192*r.y],o=[],s=0,l=e;s<l.length;s+=1)for(var c=0,u=l[s];c<u.length;c+=1){var h=u[c],p=[h.x+a[0],h.y+a[1]];kt(p,t,i,n),o.push(p)}return o}function Dt(e,t,i,r){for(var n,a=8192*Math.pow(2,r.z),o=[8192*r.x,8192*r.y],s=[],l=0,c=e;l<c.length;l+=1){for(var u=[],h=0,p=c[l];h<p.length;h+=1){var d=p[h],f=[d.x+o[0],d.y+o[1]];bt(t,f),u.push(f)}s.push(u)}if(t[2]-t[0]<=a/2){(n=t)[0]=n[1]=1/0,n[2]=n[3]=-1/0;for(var m=0,g=s;m<g.length;m+=1)for(var _=0,y=g[m];_<y.length;_+=1)kt(y[_],t,i,a)}return s}xt.parse=function(e,t){if(2!==e.length)return t.error("Expected one argument.");var i=e[1];if("object"!=typeof i||Array.isArray(i))return t.error("Collator options argument must be an object.");var r=t.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,Ve);if(!r)return null;var n=t.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,Ve);if(!n)return null;var a=null;return i.locale&&!(a=t.parse(i.locale,1,Ne))?null:new xt(r,n,a)},xt.prototype.evaluate=function(e){return new tt(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)},xt.prototype.eachChild=function(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)},xt.prototype.outputDefined=function(){return!1},xt.prototype.serialize=function(){var e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]};var Bt=function(e,t){this.type=Ve,this.geojson=e,this.geometries=t};function Ft(e){if(e instanceof vt){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof Bt)return!1;var t=!0;return e.eachChild((function(e){t&&!Ft(e)&&(t=!1)})),t}function Ot(e){if(e instanceof vt&&"feature-state"===e.name)return!1;var t=!0;return e.eachChild((function(e){t&&!Ot(e)&&(t=!1)})),t}function Nt(e,t){if(e instanceof vt&&t.indexOf(e.name)>=0)return!1;var i=!0;return e.eachChild((function(e){i&&!Nt(e,t)&&(i=!1)})),i}Bt.parse=function(e,t){if(2!==e.length)return t.error("'within' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(ot(e[1])){var i=e[1];if("FeatureCollection"===i.type)for(var r=0;r<i.features.length;++r){var n=i.features[r].geometry.type;if("Polygon"===n||"MultiPolygon"===n)return new Bt(i,i.features[r].geometry)}else if("Feature"===i.type){var a=i.geometry.type;if("Polygon"===a||"MultiPolygon"===a)return new Bt(i,i.geometry)}else if("Polygon"===i.type||"MultiPolygon"===i.type)return new Bt(i,i)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Bt.prototype.evaluate=function(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){var i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=e.canonicalID();if("Polygon"===t.type){var a=zt(t.coordinates,r,n),o=Lt(e.geometry(),i,r,n);if(!wt(i,r))return!1;for(var s=0,l=o;s<l.length;s+=1)if(!Tt(l[s],a))return!1}if("MultiPolygon"===t.type){var c=Rt(t.coordinates,r,n),u=Lt(e.geometry(),i,r,n);if(!wt(i,r))return!1;for(var h=0,p=u;h<p.length;h+=1)if(!Et(p[h],c))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){var i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=e.canonicalID();if("Polygon"===t.type){var a=zt(t.coordinates,r,n),o=Dt(e.geometry(),i,r,n);if(!wt(i,r))return!1;for(var s=0,l=o;s<l.length;s+=1)if(!It(l[s],a))return!1}if("MultiPolygon"===t.type){var c=Rt(t.coordinates,r,n),u=Dt(e.geometry(),i,r,n);if(!wt(i,r))return!1;for(var h=0,p=u;h<p.length;h+=1)if(!Pt(p[h],c))return!1}return!0}(e,this.geometries)}return!1},Bt.prototype.eachChild=function(){},Bt.prototype.outputDefined=function(){return!0},Bt.prototype.serialize=function(){return["within",this.geojson]};var Vt=function(e,t){this.type=t.type,this.name=e,this.boundExpression=t};Vt.parse=function(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");var i=e[1];return t.scope.has(i)?new Vt(i,t.scope.get(i)):t.error('Unknown variable "'+i+'". Make sure "'+i+'" has been bound in an enclosing "let" expression before using it.',1)},Vt.prototype.evaluate=function(e){return this.boundExpression.evaluate(e)},Vt.prototype.eachChild=function(){},Vt.prototype.outputDefined=function(){return!1},Vt.prototype.serialize=function(){return["var",this.name]};var Ut=function(e,t,i,r,n){void 0===t&&(t=[]),void 0===r&&(r=new Be),void 0===n&&(n=[]),this.registry=e,this.path=t,this.key=t.map((function(e){return"["+e+"]"})).join(""),this.scope=r,this.errors=n,this.expectedType=i};function $t(e,t){for(var i,r=e.length-1,n=0,a=r,o=0;n<=a;)if((i=e[o=Math.floor((n+a)/2)])<=t){if(o===r||t<e[o+1])return o;n=o+1}else{if(!(i>t))throw new ut("Input is not a number.");a=o-1}return 0}Ut.prototype.parse=function(e,t,i,r,n){return void 0===n&&(n={}),t?this.concat(t,i,r)._parse(e,n):this._parse(e,n)},Ut.prototype._parse=function(e,t){function i(e,t,i){return"assert"===i?new pt(t,[e]):"coerce"===i?new gt(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var r=e[0];if("string"!=typeof r)return this.error("Expression name must be a string, but found "+typeof r+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var n=this.registry[r];if(n){var a=n.parse(e,this);if(!a)return null;if(this.expectedType){var o=this.expectedType,s=a.type;if("string"!==o.kind&&"number"!==o.kind&&"boolean"!==o.kind&&"object"!==o.kind&&"array"!==o.kind||"value"!==s.kind)if("color"!==o.kind&&"formatted"!==o.kind&&"resolvedImage"!==o.kind||"value"!==s.kind&&"string"!==s.kind){if(this.checkSubtype(o,s))return null}else a=i(a,o,t.typeAnnotation||"coerce");else a=i(a,o,t.typeAnnotation||"assert")}if(!(a instanceof ct)&&"resolvedImage"!==a.type.kind&&function e(t){if(t instanceof Vt)return e(t.boundExpression);if(t instanceof vt&&"error"===t.name)return!1;if(t instanceof xt)return!1;if(t instanceof Bt)return!1;var i=t instanceof gt||t instanceof pt,r=!0;return t.eachChild((function(t){r=i?r&&e(t):r&&t instanceof ct})),!!r&&Ft(t)&&Nt(t,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(a)){var l=new yt;try{a=new ct(a.type,a.evaluate(l))}catch(e){return this.error(e.message),null}}return a}return this.error('Unknown expression "'+r+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof e+" instead.")},Ut.prototype.concat=function(e,t,i){var r="number"==typeof e?this.path.concat(e):this.path,n=i?this.scope.concat(i):this.scope;return new Ut(this.registry,r,t||null,n,this.errors)},Ut.prototype.error=function(e){for(var t=[],i=arguments.length-1;i-- >0;)t[i]=arguments[i+1];var r=""+this.key+t.map((function(e){return"["+e+"]"})).join("");this.errors.push(new De(r,e))},Ut.prototype.checkSubtype=function(e,t){var i=Ye(e,t);return i&&this.error(i),i};var jt=function(e,t,i){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(var r=0,n=i;r<n.length;r+=1){var a=n[r],o=a[1];this.labels.push(a[0]),this.outputs.push(o)}};function qt(e,t,i){return e*(1-i)+t*i}jt.parse=function(e,t){if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");var i=t.parse(e[1],1,Oe);if(!i)return null;var r=[],n=null;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);for(var a=1;a<e.length;a+=2){var o=1===a?-1/0:e[a],s=e[a+1],l=a,c=a+1;if("number"!=typeof o)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',l);if(r.length&&r[r.length-1][0]>=o)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',l);var u=t.parse(s,c,n);if(!u)return null;n=n||u.type,r.push([o,u])}return new jt(n,i,r)},jt.prototype.evaluate=function(e){var t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);var r=this.input.evaluate(e);if(r<=t[0])return i[0].evaluate(e);var n=t.length;return r>=t[n-1]?i[n-1].evaluate(e):i[$t(t,r)].evaluate(e)},jt.prototype.eachChild=function(e){e(this.input);for(var t=0,i=this.outputs;t<i.length;t+=1)e(i[t])},jt.prototype.outputDefined=function(){return this.outputs.every((function(e){return e.outputDefined()}))},jt.prototype.serialize=function(){for(var e=["step",this.input.serialize()],t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e};var Gt=Object.freeze({__proto__:null,number:qt,color:function(e,t,i){return new et(qt(e.r,t.r,i),qt(e.g,t.g,i),qt(e.b,t.b,i),qt(e.a,t.a,i))},array:function(e,t,i){return e.map((function(e,r){return qt(e,t[r],i)}))}}),Ht=6/29*3*(6/29),Wt=Math.PI/180,Zt=180/Math.PI;function Xt(e){return e>.008856451679035631?Math.pow(e,1/3):e/Ht+4/29}function Yt(e){return e>6/29?e*e*e:Ht*(e-4/29)}function Kt(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Jt(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Qt(e){var t=Jt(e.r),i=Jt(e.g),r=Jt(e.b),n=Xt((.4124564*t+.3575761*i+.1804375*r)/.95047),a=Xt((.2126729*t+.7151522*i+.072175*r)/1);return{l:116*a-16,a:500*(n-a),b:200*(a-Xt((.0193339*t+.119192*i+.9503041*r)/1.08883)),alpha:e.a}}function ei(e){var t=(e.l+16)/116,i=isNaN(e.a)?t:t+e.a/500,r=isNaN(e.b)?t:t-e.b/200;return t=1*Yt(t),i=.95047*Yt(i),r=1.08883*Yt(r),new et(Kt(3.2404542*i-1.5371385*t-.4985314*r),Kt(-.969266*i+1.8760108*t+.041556*r),Kt(.0556434*i-.2040259*t+1.0572252*r),e.alpha)}function ti(e,t,i){var r=t-e;return e+i*(r>180||r<-180?r-360*Math.round(r/360):r)}var ii={forward:Qt,reverse:ei,interpolate:function(e,t,i){return{l:qt(e.l,t.l,i),a:qt(e.a,t.a,i),b:qt(e.b,t.b,i),alpha:qt(e.alpha,t.alpha,i)}}},ri={forward:function(e){var t=Qt(e),i=t.l,r=t.a,n=t.b,a=Math.atan2(n,r)*Zt;return{h:a<0?a+360:a,c:Math.sqrt(r*r+n*n),l:i,alpha:e.a}},reverse:function(e){var t=e.h*Wt,i=e.c;return ei({l:e.l,a:Math.cos(t)*i,b:Math.sin(t)*i,alpha:e.alpha})},interpolate:function(e,t,i){return{h:ti(e.h,t.h,i),c:qt(e.c,t.c,i),l:qt(e.l,t.l,i),alpha:qt(e.alpha,t.alpha,i)}}},ni=Object.freeze({__proto__:null,lab:ii,hcl:ri}),ai=function(e,t,i,r,n){this.type=e,this.operator=t,this.interpolation=i,this.input=r,this.labels=[],this.outputs=[];for(var a=0,o=n;a<o.length;a+=1){var s=o[a],l=s[1];this.labels.push(s[0]),this.outputs.push(l)}};function oi(e,t,i,r){var n=r-i,a=e-i;return 0===n?0:1===t?a/n:(Math.pow(t,a)-1)/(Math.pow(t,n)-1)}ai.interpolationFactor=function(e,t,r,n){var a=0;if("exponential"===e.name)a=oi(t,e.base,r,n);else if("linear"===e.name)a=oi(t,1,r,n);else if("cubic-bezier"===e.name){var o=e.controlPoints;a=new i(o[0],o[1],o[2],o[3]).solve(oi(t,1,r,n))}return a},ai.parse=function(e,t){var i=e[0],r=e[1],n=e[2],a=e.slice(3);if(!Array.isArray(r)||0===r.length)return t.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){var o=r[1];if("number"!=typeof o)return t.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:o}}else{if("cubic-bezier"!==r[0])return t.error("Unknown interpolation type "+String(r[0]),1,0);var s=r.slice(1);if(4!==s.length||s.some((function(e){return"number"!=typeof e||e<0||e>1})))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:s}}if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(!(n=t.parse(n,2,Oe)))return null;var l=[],c=null;"interpolate-hcl"===i||"interpolate-lab"===i?c=Ue:t.expectedType&&"value"!==t.expectedType.kind&&(c=t.expectedType);for(var u=0;u<a.length;u+=2){var h=a[u],p=a[u+1],d=u+3,f=u+4;if("number"!=typeof h)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',d);if(l.length&&l[l.length-1][0]>=h)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',d);var m=t.parse(p,f,c);if(!m)return null;c=c||m.type,l.push([h,m])}return"number"===c.kind||"color"===c.kind||"array"===c.kind&&"number"===c.itemType.kind&&"number"==typeof c.N?new ai(c,i,r,n,l):t.error("Type "+Ze(c)+" is not interpolatable.")},ai.prototype.evaluate=function(e){var t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);var r=this.input.evaluate(e);if(r<=t[0])return i[0].evaluate(e);var n=t.length;if(r>=t[n-1])return i[n-1].evaluate(e);var a=$t(t,r),o=ai.interpolationFactor(this.interpolation,r,t[a],t[a+1]),s=i[a].evaluate(e),l=i[a+1].evaluate(e);return"interpolate"===this.operator?Gt[this.type.kind.toLowerCase()](s,l,o):"interpolate-hcl"===this.operator?ri.reverse(ri.interpolate(ri.forward(s),ri.forward(l),o)):ii.reverse(ii.interpolate(ii.forward(s),ii.forward(l),o))},ai.prototype.eachChild=function(e){e(this.input);for(var t=0,i=this.outputs;t<i.length;t+=1)e(i[t])},ai.prototype.outputDefined=function(){return this.outputs.every((function(e){return e.outputDefined()}))},ai.prototype.serialize=function(){var e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var t=[this.operator,e,this.input.serialize()],i=0;i<this.labels.length;i++)t.push(this.labels[i],this.outputs[i].serialize());return t};var si=function(e,t){this.type=e,this.args=t};si.parse=function(e,t){if(e.length<2)return t.error("Expectected at least one argument.");var i=null,r=t.expectedType;r&&"value"!==r.kind&&(i=r);for(var n=[],a=0,o=e.slice(1);a<o.length;a+=1){var s=t.parse(o[a],1+n.length,i,void 0,{typeAnnotation:"omit"});if(!s)return null;i=i||s.type,n.push(s)}var l=r&&n.some((function(e){return Ye(r,e.type)}));return new si(l?je:i,n)},si.prototype.evaluate=function(e){for(var t,i=null,r=0,n=0,a=this.args;n<a.length&&(r++,(i=a[n].evaluate(e))&&i instanceof nt&&!i.available&&(t||(t=i.name),i=null,r===this.args.length&&(i=t)),null===i);n+=1);return i},si.prototype.eachChild=function(e){this.args.forEach(e)},si.prototype.outputDefined=function(){return this.args.every((function(e){return e.outputDefined()}))},si.prototype.serialize=function(){var e=["coalesce"];return this.eachChild((function(t){e.push(t.serialize())})),e};var li=function(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t};li.prototype.evaluate=function(e){return this.result.evaluate(e)},li.prototype.eachChild=function(e){for(var t=0,i=this.bindings;t<i.length;t+=1)e(i[t][1]);e(this.result)},li.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found "+(e.length-1)+" instead.");for(var i=[],r=1;r<e.length-1;r+=2){var n=e[r];if("string"!=typeof n)return t.error("Expected string, but found "+typeof n+" instead.",r);if(/[^a-zA-Z0-9_]/.test(n))return t.error("Variable names must contain only alphanumeric characters or '_'.",r);var a=t.parse(e[r+1],r+1);if(!a)return null;i.push([n,a])}var o=t.parse(e[e.length-1],e.length-1,t.expectedType,i);return o?new li(i,o):null},li.prototype.outputDefined=function(){return this.result.outputDefined()},li.prototype.serialize=function(){for(var e=["let"],t=0,i=this.bindings;t<i.length;t+=1){var r=i[t];e.push(r[0],r[1].serialize())}return e.push(this.result.serialize()),e};var ci=function(e,t,i){this.type=e,this.index=t,this.input=i};ci.parse=function(e,t){if(3!==e.length)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var i=t.parse(e[1],1,Oe),r=t.parse(e[2],2,We(t.expectedType||je));return i&&r?new ci(r.type.itemType,i,r):null},ci.prototype.evaluate=function(e){var t=this.index.evaluate(e),i=this.input.evaluate(e);if(t<0)throw new ut("Array index out of bounds: "+t+" < 0.");if(t>=i.length)throw new ut("Array index out of bounds: "+t+" > "+(i.length-1)+".");if(t!==Math.floor(t))throw new ut("Array index must be an integer, but found "+t+" instead.");return i[t]},ci.prototype.eachChild=function(e){e(this.index),e(this.input)},ci.prototype.outputDefined=function(){return!1},ci.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var ui=function(e,t){this.type=Ve,this.needle=e,this.haystack=t};ui.parse=function(e,t){if(3!==e.length)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var i=t.parse(e[1],1,je),r=t.parse(e[2],2,je);return i&&r?Ke(i.type,[Ve,Ne,Oe,Fe,je])?new ui(i,r):t.error("Expected first argument to be of type boolean, string, number or null, but found "+Ze(i.type)+" instead"):null},ui.prototype.evaluate=function(e){var t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!i)return!1;if(!Je(t,["boolean","string","number","null"]))throw new ut("Expected first argument to be of type boolean, string, number or null, but found "+Ze(st(t))+" instead.");if(!Je(i,["string","array"]))throw new ut("Expected second argument to be of type array or string, but found "+Ze(st(i))+" instead.");return i.indexOf(t)>=0},ui.prototype.eachChild=function(e){e(this.needle),e(this.haystack)},ui.prototype.outputDefined=function(){return!0},ui.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var hi=function(e,t,i){this.type=Oe,this.needle=e,this.haystack=t,this.fromIndex=i};hi.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var i=t.parse(e[1],1,je),r=t.parse(e[2],2,je);if(!i||!r)return null;if(!Ke(i.type,[Ve,Ne,Oe,Fe,je]))return t.error("Expected first argument to be of type boolean, string, number or null, but found "+Ze(i.type)+" instead");if(4===e.length){var n=t.parse(e[3],3,Oe);return n?new hi(i,r,n):null}return new hi(i,r)},hi.prototype.evaluate=function(e){var t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!Je(t,["boolean","string","number","null"]))throw new ut("Expected first argument to be of type boolean, string, number or null, but found "+Ze(st(t))+" instead.");if(!Je(i,["string","array"]))throw new ut("Expected second argument to be of type array or string, but found "+Ze(st(i))+" instead.");if(this.fromIndex){var r=this.fromIndex.evaluate(e);return i.indexOf(t,r)}return i.indexOf(t)},hi.prototype.eachChild=function(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)},hi.prototype.outputDefined=function(){return!1},hi.prototype.serialize=function(){if(null!=this.fromIndex&&void 0!==this.fromIndex){var e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var pi=function(e,t,i,r,n,a){this.inputType=e,this.type=t,this.input=i,this.cases=r,this.outputs=n,this.otherwise=a};pi.parse=function(e,t){if(e.length<5)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if(e.length%2!=1)return t.error("Expected an even number of arguments.");var i,r;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);for(var n={},a=[],o=2;o<e.length-1;o+=2){var s=e[o],l=e[o+1];Array.isArray(s)||(s=[s]);var c=t.concat(o);if(0===s.length)return c.error("Expected at least one branch label.");for(var u=0,h=s;u<h.length;u+=1){var p=h[u];if("number"!=typeof p&&"string"!=typeof p)return c.error("Branch labels must be numbers or strings.");if("number"==typeof p&&Math.abs(p)>Number.MAX_SAFE_INTEGER)return c.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if("number"==typeof p&&Math.floor(p)!==p)return c.error("Numeric branch labels must be integer values.");if(i){if(c.checkSubtype(i,st(p)))return null}else i=st(p);if(void 0!==n[String(p)])return c.error("Branch labels must be unique.");n[String(p)]=a.length}var d=t.parse(l,o,r);if(!d)return null;r=r||d.type,a.push(d)}var f=t.parse(e[1],1,je);if(!f)return null;var m=t.parse(e[e.length-1],e.length-1,r);return m?"value"!==f.type.kind&&t.concat(1).checkSubtype(i,f.type)?null:new pi(i,r,f,n,a,m):null},pi.prototype.evaluate=function(e){var t=this.input.evaluate(e);return(st(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)},pi.prototype.eachChild=function(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)},pi.prototype.outputDefined=function(){return this.outputs.every((function(e){return e.outputDefined()}))&&this.otherwise.outputDefined()},pi.prototype.serialize=function(){for(var e=this,t=["match",this.input.serialize()],i=[],r={},n=0,a=Object.keys(this.cases).sort();n<a.length;n+=1){var o=a[n];void 0===(h=r[this.cases[o]])?(r[this.cases[o]]=i.length,i.push([this.cases[o],[o]])):i[h][1].push(o)}for(var s=function(t){return"number"===e.inputType.kind?Number(t):t},l=0,c=i;l<c.length;l+=1){var u=c[l],h=u[0],p=u[1];t.push(1===p.length?s(p[0]):p.map(s)),t.push(this.outputs[outputIndex$1].serialize())}return t.push(this.otherwise.serialize()),t};var di=function(e,t,i){this.type=e,this.branches=t,this.otherwise=i};di.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found only "+(e.length-1)+".");if(e.length%2!=0)return t.error("Expected an odd number of arguments.");var i;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);for(var r=[],n=1;n<e.length-1;n+=2){var a=t.parse(e[n],n,Ve);if(!a)return null;var o=t.parse(e[n+1],n+1,i);if(!o)return null;r.push([a,o]),i=i||o.type}var s=t.parse(e[e.length-1],e.length-1,i);return s?new di(i,r,s):null},di.prototype.evaluate=function(e){for(var t=0,i=this.branches;t<i.length;t+=1){var r=i[t],n=r[1];if(r[0].evaluate(e))return n.evaluate(e)}return this.otherwise.evaluate(e)},di.prototype.eachChild=function(e){for(var t=0,i=this.branches;t<i.length;t+=1){var r=i[t],n=r[1];e(r[0]),e(n)}e(this.otherwise)},di.prototype.outputDefined=function(){return this.branches.every((function(e){return e[1].outputDefined()}))&&this.otherwise.outputDefined()},di.prototype.serialize=function(){var e=["case"];return this.eachChild((function(t){e.push(t.serialize())})),e};var fi=function(e,t,i,r){this.type=e,this.input=t,this.beginIndex=i,this.endIndex=r};function mi(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function gi(e,t,i,r){return 0===r.compare(t,i)}function _i(e,t,i){var r="=="!==e&&"!="!==e;return function(){function n(e,t,i){this.type=Ve,this.lhs=e,this.rhs=t,this.collator=i,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}return n.parse=function(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");var i=e[0],a=t.parse(e[1],1,je);if(!a)return null;if(!mi(i,a.type))return t.concat(1).error('"'+i+"\" comparisons are not supported for type '"+Ze(a.type)+"'.");var o=t.parse(e[2],2,je);if(!o)return null;if(!mi(i,o.type))return t.concat(2).error('"'+i+"\" comparisons are not supported for type '"+Ze(o.type)+"'.");if(a.type.kind!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return t.error("Cannot compare types '"+Ze(a.type)+"' and '"+Ze(o.type)+"'.");r&&("value"===a.type.kind&&"value"!==o.type.kind?a=new pt(o.type,[a]):"value"!==a.type.kind&&"value"===o.type.kind&&(o=new pt(a.type,[o])));var s=null;if(4===e.length){if("string"!==a.type.kind&&"string"!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return t.error("Cannot use collator to compare non-string types.");if(!(s=t.parse(e[3],3,qe)))return null}return new n(a,o,s)},n.prototype.evaluate=function(n){var a=this.lhs.evaluate(n),o=this.rhs.evaluate(n);if(r&&this.hasUntypedArgument){var s=st(a),l=st(o);if(s.kind!==l.kind||"string"!==s.kind&&"number"!==s.kind)throw new ut('Expected arguments for "'+e+'" to be (string, string) or (number, number), but found ('+s.kind+", "+l.kind+") instead.")}if(this.collator&&!r&&this.hasUntypedArgument){var c=st(a),u=st(o);if("string"!==c.kind||"string"!==u.kind)return t(n,a,o)}return this.collator?i(n,a,o,this.collator.evaluate(n)):t(n,a,o)},n.prototype.eachChild=function(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)},n.prototype.outputDefined=function(){return!0},n.prototype.serialize=function(){var t=[e];return this.eachChild((function(e){t.push(e.serialize())})),t},n}()}fi.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var i=t.parse(e[1],1,je),r=t.parse(e[2],2,Oe);if(!i||!r)return null;if(!Ke(i.type,[We(je),Ne,je]))return t.error("Expected first argument to be of type array or string, but found "+Ze(i.type)+" instead");if(4===e.length){var n=t.parse(e[3],3,Oe);return n?new fi(i.type,i,r,n):null}return new fi(i.type,i,r)},fi.prototype.evaluate=function(e){var t=this.input.evaluate(e),i=this.beginIndex.evaluate(e);if(!Je(t,["string","array"]))throw new ut("Expected first argument to be of type array or string, but found "+Ze(st(t))+" instead.");if(this.endIndex){var r=this.endIndex.evaluate(e);return t.slice(i,r)}return t.slice(i)},fi.prototype.eachChild=function(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)},fi.prototype.outputDefined=function(){return!1},fi.prototype.serialize=function(){if(null!=this.endIndex&&void 0!==this.endIndex){var e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var yi=_i("==",(function(e,t,i){return t===i}),gi),vi=_i("!=",(function(e,t,i){return t!==i}),(function(e,t,i,r){return!gi(0,t,i,r)})),xi=_i("<",(function(e,t,i){return t<i}),(function(e,t,i,r){return r.compare(t,i)<0})),bi=_i(">",(function(e,t,i){return t>i}),(function(e,t,i,r){return r.compare(t,i)>0})),wi=_i("<=",(function(e,t,i){return t<=i}),(function(e,t,i,r){return r.compare(t,i)<=0})),Si=_i(">=",(function(e,t,i){return t>=i}),(function(e,t,i,r){return r.compare(t,i)>=0})),Mi=function(e,t,i,r,n){this.type=Ne,this.number=e,this.locale=t,this.currency=i,this.minFractionDigits=r,this.maxFractionDigits=n};Mi.parse=function(e,t){if(3!==e.length)return t.error("Expected two arguments.");var i=t.parse(e[1],1,Oe);if(!i)return null;var r=e[2];if("object"!=typeof r||Array.isArray(r))return t.error("NumberFormat options argument must be an object.");var n=null;if(r.locale&&!(n=t.parse(r.locale,1,Ne)))return null;var a=null;if(r.currency&&!(a=t.parse(r.currency,1,Ne)))return null;var o=null;if(r["min-fraction-digits"]&&!(o=t.parse(r["min-fraction-digits"],1,Oe)))return null;var s=null;return r["max-fraction-digits"]&&!(s=t.parse(r["max-fraction-digits"],1,Oe))?null:new Mi(i,n,a,o,s)},Mi.prototype.evaluate=function(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))},Mi.prototype.eachChild=function(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)},Mi.prototype.outputDefined=function(){return!1},Mi.prototype.serialize=function(){var e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]};var Ti=function(e){this.type=Oe,this.input=e};Ti.parse=function(e,t){if(2!==e.length)return t.error("Expected 1 argument, but found "+(e.length-1)+" instead.");var i=t.parse(e[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?t.error("Expected argument of type string or array, but found "+Ze(i.type)+" instead."):new Ti(i):null},Ti.prototype.evaluate=function(e){var t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new ut("Expected value to be of type string or array, but found "+Ze(st(t))+" instead.")},Ti.prototype.eachChild=function(e){e(this.input)},Ti.prototype.outputDefined=function(){return!1},Ti.prototype.serialize=function(){var e=["length"];return this.eachChild((function(t){e.push(t.serialize())})),e};var Ei={"==":yi,"!=":vi,">":bi,"<":xi,">=":Si,"<=":wi,array:pt,at:ci,boolean:pt,case:di,coalesce:si,collator:xt,format:dt,image:ft,in:ui,"index-of":hi,interpolate:ai,"interpolate-hcl":ai,"interpolate-lab":ai,length:Ti,let:li,literal:ct,match:pi,number:pt,"number-format":Mi,object:pt,slice:fi,step:jt,string:pt,"to-boolean":gt,"to-color":gt,"to-number":gt,"to-string":gt,var:Vt,within:Bt};function Ci(e,t){var i=t[0],r=t[1],n=t[2],a=t[3];i=i.evaluate(e),r=r.evaluate(e),n=n.evaluate(e);var o=a?a.evaluate(e):1,s=at(i,r,n,o);if(s)throw new ut(s);return new et(i/255*o,r/255*o,n/255*o,o)}function Ai(e,t){return e in t}function Ii(e,t){var i=t[e];return void 0===i?null:i}function Pi(e){return{type:e}}function zi(e){return{result:"success",value:e}}function Ri(e){return{result:"error",value:e}}function ki(e){return"data-driven"===e["property-type"]||"cross-faded-data-driven"===e["property-type"]}function Li(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Di(e){return!!e.expression&&e.expression.interpolated}function Bi(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function Fi(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function Oi(e){return e}function Ni(e,t,i){return void 0!==e?e:void 0!==t?t:void 0!==i?i:void 0}function Vi(e,t,i,r,n){return Ni(typeof i===n?r[i]:void 0,e.default,t.default)}function Ui(e,t,i){if("number"!==Bi(i))return Ni(e.default,t.default);var r=e.stops.length;if(1===r)return e.stops[0][1];if(i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[r-1][0])return e.stops[r-1][1];var n=$t(e.stops.map((function(e){return e[0]})),i);return e.stops[n][1]}function $i(e,t,i){var r=void 0!==e.base?e.base:1;if("number"!==Bi(i))return Ni(e.default,t.default);var n=e.stops.length;if(1===n)return e.stops[0][1];if(i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[n-1][0])return e.stops[n-1][1];var a=$t(e.stops.map((function(e){return e[0]})),i),o=function(e,t,i,r){var n=r-i,a=e-i;return 0===n?0:1===t?a/n:(Math.pow(t,a)-1)/(Math.pow(t,n)-1)}(i,r,e.stops[a][0],e.stops[a+1][0]),s=e.stops[a][1],l=e.stops[a+1][1],c=Gt[t.type]||Oi;if(e.colorSpace&&"rgb"!==e.colorSpace){var u=ni[e.colorSpace];c=function(e,t){return u.reverse(u.interpolate(u.forward(e),u.forward(t),o))}}return"function"==typeof s.evaluate?{evaluate:function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var i=s.evaluate.apply(void 0,e),r=l.evaluate.apply(void 0,e);if(void 0!==i&&void 0!==r)return c(i,r,o)}}:c(s,l,o)}function ji(e,t,i){return"color"===t.type?i=et.parse(i):"formatted"===t.type?i=rt.fromString(i.toString()):"resolvedImage"===t.type?i=nt.fromString(i.toString()):Bi(i)===t.type||"enum"===t.type&&t.values[i]||(i=void 0),Ni(i,e.default,t.default)}vt.register(Ei,{error:[{kind:"error"},[Ne],function(e,t){throw new ut(t[0].evaluate(e))}],typeof:[Ne,[je],function(e,t){return Ze(st(t[0].evaluate(e)))}],"to-rgba":[We(Oe,4),[Ue],function(e,t){return t[0].evaluate(e).toArray()}],rgb:[Ue,[Oe,Oe,Oe],Ci],rgba:[Ue,[Oe,Oe,Oe,Oe],Ci],has:{type:Ve,overloads:[[[Ne],function(e,t){return Ai(t[0].evaluate(e),e.properties())}],[[Ne,$e],function(e,t){var i=t[1];return Ai(t[0].evaluate(e),i.evaluate(e))}]]},get:{type:je,overloads:[[[Ne],function(e,t){return Ii(t[0].evaluate(e),e.properties())}],[[Ne,$e],function(e,t){var i=t[1];return Ii(t[0].evaluate(e),i.evaluate(e))}]]},"feature-state":[je,[Ne],function(e,t){return Ii(t[0].evaluate(e),e.featureState||{})}],properties:[$e,[],function(e){return e.properties()}],"geometry-type":[Ne,[],function(e){return e.geometryType()}],id:[je,[],function(e){return e.id()}],zoom:[Oe,[],function(e){return e.globals.zoom}],"heatmap-density":[Oe,[],function(e){return e.globals.heatmapDensity||0}],"line-progress":[Oe,[],function(e){return e.globals.lineProgress||0}],accumulated:[je,[],function(e){return void 0===e.globals.accumulated?null:e.globals.accumulated}],"+":[Oe,Pi(Oe),function(e,t){for(var i=0,r=0,n=t;r<n.length;r+=1)i+=n[r].evaluate(e);return i}],"*":[Oe,Pi(Oe),function(e,t){for(var i=1,r=0,n=t;r<n.length;r+=1)i*=n[r].evaluate(e);return i}],"-":{type:Oe,overloads:[[[Oe,Oe],function(e,t){var i=t[1];return t[0].evaluate(e)-i.evaluate(e)}],[[Oe],function(e,t){return-t[0].evaluate(e)}]]},"/":[Oe,[Oe,Oe],function(e,t){var i=t[1];return t[0].evaluate(e)/i.evaluate(e)}],"%":[Oe,[Oe,Oe],function(e,t){var i=t[1];return t[0].evaluate(e)%i.evaluate(e)}],ln2:[Oe,[],function(){return Math.LN2}],pi:[Oe,[],function(){return Math.PI}],e:[Oe,[],function(){return Math.E}],"^":[Oe,[Oe,Oe],function(e,t){var i=t[1];return Math.pow(t[0].evaluate(e),i.evaluate(e))}],sqrt:[Oe,[Oe],function(e,t){return Math.sqrt(t[0].evaluate(e))}],log10:[Oe,[Oe],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN10}],ln:[Oe,[Oe],function(e,t){return Math.log(t[0].evaluate(e))}],log2:[Oe,[Oe],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN2}],sin:[Oe,[Oe],function(e,t){return Math.sin(t[0].evaluate(e))}],cos:[Oe,[Oe],function(e,t){return Math.cos(t[0].evaluate(e))}],tan:[Oe,[Oe],function(e,t){return Math.tan(t[0].evaluate(e))}],asin:[Oe,[Oe],function(e,t){return Math.asin(t[0].evaluate(e))}],acos:[Oe,[Oe],function(e,t){return Math.acos(t[0].evaluate(e))}],atan:[Oe,[Oe],function(e,t){return Math.atan(t[0].evaluate(e))}],min:[Oe,Pi(Oe),function(e,t){return Math.min.apply(Math,t.map((function(t){return t.evaluate(e)})))}],max:[Oe,Pi(Oe),function(e,t){return Math.max.apply(Math,t.map((function(t){return t.evaluate(e)})))}],abs:[Oe,[Oe],function(e,t){return Math.abs(t[0].evaluate(e))}],round:[Oe,[Oe],function(e,t){var i=t[0].evaluate(e);return i<0?-Math.round(-i):Math.round(i)}],floor:[Oe,[Oe],function(e,t){return Math.floor(t[0].evaluate(e))}],ceil:[Oe,[Oe],function(e,t){return Math.ceil(t[0].evaluate(e))}],"filter-==":[Ve,[Ne,je],function(e,t){var i=t[0],r=t[1];return e.properties()[i.value]===r.value}],"filter-id-==":[Ve,[je],function(e,t){var i=t[0];return e.id()===i.value}],"filter-type-==":[Ve,[Ne],function(e,t){var i=t[0];return e.geometryType()===i.value}],"filter-<":[Ve,[Ne,je],function(e,t){var i=t[0],r=t[1],n=e.properties()[i.value],a=r.value;return typeof n==typeof a&&n<a}],"filter-id-<":[Ve,[je],function(e,t){var i=t[0],r=e.id(),n=i.value;return typeof r==typeof n&&r<n}],"filter->":[Ve,[Ne,je],function(e,t){var i=t[0],r=t[1],n=e.properties()[i.value],a=r.value;return typeof n==typeof a&&n>a}],"filter-id->":[Ve,[je],function(e,t){var i=t[0],r=e.id(),n=i.value;return typeof r==typeof n&&r>n}],"filter-<=":[Ve,[Ne,je],function(e,t){var i=t[0],r=t[1],n=e.properties()[i.value],a=r.value;return typeof n==typeof a&&n<=a}],"filter-id-<=":[Ve,[je],function(e,t){var i=t[0],r=e.id(),n=i.value;return typeof r==typeof n&&r<=n}],"filter->=":[Ve,[Ne,je],function(e,t){var i=t[0],r=t[1],n=e.properties()[i.value],a=r.value;return typeof n==typeof a&&n>=a}],"filter-id->=":[Ve,[je],function(e,t){var i=t[0],r=e.id(),n=i.value;return typeof r==typeof n&&r>=n}],"filter-has":[Ve,[je],function(e,t){return t[0].value in e.properties()}],"filter-has-id":[Ve,[],function(e){return null!==e.id()&&void 0!==e.id()}],"filter-type-in":[Ve,[We(Ne)],function(e,t){return t[0].value.indexOf(e.geometryType())>=0}],"filter-id-in":[Ve,[We(je)],function(e,t){return t[0].value.indexOf(e.id())>=0}],"filter-in-small":[Ve,[Ne,We(je)],function(e,t){var i=t[0];return t[1].value.indexOf(e.properties()[i.value])>=0}],"filter-in-large":[Ve,[Ne,We(je)],function(e,t){var i=t[0],r=t[1];return function(e,t,i,r){for(;i<=r;){var n=i+r>>1;if(t[n]===e)return!0;t[n]>e?r=n-1:i=n+1}return!1}(e.properties()[i.value],r.value,0,r.value.length-1)}],all:{type:Ve,overloads:[[[Ve,Ve],function(e,t){var i=t[1];return t[0].evaluate(e)&&i.evaluate(e)}],[Pi(Ve),function(e,t){for(var i=0,r=t;i<r.length;i+=1)if(!r[i].evaluate(e))return!1;return!0}]]},any:{type:Ve,overloads:[[[Ve,Ve],function(e,t){var i=t[1];return t[0].evaluate(e)||i.evaluate(e)}],[Pi(Ve),function(e,t){for(var i=0,r=t;i<r.length;i+=1)if(r[i].evaluate(e))return!0;return!1}]]},"!":[Ve,[Ve],function(e,t){return!t[0].evaluate(e)}],"is-supported-script":[Ve,[Ne],function(e,t){var i=e.globals&&e.globals.isSupportedScript;return!i||i(t[0].evaluate(e))}],upcase:[Ne,[Ne],function(e,t){return t[0].evaluate(e).toUpperCase()}],downcase:[Ne,[Ne],function(e,t){return t[0].evaluate(e).toLowerCase()}],concat:[Ne,Pi(je),function(e,t){return t.map((function(t){return lt(t.evaluate(e))})).join("")}],"resolved-locale":[Ne,[qe],function(e,t){return t[0].evaluate(e).resolvedLocale()}]});var qi=function(e,t){this.expression=e,this._warningHistory={},this._evaluator=new yt,this._defaultValue=t?function(e){return"color"===e.type&&Fi(e.default)?new et(0,0,0,0):"color"===e.type?et.parse(e.default)||null:void 0===e.default?null:e.default}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null};function Gi(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in Ei}function Hi(e,t){var i=new Ut(Ei,[],t?function(e){var t={color:Ue,string:Ne,number:Oe,enum:Ne,boolean:Ve,formatted:Ge,resolvedImage:He};return"array"===e.type?We(t[e.value]||je,e.length):t[e.type]}(t):void 0),r=i.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return r?zi(new qi(r,t)):Ri(i.errors)}qi.prototype.evaluateWithoutErrorHandling=function(e,t,i,r,n,a){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=i,this._evaluator.canonical=r,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=a,this.expression.evaluate(this._evaluator)},qi.prototype.evaluate=function(e,t,i,r,n,a){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=i||null,this._evaluator.canonical=r,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=a||null;try{var o=this.expression.evaluate(this._evaluator);if(null==o||"number"==typeof o&&o!=o)return this._defaultValue;if(this._enumValues&&!(o in this._enumValues))throw new ut("Expected value to be one of "+Object.keys(this._enumValues).map((function(e){return JSON.stringify(e)})).join(", ")+", but found "+JSON.stringify(o)+" instead.");return o}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}};var Wi=function(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!Ot(t.expression)};Wi.prototype.evaluateWithoutErrorHandling=function(e,t,i,r,n,a){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,r,n,a)},Wi.prototype.evaluate=function(e,t,i,r,n,a){return this._styleExpression.evaluate(e,t,i,r,n,a)};var Zi=function(e,t,i,r){this.kind=e,this.zoomStops=i,this._styleExpression=t,this.isStateDependent="camera"!==e&&!Ot(t.expression),this.interpolationType=r};function Xi(e,t){if("error"===(e=Hi(e,t)).result)return e;var i=e.value.expression,r=Ft(i);if(!r&&!ki(t))return Ri([new De("","data expressions not supported")]);var n=Nt(i,["zoom"]);if(!n&&!Li(t))return Ri([new De("","zoom expressions not supported")]);var a=function e(t){var i=null;if(t instanceof li)i=e(t.result);else if(t instanceof si)for(var r=0,n=t.args;r<n.length&&!(i=e(n[r]));r+=1);else(t instanceof jt||t instanceof ai)&&t.input instanceof vt&&"zoom"===t.input.name&&(i=t);return i instanceof De||t.eachChild((function(t){var r=e(t);r instanceof De?i=r:!i&&r?i=new De("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&r&&i!==r&&(i=new De("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),i}(i);return a||n?a instanceof De?Ri([a]):a instanceof ai&&!Di(t)?Ri([new De("",'"interpolate" expressions cannot be used with this property')]):zi(a?new Zi(r?"camera":"composite",e.value,a.labels,a instanceof ai?a.interpolation:void 0):new Wi(r?"constant":"source",e.value)):Ri([new De("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Zi.prototype.evaluateWithoutErrorHandling=function(e,t,i,r,n,a){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,r,n,a)},Zi.prototype.evaluate=function(e,t,i,r,n,a){return this._styleExpression.evaluate(e,t,i,r,n,a)},Zi.prototype.interpolationFactor=function(e,t,i){return this.interpolationType?ai.interpolationFactor(this.interpolationType,e,t,i):0};var Yi=function(e,t){this._parameters=e,this._specification=t,Re(this,function e(t,i){var r,n,a,o="color"===i.type,s=t.stops&&"object"==typeof t.stops[0][0],l=s||!(s||void 0!==t.property),c=t.type||(Di(i)?"exponential":"interval");if(o&&((t=Re({},t)).stops&&(t.stops=t.stops.map((function(e){return[e[0],et.parse(e[1])]}))),t.default=et.parse(t.default?t.default:i.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!ni[t.colorSpace])throw new Error("Unknown color space: "+t.colorSpace);if("exponential"===c)r=$i;else if("interval"===c)r=Ui;else if("categorical"===c){r=Vi,n=Object.create(null);for(var u=0,h=t.stops;u<h.length;u+=1){var p=h[u];n[p[0]]=p[1]}a=typeof t.stops[0][0]}else{if("identity"!==c)throw new Error('Unknown function type "'+c+'"');r=ji}if(s){for(var d={},f=[],m=0;m<t.stops.length;m++){var g=t.stops[m],_=g[0].zoom;void 0===d[_]&&(d[_]={zoom:_,type:t.type,property:t.property,default:t.default,stops:[]},f.push(_)),d[_].stops.push([g[0].value,g[1]])}for(var y=[],v=0,x=f;v<x.length;v+=1){var b=x[v];y.push([d[b].zoom,e(d[b],i)])}var w={name:"linear"};return{kind:"composite",interpolationType:w,interpolationFactor:ai.interpolationFactor.bind(void 0,w),zoomStops:y.map((function(e){return e[0]})),evaluate:function(e,r){var n=e.zoom;return $i({stops:y,base:t.base},i,n).evaluate(n,r)}}}if(l){var S="exponential"===c?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:ai.interpolationFactor.bind(void 0,S),zoomStops:t.stops.map((function(e){return e[0]})),evaluate:function(e){return r(t,i,e.zoom,n,a)}}}return{kind:"source",evaluate:function(e,o){var s=o&&o.properties?o.properties[t.property]:void 0;return void 0===s?Ni(t.default,i.default):r(t,i,s,n,a)}}}(this._parameters,this._specification))};function Ki(e){var t=e.key,i=e.value,r=e.valueSpec||{},n=e.objectElementValidators||{},a=e.style,o=e.styleSpec,s=[],l=Bi(i);if("object"!==l)return[new Pe(t,i,"object expected, "+l+" found")];for(var c in i){var u=c.split(".")[0],h=r[u]||r["*"],p=void 0;if(n[u])p=n[u];else if(r[u])p=wr;else if(n["*"])p=n["*"];else{if(!r["*"]){s.push(new Pe(t,i[c],'unknown property "'+c+'"'));continue}p=wr}s=s.concat(p({key:(t?t+".":t)+c,value:i[c],valueSpec:h,style:a,styleSpec:o,object:i,objectKey:c},i))}for(var d in r)n[d]||r[d].required&&void 0===r[d].default&&void 0===i[d]&&s.push(new Pe(t,i,'missing required property "'+d+'"'));return s}function Ji(e){var t=e.value,i=e.valueSpec,r=e.style,n=e.styleSpec,a=e.key,o=e.arrayElementValidator||wr;if("array"!==Bi(t))return[new Pe(a,t,"array expected, "+Bi(t)+" found")];if(i.length&&t.length!==i.length)return[new Pe(a,t,"array length "+i.length+" expected, length "+t.length+" found")];if(i["min-length"]&&t.length<i["min-length"])return[new Pe(a,t,"array length at least "+i["min-length"]+" expected, length "+t.length+" found")];var s={type:i.value,values:i.values};n.$version<7&&(s.function=i.function),"object"===Bi(i.value)&&(s=i.value);for(var l=[],c=0;c<t.length;c++)l=l.concat(o({array:t,arrayIndex:c,value:t[c],valueSpec:s,style:r,styleSpec:n,key:a+"["+c+"]"}));return l}function Qi(e){var t=e.key,i=e.value,r=e.valueSpec,n=Bi(i);return"number"===n&&i!=i&&(n="NaN"),"number"!==n?[new Pe(t,i,"number expected, "+n+" found")]:"minimum"in r&&i<r.minimum?[new Pe(t,i,i+" is less than the minimum value "+r.minimum)]:"maximum"in r&&i>r.maximum?[new Pe(t,i,i+" is greater than the maximum value "+r.maximum)]:[]}function er(e){var t,i,r,n=e.valueSpec,a=ke(e.value.type),o={},s="categorical"!==a&&void 0===e.value.property,l=!s,c="array"===Bi(e.value.stops)&&"array"===Bi(e.value.stops[0])&&"object"===Bi(e.value.stops[0][0]),u=Ki({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===a)return[new Pe(e.key,e.value,'identity function may not have a "stops" property')];var t=[],i=e.value;return t=t.concat(Ji({key:e.key,value:i,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:h})),"array"===Bi(i)&&0===i.length&&t.push(new Pe(e.key,i,"array must have at least one stop")),t},default:function(e){return wr({key:e.key,value:e.value,valueSpec:n,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===a&&s&&u.push(new Pe(e.key,e.value,'missing required property "property"')),"identity"===a||e.value.stops||u.push(new Pe(e.key,e.value,'missing required property "stops"')),"exponential"===a&&e.valueSpec.expression&&!Di(e.valueSpec)&&u.push(new Pe(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(l&&!ki(e.valueSpec)?u.push(new Pe(e.key,e.value,"property functions not supported")):s&&!Li(e.valueSpec)&&u.push(new Pe(e.key,e.value,"zoom functions not supported"))),"categorical"!==a&&!c||void 0!==e.value.property||u.push(new Pe(e.key,e.value,'"property" property is required')),u;function h(e){var t=[],a=e.value,s=e.key;if("array"!==Bi(a))return[new Pe(s,a,"array expected, "+Bi(a)+" found")];if(2!==a.length)return[new Pe(s,a,"array length 2 expected, length "+a.length+" found")];if(c){if("object"!==Bi(a[0]))return[new Pe(s,a,"object expected, "+Bi(a[0])+" found")];if(void 0===a[0].zoom)return[new Pe(s,a,"object stop key must have zoom")];if(void 0===a[0].value)return[new Pe(s,a,"object stop key must have value")];if(r&&r>ke(a[0].zoom))return[new Pe(s,a[0].zoom,"stop zoom values must appear in ascending order")];ke(a[0].zoom)!==r&&(r=ke(a[0].zoom),i=void 0,o={}),t=t.concat(Ki({key:s+"[0]",value:a[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:Qi,value:p}}))}else t=t.concat(p({key:s+"[0]",value:a[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec},a));return Gi(Le(a[1]))?t.concat([new Pe(s+"[1]",a[1],"expressions are not allowed in function stops.")]):t.concat(wr({key:s+"[1]",value:a[1],valueSpec:n,style:e.style,styleSpec:e.styleSpec}))}function p(e,r){var s=Bi(e.value),l=ke(e.value),c=null!==e.value?e.value:r;if(t){if(s!==t)return[new Pe(e.key,c,s+" stop domain type must match previous stop domain type "+t)]}else t=s;if("number"!==s&&"string"!==s&&"boolean"!==s)return[new Pe(e.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==a){var u="number expected, "+s+" found";return ki(n)&&void 0===a&&(u+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Pe(e.key,c,u)]}return"categorical"!==a||"number"!==s||isFinite(l)&&Math.floor(l)===l?"categorical"!==a&&"number"===s&&void 0!==i&&l<i?[new Pe(e.key,c,"stop domain values must appear in ascending order")]:(i=l,"categorical"===a&&l in o?[new Pe(e.key,c,"stop domain values must be unique")]:(o[l]=!0,[])):[new Pe(e.key,c,"integer expected, found "+l)]}}function tr(e){var t=("property"===e.expressionContext?Xi:Hi)(Le(e.value),e.valueSpec);if("error"===t.result)return t.value.map((function(t){return new Pe(""+e.key+t.key,e.value,t.message)}));var i=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!i.outputDefined())return[new Pe(e.key,e.value,'Invalid data expression for "'+e.propertyKey+'". Output values must be contained as literals within the expression.')];if("property"===e.expressionContext&&"layout"===e.propertyType&&!Ot(i))return[new Pe(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext&&!Ot(i))return[new Pe(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!Nt(i,["zoom","feature-state"]))return[new Pe(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!Ft(i))return[new Pe(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ir(e){var t=e.key,i=e.value,r=e.valueSpec,n=[];return Array.isArray(r.values)?-1===r.values.indexOf(ke(i))&&n.push(new Pe(t,i,"expected one of ["+r.values.join(", ")+"], "+JSON.stringify(i)+" found")):-1===Object.keys(r.values).indexOf(ke(i))&&n.push(new Pe(t,i,"expected one of ["+Object.keys(r.values).join(", ")+"], "+JSON.stringify(i)+" found")),n}function rr(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(var t=0,i=e.slice(1);t<i.length;t+=1){var r=i[t];if(!rr(r)&&"boolean"!=typeof r)return!1}return!0;default:return!0}}Yi.deserialize=function(e){return new Yi(e._parameters,e._specification)},Yi.serialize=function(e){return{_parameters:e._parameters,_specification:e._specification}};var nr={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ar(e){if(null==e)return{filter:function(){return!0},needGeometry:!1};rr(e)||(e=sr(e));var t=Hi(e,nr);if("error"===t.result)throw new Error(t.value.map((function(e){return e.key+": "+e.message})).join(", "));return{filter:function(e,i,r){return t.value.evaluate(e,i,{},r)},needGeometry:function e(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(var i=1;i<t.length;i++)if(e(t[i]))return!0;return!1}(e)}}function or(e,t){return e<t?-1:e>t?1:0}function sr(e){if(!e)return!0;var t,i=e[0];return e.length<=1?"any"!==i:"=="===i?lr(e[1],e[2],"=="):"!="===i?hr(lr(e[1],e[2],"==")):"<"===i||">"===i||"<="===i||">="===i?lr(e[1],e[2],i):"any"===i?(t=e.slice(1),["any"].concat(t.map(sr))):"all"===i?["all"].concat(e.slice(1).map(sr)):"none"===i?["all"].concat(e.slice(1).map(sr).map(hr)):"in"===i?cr(e[1],e.slice(2)):"!in"===i?hr(cr(e[1],e.slice(2))):"has"===i?ur(e[1]):"!has"===i?hr(ur(e[1])):"within"!==i||e}function lr(e,t,i){switch(e){case"$type":return["filter-type-"+i,t];case"$id":return["filter-id-"+i,t];default:return["filter-"+i,e,t]}}function cr(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((function(e){return typeof e!=typeof t[0]}))?["filter-in-large",e,["literal",t.sort(or)]]:["filter-in-small",e,["literal",t]]}}function ur(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function hr(e){return["!",e]}function pr(e){return rr(Le(e.value))?tr(Re({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function e(t){var i=t.value,r=t.key;if("array"!==Bi(i))return[new Pe(r,i,"array expected, "+Bi(i)+" found")];var n,a=t.styleSpec,o=[];if(i.length<1)return[new Pe(r,i,"filter array must have at least 1 element")];switch(o=o.concat(ir({key:r+"[0]",value:i[0],valueSpec:a.filter_operator,style:t.style,styleSpec:t.styleSpec})),ke(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&"$type"===ke(i[1])&&o.push(new Pe(r,i,'"$type" cannot be use with operator "'+i[0]+'"'));case"==":case"!=":3!==i.length&&o.push(new Pe(r,i,'filter array for operator "'+i[0]+'" must have 3 elements'));case"in":case"!in":i.length>=2&&"string"!==(n=Bi(i[1]))&&o.push(new Pe(r+"[1]",i[1],"string expected, "+n+" found"));for(var s=2;s<i.length;s++)n=Bi(i[s]),"$type"===ke(i[1])?o=o.concat(ir({key:r+"["+s+"]",value:i[s],valueSpec:a.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==n&&"number"!==n&&"boolean"!==n&&o.push(new Pe(r+"["+s+"]",i[s],"string, number, or boolean expected, "+n+" found"));break;case"any":case"all":case"none":for(var l=1;l<i.length;l++)o=o.concat(e({key:r+"["+l+"]",value:i[l],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":n=Bi(i[1]),2!==i.length?o.push(new Pe(r,i,'filter array for "'+i[0]+'" operator must have 2 elements')):"string"!==n&&o.push(new Pe(r+"[1]",i[1],"string expected, "+n+" found"));break;case"within":n=Bi(i[1]),2!==i.length?o.push(new Pe(r,i,'filter array for "'+i[0]+'" operator must have 2 elements')):"object"!==n&&o.push(new Pe(r+"[1]",i[1],"object expected, "+n+" found"))}return o}(e)}function dr(e,t){var i=e.key,r=e.style,n=e.styleSpec,a=e.value,o=e.objectKey,s=n[t+"_"+e.layerType];if(!s)return[];var l=o.match(/^(.*)-transition$/);if("paint"===t&&l&&s[l[1]]&&s[l[1]].transition)return wr({key:i,value:a,valueSpec:n.transition,style:r,styleSpec:n});var c,u=e.valueSpec||s[o];if(!u)return[new Pe(i,a,'unknown property "'+o+'"')];if("string"===Bi(a)&&ki(u)&&!u.tokens&&(c=/^{([^}]+)}$/.exec(a)))return[new Pe(i,a,'"'+o+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(c[1])+" }`.")];var h=[];return"symbol"===e.layerType&&("text-field"===o&&r&&!r.glyphs&&h.push(new Pe(i,a,'use of "text-field" requires a style "glyphs" property')),"text-font"===o&&Fi(Le(a))&&"identity"===ke(a.type)&&h.push(new Pe(i,a,'"text-font" does not support identity functions'))),h.concat(wr({key:e.key,value:a,valueSpec:u,style:r,styleSpec:n,expressionContext:"property",propertyType:t,propertyKey:o}))}function fr(e){return dr(e,"paint")}function mr(e){return dr(e,"layout")}function gr(e){var t=[],i=e.value,r=e.key,n=e.style,a=e.styleSpec;i.type||i.ref||t.push(new Pe(r,i,'either "type" or "ref" is required'));var o,s=ke(i.type),l=ke(i.ref);if(i.id)for(var c=ke(i.id),u=0;u<e.arrayIndex;u++){var h=n.layers[u];ke(h.id)===c&&t.push(new Pe(r,i.id,'duplicate layer id "'+i.id+'", previously used at line '+h.id.__line__))}if("ref"in i)["type","source","source-layer","filter","layout"].forEach((function(e){e in i&&t.push(new Pe(r,i[e],'"'+e+'" is prohibited for ref layers'))})),n.layers.forEach((function(e){ke(e.id)===l&&(o=e)})),o?o.ref?t.push(new Pe(r,i.ref,"ref cannot reference another ref layer")):s=ke(o.type):t.push(new Pe(r,i.ref,'ref layer "'+l+'" not found'));else if("background"!==s)if(i.source){var p=n.sources&&n.sources[i.source],d=p&&ke(p.type);p?"vector"===d&&"raster"===s?t.push(new Pe(r,i.source,'layer "'+i.id+'" requires a raster source')):"raster"===d&&"raster"!==s?t.push(new Pe(r,i.source,'layer "'+i.id+'" requires a vector source')):"vector"!==d||i["source-layer"]?"raster-dem"===d&&"hillshade"!==s?t.push(new Pe(r,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!i.paint||!i.paint["line-gradient"]||"geojson"===d&&p.lineMetrics||t.push(new Pe(r,i,'layer "'+i.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):t.push(new Pe(r,i,'layer "'+i.id+'" must specify a "source-layer"')):t.push(new Pe(r,i.source,'source "'+i.source+'" not found'))}else t.push(new Pe(r,i,'missing required property "source"'));return t=t.concat(Ki({key:r,value:i,valueSpec:a.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return wr({key:r+".type",value:i.type,valueSpec:a.layer.type,style:e.style,styleSpec:e.styleSpec,object:i,objectKey:"type"})},filter:pr,layout:function(e){return Ki({layer:i,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(e){return mr(Re({layerType:s},e))}}})},paint:function(e){return Ki({layer:i,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(e){return fr(Re({layerType:s},e))}}})}}}))}function _r(e){var t=e.value,i=e.key,r=Bi(t);return"string"!==r?[new Pe(i,t,"string expected, "+r+" found")]:[]}var yr={promoteId:function(e){var t=e.key,i=e.value;if("string"===Bi(i))return _r({key:t,value:i});var r=[];for(var n in i)r.push.apply(r,_r({key:t+"."+n,value:i[n]}));return r}};function vr(e){var t=e.value,i=e.key,r=e.styleSpec,n=e.style;if(!t.type)return[new Pe(i,t,'"type" is required')];var a,o=ke(t.type);switch(o){case"vector":case"raster":case"raster-dem":return Ki({key:i,value:t,valueSpec:r["source_"+o.replace("-","_")],style:e.style,styleSpec:r,objectElementValidators:yr});case"geojson":if(a=Ki({key:i,value:t,valueSpec:r.source_geojson,style:n,styleSpec:r,objectElementValidators:yr}),t.cluster)for(var s in t.clusterProperties){var l=t.clusterProperties[s],c=l[0],u="string"==typeof c?[c,["accumulated"],["get",s]]:c;a.push.apply(a,tr({key:i+"."+s+".map",value:l[1],expressionContext:"cluster-map"})),a.push.apply(a,tr({key:i+"."+s+".reduce",value:u,expressionContext:"cluster-reduce"}))}return a;case"video":return Ki({key:i,value:t,valueSpec:r.source_video,style:n,styleSpec:r});case"image":return Ki({key:i,value:t,valueSpec:r.source_image,style:n,styleSpec:r});case"canvas":return[new Pe(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ir({key:i+".type",value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:n,styleSpec:r})}}function xr(e){var t=e.value,i=e.styleSpec,r=i.light,n=e.style,a=[],o=Bi(t);if(void 0===t)return a;if("object"!==o)return a.concat([new Pe("light",t,"object expected, "+o+" found")]);for(var s in t){var l=s.match(/^(.*)-transition$/);a=a.concat(l&&r[l[1]]&&r[l[1]].transition?wr({key:s,value:t[s],valueSpec:i.transition,style:n,styleSpec:i}):r[s]?wr({key:s,value:t[s],valueSpec:r[s],style:n,styleSpec:i}):[new Pe(s,t[s],'unknown property "'+s+'"')])}return a}var br={"*":function(){return[]},array:Ji,boolean:function(e){var t=e.value,i=e.key,r=Bi(t);return"boolean"!==r?[new Pe(i,t,"boolean expected, "+r+" found")]:[]},number:Qi,color:function(e){var t=e.key,i=e.value,r=Bi(i);return"string"!==r?[new Pe(t,i,"color expected, "+r+" found")]:null===Qe(i)?[new Pe(t,i,'color expected, "'+i+'" found')]:[]},constants:ze,enum:ir,filter:pr,function:er,layer:gr,object:Ki,source:vr,light:xr,string:_r,formatted:function(e){return 0===_r(e).length?[]:tr(e)},resolvedImage:function(e){return 0===_r(e).length?[]:tr(e)}};function wr(e){var t=e.value,i=e.valueSpec,r=e.styleSpec;return i.expression&&Fi(ke(t))?er(e):i.expression&&Gi(Le(t))?tr(e):i.type&&br[i.type]?br[i.type](e):Ki(Re({},e,{valueSpec:i.type?r[i.type]:i}))}function Sr(e){var t=e.value,i=e.key,r=_r(e);return r.length||(-1===t.indexOf("{fontstack}")&&r.push(new Pe(i,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&r.push(new Pe(i,t,'"glyphs" url must include a "{range}" token'))),r}function Mr(e,t){void 0===t&&(t=Ie);var i=[];return i=i.concat(wr({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:Sr,"*":function(){return[]}}})),e.constants&&(i=i.concat(ze({key:"constants",value:e.constants,style:e,styleSpec:t}))),Tr(i)}function Tr(e){return[].concat(e).sort((function(e,t){return e.line-t.line}))}function Er(e){return function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return Tr(e.apply(this,t))}}Mr.source=Er(vr),Mr.light=Er(xr),Mr.layer=Er(gr),Mr.filter=Er(pr),Mr.paintProperty=Er(fr),Mr.layoutProperty=Er(mr);var Cr=Mr,Ar=Cr.light,Ir=Cr.paintProperty,Pr=Cr.layoutProperty;function zr(e,t){var i=!1;if(t&&t.length)for(var r=0,n=t;r<n.length;r+=1)e.fire(new Ce(new Error(n[r].message))),i=!0;return i}var Rr=kr;function kr(e,t,i){var r=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var n=new Int32Array(this.arrayBuffer);e=n[0],this.d=(t=n[1])+2*(i=n[2]);for(var a=0;a<this.d*this.d;a++){var o=n[3+a],s=n[3+a+1];r.push(o===s?null:n.subarray(o,s))}var l=n[3+r.length+1];this.keys=n.subarray(n[3+r.length],l),this.bboxes=n.subarray(l),this.insert=this._insertReadonly}else{this.d=t+2*i;for(var c=0;c<this.d*this.d;c++)r.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=i,this.scale=t/e,this.uid=0;var u=i/t*e;this.min=-u,this.max=e+u}kr.prototype.insert=function(e,t,i,r,n){this._forEachCell(t,i,r,n,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)},kr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},kr.prototype._insertCell=function(e,t,i,r,n,a){this.cells[n].push(a)},kr.prototype.query=function(e,t,i,r,n){var a=this.min,o=this.max;if(e<=a&&t<=a&&o<=i&&o<=r&&!n)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(e,t,i,r,this._queryCell,s,{},n),s},kr.prototype._queryCell=function(e,t,i,r,n,a,o,s){var l=this.cells[n];if(null!==l)for(var c=this.keys,u=this.bboxes,h=0;h<l.length;h++){var p=l[h];if(void 0===o[p]){var d=4*p;(s?s(u[d+0],u[d+1],u[d+2],u[d+3]):e<=u[d+2]&&t<=u[d+3]&&i>=u[d+0]&&r>=u[d+1])?(o[p]=!0,a.push(c[p])):o[p]=!1}}},kr.prototype._forEachCell=function(e,t,i,r,n,a,o,s){for(var l=this._convertToCellCoord(e),c=this._convertToCellCoord(t),u=this._convertToCellCoord(i),h=this._convertToCellCoord(r),p=l;p<=u;p++)for(var d=c;d<=h;d++){var f=this.d*d+p;if((!s||s(this._convertFromCellCoord(p),this._convertFromCellCoord(d),this._convertFromCellCoord(p+1),this._convertFromCellCoord(d+1)))&&n.call(this,e,t,i,r,f,a,o,s))return}},kr.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},kr.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},kr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,i=0,r=0;r<this.cells.length;r++)i+=this.cells[r].length;var n=new Int32Array(t+i+this.keys.length+this.bboxes.length);n[0]=this.extent,n[1]=this.n,n[2]=this.padding;for(var a=t,o=0;o<e.length;o++){var s=e[o];n[3+o]=a,n.set(s,a),a+=s.length}return n[3+e.length]=a,n.set(this.keys,a),n[3+e.length+1]=a+=this.keys.length,n.set(this.bboxes,a),a+=this.bboxes.length,n.buffer};var Lr=o.ImageData,Dr=o.ImageBitmap,Br={};function Fr(e,t,i){void 0===i&&(i={}),Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Br[e]={klass:t,omit:i.omit||[],shallow:i.shallow||[]}}for(var Or in Fr("Object",Object),Rr.serialize=function(e,t){var i=e.toArrayBuffer();return t&&t.push(i),{buffer:i}},Rr.deserialize=function(e){return new Rr(e.buffer)},Fr("Grid",Rr),Fr("Color",et),Fr("Error",Error),Fr("ResolvedImage",nt),Fr("StylePropertyFunction",Yi),Fr("StyleExpression",qi,{omit:["_evaluator"]}),Fr("ZoomDependentExpression",Zi),Fr("ZoomConstantExpression",Wi),Fr("CompoundExpression",vt,{omit:["_evaluate"]}),Ei)Ei[Or]._classRegistryKey||Fr("Expression_"+Or,Ei[Or]);function Nr(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function Vr(e){return Dr&&e instanceof Dr}function Ur(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(Nr(e)||Vr(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){var i=e;return t&&t.push(i.buffer),i}if(e instanceof Lr)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){for(var r=[],n=0,a=e;n<a.length;n+=1)r.push(Ur(a[n],t));return r}if("object"==typeof e){var o=e.constructor,s=o._classRegistryKey;if(!s)throw new Error("can't serialize object of unregistered class");var l=o.serialize?o.serialize(e,t):{};if(!o.serialize){for(var c in e)if(e.hasOwnProperty(c)&&!(Br[s].omit.indexOf(c)>=0)){var u=e[c];l[c]=Br[s].shallow.indexOf(c)>=0?u:Ur(u,t)}e instanceof Error&&(l.message=e.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(l.$name=s),l}throw new Error("can't serialize object of type "+typeof e)}function $r(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||Nr(e)||Vr(e)||ArrayBuffer.isView(e)||e instanceof Lr)return e;if(Array.isArray(e))return e.map($r);if("object"==typeof e){var t=e.$name||"Object",i=Br[t].klass;if(!i)throw new Error("can't deserialize unregistered class "+t);if(i.deserialize)return i.deserialize(e);for(var r=Object.create(i.prototype),n=0,a=Object.keys(e);n<a.length;n+=1){var o=a[n];if("$name"!==o){var s=e[o];r[o]=Br[t].shallow.indexOf(o)>=0?s:$r(s)}}return r}throw new Error("can't deserialize object of type "+typeof e)}var jr=function(){this.first=!0};jr.prototype.update=function(e,t){var i=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=i,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=i,!0):(this.lastFloorZoom>i?(this.lastIntegerZoom=i+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<i&&(this.lastIntegerZoom=i,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=i,!0))};var qr={"Latin-1 Supplement":function(e){return e>=128&&e<=255},Arabic:function(e){return e>=1536&&e<=1791},"Arabic Supplement":function(e){return e>=1872&&e<=1919},"Arabic Extended-A":function(e){return e>=2208&&e<=2303},"Hangul Jamo":function(e){return e>=4352&&e<=4607},"Unified Canadian Aboriginal Syllabics":function(e){return e>=5120&&e<=5759},Khmer:function(e){return e>=6016&&e<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(e){return e>=6320&&e<=6399},"General Punctuation":function(e){return e>=8192&&e<=8303},"Letterlike Symbols":function(e){return e>=8448&&e<=8527},"Number Forms":function(e){return e>=8528&&e<=8591},"Miscellaneous Technical":function(e){return e>=8960&&e<=9215},"Control Pictures":function(e){return e>=9216&&e<=9279},"Optical Character Recognition":function(e){return e>=9280&&e<=9311},"Enclosed Alphanumerics":function(e){return e>=9312&&e<=9471},"Geometric Shapes":function(e){return e>=9632&&e<=9727},"Miscellaneous Symbols":function(e){return e>=9728&&e<=9983},"Miscellaneous Symbols and Arrows":function(e){return e>=11008&&e<=11263},"CJK Radicals Supplement":function(e){return e>=11904&&e<=12031},"Kangxi Radicals":function(e){return e>=12032&&e<=12255},"Ideographic Description Characters":function(e){return e>=12272&&e<=12287},"CJK Symbols and Punctuation":function(e){return e>=12288&&e<=12351},Hiragana:function(e){return e>=12352&&e<=12447},Katakana:function(e){return e>=12448&&e<=12543},Bopomofo:function(e){return e>=12544&&e<=12591},"Hangul Compatibility Jamo":function(e){return e>=12592&&e<=12687},Kanbun:function(e){return e>=12688&&e<=12703},"Bopomofo Extended":function(e){return e>=12704&&e<=12735},"CJK Strokes":function(e){return e>=12736&&e<=12783},"Katakana Phonetic Extensions":function(e){return e>=12784&&e<=12799},"Enclosed CJK Letters and Months":function(e){return e>=12800&&e<=13055},"CJK Compatibility":function(e){return e>=13056&&e<=13311},"CJK Unified Ideographs Extension A":function(e){return e>=13312&&e<=19903},"Yijing Hexagram Symbols":function(e){return e>=19904&&e<=19967},"CJK Unified Ideographs":function(e){return e>=19968&&e<=40959},"Yi Syllables":function(e){return e>=40960&&e<=42127},"Yi Radicals":function(e){return e>=42128&&e<=42191},"Hangul Jamo Extended-A":function(e){return e>=43360&&e<=43391},"Hangul Syllables":function(e){return e>=44032&&e<=55215},"Hangul Jamo Extended-B":function(e){return e>=55216&&e<=55295},"Private Use Area":function(e){return e>=57344&&e<=63743},"CJK Compatibility Ideographs":function(e){return e>=63744&&e<=64255},"Arabic Presentation Forms-A":function(e){return e>=64336&&e<=65023},"Vertical Forms":function(e){return e>=65040&&e<=65055},"CJK Compatibility Forms":function(e){return e>=65072&&e<=65103},"Small Form Variants":function(e){return e>=65104&&e<=65135},"Arabic Presentation Forms-B":function(e){return e>=65136&&e<=65279},"Halfwidth and Fullwidth Forms":function(e){return e>=65280&&e<=65519}};function Gr(e){for(var t=0,i=e;t<i.length;t+=1)if(Hr(i[t].charCodeAt(0)))return!0;return!1}function Hr(e){return!(746!==e&&747!==e&&(e<4352||!(qr["Bopomofo Extended"](e)||qr.Bopomofo(e)||qr["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||qr["CJK Compatibility Ideographs"](e)||qr["CJK Compatibility"](e)||qr["CJK Radicals Supplement"](e)||qr["CJK Strokes"](e)||!(!qr["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||qr["CJK Unified Ideographs Extension A"](e)||qr["CJK Unified Ideographs"](e)||qr["Enclosed CJK Letters and Months"](e)||qr["Hangul Compatibility Jamo"](e)||qr["Hangul Jamo Extended-A"](e)||qr["Hangul Jamo Extended-B"](e)||qr["Hangul Jamo"](e)||qr["Hangul Syllables"](e)||qr.Hiragana(e)||qr["Ideographic Description Characters"](e)||qr.Kanbun(e)||qr["Kangxi Radicals"](e)||qr["Katakana Phonetic Extensions"](e)||qr.Katakana(e)&&12540!==e||!(!qr["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!qr["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||qr["Unified Canadian Aboriginal Syllabics"](e)||qr["Unified Canadian Aboriginal Syllabics Extended"](e)||qr["Vertical Forms"](e)||qr["Yijing Hexagram Symbols"](e)||qr["Yi Syllables"](e)||qr["Yi Radicals"](e))))}function Wr(e){return!(Hr(e)||function(e){return!!(qr["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||qr["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||qr["Letterlike Symbols"](e)||qr["Number Forms"](e)||qr["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||qr["Control Pictures"](e)&&9251!==e||qr["Optical Character Recognition"](e)||qr["Enclosed Alphanumerics"](e)||qr["Geometric Shapes"](e)||qr["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||qr["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||qr["CJK Symbols and Punctuation"](e)||qr.Katakana(e)||qr["Private Use Area"](e)||qr["CJK Compatibility Forms"](e)||qr["Small Form Variants"](e)||qr["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function Zr(e){return e>=1424&&e<=2303||qr["Arabic Presentation Forms-A"](e)||qr["Arabic Presentation Forms-B"](e)}function Xr(e,t){return!(!t&&Zr(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||qr.Khmer(e))}function Yr(e){for(var t=0,i=e;t<i.length;t+=1)if(Zr(i[t].charCodeAt(0)))return!0;return!1}var Kr=null,Jr="unavailable",Qr=null,en=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(Jr="error"),Kr&&Kr(e)};function tn(){rn.fire(new Ee("pluginStateChange",{pluginStatus:Jr,pluginURL:Qr}))}var rn=new Ae,nn=function(){return Jr},an=function(){if("deferred"!==Jr||!Qr)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Jr="loading",tn(),Qr&&xe({url:Qr},(function(e){e?en(e):(Jr="loaded",tn())}))},on={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return"loaded"===Jr||null!=on.applyArabicShaping},isLoading:function(){return"loading"===Jr},setState:function(e){Jr=e.pluginStatus,Qr=e.pluginURL},isParsed:function(){return null!=on.applyArabicShaping&&null!=on.processBidirectionalText&&null!=on.processStyledBidirectionalText},getPluginURL:function(){return Qr}},sn=function(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new jr,this.transition={})};sn.prototype.isSupportedScript=function(e){return function(e,t){for(var i=0,r=e;i<r.length;i+=1)if(!Xr(r[i].charCodeAt(0),t))return!1;return!0}(e,on.isLoaded())},sn.prototype.crossFadingFactor=function(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},sn.prototype.getCrossfadeParameters=function(){var e=this.zoom,t=e-Math.floor(e),i=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*i}:{fromScale:.5,toScale:1,t:1-(1-i)*t}};var ln=function(e,t){this.property=e,this.value=t,this.expression=function(e,t){if(Fi(e))return new Yi(e,t);if(Gi(e)){var i=Xi(e,t);if("error"===i.result)throw new Error(i.value.map((function(e){return e.key+": "+e.message})).join(", "));return i.value}var r=e;return"string"==typeof e&&"color"===t.type&&(r=et.parse(e)),{kind:"constant",evaluate:function(){return r}}}(void 0===t?e.specification.default:t,e.specification)};ln.prototype.isDataDriven=function(){return"source"===this.expression.kind||"composite"===this.expression.kind},ln.prototype.possiblyEvaluate=function(e,t,i){return this.property.possiblyEvaluate(this,e,t,i)};var cn=function(e){this.property=e,this.value=new ln(e,void 0)};cn.prototype.transitioned=function(e,t){return new hn(this.property,this.value,t,p({},e.transition,this.transition),e.now)},cn.prototype.untransitioned=function(){return new hn(this.property,this.value,null,{},0)};var un=function(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)};un.prototype.getValue=function(e){return b(this._values[e].value.value)},un.prototype.setValue=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new cn(this._values[e].property)),this._values[e].value=new ln(this._values[e].property,null===t?void 0:b(t))},un.prototype.getTransition=function(e){return b(this._values[e].transition)},un.prototype.setTransition=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new cn(this._values[e].property)),this._values[e].transition=b(t)||void 0},un.prototype.serialize=function(){for(var e={},t=0,i=Object.keys(this._values);t<i.length;t+=1){var r=i[t],n=this.getValue(r);void 0!==n&&(e[r]=n);var a=this.getTransition(r);void 0!==a&&(e[r+"-transition"]=a)}return e},un.prototype.transitioned=function(e,t){for(var i=new pn(this._properties),r=0,n=Object.keys(this._values);r<n.length;r+=1){var a=n[r];i._values[a]=this._values[a].transitioned(e,t._values[a])}return i},un.prototype.untransitioned=function(){for(var e=new pn(this._properties),t=0,i=Object.keys(this._values);t<i.length;t+=1){var r=i[t];e._values[r]=this._values[r].untransitioned()}return e};var hn=function(e,t,i,r,n){this.property=e,this.value=t,this.begin=n+r.delay||0,this.end=this.begin+r.duration||0,e.specification.transition&&(r.delay||r.duration)&&(this.prior=i)};hn.prototype.possiblyEvaluate=function(e,t,i){var r=e.now||0,n=this.value.possiblyEvaluate(e,t,i),a=this.prior;if(a){if(r>this.end)return this.prior=null,n;if(this.value.isDataDriven())return this.prior=null,n;if(r<this.begin)return a.possiblyEvaluate(e,t,i);var o=(r-this.begin)/(this.end-this.begin);return this.property.interpolate(a.possiblyEvaluate(e,t,i),n,function(e){if(e<=0)return 0;if(e>=1)return 1;var t=e*e,i=t*e;return 4*(e<.5?i:3*(e-t)+i-.75)}(o))}return n};var pn=function(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)};pn.prototype.possiblyEvaluate=function(e,t,i){for(var r=new mn(this._properties),n=0,a=Object.keys(this._values);n<a.length;n+=1){var o=a[n];r._values[o]=this._values[o].possiblyEvaluate(e,t,i)}return r},pn.prototype.hasTransition=function(){for(var e=0,t=Object.keys(this._values);e<t.length;e+=1)if(this._values[t[e]].prior)return!0;return!1};var dn=function(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)};dn.prototype.getValue=function(e){return b(this._values[e].value)},dn.prototype.setValue=function(e,t){this._values[e]=new ln(this._values[e].property,null===t?void 0:b(t))},dn.prototype.serialize=function(){for(var e={},t=0,i=Object.keys(this._values);t<i.length;t+=1){var r=i[t],n=this.getValue(r);void 0!==n&&(e[r]=n)}return e},dn.prototype.possiblyEvaluate=function(e,t,i){for(var r=new mn(this._properties),n=0,a=Object.keys(this._values);n<a.length;n+=1){var o=a[n];r._values[o]=this._values[o].possiblyEvaluate(e,t,i)}return r};var fn=function(e,t,i){this.property=e,this.value=t,this.parameters=i};fn.prototype.isConstant=function(){return"constant"===this.value.kind},fn.prototype.constantOr=function(e){return"constant"===this.value.kind?this.value.value:e},fn.prototype.evaluate=function(e,t,i,r){return this.property.evaluate(this.value,this.parameters,e,t,i,r)};var mn=function(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)};mn.prototype.get=function(e){return this._values[e]};var gn=function(e){this.specification=e};gn.prototype.possiblyEvaluate=function(e,t){return e.expression.evaluate(t)},gn.prototype.interpolate=function(e,t,i){var r=Gt[this.specification.type];return r?r(e,t,i):e};var _n=function(e,t){this.specification=e,this.overrides=t};_n.prototype.possiblyEvaluate=function(e,t,i,r){return new fn(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},i,r)}:e.expression,t)},_n.prototype.interpolate=function(e,t,i){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new fn(this,{kind:"constant",value:void 0},e.parameters);var r=Gt[this.specification.type];return r?new fn(this,{kind:"constant",value:r(e.value.value,t.value.value,i)},e.parameters):e},_n.prototype.evaluate=function(e,t,i,r,n,a){return"constant"===e.kind?e.value:e.evaluate(t,i,r,n,a)};var yn=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(e,t,i,r){if(void 0===e.value)return new fn(this,{kind:"constant",value:void 0},t);if("constant"===e.expression.kind){var n=e.expression.evaluate(t,null,{},i,r),a="resolvedImage"===e.property.specification.type&&"string"!=typeof n?n.name:n,o=this._calculate(a,a,a,t);return new fn(this,{kind:"constant",value:o},t)}if("camera"===e.expression.kind){var s=this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t);return new fn(this,{kind:"constant",value:s},t)}return new fn(this,e.expression,t)},t.prototype.evaluate=function(e,t,i,r,n,a){if("source"===e.kind){var o=e.evaluate(t,i,r,n,a);return this._calculate(o,o,o,t)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},i,r),e.evaluate({zoom:Math.floor(t.zoom)},i,r),e.evaluate({zoom:Math.floor(t.zoom)+1},i,r),t):e.value},t.prototype._calculate=function(e,t,i,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:i,to:t}},t.prototype.interpolate=function(e){return e},t}(_n),vn=function(e){this.specification=e};vn.prototype.possiblyEvaluate=function(e,t,i,r){if(void 0!==e.value){if("constant"===e.expression.kind){var n=e.expression.evaluate(t,null,{},i,r);return this._calculate(n,n,n,t)}return this._calculate(e.expression.evaluate(new sn(Math.floor(t.zoom-1),t)),e.expression.evaluate(new sn(Math.floor(t.zoom),t)),e.expression.evaluate(new sn(Math.floor(t.zoom+1),t)),t)}},vn.prototype._calculate=function(e,t,i,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:i,to:t}},vn.prototype.interpolate=function(e){return e};var xn=function(e){this.specification=e};xn.prototype.possiblyEvaluate=function(e,t,i,r){return!!e.expression.evaluate(t,null,{},i,r)},xn.prototype.interpolate=function(){return!1};var bn=function(e){for(var t in this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],e){var i=e[t];i.specification.overridable&&this.overridableProperties.push(t);var r=this.defaultPropertyValues[t]=new ln(i,void 0),n=this.defaultTransitionablePropertyValues[t]=new cn(i);this.defaultTransitioningPropertyValues[t]=n.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=r.possiblyEvaluate({})}};Fr("DataDrivenProperty",_n),Fr("DataConstantProperty",gn),Fr("CrossFadedDataDrivenProperty",yn),Fr("CrossFadedProperty",vn),Fr("ColorRampProperty",xn);var wn=function(e){function t(t,i){if(e.call(this),this.id=t.id,this.type=t.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},"custom"!==t.type&&(this.metadata=(t=t).metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),i.layout&&(this._unevaluatedLayout=new dn(i.layout)),i.paint)){for(var r in this._transitionablePaint=new un(i.paint),t.paint)this.setPaintProperty(r,t.paint[r],{validate:!1});for(var n in t.layout)this.setLayoutProperty(n,t.layout[n],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new mn(i.paint)}}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},t.prototype.getLayoutProperty=function(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)},t.prototype.setLayoutProperty=function(e,t,i){void 0===i&&(i={}),null!=t&&this._validate(Pr,"layers."+this.id+".layout."+e,e,t,i)||("visibility"!==e?this._unevaluatedLayout.setValue(e,t):this.visibility=t)},t.prototype.getPaintProperty=function(e){return y(e,"-transition")?this._transitionablePaint.getTransition(e.slice(0,-"-transition".length)):this._transitionablePaint.getValue(e)},t.prototype.setPaintProperty=function(e,t,i){if(void 0===i&&(i={}),null!=t&&this._validate(Ir,"layers."+this.id+".paint."+e,e,t,i))return!1;if(y(e,"-transition"))return this._transitionablePaint.setTransition(e.slice(0,-"-transition".length),t||void 0),!1;var r=this._transitionablePaint._values[e],n="cross-faded-data-driven"===r.property.specification["property-type"],a=r.value.isDataDriven(),o=r.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);var s=this._transitionablePaint._values[e].value;return s.isDataDriven()||a||n||this._handleOverridablePaintPropertyUpdate(e,o,s)},t.prototype._handleSpecialPaintPropertyUpdate=function(e){},t.prototype._handleOverridablePaintPropertyUpdate=function(e,t,i){return!1},t.prototype.isHidden=function(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility},t.prototype.updateTransitions=function(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)},t.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},t.prototype.recalculate=function(e,t){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)},t.prototype.serialize=function(){var e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),x(e,(function(e,t){return!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length)}))},t.prototype._validate=function(e,t,i,r,n){return void 0===n&&(n={}),(!n||!1!==n.validate)&&zr(this,e.call(Cr,{key:t,layerType:this.type,objectKey:i,value:r,styleSpec:Ie,style:{glyphs:!0,sprite:!0}}))},t.prototype.is3D=function(){return!1},t.prototype.isTileClipped=function(){return!1},t.prototype.hasOffscreenPass=function(){return!1},t.prototype.resize=function(){},t.prototype.isStateDependent=function(){for(var e in this.paint._values){var t=this.paint.get(e);if(t instanceof fn&&ki(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1},t}(Ae),Sn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Mn=function(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Tn=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function En(e,t){void 0===t&&(t=1);var i=0,r=0;return{members:e.map((function(e){var n=Sn[e.type].BYTES_PER_ELEMENT,a=i=Cn(i,Math.max(t,n)),o=e.components||1;return r=Math.max(r,n),i+=n*o,{name:e.name,type:e.type,components:o,offset:a}})),size:Cn(i,Math.max(r,t)),alignment:t}}function Cn(e,t){return Math.ceil(e/t)*t}Tn.serialize=function(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}},Tn.deserialize=function(e){var t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t},Tn.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Tn.prototype.clear=function(){this.length=0},Tn.prototype.resize=function(e){this.reserve(e),this.length=e},Tn.prototype.reserve=function(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}},Tn.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var An=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t){var i=this.length;return this.resize(i+1),this.emplace(i,e,t)},t.prototype.emplace=function(e,t,i){var r=2*e;return this.int16[r+0]=t,this.int16[r+1]=i,e},t}(Tn);An.prototype.bytesPerElement=4,Fr("StructArrayLayout2i4",An);var In=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,i,r){var n=this.length;return this.resize(n+1),this.emplace(n,e,t,i,r)},t.prototype.emplace=function(e,t,i,r,n){var a=4*e;return this.int16[a+0]=t,this.int16[a+1]=i,this.int16[a+2]=r,this.int16[a+3]=n,e},t}(Tn);In.prototype.bytesPerElement=8,Fr("StructArrayLayout4i8",In);var Pn=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,i,r,n,a){var o=this.length;return this.resize(o+1),this.emplace(o,e,t,i,r,n,a)},t.prototype.emplace=function(e,t,i,r,n,a,o){var s=6*e;return this.int16[s+0]=t,this.int16[s+1]=i,this.int16[s+2]=r,this.int16[s+3]=n,this.int16[s+4]=a,this.int16[s+5]=o,e},t}(Tn);Pn.prototype.bytesPerElement=12,Fr("StructArrayLayout2i4i12",Pn);var zn=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,i,r,n,a){var o=this.length;return this.resize(o+1),this.emplace(o,e,t,i,r,n,a)},t.prototype.emplace=function(e,t,i,r,n,a,o){var s=4*e,l=8*e;return this.int16[s+0]=t,this.int16[s+1]=i,this.uint8[l+4]=r,this.uint8[l+5]=n,this.uint8[l+6]=a,this.uint8[l+7]=o,e},t}(Tn);zn.prototype.bytesPerElement=8,Fr("StructArrayLayout2i4ub8",zn);var Rn=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t){var i=this.length;return this.resize(i+1),this.emplace(i,e,t)},t.prototype.emplace=function(e,t,i){var r=2*e;return this.float32[r+0]=t,this.float32[r+1]=i,e},t}(Tn);Rn.prototype.bytesPerElement=8,Fr("StructArrayLayout2f8",Rn);var kn=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,i,r,n,a,o,s,l,c){var u=this.length;return this.resize(u+1),this.emplace(u,e,t,i,r,n,a,o,s,l,c)},t.prototype.emplace=function(e,t,i,r,n,a,o,s,l,c,u){var h=10*e;return this.uint16[h+0]=t,this.uint16[h+1]=i,this.uint16[h+2]=r,this.uint16[h+3]=n,this.uint16[h+4]=a,this.uint16[h+5]=o,this.uint16[h+6]=s,this.uint16[h+7]=l,this.uint16[h+8]=c,this.uint16[h+9]=u,e},t}(Tn);kn.prototype.bytesPerElement=20,Fr("StructArrayLayout10ui20",kn);var Ln=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,i,r,n,a,o,s,l,c,u,h){var p=this.length;return this.resize(p+1),this.emplace(p,e,t,i,r,n,a,o,s,l,c,u,h)},t.prototype.emplace=function(e,t,i,r,n,a,o,s,l,c,u,h,p){var d=12*e;return this.int16[d+0]=t,this.int16[d+1]=i,this.int16[d+2]=r,this.int16[d+3]=n,this.uint16[d+4]=a,this.uint16[d+5]=o,this.uint16[d+6]=s,this.uint16[d+7]=l,this.int16[d+8]=c,this.int16[d+9]=u,this.int16[d+10]=h,this.int16[d+11]=p,e},t}(Tn);Ln.prototype.bytesPerElement=24,Fr("StructArrayLayout4i4ui4i24",Ln);var Dn=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,i){var r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)},t.prototype.emplace=function(e,t,i,r){var n=3*e;return this.float32[n+0]=t,this.float32[n+1]=i,this.float32[n+2]=r,e},t}(Tn);Dn.prototype.bytesPerElement=12,Fr("StructArrayLayout3f12",Dn);var Bn=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e){var t=this.length;return this.resize(t+1),this.emplace(t,e)},t.prototype.emplace=function(e,t){return this.uint32[1*e+0]=t,e},t}(Tn);Bn.prototype.bytesPerElement=4,Fr("StructArrayLayout1ul4",Bn);var Fn=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,i,r,n,a,o,s,l){var c=this.length;return this.resize(c+1),this.emplace(c,e,t,i,r,n,a,o,s,l)},t.prototype.emplace=function(e,t,i,r,n,a,o,s,l,c){var u=10*e,h=5*e;return this.int16[u+0]=t,this.int16[u+1]=i,this.int16[u+2]=r,this.int16[u+3]=n,this.int16[u+4]=a,this.int16[u+5]=o,this.uint32[h+3]=s,this.uint16[u+8]=l,this.uint16[u+9]=c,e},t}(Tn);Fn.prototype.bytesPerElement=20,Fr("StructArrayLayout6i1ul2ui20",Fn);var On=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,i,r,n,a){var o=this.length;return this.resize(o+1),this.emplace(o,e,t,i,r,n,a)},t.prototype.emplace=function(e,t,i,r,n,a,o){var s=6*e;return this.int16[s+0]=t,this.int16[s+1]=i,this.int16[s+2]=r,this.int16[s+3]=n,this.int16[s+4]=a,this.int16[s+5]=o,e},t}(Tn);On.prototype.bytesPerElement=12,Fr("StructArrayLayout2i2i2i12",On);var Nn=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,i,r,n){var a=this.length;return this.resize(a+1),this.emplace(a,e,t,i,r,n)},t.prototype.emplace=function(e,t,i,r,n,a){var o=4*e,s=8*e;return this.float32[o+0]=t,this.float32[o+1]=i,this.float32[o+2]=r,this.int16[s+6]=n,this.int16[s+7]=a,e},t}(Tn);Nn.prototype.bytesPerElement=16,Fr("StructArrayLayout2f1f2i16",Nn);var Vn=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,i,r){var n=this.length;return this.resize(n+1),this.emplace(n,e,t,i,r)},t.prototype.emplace=function(e,t,i,r,n){var a=12*e,o=3*e;return this.uint8[a+0]=t,this.uint8[a+1]=i,this.float32[o+1]=r,this.float32[o+2]=n,e},t}(Tn);Vn.prototype.bytesPerElement=12,Fr("StructArrayLayout2ub2f12",Vn);var Un=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,i){var r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)},t.prototype.emplace=function(e,t,i,r){var n=3*e;return this.uint16[n+0]=t,this.uint16[n+1]=i,this.uint16[n+2]=r,e},t}(Tn);Un.prototype.bytesPerElement=6,Fr("StructArrayLayout3ui6",Un);var $n=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,i,r,n,a,o,s,l,c,u,h,p,d,f,m,g){var _=this.length;return this.resize(_+1),this.emplace(_,e,t,i,r,n,a,o,s,l,c,u,h,p,d,f,m,g)},t.prototype.emplace=function(e,t,i,r,n,a,o,s,l,c,u,h,p,d,f,m,g,_){var y=24*e,v=12*e,x=48*e;return this.int16[y+0]=t,this.int16[y+1]=i,this.uint16[y+2]=r,this.uint16[y+3]=n,this.uint32[v+2]=a,this.uint32[v+3]=o,this.uint32[v+4]=s,this.uint16[y+10]=l,this.uint16[y+11]=c,this.uint16[y+12]=u,this.float32[v+7]=h,this.float32[v+8]=p,this.uint8[x+36]=d,this.uint8[x+37]=f,this.uint8[x+38]=m,this.uint32[v+10]=g,this.int16[y+22]=_,e},t}(Tn);$n.prototype.bytesPerElement=48,Fr("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",$n);var jn=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,i,r,n,a,o,s,l,c,u,h,p,d,f,m,g,_,y,v,x,b,w,S,M,T,E,C){var A=this.length;return this.resize(A+1),this.emplace(A,e,t,i,r,n,a,o,s,l,c,u,h,p,d,f,m,g,_,y,v,x,b,w,S,M,T,E,C)},t.prototype.emplace=function(e,t,i,r,n,a,o,s,l,c,u,h,p,d,f,m,g,_,y,v,x,b,w,S,M,T,E,C,A){var I=34*e,P=17*e;return this.int16[I+0]=t,this.int16[I+1]=i,this.int16[I+2]=r,this.int16[I+3]=n,this.int16[I+4]=a,this.int16[I+5]=o,this.int16[I+6]=s,this.int16[I+7]=l,this.uint16[I+8]=c,this.uint16[I+9]=u,this.uint16[I+10]=h,this.uint16[I+11]=p,this.uint16[I+12]=d,this.uint16[I+13]=f,this.uint16[I+14]=m,this.uint16[I+15]=g,this.uint16[I+16]=_,this.uint16[I+17]=y,this.uint16[I+18]=v,this.uint16[I+19]=x,this.uint16[I+20]=b,this.uint16[I+21]=w,this.uint16[I+22]=S,this.uint32[P+12]=M,this.float32[P+13]=T,this.float32[P+14]=E,this.float32[P+15]=C,this.float32[P+16]=A,e},t}(Tn);jn.prototype.bytesPerElement=68,Fr("StructArrayLayout8i15ui1ul4f68",jn);var qn=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e){var t=this.length;return this.resize(t+1),this.emplace(t,e)},t.prototype.emplace=function(e,t){return this.float32[1*e+0]=t,e},t}(Tn);qn.prototype.bytesPerElement=4,Fr("StructArrayLayout1f4",qn);var Gn=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,i){var r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)},t.prototype.emplace=function(e,t,i,r){var n=3*e;return this.int16[n+0]=t,this.int16[n+1]=i,this.int16[n+2]=r,e},t}(Tn);Gn.prototype.bytesPerElement=6,Fr("StructArrayLayout3i6",Gn);var Hn=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,i){var r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)},t.prototype.emplace=function(e,t,i,r){var n=4*e;return this.uint32[2*e+0]=t,this.uint16[n+2]=i,this.uint16[n+3]=r,e},t}(Tn);Hn.prototype.bytesPerElement=8,Fr("StructArrayLayout1ul2ui8",Hn);var Wn=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t){var i=this.length;return this.resize(i+1),this.emplace(i,e,t)},t.prototype.emplace=function(e,t,i){var r=2*e;return this.uint16[r+0]=t,this.uint16[r+1]=i,e},t}(Tn);Wn.prototype.bytesPerElement=4,Fr("StructArrayLayout2ui4",Wn);var Zn=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e){var t=this.length;return this.resize(t+1),this.emplace(t,e)},t.prototype.emplace=function(e,t){return this.uint16[1*e+0]=t,e},t}(Tn);Zn.prototype.bytesPerElement=2,Fr("StructArrayLayout1ui2",Zn);var Xn=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,i,r){var n=this.length;return this.resize(n+1),this.emplace(n,e,t,i,r)},t.prototype.emplace=function(e,t,i,r,n){var a=4*e;return this.float32[a+0]=t,this.float32[a+1]=i,this.float32[a+2]=r,this.float32[a+3]=n,e},t}(Tn);Xn.prototype.bytesPerElement=16,Fr("StructArrayLayout4f16",Xn);var Yn=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var i={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return i.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},i.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},i.x1.get=function(){return this._structArray.int16[this._pos2+2]},i.y1.get=function(){return this._structArray.int16[this._pos2+3]},i.x2.get=function(){return this._structArray.int16[this._pos2+4]},i.y2.get=function(){return this._structArray.int16[this._pos2+5]},i.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},i.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},i.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},i.anchorPoint.get=function(){return new n(this.anchorPointX,this.anchorPointY)},Object.defineProperties(t.prototype,i),t}(Mn);Yn.prototype.size=20;var Kn=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(e){return new Yn(this,e)},t}(Fn);Fr("CollisionBoxArray",Kn);var Jn=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var i={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return i.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},i.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},i.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},i.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},i.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},i.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},i.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},i.segment.get=function(){return this._structArray.uint16[this._pos2+10]},i.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},i.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},i.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},i.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},i.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},i.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},i.placedOrientation.set=function(e){this._structArray.uint8[this._pos1+37]=e},i.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},i.hidden.set=function(e){this._structArray.uint8[this._pos1+38]=e},i.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},i.crossTileID.set=function(e){this._structArray.uint32[this._pos4+10]=e},i.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(t.prototype,i),t}(Mn);Jn.prototype.size=48;var Qn=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(e){return new Jn(this,e)},t}($n);Fr("PlacedSymbolArray",Qn);var ea=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var i={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return i.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},i.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},i.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},i.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},i.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},i.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},i.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},i.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},i.key.get=function(){return this._structArray.uint16[this._pos2+8]},i.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},i.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},i.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},i.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},i.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},i.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},i.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},i.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},i.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},i.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},i.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},i.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},i.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},i.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},i.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},i.crossTileID.set=function(e){this._structArray.uint32[this._pos4+12]=e},i.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},i.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},i.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},i.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(t.prototype,i),t}(Mn);ea.prototype.size=68;var ta=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(e){return new ea(this,e)},t}(jn);Fr("SymbolInstanceArray",ta);var ia=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getoffsetX=function(e){return this.float32[1*e+0]},t}(qn);Fr("GlyphOffsetArray",ia);var ra=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getx=function(e){return this.int16[3*e+0]},t.prototype.gety=function(e){return this.int16[3*e+1]},t.prototype.gettileUnitDistanceFromAnchor=function(e){return this.int16[3*e+2]},t}(Gn);Fr("SymbolLineVertexArray",ra);var na=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var i={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return i.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},i.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},i.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(t.prototype,i),t}(Mn);na.prototype.size=8;var aa=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(e){return new na(this,e)},t}(Hn);Fr("FeatureIndexArray",aa);var oa=En([{name:"a_pos",components:2,type:"Int16"}],4).members,sa=function(e){void 0===e&&(e=[]),this.segments=e};function la(e,t){return 256*(e=u(Math.floor(e),0,255))+u(Math.floor(t),0,255)}sa.prototype.prepareSegment=function(e,t,i,r){var n=this.segments[this.segments.length-1];return e>sa.MAX_VERTEX_ARRAY_LENGTH&&S("Max vertices per segment is "+sa.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+e),(!n||n.vertexLength+e>sa.MAX_VERTEX_ARRAY_LENGTH||n.sortKey!==r)&&(n={vertexOffset:t.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0},void 0!==r&&(n.sortKey=r),this.segments.push(n)),n},sa.prototype.get=function(){return this.segments},sa.prototype.destroy=function(){for(var e=0,t=this.segments;e<t.length;e+=1){var i=t[e];for(var r in i.vaos)i.vaos[r].destroy()}},sa.simpleSegment=function(e,t,i,r){return new sa([{vertexOffset:e,primitiveOffset:t,vertexLength:i,primitiveLength:r,vaos:{},sortKey:0}])},sa.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Fr("SegmentVector",sa);var ca=En([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),ua=t((function(e){e.exports=function(e,t){var i,r,n,a,o,s,l,c;for(r=e.length-(i=3&e.length),n=t,o=3432918353,s=461845907,c=0;c<r;)l=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,n=27492+(65535&(a=5*(65535&(n=(n^=l=(65535&(l=(l=(65535&l)*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<13|n>>>19))+((5*(n>>>16)&65535)<<16)&4294967295))+((58964+(a>>>16)&65535)<<16);switch(l=0,i){case 3:l^=(255&e.charCodeAt(c+2))<<16;case 2:l^=(255&e.charCodeAt(c+1))<<8;case 1:n^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(c)))*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295}return n^=e.length,n=2246822507*(65535&(n^=n>>>16))+((2246822507*(n>>>16)&65535)<<16)&4294967295,n=3266489909*(65535&(n^=n>>>13))+((3266489909*(n>>>16)&65535)<<16)&4294967295,(n^=n>>>16)>>>0}})),ha=t((function(e){e.exports=function(e,t){for(var i,r=e.length,n=t^r,a=0;r>=4;)i=1540483477*(65535&(i=255&e.charCodeAt(a)|(255&e.charCodeAt(++a))<<8|(255&e.charCodeAt(++a))<<16|(255&e.charCodeAt(++a))<<24))+((1540483477*(i>>>16)&65535)<<16),n=1540483477*(65535&n)+((1540483477*(n>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),r-=4,++a;switch(r){case 3:n^=(255&e.charCodeAt(a+2))<<16;case 2:n^=(255&e.charCodeAt(a+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(a)))+((1540483477*(n>>>16)&65535)<<16)}return n=1540483477*(65535&(n^=n>>>13))+((1540483477*(n>>>16)&65535)<<16),(n^=n>>>15)>>>0}})),pa=ua,da=ha;pa.murmur3=ua,pa.murmur2=da;var fa=function(){this.ids=[],this.positions=[],this.indexed=!1};fa.prototype.add=function(e,t,i,r){this.ids.push(ga(e)),this.positions.push(t,i,r)},fa.prototype.getPositions=function(e){for(var t=ga(e),i=0,r=this.ids.length-1;i<r;){var n=i+r>>1;this.ids[n]>=t?r=n:i=n+1}for(var a=[];this.ids[i]===t;)a.push({index:this.positions[3*i],start:this.positions[3*i+1],end:this.positions[3*i+2]}),i++;return a},fa.serialize=function(e,t){var i=new Float64Array(e.ids),r=new Uint32Array(e.positions);return function e(t,i,r,n){for(;r<n;){for(var a=t[r+n>>1],o=r-1,s=n+1;;){do{o++}while(t[o]<a);do{s--}while(t[s]>a);if(o>=s)break;_a(t,o,s),_a(i,3*o,3*s),_a(i,3*o+1,3*s+1),_a(i,3*o+2,3*s+2)}s-r<n-s?(e(t,i,r,s),r=s+1):(e(t,i,s+1,n),n=s)}}(i,r,0,i.length-1),t&&t.push(i.buffer,r.buffer),{ids:i,positions:r}},fa.deserialize=function(e){var t=new fa;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t};var ma=Math.pow(2,53)-1;function ga(e){var t=+e;return!isNaN(t)&&t<=ma?t:pa(String(e))}function _a(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}Fr("FeaturePositionMap",fa);var ya=function(e,t){this.gl=e.gl,this.location=t},va=function(e){function t(t,i){e.call(this,t,i),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(e){this.current!==e&&(this.current=e,this.gl.uniform1i(this.location,e))},t}(ya),xa=function(e){function t(t,i){e.call(this,t,i),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))},t}(ya),ba=function(e){function t(t,i){e.call(this,t,i),this.current=[0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(e){e[0]===this.current[0]&&e[1]===this.current[1]||(this.current=e,this.gl.uniform2f(this.location,e[0],e[1]))},t}(ya),wa=function(e){function t(t,i){e.call(this,t,i),this.current=[0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]||(this.current=e,this.gl.uniform3f(this.location,e[0],e[1],e[2]))},t}(ya),Sa=function(e){function t(t,i){e.call(this,t,i),this.current=[0,0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))},t}(ya),Ma=function(e){function t(t,i){e.call(this,t,i),this.current=et.transparent}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))},t}(ya),Ta=new Float32Array(16),Ea=function(e){function t(t,i){e.call(this,t,i),this.current=Ta}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(e){if(e[12]!==this.current[12]||e[0]!==this.current[0])return this.current=e,void this.gl.uniformMatrix4fv(this.location,!1,e);for(var t=1;t<16;t++)if(e[t]!==this.current[t]){this.current=e,this.gl.uniformMatrix4fv(this.location,!1,e);break}},t}(ya);function Ca(e){return[la(255*e.r,255*e.g),la(255*e.b,255*e.a)]}var Aa=function(e,t,i){this.value=e,this.uniformNames=t.map((function(e){return"u_"+e})),this.type=i};Aa.prototype.setUniform=function(e,t,i){e.set(i.constantOr(this.value))},Aa.prototype.getBinding=function(e,t,i){return"color"===this.type?new Ma(e,t):new xa(e,t)};var Ia=function(e,t){this.uniformNames=t.map((function(e){return"u_"+e})),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Ia.prototype.setConstantPatternPositions=function(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr},Ia.prototype.setUniform=function(e,t,i,r){var n="u_pattern_to"===r?this.patternTo:"u_pattern_from"===r?this.patternFrom:"u_pixel_ratio_to"===r?this.pixelRatioTo:"u_pixel_ratio_from"===r?this.pixelRatioFrom:null;n&&e.set(n)},Ia.prototype.getBinding=function(e,t,i){return"u_pattern"===i.substr(0,9)?new Sa(e,t):new xa(e,t)};var Pa=function(e,t,i,r){this.expression=e,this.type=i,this.maxValue=0,this.paintVertexAttributes=t.map((function(e){return{name:"a_"+e,type:"Float32",components:"color"===i?2:1,offset:0}})),this.paintVertexArray=new r};Pa.prototype.populatePaintArray=function(e,t,i,r,n){var a=this.paintVertexArray.length,o=this.expression.evaluate(new sn(0),t,{},r,[],n);this.paintVertexArray.resize(e),this._setPaintValue(a,e,o)},Pa.prototype.updatePaintArray=function(e,t,i,r){var n=this.expression.evaluate({zoom:0},i,r);this._setPaintValue(e,t,n)},Pa.prototype._setPaintValue=function(e,t,i){if("color"===this.type)for(var r=Ca(i),n=e;n<t;n++)this.paintVertexArray.emplace(n,r[0],r[1]);else{for(var a=e;a<t;a++)this.paintVertexArray.emplace(a,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}},Pa.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Pa.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var za=function(e,t,i,r,n,a){this.expression=e,this.uniformNames=t.map((function(e){return"u_"+e+"_t"})),this.type=i,this.useIntegerZoom=r,this.zoom=n,this.maxValue=0,this.paintVertexAttributes=t.map((function(e){return{name:"a_"+e,type:"Float32",components:"color"===i?4:2,offset:0}})),this.paintVertexArray=new a};za.prototype.populatePaintArray=function(e,t,i,r,n){var a=this.expression.evaluate(new sn(this.zoom),t,{},r,[],n),o=this.expression.evaluate(new sn(this.zoom+1),t,{},r,[],n),s=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(s,e,a,o)},za.prototype.updatePaintArray=function(e,t,i,r){var n=this.expression.evaluate({zoom:this.zoom},i,r),a=this.expression.evaluate({zoom:this.zoom+1},i,r);this._setPaintValue(e,t,n,a)},za.prototype._setPaintValue=function(e,t,i,r){if("color"===this.type)for(var n=Ca(i),a=Ca(r),o=e;o<t;o++)this.paintVertexArray.emplace(o,n[0],n[1],a[0],a[1]);else{for(var s=e;s<t;s++)this.paintVertexArray.emplace(s,i,r);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(r))}},za.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},za.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},za.prototype.setUniform=function(e,t){var i=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,r=u(this.expression.interpolationFactor(i,this.zoom,this.zoom+1),0,1);e.set(r)},za.prototype.getBinding=function(e,t,i){return new xa(e,t)};var Ra=function(e,t,i,r,n,a){this.expression=e,this.type=t,this.useIntegerZoom=i,this.zoom=r,this.layerId=a,this.zoomInPaintVertexArray=new n,this.zoomOutPaintVertexArray=new n};Ra.prototype.populatePaintArray=function(e,t,i){var r=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(r,e,t.patterns&&t.patterns[this.layerId],i)},Ra.prototype.updatePaintArray=function(e,t,i,r,n){this._setPaintValues(e,t,i.patterns&&i.patterns[this.layerId],n)},Ra.prototype._setPaintValues=function(e,t,i,r){if(r&&i){var n=r[i.min],a=r[i.mid],o=r[i.max];if(n&&a&&o)for(var s=e;s<t;s++)this.zoomInPaintVertexArray.emplace(s,a.tl[0],a.tl[1],a.br[0],a.br[1],n.tl[0],n.tl[1],n.br[0],n.br[1],a.pixelRatio,n.pixelRatio),this.zoomOutPaintVertexArray.emplace(s,a.tl[0],a.tl[1],a.br[0],a.br[1],o.tl[0],o.tl[1],o.br[0],o.br[1],a.pixelRatio,o.pixelRatio)}},Ra.prototype.upload=function(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,ca.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,ca.members,this.expression.isStateDependent))},Ra.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var ka=function(e,t,i){this.binders={},this._buffers=[];var r=[];for(var n in e.paint._values)if(i(n)){var a=e.paint.get(n);if(a instanceof fn&&ki(a.property.specification)){var o=Da(n,e.type),s=a.value,l=a.property.specification.type,c=a.property.useIntegerZoom,u=a.property.specification["property-type"],h="cross-faded"===u||"cross-faded-data-driven"===u;if("constant"===s.kind)this.binders[n]=h?new Ia(s.value,o):new Aa(s.value,o,l),r.push("/u_"+n);else if("source"===s.kind||h){var p=Ba(n,l,"source");this.binders[n]=h?new Ra(s,l,c,t,p,e.id):new Pa(s,o,l,p),r.push("/a_"+n)}else{var d=Ba(n,l,"composite");this.binders[n]=new za(s,o,l,c,t,d),r.push("/z_"+n)}}}this.cacheKey=r.sort().join("")};ka.prototype.getMaxValue=function(e){var t=this.binders[e];return t instanceof Pa||t instanceof za?t.maxValue:0},ka.prototype.populatePaintArrays=function(e,t,i,r,n){for(var a in this.binders){var o=this.binders[a];(o instanceof Pa||o instanceof za||o instanceof Ra)&&o.populatePaintArray(e,t,i,r,n)}},ka.prototype.setConstantPatternPositions=function(e,t){for(var i in this.binders){var r=this.binders[i];r instanceof Ia&&r.setConstantPatternPositions(e,t)}},ka.prototype.updatePaintArrays=function(e,t,i,r,n){var a=!1;for(var o in e)for(var s=0,l=t.getPositions(o);s<l.length;s+=1){var c=l[s],u=i.feature(c.index);for(var h in this.binders){var p=this.binders[h];if((p instanceof Pa||p instanceof za||p instanceof Ra)&&!0===p.expression.isStateDependent){var d=r.paint.get(h);p.expression=d.value,p.updatePaintArray(c.start,c.end,u,e[o],n),a=!0}}}return a},ka.prototype.defines=function(){var e=[];for(var t in this.binders){var i=this.binders[t];(i instanceof Aa||i instanceof Ia)&&e.push.apply(e,i.uniformNames.map((function(e){return"#define HAS_UNIFORM_"+e})))}return e},ka.prototype.getBinderAttributes=function(){var e=[];for(var t in this.binders){var i=this.binders[t];if(i instanceof Pa||i instanceof za)for(var r=0;r<i.paintVertexAttributes.length;r++)e.push(i.paintVertexAttributes[r].name);else if(i instanceof Ra)for(var n=0;n<ca.members.length;n++)e.push(ca.members[n].name)}return e},ka.prototype.getBinderUniforms=function(){var e=[];for(var t in this.binders){var i=this.binders[t];if(i instanceof Aa||i instanceof Ia||i instanceof za)for(var r=0,n=i.uniformNames;r<n.length;r+=1)e.push(n[r])}return e},ka.prototype.getPaintVertexBuffers=function(){return this._buffers},ka.prototype.getUniforms=function(e,t){var i=[];for(var r in this.binders){var n=this.binders[r];if(n instanceof Aa||n instanceof Ia||n instanceof za)for(var a=0,o=n.uniformNames;a<o.length;a+=1){var s=o[a];if(t[s]){var l=n.getBinding(e,t[s],s);i.push({name:s,property:r,binding:l})}}}return i},ka.prototype.setUniforms=function(e,t,i,r){for(var n=0,a=t;n<a.length;n+=1){var o=a[n],s=o.name,l=o.property;this.binders[l].setUniform(o.binding,r,i.get(l),s)}},ka.prototype.updatePaintBuffers=function(e){for(var t in this._buffers=[],this.binders){var i=this.binders[t];if(e&&i instanceof Ra){var r=2===e.fromScale?i.zoomInPaintVertexBuffer:i.zoomOutPaintVertexBuffer;r&&this._buffers.push(r)}else(i instanceof Pa||i instanceof za)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}},ka.prototype.upload=function(e){for(var t in this.binders){var i=this.binders[t];(i instanceof Pa||i instanceof za||i instanceof Ra)&&i.upload(e)}this.updatePaintBuffers()},ka.prototype.destroy=function(){for(var e in this.binders){var t=this.binders[e];(t instanceof Pa||t instanceof za||t instanceof Ra)&&t.destroy()}};var La=function(e,t,i){void 0===i&&(i=function(){return!0}),this.programConfigurations={};for(var r=0,n=e;r<n.length;r+=1){var a=n[r];this.programConfigurations[a.id]=new ka(a,t,i)}this.needsUpload=!1,this._featureMap=new fa,this._bufferOffset=0};function Da(e,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[e]||[e.replace(t+"-","").replace(/-/g,"_")]}function Ba(e,t,i){var r={color:{source:Rn,composite:Xn},number:{source:qn,composite:Rn}},n=function(e){return{"line-pattern":{source:kn,composite:kn},"fill-pattern":{source:kn,composite:kn},"fill-extrusion-pattern":{source:kn,composite:kn}}[e]}(e);return n&&n[i]||r[t][i]}La.prototype.populatePaintArrays=function(e,t,i,r,n,a){for(var o in this.programConfigurations)this.programConfigurations[o].populatePaintArrays(e,t,r,n,a);void 0!==t.id&&this._featureMap.add(t.id,i,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0},La.prototype.updatePaintArrays=function(e,t,i,r){for(var n=0,a=i;n<a.length;n+=1){var o=a[n];this.needsUpload=this.programConfigurations[o.id].updatePaintArrays(e,this._featureMap,t,o,r)||this.needsUpload}},La.prototype.get=function(e){return this.programConfigurations[e]},La.prototype.upload=function(e){if(this.needsUpload){for(var t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}},La.prototype.destroy=function(){for(var e in this.programConfigurations)this.programConfigurations[e].destroy()},Fr("ConstantBinder",Aa),Fr("CrossFadedConstantBinder",Ia),Fr("SourceExpressionBinder",Pa),Fr("CrossFadedCompositeBinder",Ra),Fr("CompositeExpressionBinder",za),Fr("ProgramConfiguration",ka,{omit:["_buffers"]}),Fr("ProgramConfigurationSet",La);var Fa=Math.pow(2,14)-1,Oa=-Fa-1;function Na(e){for(var t=8192/e.extent,i=e.loadGeometry(),r=0;r<i.length;r++)for(var n=i[r],a=0;a<n.length;a++){var o=n[a],s=Math.round(o.x*t),l=Math.round(o.y*t);o.x=u(s,Oa,Fa),o.y=u(l,Oa,Fa),(s<o.x||s>o.x+1||l<o.y||l>o.y+1)&&S("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return i}function Va(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Na(e):[]}}function Ua(e,t,i,r,n){e.emplaceBack(2*t+(r+1)/2,2*i+(n+1)/2)}var $a=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((function(e){return e.id})),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new An,this.indexArray=new Un,this.segments=new sa,this.programConfigurations=new La(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((function(e){return e.isStateDependent()})).map((function(e){return e.id}))};function ja(e,t){for(var i=0;i<e.length;i++)if(Ja(t,e[i]))return!0;for(var r=0;r<t.length;r++)if(Ja(e,t[r]))return!0;return!!Wa(e,t)}function qa(e,t,i){return!!Ja(e,t)||!!Xa(t,e,i)}function Ga(e,t){if(1===e.length)return Ka(t,e[0]);for(var i=0;i<t.length;i++)for(var r=t[i],n=0;n<r.length;n++)if(Ja(e,r[n]))return!0;for(var a=0;a<e.length;a++)if(Ka(t,e[a]))return!0;for(var o=0;o<t.length;o++)if(Wa(e,t[o]))return!0;return!1}function Ha(e,t,i){if(e.length>1){if(Wa(e,t))return!0;for(var r=0;r<t.length;r++)if(Xa(t[r],e,i))return!0}for(var n=0;n<e.length;n++)if(Xa(e[n],t,i))return!0;return!1}function Wa(e,t){if(0===e.length||0===t.length)return!1;for(var i=0;i<e.length-1;i++)for(var r=e[i],n=e[i+1],a=0;a<t.length-1;a++)if(Za(r,n,t[a],t[a+1]))return!0;return!1}function Za(e,t,i,r){return M(e,i,r)!==M(t,i,r)&&M(e,t,i)!==M(e,t,r)}function Xa(e,t,i){var r=i*i;if(1===t.length)return e.distSqr(t[0])<r;for(var n=1;n<t.length;n++)if(Ya(e,t[n-1],t[n])<r)return!0;return!1}function Ya(e,t,i){var r=t.distSqr(i);if(0===r)return e.distSqr(t);var n=((e.x-t.x)*(i.x-t.x)+(e.y-t.y)*(i.y-t.y))/r;return e.distSqr(n<0?t:n>1?i:i.sub(t)._mult(n)._add(t))}function Ka(e,t){for(var i,r,n,a=!1,o=0;o<e.length;o++)for(var s=0,l=(i=e[o]).length-1;s<i.length;l=s++)(r=i[s]).y>t.y!=(n=i[l]).y>t.y&&t.x<(n.x-r.x)*(t.y-r.y)/(n.y-r.y)+r.x&&(a=!a);return a}function Ja(e,t){for(var i=!1,r=0,n=e.length-1;r<e.length;n=r++){var a=e[r],o=e[n];a.y>t.y!=o.y>t.y&&t.x<(o.x-a.x)*(t.y-a.y)/(o.y-a.y)+a.x&&(i=!i)}return i}function Qa(e,t,i){var r=i[0],n=i[2];if(e.x<r.x&&t.x<r.x||e.x>n.x&&t.x>n.x||e.y<r.y&&t.y<r.y||e.y>n.y&&t.y>n.y)return!1;var a=M(e,t,i[0]);return a!==M(e,t,i[1])||a!==M(e,t,i[2])||a!==M(e,t,i[3])}function eo(e,t,i){var r=t.paint.get(e).value;return"constant"===r.kind?r.value:i.programConfigurations.get(t.id).getMaxValue(e)}function to(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function io(e,t,i,r,a){if(!t[0]&&!t[1])return e;var o=n.convert(t)._mult(a);"viewport"===i&&o._rotate(-r);for(var s=[],l=0;l<e.length;l++)s.push(e[l].sub(o));return s}$a.prototype.populate=function(e,t,i){var r=this.layers[0],n=[],a=null;"circle"===r.type&&(a=r.layout.get("circle-sort-key"));for(var o=0,s=e;o<s.length;o+=1){var l=s[o],c=l.feature,u=l.id,h=l.index,p=l.sourceLayerIndex,d=this.layers[0]._featureFilter.needGeometry,f=Va(c,d);if(this.layers[0]._featureFilter.filter(new sn(this.zoom),f,i)){var m=a?a.evaluate(f,{},i):void 0,g={id:u,properties:c.properties,type:c.type,sourceLayerIndex:p,index:h,geometry:d?f.geometry:Na(c),patterns:{},sortKey:m};n.push(g)}}a&&n.sort((function(e,t){return e.sortKey-t.sortKey}));for(var _=0,y=n;_<y.length;_+=1){var v=y[_],x=v.geometry,b=v.index,w=v.sourceLayerIndex,S=e[b].feature;this.addFeature(v,x,b,i),t.featureIndex.insert(S,x,b,w,this.index)}},$a.prototype.update=function(e,t,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i)},$a.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},$a.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},$a.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,oa),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},$a.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},$a.prototype.addFeature=function(e,t,i,r){for(var n=0,a=t;n<a.length;n+=1)for(var o=0,s=a[n];o<s.length;o+=1){var l=s[o],c=l.x,u=l.y;if(!(c<0||c>=8192||u<0||u>=8192)){var h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),p=h.vertexLength;Ua(this.layoutVertexArray,c,u,-1,-1),Ua(this.layoutVertexArray,c,u,1,-1),Ua(this.layoutVertexArray,c,u,1,1),Ua(this.layoutVertexArray,c,u,-1,1),this.indexArray.emplaceBack(p,p+1,p+2),this.indexArray.emplaceBack(p,p+3,p+2),h.vertexLength+=4,h.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,{},r)},Fr("CircleBucket",$a,{omit:["layers"]});var ro=new bn({"circle-sort-key":new _n(Ie.layout_circle["circle-sort-key"])}),no={paint:new bn({"circle-radius":new _n(Ie.paint_circle["circle-radius"]),"circle-color":new _n(Ie.paint_circle["circle-color"]),"circle-blur":new _n(Ie.paint_circle["circle-blur"]),"circle-opacity":new _n(Ie.paint_circle["circle-opacity"]),"circle-translate":new gn(Ie.paint_circle["circle-translate"]),"circle-translate-anchor":new gn(Ie.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new gn(Ie.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new gn(Ie.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new _n(Ie.paint_circle["circle-stroke-width"]),"circle-stroke-color":new _n(Ie.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new _n(Ie.paint_circle["circle-stroke-opacity"])}),layout:ro},ao="undefined"!=typeof Float32Array?Float32Array:Array;function oo(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function so(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],c=t[6],u=t[7],h=t[8],p=t[9],d=t[10],f=t[11],m=t[12],g=t[13],_=t[14],y=t[15],v=i[0],x=i[1],b=i[2],w=i[3];return e[0]=v*r+x*s+b*h+w*m,e[1]=v*n+x*l+b*p+w*g,e[2]=v*a+x*c+b*d+w*_,e[3]=v*o+x*u+b*f+w*y,e[4]=(v=i[4])*r+(x=i[5])*s+(b=i[6])*h+(w=i[7])*m,e[5]=v*n+x*l+b*p+w*g,e[6]=v*a+x*c+b*d+w*_,e[7]=v*o+x*u+b*f+w*y,e[8]=(v=i[8])*r+(x=i[9])*s+(b=i[10])*h+(w=i[11])*m,e[9]=v*n+x*l+b*p+w*g,e[10]=v*a+x*c+b*d+w*_,e[11]=v*o+x*u+b*f+w*y,e[12]=(v=i[12])*r+(x=i[13])*s+(b=i[14])*h+(w=i[15])*m,e[13]=v*n+x*l+b*p+w*g,e[14]=v*a+x*c+b*d+w*_,e[15]=v*o+x*u+b*f+w*y,e}Math.hypot||(Math.hypot=function(){for(var e=arguments,t=0,i=arguments.length;i--;)t+=e[i]*e[i];return Math.sqrt(t)});var lo,co=so;function uo(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3];return e[0]=i[0]*r+i[4]*n+i[8]*a+i[12]*o,e[1]=i[1]*r+i[5]*n+i[9]*a+i[13]*o,e[2]=i[2]*r+i[6]*n+i[10]*a+i[14]*o,e[3]=i[3]*r+i[7]*n+i[11]*a+i[15]*o,e}lo=new ao(3),ao!=Float32Array&&(lo[0]=0,lo[1]=0,lo[2]=0),function(){var e=new ao(4);ao!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}();var ho=(function(){var e=new ao(2);ao!=Float32Array&&(e[0]=0,e[1]=0)}(),function(e){function t(t){e.call(this,t,no)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(e){return new $a(e)},t.prototype.queryRadius=function(e){var t=e;return eo("circle-radius",this,t)+eo("circle-stroke-width",this,t)+to(this.paint.get("circle-translate"))},t.prototype.queryIntersectsFeature=function(e,t,i,r,n,a,o,s){for(var l=io(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),a.angle,o),c=this.paint.get("circle-radius").evaluate(t,i)+this.paint.get("circle-stroke-width").evaluate(t,i),u="map"===this.paint.get("circle-pitch-alignment"),h=u?l:function(e,t){return e.map((function(e){return po(e,t)}))}(l,s),p=u?c*o:c,d=0,f=r;d<f.length;d+=1)for(var m=0,g=f[d];m<g.length;m+=1){var _=g[m],y=u?_:po(_,s),v=p,x=uo([],[_.x,_.y,0,1],s);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?v*=x[3]/a.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(v*=a.cameraToCenterDistance/x[3]),qa(h,y,v))return!0}return!1},t}(wn));function po(e,t){var i=uo([],[e.x,e.y,0,1],t);return new n(i[0]/i[3],i[1]/i[3])}var fo=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}($a);function mo(e,t,i,r){var n=t.width,a=t.height;if(r){if(r instanceof Uint8ClampedArray)r=new Uint8Array(r.buffer);else if(r.length!==n*a*i)throw new RangeError("mismatched image size")}else r=new Uint8Array(n*a*i);return e.width=n,e.height=a,e.data=r,e}function go(e,t,i){var r=t.width,n=t.height;if(r!==e.width||n!==e.height){var a=mo({},{width:r,height:n},i);_o(e,a,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,r),height:Math.min(e.height,n)},i),e.width=r,e.height=n,e.data=a.data}}function _o(e,t,i,r,n,a){if(0===n.width||0===n.height)return t;if(n.width>e.width||n.height>e.height||i.x>e.width-n.width||i.y>e.height-n.height)throw new RangeError("out of range source coordinates for image copy");if(n.width>t.width||n.height>t.height||r.x>t.width-n.width||r.y>t.height-n.height)throw new RangeError("out of range destination coordinates for image copy");for(var o=e.data,s=t.data,l=0;l<n.height;l++)for(var c=((i.y+l)*e.width+i.x)*a,u=((r.y+l)*t.width+r.x)*a,h=0;h<n.width*a;h++)s[u+h]=o[c+h];return t}Fr("HeatmapBucket",fo,{omit:["layers"]});var yo=function(e,t){mo(this,e,1,t)};yo.prototype.resize=function(e){go(this,e,1)},yo.prototype.clone=function(){return new yo({width:this.width,height:this.height},new Uint8Array(this.data))},yo.copy=function(e,t,i,r,n){_o(e,t,i,r,n,1)};var vo=function(e,t){mo(this,e,4,t)};vo.prototype.resize=function(e){go(this,e,4)},vo.prototype.replace=function(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e},vo.prototype.clone=function(){return new vo({width:this.width,height:this.height},new Uint8Array(this.data))},vo.copy=function(e,t,i,r,n){_o(e,t,i,r,n,4)},Fr("AlphaImage",yo),Fr("RGBAImage",vo);var xo={paint:new bn({"heatmap-radius":new _n(Ie.paint_heatmap["heatmap-radius"]),"heatmap-weight":new _n(Ie.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new gn(Ie.paint_heatmap["heatmap-intensity"]),"heatmap-color":new xn(Ie.paint_heatmap["heatmap-color"]),"heatmap-opacity":new gn(Ie.paint_heatmap["heatmap-opacity"])})};function bo(e){var t={},i=e.resolution||256,r=e.clips?e.clips.length:1,n=e.image||new vo({width:i,height:r}),a=function(i,r,a){t[e.evaluationKey]=a;var o=e.expression.evaluate(t);n.data[i+r+0]=Math.floor(255*o.r/o.a),n.data[i+r+1]=Math.floor(255*o.g/o.a),n.data[i+r+2]=Math.floor(255*o.b/o.a),n.data[i+r+3]=Math.floor(255*o.a)};if(e.clips)for(var o=0,s=0;o<r;++o,s+=4*i)for(var l=0,c=0;l<i;l++,c+=4){var u=l/(i-1),h=e.clips[o];a(s,c,h.start*(1-u)+h.end*u)}else for(var p=0,d=0;p<i;p++,d+=4)a(0,d,p/(i-1));return n}var wo=function(e){function t(t){e.call(this,t,xo),this._updateColorRamp()}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(e){return new fo(e)},t.prototype._handleSpecialPaintPropertyUpdate=function(e){"heatmap-color"===e&&this._updateColorRamp()},t.prototype._updateColorRamp=function(){this.colorRamp=bo({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},t.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility},t}(wn),So={paint:new bn({"hillshade-illumination-direction":new gn(Ie.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new gn(Ie.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new gn(Ie.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new gn(Ie.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new gn(Ie.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new gn(Ie.paint_hillshade["hillshade-accent-color"])})},Mo=function(e){function t(t){e.call(this,t,So)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility},t}(wn),To=En([{name:"a_pos",components:2,type:"Int16"}],4).members,Eo=Ao,Co=Ao;function Ao(e,t,i){i=i||2;var r,n,a,o,s,l,c,u=t&&t.length,h=u?t[0]*i:e.length,p=Io(e,0,h,i,!0),d=[];if(!p||p.next===p.prev)return d;if(u&&(p=function(e,t,i,r){var n,a,o,s=[];for(n=0,a=t.length;n<a;n++)(o=Io(e,t[n]*r,n<a-1?t[n+1]*r:e.length,r,!1))===o.next&&(o.steiner=!0),s.push(Vo(o));for(s.sort(Bo),n=0;n<s.length;n++)Fo(s[n],i),i=Po(i,i.next);return i}(e,t,p,i)),e.length>80*i){r=a=e[0],n=o=e[1];for(var f=i;f<h;f+=i)(s=e[f])<r&&(r=s),(l=e[f+1])<n&&(n=l),s>a&&(a=s),l>o&&(o=l);c=0!==(c=Math.max(a-r,o-n))?1/c:0}return zo(p,d,i,r,n,c),d}function Io(e,t,i,r,n){var a,o;if(n===Qo(e,t,i,r)>0)for(a=t;a<i;a+=r)o=Yo(a,e[a],e[a+1],o);else for(a=i-r;a>=t;a-=r)o=Yo(a,e[a],e[a+1],o);return o&&qo(o,o.next)&&(Ko(o),o=o.next),o}function Po(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!qo(r,r.next)&&0!==jo(r.prev,r,r.next))r=r.next;else{if(Ko(r),(r=t=r.prev)===r.next)break;i=!0}}while(i||r!==t);return t}function zo(e,t,i,r,n,a,o){if(e){!o&&a&&function(e,t,i,r){var n=e;do{null===n.z&&(n.z=No(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,i,r,n,a,o,s,l,c=1;do{for(i=e,e=null,a=null,o=0;i;){for(o++,r=i,s=0,t=0;t<c&&(s++,r=r.nextZ);t++);for(l=c;s>0||l>0&&r;)0!==s&&(0===l||!r||i.z<=r.z)?(n=i,i=i.nextZ,s--):(n=r,r=r.nextZ,l--),a?a.nextZ=n:e=n,n.prevZ=a,a=n;i=r}a.nextZ=null,c*=2}while(o>1)}(n)}(e,r,n,a);for(var s,l,c=e;e.prev!==e.next;)if(s=e.prev,l=e.next,a?ko(e,r,n,a):Ro(e))t.push(s.i/i),t.push(e.i/i),t.push(l.i/i),Ko(e),e=l.next,c=l.next;else if((e=l)===c){o?1===o?zo(e=Lo(Po(e),t,i),t,i,r,n,a,2):2===o&&Do(e,t,i,r,n,a):zo(Po(e),t,i,r,n,a,1);break}}}function Ro(e){var t=e.prev,i=e,r=e.next;if(jo(t,i,r)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(Uo(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&jo(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function ko(e,t,i,r){var n=e.prev,a=e,o=e.next;if(jo(n,a,o)>=0)return!1;for(var s=n.x>a.x?n.x>o.x?n.x:o.x:a.x>o.x?a.x:o.x,l=n.y>a.y?n.y>o.y?n.y:o.y:a.y>o.y?a.y:o.y,c=No(n.x<a.x?n.x<o.x?n.x:o.x:a.x<o.x?a.x:o.x,n.y<a.y?n.y<o.y?n.y:o.y:a.y<o.y?a.y:o.y,t,i,r),u=No(s,l,t,i,r),h=e.prevZ,p=e.nextZ;h&&h.z>=c&&p&&p.z<=u;){if(h!==e.prev&&h!==e.next&&Uo(n.x,n.y,a.x,a.y,o.x,o.y,h.x,h.y)&&jo(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,p!==e.prev&&p!==e.next&&Uo(n.x,n.y,a.x,a.y,o.x,o.y,p.x,p.y)&&jo(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;h&&h.z>=c;){if(h!==e.prev&&h!==e.next&&Uo(n.x,n.y,a.x,a.y,o.x,o.y,h.x,h.y)&&jo(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;p&&p.z<=u;){if(p!==e.prev&&p!==e.next&&Uo(n.x,n.y,a.x,a.y,o.x,o.y,p.x,p.y)&&jo(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function Lo(e,t,i){var r=e;do{var n=r.prev,a=r.next.next;!qo(n,a)&&Go(n,r,r.next,a)&&Zo(n,a)&&Zo(a,n)&&(t.push(n.i/i),t.push(r.i/i),t.push(a.i/i),Ko(r),Ko(r.next),r=e=a),r=r.next}while(r!==e);return Po(r)}function Do(e,t,i,r,n,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&$o(o,s)){var l=Xo(o,s);return o=Po(o,o.next),l=Po(l,l.next),zo(o,t,i,r,n,a),void zo(l,t,i,r,n,a)}s=s.next}o=o.next}while(o!==e)}function Bo(e,t){return e.x-t.x}function Fo(e,t){if(t=function(e,t){var i,r=t,n=e.x,a=e.y,o=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var s=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=n&&s>o){if(o=s,s===n){if(a===r.y)return r;if(a===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!i)return null;if(n===o)return i;var l,c=i,u=i.x,h=i.y,p=1/0;r=i;do{n>=r.x&&r.x>=u&&n!==r.x&&Uo(a<h?n:o,a,u,h,a<h?o:n,a,r.x,r.y)&&(l=Math.abs(a-r.y)/(n-r.x),Zo(r,e)&&(l<p||l===p&&(r.x>i.x||r.x===i.x&&Oo(i,r)))&&(i=r,p=l)),r=r.next}while(r!==c);return i}(e,t)){var i=Xo(t,e);Po(t,t.next),Po(i,i.next)}}function Oo(e,t){return jo(e.prev,e,t.prev)<0&&jo(t.next,e,e.next)<0}function No(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Vo(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function Uo(e,t,i,r,n,a,o,s){return(n-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(r-s)-(i-o)*(t-s)>=0&&(i-o)*(a-s)-(n-o)*(r-s)>=0}function $o(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&Go(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(Zo(e,t)&&Zo(t,e)&&function(e,t){var i=e,r=!1,n=(e.x+t.x)/2,a=(e.y+t.y)/2;do{i.y>a!=i.next.y>a&&i.next.y!==i.y&&n<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}(e,t)&&(jo(e.prev,e,t.prev)||jo(e,t.prev,t))||qo(e,t)&&jo(e.prev,e,e.next)>0&&jo(t.prev,t,t.next)>0)}function jo(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function qo(e,t){return e.x===t.x&&e.y===t.y}function Go(e,t,i,r){var n=Wo(jo(e,t,i)),a=Wo(jo(e,t,r)),o=Wo(jo(i,r,e)),s=Wo(jo(i,r,t));return n!==a&&o!==s||!(0!==n||!Ho(e,i,t))||!(0!==a||!Ho(e,r,t))||!(0!==o||!Ho(i,e,r))||!(0!==s||!Ho(i,t,r))}function Ho(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function Wo(e){return e>0?1:e<0?-1:0}function Zo(e,t){return jo(e.prev,e,e.next)<0?jo(e,t,e.next)>=0&&jo(e,e.prev,t)>=0:jo(e,t,e.prev)<0||jo(e,e.next,t)<0}function Xo(e,t){var i=new Jo(e.i,e.x,e.y),r=new Jo(t.i,t.x,t.y),n=e.next,a=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,a.next=r,r.prev=a,r}function Yo(e,t,i,r){var n=new Jo(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function Ko(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Jo(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Qo(e,t,i,r){for(var n=0,a=t,o=i-r;a<i;a+=r)n+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return n}function es(e,t,i,r,n){!function e(t,i,r,n,a){for(;n>r;){if(n-r>600){var o=n-r+1,s=i-r+1,l=Math.log(o),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(o-c)/o)*(s-o/2<0?-1:1);e(t,i,Math.max(r,Math.floor(i-s*c/o+u)),Math.min(n,Math.floor(i+(o-s)*c/o+u)),a)}var h=t[i],p=r,d=n;for(ts(t,r,i),a(t[n],h)>0&&ts(t,r,n);p<d;){for(ts(t,p,d),p++,d--;a(t[p],h)<0;)p++;for(;a(t[d],h)>0;)d--}0===a(t[r],h)?ts(t,r,d):ts(t,++d,n),d<=i&&(r=d+1),i<=d&&(n=d-1)}}(e,t,i||0,r||e.length-1,n||is)}function ts(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}function is(e,t){return e<t?-1:e>t?1:0}function rs(e,t){var i=e.length;if(i<=1)return[e];for(var r,n,a=[],o=0;o<i;o++){var s=T(e[o]);0!==s&&(e[o].area=Math.abs(s),void 0===n&&(n=s<0),n===s<0?(r&&a.push(r),r=[e[o]]):r.push(e[o]))}if(r&&a.push(r),t>1)for(var l=0;l<a.length;l++)a[l].length<=t||(es(a[l],t,1,a[l].length-1,ns),a[l]=a[l].slice(0,t));return a}function ns(e,t){return t.area-e.area}function as(e,t,i){for(var r=i.patternDependencies,n=!1,a=0,o=t;a<o.length;a+=1){var s=o[a].paint.get(e+"-pattern");s.isConstant()||(n=!0);var l=s.constantOr(null);l&&(n=!0,r[l.to]=!0,r[l.from]=!0)}return n}function os(e,t,i,r,n){for(var a=n.patternDependencies,o=0,s=t;o<s.length;o+=1){var l=s[o],c=l.paint.get(e+"-pattern").value;if("constant"!==c.kind){var u=c.evaluate({zoom:r-1},i,{},n.availableImages),h=c.evaluate({zoom:r},i,{},n.availableImages),p=c.evaluate({zoom:r+1},i,{},n.availableImages);h=h&&h.name?h.name:h,p=p&&p.name?p.name:p,a[u=u&&u.name?u.name:u]=!0,a[h]=!0,a[p]=!0,i.patterns[l.id]={min:u,mid:h,max:p}}}return i}Ao.deviation=function(e,t,i,r){var n=t&&t.length,a=Math.abs(Qo(e,0,n?t[0]*i:e.length,i));if(n)for(var o=0,s=t.length;o<s;o++)a-=Math.abs(Qo(e,t[o]*i,o<s-1?t[o+1]*i:e.length,i));var l=0;for(o=0;o<r.length;o+=3){var c=r[o]*i,u=r[o+1]*i,h=r[o+2]*i;l+=Math.abs((e[c]-e[h])*(e[u+1]-e[c+1])-(e[c]-e[u])*(e[h+1]-e[c+1]))}return 0===a&&0===l?0:Math.abs((l-a)/a)},Ao.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,n=0;n<e.length;n++){for(var a=0;a<e[n].length;a++)for(var o=0;o<t;o++)i.vertices.push(e[n][a][o]);n>0&&i.holes.push(r+=e[n-1].length)}return i},Eo.default=Co;var ss=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((function(e){return e.id})),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new An,this.indexArray=new Un,this.indexArray2=new Wn,this.programConfigurations=new La(e.layers,e.zoom),this.segments=new sa,this.segments2=new sa,this.stateDependentLayerIds=this.layers.filter((function(e){return e.isStateDependent()})).map((function(e){return e.id}))};ss.prototype.populate=function(e,t,i){this.hasPattern=as("fill",this.layers,t);for(var r=this.layers[0].layout.get("fill-sort-key"),n=[],a=0,o=e;a<o.length;a+=1){var s=o[a],l=s.feature,c=s.id,u=s.index,h=s.sourceLayerIndex,p=this.layers[0]._featureFilter.needGeometry,d=Va(l,p);if(this.layers[0]._featureFilter.filter(new sn(this.zoom),d,i)){var f=r?r.evaluate(d,{},i,t.availableImages):void 0,m={id:c,properties:l.properties,type:l.type,sourceLayerIndex:h,index:u,geometry:p?d.geometry:Na(l),patterns:{},sortKey:f};n.push(m)}}r&&n.sort((function(e,t){return e.sortKey-t.sortKey}));for(var g=0,_=n;g<_.length;g+=1){var y=_[g],v=y.geometry,x=y.index,b=y.sourceLayerIndex;if(this.hasPattern){var w=os("fill",this.layers,y,this.zoom,t);this.patternFeatures.push(w)}else this.addFeature(y,v,x,i,{});t.featureIndex.insert(e[x].feature,v,x,b,this.index)}},ss.prototype.update=function(e,t,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i)},ss.prototype.addFeatures=function(e,t,i){for(var r=0,n=this.patternFeatures;r<n.length;r+=1){var a=n[r];this.addFeature(a,a.geometry,a.index,t,i)}},ss.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},ss.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ss.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,To),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0},ss.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},ss.prototype.addFeature=function(e,t,i,r,n){for(var a=0,o=rs(t,500);a<o.length;a+=1){for(var s=o[a],l=0,c=0,u=s;c<u.length;c+=1)l+=u[c].length;for(var h=this.segments.prepareSegment(l,this.layoutVertexArray,this.indexArray),p=h.vertexLength,d=[],f=[],m=0,g=s;m<g.length;m+=1){var _=g[m];if(0!==_.length){_!==s[0]&&f.push(d.length/2);var y=this.segments2.prepareSegment(_.length,this.layoutVertexArray,this.indexArray2),v=y.vertexLength;this.layoutVertexArray.emplaceBack(_[0].x,_[0].y),this.indexArray2.emplaceBack(v+_.length-1,v),d.push(_[0].x),d.push(_[0].y);for(var x=1;x<_.length;x++)this.layoutVertexArray.emplaceBack(_[x].x,_[x].y),this.indexArray2.emplaceBack(v+x-1,v+x),d.push(_[x].x),d.push(_[x].y);y.vertexLength+=_.length,y.primitiveLength+=_.length}}for(var b=Eo(d,f),w=0;w<b.length;w+=3)this.indexArray.emplaceBack(p+b[w],p+b[w+1],p+b[w+2]);h.vertexLength+=l,h.primitiveLength+=b.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,n,r)},Fr("FillBucket",ss,{omit:["layers","patternFeatures"]});var ls=new bn({"fill-sort-key":new _n(Ie.layout_fill["fill-sort-key"])}),cs={paint:new bn({"fill-antialias":new gn(Ie.paint_fill["fill-antialias"]),"fill-opacity":new _n(Ie.paint_fill["fill-opacity"]),"fill-color":new _n(Ie.paint_fill["fill-color"]),"fill-outline-color":new _n(Ie.paint_fill["fill-outline-color"]),"fill-translate":new gn(Ie.paint_fill["fill-translate"]),"fill-translate-anchor":new gn(Ie.paint_fill["fill-translate-anchor"]),"fill-pattern":new yn(Ie.paint_fill["fill-pattern"])}),layout:ls},us=function(e){function t(t){e.call(this,t,cs)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(t,i){e.prototype.recalculate.call(this,t,i);var r=this.paint._values["fill-outline-color"];"constant"===r.value.kind&&void 0===r.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},t.prototype.createBucket=function(e){return new ss(e)},t.prototype.queryRadius=function(){return to(this.paint.get("fill-translate"))},t.prototype.queryIntersectsFeature=function(e,t,i,r,n,a,o){return Ga(io(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),a.angle,o),r)},t.prototype.isTileClipped=function(){return!0},t}(wn),hs=En([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,ps=ds;function ds(e,t,i,r,n){this.properties={},this.extent=i,this.type=0,this._pbf=e,this._geometry=-1,this._keys=r,this._values=n,e.readFields(fs,this,t)}function fs(e,t,i){1==e?t.id=i.readVarint():2==e?function(e,t){for(var i=e.readVarint()+e.pos;e.pos<i;){var r=t._keys[e.readVarint()],n=t._values[e.readVarint()];t.properties[r]=n}}(i,t):3==e?t.type=i.readVarint():4==e&&(t._geometry=i.pos)}function ms(e){for(var t,i,r=0,n=0,a=e.length,o=a-1;n<a;o=n++)r+=((i=e[o]).x-(t=e[n]).x)*(t.y+i.y);return r}ds.types=["Unknown","Point","LineString","Polygon"],ds.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,i=e.readVarint()+e.pos,r=1,a=0,o=0,s=0,l=[];e.pos<i;){if(a<=0){var c=e.readVarint();r=7&c,a=c>>3}if(a--,1===r||2===r)o+=e.readSVarint(),s+=e.readSVarint(),1===r&&(t&&l.push(t),t=[]),t.push(new n(o,s));else{if(7!==r)throw new Error("unknown command "+r);t&&t.push(t[0].clone())}}return t&&l.push(t),l},ds.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,i=1,r=0,n=0,a=0,o=1/0,s=-1/0,l=1/0,c=-1/0;e.pos<t;){if(r<=0){var u=e.readVarint();i=7&u,r=u>>3}if(r--,1===i||2===i)(n+=e.readSVarint())<o&&(o=n),n>s&&(s=n),(a+=e.readSVarint())<l&&(l=a),a>c&&(c=a);else if(7!==i)throw new Error("unknown command "+i)}return[o,l,s,c]},ds.prototype.toGeoJSON=function(e,t,i){var r,n,a=this.extent*Math.pow(2,i),o=this.extent*e,s=this.extent*t,l=this.loadGeometry(),c=ds.types[this.type];function u(e){for(var t=0;t<e.length;t++){var i=e[t];e[t]=[360*(i.x+o)/a-180,360/Math.PI*Math.atan(Math.exp((180-360*(i.y+s)/a)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(r=0;r<l.length;r++)h[r]=l[r][0];u(l=h);break;case 2:for(r=0;r<l.length;r++)u(l[r]);break;case 3:for(l=function(e){var t=e.length;if(t<=1)return[e];for(var i,r,n=[],a=0;a<t;a++){var o=ms(e[a]);0!==o&&(void 0===r&&(r=o<0),r===o<0?(i&&n.push(i),i=[e[a]]):i.push(e[a]))}return i&&n.push(i),n}(l),r=0;r<l.length;r++)for(n=0;n<l[r].length;n++)u(l[r][n])}1===l.length?l=l[0]:c="Multi"+c;var p={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(p.id=this.id),p};var gs=_s;function _s(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(ys,this,t),this.length=this._features.length}function ys(e,t,i){15===e?t.version=i.readVarint():1===e?t.name=i.readString():5===e?t.extent=i.readVarint():2===e?t._features.push(i.pos):3===e?t._keys.push(i.readString()):4===e&&t._values.push(function(e){for(var t=null,i=e.readVarint()+e.pos;e.pos<i;){var r=e.readVarint()>>3;t=1===r?e.readString():2===r?e.readFloat():3===r?e.readDouble():4===r?e.readVarint64():5===r?e.readVarint():6===r?e.readSVarint():7===r?e.readBoolean():null}return t}(i))}function vs(e,t,i){if(3===e){var r=new gs(i,i.readVarint()+i.pos);r.length&&(t[r.name]=r)}}_s.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new ps(this._pbf,t,this.extent,this._keys,this._values)};var xs={VectorTile:function(e,t){this.layers=e.readFields(vs,{},t)},VectorTileFeature:ps,VectorTileLayer:gs},bs=xs.VectorTileFeature.types,ws=Math.pow(2,13);function Ss(e,t,i,r,n,a,o,s){e.emplaceBack(t,i,2*Math.floor(r*ws)+o,n*ws*2,a*ws*2,Math.round(s))}var Ms=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((function(e){return e.id})),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Pn,this.indexArray=new Un,this.programConfigurations=new La(e.layers,e.zoom),this.segments=new sa,this.stateDependentLayerIds=this.layers.filter((function(e){return e.isStateDependent()})).map((function(e){return e.id}))};function Ts(e,t){return e.x===t.x&&(e.x<0||e.x>8192)||e.y===t.y&&(e.y<0||e.y>8192)}Ms.prototype.populate=function(e,t,i){this.features=[],this.hasPattern=as("fill-extrusion",this.layers,t);for(var r=0,n=e;r<n.length;r+=1){var a=n[r],o=a.feature,s=a.id,l=a.index,c=a.sourceLayerIndex,u=this.layers[0]._featureFilter.needGeometry,h=Va(o,u);if(this.layers[0]._featureFilter.filter(new sn(this.zoom),h,i)){var p={id:s,sourceLayerIndex:c,index:l,geometry:u?h.geometry:Na(o),properties:o.properties,type:o.type,patterns:{}};this.hasPattern?this.features.push(os("fill-extrusion",this.layers,p,this.zoom,t)):this.addFeature(p,p.geometry,l,i,{}),t.featureIndex.insert(o,p.geometry,l,c,this.index,!0)}}},Ms.prototype.addFeatures=function(e,t,i){for(var r=0,n=this.features;r<n.length;r+=1){var a=n[r];this.addFeature(a,a.geometry,a.index,t,i)}},Ms.prototype.update=function(e,t,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i)},Ms.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Ms.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ms.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,hs),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Ms.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ms.prototype.addFeature=function(e,t,i,r,n){for(var a=0,o=rs(t,500);a<o.length;a+=1){for(var s=o[a],l=0,c=0,u=s;c<u.length;c+=1)l+=u[c].length;for(var h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),p=0,d=s;p<d.length;p+=1){var f=d[p];if(0!==f.length&&!((R=f).every((function(e){return e.x<0}))||R.every((function(e){return e.x>8192}))||R.every((function(e){return e.y<0}))||R.every((function(e){return e.y>8192}))))for(var m=0,g=0;g<f.length;g++){var _=f[g];if(g>=1){var y=f[g-1];if(!Ts(_,y)){h.vertexLength+4>sa.MAX_VERTEX_ARRAY_LENGTH&&(h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var v=_.sub(y)._perp()._unit(),x=y.dist(_);m+x>32768&&(m=0),Ss(this.layoutVertexArray,_.x,_.y,v.x,v.y,0,0,m),Ss(this.layoutVertexArray,_.x,_.y,v.x,v.y,0,1,m),Ss(this.layoutVertexArray,y.x,y.y,v.x,v.y,0,0,m+=x),Ss(this.layoutVertexArray,y.x,y.y,v.x,v.y,0,1,m);var b=h.vertexLength;this.indexArray.emplaceBack(b,b+2,b+1),this.indexArray.emplaceBack(b+1,b+2,b+3),h.vertexLength+=4,h.primitiveLength+=2}}}}if(h.vertexLength+l>sa.MAX_VERTEX_ARRAY_LENGTH&&(h=this.segments.prepareSegment(l,this.layoutVertexArray,this.indexArray)),"Polygon"===bs[e.type]){for(var w=[],S=[],M=h.vertexLength,T=0,E=s;T<E.length;T+=1){var C=E[T];if(0!==C.length){C!==s[0]&&S.push(w.length/2);for(var A=0;A<C.length;A++){var I=C[A];Ss(this.layoutVertexArray,I.x,I.y,0,0,1,1,0),w.push(I.x),w.push(I.y)}}}for(var P=Eo(w,S),z=0;z<P.length;z+=3)this.indexArray.emplaceBack(M+P[z],M+P[z+2],M+P[z+1]);h.primitiveLength+=P.length/3,h.vertexLength+=l}}var R;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,n,r)},Fr("FillExtrusionBucket",Ms,{omit:["layers","features"]});var Es={paint:new bn({"fill-extrusion-opacity":new gn(Ie["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new _n(Ie["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new gn(Ie["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new gn(Ie["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new yn(Ie["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new _n(Ie["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new _n(Ie["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new gn(Ie["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Cs=function(e){function t(t){e.call(this,t,Es)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(e){return new Ms(e)},t.prototype.queryRadius=function(){return to(this.paint.get("fill-extrusion-translate"))},t.prototype.is3D=function(){return!0},t.prototype.queryIntersectsFeature=function(e,t,i,r,a,o,s,l){var c=io(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),o.angle,s),u=this.paint.get("fill-extrusion-height").evaluate(t,i),h=this.paint.get("fill-extrusion-base").evaluate(t,i),p=function(e,t,i,r){for(var a=[],o=0,s=e;o<s.length;o+=1){var l=s[o],c=[l.x,l.y,0,1];uo(c,c,t),a.push(new n(c[0]/c[3],c[1]/c[3]))}return a}(c,l),d=function(e,t,i,r){for(var a=[],o=[],s=r[8]*t,l=r[9]*t,c=r[10]*t,u=r[11]*t,h=r[8]*i,p=r[9]*i,d=r[10]*i,f=r[11]*i,m=0,g=e;m<g.length;m+=1){for(var _=[],y=[],v=0,x=g[m];v<x.length;v+=1){var b=x[v],w=b.x,S=b.y,M=r[0]*w+r[4]*S+r[12],T=r[1]*w+r[5]*S+r[13],E=r[2]*w+r[6]*S+r[14],C=r[3]*w+r[7]*S+r[15],A=E+c,I=C+u,P=M+h,z=T+p,R=E+d,k=C+f,L=new n((M+s)/I,(T+l)/I);L.z=A/I,_.push(L);var D=new n(P/k,z/k);D.z=R/k,y.push(D)}a.push(_),o.push(y)}return[a,o]}(r,h,u,l);return function(e,t,i){var r=1/0;Ga(i,t)&&(r=Is(i,t[0]));for(var n=0;n<t.length;n++)for(var a=t[n],o=e[n],s=0;s<a.length-1;s++){var l=a[s],c=[l,a[s+1],o[s+1],o[s],l];ja(i,c)&&(r=Math.min(r,Is(i,c)))}return r!==1/0&&r}(d[0],d[1],p)},t}(wn);function As(e,t){return e.x*t.x+e.y*t.y}function Is(e,t){if(1===e.length){for(var i,r=0,n=t[r++];!i||n.equals(i);)if(!(i=t[r++]))return 1/0;for(;r<t.length;r++){var a=t[r],o=e[0],s=i.sub(n),l=a.sub(n),c=o.sub(n),u=As(s,s),h=As(s,l),p=As(l,l),d=As(c,s),f=As(c,l),m=u*p-h*h,g=(p*d-h*f)/m,_=(u*f-h*d)/m,y=n.z*(1-g-_)+i.z*g+a.z*_;if(isFinite(y))return y}return 1/0}for(var v=1/0,x=0,b=t;x<b.length;x+=1)v=Math.min(v,b[x].z);return v}var Ps=En([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,zs=En([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Rs=xs.VectorTileFeature.types,ks=Math.cos(Math.PI/180*37.5),Ls=Math.pow(2,14)/.5,Ds=function(e){var t=this;this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((function(e){return e.id})),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((function(e){t.gradients[e.id]={}})),this.layoutVertexArray=new zn,this.layoutVertexArray2=new Rn,this.indexArray=new Un,this.programConfigurations=new La(e.layers,e.zoom),this.segments=new sa,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((function(e){return e.isStateDependent()})).map((function(e){return e.id}))};Ds.prototype.populate=function(e,t,i){this.hasPattern=as("line",this.layers,t);for(var r=this.layers[0].layout.get("line-sort-key"),n=[],a=0,o=e;a<o.length;a+=1){var s=o[a],l=s.feature,c=s.id,u=s.index,h=s.sourceLayerIndex,p=this.layers[0]._featureFilter.needGeometry,d=Va(l,p);if(this.layers[0]._featureFilter.filter(new sn(this.zoom),d,i)){var f=r?r.evaluate(d,{},i):void 0,m={id:c,properties:l.properties,type:l.type,sourceLayerIndex:h,index:u,geometry:p?d.geometry:Na(l),patterns:{},sortKey:f};n.push(m)}}r&&n.sort((function(e,t){return e.sortKey-t.sortKey}));for(var g=0,_=n;g<_.length;g+=1){var y=_[g],v=y.geometry,x=y.index,b=y.sourceLayerIndex;if(this.hasPattern){var w=os("line",this.layers,y,this.zoom,t);this.patternFeatures.push(w)}else this.addFeature(y,v,x,i,{});t.featureIndex.insert(e[x].feature,v,x,b,this.index)}},Ds.prototype.update=function(e,t,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i)},Ds.prototype.addFeatures=function(e,t,i){for(var r=0,n=this.patternFeatures;r<n.length;r+=1){var a=n[r];this.addFeature(a,a.geometry,a.index,t,i)}},Ds.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Ds.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ds.prototype.upload=function(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,zs)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ps),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Ds.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ds.prototype.lineFeatureClips=function(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}},Ds.prototype.addFeature=function(e,t,i,r,n){var a=this.layers[0].layout,o=a.get("line-join").evaluate(e,{}),s=a.get("line-cap"),l=a.get("line-miter-limit"),c=a.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(var u=0,h=t;u<h.length;u+=1)this.addLine(h[u],e,o,s,l,c);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,n,r)},Ds.prototype.addLine=function(e,t,i,r,n,a){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var o=0;o<e.length-1;o++)this.totalDistance+=e[o].dist(e[o+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var s="Polygon"===Rs[t.type],l=e.length;l>=2&&e[l-1].equals(e[l-2]);)l--;for(var c=0;c<l-1&&e[c].equals(e[c+1]);)c++;if(!(l<(s?3:2))){"bevel"===i&&(n=1.05);var u,h=this.overscaling<=16?122880/(512*this.overscaling):0,p=this.segments.prepareSegment(10*l,this.layoutVertexArray,this.indexArray),d=void 0,f=void 0,m=void 0,g=void 0;this.e1=this.e2=-1,s&&(g=e[c].sub(u=e[l-2])._unit()._perp());for(var _=c;_<l;_++)if(!(f=_===l-1?s?e[c+1]:void 0:e[_+1])||!e[_].equals(f)){g&&(m=g),u&&(d=u),u=e[_],g=f?f.sub(u)._unit()._perp():m;var y=(m=m||g).add(g);0===y.x&&0===y.y||y._unit();var v=m.x*g.x+m.y*g.y,x=y.x*g.x+y.y*g.y,b=0!==x?1/x:1/0,w=2*Math.sqrt(2-2*x),S=x<ks&&d&&f,M=m.x*g.y-m.y*g.x>0;if(S&&_>c){var T=u.dist(d);if(T>2*h){var E=u.sub(u.sub(d)._mult(h/T)._round());this.updateDistance(d,E),this.addCurrentVertex(E,m,0,0,p),d=E}}var C=d&&f,A=C?i:s?"butt":r;if(C&&"round"===A&&(b<a?A="miter":b<=2&&(A="fakeround")),"miter"===A&&b>n&&(A="bevel"),"bevel"===A&&(b>2&&(A="flipbevel"),b<n&&(A="miter")),d&&this.updateDistance(d,u),"miter"===A)y._mult(b),this.addCurrentVertex(u,y,0,0,p);else if("flipbevel"===A){if(b>100)y=g.mult(-1);else{var I=b*m.add(g).mag()/m.sub(g).mag();y._perp()._mult(I*(M?-1:1))}this.addCurrentVertex(u,y,0,0,p),this.addCurrentVertex(u,y.mult(-1),0,0,p)}else if("bevel"===A||"fakeround"===A){var P=-Math.sqrt(b*b-1),z=M?P:0,R=M?0:P;if(d&&this.addCurrentVertex(u,m,z,R,p),"fakeround"===A)for(var k=Math.round(180*w/Math.PI/20),L=1;L<k;L++){var D=L/k;if(.5!==D){var B=D-.5;D+=D*B*(D-1)*((1.0904+v*(v*(3.55645-1.43519*v)-3.2452))*B*B+(.848013+v*(.215638*v-1.06021)))}var F=g.sub(m)._mult(D)._add(m)._unit()._mult(M?-1:1);this.addHalfVertex(u,F.x,F.y,!1,M,0,p)}f&&this.addCurrentVertex(u,g,-z,-R,p)}else if("butt"===A)this.addCurrentVertex(u,y,0,0,p);else if("square"===A){var O=d?1:-1;this.addCurrentVertex(u,y,O,O,p)}else"round"===A&&(d&&(this.addCurrentVertex(u,m,0,0,p),this.addCurrentVertex(u,m,1,1,p,!0)),f&&(this.addCurrentVertex(u,g,-1,-1,p,!0),this.addCurrentVertex(u,g,0,0,p)));if(S&&_<l-1){var N=u.dist(f);if(N>2*h){var V=u.add(f.sub(u)._mult(h/N)._round());this.updateDistance(u,V),this.addCurrentVertex(V,g,0,0,p),u=V}}}}},Ds.prototype.addCurrentVertex=function(e,t,i,r,n,a){void 0===a&&(a=!1);var o=t.y*r-t.x,s=-t.y-t.x*r;this.addHalfVertex(e,t.x+t.y*i,t.y-t.x*i,a,!1,i,n),this.addHalfVertex(e,o,s,a,!0,-r,n),this.distance>Ls/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(e,t,i,r,n,a))},Ds.prototype.addHalfVertex=function(e,t,i,r,n,a,o){var s=.5*(this.lineClips?this.scaledDistance*(Ls-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e.x<<1)+(r?1:0),(e.y<<1)+(n?1:0),Math.round(63*t)+128,Math.round(63*i)+128,1+(0===a?0:a<0?-1:1)|(63&s)<<2,s>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var l=o.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,l),o.primitiveLength++),n?this.e2=l:this.e1=l},Ds.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Ds.prototype.updateDistance=function(e,t){this.distance+=e.dist(t),this.updateScaledDistance()},Fr("LineBucket",Ds,{omit:["layers","patternFeatures"]});var Bs=new bn({"line-cap":new gn(Ie.layout_line["line-cap"]),"line-join":new _n(Ie.layout_line["line-join"]),"line-miter-limit":new gn(Ie.layout_line["line-miter-limit"]),"line-round-limit":new gn(Ie.layout_line["line-round-limit"]),"line-sort-key":new _n(Ie.layout_line["line-sort-key"])}),Fs={paint:new bn({"line-opacity":new _n(Ie.paint_line["line-opacity"]),"line-color":new _n(Ie.paint_line["line-color"]),"line-translate":new gn(Ie.paint_line["line-translate"]),"line-translate-anchor":new gn(Ie.paint_line["line-translate-anchor"]),"line-width":new _n(Ie.paint_line["line-width"]),"line-gap-width":new _n(Ie.paint_line["line-gap-width"]),"line-offset":new _n(Ie.paint_line["line-offset"]),"line-blur":new _n(Ie.paint_line["line-blur"]),"line-dasharray":new vn(Ie.paint_line["line-dasharray"]),"line-pattern":new yn(Ie.paint_line["line-pattern"]),"line-gradient":new xn(Ie.paint_line["line-gradient"])}),layout:Bs},Os=new(function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(t,i){return i=new sn(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),e.prototype.possiblyEvaluate.call(this,t,i)},t.prototype.evaluate=function(t,i,r,n){return i=p({},i,{zoom:Math.floor(i.zoom)}),e.prototype.evaluate.call(this,t,i,r,n)},t}(_n))(Fs.paint.properties["line-width"].specification);Os.useIntegerZoom=!0;var Ns=function(e){function t(t){e.call(this,t,Fs),this.gradientVersion=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._handleSpecialPaintPropertyUpdate=function(e){"line-gradient"===e&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof jt,this.gradientVersion=(this.gradientVersion+1)%s)},t.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},t.prototype.recalculate=function(t,i){e.prototype.recalculate.call(this,t,i),this.paint._values["line-floorwidth"]=Os.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)},t.prototype.createBucket=function(e){return new Ds(e)},t.prototype.queryRadius=function(e){var t=e,i=Vs(eo("line-width",this,t),eo("line-gap-width",this,t)),r=eo("line-offset",this,t);return i/2+Math.abs(r)+to(this.paint.get("line-translate"))},t.prototype.queryIntersectsFeature=function(e,t,i,r,a,o,s){var l=io(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,s),c=s/2*Vs(this.paint.get("line-width").evaluate(t,i),this.paint.get("line-gap-width").evaluate(t,i)),u=this.paint.get("line-offset").evaluate(t,i);return u&&(r=function(e,t){for(var i=[],r=new n(0,0),a=0;a<e.length;a++){for(var o=e[a],s=[],l=0;l<o.length;l++){var c=o[l],u=o[l+1],h=0===l?r:c.sub(o[l-1])._unit()._perp(),p=l===o.length-1?r:u.sub(c)._unit()._perp(),d=h._add(p)._unit();d._mult(1/(d.x*p.x+d.y*p.y)),s.push(d._mult(t)._add(c))}i.push(s)}return i}(r,u*s)),function(e,t,i){for(var r=0;r<t.length;r++){var n=t[r];if(e.length>=3)for(var a=0;a<n.length;a++)if(Ja(e,n[a]))return!0;if(Ha(e,n,i))return!0}return!1}(l,r,c)},t.prototype.isTileClipped=function(){return!0},t}(wn);function Vs(e,t){return t>0?t+2*e:e}var Us=En([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),$s=En([{name:"a_projected_pos",components:3,type:"Float32"}],4),js=(En([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),En([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),qs=(En([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),En([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Gs=En([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Hs(e,t,i){return e.sections.forEach((function(e){e.text=function(e,t,i){var r=t.layout.get("text-transform").evaluate(i,{});return"uppercase"===r?e=e.toLocaleUpperCase():"lowercase"===r&&(e=e.toLocaleLowerCase()),on.applyArabicShaping&&(e=on.applyArabicShaping(e)),e}(e.text,t,i)})),e}En([{name:"triangle",components:3,type:"Uint16"}]),En([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),En([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),En([{type:"Float32",name:"offsetX"}]),En([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Ws={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"},Zs=function(e,t,i,r,n){var a,o,s=8*n-r-1,l=(1<<s)-1,c=l>>1,u=-7,h=i?n-1:0,p=i?-1:1,d=e[t+h];for(h+=p,a=d&(1<<-u)-1,d>>=-u,u+=s;u>0;a=256*a+e[t+h],h+=p,u-=8);for(o=a&(1<<-u)-1,a>>=-u,u+=r;u>0;o=256*o+e[t+h],h+=p,u-=8);if(0===a)a=1-c;else{if(a===l)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,r),a-=c}return(d?-1:1)*o*Math.pow(2,a-r)},Xs=function(e,t,i,r,n,a){var o,s,l,c=8*a-n-1,u=(1<<c)-1,h=u>>1,p=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:a-1,f=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+h>=1?p/l:p*Math.pow(2,1-h))*l>=2&&(o++,l/=2),o+h>=u?(s=0,o=u):o+h>=1?(s=(t*l-1)*Math.pow(2,n),o+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,n),o=0));n>=8;e[i+d]=255&s,d+=f,s/=256,n-=8);for(o=o<<n|s,c+=n;c>0;e[i+d]=255&o,d+=f,o/=256,c-=8);e[i+d-f]|=128*m},Ys=Ks;function Ks(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Ks.Varint=0,Ks.Fixed64=1,Ks.Bytes=2,Ks.Fixed32=5;var Js="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Qs(e){return e.type===Ks.Bytes?e.readVarint()+e.pos:e.pos+1}function el(e,t,i){return i?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function tl(e,t,i){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(r);for(var n=i.pos-1;n>=e;n--)i.buf[n+r]=i.buf[n]}function il(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function rl(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function nl(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function al(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function ol(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function sl(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function ll(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function cl(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function ul(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function hl(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function pl(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function dl(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function fl(e,t,i){1===e&&i.readMessage(ml,t)}function ml(e,t,i){if(3===e){var r=i.readMessage(gl,{}),n=r.width,a=r.height,o=r.left,s=r.top,l=r.advance;t.push({id:r.id,bitmap:new yo({width:n+6,height:a+6},r.bitmap),metrics:{width:n,height:a,left:o,top:s,advance:l}})}}function gl(e,t,i){1===e?t.id=i.readVarint():2===e?t.bitmap=i.readBytes():3===e?t.width=i.readVarint():4===e?t.height=i.readVarint():5===e?t.left=i.readSVarint():6===e?t.top=i.readSVarint():7===e&&(t.advance=i.readVarint())}function _l(e){for(var t=0,i=0,r=0,n=e;r<n.length;r+=1){var a=n[r];t+=a.w*a.h,i=Math.max(i,a.w)}e.sort((function(e,t){return t.h-e.h}));for(var o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}],s=0,l=0,c=0,u=e;c<u.length;c+=1)for(var h=u[c],p=o.length-1;p>=0;p--){var d=o[p];if(!(h.w>d.w||h.h>d.h)){if(h.x=d.x,h.y=d.y,l=Math.max(l,h.y+h.h),s=Math.max(s,h.x+h.w),h.w===d.w&&h.h===d.h){var f=o.pop();p<o.length&&(o[p]=f)}else h.h===d.h?(d.x+=h.w,d.w-=h.w):h.w===d.w?(d.y+=h.h,d.h-=h.h):(o.push({x:d.x+h.w,y:d.y,w:d.w-h.w,h:h.h}),d.y+=h.h,d.h-=h.h);break}}return{w:s,h:l,fill:t/(s*l)||0}}Ks.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,a=this.pos;this.type=7&r,e(n,t,this),this.pos===a&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=hl(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=dl(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=hl(this.buf,this.pos)+4294967296*hl(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=hl(this.buf,this.pos)+4294967296*dl(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=Zs(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Zs(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,i,r=this.buf;return t=127&(i=r[this.pos++]),i<128?t:(t|=(127&(i=r[this.pos++]))<<7,i<128?t:(t|=(127&(i=r[this.pos++]))<<14,i<128?t:(t|=(127&(i=r[this.pos++]))<<21,i<128?t:function(e,t,i){var r,n,a=i.buf;if(r=(112&(n=a[i.pos++]))>>4,n<128)return el(e,r,t);if(r|=(127&(n=a[i.pos++]))<<3,n<128)return el(e,r,t);if(r|=(127&(n=a[i.pos++]))<<10,n<128)return el(e,r,t);if(r|=(127&(n=a[i.pos++]))<<17,n<128)return el(e,r,t);if(r|=(127&(n=a[i.pos++]))<<24,n<128)return el(e,r,t);if(r|=(1&(n=a[i.pos++]))<<31,n<128)return el(e,r,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=r[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&Js?function(e,t,i){return Js.decode(e.subarray(t,i))}(this.buf,t,e):function(e,t,i){for(var r="",n=t;n<i;){var a,o,s,l=e[n],c=null,u=l>239?4:l>223?3:l>191?2:1;if(n+u>i)break;1===u?l<128&&(c=l):2===u?128==(192&(a=e[n+1]))&&(c=(31&l)<<6|63&a)<=127&&(c=null):3===u?(o=e[n+2],128==(192&(a=e[n+1]))&&128==(192&o)&&((c=(15&l)<<12|(63&a)<<6|63&o)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(o=e[n+2],s=e[n+3],128==(192&(a=e[n+1]))&&128==(192&o)&&128==(192&s)&&((c=(15&l)<<18|(63&a)<<12|(63&o)<<6|63&s)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,r+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),r+=String.fromCharCode(c),n+=u}return r}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==Ks.Bytes)return e.push(this.readVarint(t));var i=Qs(this);for(e=e||[];this.pos<i;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==Ks.Bytes)return e.push(this.readSVarint());var t=Qs(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==Ks.Bytes)return e.push(this.readBoolean());var t=Qs(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==Ks.Bytes)return e.push(this.readFloat());var t=Qs(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==Ks.Bytes)return e.push(this.readDouble());var t=Qs(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==Ks.Bytes)return e.push(this.readFixed32());var t=Qs(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==Ks.Bytes)return e.push(this.readSFixed32());var t=Qs(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==Ks.Bytes)return e.push(this.readFixed64());var t=Qs(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==Ks.Bytes)return e.push(this.readSFixed64());var t=Qs(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===Ks.Varint)for(;this.buf[this.pos++]>127;);else if(t===Ks.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Ks.Fixed32)this.pos+=4;else{if(t!==Ks.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),pl(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),pl(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),pl(this.buf,-1&e,this.pos),pl(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),pl(this.buf,-1&e,this.pos),pl(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var i,r;if(e>=0?(i=e%4294967296|0,r=e/4294967296|0):(r=~(-e/4294967296),4294967295^(i=~(-e%4294967296))?i=i+1|0:(i=0,r=r+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,i){i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,i.buf[i.pos]=127&(e>>>=7)}(i,0,t),function(e,t){var i=(7&e)<<4;t.buf[t.pos++]|=i|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(r,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,i){for(var r,n,a=0;a<t.length;a++){if((r=t.charCodeAt(a))>55295&&r<57344){if(!n){r>56319||a+1===t.length?(e[i++]=239,e[i++]=191,e[i++]=189):n=r;continue}if(r<56320){e[i++]=239,e[i++]=191,e[i++]=189,n=r;continue}r=n-55296<<10|r-56320|65536,n=null}else n&&(e[i++]=239,e[i++]=191,e[i++]=189,n=null);r<128?e[i++]=r:(r<2048?e[i++]=r>>6|192:(r<65536?e[i++]=r>>12|224:(e[i++]=r>>18|240,e[i++]=r>>12&63|128),e[i++]=r>>6&63|128),e[i++]=63&r|128)}return i}(this.buf,e,this.pos);var i=this.pos-t;i>=128&&tl(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(e){this.realloc(4),Xs(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),Xs(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var r=this.pos-i;r>=128&&tl(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,i){this.writeTag(e,Ks.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,il,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,rl,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,ol,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,nl,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,al,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,sl,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,ll,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,cl,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,ul,t)},writeBytesField:function(e,t){this.writeTag(e,Ks.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,Ks.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,Ks.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,Ks.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,Ks.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,Ks.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,Ks.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,Ks.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,Ks.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,Ks.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var yl=function(e,t){var i=t.pixelRatio,r=t.version,n=t.stretchX,a=t.stretchY,o=t.content;this.paddedRect=e,this.pixelRatio=i,this.stretchX=n,this.stretchY=a,this.content=o,this.version=r},vl={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};vl.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},vl.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},vl.tlbr.get=function(){return this.tl.concat(this.br)},vl.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(yl.prototype,vl);var xl=function(e,t){var i={},r={};this.haveRenderCallbacks=[];var n=[];this.addImages(e,i,n),this.addImages(t,r,n);var a=_l(n),o=new vo({width:a.w||1,height:a.h||1});for(var s in e){var l=e[s],c=i[s].paddedRect;vo.copy(l.data,o,{x:0,y:0},{x:c.x+1,y:c.y+1},l.data)}for(var u in t){var h=t[u],p=r[u].paddedRect,d=p.x+1,f=p.y+1,m=h.data.width,g=h.data.height;vo.copy(h.data,o,{x:0,y:0},{x:d,y:f},h.data),vo.copy(h.data,o,{x:0,y:g-1},{x:d,y:f-1},{width:m,height:1}),vo.copy(h.data,o,{x:0,y:0},{x:d,y:f+g},{width:m,height:1}),vo.copy(h.data,o,{x:m-1,y:0},{x:d-1,y:f},{width:1,height:g}),vo.copy(h.data,o,{x:0,y:0},{x:d+m,y:f},{width:1,height:g})}this.image=o,this.iconPositions=i,this.patternPositions=r};xl.prototype.addImages=function(e,t,i){for(var r in e){var n=e[r],a={x:0,y:0,w:n.data.width+2,h:n.data.height+2};i.push(a),t[r]=new yl(a,n),n.hasRenderCallback&&this.haveRenderCallbacks.push(r)}},xl.prototype.patchUpdatedImages=function(e,t){for(var i in e.dispatchRenderCallbacks(this.haveRenderCallbacks),e.updatedImages)this.patchUpdatedImage(this.iconPositions[i],e.getImage(i),t),this.patchUpdatedImage(this.patternPositions[i],e.getImage(i),t)},xl.prototype.patchUpdatedImage=function(e,t,i){if(e&&t&&e.version!==t.version){e.version=t.version;var r=e.tl;i.update(t.data,void 0,{x:r[0],y:r[1]})}},Fr("ImagePosition",yl),Fr("ImageAtlas",xl);var bl={horizontal:1,vertical:2,horizontalOnly:3},wl=function(){this.scale=1,this.fontStack="",this.imageName=null};wl.forText=function(e,t){var i=new wl;return i.scale=e||1,i.fontStack=t,i},wl.forImage=function(e){var t=new wl;return t.imageName=e,t};var Sl=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Ml(e,t,i,r,n,a,o,s,l,c,u,h,p,d,f,m){var g,_=Sl.fromFeature(e,n);h===bl.vertical&&_.verticalizePunctuation();var y=on.processBidirectionalText,v=on.processStyledBidirectionalText;if(y&&1===_.sections.length){g=[];for(var x=0,b=y(_.toString(),zl(_,c,a,t,r,d,f));x<b.length;x+=1){var w=b[x],S=new Sl;S.text=w,S.sections=_.sections;for(var M=0;M<w.length;M++)S.sectionIndex.push(0);g.push(S)}}else if(v){g=[];for(var T=0,E=v(_.text,_.sectionIndex,zl(_,c,a,t,r,d,f));T<E.length;T+=1){var C=E[T],A=new Sl;A.text=C[0],A.sectionIndex=C[1],A.sections=_.sections,g.push(A)}}else g=function(e,t){for(var i=[],r=e.text,n=0,a=0,o=t;a<o.length;a+=1){var s=o[a];i.push(e.substring(n,s)),n=s}return n<r.length&&i.push(e.substring(n,r.length)),i}(_,zl(_,c,a,t,r,d,f));var I=[],P={positionedLines:I,text:_.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:h,iconsInText:!1,verticalizable:!1};return function(e,t,i,r,n,a,o,s,l,c,u,h){for(var p=0,d=-17,f=0,m=0,g="right"===s?1:"left"===s?0:.5,_=0,y=0,v=n;y<v.length;y+=1){var x=v[y];x.trim();var b=x.getMaxScale(),w=24*(b-1),S={positionedGlyphs:[],lineOffset:0};e.positionedLines[_]=S;var M=S.positionedGlyphs,T=0;if(x.length()){for(var E=0;E<x.length();E++){var C=x.getSection(E),A=x.getSectionIndex(E),I=x.getCharCode(E),P=0,z=null,R=null,k=null,L=24,D=!(l===bl.horizontal||!u&&!Hr(I)||u&&(Tl[I]||(q=I,qr.Arabic(q)||qr["Arabic Supplement"](q)||qr["Arabic Extended-A"](q)||qr["Arabic Presentation Forms-A"](q)||qr["Arabic Presentation Forms-B"](q))));if(C.imageName){var B=r[C.imageName];if(!B)continue;k=C.imageName,e.iconsInText=e.iconsInText||!0,R=B.paddedRect;var F=B.displaySize;C.scale=24*C.scale/h,P=w+(24-F[1]*C.scale),L=(z={width:F[0],height:F[1],left:1,top:-3,advance:D?F[1]:F[0]}).advance;var O=D?F[0]*C.scale-24*b:F[1]*C.scale-24*b;O>0&&O>T&&(T=O)}else{var N=i[C.fontStack],V=N&&N[I];if(V&&V.rect)R=V.rect,z=V.metrics;else{var U=t[C.fontStack],$=U&&U[I];if(!$)continue;z=$.metrics}P=24*(b-C.scale)}D?(e.verticalizable=!0,M.push({glyph:I,imageName:k,x:p,y:d+P,vertical:D,scale:C.scale,fontStack:C.fontStack,sectionIndex:A,metrics:z,rect:R}),p+=L*C.scale+c):(M.push({glyph:I,imageName:k,x:p,y:d+P,vertical:D,scale:C.scale,fontStack:C.fontStack,sectionIndex:A,metrics:z,rect:R}),p+=z.advance*C.scale+c)}0!==M.length&&(f=Math.max(p-c,f),kl(M,0,M.length-1,g,T)),p=0;var j=a*b+T;S.lineOffset=Math.max(T,w),d+=j,m=Math.max(j,m),++_}else d+=a,++_}var q,G=d- -17,H=Rl(o),W=H.horizontalAlign,Z=H.verticalAlign;(function(e,t,i,r,n,a,o,s,l){var c,u=(t-i)*n;c=a!==o?-s*r- -17:(-r*l+.5)*o;for(var h=0,p=e;h<p.length;h+=1)for(var d=0,f=p[h].positionedGlyphs;d<f.length;d+=1){var m=f[d];m.x+=u,m.y+=c}})(e.positionedLines,g,W,Z,f,m,a,G,n.length),e.top+=-Z*G,e.bottom=e.top+G,e.left+=-W*f,e.right=e.left+f}(P,t,i,r,g,o,s,l,h,c,p,m),!function(e){for(var t=0,i=e;t<i.length;t+=1)if(0!==i[t].positionedGlyphs.length)return!1;return!0}(I)&&P}Sl.fromFeature=function(e,t){for(var i=new Sl,r=0;r<e.sections.length;r++){var n=e.sections[r];n.image?i.addImageSection(n):i.addTextSection(n,t)}return i},Sl.prototype.length=function(){return this.text.length},Sl.prototype.getSection=function(e){return this.sections[this.sectionIndex[e]]},Sl.prototype.getSectionIndex=function(e){return this.sectionIndex[e]},Sl.prototype.getCharCode=function(e){return this.text.charCodeAt(e)},Sl.prototype.verticalizePunctuation=function(){this.text=function(e){for(var t="",i=0;i<e.length;i++){var r=e.charCodeAt(i+1)||null,n=e.charCodeAt(i-1)||null;t+=r&&Wr(r)&&!Ws[e[i+1]]||n&&Wr(n)&&!Ws[e[i-1]]||!Ws[e[i]]?e[i]:Ws[e[i]]}return t}(this.text)},Sl.prototype.trim=function(){for(var e=0,t=0;t<this.text.length&&Tl[this.text.charCodeAt(t)];t++)e++;for(var i=this.text.length,r=this.text.length-1;r>=0&&r>=e&&Tl[this.text.charCodeAt(r)];r--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)},Sl.prototype.substring=function(e,t){var i=new Sl;return i.text=this.text.substring(e,t),i.sectionIndex=this.sectionIndex.slice(e,t),i.sections=this.sections,i},Sl.prototype.toString=function(){return this.text},Sl.prototype.getMaxScale=function(){var e=this;return this.sectionIndex.reduce((function(t,i){return Math.max(t,e.sections[i].scale)}),0)},Sl.prototype.addTextSection=function(e,t){this.text+=e.text,this.sections.push(wl.forText(e.scale,e.fontStack||t));for(var i=this.sections.length-1,r=0;r<e.text.length;++r)this.sectionIndex.push(i)},Sl.prototype.addImageSection=function(e){var t=e.image?e.image.name:"";if(0!==t.length){var i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCharCode(i),this.sections.push(wl.forImage(t)),this.sectionIndex.push(this.sections.length-1)):S("Reached maximum number of images 6401")}else S("Can't add FormattedSection with an empty image.")},Sl.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Tl={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},El={};function Cl(e,t,i,r,n,a){if(t.imageName){var o=r[t.imageName];return o?o.displaySize[0]*t.scale*24/a+n:0}var s=i[t.fontStack],l=s&&s[e];return l?l.metrics.advance*t.scale+n:0}function Al(e,t,i,r){var n=Math.pow(e-t,2);return r?e<t?n/2:2*n:n+Math.abs(i)*i}function Il(e,t,i){var r=0;return 10===e&&(r-=1e4),i&&(r+=150),40!==e&&65288!==e||(r+=50),41!==t&&65289!==t||(r+=50),r}function Pl(e,t,i,r,n,a){for(var o=null,s=Al(t,i,n,a),l=0,c=r;l<c.length;l+=1){var u=c[l],h=Al(t-u.x,i,n,a)+u.badness;h<=s&&(o=u,s=h)}return{index:e,x:t,priorBreak:o,badness:s}}function zl(e,t,i,r,n,a,o){if("point"!==a)return[];if(!e)return[];for(var s,l=[],c=function(e,t,i,r,n,a){for(var o=0,s=0;s<e.length();s++){var l=e.getSection(s);o+=Cl(e.getCharCode(s),l,r,n,t,a)}return o/Math.max(1,Math.ceil(o/i))}(e,t,i,r,n,o),u=e.text.indexOf("\u200b")>=0,h=0,p=0;p<e.length();p++){var d=e.getSection(p),f=e.getCharCode(p);if(Tl[f]||(h+=Cl(f,d,r,n,t,o)),p<e.length()-1){var m=!((s=f)<11904||!(qr["Bopomofo Extended"](s)||qr.Bopomofo(s)||qr["CJK Compatibility Forms"](s)||qr["CJK Compatibility Ideographs"](s)||qr["CJK Compatibility"](s)||qr["CJK Radicals Supplement"](s)||qr["CJK Strokes"](s)||qr["CJK Symbols and Punctuation"](s)||qr["CJK Unified Ideographs Extension A"](s)||qr["CJK Unified Ideographs"](s)||qr["Enclosed CJK Letters and Months"](s)||qr["Halfwidth and Fullwidth Forms"](s)||qr.Hiragana(s)||qr["Ideographic Description Characters"](s)||qr["Kangxi Radicals"](s)||qr["Katakana Phonetic Extensions"](s)||qr.Katakana(s)||qr["Vertical Forms"](s)||qr["Yi Radicals"](s)||qr["Yi Syllables"](s)));(El[f]||m||d.imageName)&&l.push(Pl(p+1,h,c,l,Il(f,e.getCharCode(p+1),m&&u),!1))}}return function e(t){return t?e(t.priorBreak).concat(t.index):[]}(Pl(e.length(),h,c,l,0,!0))}function Rl(e){var t=.5,i=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function kl(e,t,i,r,n){if(r||n)for(var a=e[i],o=(e[i].x+a.metrics.advance*a.scale)*r,s=t;s<=i;s++)e[s].x-=o,e[s].y+=n}function Ll(e,t,i,r,n,a){var o,s=e.image;if(s.content){var l=s.content,c=s.pixelRatio||1;o=[l[0]/c,l[1]/c,s.displaySize[0]-l[2]/c,s.displaySize[1]-l[3]/c]}var u,h,p,d,f=t.left*a,m=t.right*a;"width"===i||"both"===i?(d=n[0]+f-r[3],h=n[0]+m+r[1]):h=(d=n[0]+(f+m-s.displaySize[0])/2)+s.displaySize[0];var g=t.top*a,_=t.bottom*a;return"height"===i||"both"===i?(u=n[1]+g-r[0],p=n[1]+_+r[2]):p=(u=n[1]+(g+_-s.displaySize[1])/2)+s.displaySize[1],{image:s,top:u,right:h,bottom:p,left:d,collisionPadding:o}}El[10]=!0,El[32]=!0,El[38]=!0,El[40]=!0,El[41]=!0,El[43]=!0,El[45]=!0,El[47]=!0,El[173]=!0,El[183]=!0,El[8203]=!0,El[8208]=!0,El[8211]=!0,El[8231]=!0;var Dl=function(e){function t(t,i,r,n){e.call(this,t,i),this.angle=r,void 0!==n&&(this.segment=n)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.clone=function(){return new t(this.x,this.y,this.angle,this.segment)},t}(n);function Bl(e,t){var i=t.expression;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new sn(e+1))};if("source"===i.kind)return{kind:"source"};for(var r=i.zoomStops,n=i.interpolationType,a=0;a<r.length&&r[a]<=e;)a++;for(var o=a=Math.max(0,a-1);o<r.length&&r[o]<e+1;)o++;o=Math.min(r.length-1,o);var s=r[a],l=r[o];return"composite"===i.kind?{kind:"composite",minZoom:s,maxZoom:l,interpolationType:n}:{kind:"camera",minZoom:s,maxZoom:l,minSize:i.evaluate(new sn(s)),maxSize:i.evaluate(new sn(l)),interpolationType:n}}function Fl(e,t,i){var r=t.uSize,n=i.lowerSize;return"source"===e.kind?n/128:"composite"===e.kind?qt(n/128,i.upperSize/128,t.uSizeT):r}function Ol(e,t){var i=0,r=0;if("constant"===e.kind)r=e.layoutSize;else if("source"!==e.kind){var n=e.interpolationType,a=n?u(ai.interpolationFactor(n,t,e.minZoom,e.maxZoom),0,1):0;"camera"===e.kind?r=qt(e.minSize,e.maxSize,a):i=a}return{uSizeT:i,uSize:r}}Fr("Anchor",Dl);var Nl=Object.freeze({__proto__:null,getSizeData:Bl,evaluateSizeForFeature:Fl,evaluateSizeForZoom:Ol,SIZE_PACK_FACTOR:128});function Vl(e,t,i,r,n){if(void 0===t.segment)return!0;for(var a=t,o=t.segment+1,s=0;s>-i/2;){if(--o<0)return!1;s-=e[o].dist(a),a=e[o]}s+=e[o].dist(e[o+1]),o++;for(var l=[],c=0;s<i/2;){var u=e[o],h=e[o+1];if(!h)return!1;var p=e[o-1].angleTo(u)-u.angleTo(h);for(p=Math.abs((p+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:s,angleDelta:p}),c+=p;s-l[0].distance>r;)c-=l.shift().angleDelta;if(c>n)return!1;o++,s+=u.dist(h)}return!0}function Ul(e){for(var t=0,i=0;i<e.length-1;i++)t+=e[i].dist(e[i+1]);return t}function $l(e,t,i){return e?.6*t*i:0}function jl(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function ql(e,t,i,r,n,a){for(var o=$l(i,n,a),s=jl(i,r)*a,l=0,c=Ul(e)/2,u=0;u<e.length-1;u++){var h=e[u],p=e[u+1],d=h.dist(p);if(l+d>c){var f=(c-l)/d,m=qt(h.x,p.x,f),g=qt(h.y,p.y,f),_=new Dl(m,g,p.angleTo(h),u);return _._round(),!o||Vl(e,_,s,o,t)?_:void 0}l+=d}}function Gl(e,t,i,r,n,a,o,s,l){var c=$l(r,a,o),u=jl(r,n),h=u*o,p=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-h<t/4&&(t=h+t/4),function e(t,i,r,n,a,o,s,l,c){for(var u=o/2,h=Ul(t),p=0,d=i-r,f=[],m=0;m<t.length-1;m++){for(var g=t[m],_=t[m+1],y=g.dist(_),v=_.angleTo(g);d+r<p+y;){var x=((d+=r)-p)/y,b=qt(g.x,_.x,x),w=qt(g.y,_.y,x);if(b>=0&&b<c&&w>=0&&w<c&&d-u>=0&&d+u<=h){var S=new Dl(b,w,v,m);S._round(),n&&!Vl(t,S,o,n,a)||f.push(S)}}p+=y}return l||f.length||s||(f=e(t,p/2,r,n,a,o,s,!0,c)),f}(e,p?t/2*s%t:(u/2+2*a)*o*s%t,t,c,i,h,p,!1,l)}function Hl(e,t,i,r,a){for(var o=[],s=0;s<e.length;s++)for(var l=e[s],c=void 0,u=0;u<l.length-1;u++){var h=l[u],p=l[u+1];h.x<t&&p.x<t||(h.x<t?h=new n(t,h.y+(t-h.x)/(p.x-h.x)*(p.y-h.y))._round():p.x<t&&(p=new n(t,h.y+(t-h.x)/(p.x-h.x)*(p.y-h.y))._round()),h.y<i&&p.y<i||(h.y<i?h=new n(h.x+(i-h.y)/(p.y-h.y)*(p.x-h.x),i)._round():p.y<i&&(p=new n(h.x+(i-h.y)/(p.y-h.y)*(p.x-h.x),i)._round()),h.x>=r&&p.x>=r||(h.x>=r?h=new n(r,h.y+(r-h.x)/(p.x-h.x)*(p.y-h.y))._round():p.x>=r&&(p=new n(r,h.y+(r-h.x)/(p.x-h.x)*(p.y-h.y))._round()),h.y>=a&&p.y>=a||(h.y>=a?h=new n(h.x+(a-h.y)/(p.y-h.y)*(p.x-h.x),a)._round():p.y>=a&&(p=new n(h.x+(a-h.y)/(p.y-h.y)*(p.x-h.x),a)._round()),c&&h.equals(c[c.length-1])||o.push(c=[h]),c.push(p)))))}return o}function Wl(e,t,i,r){var a=[],o=e.image,s=o.pixelRatio,l=o.paddedRect.w-2,c=o.paddedRect.h-2,u=e.right-e.left,h=e.bottom-e.top,p=o.stretchX||[[0,l]],d=o.stretchY||[[0,c]],f=function(e,t){return e+t[1]-t[0]},m=p.reduce(f,0),g=d.reduce(f,0),_=l-m,y=c-g,v=0,x=m,b=0,w=g,S=0,M=_,T=0,E=y;if(o.content&&r){var C=o.content;v=Zl(p,0,C[0]),b=Zl(d,0,C[1]),x=Zl(p,C[0],C[2]),w=Zl(d,C[1],C[3]),S=C[0]-v,T=C[1]-b,M=C[2]-C[0]-x,E=C[3]-C[1]-w}var A=function(r,a,l,c){var p=Yl(r.stretch-v,x,u,e.left),d=Kl(r.fixed-S,M,r.stretch,m),f=Yl(a.stretch-b,w,h,e.top),_=Kl(a.fixed-T,E,a.stretch,g),y=Yl(l.stretch-v,x,u,e.left),C=Kl(l.fixed-S,M,l.stretch,m),A=Yl(c.stretch-b,w,h,e.top),I=Kl(c.fixed-T,E,c.stretch,g),P=new n(p,f),z=new n(y,f),R=new n(y,A),k=new n(p,A),L=new n(d/s,_/s),D=new n(C/s,I/s),B=t*Math.PI/180;if(B){var F=Math.sin(B),O=Math.cos(B),N=[O,-F,F,O];P._matMult(N),z._matMult(N),k._matMult(N),R._matMult(N)}var V=r.stretch+r.fixed,U=a.stretch+a.fixed;return{tl:P,tr:z,bl:k,br:R,tex:{x:o.paddedRect.x+1+V,y:o.paddedRect.y+1+U,w:l.stretch+l.fixed-V,h:c.stretch+c.fixed-U},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:L,pixelOffsetBR:D,minFontScaleX:M/s/u,minFontScaleY:E/s/h,isSDF:i}};if(r&&(o.stretchX||o.stretchY))for(var I=Xl(p,_,m),P=Xl(d,y,g),z=0;z<I.length-1;z++)for(var R=I[z],k=I[z+1],L=0;L<P.length-1;L++)a.push(A(R,P[L],k,P[L+1]));else a.push(A({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:c+1}));return a}function Zl(e,t,i){for(var r=0,n=0,a=e;n<a.length;n+=1){var o=a[n];r+=Math.max(t,Math.min(i,o[1]))-Math.max(t,Math.min(i,o[0]))}return r}function Xl(e,t,i){for(var r=[{fixed:-1,stretch:0}],n=0,a=e;n<a.length;n+=1){var o=a[n],s=o[0],l=o[1],c=r[r.length-1];r.push({fixed:s-c.stretch,stretch:c.stretch}),r.push({fixed:s-c.stretch,stretch:c.stretch+(l-s)})}return r.push({fixed:t+1,stretch:i}),r}function Yl(e,t,i,r){return e/t*i+r}function Kl(e,t,i,r){return e-t*i/r}var Jl=function(e,t,i,r,a,o,s,l,c,u){if(this.boxStartIndex=e.length,c){var h=o.top,p=o.bottom,d=o.collisionPadding;d&&(h-=d[1],p+=d[3]);var f=p-h;f>0&&(f=Math.max(10,f),this.circleDiameter=f)}else{var m=o.top*s-l,g=o.bottom*s+l,_=o.left*s-l,y=o.right*s+l,v=o.collisionPadding;if(v&&(_-=v[0]*s,m-=v[1]*s,y+=v[2]*s,g+=v[3]*s),u){var x=new n(_,m),b=new n(y,m),w=new n(_,g),S=new n(y,g),M=u*Math.PI/180;x._rotate(M),b._rotate(M),w._rotate(M),S._rotate(M),_=Math.min(x.x,b.x,w.x,S.x),y=Math.max(x.x,b.x,w.x,S.x),m=Math.min(x.y,b.y,w.y,S.y),g=Math.max(x.y,b.y,w.y,S.y)}e.emplaceBack(t.x,t.y,_,m,y,g,i,r,a)}this.boxEndIndex=e.length},Ql=function(e,t){if(void 0===e&&(e=[]),void 0===t&&(t=ec),this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)};function ec(e,t){return e<t?-1:e>t?1:0}function tc(e,t,i){void 0===t&&(t=1),void 0===i&&(i=!1);for(var r=1/0,a=1/0,o=-1/0,s=-1/0,l=e[0],c=0;c<l.length;c++){var u=l[c];(!c||u.x<r)&&(r=u.x),(!c||u.y<a)&&(a=u.y),(!c||u.x>o)&&(o=u.x),(!c||u.y>s)&&(s=u.y)}var h=Math.min(o-r,s-a),p=h/2,d=new Ql([],ic);if(0===h)return new n(r,a);for(var f=r;f<o;f+=h)for(var m=a;m<s;m+=h)d.push(new rc(f+p,m+p,p,e));for(var g=function(e){for(var t=0,i=0,r=0,n=e[0],a=0,o=n.length,s=o-1;a<o;s=a++){var l=n[a],c=n[s],u=l.x*c.y-c.x*l.y;i+=(l.x+c.x)*u,r+=(l.y+c.y)*u,t+=3*u}return new rc(i/t,r/t,0,e)}(e),_=d.length;d.length;){var y=d.pop();(y.d>g.d||!g.d)&&(g=y,i&&console.log("found best %d after %d probes",Math.round(1e4*y.d)/1e4,_)),y.max-g.d<=t||(d.push(new rc(y.p.x-(p=y.h/2),y.p.y-p,p,e)),d.push(new rc(y.p.x+p,y.p.y-p,p,e)),d.push(new rc(y.p.x-p,y.p.y+p,p,e)),d.push(new rc(y.p.x+p,y.p.y+p,p,e)),_+=4)}return i&&(console.log("num probes: "+_),console.log("best distance: "+g.d)),g.p}function ic(e,t){return t.max-e.max}function rc(e,t,i,r){this.p=new n(e,t),this.h=i,this.d=function(e,t){for(var i=!1,r=1/0,n=0;n<t.length;n++)for(var a=t[n],o=0,s=a.length,l=s-1;o<s;l=o++){var c=a[o],u=a[l];c.y>e.y!=u.y>e.y&&e.x<(u.x-c.x)*(e.y-c.y)/(u.y-c.y)+c.x&&(i=!i),r=Math.min(r,Ya(e,c,u))}return(i?1:-1)*Math.sqrt(r)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}Ql.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},Ql.prototype.pop=function(){if(0!==this.length){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}},Ql.prototype.peek=function(){return this.data[0]},Ql.prototype._up=function(e){for(var t=this.data,i=this.compare,r=t[e];e>0;){var n=e-1>>1,a=t[n];if(i(r,a)>=0)break;t[e]=a,e=n}t[e]=r},Ql.prototype._down=function(e){for(var t=this.data,i=this.compare,r=this.length>>1,n=t[e];e<r;){var a=1+(e<<1),o=t[a],s=a+1;if(s<this.length&&i(t[s],o)<0&&(a=s,o=t[s]),i(o,n)>=0)break;t[e]=o,e=a}t[e]=n};var nc=Number.POSITIVE_INFINITY;function ac(e,t){return t[1]!==nc?function(e,t,i){var r=0,n=0;switch(t=Math.abs(t),i=Math.abs(i),e){case"top-right":case"top-left":case"top":n=i-7;break;case"bottom-right":case"bottom-left":case"bottom":n=7-i}switch(e){case"top-right":case"bottom-right":case"right":r=-t;break;case"top-left":case"bottom-left":case"left":r=t}return[r,n]}(e,t[0],t[1]):function(e,t){var i=0,r=0;t<0&&(t=0);var n=t/Math.sqrt(2);switch(e){case"top-right":case"top-left":r=n-7;break;case"bottom-right":case"bottom-left":r=7-n;break;case"bottom":r=7-t;break;case"top":r=t-7}switch(e){case"top-right":case"bottom-right":i=-n;break;case"top-left":case"bottom-left":i=n;break;case"left":i=t;break;case"right":i=-t}return[i,r]}(e,t[0])}function oc(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function sc(e,t,i,r,a,o,s,l,c,u,h,p,d,f,m){var g=function(e,t,i,r,a,o,s,l){for(var c=r.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,u=[],h=0,p=t.positionedLines;h<p.length;h+=1)for(var d=p[h],f=0,m=d.positionedGlyphs;f<m.length;f+=1){var g=m[f];if(g.rect){var _=g.rect||{},y=4,v=!0,x=1,b=0,w=(a||l)&&g.vertical,S=g.metrics.advance*g.scale/2;if(l&&t.verticalizable&&(b=d.lineOffset/2-(g.imageName?-(24-g.metrics.width*g.scale)/2:24*(g.scale-1))),g.imageName){var M=s[g.imageName];v=M.sdf,y=1/(x=M.pixelRatio)}var T=a?[g.x+S,g.y]:[0,0],E=a?[0,0]:[g.x+S+i[0],g.y+i[1]-b],C=[0,0];w&&(C=E,E=[0,0]);var A=(g.metrics.left-y)*g.scale-S+E[0],I=(-g.metrics.top-y)*g.scale+E[1],P=A+_.w*g.scale/x,z=I+_.h*g.scale/x,R=new n(A,I),k=new n(P,I),L=new n(A,z),D=new n(P,z);if(w){var B=new n(-S,S- -17),F=-Math.PI/2,O=12-S,N=new n(22-O,-(g.imageName?O:0)),V=new(Function.prototype.bind.apply(n,[null].concat(C)));R._rotateAround(F,B)._add(N)._add(V),k._rotateAround(F,B)._add(N)._add(V),L._rotateAround(F,B)._add(N)._add(V),D._rotateAround(F,B)._add(N)._add(V)}if(c){var U=Math.sin(c),$=Math.cos(c),j=[$,-U,U,$];R._matMult(j),k._matMult(j),L._matMult(j),D._matMult(j)}var q=new n(0,0),G=new n(0,0);u.push({tl:R,tr:k,bl:L,br:D,tex:_,writingMode:t.writingMode,glyphOffset:T,sectionIndex:g.sectionIndex,isSDF:v,pixelOffsetTL:q,pixelOffsetBR:G,minFontScaleX:0,minFontScaleY:0})}}return u}(0,i,l,a,o,s,r,e.allowVerticalPlacement),_=e.textSizeData,y=null;"source"===_.kind?(y=[128*a.layout.get("text-size").evaluate(s,{})])[0]>32640&&S(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):"composite"===_.kind&&((y=[128*f.compositeTextSizes[0].evaluate(s,{},m),128*f.compositeTextSizes[1].evaluate(s,{},m)])[0]>32640||y[1]>32640)&&S(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),e.addSymbols(e.text,g,y,l,o,s,u,t,c.lineStartIndex,c.lineLength,d,m);for(var v=0,x=h;v<x.length;v+=1)p[x[v]]=e.text.placedSymbolArray.length-1;return 4*g.length}function lc(e){for(var t in e)return e[t];return null}function cc(e,t,i,r){var n=e.compareText;if(t in n){for(var a=n[t],o=a.length-1;o>=0;o--)if(r.dist(a[o])<i)return!0}else n[t]=[];return n[t].push(r),!1}var uc=xs.VectorTileFeature.types,hc=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function pc(e,t,i,r,n,a,o,s,l,c,u,h,p){var d=s?Math.min(32640,Math.round(s[0])):0,f=s?Math.min(32640,Math.round(s[1])):0;e.emplaceBack(t,i,Math.round(32*r),Math.round(32*n),a,o,(d<<1)+(l?1:0),f,16*c,16*u,256*h,256*p)}function dc(e,t,i){e.emplaceBack(t.x,t.y,i),e.emplaceBack(t.x,t.y,i),e.emplaceBack(t.x,t.y,i),e.emplaceBack(t.x,t.y,i)}function fc(e){for(var t=0,i=e.sections;t<i.length;t+=1)if(Yr(i[t].text))return!0;return!1}var mc=function(e){this.layoutVertexArray=new Ln,this.indexArray=new Un,this.programConfigurations=e,this.segments=new sa,this.dynamicLayoutVertexArray=new Dn,this.opacityVertexArray=new Bn,this.placedSymbolArray=new Qn};mc.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length},mc.prototype.upload=function(e,t,i,r){this.isEmpty()||(i&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Us.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,$s.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,hc,!0),this.opacityVertexBuffer.itemSize=1),(i||r)&&this.programConfigurations.upload(e))},mc.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Fr("SymbolBuffers",mc);var gc=function(e,t,i){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new i,this.segments=new sa,this.collisionVertexArray=new Vn};gc.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,js.members,!0)},gc.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Fr("CollisionBuffers",gc);var _c=function(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((function(e){return e.id})),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=oo([]),this.placementViewportMatrix=oo([]);var t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Bl(this.zoom,t["text-size"]),this.iconSizeData=Bl(this.zoom,t["icon-size"]);var i=this.layers[0].layout,r=i.get("symbol-sort-key"),n=i.get("symbol-z-order");this.canOverlap=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==n&&void 0!==r.constantOr(1),this.sortFeaturesByY=("viewport-y"===n||"auto"===n&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===i.get("symbol-placement")&&(this.writingModes=i.get("text-writing-mode").map((function(e){return bl[e]}))),this.stateDependentLayerIds=this.layers.filter((function(e){return e.isStateDependent()})).map((function(e){return e.id})),this.sourceID=e.sourceID};_c.prototype.createArrays=function(){this.text=new mc(new La(this.layers,this.zoom,(function(e){return/^text/.test(e)}))),this.icon=new mc(new La(this.layers,this.zoom,(function(e){return/^icon/.test(e)}))),this.glyphOffsetArray=new ia,this.lineVertexArray=new ra,this.symbolInstances=new ta},_c.prototype.calculateGlyphDependencies=function(e,t,i,r,n){for(var a=0;a<e.length;a++)if(t[e.charCodeAt(a)]=!0,(i||r)&&n){var o=Ws[e.charAt(a)];o&&(t[o.charCodeAt(0)]=!0)}},_c.prototype.populate=function(e,t,i){var r=this.layers[0],n=r.layout,a=n.get("text-font"),o=n.get("text-field"),s=n.get("icon-image"),l=("constant"!==o.value.kind||o.value.value instanceof rt&&!o.value.value.isEmpty()||o.value.value.toString().length>0)&&("constant"!==a.value.kind||a.value.value.length>0),c="constant"!==s.value.kind||!!s.value.value||Object.keys(s.parameters).length>0,u=n.get("symbol-sort-key");if(this.features=[],l||c){for(var h=t.iconDependencies,p=t.glyphDependencies,d=t.availableImages,f=new sn(this.zoom),m=0,g=e;m<g.length;m+=1){var _=g[m],y=_.feature,v=_.id,x=_.index,b=_.sourceLayerIndex,w=r._featureFilter.needGeometry,S=Va(y,w);if(r._featureFilter.filter(f,S,i)){w||(S.geometry=Na(y));var M=void 0;if(l){var T=r.getValueAndResolveTokens("text-field",S,i,d),E=rt.factory(T);fc(E)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===nn()||this.hasRTLText&&on.isParsed())&&(M=Hs(E,r,S))}var C=void 0;if(c){var A=r.getValueAndResolveTokens("icon-image",S,i,d);C=A instanceof nt?A:nt.fromString(A)}if(M||C){var I=this.sortFeaturesByKey?u.evaluate(S,{},i):void 0;if(this.features.push({id:v,text:M,icon:C,index:x,sourceLayerIndex:b,geometry:S.geometry,properties:y.properties,type:uc[y.type],sortKey:I}),C&&(h[C.name]=!0),M){var P=a.evaluate(S,{},i).join(","),z="map"===n.get("text-rotation-alignment")&&"point"!==n.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(bl.vertical)>=0;for(var R=0,k=M.sections;R<k.length;R+=1){var L=k[R];if(L.image)h[L.image.name]=!0;else{var D=Gr(M.toString()),B=L.fontStack||P,F=p[B]=p[B]||{};this.calculateGlyphDependencies(L.text,F,z,this.allowVerticalPlacement,D)}}}}}}"line"===n.get("symbol-placement")&&(this.features=function(e){var t={},i={},r=[],n=0;function a(t){r.push(e[t]),n++}function o(e,t,n){var a=i[e];return delete i[e],i[t]=a,r[a].geometry[0].pop(),r[a].geometry[0]=r[a].geometry[0].concat(n[0]),a}function s(e,i,n){var a=t[i];return delete t[i],t[e]=a,r[a].geometry[0].shift(),r[a].geometry[0]=n[0].concat(r[a].geometry[0]),a}function l(e,t,i){var r=i?t[0][t[0].length-1]:t[0][0];return e+":"+r.x+":"+r.y}for(var c=0;c<e.length;c++){var u=e[c],h=u.geometry,p=u.text?u.text.toString():null;if(p){var d=l(p,h),f=l(p,h,!0);if(d in i&&f in t&&i[d]!==t[f]){var m=s(d,f,h),g=o(d,f,r[m].geometry);delete t[d],delete i[f],i[l(p,r[g].geometry,!0)]=g,r[m].geometry=null}else d in i?o(d,f,h):f in t?s(d,f,h):(a(c),t[d]=n-1,i[f]=n-1)}else a(c)}return r.filter((function(e){return e.geometry}))}(this.features)),this.sortFeaturesByKey&&this.features.sort((function(e,t){return e.sortKey-t.sortKey}))}},_c.prototype.update=function(e,t,i){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,i),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,i))},_c.prototype.isEmpty=function(){return 0===this.symbolInstances.length&&!this.hasRTLText},_c.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},_c.prototype.upload=function(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},_c.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},_c.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},_c.prototype.addToLineVertexArray=function(e,t){var i=this.lineVertexArray.length;if(void 0!==e.segment){for(var r=e.dist(t[e.segment+1]),n=e.dist(t[e.segment]),a={},o=e.segment+1;o<t.length;o++)a[o]={x:t[o].x,y:t[o].y,tileUnitDistanceFromAnchor:r},o<t.length-1&&(r+=t[o+1].dist(t[o]));for(var s=e.segment||0;s>=0;s--)a[s]={x:t[s].x,y:t[s].y,tileUnitDistanceFromAnchor:n},s>0&&(n+=t[s-1].dist(t[s]));for(var l=0;l<t.length;l++){var c=a[l];this.lineVertexArray.emplaceBack(c.x,c.y,c.tileUnitDistanceFromAnchor)}}return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}},_c.prototype.addSymbols=function(e,t,i,r,n,a,o,s,l,c,u,h){for(var p=e.indexArray,d=e.layoutVertexArray,f=e.segments.prepareSegment(4*t.length,d,p,this.canOverlap?a.sortKey:void 0),m=this.glyphOffsetArray.length,g=f.vertexLength,_=this.allowVerticalPlacement&&o===bl.vertical?Math.PI/2:0,y=a.text&&a.text.sections,v=0;v<t.length;v++){var x=t[v],b=x.tl,w=x.tr,S=x.bl,M=x.br,T=x.tex,E=x.pixelOffsetTL,C=x.pixelOffsetBR,A=x.minFontScaleX,I=x.minFontScaleY,P=x.glyphOffset,z=x.isSDF,R=x.sectionIndex,k=f.vertexLength,L=P[1];pc(d,s.x,s.y,b.x,L+b.y,T.x,T.y,i,z,E.x,E.y,A,I),pc(d,s.x,s.y,w.x,L+w.y,T.x+T.w,T.y,i,z,C.x,E.y,A,I),pc(d,s.x,s.y,S.x,L+S.y,T.x,T.y+T.h,i,z,E.x,C.y,A,I),pc(d,s.x,s.y,M.x,L+M.y,T.x+T.w,T.y+T.h,i,z,C.x,C.y,A,I),dc(e.dynamicLayoutVertexArray,s,_),p.emplaceBack(k,k+1,k+2),p.emplaceBack(k+1,k+2,k+3),f.vertexLength+=4,f.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(P[0]),v!==t.length-1&&R===t[v+1].sectionIndex||e.programConfigurations.populatePaintArrays(d.length,a,a.index,{},h,y&&y[R])}e.placedSymbolArray.emplaceBack(s.x,s.y,m,this.glyphOffsetArray.length-m,g,l,c,s.segment,i?i[0]:0,i?i[1]:0,r[0],r[1],o,0,!1,0,u)},_c.prototype._addCollisionDebugVertex=function(e,t,i,r,n,a){return t.emplaceBack(0,0),e.emplaceBack(i.x,i.y,r,n,Math.round(a.x),Math.round(a.y))},_c.prototype.addCollisionDebugVertices=function(e,t,i,r,a,o,s){var l=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),c=l.vertexLength,u=a.layoutVertexArray,h=a.collisionVertexArray,p=s.anchorX,d=s.anchorY;this._addCollisionDebugVertex(u,h,o,p,d,new n(e,t)),this._addCollisionDebugVertex(u,h,o,p,d,new n(i,t)),this._addCollisionDebugVertex(u,h,o,p,d,new n(i,r)),this._addCollisionDebugVertex(u,h,o,p,d,new n(e,r)),l.vertexLength+=4;var f=a.indexArray;f.emplaceBack(c,c+1),f.emplaceBack(c+1,c+2),f.emplaceBack(c+2,c+3),f.emplaceBack(c+3,c),l.primitiveLength+=4},_c.prototype.addDebugCollisionBoxes=function(e,t,i,r){for(var n=e;n<t;n++){var a=this.collisionBoxArray.get(n);this.addCollisionDebugVertices(a.x1,a.y1,a.x2,a.y2,r?this.textCollisionBox:this.iconCollisionBox,a.anchorPoint,i)}},_c.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new gc(On,qs.members,Wn),this.iconCollisionBox=new gc(On,qs.members,Wn);for(var e=0;e<this.symbolInstances.length;e++){var t=this.symbolInstances.get(e);this.addDebugCollisionBoxes(t.textBoxStartIndex,t.textBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.verticalTextBoxStartIndex,t.verticalTextBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.iconBoxStartIndex,t.iconBoxEndIndex,t,!1),this.addDebugCollisionBoxes(t.verticalIconBoxStartIndex,t.verticalIconBoxEndIndex,t,!1)}},_c.prototype._deserializeCollisionBoxesForSymbol=function(e,t,i,r,n,a,o,s,l){for(var c={},u=t;u<i;u++){var h=e.get(u);c.textBox={x1:h.x1,y1:h.y1,x2:h.x2,y2:h.y2,anchorPointX:h.anchorPointX,anchorPointY:h.anchorPointY},c.textFeatureIndex=h.featureIndex;break}for(var p=r;p<n;p++){var d=e.get(p);c.verticalTextBox={x1:d.x1,y1:d.y1,x2:d.x2,y2:d.y2,anchorPointX:d.anchorPointX,anchorPointY:d.anchorPointY},c.verticalTextFeatureIndex=d.featureIndex;break}for(var f=a;f<o;f++){var m=e.get(f);c.iconBox={x1:m.x1,y1:m.y1,x2:m.x2,y2:m.y2,anchorPointX:m.anchorPointX,anchorPointY:m.anchorPointY},c.iconFeatureIndex=m.featureIndex;break}for(var g=s;g<l;g++){var _=e.get(g);c.verticalIconBox={x1:_.x1,y1:_.y1,x2:_.x2,y2:_.y2,anchorPointX:_.anchorPointX,anchorPointY:_.anchorPointY},c.verticalIconFeatureIndex=_.featureIndex;break}return c},_c.prototype.deserializeCollisionBoxes=function(e){this.collisionArrays=[];for(var t=0;t<this.symbolInstances.length;t++){var i=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}},_c.prototype.hasTextData=function(){return this.text.segments.get().length>0},_c.prototype.hasIconData=function(){return this.icon.segments.get().length>0},_c.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},_c.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},_c.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},_c.prototype.addIndicesForPlacedSymbol=function(e,t){for(var i=e.placedSymbolArray.get(t),r=i.vertexStartIndex+4*i.numGlyphs,n=i.vertexStartIndex;n<r;n+=4)e.indexArray.emplaceBack(n,n+1,n+2),e.indexArray.emplaceBack(n+1,n+2,n+3)},_c.prototype.getSortedSymbolIndexes=function(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;for(var t=Math.sin(e),i=Math.cos(e),r=[],n=[],a=[],o=0;o<this.symbolInstances.length;++o){a.push(o);var s=this.symbolInstances.get(o);r.push(0|Math.round(t*s.anchorX+i*s.anchorY)),n.push(s.featureIndex)}return a.sort((function(e,t){return r[e]-r[t]||n[t]-n[e]})),a},_c.prototype.addToSortKeyRanges=function(e,t){var i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===t?i.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})},_c.prototype.sortFeatures=function(e){var t=this;if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var i=0,r=this.symbolInstanceIndexes;i<r.length;i+=1){var n=this.symbolInstances.get(r[i]);this.featureSortOrder.push(n.featureIndex),[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach((function(e,i,r){e>=0&&r.indexOf(e)===i&&t.addIndicesForPlacedSymbol(t.text,e)})),n.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,n.verticalPlacedTextSymbolIndex),n.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.placedIconSymbolIndex),n.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Fr("SymbolBucket",_c,{omit:["layers","collisionBoxArray","features","compareText"]}),_c.MAX_GLYPHS=65535,_c.addDynamicAttributes=dc;var yc=new bn({"symbol-placement":new gn(Ie.layout_symbol["symbol-placement"]),"symbol-spacing":new gn(Ie.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new gn(Ie.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new _n(Ie.layout_symbol["symbol-sort-key"]),"symbol-z-order":new gn(Ie.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new gn(Ie.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new gn(Ie.layout_symbol["icon-ignore-placement"]),"icon-optional":new gn(Ie.layout_symbol["icon-optional"]),"icon-rotation-alignment":new gn(Ie.layout_symbol["icon-rotation-alignment"]),"icon-size":new _n(Ie.layout_symbol["icon-size"]),"icon-text-fit":new gn(Ie.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new gn(Ie.layout_symbol["icon-text-fit-padding"]),"icon-image":new _n(Ie.layout_symbol["icon-image"]),"icon-rotate":new _n(Ie.layout_symbol["icon-rotate"]),"icon-padding":new gn(Ie.layout_symbol["icon-padding"]),"icon-keep-upright":new gn(Ie.layout_symbol["icon-keep-upright"]),"icon-offset":new _n(Ie.layout_symbol["icon-offset"]),"icon-anchor":new _n(Ie.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new gn(Ie.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new gn(Ie.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new gn(Ie.layout_symbol["text-rotation-alignment"]),"text-field":new _n(Ie.layout_symbol["text-field"]),"text-font":new _n(Ie.layout_symbol["text-font"]),"text-size":new _n(Ie.layout_symbol["text-size"]),"text-max-width":new _n(Ie.layout_symbol["text-max-width"]),"text-line-height":new gn(Ie.layout_symbol["text-line-height"]),"text-letter-spacing":new _n(Ie.layout_symbol["text-letter-spacing"]),"text-justify":new _n(Ie.layout_symbol["text-justify"]),"text-radial-offset":new _n(Ie.layout_symbol["text-radial-offset"]),"text-variable-anchor":new gn(Ie.layout_symbol["text-variable-anchor"]),"text-anchor":new _n(Ie.layout_symbol["text-anchor"]),"text-max-angle":new gn(Ie.layout_symbol["text-max-angle"]),"text-writing-mode":new gn(Ie.layout_symbol["text-writing-mode"]),"text-rotate":new _n(Ie.layout_symbol["text-rotate"]),"text-padding":new gn(Ie.layout_symbol["text-padding"]),"text-keep-upright":new gn(Ie.layout_symbol["text-keep-upright"]),"text-transform":new _n(Ie.layout_symbol["text-transform"]),"text-offset":new _n(Ie.layout_symbol["text-offset"]),"text-allow-overlap":new gn(Ie.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new gn(Ie.layout_symbol["text-ignore-placement"]),"text-optional":new gn(Ie.layout_symbol["text-optional"])}),vc={paint:new bn({"icon-opacity":new _n(Ie.paint_symbol["icon-opacity"]),"icon-color":new _n(Ie.paint_symbol["icon-color"]),"icon-halo-color":new _n(Ie.paint_symbol["icon-halo-color"]),"icon-halo-width":new _n(Ie.paint_symbol["icon-halo-width"]),"icon-halo-blur":new _n(Ie.paint_symbol["icon-halo-blur"]),"icon-translate":new gn(Ie.paint_symbol["icon-translate"]),"icon-translate-anchor":new gn(Ie.paint_symbol["icon-translate-anchor"]),"text-opacity":new _n(Ie.paint_symbol["text-opacity"]),"text-color":new _n(Ie.paint_symbol["text-color"],{runtimeType:Ue,getOverride:function(e){return e.textColor},hasOverride:function(e){return!!e.textColor}}),"text-halo-color":new _n(Ie.paint_symbol["text-halo-color"]),"text-halo-width":new _n(Ie.paint_symbol["text-halo-width"]),"text-halo-blur":new _n(Ie.paint_symbol["text-halo-blur"]),"text-translate":new gn(Ie.paint_symbol["text-translate"]),"text-translate-anchor":new gn(Ie.paint_symbol["text-translate-anchor"])}),layout:yc},xc=function(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Fe,this.defaultValue=e};xc.prototype.evaluate=function(e){if(e.formattedSection){var t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default},xc.prototype.eachChild=function(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)},xc.prototype.outputDefined=function(){return!1},xc.prototype.serialize=function(){return null},Fr("FormatSectionOverride",xc,{omit:["defaultValue"]});var bc=function(e){function t(t){e.call(this,t,vc)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(t,i){if(e.prototype.recalculate.call(this,t,i),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){var r=this.layout.get("text-writing-mode");if(r){for(var n=[],a=0,o=r;a<o.length;a+=1){var s=o[a];n.indexOf(s)<0&&n.push(s)}this.layout._values["text-writing-mode"]=n}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},t.prototype.getValueAndResolveTokens=function(e,t,i,r){var n=this.layout.get(e).evaluate(t,{},i,r),a=this._unevaluatedLayout._values[e];return a.isDataDriven()||Gi(a.value)||!n?n:function(e,t){return t.replace(/{([^{}]+)}/g,(function(t,i){return i in e?String(e[i]):""}))}(t.properties,n)},t.prototype.createBucket=function(e){return new _c(e)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype._setPaintOverrides=function(){for(var e=0,i=vc.paint.overridableProperties;e<i.length;e+=1){var r=i[e];if(t.hasPaintOverride(this.layout,r)){var n,a=this.paint.get(r),o=new xc(a),s=new qi(o,a.property.specification);n="constant"===a.value.kind||"source"===a.value.kind?new Wi("source",s):new Zi("composite",s,a.value.zoomStops,a.value._interpolationType),this.paint._values[r]=new fn(a.property,n,a.parameters)}}},t.prototype._handleOverridablePaintPropertyUpdate=function(e,i,r){return!(!this.layout||i.isDataDriven()||r.isDataDriven())&&t.hasPaintOverride(this.layout,e)},t.hasPaintOverride=function(e,t){var i=e.get("text-field"),r=vc.paint.properties[t],n=!1,a=function(e){for(var t=0,i=e;t<i.length;t+=1)if(r.overrides&&r.overrides.hasOverride(i[t]))return void(n=!0)};if("constant"===i.value.kind&&i.value.value instanceof rt)a(i.value.value.sections);else if("source"===i.value.kind){var o=function(e){n||(e instanceof ct&&st(e.value)===Ge?a(e.value.sections):e instanceof dt?a(e.sections):e.eachChild(o))},s=i.value;s._styleExpression&&o(s._styleExpression.expression)}return n},t}(wn),wc={paint:new bn({"background-color":new gn(Ie.paint_background["background-color"]),"background-pattern":new vn(Ie.paint_background["background-pattern"]),"background-opacity":new gn(Ie.paint_background["background-opacity"])})},Sc=function(e){function t(t){e.call(this,t,wc)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(wn),Mc={paint:new bn({"raster-opacity":new gn(Ie.paint_raster["raster-opacity"]),"raster-hue-rotate":new gn(Ie.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new gn(Ie.paint_raster["raster-brightness-min"]),"raster-brightness-max":new gn(Ie.paint_raster["raster-brightness-max"]),"raster-saturation":new gn(Ie.paint_raster["raster-saturation"]),"raster-contrast":new gn(Ie.paint_raster["raster-contrast"]),"raster-resampling":new gn(Ie.paint_raster["raster-resampling"]),"raster-fade-duration":new gn(Ie.paint_raster["raster-fade-duration"])})},Tc=function(e){function t(t){e.call(this,t,Mc)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(wn),Ec=function(e){function t(t){e.call(this,t,{}),this.implementation=t}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.is3D=function(){return"3d"===this.implementation.renderingMode},t.prototype.hasOffscreenPass=function(){return void 0!==this.implementation.prerender},t.prototype.recalculate=function(){},t.prototype.updateTransitions=function(){},t.prototype.hasTransition=function(){},t.prototype.serialize=function(){},t.prototype.onAdd=function(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)},t.prototype.onRemove=function(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)},t}(wn),Cc={circle:ho,heatmap:wo,hillshade:Mo,fill:us,"fill-extrusion":Cs,line:Ns,symbol:bc,background:Sc,raster:Tc},Ac=o.HTMLImageElement,Ic=o.HTMLCanvasElement,Pc=o.HTMLVideoElement,zc=o.ImageData,Rc=o.ImageBitmap,kc=function(e,t,i,r){this.context=e,this.format=i,this.texture=e.gl.createTexture(),this.update(t,r)};kc.prototype.update=function(e,t,i){var r=e.width,n=e.height,a=!(this.size&&this.size[0]===r&&this.size[1]===n||i),o=this.context,s=o.gl;if(this.useMipmap=Boolean(t&&t.useMipmap),s.bindTexture(s.TEXTURE_2D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!t||!1!==t.premultiply)),a)this.size=[r,n],e instanceof Ac||e instanceof Ic||e instanceof Pc||e instanceof zc||Rc&&e instanceof Rc?s.texImage2D(s.TEXTURE_2D,0,this.format,this.format,s.UNSIGNED_BYTE,e):s.texImage2D(s.TEXTURE_2D,0,this.format,r,n,0,this.format,s.UNSIGNED_BYTE,e.data);else{var l=i||{x:0,y:0},c=l.x,u=l.y;e instanceof Ac||e instanceof Ic||e instanceof Pc||e instanceof zc||Rc&&e instanceof Rc?s.texSubImage2D(s.TEXTURE_2D,0,c,u,s.RGBA,s.UNSIGNED_BYTE,e):s.texSubImage2D(s.TEXTURE_2D,0,c,u,r,n,s.RGBA,s.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&s.generateMipmap(s.TEXTURE_2D)},kc.prototype.bind=function(e,t,i){var r=this.context.gl;r.bindTexture(r.TEXTURE_2D,this.texture),i!==r.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(i=r.LINEAR),e!==this.filter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,i||e),this.filter=e),t!==this.wrap&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,t),this.wrap=t)},kc.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},kc.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Lc=function(e){var t=this;this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){t._triggered=!1,t._callback()})};Lc.prototype.trigger=function(){var e=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((function(){e._triggered=!1,e._callback()}),0))},Lc.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Dc=function(e,t,i){this.target=e,this.parent=t,this.mapId=i,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},_(["receive","process"],this),this.invoker=new Lc(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=E()?e:o};function Bc(e,t,i){var r=2*Math.PI*6378137/256/Math.pow(2,i);return[e*r-2*Math.PI*6378137/2,t*r-2*Math.PI*6378137/2]}Dc.prototype.send=function(e,t,i,r,n){var a=this;void 0===n&&(n=!1);var o=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(this.callbacks[o]=i);var s=I(this.globalScope)?void 0:[];return this.target.postMessage({id:o,type:e,hasCallback:!!i,targetMapId:r,mustQueue:n,sourceMapId:this.mapId,data:Ur(t,s)},s),{cancel:function(){i&&delete a.callbacks[o],a.target.postMessage({id:o,type:"<cancel>",targetMapId:r,sourceMapId:a.mapId})}}},Dc.prototype.receive=function(e){var t=e.data,i=t.id;if(i&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){delete this.tasks[i];var r=this.cancelCallbacks[i];delete this.cancelCallbacks[i],r&&r()}else E()||t.mustQueue?(this.tasks[i]=t,this.taskQueue.push(i),this.invoker.trigger()):this.processTask(i,t)},Dc.prototype.process=function(){if(this.taskQueue.length){var e=this.taskQueue.shift(),t=this.tasks[e];delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(e,t)}},Dc.prototype.processTask=function(e,t){var i=this;if("<response>"===t.type){var r=this.callbacks[e];delete this.callbacks[e],r&&(t.error?r($r(t.error)):r(null,$r(t.data)))}else{var n=!1,a=I(this.globalScope)?void 0:[],o=t.hasCallback?function(t,r){n=!0,delete i.cancelCallbacks[e],i.target.postMessage({id:e,type:"<response>",sourceMapId:i.mapId,error:t?Ur(t):null,data:Ur(r,a)},a)}:function(e){n=!0},s=null,l=$r(t.data);if(this.parent[t.type])s=this.parent[t.type](t.sourceMapId,l,o);else if(this.parent.getWorkerSource){var c=t.type.split(".");s=this.parent.getWorkerSource(t.sourceMapId,c[0],l.source)[c[1]](l,o)}else o(new Error("Could not find function "+t.type));!n&&s&&s.cancel&&(this.cancelCallbacks[e]=s.cancel)}},Dc.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Fc=function(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))};Fc.prototype.setNorthEast=function(e){return this._ne=e instanceof Oc?new Oc(e.lng,e.lat):Oc.convert(e),this},Fc.prototype.setSouthWest=function(e){return this._sw=e instanceof Oc?new Oc(e.lng,e.lat):Oc.convert(e),this},Fc.prototype.extend=function(e){var t,i,r=this._sw,n=this._ne;if(e instanceof Oc)t=e,i=e;else{if(!(e instanceof Fc))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Fc.convert(e)):this.extend(Oc.convert(e)):this;if(i=e._ne,!(t=e._sw)||!i)return this}return r||n?(r.lng=Math.min(t.lng,r.lng),r.lat=Math.min(t.lat,r.lat),n.lng=Math.max(i.lng,n.lng),n.lat=Math.max(i.lat,n.lat)):(this._sw=new Oc(t.lng,t.lat),this._ne=new Oc(i.lng,i.lat)),this},Fc.prototype.getCenter=function(){return new Oc((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Fc.prototype.getSouthWest=function(){return this._sw},Fc.prototype.getNorthEast=function(){return this._ne},Fc.prototype.getNorthWest=function(){return new Oc(this.getWest(),this.getNorth())},Fc.prototype.getSouthEast=function(){return new Oc(this.getEast(),this.getSouth())},Fc.prototype.getWest=function(){return this._sw.lng},Fc.prototype.getSouth=function(){return this._sw.lat},Fc.prototype.getEast=function(){return this._ne.lng},Fc.prototype.getNorth=function(){return this._ne.lat},Fc.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Fc.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Fc.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Fc.prototype.contains=function(e){var t=Oc.convert(e),i=t.lng,r=t.lat,n=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(n=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&n},Fc.convert=function(e){return!e||e instanceof Fc?e:new Fc(e)};var Oc=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid LngLat object: ("+e+", "+t+")");if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Oc.prototype.wrap=function(){return new Oc(h(this.lng,-180,180),this.lat)},Oc.prototype.toArray=function(){return[this.lng,this.lat]},Oc.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Oc.prototype.distanceTo=function(e){var t=Math.PI/180,i=this.lat*t,r=e.lat*t,n=Math.sin(i)*Math.sin(r)+Math.cos(i)*Math.cos(r)*Math.cos((e.lng-this.lng)*t);return 6371008.8*Math.acos(Math.min(n,1))},Oc.prototype.toBounds=function(e){void 0===e&&(e=0);var t=360*e/40075017,i=t/Math.cos(Math.PI/180*this.lat);return new Fc(new Oc(this.lng-i,this.lat-t),new Oc(this.lng+i,this.lat+t))},Oc.convert=function(e){if(e instanceof Oc)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new Oc(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new Oc(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Nc=2*Math.PI*6371008.8;function Vc(e){return Nc*Math.cos(e*Math.PI/180)}function Uc(e){return(180+e)/360}function $c(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function jc(e,t){return e/Vc(t)}function qc(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}var Gc=function(e,t,i){void 0===i&&(i=0),this.x=+e,this.y=+t,this.z=+i};Gc.fromLngLat=function(e,t){void 0===t&&(t=0);var i=Oc.convert(e);return new Gc(Uc(i.lng),$c(i.lat),jc(t,i.lat))},Gc.prototype.toLngLat=function(){return new Oc(360*this.x-180,qc(this.y))},Gc.prototype.toAltitude=function(){return this.z*Vc(qc(this.y))},Gc.prototype.meterInMercatorCoordinateUnits=function(){return 1/Nc*(e=qc(this.y),1/Math.cos(e*Math.PI/180));var e};var Hc=function(e,t,i){this.z=e,this.x=t,this.y=i,this.key=Xc(0,e,e,t,i)};Hc.prototype.equals=function(e){return this.z===e.z&&this.x===e.x&&this.y===e.y},Hc.prototype.url=function(e,t){var i,r,n,a,o,s=(r=this.y,n=this.z,a=Bc(256*(i=this.x),256*(r=Math.pow(2,n)-r-1),n),o=Bc(256*(i+1),256*(r+1),n),a[0]+","+a[1]+","+o[0]+","+o[1]),l=function(e,t,i){for(var r,n="",a=e;a>0;a--)n+=(t&(r=1<<a-1)?1:0)+(i&r?2:0);return n}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",s)},Hc.prototype.getTilePoint=function(e){var t=Math.pow(2,this.z);return new n(8192*(e.x*t-this.x),8192*(e.y*t-this.y))},Hc.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Wc=function(e,t){this.wrap=e,this.canonical=t,this.key=Xc(e,t.z,t.z,t.x,t.y)},Zc=function(e,t,i,r,n){this.overscaledZ=e,this.wrap=t,this.canonical=new Hc(i,+r,+n),this.key=Xc(t,e,i,r,n)};function Xc(e,t,i,r,n){(e*=2)<0&&(e=-1*e-1);var a=1<<i;return(a*a*e+a*n+r).toString(36)+i.toString(36)+t.toString(36)}Zc.prototype.equals=function(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)},Zc.prototype.scaledTo=function(e){var t=this.canonical.z-e;return e>this.canonical.z?new Zc(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Zc(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)},Zc.prototype.calculateScaledKey=function(e,t){var i=this.canonical.z-e;return e>this.canonical.z?Xc(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):Xc(this.wrap*+t,e,e,this.canonical.x>>i,this.canonical.y>>i)},Zc.prototype.isChildOf=function(e){if(e.wrap!==this.wrap)return!1;var t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t},Zc.prototype.children=function(e){if(this.overscaledZ>=e)return[new Zc(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var t=this.canonical.z+1,i=2*this.canonical.x,r=2*this.canonical.y;return[new Zc(t,this.wrap,t,i,r),new Zc(t,this.wrap,t,i+1,r),new Zc(t,this.wrap,t,i,r+1),new Zc(t,this.wrap,t,i+1,r+1)]},Zc.prototype.isLessThan=function(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))},Zc.prototype.wrapped=function(){return new Zc(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Zc.prototype.unwrapTo=function(e){return new Zc(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)},Zc.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Zc.prototype.toUnwrapped=function(){return new Wc(this.wrap,this.canonical)},Zc.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Zc.prototype.getTilePoint=function(e){return this.canonical.getTilePoint(new Gc(e.x-this.wrap,e.y))},Fr("CanonicalTileID",Hc),Fr("OverscaledTileID",Zc,{omit:["posMatrix"]});var Yc=function(e,t,i){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(i&&"mapbox"!==i&&"terrarium"!==i)return S('"'+i+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=t.height;var r=this.dim=t.height-2;this.data=new Uint32Array(t.data.buffer),this.encoding=i||"mapbox";for(var n=0;n<r;n++)this.data[this._idx(-1,n)]=this.data[this._idx(0,n)],this.data[this._idx(r,n)]=this.data[this._idx(r-1,n)],this.data[this._idx(n,-1)]=this.data[this._idx(n,0)],this.data[this._idx(n,r)]=this.data[this._idx(n,r-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(r,-1)]=this.data[this._idx(r-1,0)],this.data[this._idx(-1,r)]=this.data[this._idx(0,r-1)],this.data[this._idx(r,r)]=this.data[this._idx(r-1,r-1)]};Yc.prototype.get=function(e,t){var i=new Uint8Array(this.data.buffer),r=4*this._idx(e,t);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(i[r],i[r+1],i[r+2])},Yc.prototype.getUnpackVector=function(){return"terrarium"===this.encoding?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Yc.prototype._idx=function(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)},Yc.prototype._unpackMapbox=function(e,t,i){return(256*e*256+256*t+i)/10-1e4},Yc.prototype._unpackTerrarium=function(e,t,i){return 256*e+t+i/256-32768},Yc.prototype.getPixels=function(){return new vo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Yc.prototype.backfillBorder=function(e,t,i){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");var r=t*this.dim,n=t*this.dim+this.dim,a=i*this.dim,o=i*this.dim+this.dim;switch(t){case-1:r=n-1;break;case 1:n=r+1}switch(i){case-1:a=o-1;break;case 1:o=a+1}for(var s=-t*this.dim,l=-i*this.dim,c=a;c<o;c++)for(var u=r;u<n;u++)this.data[this._idx(u,c)]=e.data[this._idx(u+s,c+l)]},Fr("DEMData",Yc);var Kc=function(e){this._stringToNumber={},this._numberToString=[];for(var t=0;t<e.length;t++){var i=e[t];this._stringToNumber[i]=t,this._numberToString[t]=i}};Kc.prototype.encode=function(e){return this._stringToNumber[e]},Kc.prototype.decode=function(e){return this._numberToString[e]};var Jc=function(e,t,i,r,n){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=i,e._y=r,this.properties=e.properties,this.id=n},Qc={geometry:{configurable:!0}};Qc.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Qc.geometry.set=function(e){this._geometry=e},Jc.prototype.toJSON=function(){var e={geometry:this.geometry};for(var t in this)"_geometry"!==t&&"_vectorTileFeature"!==t&&(e[t]=this[t]);return e},Object.defineProperties(Jc.prototype,Qc);var eu=function(){this.state={},this.stateChanges={},this.deletedStates={}};eu.prototype.updateState=function(e,t,i){var r=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][r]=this.stateChanges[e][r]||{},p(this.stateChanges[e][r],i),null===this.deletedStates[e])for(var n in this.deletedStates[e]={},this.state[e])n!==r&&(this.deletedStates[e][n]=null);else if(this.deletedStates[e]&&null===this.deletedStates[e][r])for(var a in this.deletedStates[e][r]={},this.state[e][r])i[a]||(this.deletedStates[e][r][a]=null);else for(var o in i)this.deletedStates[e]&&this.deletedStates[e][r]&&null===this.deletedStates[e][r][o]&&delete this.deletedStates[e][r][o]},eu.prototype.removeFeatureState=function(e,t,i){if(null!==this.deletedStates[e]){var r=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},i&&void 0!==t)null!==this.deletedStates[e][r]&&(this.deletedStates[e][r]=this.deletedStates[e][r]||{},this.deletedStates[e][r][i]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][r])for(i in this.deletedStates[e][r]={},this.stateChanges[e][r])this.deletedStates[e][r][i]=null;else this.deletedStates[e][r]=null;else this.deletedStates[e]=null}},eu.prototype.getState=function(e,t){var i=String(t),r=p({},(this.state[e]||{})[i],(this.stateChanges[e]||{})[i]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){var n=this.deletedStates[e][t];if(null===n)return{};for(var a in n)delete r[a]}return r},eu.prototype.initializeTileState=function(e,t){e.setFeatureState(this.state,t)},eu.prototype.coalesceChanges=function(e,t){var i={};for(var r in this.stateChanges){this.state[r]=this.state[r]||{};var n={};for(var a in this.stateChanges[r])this.state[r][a]||(this.state[r][a]={}),p(this.state[r][a],this.stateChanges[r][a]),n[a]=this.state[r][a];i[r]=n}for(var o in this.deletedStates){this.state[o]=this.state[o]||{};var s={};if(null===this.deletedStates[o])for(var l in this.state[o])s[l]={},this.state[o][l]={};else for(var c in this.deletedStates[o]){if(null===this.deletedStates[o][c])this.state[o][c]={};else for(var u=0,h=Object.keys(this.deletedStates[o][c]);u<h.length;u+=1)delete this.state[o][c][h[u]];s[c]=this.state[o][c]}i[o]=i[o]||{},p(i[o],s)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(i).length)for(var d in e)e[d].setFeatureState(i,t)};var tu=function(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Rr(8192,16,0),this.grid3D=new Rr(8192,16,0),this.featureIndexArray=new aa,this.promoteId=t};function iu(e,t,i,r,n){return v(e,(function(e,a){var o=t instanceof mn?t.get(a):null;return o&&o.evaluate?o.evaluate(i,r,n):o}))}function ru(e){for(var t=1/0,i=1/0,r=-1/0,n=-1/0,a=0,o=e;a<o.length;a+=1){var s=o[a];t=Math.min(t,s.x),i=Math.min(i,s.y),r=Math.max(r,s.x),n=Math.max(n,s.y)}return{minX:t,minY:i,maxX:r,maxY:n}}function nu(e,t){return t-e}tu.prototype.insert=function(e,t,i,r,n,a){var o=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,r,n);for(var s=a?this.grid3D:this.grid,l=0;l<t.length;l++){for(var c=t[l],u=[1/0,1/0,-1/0,-1/0],h=0;h<c.length;h++){var p=c[h];u[0]=Math.min(u[0],p.x),u[1]=Math.min(u[1],p.y),u[2]=Math.max(u[2],p.x),u[3]=Math.max(u[3],p.y)}u[0]<8192&&u[1]<8192&&u[2]>=0&&u[3]>=0&&s.insert(o,u[0],u[1],u[2],u[3])}},tu.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new xs.VectorTile(new Ys(this.rawTileData)).layers,this.sourceLayerCoder=new Kc(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},tu.prototype.query=function(e,t,i,r){var a=this;this.loadVTLayers();for(var o=e.params||{},s=8192/e.tileSize/e.scale,l=ar(o.filter),c=e.queryGeometry,u=e.queryPadding*s,h=ru(c),p=this.grid.query(h.minX-u,h.minY-u,h.maxX+u,h.maxY+u),d=ru(e.cameraQueryGeometry),f=this.grid3D.query(d.minX-u,d.minY-u,d.maxX+u,d.maxY+u,(function(t,i,r,a){return function(e,t,i,r,a){for(var o=0,s=e;o<s.length;o+=1){var l=s[o];if(t<=l.x&&i<=l.y&&r>=l.x&&a>=l.y)return!0}var c=[new n(t,i),new n(t,a),new n(r,a),new n(r,i)];if(e.length>2)for(var u=0,h=c;u<h.length;u+=1)if(Ja(e,h[u]))return!0;for(var p=0;p<e.length-1;p++)if(Qa(e[p],e[p+1],c))return!0;return!1}(e.cameraQueryGeometry,t-u,i-u,r+u,a+u)})),m=0,g=f;m<g.length;m+=1)p.push(g[m]);p.sort(nu);for(var _,y={},v=function(n){var u=p[n];if(u!==_){_=u;var h=a.featureIndexArray.get(u),d=null;a.loadMatchingFeature(y,h.bucketIndex,h.sourceLayerIndex,h.featureIndex,l,o.layers,o.availableImages,t,i,r,(function(t,i,r){return d||(d=Na(t)),i.queryIntersectsFeature(c,t,r,d,a.z,e.transform,s,e.pixelPosMatrix)}))}},x=0;x<p.length;x++)v(x);return y},tu.prototype.loadMatchingFeature=function(e,t,i,r,n,a,o,s,l,c,u){var h=this.bucketLayerIDs[t];if(!a||function(e,t){for(var i=0;i<e.length;i++)if(t.indexOf(e[i])>=0)return!0;return!1}(a,h)){var d=this.sourceLayerCoder.decode(i),f=this.vtLayers[d].feature(r);if(n.needGeometry){var m=Va(f,!0);if(!n.filter(new sn(this.tileID.overscaledZ),m,this.tileID.canonical))return}else if(!n.filter(new sn(this.tileID.overscaledZ),f))return;for(var g=this.getId(f,d),_=0;_<h.length;_++){var y=h[_];if(!(a&&a.indexOf(y)<0)){var v=s[y];if(v){var x={};void 0!==g&&c&&(x=c.getState(v.sourceLayer||"_geojsonTileLayer",g));var b=p({},l[y]);b.paint=iu(b.paint,v.paint,f,x,o),b.layout=iu(b.layout,v.layout,f,x,o);var w=!u||u(f,v,x);if(w){var S=new Jc(f,this.z,this.x,this.y,g);S.layer=b;var M=e[y];void 0===M&&(M=e[y]=[]),M.push({featureIndex:r,feature:S,intersectionZ:w})}}}}}},tu.prototype.lookupSymbolFeatures=function(e,t,i,r,n,a,o,s){var l={};this.loadVTLayers();for(var c=ar(n),u=0,h=e;u<h.length;u+=1)this.loadMatchingFeature(l,i,r,h[u],c,a,o,s,t);return l},tu.prototype.hasLayer=function(e){for(var t=0,i=this.bucketLayerIDs;t<i.length;t+=1)for(var r=0,n=i[t];r<n.length;r+=1)if(e===n[r])return!0;return!1},tu.prototype.getId=function(e,t){var i=e.id;return this.promoteId&&"boolean"==typeof(i=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[t]])&&(i=Number(i)),i},Fr("FeatureIndex",tu,{omit:["rawTileData","sourceLayerCoder"]});var au=function(e,t){this.tileID=e,this.uid=f(),this.uses=0,this.tileSize=t,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};au.prototype.registerFadeDuration=function(e){var t=e+this.timeAdded;t<O.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)},au.prototype.wasRequested=function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state},au.prototype.loadVectorData=function(e,t,i){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){for(var r in e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(e,t){var i={};if(!t)return i;for(var r=function(){var e=a[n],r=e.layerIds.map((function(e){return t.getLayer(e)})).filter(Boolean);if(0!==r.length){e.layers=r,e.stateDependentLayerIds&&(e.stateDependentLayers=e.stateDependentLayerIds.map((function(e){return r.filter((function(t){return t.id===e}))[0]})));for(var o=0,s=r;o<s.length;o+=1)i[s[o].id]=e}},n=0,a=e;n<a.length;n+=1)r();return i}(e.buckets,t.style),this.hasSymbolBuckets=!1,this.buckets){var n=this.buckets[r];if(n instanceof _c){if(this.hasSymbolBuckets=!0,!i)break;n.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var a in this.buckets){var o=this.buckets[a];if(o instanceof _c&&o.hasRTLText){this.hasRTLText=!0,on.isLoading()||on.isLoaded()||"deferred"!==nn()||an();break}}for(var s in this.queryPadding=0,this.buckets){var l=this.buckets[s];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(s).queryRadius(l))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new Kn},au.prototype.unloadVectorData=function(){for(var e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},au.prototype.getBucket=function(e){return this.buckets[e.id]},au.prototype.upload=function(e){for(var t in this.buckets){var i=this.buckets[t];i.uploadPending()&&i.upload(e)}var r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new kc(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new kc(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)},au.prototype.prepare=function(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)},au.prototype.queryRenderedFeatures=function(e,t,i,r,n,a,o,s,l,c){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:r,cameraQueryGeometry:n,scale:a,tileSize:this.tileSize,pixelPosMatrix:c,transform:s,params:o,queryPadding:this.queryPadding*l},e,t,i):{}},au.prototype.querySourceFeatures=function(e,t){var i=this.latestFeatureIndex;if(i&&i.rawTileData){var r=i.loadVTLayers(),n=t?t.sourceLayer:"",a=r._geojsonTileLayer||r[n];if(a)for(var o=ar(t&&t.filter),s=this.tileID.canonical,l=s.z,c=s.x,u=s.y,h={z:l,x:c,y:u},p=0;p<a.length;p++){var d=a.feature(p);if(o.needGeometry){var f=Va(d,!0);if(!o.filter(new sn(this.tileID.overscaledZ),f,this.tileID.canonical))continue}else if(!o.filter(new sn(this.tileID.overscaledZ),d))continue;var m=i.getId(d,n),g=new Jc(d,l,c,u,m);g.tile=h,e.push(g)}}},au.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},au.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},au.prototype.setExpiryData=function(e){var t=this.expirationTime;if(e.cacheControl){var i=C(e.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){var r=Date.now(),n=!1;if(this.expirationTime>r)n=!1;else if(t)if(this.expirationTime<t)n=!0;else{var a=this.expirationTime-t;a?this.expirationTime=r+Math.max(a,3e4):n=!0}else n=!0;n?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},au.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)},au.prototype.setFeatureState=function(e,t){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(e).length){var i=this.latestFeatureIndex.loadVTLayers();for(var r in this.buckets)if(t.style.hasLayer(r)){var n=this.buckets[r],a=n.layers[0].sourceLayer||"_geojsonTileLayer",o=i[a],s=e[a];if(o&&s&&0!==Object.keys(s).length){n.update(s,o,this.imageAtlas&&this.imageAtlas.patternPositions||{});var l=t&&t.style&&t.style.getLayer(r);l&&(this.queryPadding=Math.max(this.queryPadding,l.queryRadius(n)))}}}},au.prototype.holdingForFade=function(){return void 0!==this.symbolFadeHoldUntil},au.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<O.now()},au.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},au.prototype.setHoldDuration=function(e){this.symbolFadeHoldUntil=O.now()+e},au.prototype.setDependencies=function(e,t){for(var i={},r=0,n=t;r<n.length;r+=1)i[n[r]]=!0;this.dependencies[e]=i},au.prototype.hasDependency=function(e,t){for(var i=0,r=e;i<r.length;i+=1){var n=this.dependencies[r[i]];if(n)for(var a=0,o=t;a<o.length;a+=1)if(n[o[a]])return!0}return!1};var ou=o.performance,su=function(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},ou.mark(this._marks.start)};su.prototype.finish=function(){ou.mark(this._marks.end);var e=ou.getEntriesByName(this._marks.measure);return 0===e.length&&(ou.measure(this._marks.measure,this._marks.start,this._marks.end),e=ou.getEntriesByName(this._marks.measure),ou.clearMarks(this._marks.start),ou.clearMarks(this._marks.end),ou.clearMeasures(this._marks.measure)),e},e.Actor=Dc,e.AlphaImage=yo,e.CanonicalTileID=Hc,e.CollisionBoxArray=Kn,e.Color=et,e.DEMData=Yc,e.DataConstantProperty=gn,e.DictionaryCoder=Kc,e.EXTENT=8192,e.ErrorEvent=Ce,e.EvaluationParameters=sn,e.Event=Ee,e.Evented=Ae,e.FeatureIndex=tu,e.FillBucket=ss,e.FillExtrusionBucket=Ms,e.ImageAtlas=xl,e.ImagePosition=yl,e.LineBucket=Ds,e.LngLat=Oc,e.LngLatBounds=Fc,e.MercatorCoordinate=Gc,e.ONE_EM=24,e.OverscaledTileID=Zc,e.Point=n,e.Point$1=n,e.Properties=bn,e.Protobuf=Ys,e.RGBAImage=vo,e.RequestManager=G,e.RequestPerformance=su,e.ResourceType=fe,e.SegmentVector=sa,e.SourceFeatureState=eu,e.StructArrayLayout1ui2=Zn,e.StructArrayLayout2f1f2i16=Nn,e.StructArrayLayout2i4=An,e.StructArrayLayout3ui6=Un,e.StructArrayLayout4i8=In,e.SymbolBucket=_c,e.Texture=kc,e.Tile=au,e.Transitionable=un,e.Uniform1f=xa,e.Uniform1i=va,e.Uniform2f=ba,e.Uniform3f=wa,e.Uniform4f=Sa,e.UniformColor=Ma,e.UniformMatrix4f=Ea,e.UnwrappedTileID=Wc,e.ValidationError=Pe,e.WritingMode=bl,e.ZoomHistory=jr,e.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e},e.addDynamicAttributes=dc,e.asyncAll=function(e,t,i){if(!e.length)return i(null,[]);var r=e.length,n=new Array(e.length),a=null;e.forEach((function(e,o){t(e,(function(e,t){e&&(a=e),n[o]=t,0==--r&&i(a,n)}))}))},e.bezier=l,e.bindAll=_,e.browser=O,e.cacheEntryPossiblyAdded=function(e){++pe>le&&(e.getActor().send("enforceCacheSizeLimit",se),pe=0)},e.clamp=u,e.clearTileCache=function(e){var t=o.caches.delete("mapbox-tiles");e&&t.catch(e).then((function(){return e()}))},e.clipLine=Hl,e.clone=function(e){var t=new ao(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.clone$1=b,e.clone$2=function(e){var t=new ao(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},e.collisionCircleLayout=Gs,e.config=N,e.create=function(){var e=new ao(16);return ao!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},e.create$1=function(){var e=new ao(9);return ao!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},e.create$2=function(){var e=new ao(4);return ao!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},e.createCommonjsModule=t,e.createExpression=Hi,e.createLayout=En,e.createStyleLayer=function(e){return"custom"===e.type?new Ec(e):new Cc[e.type](e)},e.cross=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=i[0],s=i[1],l=i[2];return e[0]=n*l-a*s,e[1]=a*o-r*l,e[2]=r*s-n*o,e},e.deepEqual=function e(t,i){if(Array.isArray(t)){if(!Array.isArray(i)||t.length!==i.length)return!1;for(var r=0;r<t.length;r++)if(!e(t[r],i[r]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==i){if("object"!=typeof i)return!1;if(Object.keys(t).length!==Object.keys(i).length)return!1;for(var n in t)if(!e(t[n],i[n]))return!1;return!0}return t===i},e.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},e.dot$1=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},e.ease=c,e.emitValidationErrors=zr,e.endsWith=y,e.enforceCacheSizeLimit=function(e){ce(),ee&&ee.then((function(t){t.keys().then((function(i){for(var r=0;r<i.length-e;r++)t.delete(i[r])}))}))},e.evaluateSizeForFeature=Fl,e.evaluateSizeForZoom=Ol,e.evaluateVariableOffset=ac,e.evented=rn,e.extend=p,e.featureFilter=ar,e.filterObject=x,e.fromRotation=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=-i,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.getAnchorAlignment=Rl,e.getAnchorJustification=oc,e.getArrayBuffer=xe,e.getImage=Se,e.getJSON=function(e,t){return ve(p(e,{type:"json"}),t)},e.getRTLTextPluginStatus=nn,e.getReferrer=ye,e.getVideo=function(e,t){var i,r,n=o.document.createElement("video");n.muted=!0,n.onloadstart=function(){t(null,n)};for(var a=0;a<e.length;a++){var s=o.document.createElement("source");i=e[a],r=void 0,(r=o.document.createElement("a")).href=i,(r.protocol!==o.document.location.protocol||r.host!==o.document.location.host)&&(n.crossOrigin="Anonymous"),s.src=e[a],n.appendChild(s)}return{cancel:function(){}}},e.identity=oo,e.invert=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=t[6],c=t[7],u=t[8],h=t[9],p=t[10],d=t[11],f=t[12],m=t[13],g=t[14],_=t[15],y=i*s-r*o,v=i*l-n*o,x=i*c-a*o,b=r*l-n*s,w=r*c-a*s,S=n*c-a*l,M=u*m-h*f,T=u*g-p*f,E=u*_-d*f,C=h*g-p*m,A=h*_-d*m,I=p*_-d*g,P=y*I-v*A+x*C+b*E-w*T+S*M;return P?(e[0]=(s*I-l*A+c*C)*(P=1/P),e[1]=(n*A-r*I-a*C)*P,e[2]=(m*S-g*w+_*b)*P,e[3]=(p*w-h*S-d*b)*P,e[4]=(l*E-o*I-c*T)*P,e[5]=(i*I-n*E+a*T)*P,e[6]=(g*x-f*S-_*v)*P,e[7]=(u*S-p*x+d*v)*P,e[8]=(o*A-s*E+c*M)*P,e[9]=(r*E-i*A-a*M)*P,e[10]=(f*w-m*x+_*y)*P,e[11]=(h*x-u*w-d*y)*P,e[12]=(s*T-o*C-l*M)*P,e[13]=(i*C-r*T+n*M)*P,e[14]=(m*v-f*b-g*y)*P,e[15]=(u*b-h*v+p*y)*P,e):null},e.isChar=qr,e.isMapboxURL=H,e.keysDifference=function(e,t){var i=[];for(var r in e)r in t||i.push(r);return i},e.makeRequest=ve,e.mapObject=v,e.mercatorXfromLng=Uc,e.mercatorYfromLat=$c,e.mercatorZfromAltitude=jc,e.mul=co,e.multiply=so,e.mvt=xs,e.nextPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},e.normalize=function(e,t){var i=t[0],r=t[1],n=t[2],a=i*i+r*r+n*n;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e},e.number=qt,e.offscreenCanvasSupported=de,e.ortho=function(e,t,i,r,n,a,o){var s=1/(t-i),l=1/(r-n),c=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+i)*s,e[13]=(n+r)*l,e[14]=(o+a)*c,e[15]=1,e},e.parseGlyphPBF=function(e){return new Ys(e).readFields(fl,[])},e.pbf=Ys,e.performSymbolLayout=function(e,t,i,r,n,a,o){e.createArrays(),e.tilePixelRatio=8192/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;var s=e.layers[0].layout,l=e.layers[0]._unevaluatedLayout._values,c={};if("composite"===e.textSizeData.kind){var u=e.textSizeData,h=u.maxZoom;c.compositeTextSizes=[l["text-size"].possiblyEvaluate(new sn(u.minZoom),o),l["text-size"].possiblyEvaluate(new sn(h),o)]}if("composite"===e.iconSizeData.kind){var p=e.iconSizeData,d=p.maxZoom;c.compositeIconSizes=[l["icon-size"].possiblyEvaluate(new sn(p.minZoom),o),l["icon-size"].possiblyEvaluate(new sn(d),o)]}c.layoutTextSize=l["text-size"].possiblyEvaluate(new sn(e.zoom+1),o),c.layoutIconSize=l["icon-size"].possiblyEvaluate(new sn(e.zoom+1),o),c.textMaxSize=l["text-size"].possiblyEvaluate(new sn(18));for(var f=24*s.get("text-line-height"),m="map"===s.get("text-rotation-alignment")&&"point"!==s.get("symbol-placement"),g=s.get("text-keep-upright"),_=s.get("text-size"),y=function(){var a=x[v],l=s.get("text-font").evaluate(a,{},o).join(","),u=_.evaluate(a,{},o),h=c.layoutTextSize.evaluate(a,{},o),p=c.layoutIconSize.evaluate(a,{},o),d={horizontal:{},vertical:void 0},y=a.text,b=[0,0];if(y){var w=y.toString(),M=24*s.get("text-letter-spacing").evaluate(a,{},o),T=function(e){for(var t=0,i=e;t<i.length;t+=1)if(r=i[t].charCodeAt(0),qr.Arabic(r)||qr["Arabic Supplement"](r)||qr["Arabic Extended-A"](r)||qr["Arabic Presentation Forms-A"](r)||qr["Arabic Presentation Forms-B"](r))return!1;var r;return!0}(w)?M:0,E=s.get("text-anchor").evaluate(a,{},o),C=s.get("text-variable-anchor");if(!C){var A=s.get("text-radial-offset").evaluate(a,{},o);b=A?ac(E,[24*A,nc]):s.get("text-offset").evaluate(a,{},o).map((function(e){return 24*e}))}var I=m?"center":s.get("text-justify").evaluate(a,{},o),P=s.get("symbol-placement"),z="point"===P?24*s.get("text-max-width").evaluate(a,{},o):0,R=function(){e.allowVerticalPlacement&&Gr(w)&&(d.vertical=Ml(y,t,i,n,l,z,f,E,"left",T,b,bl.vertical,!0,P,h,u))};if(!m&&C){for(var k="auto"===I?C.map((function(e){return oc(e)})):[I],L=!1,D=0;D<k.length;D++){var B=k[D];if(!d.horizontal[B])if(L)d.horizontal[B]=d.horizontal[0];else{var F=Ml(y,t,i,n,l,z,f,"center",B,T,b,bl.horizontal,!1,P,h,u);F&&(d.horizontal[B]=F,L=1===F.positionedLines.length)}}R()}else{"auto"===I&&(I=oc(E));var O=Ml(y,t,i,n,l,z,f,E,I,T,b,bl.horizontal,!1,P,h,u);O&&(d.horizontal[I]=O),R(),Gr(w)&&m&&g&&(d.vertical=Ml(y,t,i,n,l,z,f,E,I,T,b,bl.vertical,!1,P,h,u))}}var N=void 0,V=!1;if(a.icon&&a.icon.name){var U=r[a.icon.name];U&&(N=function(e,t,i){var r=Rl(i),n=t[0]-e.displaySize[0]*r.horizontalAlign,a=t[1]-e.displaySize[1]*r.verticalAlign;return{image:e,top:a,bottom:a+e.displaySize[1],left:n,right:n+e.displaySize[0]}}(n[a.icon.name],s.get("icon-offset").evaluate(a,{},o),s.get("icon-anchor").evaluate(a,{},o)),V=U.sdf,void 0===e.sdfIcons?e.sdfIcons=U.sdf:e.sdfIcons!==U.sdf&&S("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(U.pixelRatio!==e.pixelRatio||0!==s.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0))}var $=lc(d.horizontal)||d.vertical;e.iconsInText=!!$&&$.iconsInText,($||N)&&function(e,t,i,r,n,a,o,s,l,c,u){var h=a.textMaxSize.evaluate(t,{});void 0===h&&(h=o);var p,d=e.layers[0].layout,f=d.get("icon-offset").evaluate(t,{},u),m=lc(i.horizontal),g=o/24,_=e.tilePixelRatio*g,y=e.tilePixelRatio*h/24,v=e.tilePixelRatio*s,x=e.tilePixelRatio*d.get("symbol-spacing"),b=d.get("text-padding")*e.tilePixelRatio,w=d.get("icon-padding")*e.tilePixelRatio,M=d.get("text-max-angle")/180*Math.PI,T="map"===d.get("text-rotation-alignment")&&"point"!==d.get("symbol-placement"),E="map"===d.get("icon-rotation-alignment")&&"point"!==d.get("symbol-placement"),C=d.get("symbol-placement"),A=x/2,I=d.get("icon-text-fit");r&&"none"!==I&&(e.allowVerticalPlacement&&i.vertical&&(p=Ll(r,i.vertical,I,d.get("icon-text-fit-padding"),f,g)),m&&(r=Ll(r,m,I,d.get("icon-text-fit-padding"),f,g)));var P=function(s,h){h.x<0||h.x>=8192||h.y<0||h.y>=8192||function(e,t,i,r,n,a,o,s,l,c,u,h,p,d,f,m,g,_,y,v,x,b,w,M,T){var E,C,A,I,P,z=e.addToLineVertexArray(t,i),R=0,k=0,L=0,D=0,B=-1,F=-1,O={},N=pa(""),V=0,U=0;if(void 0===s._unevaluatedLayout.getValue("text-radial-offset")?(V=(E=s.layout.get("text-offset").evaluate(x,{},M).map((function(e){return 24*e})))[0],U=E[1]):(V=24*s.layout.get("text-radial-offset").evaluate(x,{},M),U=nc),e.allowVerticalPlacement&&r.vertical){var $=s.layout.get("text-rotate").evaluate(x,{},M)+90;I=new Jl(l,t,c,u,h,r.vertical,p,d,f,$),o&&(P=new Jl(l,t,c,u,h,o,g,_,f,$))}if(n){var j=s.layout.get("icon-rotate").evaluate(x,{}),q="none"!==s.layout.get("icon-text-fit"),G=Wl(n,j,w,q),H=o?Wl(o,j,w,q):void 0;A=new Jl(l,t,c,u,h,n,g,_,!1,j),R=4*G.length;var W=e.iconSizeData,Z=null;"source"===W.kind?(Z=[128*s.layout.get("icon-size").evaluate(x,{})])[0]>32640&&S(e.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):"composite"===W.kind&&((Z=[128*b.compositeIconSizes[0].evaluate(x,{},M),128*b.compositeIconSizes[1].evaluate(x,{},M)])[0]>32640||Z[1]>32640)&&S(e.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),e.addSymbols(e.icon,G,Z,v,y,x,!1,t,z.lineStartIndex,z.lineLength,-1,M),B=e.icon.placedSymbolArray.length-1,H&&(k=4*H.length,e.addSymbols(e.icon,H,Z,v,y,x,bl.vertical,t,z.lineStartIndex,z.lineLength,-1,M),F=e.icon.placedSymbolArray.length-1)}for(var X in r.horizontal){var Y=r.horizontal[X];if(!C){N=pa(Y.text);var K=s.layout.get("text-rotate").evaluate(x,{},M);C=new Jl(l,t,c,u,h,Y,p,d,f,K)}var J=1===Y.positionedLines.length;if(L+=sc(e,t,Y,a,s,f,x,m,z,r.vertical?bl.horizontal:bl.horizontalOnly,J?Object.keys(r.horizontal):[X],O,B,b,M),J)break}r.vertical&&(D+=sc(e,t,r.vertical,a,s,f,x,m,z,bl.vertical,["vertical"],O,F,b,M));var Q=C?C.boxStartIndex:e.collisionBoxArray.length,ee=C?C.boxEndIndex:e.collisionBoxArray.length,te=I?I.boxStartIndex:e.collisionBoxArray.length,ie=I?I.boxEndIndex:e.collisionBoxArray.length,re=A?A.boxStartIndex:e.collisionBoxArray.length,ne=A?A.boxEndIndex:e.collisionBoxArray.length,ae=P?P.boxStartIndex:e.collisionBoxArray.length,oe=P?P.boxEndIndex:e.collisionBoxArray.length,se=-1,le=function(e,t){return e&&e.circleDiameter?Math.max(e.circleDiameter,t):t};se=le(C,se),se=le(I,se),se=le(A,se);var ce=(se=le(P,se))>-1?1:0;ce&&(se*=T/24),e.glyphOffsetArray.length>=_c.MAX_GLYPHS&&S("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,x.sortKey),e.symbolInstances.emplaceBack(t.x,t.y,O.right>=0?O.right:-1,O.center>=0?O.center:-1,O.left>=0?O.left:-1,O.vertical||-1,B,F,N,Q,ee,te,ie,re,ne,ae,oe,c,L,D,R,k,ce,0,p,V,U,se)}(e,h,s,i,r,n,p,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,_,b,T,l,v,w,E,f,t,a,c,u,o)};if("line"===C)for(var z=0,R=Hl(t.geometry,0,0,8192,8192);z<R.length;z+=1)for(var k=R[z],L=0,D=Gl(k,x,M,i.vertical||m,r,24,y,e.overscaling,8192);L<D.length;L+=1){var B=D[L];m&&cc(e,m.text,A,B)||P(k,B)}else if("line-center"===C)for(var F=0,O=t.geometry;F<O.length;F+=1){var N=O[F];if(N.length>1){var V=ql(N,M,i.vertical||m,r,24,y);V&&P(N,V)}}else if("Polygon"===t.type)for(var U=0,$=rs(t.geometry,0);U<$.length;U+=1){var j=$[U],q=tc(j,16);P(j[0],new Dl(q.x,q.y,0))}else if("LineString"===t.type)for(var G=0,H=t.geometry;G<H.length;G+=1){var W=H[G];P(W,new Dl(W[0].x,W[0].y,0))}else if("Point"===t.type)for(var Z=0,X=t.geometry;Z<X.length;Z+=1)for(var Y=0,K=X[Z];Y<K.length;Y+=1){var J=K[Y];P([J],new Dl(J.x,J.y,0))}}(e,a,d,N,r,c,h,p,b,V,o)},v=0,x=e.features;v<x.length;v+=1)y();a&&e.generateCollisionDebugBuffers()},e.perspective=function(e,t,i,r,n){var a,o=1/Math.tan(t/2);return e[0]=o/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(e[10]=(n+r)*(a=1/(r-n)),e[14]=2*n*r*a):(e[10]=-1,e[14]=-2*r),e},e.pick=function(e,t){for(var i={},r=0;r<t.length;r++){var n=t[r];n in e&&(i[n]=e[n])}return i},e.plugin=on,e.polygonIntersectsPolygon=ja,e.postMapLoadEvent=oe,e.postTurnstileEvent=ne,e.potpack=_l,e.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],e.register=Fr,e.registerForPluginStateChange=function(e){return e({pluginStatus:Jr,pluginURL:Qr}),rn.on("pluginStateChange",e),e},e.renderColorRamp=bo,e.rotate=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(i),l=Math.cos(i);return e[0]=r*l+a*s,e[1]=n*l+o*s,e[2]=r*-s+a*l,e[3]=n*-s+o*l,e},e.rotateX=function(e,t,i){var r=Math.sin(i),n=Math.cos(i),a=t[4],o=t[5],s=t[6],l=t[7],c=t[8],u=t[9],h=t[10],p=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*n+c*r,e[5]=o*n+u*r,e[6]=s*n+h*r,e[7]=l*n+p*r,e[8]=c*n-a*r,e[9]=u*n-o*r,e[10]=h*n-s*r,e[11]=p*n-l*r,e},e.rotateZ=function(e,t,i){var r=Math.sin(i),n=Math.cos(i),a=t[0],o=t[1],s=t[2],l=t[3],c=t[4],u=t[5],h=t[6],p=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n+c*r,e[1]=o*n+u*r,e[2]=s*n+h*r,e[3]=l*n+p*r,e[4]=c*n-a*r,e[5]=u*n-o*r,e[6]=h*n-s*r,e[7]=p*n-l*r,e},e.scale=function(e,t,i){var r=i[0],n=i[1],a=i[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.scale$1=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e},e.scale$2=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e},e.setCacheLimits=function(e,t){se=e,le=t},e.setRTLTextPlugin=function(e,t,i){if(void 0===i&&(i=!1),"deferred"===Jr||"loading"===Jr||"loaded"===Jr)throw new Error("setRTLTextPlugin cannot be called multiple times.");Qr=O.resolveURL(e),Jr="deferred",Kr=t,tn(),i||an()},e.sphericalToCartesian=function(e){var t=e[0],i=e[1],r=e[2];return i+=90,i*=Math.PI/180,r*=Math.PI/180,{x:t*Math.cos(i)*Math.sin(r),y:t*Math.sin(i)*Math.sin(r),z:t*Math.cos(r)}},e.sqrLen=function(e){var t=e[0],i=e[1];return t*t+i*i},e.styleSpec=Ie,e.sub=function(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e},e.symbolSize=Nl,e.transformMat3=function(e,t,i){var r=t[0],n=t[1],a=t[2];return e[0]=r*i[0]+n*i[3]+a*i[6],e[1]=r*i[1]+n*i[4]+a*i[7],e[2]=r*i[2]+n*i[5]+a*i[8],e},e.transformMat4=uo,e.translate=function(e,t,i){var r,n,a,o,s,l,c,u,h,p,d,f,m=i[0],g=i[1],_=i[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*_+t[12],e[13]=t[1]*m+t[5]*g+t[9]*_+t[13],e[14]=t[2]*m+t[6]*g+t[10]*_+t[14],e[15]=t[3]*m+t[7]*g+t[11]*_+t[15]):(n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],c=t[6],u=t[7],h=t[8],p=t[9],d=t[10],f=t[11],e[0]=r=t[0],e[1]=n,e[2]=a,e[3]=o,e[4]=s,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=p,e[10]=d,e[11]=f,e[12]=r*m+s*g+h*_+t[12],e[13]=n*m+l*g+p*_+t[13],e[14]=a*m+c*g+d*_+t[14],e[15]=o*m+u*g+f*_+t[15]),e},e.triggerPluginCompletionEvent=en,e.uniqueId=f,e.validateCustomStyleLayer=function(e){var t=[],i=e.id;return void 0===i&&t.push({message:"layers."+i+': missing required property "id"'}),void 0===e.render&&t.push({message:"layers."+i+': missing required method "render"'}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:"layers."+i+': property "renderingMode" must be either "2d" or "3d"'}),t},e.validateLight=Ar,e.validateStyle=Cr,e.values=function(e){var t=[];for(var i in e)t.push(e[i]);return t},e.vectorTile=xs,e.version="1.13.0-rc.4",e.warnOnce=S,e.webpSupported=V,e.window=o,e.wrap=h})),r(["./shared"],(function(e){function t(e){var i=typeof e;if("number"===i||"boolean"===i||"string"===i||null==e)return JSON.stringify(e);if(Array.isArray(e)){for(var r="[",n=0,a=e;n<a.length;n+=1)r+=t(a[n])+",";return r+"]"}for(var o=Object.keys(e).sort(),s="{",l=0;l<o.length;l++)s+=JSON.stringify(o[l])+":"+t(e[o[l]])+",";return s+"}"}function i(i){for(var r="",n=0,a=e.refProperties;n<a.length;n+=1)r+="/"+t(i[a[n]]);return r}var r=function(e){this.keyCache={},e&&this.replace(e)};r.prototype.replace=function(e){this._layerConfigs={},this._layers={},this.update(e,[])},r.prototype.update=function(t,r){for(var n=this,a=0,o=t;a<o.length;a+=1){var s=o[a];this._layerConfigs[s.id]=s;var l=this._layers[s.id]=e.createStyleLayer(s);l._featureFilter=e.featureFilter(l.filter),this.keyCache[s.id]&&delete this.keyCache[s.id]}for(var c=0,u=r;c<u.length;c+=1){var h=u[c];delete this.keyCache[h],delete this._layerConfigs[h],delete this._layers[h]}this.familiesBySource={};for(var p=0,d=function(e,t){for(var r={},n=0;n<e.length;n++){var a=t&&t[e[n].id]||i(e[n]);t&&(t[e[n].id]=a);var o=r[a];o||(o=r[a]=[]),o.push(e[n])}var s=[];for(var l in r)s.push(r[l]);return s}(e.values(this._layerConfigs),this.keyCache);p<d.length;p+=1){var f=d[p].map((function(e){return n._layers[e.id]})),m=f[0];if("none"!==m.visibility){var g=m.source||"",_=this.familiesBySource[g];_||(_=this.familiesBySource[g]={});var y=m.sourceLayer||"_geojsonTileLayer",v=_[y];v||(v=_[y]=[]),v.push(f)}}};var n=function(t){var i={},r=[];for(var n in t){var a=t[n],o=i[n]={};for(var s in a){var l=a[+s];if(l&&0!==l.bitmap.width&&0!==l.bitmap.height){var c={x:0,y:0,w:l.bitmap.width+2,h:l.bitmap.height+2};r.push(c),o[s]={rect:c,metrics:l.metrics}}}}var u=e.potpack(r),h=new e.AlphaImage({width:u.w||1,height:u.h||1});for(var p in t){var d=t[p];for(var f in d){var m=d[+f];if(m&&0!==m.bitmap.width&&0!==m.bitmap.height){var g=i[p][f].rect;e.AlphaImage.copy(m.bitmap,h,{x:0,y:0},{x:g.x+1,y:g.y+1},m.bitmap)}}}this.image=h,this.positions=i};e.register("GlyphAtlas",n);var a=function(t){this.tileID=new e.OverscaledTileID(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.uid=t.uid,this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId};function o(t,i,r){for(var n=new e.EvaluationParameters(i),a=0,o=t;a<o.length;a+=1)o[a].recalculate(n,r)}function s(t,i){var r=e.getArrayBuffer(t.request,(function(t,r,n,a){t?i(t):r&&i(null,{vectorTile:new e.vectorTile.VectorTile(new e.pbf(r)),rawData:r,cacheControl:n,expires:a})}));return function(){r.cancel(),i()}}a.prototype.parse=function(t,i,r,a,s){var l=this;this.status="parsing",this.data=t,this.collisionBoxArray=new e.CollisionBoxArray;var c=new e.DictionaryCoder(Object.keys(t.layers).sort()),u=new e.FeatureIndex(this.tileID,this.promoteId);u.bucketLayerIDs=[];var h,p,d,f,m={},g={featureIndex:u,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:r},_=i.familiesBySource[this.source];for(var y in _){var v=t.layers[y];if(v){1===v.version&&e.warnOnce('Vector tile source "'+this.source+'" layer "'+y+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var x=c.encode(y),b=[],w=0;w<v.length;w++){var S=v.feature(w),M=u.getId(S,y);b.push({feature:S,id:M,index:w,sourceLayerIndex:x})}for(var T=0,E=_[y];T<E.length;T+=1){var C=E[T],A=C[0];A.minzoom&&this.zoom<Math.floor(A.minzoom)||A.maxzoom&&this.zoom>=A.maxzoom||"none"!==A.visibility&&(o(C,this.zoom,r),(m[A.id]=A.createBucket({index:u.bucketLayerIDs.length,layers:C,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:x,sourceID:this.source})).populate(b,g,this.tileID.canonical),u.bucketLayerIDs.push(C.map((function(e){return e.id}))))}}}var I=e.mapObject(g.glyphDependencies,(function(e){return Object.keys(e).map(Number)}));Object.keys(I).length?a.send("getGlyphs",{uid:this.uid,stacks:I},(function(e,t){h||(h=e,p=t,R.call(l))})):p={};var P=Object.keys(g.iconDependencies);P.length?a.send("getImages",{icons:P,source:this.source,tileID:this.tileID,type:"icons"},(function(e,t){h||(h=e,d=t,R.call(l))})):d={};var z=Object.keys(g.patternDependencies);function R(){if(h)return s(h);if(p&&d&&f){var t=new n(p),i=new e.ImageAtlas(d,f);for(var a in m){var l=m[a];l instanceof e.SymbolBucket?(o(l.layers,this.zoom,r),e.performSymbolLayout(l,p,t.positions,d,i.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):l.hasPattern&&(l instanceof e.LineBucket||l instanceof e.FillBucket||l instanceof e.FillExtrusionBucket)&&(o(l.layers,this.zoom,r),l.addFeatures(g,this.tileID.canonical,i.patternPositions))}this.status="done",s(null,{buckets:e.values(m).filter((function(e){return!e.isEmpty()})),featureIndex:u,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:t.image,imageAtlas:i,glyphMap:this.returnDependencies?p:null,iconMap:this.returnDependencies?d:null,glyphPositions:this.returnDependencies?t.positions:null})}}z.length?a.send("getImages",{icons:z,source:this.source,tileID:this.tileID,type:"patterns"},(function(e,t){h||(h=e,f=t,R.call(l))})):f={},R.call(this)};var l=function(e,t,i,r){this.actor=e,this.layerIndex=t,this.availableImages=i,this.loadVectorData=r||s,this.loading={},this.loaded={}};l.prototype.loadTile=function(t,i){var r=this,n=t.uid;this.loading||(this.loading={});var o=!!(t&&t.request&&t.request.collectResourceTiming)&&new e.RequestPerformance(t.request),s=this.loading[n]=new a(t);s.abort=this.loadVectorData(t,(function(t,a){if(delete r.loading[n],t||!a)return s.status="done",r.loaded[n]=s,i(t);var l=a.rawData,c={};a.expires&&(c.expires=a.expires),a.cacheControl&&(c.cacheControl=a.cacheControl);var u={};if(o){var h=o.finish();h&&(u.resourceTiming=JSON.parse(JSON.stringify(h)))}s.vectorTile=a.vectorTile,s.parse(a.vectorTile,r.layerIndex,r.availableImages,r.actor,(function(t,r){if(t||!r)return i(t);i(null,e.extend({rawTileData:l.slice(0)},r,c,u))})),r.loaded=r.loaded||{},r.loaded[n]=s}))},l.prototype.reloadTile=function(e,t){var i=this,r=this.loaded,n=e.uid,a=this;if(r&&r[n]){var o=r[n];o.showCollisionBoxes=e.showCollisionBoxes;var s=function(e,r){var n=o.reloadCallback;n&&(delete o.reloadCallback,o.parse(o.vectorTile,a.layerIndex,i.availableImages,a.actor,n)),t(e,r)};"parsing"===o.status?o.reloadCallback=s:"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}},l.prototype.abortTile=function(e,t){var i=this.loading,r=e.uid;i&&i[r]&&i[r].abort&&(i[r].abort(),delete i[r]),t()},l.prototype.removeTile=function(e,t){var i=this.loaded,r=e.uid;i&&i[r]&&delete i[r],t()};var c=e.window.ImageBitmap,u=function(){this.loaded={}};function h(e,t){if(0!==e.length){p(e[0],t);for(var i=1;i<e.length;i++)p(e[i],!t)}}function p(e,t){for(var i=0,r=0,n=e.length,a=n-1;r<n;a=r++)i+=(e[r][0]-e[a][0])*(e[a][1]+e[r][1]);i>=0!=!!t&&e.reverse()}u.prototype.loadTile=function(t,i){var r=t.uid,n=t.encoding,a=t.rawImageData,o=c&&a instanceof c?this.getImageData(a):a,s=new e.DEMData(r,o,n);this.loaded=this.loaded||{},this.loaded[r]=s,i(null,s)},u.prototype.getImageData=function(t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(t.width,t.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=t.width,this.offscreenCanvas.height=t.height,this.offscreenCanvasContext.drawImage(t,0,0,t.width,t.height);var i=this.offscreenCanvasContext.getImageData(-1,-1,t.width+2,t.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new e.RGBAImage({width:i.width,height:i.height},i.data)},u.prototype.removeTile=function(e){var t=this.loaded,i=e.uid;t&&t[i]&&delete t[i]};var d=e.vectorTile.VectorTileFeature.prototype.toGeoJSON,f=function(t){this._feature=t,this.extent=e.EXTENT,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))};f.prototype.loadGeometry=function(){if(1===this._feature.type){for(var t=[],i=0,r=this._feature.geometry;i<r.length;i+=1){var n=r[i];t.push([new e.Point$1(n[0],n[1])])}return t}for(var a=[],o=0,s=this._feature.geometry;o<s.length;o+=1){for(var l=[],c=0,u=s[o];c<u.length;c+=1){var h=u[c];l.push(new e.Point$1(h[0],h[1]))}a.push(l)}return a},f.prototype.toGeoJSON=function(e,t,i){return d.call(this,e,t,i)};var m=function(t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=e.EXTENT,this.length=t.length,this._features=t};m.prototype.feature=function(e){return new f(this._features[e])};var g=e.vectorTile.VectorTileFeature,_=y;function y(e,t){this.options=t||{},this.features=e,this.length=e.length}function v(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}y.prototype.feature=function(e){return new v(this.features[e],this.options.extent)},v.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var i=0;i<t.length;i++){for(var r=t[i],n=[],a=0;a<r.length;a++)n.push(new e.Point$1(r[a][0],r[a][1]));this.geometry.push(n)}return this.geometry},v.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,i=-1/0,r=1/0,n=-1/0,a=0;a<e.length;a++)for(var o=e[a],s=0;s<o.length;s++){var l=o[s];t=Math.min(t,l.x),i=Math.max(i,l.x),r=Math.min(r,l.y),n=Math.max(n,l.y)}return[t,r,i,n]},v.prototype.toGeoJSON=g.prototype.toGeoJSON;var x=w,b=_;function w(t){var i=new e.pbf;return function(e,t){for(var i in e.layers)t.writeMessage(3,S,e.layers[i])}(t,i),i.finish()}function S(e,t){var i;t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);var r={keys:[],values:[],keycache:{},valuecache:{}};for(i=0;i<e.length;i++)r.feature=e.feature(i),t.writeMessage(2,M,r);var n=r.keys;for(i=0;i<n.length;i++)t.writeStringField(3,n[i]);var a=r.values;for(i=0;i<a.length;i++)t.writeMessage(4,I,a[i])}function M(e,t){var i=e.feature;void 0!==i.id&&t.writeVarintField(1,i.id),t.writeMessage(2,T,e),t.writeVarintField(3,i.type),t.writeMessage(4,A,i)}function T(e,t){var i=e.feature,r=e.keys,n=e.values,a=e.keycache,o=e.valuecache;for(var s in i.properties){var l=a[s];void 0===l&&(r.push(s),a[s]=l=r.length-1),t.writeVarint(l);var c=i.properties[s],u=typeof c;"string"!==u&&"boolean"!==u&&"number"!==u&&(c=JSON.stringify(c));var h=u+":"+c,p=o[h];void 0===p&&(n.push(c),o[h]=p=n.length-1),t.writeVarint(p)}}function E(e,t){return(t<<3)+(7&e)}function C(e){return e<<1^e>>31}function A(e,t){for(var i=e.loadGeometry(),r=e.type,n=0,a=0,o=i.length,s=0;s<o;s++){var l=i[s],c=1;1===r&&(c=l.length),t.writeVarint(E(1,c));for(var u=3===r?l.length-1:l.length,h=0;h<u;h++){1===h&&1!==r&&t.writeVarint(E(2,u-1));var p=l[h].x-n,d=l[h].y-a;t.writeVarint(C(p)),t.writeVarint(C(d)),n+=p,a+=d}3===r&&t.writeVarint(E(7,1))}}function I(e,t){var i=typeof e;"string"===i?t.writeStringField(1,e):"boolean"===i?t.writeBooleanField(7,e):"number"===i&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}function P(e,t,i,r){z(e,i,r),z(t,2*i,2*r),z(t,2*i+1,2*r+1)}function z(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}function R(e,t,i,r){var n=e-i,a=t-r;return n*n+a*a}x.fromVectorTileJs=w,x.fromGeojsonVt=function(e,t){t=t||{};var i={};for(var r in e)i[r]=new _(e[r].features,t),i[r].name=r,i[r].version=t.version,i[r].extent=t.extent;return w({layers:i})},x.GeoJSONWrapper=b;var k=function(e){return e[0]},L=function(e){return e[1]},D=function(e,t,i,r,n){void 0===t&&(t=k),void 0===i&&(i=L),void 0===r&&(r=64),void 0===n&&(n=Float64Array),this.nodeSize=r,this.points=e;for(var a=e.length<65536?Uint16Array:Uint32Array,o=this.ids=new a(e.length),s=this.coords=new n(2*e.length),l=0;l<e.length;l++)o[l]=l,s[2*l]=t(e[l]),s[2*l+1]=i(e[l]);!function e(t,i,r,n,a,o){if(!(a-n<=r)){var s=n+a>>1;!function e(t,i,r,n,a,o){for(;a>n;){if(a-n>600){var s=a-n+1,l=r-n+1,c=Math.log(s),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(s-u)/s)*(l-s/2<0?-1:1);e(t,i,r,Math.max(n,Math.floor(r-l*u/s+h)),Math.min(a,Math.floor(r+(s-l)*u/s+h)),o)}var p=i[2*r+o],d=n,f=a;for(P(t,i,n,r),i[2*a+o]>p&&P(t,i,n,a);d<f;){for(P(t,i,d,f),d++,f--;i[2*d+o]<p;)d++;for(;i[2*f+o]>p;)f--}i[2*n+o]===p?P(t,i,n,f):P(t,i,++f,a),f<=r&&(n=f+1),r<=f&&(a=f-1)}}(t,i,s,n,a,o%2),e(t,i,r,n,s-1,o+1),e(t,i,r,s+1,a,o+1)}}(o,s,r,0,o.length-1,0)};D.prototype.range=function(e,t,i,r){return function(e,t,i,r,n,a,o){for(var s,l,c=[0,e.length-1,0],u=[];c.length;){var h=c.pop(),p=c.pop(),d=c.pop();if(p-d<=o)for(var f=d;f<=p;f++)l=t[2*f+1],(s=t[2*f])>=i&&s<=n&&l>=r&&l<=a&&u.push(e[f]);else{var m=Math.floor((d+p)/2);l=t[2*m+1],(s=t[2*m])>=i&&s<=n&&l>=r&&l<=a&&u.push(e[m]);var g=(h+1)%2;(0===h?i<=s:r<=l)&&(c.push(d),c.push(m-1),c.push(g)),(0===h?n>=s:a>=l)&&(c.push(m+1),c.push(p),c.push(g))}}return u}(this.ids,this.coords,e,t,i,r,this.nodeSize)},D.prototype.within=function(e,t,i){return function(e,t,i,r,n,a){for(var o=[0,e.length-1,0],s=[],l=n*n;o.length;){var c=o.pop(),u=o.pop(),h=o.pop();if(u-h<=a)for(var p=h;p<=u;p++)R(t[2*p],t[2*p+1],i,r)<=l&&s.push(e[p]);else{var d=Math.floor((h+u)/2),f=t[2*d],m=t[2*d+1];R(f,m,i,r)<=l&&s.push(e[d]);var g=(c+1)%2;(0===c?i-n<=f:r-n<=m)&&(o.push(h),o.push(d-1),o.push(g)),(0===c?i+n>=f:r+n>=m)&&(o.push(d+1),o.push(u),o.push(g))}}return s}(this.ids,this.coords,e,t,i,this.nodeSize)};var B={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(e){return e}},F=function(e){this.options=q(Object.create(B),e),this.trees=new Array(this.options.maxZoom+1)};function O(e,t,i,r,n){return{x:e,y:t,zoom:1/0,id:i,parentId:-1,numPoints:r,properties:n}}function N(e,t){var i=e.geometry.coordinates,r=i[1];return{x:$(i[0]),y:j(r),zoom:1/0,index:t,parentId:-1}}function V(e){return{type:"Feature",id:e.id,properties:U(e),geometry:{type:"Point",coordinates:[(r=e.x,360*(r-.5)),(t=e.y,i=(180-360*t)*Math.PI/180,360*Math.atan(Math.exp(i))/Math.PI-90)]}};var t,i,r}function U(e){var t=e.numPoints,i=t>=1e4?Math.round(t/1e3)+"k":t>=1e3?Math.round(t/100)/10+"k":t;return q(q({},e.properties),{cluster:!0,cluster_id:e.id,point_count:t,point_count_abbreviated:i})}function $(e){return e/360+.5}function j(e){var t=Math.sin(e*Math.PI/180),i=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return i<0?0:i>1?1:i}function q(e,t){for(var i in t)e[i]=t[i];return e}function G(e){return e.x}function H(e){return e.y}function W(e,t,i,r,n,a){var o=n-i,s=a-r;if(0!==o||0!==s){var l=((e-i)*o+(t-r)*s)/(o*o+s*s);l>1?(i=n,r=a):l>0&&(i+=o*l,r+=s*l)}return(o=e-i)*o+(s=t-r)*s}function Z(e,t,i,r){var n={id:void 0===e?null:e,type:t,geometry:i,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,i=e.type;if("Point"===i||"MultiPoint"===i||"LineString"===i)X(e,t);else if("Polygon"===i||"MultiLineString"===i)for(var r=0;r<t.length;r++)X(e,t[r]);else if("MultiPolygon"===i)for(r=0;r<t.length;r++)for(var n=0;n<t[r].length;n++)X(e,t[r][n])}(n),n}function X(e,t){for(var i=0;i<t.length;i+=3)e.minX=Math.min(e.minX,t[i]),e.minY=Math.min(e.minY,t[i+1]),e.maxX=Math.max(e.maxX,t[i]),e.maxY=Math.max(e.maxY,t[i+1])}function Y(e,t,i,r){if(t.geometry){var n=t.geometry.coordinates,a=t.geometry.type,o=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2),s=[],l=t.id;if(i.promoteId?l=t.properties[i.promoteId]:i.generateId&&(l=r||0),"Point"===a)K(n,s);else if("MultiPoint"===a)for(var c=0;c<n.length;c++)K(n[c],s);else if("LineString"===a)J(n,s,o,!1);else if("MultiLineString"===a){if(i.lineMetrics){for(c=0;c<n.length;c++)J(n[c],s=[],o,!1),e.push(Z(l,"LineString",s,t.properties));return}Q(n,s,o,!1)}else if("Polygon"===a)Q(n,s,o,!0);else{if("MultiPolygon"!==a){if("GeometryCollection"===a){for(c=0;c<t.geometry.geometries.length;c++)Y(e,{id:l,geometry:t.geometry.geometries[c],properties:t.properties},i,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(c=0;c<n.length;c++){var u=[];Q(n[c],u,o,!0),s.push(u)}}e.push(Z(l,a,s,t.properties))}}function K(e,t){t.push(ee(e[0])),t.push(te(e[1])),t.push(0)}function J(e,t,i,r){for(var n,a,o=0,s=0;s<e.length;s++){var l=ee(e[s][0]),c=te(e[s][1]);t.push(l),t.push(c),t.push(0),s>0&&(o+=r?(n*c-l*a)/2:Math.sqrt(Math.pow(l-n,2)+Math.pow(c-a,2))),n=l,a=c}var u=t.length-3;t[2]=1,function e(t,i,r,n){for(var a,o=n,s=r-i>>1,l=r-i,c=t[i],u=t[i+1],h=t[r],p=t[r+1],d=i+3;d<r;d+=3){var f=W(t[d],t[d+1],c,u,h,p);if(f>o)a=d,o=f;else if(f===o){var m=Math.abs(d-s);m<l&&(a=d,l=m)}}o>n&&(a-i>3&&e(t,i,a,n),t[a+2]=o,r-a>3&&e(t,a,r,n))}(t,0,u,i),t[u+2]=1,t.size=Math.abs(o),t.start=0,t.end=t.size}function Q(e,t,i,r){for(var n=0;n<e.length;n++){var a=[];J(e[n],a,i,r),t.push(a)}}function ee(e){return e/360+.5}function te(e){var t=Math.sin(e*Math.PI/180),i=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return i<0?0:i>1?1:i}function ie(e,t,i,r,n,a,o,s){if(r/=t,a>=(i/=t)&&o<r)return e;if(o<i||a>=r)return null;for(var l=[],c=0;c<e.length;c++){var u=e[c],h=u.geometry,p=u.type,d=0===n?u.minX:u.minY,f=0===n?u.maxX:u.maxY;if(d>=i&&f<r)l.push(u);else if(!(f<i||d>=r)){var m=[];if("Point"===p||"MultiPoint"===p)re(h,m,i,r,n);else if("LineString"===p)ne(h,m,i,r,n,!1,s.lineMetrics);else if("MultiLineString"===p)oe(h,m,i,r,n,!1);else if("Polygon"===p)oe(h,m,i,r,n,!0);else if("MultiPolygon"===p)for(var g=0;g<h.length;g++){var _=[];oe(h[g],_,i,r,n,!0),_.length&&m.push(_)}if(m.length){if(s.lineMetrics&&"LineString"===p){for(g=0;g<m.length;g++)l.push(Z(u.id,p,m[g],u.tags));continue}"LineString"!==p&&"MultiLineString"!==p||(1===m.length?(p="LineString",m=m[0]):p="MultiLineString"),"Point"!==p&&"MultiPoint"!==p||(p=3===m.length?"Point":"MultiPoint"),l.push(Z(u.id,p,m,u.tags))}}}return l.length?l:null}function re(e,t,i,r,n){for(var a=0;a<e.length;a+=3){var o=e[a+n];o>=i&&o<=r&&(t.push(e[a]),t.push(e[a+1]),t.push(e[a+2]))}}function ne(e,t,i,r,n,a,o){for(var s,l,c=ae(e),u=0===n?le:ce,h=e.start,p=0;p<e.length-3;p+=3){var d=e[p],f=e[p+1],m=e[p+2],g=e[p+3],_=e[p+4],y=0===n?d:f,v=0===n?g:_,x=!1;o&&(s=Math.sqrt(Math.pow(d-g,2)+Math.pow(f-_,2))),y<i?v>i&&(l=u(c,d,f,g,_,i),o&&(c.start=h+s*l)):y>r?v<r&&(l=u(c,d,f,g,_,r),o&&(c.start=h+s*l)):se(c,d,f,m),v<i&&y>=i&&(l=u(c,d,f,g,_,i),x=!0),v>r&&y<=r&&(l=u(c,d,f,g,_,r),x=!0),!a&&x&&(o&&(c.end=h+s*l),t.push(c),c=ae(e)),o&&(h+=s)}var b=e.length-3;d=e[b],f=e[b+1],m=e[b+2],(y=0===n?d:f)>=i&&y<=r&&se(c,d,f,m),b=c.length-3,a&&b>=3&&(c[b]!==c[0]||c[b+1]!==c[1])&&se(c,c[0],c[1],c[2]),c.length&&t.push(c)}function ae(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function oe(e,t,i,r,n,a){for(var o=0;o<e.length;o++)ne(e[o],t,i,r,n,a,!1)}function se(e,t,i,r){e.push(t),e.push(i),e.push(r)}function le(e,t,i,r,n,a){var o=(a-t)/(r-t);return e.push(a),e.push(i+(n-i)*o),e.push(1),o}function ce(e,t,i,r,n,a){var o=(a-i)/(n-i);return e.push(t+(r-t)*o),e.push(a),e.push(1),o}function ue(e,t){for(var i=[],r=0;r<e.length;r++){var n,a=e[r],o=a.type;if("Point"===o||"MultiPoint"===o||"LineString"===o)n=he(a.geometry,t);else if("MultiLineString"===o||"Polygon"===o){n=[];for(var s=0;s<a.geometry.length;s++)n.push(he(a.geometry[s],t))}else if("MultiPolygon"===o)for(n=[],s=0;s<a.geometry.length;s++){for(var l=[],c=0;c<a.geometry[s].length;c++)l.push(he(a.geometry[s][c],t));n.push(l)}i.push(Z(a.id,o,n,a.tags))}return i}function he(e,t){var i=[];i.size=e.size,void 0!==e.start&&(i.start=e.start,i.end=e.end);for(var r=0;r<e.length;r+=3)i.push(e[r]+t,e[r+1],e[r+2]);return i}function pe(e,t){if(e.transformed)return e;var i,r,n,a=1<<e.z,o=e.x,s=e.y;for(i=0;i<e.features.length;i++){var l=e.features[i],c=l.geometry,u=l.type;if(l.geometry=[],1===u)for(r=0;r<c.length;r+=2)l.geometry.push(de(c[r],c[r+1],t,a,o,s));else for(r=0;r<c.length;r++){var h=[];for(n=0;n<c[r].length;n+=2)h.push(de(c[r][n],c[r][n+1],t,a,o,s));l.geometry.push(h)}}return e.transformed=!0,e}function de(e,t,i,r,n,a){return[Math.round(i*(e*r-n)),Math.round(i*(t*r-a))]}function fe(e,t,i,r,n){for(var a=t===n.maxZoom?0:n.tolerance/((1<<t)*n.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:i,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){o.numFeatures++,me(o,e[s],a,n);var l=e[s].minX,c=e[s].minY,u=e[s].maxX,h=e[s].maxY;l<o.minX&&(o.minX=l),c<o.minY&&(o.minY=c),u>o.maxX&&(o.maxX=u),h>o.maxY&&(o.maxY=h)}return o}function me(e,t,i,r){var n=t.geometry,a=t.type,o=[];if("Point"===a||"MultiPoint"===a)for(var s=0;s<n.length;s+=3)o.push(n[s]),o.push(n[s+1]),e.numPoints++,e.numSimplified++;else if("LineString"===a)ge(o,n,e,i,!1,!1);else if("MultiLineString"===a||"Polygon"===a)for(s=0;s<n.length;s++)ge(o,n[s],e,i,"Polygon"===a,0===s);else if("MultiPolygon"===a)for(var l=0;l<n.length;l++){var c=n[l];for(s=0;s<c.length;s++)ge(o,c[s],e,i,!0,0===s)}if(o.length){var u=t.tags||null;if("LineString"===a&&r.lineMetrics){for(var h in u={},t.tags)u[h]=t.tags[h];u.mapbox_clip_start=n.start/n.size,u.mapbox_clip_end=n.end/n.size}var p={geometry:o,type:"Polygon"===a||"MultiPolygon"===a?3:"LineString"===a||"MultiLineString"===a?2:1,tags:u};null!==t.id&&(p.id=t.id),e.features.push(p)}}function ge(e,t,i,r,n,a){var o=r*r;if(r>0&&t.size<(n?o:r))i.numPoints+=t.length/3;else{for(var s=[],l=0;l<t.length;l+=3)(0===r||t[l+2]>o)&&(i.numSimplified++,s.push(t[l]),s.push(t[l+1])),i.numPoints++;n&&function(e,t){for(var i=0,r=0,n=e.length,a=n-2;r<n;a=r,r+=2)i+=(e[r]-e[a])*(e[r+1]+e[a+1]);if(i>0===t)for(r=0,n=e.length;r<n/2;r+=2){var o=e[r],s=e[r+1];e[r]=e[n-2-r],e[r+1]=e[n-1-r],e[n-2-r]=o,e[n-1-r]=s}}(s,a),e.push(s)}}function _e(e,t){var i=(t=this.options=function(e,t){for(var i in t)e[i]=t[i];return e}(Object.create(this.options),t)).debug;if(i&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(e,t){var i=[];if("FeatureCollection"===e.type)for(var r=0;r<e.features.length;r++)Y(i,e.features[r],t,r);else Y(i,"Feature"===e.type?e:{geometry:e},t);return i}(e,t);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(r=function(e,t){var i=t.buffer/t.extent,r=e,n=ie(e,1,-1-i,i,0,-1,2,t),a=ie(e,1,1-i,2+i,0,-1,2,t);return(n||a)&&(r=ie(e,1,-i,1+i,0,-1,2,t)||[],n&&(r=ue(n,1).concat(r)),a&&(r=r.concat(ue(a,-1)))),r}(r,t)).length&&this.splitTile(r,0,0,0),i&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ye(e,t,i){return 32*((1<<e)*i+t)+e}function ve(e,t){var i=e.tileID.canonical;if(!this._geoJSONIndex)return t(null,null);var r=this._geoJSONIndex.getTile(i.z,i.x,i.y);if(!r)return t(null,null);var n=new m(r.features),a=x(n);0===a.byteOffset&&a.byteLength===a.buffer.byteLength||(a=new Uint8Array(a)),t(null,{vectorTile:n,rawData:a.buffer})}F.prototype.load=function(e){var t=this.options,i=t.log,r=t.minZoom,n=t.maxZoom,a=t.nodeSize;i&&console.time("total time");var o="prepare "+e.length+" points";i&&console.time(o),this.points=e;for(var s=[],l=0;l<e.length;l++)e[l].geometry&&s.push(N(e[l],l));this.trees[n+1]=new D(s,G,H,a,Float32Array),i&&console.timeEnd(o);for(var c=n;c>=r;c--){var u=+Date.now();s=this._cluster(s,c),this.trees[c]=new D(s,G,H,a,Float32Array),i&&console.log("z%d: %d clusters in %dms",c,s.length,+Date.now()-u)}return i&&console.timeEnd("total time"),this},F.prototype.getClusters=function(e,t){var i=((e[0]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,e[1])),n=180===e[2]?180:((e[2]+180)%360+360)%360-180,a=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)i=-180,n=180;else if(i>n){var o=this.getClusters([i,r,180,a],t),s=this.getClusters([-180,r,n,a],t);return o.concat(s)}for(var l=this.trees[this._limitZoom(t)],c=[],u=0,h=l.range($(i),j(a),$(n),j(r));u<h.length;u+=1){var p=l.points[h[u]];c.push(p.numPoints?V(p):this.points[p.index])}return c},F.prototype.getChildren=function(e){var t=this._getOriginId(e),i=this._getOriginZoom(e),r="No cluster with the specified id.",n=this.trees[i];if(!n)throw new Error(r);var a=n.points[t];if(!a)throw new Error(r);for(var o=this.options.radius/(this.options.extent*Math.pow(2,i-1)),s=[],l=0,c=n.within(a.x,a.y,o);l<c.length;l+=1){var u=n.points[c[l]];u.parentId===e&&s.push(u.numPoints?V(u):this.points[u.index])}if(0===s.length)throw new Error(r);return s},F.prototype.getLeaves=function(e,t,i){var r=[];return this._appendLeaves(r,e,t=t||10,i=i||0,0),r},F.prototype.getTile=function(e,t,i){var r=this.trees[this._limitZoom(e)],n=Math.pow(2,e),a=this.options,o=a.radius/a.extent,s=(i-o)/n,l=(i+1+o)/n,c={features:[]};return this._addTileFeatures(r.range((t-o)/n,s,(t+1+o)/n,l),r.points,t,i,n,c),0===t&&this._addTileFeatures(r.range(1-o/n,s,1,l),r.points,n,i,n,c),t===n-1&&this._addTileFeatures(r.range(0,s,o/n,l),r.points,-1,i,n,c),c.features.length?c:null},F.prototype.getClusterExpansionZoom=function(e){for(var t=this._getOriginZoom(e)-1;t<=this.options.maxZoom;){var i=this.getChildren(e);if(t++,1!==i.length)break;e=i[0].properties.cluster_id}return t},F.prototype._appendLeaves=function(e,t,i,r,n){for(var a=0,o=this.getChildren(t);a<o.length;a+=1){var s=o[a],l=s.properties;if(l&&l.cluster?n+l.point_count<=r?n+=l.point_count:n=this._appendLeaves(e,l.cluster_id,i,r,n):n<r?n++:e.push(s),e.length===i)break}return n},F.prototype._addTileFeatures=function(e,t,i,r,n,a){for(var o=0,s=e;o<s.length;o+=1){var l=t[s[o]],c=l.numPoints,u={type:1,geometry:[[Math.round(this.options.extent*(l.x*n-i)),Math.round(this.options.extent*(l.y*n-r))]],tags:c?U(l):this.points[l.index].properties},h=void 0;c?h=l.id:this.options.generateId?h=l.index:this.points[l.index].id&&(h=this.points[l.index].id),void 0!==h&&(u.id=h),a.features.push(u)}},F.prototype._limitZoom=function(e){return Math.max(this.options.minZoom,Math.min(+e,this.options.maxZoom+1))},F.prototype._cluster=function(e,t){for(var i=[],r=this.options,n=r.reduce,a=r.minPoints,o=r.radius/(r.extent*Math.pow(2,t)),s=0;s<e.length;s++){var l=e[s];if(!(l.zoom<=t)){l.zoom=t;for(var c=this.trees[t+1],u=c.within(l.x,l.y,o),h=l.numPoints||1,p=h,d=0,f=u;d<f.length;d+=1){var m=c.points[f[d]];m.zoom>t&&(p+=m.numPoints||1)}if(p>=a){for(var g=l.x*h,_=l.y*h,y=n&&h>1?this._map(l,!0):null,v=(s<<5)+(t+1)+this.points.length,x=0,b=u;x<b.length;x+=1){var w=c.points[b[x]];if(!(w.zoom<=t)){w.zoom=t;var S=w.numPoints||1;g+=w.x*S,_+=w.y*S,w.parentId=v,n&&(y||(y=this._map(l,!0)),n(y,this._map(w)))}}l.parentId=v,i.push(O(g/p,_/p,v,p,y))}else if(i.push(l),p>1)for(var M=0,T=u;M<T.length;M+=1){var E=c.points[T[M]];E.zoom<=t||(E.zoom=t,i.push(E))}}}return i},F.prototype._getOriginId=function(e){return e-this.points.length>>5},F.prototype._getOriginZoom=function(e){return(e-this.points.length)%32},F.prototype._map=function(e,t){if(e.numPoints)return t?q({},e.properties):e.properties;var i=this.points[e.index].properties,r=this.options.map(i);return t&&r===i?q({},r):r},_e.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},_e.prototype.splitTile=function(e,t,i,r,n,a,o){for(var s=[e,t,i,r],l=this.options,c=l.debug;s.length;){r=s.pop(),i=s.pop(),t=s.pop(),e=s.pop();var u=1<<t,h=ye(t,i,r),p=this.tiles[h];if(!p&&(c>1&&console.time("creation"),p=this.tiles[h]=fe(e,t,i,r,l),this.tileCoords.push({z:t,x:i,y:r}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,i,r,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var d="z"+t;this.stats[d]=(this.stats[d]||0)+1,this.total++}if(p.source=e,n){if(t===l.maxZoom||t===n)continue;var f=1<<n-t;if(i!==Math.floor(a/f)||r!==Math.floor(o/f))continue}else if(t===l.indexMaxZoom||p.numPoints<=l.indexMaxPoints)continue;if(p.source=null,0!==e.length){c>1&&console.time("clipping");var m,g,_,y,v,x,b=.5*l.buffer/l.extent,w=.5-b,S=.5+b,M=1+b;m=g=_=y=null,v=ie(e,u,i-b,i+S,0,p.minX,p.maxX,l),x=ie(e,u,i+w,i+M,0,p.minX,p.maxX,l),e=null,v&&(m=ie(v,u,r-b,r+S,1,p.minY,p.maxY,l),g=ie(v,u,r+w,r+M,1,p.minY,p.maxY,l),v=null),x&&(_=ie(x,u,r-b,r+S,1,p.minY,p.maxY,l),y=ie(x,u,r+w,r+M,1,p.minY,p.maxY,l),x=null),c>1&&console.timeEnd("clipping"),s.push(m||[],t+1,2*i,2*r),s.push(g||[],t+1,2*i,2*r+1),s.push(_||[],t+1,2*i+1,2*r),s.push(y||[],t+1,2*i+1,2*r+1)}}},_e.prototype.getTile=function(e,t,i){var r=this.options,n=r.extent,a=r.debug;if(e<0||e>24)return null;var o=1<<e,s=ye(e,t=(t%o+o)%o,i);if(this.tiles[s])return pe(this.tiles[s],n);a>1&&console.log("drilling down to z%d-%d-%d",e,t,i);for(var l,c=e,u=t,h=i;!l&&c>0;)c--,u=Math.floor(u/2),h=Math.floor(h/2),l=this.tiles[ye(c,u,h)];return l&&l.source?(a>1&&console.log("found parent tile z%d-%d-%d",c,u,h),a>1&&console.time("drilling down"),this.splitTile(l.source,c,u,h,e,t,i),a>1&&console.timeEnd("drilling down"),this.tiles[s]?pe(this.tiles[s],n):null):null};var xe=function(t){function i(e,i,r,n){t.call(this,e,i,r,ve),n&&(this.loadGeoJSON=n)}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.loadData=function(e,t){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=t,this._pendingLoadDataParams=e,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},i.prototype._loadData=function(){var t=this;if(this._pendingCallback&&this._pendingLoadDataParams){var i=this._pendingCallback,r=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var n=!!(r&&r.request&&r.request.collectResourceTiming)&&new e.RequestPerformance(r.request);this.loadGeoJSON(r,(function(a,o){if(a||!o)return i(a);if("object"!=typeof o)return i(new Error("Input data given to '"+r.source+"' is not a valid GeoJSON object."));!function e(t,i){var r,n=t&&t.type;if("FeatureCollection"===n)for(r=0;r<t.features.length;r++)e(t.features[r],i);else if("GeometryCollection"===n)for(r=0;r<t.geometries.length;r++)e(t.geometries[r],i);else if("Feature"===n)e(t.geometry,i);else if("Polygon"===n)h(t.coordinates,i);else if("MultiPolygon"===n)for(r=0;r<t.coordinates.length;r++)h(t.coordinates[r],i);return t}(o,!0);try{if(r.filter){var s=e.createExpression(r.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===s.result)throw new Error(s.value.map((function(e){return e.key+": "+e.message})).join(", "));var l=o.features.filter((function(e){return s.value.evaluate({zoom:0},e)}));o={type:"FeatureCollection",features:l}}t._geoJSONIndex=r.cluster?new F(function(t){var i=t.superclusterOptions,r=t.clusterProperties;if(!r||!i)return i;for(var n={},a={},o={accumulated:null,zoom:0},s={properties:null},l=Object.keys(r),c=0,u=l;c<u.length;c+=1){var h=u[c],p=r[h],d=p[0],f=e.createExpression(p[1]),m=e.createExpression("string"==typeof d?[d,["accumulated"],["get",h]]:d);n[h]=f.value,a[h]=m.value}return i.map=function(e){s.properties=e;for(var t={},i=0,r=l;i<r.length;i+=1){var a=r[i];t[a]=n[a].evaluate(o,s)}return t},i.reduce=function(e,t){s.properties=t;for(var i=0,r=l;i<r.length;i+=1){var n=r[i];o.accumulated=e[n],e[n]=a[n].evaluate(o,s)}},i}(r)).load(o.features):function(e,t){return new _e(e,t)}(o,r.geojsonVtOptions)}catch(a){return i(a)}t.loaded={};var c={};if(n){var u=n.finish();u&&(c.resourceTiming={},c.resourceTiming[r.source]=JSON.parse(JSON.stringify(u)))}i(null,c)}))}},i.prototype.coalesce=function(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())},i.prototype.reloadTile=function(e,i){var r=this.loaded;return r&&r[e.uid]?t.prototype.reloadTile.call(this,e,i):this.loadTile(e,i)},i.prototype.loadGeoJSON=function(t,i){if(t.request)e.getJSON(t.request,i);else{if("string"!=typeof t.data)return i(new Error("Input data given to '"+t.source+"' is not a valid GeoJSON object."));try{return i(null,JSON.parse(t.data))}catch(e){return i(new Error("Input data given to '"+t.source+"' is not a valid GeoJSON object."))}}},i.prototype.removeSource=function(e,t){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),t()},i.prototype.getClusterExpansionZoom=function(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}},i.prototype.getClusterChildren=function(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}},i.prototype.getClusterLeaves=function(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}},i}(l),be=function(t){var i=this;this.self=t,this.actor=new e.Actor(t,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:l,geojson:xe},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(e,t){if(i.workerSourceTypes[e])throw new Error('Worker source with name "'+e+'" already registered.');i.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=function(t){if(e.plugin.isParsed())throw new Error("RTL text plugin already registered.");e.plugin.applyArabicShaping=t.applyArabicShaping,e.plugin.processBidirectionalText=t.processBidirectionalText,e.plugin.processStyledBidirectionalText=t.processStyledBidirectionalText}};return be.prototype.setReferrer=function(e,t){this.referrer=t},be.prototype.setImages=function(e,t,i){for(var r in this.availableImages[e]=t,this.workerSources[e]){var n=this.workerSources[e][r];for(var a in n)n[a].availableImages=t}i()},be.prototype.setLayers=function(e,t,i){this.getLayerIndex(e).replace(t),i()},be.prototype.updateLayers=function(e,t,i){this.getLayerIndex(e).update(t.layers,t.removedIds),i()},be.prototype.loadTile=function(e,t,i){this.getWorkerSource(e,t.type,t.source).loadTile(t,i)},be.prototype.loadDEMTile=function(e,t,i){this.getDEMWorkerSource(e,t.source).loadTile(t,i)},be.prototype.reloadTile=function(e,t,i){this.getWorkerSource(e,t.type,t.source).reloadTile(t,i)},be.prototype.abortTile=function(e,t,i){this.getWorkerSource(e,t.type,t.source).abortTile(t,i)},be.prototype.removeTile=function(e,t,i){this.getWorkerSource(e,t.type,t.source).removeTile(t,i)},be.prototype.removeDEMTile=function(e,t){this.getDEMWorkerSource(e,t.source).removeTile(t)},be.prototype.removeSource=function(e,t,i){if(this.workerSources[e]&&this.workerSources[e][t.type]&&this.workerSources[e][t.type][t.source]){var r=this.workerSources[e][t.type][t.source];delete this.workerSources[e][t.type][t.source],void 0!==r.removeSource?r.removeSource(t,i):i()}},be.prototype.loadWorkerSource=function(e,t,i){try{this.self.importScripts(t.url),i()}catch(e){i(e.toString())}},be.prototype.syncRTLPluginState=function(t,i,r){try{e.plugin.setState(i);var n=e.plugin.getPluginURL();if(e.plugin.isLoaded()&&!e.plugin.isParsed()&&null!=n){this.self.importScripts(n);var a=e.plugin.isParsed();r(a?void 0:new Error("RTL Text Plugin failed to import scripts from "+n),a)}}catch(e){r(e.toString())}},be.prototype.getAvailableImages=function(e){var t=this.availableImages[e];return t||(t=[]),t},be.prototype.getLayerIndex=function(e){var t=this.layerIndexes[e];return t||(t=this.layerIndexes[e]=new r),t},be.prototype.getWorkerSource=function(e,t,i){var r=this;return this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][t]||(this.workerSources[e][t]={}),this.workerSources[e][t][i]||(this.workerSources[e][t][i]=new this.workerSourceTypes[t]({send:function(t,i,n){r.actor.send(t,i,n,e)}},this.getLayerIndex(e),this.getAvailableImages(e))),this.workerSources[e][t][i]},be.prototype.getDEMWorkerSource=function(e,t){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][t]||(this.demWorkerSources[e][t]=new u),this.demWorkerSources[e][t]},be.prototype.enforceCacheSizeLimit=function(t,i){e.enforceCacheSizeLimit(i)},"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new be(self)),be})),r(["./shared"],(function(e){var t=e.createCommonjsModule((function(e){function t(e){return!i(e)}function i(e){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var e,t,i=new Blob([""],{type:"text/javascript"}),r=URL.createObjectURL(i);try{t=new Worker(r),e=!0}catch(t){e=!1}return t&&t.terminate(),URL.revokeObjectURL(r),e}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(!t)return!1;var i=t.getImageData(0,0,1,1);return i&&i.width===e.width}()?(void 0===r[i=e&&e.failIfMajorPerformanceCaveat]&&(r[i]=function(e){var i=function(e){var i=document.createElement("canvas"),r=Object.create(t.webGLContextAttributes);return r.failIfMajorPerformanceCaveat=e,i.probablySupportsContext?i.probablySupportsContext("webgl",r)||i.probablySupportsContext("experimental-webgl",r):i.supportsContext?i.supportsContext("webgl",r)||i.supportsContext("experimental-webgl",r):i.getContext("webgl",r)||i.getContext("experimental-webgl",r)}(e);if(!i)return!1;var r=i.createShader(i.VERTEX_SHADER);return!(!r||i.isContextLost())&&(i.shaderSource(r,"void main() {}"),i.compileShader(r),!0===i.getShaderParameter(r,i.COMPILE_STATUS))}(i)),r[i]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var i}e.exports?e.exports=t:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=t,window.mapboxgl.notSupportedReason=i);var r={};t.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}})),i={create:function(t,i,r){var n=e.window.document.createElement(t);return void 0!==i&&(n.className=i),r&&r.appendChild(n),n},createNS:function(t,i){return e.window.document.createElementNS(t,i)}},r=e.window.document&&e.window.document.documentElement.style;function n(e){if(!r)return e[0];for(var t=0;t<e.length;t++)if(e[t]in r)return e[t];return e[0]}var a,o=n(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);i.disableDrag=function(){r&&o&&(a=r[o],r[o]="none")},i.enableDrag=function(){r&&o&&(r[o]=a)};var s=n(["transform","WebkitTransform"]);i.setTransform=function(e,t){e.style[s]=t};var l=!1;try{var c=Object.defineProperty({},"passive",{get:function(){l=!0}});e.window.addEventListener("test",c,c),e.window.removeEventListener("test",c,c)}catch(e){l=!1}i.addEventListener=function(e,t,i,r){void 0===r&&(r={}),e.addEventListener(t,i,"passive"in r&&l?r:r.capture)},i.removeEventListener=function(e,t,i,r){void 0===r&&(r={}),e.removeEventListener(t,i,"passive"in r&&l?r:r.capture)};var u=function(t){t.preventDefault(),t.stopPropagation(),e.window.removeEventListener("click",u,!0)};function h(e){var t=e.userImage;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}i.suppressClick=function(){e.window.addEventListener("click",u,!0),e.window.setTimeout((function(){e.window.removeEventListener("click",u,!0)}),0)},i.mousePos=function(t,i){var r=t.getBoundingClientRect();return new e.Point(i.clientX-r.left-t.clientLeft,i.clientY-r.top-t.clientTop)},i.touchPos=function(t,i){for(var r=t.getBoundingClientRect(),n=[],a=0;a<i.length;a++)n.push(new e.Point(i[a].clientX-r.left-t.clientLeft,i[a].clientY-r.top-t.clientTop));return n},i.mouseButton=function(t){return void 0!==e.window.InstallTrigger&&2===t.button&&t.ctrlKey&&e.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button},i.remove=function(e){e.parentNode&&e.parentNode.removeChild(e)};var p=function(t){function i(){t.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new e.RGBAImage({width:1,height:1}),this.dirty=!0}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.isLoaded=function(){return this.loaded},i.prototype.setLoaded=function(e){if(this.loaded!==e&&(this.loaded=e,e)){for(var t=0,i=this.requestors;t<i.length;t+=1){var r=i[t];this._notify(r.ids,r.callback)}this.requestors=[]}},i.prototype.getImage=function(e){return this.images[e]},i.prototype.addImage=function(e,t){this._validate(e,t)&&(this.images[e]=t)},i.prototype._validate=function(t,i){var r=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new e.ErrorEvent(new Error('Image "'+t+'" has invalid "stretchX" value'))),r=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new e.ErrorEvent(new Error('Image "'+t+'" has invalid "stretchY" value'))),r=!1),this._validateContent(i.content,i)||(this.fire(new e.ErrorEvent(new Error('Image "'+t+'" has invalid "content" value'))),r=!1),r},i.prototype._validateStretch=function(e,t){if(!e)return!0;for(var i=0,r=0,n=e;r<n.length;r+=1){var a=n[r];if(a[0]<i||a[1]<a[0]||t<a[1])return!1;i=a[1]}return!0},i.prototype._validateContent=function(e,t){return!(e&&(4!==e.length||e[0]<0||t.data.width<e[0]||e[1]<0||t.data.height<e[1]||e[2]<0||t.data.width<e[2]||e[3]<0||t.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))},i.prototype.updateImage=function(e,t){t.version=this.images[e].version+1,this.images[e]=t,this.updatedImages[e]=!0},i.prototype.removeImage=function(e){var t=this.images[e];delete this.images[e],delete this.patterns[e],t.userImage&&t.userImage.onRemove&&t.userImage.onRemove()},i.prototype.listImages=function(){return Object.keys(this.images)},i.prototype.getImages=function(e,t){var i=!0;if(!this.isLoaded())for(var r=0,n=e;r<n.length;r+=1)this.images[n[r]]||(i=!1);this.isLoaded()||i?this._notify(e,t):this.requestors.push({ids:e,callback:t})},i.prototype._notify=function(t,i){for(var r={},n=0,a=t;n<a.length;n+=1){var o=a[n];this.images[o]||this.fire(new e.Event("styleimagemissing",{id:o}));var s=this.images[o];s?r[o]={data:s.data.clone(),pixelRatio:s.pixelRatio,sdf:s.sdf,version:s.version,stretchX:s.stretchX,stretchY:s.stretchY,content:s.content,hasRenderCallback:Boolean(s.userImage&&s.userImage.render)}:e.warnOnce('Image "'+o+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}i(null,r)},i.prototype.getPixelSize=function(){var e=this.atlasImage;return{width:e.width,height:e.height}},i.prototype.getPattern=function(t){var i=this.patterns[t],r=this.getImage(t);if(!r)return null;if(i&&i.position.version===r.version)return i.position;if(i)i.position.version=r.version;else{var n={w:r.data.width+2,h:r.data.height+2,x:0,y:0},a=new e.ImagePosition(n,r);this.patterns[t]={bin:n,position:a}}return this._updatePatternAtlas(),this.patterns[t].position},i.prototype.bind=function(t){var i=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new e.Texture(t,this.atlasImage,i.RGBA),this.atlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)},i.prototype._updatePatternAtlas=function(){var t=[];for(var i in this.patterns)t.push(this.patterns[i].bin);var r=e.potpack(t),n=r.w,a=r.h,o=this.atlasImage;for(var s in o.resize({width:n||1,height:a||1}),this.patterns){var l=this.patterns[s].bin,c=l.x+1,u=l.y+1,h=this.images[s].data,p=h.width,d=h.height;e.RGBAImage.copy(h,o,{x:0,y:0},{x:c,y:u},{width:p,height:d}),e.RGBAImage.copy(h,o,{x:0,y:d-1},{x:c,y:u-1},{width:p,height:1}),e.RGBAImage.copy(h,o,{x:0,y:0},{x:c,y:u+d},{width:p,height:1}),e.RGBAImage.copy(h,o,{x:p-1,y:0},{x:c-1,y:u},{width:1,height:d}),e.RGBAImage.copy(h,o,{x:0,y:0},{x:c+p,y:u},{width:1,height:d})}this.dirty=!0},i.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},i.prototype.dispatchRenderCallbacks=function(e){for(var t=0,i=e;t<i.length;t+=1){var r=i[t];if(!this.callbackDispatchedThisFrame[r]){this.callbackDispatchedThisFrame[r]=!0;var n=this.images[r];h(n)&&this.updateImage(r,n)}}},i}(e.Evented),d=g,f=g,m=1e20;function g(e,t,i,r,n,a){this.fontSize=e||24,this.buffer=void 0===t?3:t,this.cutoff=r||.25,this.fontFamily=n||"sans-serif",this.fontWeight=a||"normal",this.radius=i||8;var o=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=o,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(o*o),this.gridInner=new Float64Array(o*o),this.f=new Float64Array(o),this.d=new Float64Array(o),this.z=new Float64Array(o+1),this.v=new Int16Array(o),this.middle=Math.round(o/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function _(e,t,i,r,n,a,o){for(var s=0;s<t;s++){for(var l=0;l<i;l++)r[l]=e[l*t+s];for(y(r,n,a,o,i),l=0;l<i;l++)e[l*t+s]=n[l]}for(l=0;l<i;l++){for(s=0;s<t;s++)r[s]=e[l*t+s];for(y(r,n,a,o,t),s=0;s<t;s++)e[l*t+s]=Math.sqrt(n[s])}}function y(e,t,i,r,n){i[0]=0,r[0]=-m,r[1]=+m;for(var a=1,o=0;a<n;a++){for(var s=(e[a]+a*a-(e[i[o]]+i[o]*i[o]))/(2*a-2*i[o]);s<=r[o];)o--,s=(e[a]+a*a-(e[i[o]]+i[o]*i[o]))/(2*a-2*i[o]);i[++o]=a,r[o]=s,r[o+1]=+m}for(a=0,o=0;a<n;a++){for(;r[o+1]<a;)o++;t[a]=(a-i[o])*(a-i[o])+e[i[o]]}}g.prototype.draw=function(e){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(e,this.buffer,this.middle);for(var t=this.ctx.getImageData(0,0,this.size,this.size),i=new Uint8ClampedArray(this.size*this.size),r=0;r<this.size*this.size;r++){var n=t.data[4*r+3]/255;this.gridOuter[r]=1===n?0:0===n?m:Math.pow(Math.max(0,.5-n),2),this.gridInner[r]=1===n?m:0===n?0:Math.pow(Math.max(0,n-.5),2)}for(_(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),_(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),r=0;r<this.size*this.size;r++)i[r]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[r]-this.gridInner[r])/this.radius+this.cutoff))));return i},d.default=f;var v=function(e,t){this.requestManager=e,this.localIdeographFontFamily=t,this.entries={}};v.prototype.setURL=function(e){this.url=e},v.prototype.getGlyphs=function(t,i){var r=this,n=[];for(var a in t)for(var o=0,s=t[a];o<s.length;o+=1)n.push({stack:a,id:s[o]});e.asyncAll(n,(function(e,t){var i=e.stack,n=e.id,a=r.entries[i];a||(a=r.entries[i]={glyphs:{},requests:{},ranges:{}});var o=a.glyphs[n];if(void 0===o){if(o=r._tinySDF(a,i,n))return a.glyphs[n]=o,void t(null,{stack:i,id:n,glyph:o});var s=Math.floor(n/256);if(256*s>65535)t(new Error("glyphs > 65535 not supported"));else if(a.ranges[s])t(null,{stack:i,id:n,glyph:o});else{var l=a.requests[s];l||(l=a.requests[s]=[],v.loadGlyphRange(i,s,r.url,r.requestManager,(function(e,t){if(t){for(var i in t)r._doesCharSupportLocalGlyph(+i)||(a.glyphs[+i]=t[+i]);a.ranges[s]=!0}for(var n=0,o=l;n<o.length;n+=1)(0,o[n])(e,t);delete a.requests[s]}))),l.push((function(e,r){e?t(e):r&&t(null,{stack:i,id:n,glyph:r[n]||null})}))}}else t(null,{stack:i,id:n,glyph:o})}),(function(e,t){if(e)i(e);else if(t){for(var r={},n=0,a=t;n<a.length;n+=1){var o=a[n],s=o.stack,l=o.id,c=o.glyph;(r[s]||(r[s]={}))[l]=c&&{id:c.id,bitmap:c.bitmap.clone(),metrics:c.metrics}}i(null,r)}}))},v.prototype._doesCharSupportLocalGlyph=function(t){return!!this.localIdeographFontFamily&&(e.isChar["CJK Unified Ideographs"](t)||e.isChar["Hangul Syllables"](t)||e.isChar.Hiragana(t)||e.isChar.Katakana(t))},v.prototype._tinySDF=function(t,i,r){var n=this.localIdeographFontFamily;if(n&&this._doesCharSupportLocalGlyph(r)){var a=t.tinySDF;if(!a){var o="400";/bold/i.test(i)?o="900":/medium/i.test(i)?o="500":/light/i.test(i)&&(o="200"),a=t.tinySDF=new v.TinySDF(24,3,8,.25,n,o)}return{id:r,bitmap:new e.AlphaImage({width:30,height:30},a.draw(String.fromCharCode(r))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},v.loadGlyphRange=function(t,i,r,n,a){var o=256*i,s=o+255,l=n.transformRequest(n.normalizeGlyphsURL(r).replace("{fontstack}",t).replace("{range}",o+"-"+s),e.ResourceType.Glyphs);e.getArrayBuffer(l,(function(t,i){if(t)a(t);else if(i){for(var r={},n=0,o=e.parseGlyphPBF(i);n<o.length;n+=1){var s=o[n];r[s.id]=s}a(null,r)}}))},v.TinySDF=d;var x=function(){this.specification=e.styleSpec.light.position};x.prototype.possiblyEvaluate=function(t,i){return e.sphericalToCartesian(t.expression.evaluate(i))},x.prototype.interpolate=function(t,i,r){return{x:e.number(t.x,i.x,r),y:e.number(t.y,i.y,r),z:e.number(t.z,i.z,r)}};var b=new e.Properties({anchor:new e.DataConstantProperty(e.styleSpec.light.anchor),position:new x,color:new e.DataConstantProperty(e.styleSpec.light.color),intensity:new e.DataConstantProperty(e.styleSpec.light.intensity)}),w=function(t){function i(i){t.call(this),this._transitionable=new e.Transitionable(b),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.getLight=function(){return this._transitionable.serialize()},i.prototype.setLight=function(t,i){if(void 0===i&&(i={}),!this._validate(e.validateLight,t,i))for(var r in t){var n=t[r];e.endsWith(r,"-transition")?this._transitionable.setTransition(r.slice(0,-"-transition".length),n):this._transitionable.setValue(r,n)}},i.prototype.updateTransitions=function(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)},i.prototype.hasTransition=function(){return this._transitioning.hasTransition()},i.prototype.recalculate=function(e){this.properties=this._transitioning.possiblyEvaluate(e)},i.prototype._validate=function(t,i,r){return(!r||!1!==r.validate)&&e.emitValidationErrors(this,t.call(e.validateStyle,e.extend({value:i,style:{glyphs:!0,sprite:!0},styleSpec:e.styleSpec})))},i}(e.Evented),S=function(e,t){this.width=e,this.height=t,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};S.prototype.getDash=function(e,t){var i=e.join(",")+String(t);return this.dashEntry[i]||(this.dashEntry[i]=this.addDash(e,t)),this.dashEntry[i]},S.prototype.getDashRanges=function(e,t,i){var r=[],n=e.length%2==1?-e[e.length-1]*i:0,a=e[0]*i,o=!0;r.push({left:n,right:a,isDash:o,zeroLength:0===e[0]});for(var s=e[0],l=1;l<e.length;l++){var c=e[l];r.push({left:n=s*i,right:a=(s+=c)*i,isDash:o=!o,zeroLength:0===c})}return r},S.prototype.addRoundDash=function(e,t,i){for(var r=t/2,n=-i;n<=i;n++)for(var a=this.width*(this.nextRow+i+n),o=0,s=e[o],l=0;l<this.width;l++){l/s.right>1&&(s=e[++o]);var c=Math.abs(l-s.left),u=Math.abs(l-s.right),h=Math.min(c,u),p=void 0,d=n/i*(r+1);if(s.isDash){var f=r-Math.abs(d);p=Math.sqrt(h*h+f*f)}else p=r-Math.sqrt(h*h+d*d);this.data[a+l]=Math.max(0,Math.min(255,p+128))}},S.prototype.addRegularDash=function(e){for(var t=e.length-1;t>=0;--t){var i=e[t],r=e[t+1];i.zeroLength?e.splice(t,1):r&&r.isDash===i.isDash&&(r.left=i.left,e.splice(t,1))}var n=e[0],a=e[e.length-1];n.isDash===a.isDash&&(n.left=a.left-this.width,a.right=n.right+this.width);for(var o=this.width*this.nextRow,s=0,l=e[s],c=0;c<this.width;c++){c/l.right>1&&(l=e[++s]);var u=Math.abs(c-l.left),h=Math.abs(c-l.right),p=Math.min(u,h);this.data[o+c]=Math.max(0,Math.min(255,(l.isDash?p:-p)+128))}},S.prototype.addDash=function(t,i){var r=i?7:0,n=2*r+1;if(this.nextRow+n>this.height)return e.warnOnce("LineAtlas out of space"),null;for(var a=0,o=0;o<t.length;o++)a+=t[o];if(0!==a){var s=this.width/a,l=this.getDashRanges(t,this.width,s);i?this.addRoundDash(l,s,r):this.addRegularDash(l)}var c={y:(this.nextRow+r+.5)/this.height,height:2*r/this.height,width:a};return this.nextRow+=n,this.dirty=!0,c},S.prototype.bind=function(e){var t=e.gl;this.texture?(t.bindTexture(t.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.ALPHA,t.UNSIGNED_BYTE,this.data))):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.ALPHA,this.width,this.height,0,t.ALPHA,t.UNSIGNED_BYTE,this.data))};var M=function t(i,r){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=e.uniqueId();for(var n=this.workerPool.acquire(this.id),a=0;a<n.length;a++){var o=new t.Actor(n[a],r,this.id);o.name="Worker "+a,this.actors.push(o)}};function T(t,i,r){var n=function(n,a){if(n)return r(n);if(a){var o=e.pick(e.extend(a,t),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);a.vector_layers&&(o.vectorLayers=a.vector_layers,o.vectorLayerIds=o.vectorLayers.map((function(e){return e.id}))),o.tiles=i.canonicalizeTileset(o,t.url),r(null,o)}};return t.url?e.getJSON(i.transformRequest(i.normalizeSourceURL(t.url),e.ResourceType.Source),n):e.browser.frame((function(){return n(null,t)}))}M.prototype.broadcast=function(t,i,r){e.asyncAll(this.actors,(function(e,r){e.send(t,i,r)}),r=r||function(){})},M.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},M.prototype.remove=function(){this.actors.forEach((function(e){e.remove()})),this.actors=[],this.workerPool.release(this.id)},M.Actor=e.Actor;var E=function(t,i,r){this.bounds=e.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=i||0,this.maxzoom=r||24};E.prototype.validateBounds=function(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]},E.prototype.contains=function(t){var i=Math.pow(2,t.z),r=Math.floor(e.mercatorXfromLng(this.bounds.getWest())*i),n=Math.floor(e.mercatorYfromLat(this.bounds.getNorth())*i),a=Math.ceil(e.mercatorXfromLng(this.bounds.getEast())*i),o=Math.ceil(e.mercatorYfromLat(this.bounds.getSouth())*i);return t.x>=r&&t.x<a&&t.y>=n&&t.y<o};var C=function(t){function i(i,r,n,a){if(t.call(this),this.id=i,this.dispatcher=n,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,e.extend(this,e.pick(r,["url","scheme","tileSize","promoteId"])),this._options=e.extend({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(a)}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.load=function(){var t=this;this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=T(this._options,this.map._requestManager,(function(i,r){t._tileJSONRequest=null,t._loaded=!0,i?t.fire(new e.ErrorEvent(i)):r&&(e.extend(t,r),r.bounds&&(t.tileBounds=new E(r.bounds,t.minzoom,t.maxzoom)),e.postTurnstileEvent(r.tiles,t.map._requestManager._customAccessToken),e.postMapLoadEvent(r.tiles,t.map._getMapId(),t.map._requestManager._skuToken,t.map._requestManager._customAccessToken),t.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),t.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})))}))},i.prototype.loaded=function(){return this._loaded},i.prototype.hasTile=function(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)},i.prototype.onAdd=function(e){this.map=e,this.load()},i.prototype.setSourceProperty=function(e){this._tileJSONRequest&&this._tileJSONRequest.cancel(),e(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},i.prototype.setTiles=function(e){var t=this;return this.setSourceProperty((function(){t._options.tiles=e})),this},i.prototype.setUrl=function(e){var t=this;return this.setSourceProperty((function(){t.url=e,t._options.url=e})),this},i.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},i.prototype.serialize=function(){return e.extend({},this._options)},i.prototype.loadTile=function(t,i){var r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),n={request:this.map._requestManager.transformRequest(r,e.ResourceType.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:e.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function a(r,n){return delete t.request,t.aborted?i(null):r&&404!==r.status?i(r):(n&&n.resourceTiming&&(t.resourceTiming=n.resourceTiming),this.map._refreshExpiredTiles&&n&&t.setExpiryData(n),t.loadVectorData(n,this.map.painter),e.cacheEntryPossiblyAdded(this.dispatcher),i(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}n.request.collectResourceTiming=this._collectResourceTiming,t.actor&&"expired"!==t.state?"loading"===t.state?t.reloadCallback=i:t.request=t.actor.send("reloadTile",n,a.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",n,a.bind(this)))},i.prototype.abortTile=function(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id},void 0)},i.prototype.unloadTile=function(e){e.unloadVectorData(),e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id},void 0)},i.prototype.hasTransition=function(){return!1},i}(e.Evented),A=function(t){function i(i,r,n,a){t.call(this),this.id=i,this.dispatcher=n,this.setEventedParent(a),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=e.extend({type:"raster"},r),e.extend(this,e.pick(r,["url","scheme","tileSize"]))}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.load=function(){var t=this;this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=T(this._options,this.map._requestManager,(function(i,r){t._tileJSONRequest=null,t._loaded=!0,i?t.fire(new e.ErrorEvent(i)):r&&(e.extend(t,r),r.bounds&&(t.tileBounds=new E(r.bounds,t.minzoom,t.maxzoom)),e.postTurnstileEvent(r.tiles),e.postMapLoadEvent(r.tiles,t.map._getMapId(),t.map._requestManager._skuToken),t.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),t.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})))}))},i.prototype.loaded=function(){return this._loaded},i.prototype.onAdd=function(e){this.map=e,this.load()},i.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},i.prototype.serialize=function(){return e.extend({},this._options)},i.prototype.hasTile=function(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)},i.prototype.loadTile=function(t,i){var r=this,n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);t.request=e.getImage(this.map._requestManager.transformRequest(n,e.ResourceType.Tile),(function(n,a){if(delete t.request,t.aborted)t.state="unloaded",i(null);else if(n)t.state="errored",i(n);else if(a){r.map._refreshExpiredTiles&&t.setExpiryData(a),delete a.cacheControl,delete a.expires;var o=r.map.painter.context,s=o.gl;t.texture=r.map.painter.getTileTexture(a.width),t.texture?t.texture.update(a,{useMipmap:!0}):(t.texture=new e.Texture(o,a,s.RGBA,{useMipmap:!0}),t.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),o.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax)),t.state="loaded",e.cacheEntryPossiblyAdded(r.dispatcher),i(null)}}))},i.prototype.abortTile=function(e,t){e.request&&(e.request.cancel(),delete e.request),t()},i.prototype.unloadTile=function(e,t){e.texture&&this.map.painter.saveTileTexture(e.texture),t()},i.prototype.hasTransition=function(){return!1},i}(e.Evented),I=function(t){function i(i,r,n,a){t.call(this,i,r,n,a),this.type="raster-dem",this.maxzoom=22,this._options=e.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},i.prototype.loadTile=function(t,i){var r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function n(e,r){e&&(t.state="errored",i(e)),r&&(t.dem=r,t.needsHillshadePrepare=!0,t.state="loaded",i(null))}t.request=e.getImage(this.map._requestManager.transformRequest(r,e.ResourceType.Tile),function(r,a){if(delete t.request,t.aborted)t.state="unloaded",i(null);else if(r)t.state="errored",i(r);else if(a){this.map._refreshExpiredTiles&&t.setExpiryData(a),delete a.cacheControl,delete a.expires;var o=e.window.ImageBitmap&&a instanceof e.window.ImageBitmap&&e.offscreenCanvasSupported()?a:e.browser.getImageData(a,1),s={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:o,encoding:this.encoding};t.actor&&"expired"!==t.state||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",s,n.bind(this)))}}.bind(this)),t.neighboringTiles=this._getNeighboringTiles(t.tileID)},i.prototype._getNeighboringTiles=function(t){var i=t.canonical,r=Math.pow(2,i.z),n=(i.x-1+r)%r,a=0===i.x?t.wrap-1:t.wrap,o=(i.x+1+r)%r,s=i.x+1===r?t.wrap+1:t.wrap,l={};return l[new e.OverscaledTileID(t.overscaledZ,a,i.z,n,i.y).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,s,i.z,o,i.y).key]={backfilled:!1},i.y>0&&(l[new e.OverscaledTileID(t.overscaledZ,a,i.z,n,i.y-1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,t.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,s,i.z,o,i.y-1).key]={backfilled:!1}),i.y+1<r&&(l[new e.OverscaledTileID(t.overscaledZ,a,i.z,n,i.y+1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,t.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,s,i.z,o,i.y+1).key]={backfilled:!1}),l},i.prototype.unloadTile=function(e){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&e.actor.send("removeDEMTile",{uid:e.uid,source:this.id})},i}(A),P=function(t){function i(i,r,n,a){t.call(this),this.id=i,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(a),this._data=r.data,this._options=e.extend({},r),this._collectResourceTiming=r.collectResourceTiming,this._resourceTiming=[],void 0!==r.maxzoom&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;var o=e.EXTENT/this.tileSize;this.workerOptions=e.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*o,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*o,extent:e.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?Math.min(r.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:e.EXTENT,radius:(r.clusterRadius||50)*o,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.load=function(){var t=this;this.fire(new e.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(i){if(i)t.fire(new e.ErrorEvent(i));else{var r={dataType:"source",sourceDataType:"metadata"};t._collectResourceTiming&&t._resourceTiming&&t._resourceTiming.length>0&&(r.resourceTiming=t._resourceTiming,t._resourceTiming=[]),t.fire(new e.Event("data",r))}}))},i.prototype.onAdd=function(e){this.map=e,this.load()},i.prototype.setData=function(t){var i=this;return this._data=t,this.fire(new e.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(t){if(t)i.fire(new e.ErrorEvent(t));else{var r={dataType:"source",sourceDataType:"content"};i._collectResourceTiming&&i._resourceTiming&&i._resourceTiming.length>0&&(r.resourceTiming=i._resourceTiming,i._resourceTiming=[]),i.fire(new e.Event("data",r))}})),this},i.prototype.getClusterExpansionZoom=function(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id},t),this},i.prototype.getClusterChildren=function(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id},t),this},i.prototype.getClusterLeaves=function(e,t,i,r){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:e,limit:t,offset:i},r),this},i.prototype._updateWorkerData=function(t){var i=this;this._loaded=!1;var r=e.extend({},this.workerOptions),n=this._data;"string"==typeof n?(r.request=this.map._requestManager.transformRequest(e.browser.resolveURL(n),e.ResourceType.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(n),this.actor.send(this.type+".loadData",r,(function(e,n){i._removed||n&&n.abandoned||(i._loaded=!0,n&&n.resourceTiming&&n.resourceTiming[i.id]&&(i._resourceTiming=n.resourceTiming[i.id].slice(0)),i.actor.send(i.type+".coalesce",{source:r.source},null),t(e))}))},i.prototype.loaded=function(){return this._loaded},i.prototype.loadTile=function(t,i){var r=this,n=t.actor?"reloadTile":"loadTile";t.actor=this.actor,t.request=this.actor.send(n,{type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:e.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(function(e,a){return delete t.request,t.unloadVectorData(),t.aborted?i(null):e?i(e):(t.loadVectorData(a,r.map.painter,"reloadTile"===n),i(null))}))},i.prototype.abortTile=function(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0},i.prototype.unloadTile=function(e){e.unloadVectorData(),this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id})},i.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},i.prototype.serialize=function(){return e.extend({},this._options,{type:this.type,data:this._data})},i.prototype.hasTransition=function(){return!1},i}(e.Evented),z=e.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),R=function(t){function i(e,i,r,n){t.call(this),this.id=e,this.dispatcher=r,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(n),this.options=i}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.load=function(t,i){var r=this;this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this.url=this.options.url,e.getImage(this.map._requestManager.transformRequest(this.url,e.ResourceType.Image),(function(n,a){r._loaded=!0,n?r.fire(new e.ErrorEvent(n)):a&&(r.image=a,t&&(r.coordinates=t),i&&i(),r._finishLoading())}))},i.prototype.loaded=function(){return this._loaded},i.prototype.updateImage=function(e){var t=this;return this.image&&e.url?(this.options.url=e.url,this.load(e.coordinates,(function(){t.texture=null})),this):this},i.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})))},i.prototype.onAdd=function(e){this.map=e,this.load()},i.prototype.setCoordinates=function(t){var i=this;this.coordinates=t;var r=t.map(e.MercatorCoordinate.fromLngLat);this.tileID=function(t){for(var i=1/0,r=1/0,n=-1/0,a=-1/0,o=0,s=t;o<s.length;o+=1){var l=s[o];i=Math.min(i,l.x),r=Math.min(r,l.y),n=Math.max(n,l.x),a=Math.max(a,l.y)}var c=Math.max(n-i,a-r),u=Math.max(0,Math.floor(-Math.log(c)/Math.LN2)),h=Math.pow(2,u);return new e.CanonicalTileID(u,Math.floor((i+n)/2*h),Math.floor((r+a)/2*h))}(r),this.minzoom=this.maxzoom=this.tileID.z;var n=r.map((function(e){return i.tileID.getTilePoint(e)._round()}));return this._boundsArray=new e.StructArrayLayout4i8,this._boundsArray.emplaceBack(n[0].x,n[0].y,0,0),this._boundsArray.emplaceBack(n[1].x,n[1].y,e.EXTENT,0),this._boundsArray.emplaceBack(n[3].x,n[3].y,0,e.EXTENT),this._boundsArray.emplaceBack(n[2].x,n[2].y,e.EXTENT,e.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})),this},i.prototype.prepare=function(){if(0!==Object.keys(this.tiles).length&&this.image){var t=this.map.painter.context,i=t.gl;for(var r in this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,z.members)),this.boundsSegments||(this.boundsSegments=e.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new e.Texture(t,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this.tiles){var n=this.tiles[r];"loaded"!==n.state&&(n.state="loaded",n.texture=this.texture)}}},i.prototype.loadTile=function(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},t(null)):(e.state="errored",t(null))},i.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},i.prototype.hasTransition=function(){return!1},i}(e.Evented),k=function(t){function i(e,i,r,n){t.call(this,e,i,r,n),this.roundZoom=!0,this.type="video",this.options=i}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.load=function(){var t=this;this._loaded=!1;var i=this.options;this.urls=[];for(var r=0,n=i.urls;r<n.length;r+=1)this.urls.push(this.map._requestManager.transformRequest(n[r],e.ResourceType.Source).url);e.getVideo(this.urls,(function(i,r){t._loaded=!0,i?t.fire(new e.ErrorEvent(i)):r&&(t.video=r,t.video.loop=!0,t.video.addEventListener("playing",(function(){t.map.triggerRepaint()})),t.map&&t.video.play(),t._finishLoading())}))},i.prototype.pause=function(){this.video&&this.video.pause()},i.prototype.play=function(){this.video&&this.video.play()},i.prototype.seek=function(t){if(this.video){var i=this.video.seekable;t<i.start(0)||t>i.end(0)?this.fire(new e.ErrorEvent(new e.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+i.start(0)+" and "+i.end(0)+"-second mark."))):this.video.currentTime=t}},i.prototype.getVideo=function(){return this.video},i.prototype.onAdd=function(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},i.prototype.prepare=function(){if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){var t=this.map.painter.context,i=t.gl;for(var r in this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,z.members)),this.boundsSegments||(this.boundsSegments=e.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new e.Texture(t,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this.tiles){var n=this.tiles[r];"loaded"!==n.state&&(n.state="loaded",n.texture=this.texture)}}},i.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},i.prototype.hasTransition=function(){return this.video&&!this.video.paused},i}(R),L=function(t){function i(i,r,n,a){t.call(this,i,r,n,a),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some((function(e){return!Array.isArray(e)||2!==e.length||e.some((function(e){return"number"!=typeof e}))}))||this.fire(new e.ErrorEvent(new e.ValidationError("sources."+i,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new e.ErrorEvent(new e.ValidationError("sources."+i,null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new e.ErrorEvent(new e.ValidationError("sources."+i,null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof e.window.HTMLCanvasElement||this.fire(new e.ErrorEvent(new e.ValidationError("sources."+i,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new e.ErrorEvent(new e.ValidationError("sources."+i,null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof e.window.HTMLCanvasElement?this.options.canvas:e.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},i.prototype.getCanvas=function(){return this.canvas},i.prototype.onAdd=function(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()},i.prototype.onRemove=function(){this.pause()},i.prototype.prepare=function(){var t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){var i=this.map.painter.context,r=i.gl;for(var n in this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,z.members)),this.boundsSegments||(this.boundsSegments=e.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new e.Texture(i,this.canvas,r.RGBA,{premultiply:!0}),this.tiles){var a=this.tiles[n];"loaded"!==a.state&&(a.state="loaded",a.texture=this.texture)}}},i.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},i.prototype.hasTransition=function(){return this._playing},i.prototype._hasInvalidDimensions=function(){for(var e=0,t=[this.canvas.width,this.canvas.height];e<t.length;e+=1){var i=t[e];if(isNaN(i)||i<=0)return!0}return!1},i}(R),D={vector:C,raster:A,"raster-dem":I,geojson:P,video:k,image:R,canvas:L};function B(t,i){var r=e.identity([]);return e.translate(r,r,[1,1,0]),e.scale(r,r,[.5*t.width,.5*t.height,1]),e.multiply(r,r,t.calculatePosMatrix(i.toUnwrapped()))}function F(e,t,i,r,n,a){var o=function(e,t,i){if(e)for(var r=0,n=e;r<n.length;r+=1){var a=t[n[r]];if(a&&a.source===i&&"fill-extrusion"===a.type)return!0}else for(var o in t){var s=t[o];if(s.source===i&&"fill-extrusion"===s.type)return!0}return!1}(n&&n.layers,t,e.id),s=a.maxPitchScaleFactor(),l=e.tilesIn(r,s,o);l.sort(O);for(var c=[],u=0,h=l;u<h.length;u+=1){var p=h[u];c.push({wrappedTileID:p.tileID.wrapped().key,queryResults:p.tile.queryRenderedFeatures(t,i,e._state,p.queryGeometry,p.cameraQueryGeometry,p.scale,n,a,s,B(e.transform,p.tileID))})}var d=function(e){for(var t={},i={},r=0,n=e;r<n.length;r+=1){var a=n[r],o=a.queryResults,s=a.wrappedTileID,l=i[s]=i[s]||{};for(var c in o)for(var u=o[c],h=l[c]=l[c]||{},p=t[c]=t[c]||[],d=0,f=u;d<f.length;d+=1){var m=f[d];h[m.featureIndex]||(h[m.featureIndex]=!0,p.push(m))}}return t}(c);for(var f in d)d[f].forEach((function(t){var i=t.feature,r=e.getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=r}));return d}function O(e,t){var i=e.tileID,r=t.tileID;return i.overscaledZ-r.overscaledZ||i.canonical.y-r.canonical.y||i.wrap-r.wrap||i.canonical.x-r.canonical.x}var N=function(e,t){this.max=e,this.onRemove=t,this.reset()};N.prototype.reset=function(){for(var e in this.data)for(var t=0,i=this.data[e];t<i.length;t+=1){var r=i[t];r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value)}return this.data={},this.order=[],this},N.prototype.add=function(e,t,i){var r=this,n=e.wrapped().key;void 0===this.data[n]&&(this.data[n]=[]);var a={value:t,timeout:void 0};if(void 0!==i&&(a.timeout=setTimeout((function(){r.remove(e,a)}),i)),this.data[n].push(a),this.order.push(n),this.order.length>this.max){var o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this},N.prototype.has=function(e){return e.wrapped().key in this.data},N.prototype.getAndRemove=function(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null},N.prototype._getAndRemoveByKey=function(e){var t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value},N.prototype.getByKey=function(e){var t=this.data[e];return t?t[0].value:null},N.prototype.get=function(e){return this.has(e)?this.data[e.wrapped().key][0].value:null},N.prototype.remove=function(e,t){if(!this.has(e))return this;var i=e.wrapped().key,r=void 0===t?0:this.data[i].indexOf(t),n=this.data[i][r];return this.data[i].splice(r,1),n.timeout&&clearTimeout(n.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(n.value),this.order.splice(this.order.indexOf(i),1),this},N.prototype.setMaxSize=function(e){for(this.max=e;this.order.length>this.max;){var t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this},N.prototype.filter=function(e){var t=[];for(var i in this.data)for(var r=0,n=this.data[i];r<n.length;r+=1){var a=n[r];e(a.value)||t.push(a)}for(var o=0,s=t;o<s.length;o+=1){var l=s[o];this.remove(l.value.tileID,l)}};var V=function(e,t,i){this.context=e;var r=e.gl;this.buffer=r.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete t.arrayBuffer};V.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},V.prototype.updateData=function(e){var t=this.context.gl;this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)},V.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var U={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},$=function(e,t,i,r){this.length=t.length,this.attributes=i,this.itemSize=t.bytesPerElement,this.dynamicDraw=r,this.context=e;var n=e.gl;this.buffer=n.createBuffer(),e.bindVertexBuffer.set(this.buffer),n.bufferData(n.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||delete t.arrayBuffer};$.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},$.prototype.updateData=function(e){var t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)},$.prototype.enableAttributes=function(e,t){for(var i=0;i<this.attributes.length;i++){var r=t.attributes[this.attributes[i].name];void 0!==r&&e.enableVertexAttribArray(r)}},$.prototype.setVertexAttribPointers=function(e,t,i){for(var r=0;r<this.attributes.length;r++){var n=this.attributes[r],a=t.attributes[n.name];void 0!==a&&e.vertexAttribPointer(a,n.components,e[U[n.type]],!1,this.itemSize,n.offset+this.itemSize*(i||0))}},$.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var j=function(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};j.prototype.get=function(){return this.current},j.prototype.set=function(e){},j.prototype.getDefault=function(){return this.default},j.prototype.setDefault=function(){this.set(this.default)};var q=function(t){function i(){t.apply(this,arguments)}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.getDefault=function(){return e.Color.transparent},i.prototype.set=function(e){var t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)},i}(j),G=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return 1},t.prototype.set=function(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)},t}(j),H=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return 0},t.prototype.set=function(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)},t}(j),W=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return[!0,!0,!0,!0]},t.prototype.set=function(e){var t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)},t}(j),Z=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return!0},t.prototype.set=function(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)},t}(j),X=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return 255},t.prototype.set=function(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)},t}(j),Y=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},t.prototype.set=function(e){var t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)},t}(j),K=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){var e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]},t.prototype.set=function(e){var t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)},t}(j),J=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return!1},t.prototype.set=function(e){if(e!==this.current||this.dirty){var t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}},t}(j),Q=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return[0,1]},t.prototype.set=function(e){var t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)},t}(j),ee=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return!1},t.prototype.set=function(e){if(e!==this.current||this.dirty){var t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}},t}(j),te=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return this.gl.LESS},t.prototype.set=function(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)},t}(j),ie=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return!1},t.prototype.set=function(e){if(e!==this.current||this.dirty){var t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}},t}(j),re=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){var e=this.gl;return[e.ONE,e.ZERO]},t.prototype.set=function(e){var t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)},t}(j),ne=function(t){function i(){t.apply(this,arguments)}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.getDefault=function(){return e.Color.transparent},i.prototype.set=function(e){var t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)},i}(j),ae=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return this.gl.FUNC_ADD},t.prototype.set=function(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)},t}(j),oe=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return!1},t.prototype.set=function(e){if(e!==this.current||this.dirty){var t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}},t}(j),se=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return this.gl.BACK},t.prototype.set=function(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)},t}(j),le=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return this.gl.CCW},t.prototype.set=function(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)},t}(j),ce=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return null},t.prototype.set=function(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)},t}(j),ue=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return this.gl.TEXTURE0},t.prototype.set=function(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)},t}(j),he=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){var e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]},t.prototype.set=function(e){var t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)},t}(j),pe=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return null},t.prototype.set=function(e){if(e!==this.current||this.dirty){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}},t}(j),de=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return null},t.prototype.set=function(e){if(e!==this.current||this.dirty){var t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}},t}(j),fe=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return null},t.prototype.set=function(e){if(e!==this.current||this.dirty){var t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}},t}(j),me=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return null},t.prototype.set=function(e){if(e!==this.current||this.dirty){var t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}},t}(j),ge=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return null},t.prototype.set=function(e){var t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1},t}(j),_e=function(e){function t(t){e.call(this,t),this.vao=t.extVertexArrayObject}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return null},t.prototype.set=function(e){this.vao&&(e!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(e),this.current=e,this.dirty=!1)},t}(j),ye=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return 4},t.prototype.set=function(e){if(e!==this.current||this.dirty){var t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}},t}(j),ve=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return!1},t.prototype.set=function(e){if(e!==this.current||this.dirty){var t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}},t}(j),xe=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return!1},t.prototype.set=function(e){if(e!==this.current||this.dirty){var t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}},t}(j),be=function(e){function t(t,i){e.call(this,t),this.context=t,this.parent=i}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return null},t}(j),we=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.setDirty=function(){this.dirty=!0},t.prototype.set=function(e){if(e!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}},t}(be),Se=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(e){if(e!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e),this.current=e,this.dirty=!1}},t}(be),Me=function(e,t,i,r){this.context=e,this.width=t,this.height=i;var n=this.framebuffer=e.gl.createFramebuffer();this.colorAttachment=new we(e,n),r&&(this.depthAttachment=new Se(e,n))};Me.prototype.destroy=function(){var e=this.context.gl,t=this.colorAttachment.get();if(t&&e.deleteTexture(t),this.depthAttachment){var i=this.depthAttachment.get();i&&e.deleteRenderbuffer(i)}e.deleteFramebuffer(this.framebuffer)};var Te=function(e,t,i){this.func=e,this.mask=t,this.range=i};Te.ReadOnly=!1,Te.ReadWrite=!0,Te.disabled=new Te(519,Te.ReadOnly,[0,1]);var Ee=function(e,t,i,r,n,a){this.test=e,this.ref=t,this.mask=i,this.fail=r,this.depthFail=n,this.pass=a};Ee.disabled=new Ee({func:519,mask:0},0,0,7680,7680,7680);var Ce=function(e,t,i){this.blendFunction=e,this.blendColor=t,this.mask=i};Ce.disabled=new Ce(Ce.Replace=[1,0],e.Color.transparent,[!1,!1,!1,!1]),Ce.unblended=new Ce(Ce.Replace,e.Color.transparent,[!0,!0,!0,!0]),Ce.alphaBlended=new Ce([1,771],e.Color.transparent,[!0,!0,!0,!0]);var Ae=function(e,t,i){this.enable=e,this.mode=t,this.frontFace=i};Ae.disabled=new Ae(!1,1029,2305),Ae.backCCW=new Ae(!0,1029,2305);var Ie=function(e){this.gl=e,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new q(this),this.clearDepth=new G(this),this.clearStencil=new H(this),this.colorMask=new W(this),this.depthMask=new Z(this),this.stencilMask=new X(this),this.stencilFunc=new Y(this),this.stencilOp=new K(this),this.stencilTest=new J(this),this.depthRange=new Q(this),this.depthTest=new ee(this),this.depthFunc=new te(this),this.blend=new ie(this),this.blendFunc=new re(this),this.blendColor=new ne(this),this.blendEquation=new ae(this),this.cullFace=new oe(this),this.cullFaceSide=new se(this),this.frontFace=new le(this),this.program=new ce(this),this.activeTexture=new ue(this),this.viewport=new he(this),this.bindFramebuffer=new pe(this),this.bindRenderbuffer=new de(this),this.bindTexture=new fe(this),this.bindVertexBuffer=new me(this),this.bindElementBuffer=new ge(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new _e(this),this.pixelStoreUnpack=new ye(this),this.pixelStoreUnpackPremultiplyAlpha=new ve(this),this.pixelStoreUnpackFlipY=new xe(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=e.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(e.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE)};Ie.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},Ie.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},Ie.prototype.createIndexBuffer=function(e,t){return new V(this,e,t)},Ie.prototype.createVertexBuffer=function(e,t,i){return new $(this,e,t,i)},Ie.prototype.createRenderbuffer=function(e,t,i){var r=this.gl,n=r.createRenderbuffer();return this.bindRenderbuffer.set(n),r.renderbufferStorage(r.RENDERBUFFER,e,t,i),this.bindRenderbuffer.set(null),n},Ie.prototype.createFramebuffer=function(e,t,i){return new Me(this,e,t,i)},Ie.prototype.clear=function(e){var t=e.color,i=e.depth,r=this.gl,n=0;t&&(n|=r.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),void 0!==i&&(n|=r.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(i),this.depthMask.set(!0)),r.clear(n)},Ie.prototype.setCullFace=function(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))},Ie.prototype.setDepthMode=function(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)},Ie.prototype.setStencilMode=function(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)},Ie.prototype.setColorMode=function(t){e.deepEqual(t.blendFunction,Ce.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)},Ie.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Pe=function(t){function i(i,r,n){var a=this;t.call(this),this.id=i,this.dispatcher=n,this.on("data",(function(e){"source"===e.dataType&&"metadata"===e.sourceDataType&&(a._sourceLoaded=!0),a._sourceLoaded&&!a._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(a.reload(),a.transform&&a.update(a.transform))})),this.on("error",(function(){a._sourceErrored=!0})),this._source=function(t,i,r,n){var a=new D[i.type](t,i,r,n);if(a.id!==t)throw new Error("Expected Source id to be "+t+" instead of "+a.id);return e.bindAll(["load","abort","unload","serialize","prepare"],a),a}(i,r,n,this),this._tiles={},this._cache=new N(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new e.SourceFeatureState}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.onAdd=function(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(e)},i.prototype.onRemove=function(e){this._source&&this._source.onRemove&&this._source.onRemove(e)},i.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(var e in this._tiles){var t=this._tiles[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}return!0},i.prototype.getSource=function(){return this._source},i.prototype.pause=function(){this._paused=!0},i.prototype.resume=function(){if(this._paused){var e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}},i.prototype._loadTile=function(e,t){return this._source.loadTile(e,t)},i.prototype._unloadTile=function(e){if(this._source.unloadTile)return this._source.unloadTile(e,(function(){}))},i.prototype._abortTile=function(e){if(this._source.abortTile)return this._source.abortTile(e,(function(){}))},i.prototype.serialize=function(){return this._source.serialize()},i.prototype.prepare=function(e){for(var t in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var i=this._tiles[t];i.upload(e),i.prepare(this.map.style.imageManager)}},i.prototype.getIds=function(){return e.values(this._tiles).map((function(e){return e.tileID})).sort(ze).map((function(e){return e.key}))},i.prototype.getRenderableIds=function(t){var i=this,r=[];for(var n in this._tiles)this._isIdRenderable(n,t)&&r.push(this._tiles[n]);return t?r.sort((function(t,r){var n=t.tileID,a=r.tileID,o=new e.Point(n.canonical.x,n.canonical.y)._rotate(i.transform.angle),s=new e.Point(a.canonical.x,a.canonical.y)._rotate(i.transform.angle);return n.overscaledZ-a.overscaledZ||s.y-o.y||s.x-o.x})).map((function(e){return e.tileID.key})):r.map((function(e){return e.tileID})).sort(ze).map((function(e){return e.key}))},i.prototype.hasRenderableParent=function(e){var t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)},i.prototype._isIdRenderable=function(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())},i.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var e in this._cache.reset(),this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(e,"reloading")},i.prototype._reloadTile=function(e,t){var i=this._tiles[e];i&&("loading"!==i.state&&(i.state=t),this._loadTile(i,this._tileLoaded.bind(this,i,e,t)))},i.prototype._tileLoaded=function(t,i,r,n){if(n)return t.state="errored",void(404!==n.status?this._source.fire(new e.ErrorEvent(n,{tile:t})):this.update(this.transform));t.timeAdded=e.browser.now(),"expired"===r&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(i,t),"raster-dem"===this.getSource().type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new e.Event("data",{dataType:"source",tile:t,coord:t.tileID}))},i.prototype._backfillDEM=function(e){for(var t=this.getRenderableIds(),i=0;i<t.length;i++){var r=t[i];if(e.neighboringTiles&&e.neighboringTiles[r]){var n=this.getTileByID(r);a(e,n),a(n,e)}}function a(e,t){e.needsHillshadePrepare=!0;var i=t.tileID.canonical.x-e.tileID.canonical.x,r=t.tileID.canonical.y-e.tileID.canonical.y,n=Math.pow(2,e.tileID.canonical.z),a=t.tileID.key;0===i&&0===r||Math.abs(r)>1||(Math.abs(i)>1&&(1===Math.abs(i+n)?i+=n:1===Math.abs(i-n)&&(i-=n)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,i,r),e.neighboringTiles&&e.neighboringTiles[a]&&(e.neighboringTiles[a].backfilled=!0)))}},i.prototype.getTile=function(e){return this.getTileByID(e.key)},i.prototype.getTileByID=function(e){return this._tiles[e]},i.prototype._retainLoadedChildren=function(e,t,i,r){for(var n in this._tiles){var a=this._tiles[n];if(!(r[n]||!a.hasData()||a.tileID.overscaledZ<=t||a.tileID.overscaledZ>i)){for(var o=a.tileID;a&&a.tileID.overscaledZ>t+1;){var s=a.tileID.scaledTo(a.tileID.overscaledZ-1);(a=this._tiles[s.key])&&a.hasData()&&(o=s)}for(var l=o;l.overscaledZ>t;)if(e[(l=l.scaledTo(l.overscaledZ-1)).key]){r[o.key]=o;break}}}},i.prototype.findLoadedParent=function(e,t){if(e.key in this._loadedParentTiles){var i=this._loadedParentTiles[e.key];return i&&i.tileID.overscaledZ>=t?i:null}for(var r=e.overscaledZ-1;r>=t;r--){var n=e.scaledTo(r),a=this._getLoadedTile(n);if(a)return a}},i.prototype._getLoadedTile=function(e){var t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(e.wrapped().key)},i.prototype.updateCacheSize=function(e){var t=Math.ceil(e.width/this._source.tileSize)+1,i=Math.ceil(e.height/this._source.tileSize)+1,r=Math.floor(t*i*5),n="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,r):r;this._cache.setMaxSize(n)},i.prototype.handleWrapJump=function(e){var t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){var i={};for(var r in this._tiles){var n=this._tiles[r];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+t),i[n.tileID.key]=n}for(var a in this._tiles=i,this._timers)clearTimeout(this._timers[a]),delete this._timers[a];for(var o in this._tiles)this._setTileReloadTimer(o,this._tiles[o])}},i.prototype.update=function(t){var r=this;if(this.transform=t,this._sourceLoaded&&!this._paused){var n;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?n=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((function(t){return new e.OverscaledTileID(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y)})):(n=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(n=n.filter((function(e){return r._source.hasTile(e)})))):n=[];var a=t.coveringZoomLevel(this._source),o=Math.max(a-i.maxOverzooming,this._source.minzoom),s=Math.max(a+i.maxUnderzooming,this._source.minzoom),l=this._updateRetainedTiles(n,a);if(Re(this._source.type)){for(var c={},u={},h=0,p=Object.keys(l);h<p.length;h+=1){var d=p[h],f=l[d],m=this._tiles[d];if(m&&!(m.fadeEndTime&&m.fadeEndTime<=e.browser.now())){var g=this.findLoadedParent(f,o);g&&(this._addTile(g.tileID),c[g.tileID.key]=g.tileID),u[d]=f}}for(var _ in this._retainLoadedChildren(u,a,s,l),c)l[_]||(this._coveredTiles[_]=!0,l[_]=c[_])}for(var y in l)this._tiles[y].clearFadeHold();for(var v=0,x=e.keysDifference(this._tiles,l);v<x.length;v+=1){var b=x[v],w=this._tiles[b];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(b)}this._updateLoadedParentTileCache()}},i.prototype.releaseSymbolFadeTiles=function(){for(var e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)},i.prototype._updateRetainedTiles=function(e,t){for(var r={},n={},a=Math.max(t-i.maxOverzooming,this._source.minzoom),o=Math.max(t+i.maxUnderzooming,this._source.minzoom),s={},l=0,c=e;l<c.length;l+=1){var u=c[l],h=this._addTile(u);r[u.key]=u,h.hasData()||t<this._source.maxzoom&&(s[u.key]=u)}this._retainLoadedChildren(s,t,o,r);for(var p=0,d=e;p<d.length;p+=1){var f=d[p],m=this._tiles[f.key];if(!m.hasData()){if(t+1>this._source.maxzoom){var g=f.children(this._source.maxzoom)[0],_=this.getTile(g);if(_&&_.hasData()){r[g.key]=g;continue}}else{var y=f.children(this._source.maxzoom);if(r[y[0].key]&&r[y[1].key]&&r[y[2].key]&&r[y[3].key])continue}for(var v=m.wasRequested(),x=f.overscaledZ-1;x>=a;--x){var b=f.scaledTo(x);if(n[b.key])break;if(n[b.key]=!0,!(m=this.getTile(b))&&v&&(m=this._addTile(b)),m&&(r[b.key]=b,v=m.wasRequested(),m.hasData()))break}}}return r},i.prototype._updateLoadedParentTileCache=function(){for(var e in this._loadedParentTiles={},this._tiles){for(var t=[],i=void 0,r=this._tiles[e].tileID;r.overscaledZ>0;){if(r.key in this._loadedParentTiles){i=this._loadedParentTiles[r.key];break}t.push(r.key);var n=r.scaledTo(r.overscaledZ-1);if(i=this._getLoadedTile(n))break;r=n}for(var a=0,o=t;a<o.length;a+=1)this._loadedParentTiles[o[a]]=i}},i.prototype._addTile=function(t){var i=this._tiles[t.key];if(i)return i;(i=this._cache.getAndRemove(t))&&(this._setTileReloadTimer(t.key,i),i.tileID=t,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,i)));var r=Boolean(i);return r||(i=new e.Tile(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(i,this._tileLoaded.bind(this,i,t.key,i.state))),i?(i.uses++,this._tiles[t.key]=i,r||this._source.fire(new e.Event("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null},i.prototype._setTileReloadTimer=function(e,t){var i=this;e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);var r=t.getExpiryTimeout();r&&(this._timers[e]=setTimeout((function(){i._reloadTile(e,"expired"),delete i._timers[e]}),r))},i.prototype._removeTile=function(e){var t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))},i.prototype.clearTiles=function(){for(var e in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(e);this._cache.reset()},i.prototype.tilesIn=function(t,i,r){var n=this,a=[],o=this.transform;if(!o)return a;for(var s=r?o.getCameraQueryGeometry(t):t,l=t.map((function(e){return o.pointCoordinate(e)})),c=s.map((function(e){return o.pointCoordinate(e)})),u=this.getIds(),h=1/0,p=1/0,d=-1/0,f=-1/0,m=0,g=c;m<g.length;m+=1){var _=g[m];h=Math.min(h,_.x),p=Math.min(p,_.y),d=Math.max(d,_.x),f=Math.max(f,_.y)}for(var y=function(t){var r=n._tiles[u[t]];if(!r.holdingForFade()){var s=r.tileID,m=Math.pow(2,o.zoom-r.tileID.overscaledZ),g=i*r.queryPadding*e.EXTENT/r.tileSize/m,_=[s.getTilePoint(new e.MercatorCoordinate(h,p)),s.getTilePoint(new e.MercatorCoordinate(d,f))];if(_[0].x-g<e.EXTENT&&_[0].y-g<e.EXTENT&&_[1].x+g>=0&&_[1].y+g>=0){var y=l.map((function(e){return s.getTilePoint(e)})),v=c.map((function(e){return s.getTilePoint(e)}));a.push({tile:r,tileID:s,queryGeometry:y,cameraQueryGeometry:v,scale:m})}}},v=0;v<u.length;v++)y(v);return a},i.prototype.getVisibleCoordinates=function(e){for(var t=this,i=this.getRenderableIds(e).map((function(e){return t._tiles[e].tileID})),r=0,n=i;r<n.length;r+=1){var a=n[r];a.posMatrix=this.transform.calculatePosMatrix(a.toUnwrapped())}return i},i.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Re(this._source.type))for(var t in this._tiles){var i=this._tiles[t];if(void 0!==i.fadeEndTime&&i.fadeEndTime>=e.browser.now())return!0}return!1},i.prototype.setFeatureState=function(e,t,i){this._state.updateState(e=e||"_geojsonTileLayer",t,i)},i.prototype.removeFeatureState=function(e,t,i){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,i)},i.prototype.getFeatureState=function(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)},i.prototype.setDependencies=function(e,t,i){var r=this._tiles[e];r&&r.setDependencies(t,i)},i.prototype.reloadTilesForDependencies=function(e,t){for(var i in this._tiles)this._tiles[i].hasDependency(e,t)&&this._reloadTile(i,"reloading");this._cache.filter((function(i){return!i.hasDependency(e,t)}))},i}(e.Evented);function ze(e,t){var i=Math.abs(2*e.wrap)-+(e.wrap<0),r=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||r-i||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function Re(e){return"raster"===e||"image"===e||"video"===e}function ke(){return new e.window.Worker(Xn.workerUrl)}Pe.maxOverzooming=10,Pe.maxUnderzooming=3;var Le="mapboxgl_preloaded_worker_pool",De=function(){this.active={}};De.prototype.acquire=function(e){if(!this.workers)for(this.workers=[];this.workers.length<De.workerCount;)this.workers.push(new ke);return this.active[e]=!0,this.workers.slice()},De.prototype.release=function(e){delete this.active[e],0===this.numActive()&&(this.workers.forEach((function(e){e.terminate()})),this.workers=null)},De.prototype.isPreloaded=function(){return!!this.active[Le]},De.prototype.numActive=function(){return Object.keys(this.active).length};var Be,Fe=Math.floor(e.browser.hardwareConcurrency/2);function Oe(){return Be||(Be=new De),Be}function Ne(t,i){var r={};for(var n in t)"ref"!==n&&(r[n]=t[n]);return e.refProperties.forEach((function(e){e in i&&(r[e]=i[e])})),r}function Ve(e){e=e.slice();for(var t=Object.create(null),i=0;i<e.length;i++)t[e[i].id]=e[i];for(var r=0;r<e.length;r++)"ref"in e[r]&&(e[r]=Ne(e[r],t[e[r].ref]));return e}De.workerCount=Math.max(Math.min(Fe,6),1);var Ue={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function $e(e,t,i){i.push({command:Ue.addSource,args:[e,t[e]]})}function je(e,t,i){t.push({command:Ue.removeSource,args:[e]}),i[e]=!0}function qe(e,t,i,r){je(e,i,r),$e(e,t,i)}function Ge(t,i,r){var n;for(n in t[r])if(t[r].hasOwnProperty(n)&&"data"!==n&&!e.deepEqual(t[r][n],i[r][n]))return!1;for(n in i[r])if(i[r].hasOwnProperty(n)&&"data"!==n&&!e.deepEqual(t[r][n],i[r][n]))return!1;return!0}function He(t,i,r,n,a,o){var s;for(s in i=i||{},t=t||{})t.hasOwnProperty(s)&&(e.deepEqual(t[s],i[s])||r.push({command:o,args:[n,s,i[s],a]}));for(s in i)i.hasOwnProperty(s)&&!t.hasOwnProperty(s)&&(e.deepEqual(t[s],i[s])||r.push({command:o,args:[n,s,i[s],a]}))}function We(e){return e.id}function Ze(e,t){return e[t.id]=t,e}var Xe=function(e,t){this.reset(e,t)};Xe.prototype.reset=function(e,t){this.points=e||[],this._distances=[0];for(var i=1;i<this.points.length;i++)this._distances[i]=this._distances[i-1]+this.points[i].dist(this.points[i-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Xe.prototype.lerp=function(t){if(1===this.points.length)return this.points[0];t=e.clamp(t,0,1);for(var i=1,r=this._distances[i],n=t*this.paddedLength+this.padding;r<n&&i<this._distances.length;)r=this._distances[++i];var a=i-1,o=this._distances[a],s=r-o,l=s>0?(n-o)/s:0;return this.points[a].mult(1-l).add(this.points[i].mult(l))};var Ye=function(e,t,i){var r=this.boxCells=[],n=this.circleCells=[];this.xCellCount=Math.ceil(e/i),this.yCellCount=Math.ceil(t/i);for(var a=0;a<this.xCellCount*this.yCellCount;a++)r.push([]),n.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0};function Ke(t,i,r,n,a){var o=e.create();return i?(e.scale(o,o,[1/a,1/a,1]),r||e.rotateZ(o,o,n.angle)):e.multiply(o,n.labelPlaneMatrix,t),o}function Je(t,i,r,n,a){if(i){var o=e.clone(t);return e.scale(o,o,[a,a,1]),r||e.rotateZ(o,o,-n.angle),o}return n.glCoordMatrix}function Qe(t,i){var r=[t.x,t.y,0,1];ut(r,r,i);var n=r[3];return{point:new e.Point(r[0]/n,r[1]/n),signedDistanceFromCamera:n}}function et(e,t){return.5+e/t*.5}function tt(e,t){var i=e[0]/e[3],r=e[1]/e[3];return i>=-t[0]&&i<=t[0]&&r>=-t[1]&&r<=t[1]}function it(t,i,r,n,a,o,s,l){var c=n?t.textSizeData:t.iconSizeData,u=e.evaluateSizeForZoom(c,r.transform.zoom),h=[256/r.width*2+1,256/r.height*2+1],p=n?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;p.clear();for(var d=t.lineVertexArray,f=n?t.text.placedSymbolArray:t.icon.placedSymbolArray,m=r.transform.width/r.transform.height,g=!1,_=0;_<f.length;_++){var y=f.get(_);if(y.hidden||y.writingMode===e.WritingMode.vertical&&!g)ct(y.numGlyphs,p);else{g=!1;var v=[y.anchorX,y.anchorY,0,1];if(e.transformMat4(v,v,i),tt(v,h)){var x=et(r.transform.cameraToCenterDistance,v[3]),b=e.evaluateSizeForFeature(c,u,y),w=s?b/x:b*x,S=new e.Point(y.anchorX,y.anchorY),M=Qe(S,a).point,T={},E=at(y,w,!1,l,i,a,o,t.glyphOffsetArray,d,p,M,S,T,m);g=E.useVertical,(E.notEnoughRoom||g||E.needsFlipping&&at(y,w,!0,l,i,a,o,t.glyphOffsetArray,d,p,M,S,T,m).notEnoughRoom)&&ct(y.numGlyphs,p)}else ct(y.numGlyphs,p)}}n?t.text.dynamicLayoutVertexBuffer.updateData(p):t.icon.dynamicLayoutVertexBuffer.updateData(p)}function rt(e,t,i,r,n,a,o,s,l,c,u){var h=s.glyphStartIndex+s.numGlyphs,p=s.lineStartIndex,d=s.lineStartIndex+s.lineLength,f=t.getoffsetX(s.glyphStartIndex),m=t.getoffsetX(h-1),g=st(e*f,i,r,n,a,o,s.segment,p,d,l,c,u);if(!g)return null;var _=st(e*m,i,r,n,a,o,s.segment,p,d,l,c,u);return _?{first:g,last:_}:null}function nt(t,i,r,n){return t===e.WritingMode.horizontal&&Math.abs(r.y-i.y)>Math.abs(r.x-i.x)*n?{useVertical:!0}:(t===e.WritingMode.vertical?i.y<r.y:i.x>r.x)?{needsFlipping:!0}:null}function at(t,i,r,n,a,o,s,l,c,u,h,p,d,f){var m,g=i/24,_=t.lineOffsetX*g,y=t.lineOffsetY*g;if(t.numGlyphs>1){var v=t.glyphStartIndex+t.numGlyphs,x=t.lineStartIndex,b=t.lineStartIndex+t.lineLength,w=rt(g,l,_,y,r,h,p,t,c,o,d);if(!w)return{notEnoughRoom:!0};var S=Qe(w.first.point,s).point,M=Qe(w.last.point,s).point;if(n&&!r){var T=nt(t.writingMode,S,M,f);if(T)return T}m=[w.first];for(var E=t.glyphStartIndex+1;E<v-1;E++)m.push(st(g*l.getoffsetX(E),_,y,r,h,p,t.segment,x,b,c,o,d));m.push(w.last)}else{if(n&&!r){var C=Qe(p,a).point,A=t.lineStartIndex+t.segment+1,I=new e.Point(c.getx(A),c.gety(A)),P=Qe(I,a),z=P.signedDistanceFromCamera>0?P.point:ot(p,I,C,1,a),R=nt(t.writingMode,C,z,f);if(R)return R}var k=st(g*l.getoffsetX(t.glyphStartIndex),_,y,r,h,p,t.segment,t.lineStartIndex,t.lineStartIndex+t.lineLength,c,o,d);if(!k)return{notEnoughRoom:!0};m=[k]}for(var L=0,D=m;L<D.length;L+=1){var B=D[L];e.addDynamicAttributes(u,B.point,B.angle)}return{}}function ot(e,t,i,r,n){var a=Qe(e.add(e.sub(t)._unit()),n).point,o=i.sub(a);return i.add(o._mult(r/o.mag()))}function st(t,i,r,n,a,o,s,l,c,u,h,p){var d=n?t-i:t+i,f=d>0?1:-1,m=0;n&&(f*=-1,m=Math.PI),f<0&&(m+=Math.PI);for(var g=f>0?l+s:l+s+1,_=a,y=a,v=0,x=0,b=Math.abs(d),w=[];v+x<=b;){if((g+=f)<l||g>=c)return null;if(y=_,w.push(_),void 0===(_=p[g])){var S=new e.Point(u.getx(g),u.gety(g)),M=Qe(S,h);if(M.signedDistanceFromCamera>0)_=p[g]=M.point;else{var T=g-f;_=ot(0===v?o:new e.Point(u.getx(T),u.gety(T)),S,y,b-v+1,h)}}v+=x,x=y.dist(_)}var E=(b-v)/x,C=_.sub(y),A=C.mult(E)._add(y);A._add(C._unit()._perp()._mult(r*f));var I=m+Math.atan2(_.y-y.y,_.x-y.x);return w.push(A),{point:A,angle:I,path:w}}Ye.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Ye.prototype.insert=function(e,t,i,r,n){this._forEachCell(t,i,r,n,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)},Ye.prototype.insertCircle=function(e,t,i,r){this._forEachCell(t-r,i-r,t+r,i+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(i),this.circles.push(r)},Ye.prototype._insertBoxCell=function(e,t,i,r,n,a){this.boxCells[n].push(a)},Ye.prototype._insertCircleCell=function(e,t,i,r,n,a){this.circleCells[n].push(a)},Ye.prototype._query=function(e,t,i,r,n,a){if(i<0||e>this.width||r<0||t>this.height)return!n&&[];var o=[];if(e<=0&&t<=0&&this.width<=i&&this.height<=r){if(n)return!0;for(var s=0;s<this.boxKeys.length;s++)o.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});for(var l=0;l<this.circleKeys.length;l++){var c=this.circles[3*l],u=this.circles[3*l+1],h=this.circles[3*l+2];o.push({key:this.circleKeys[l],x1:c-h,y1:u-h,x2:c+h,y2:u+h})}return a?o.filter(a):o}return this._forEachCell(e,t,i,r,this._queryCell,o,{hitTest:n,seenUids:{box:{},circle:{}}},a),n?o.length>0:o},Ye.prototype._queryCircle=function(e,t,i,r,n){var a=e-i,o=e+i,s=t-i,l=t+i;if(o<0||a>this.width||l<0||s>this.height)return!r&&[];var c=[];return this._forEachCell(a,s,o,l,this._queryCellCircle,c,{hitTest:r,circle:{x:e,y:t,radius:i},seenUids:{box:{},circle:{}}},n),r?c.length>0:c},Ye.prototype.query=function(e,t,i,r,n){return this._query(e,t,i,r,!1,n)},Ye.prototype.hitTest=function(e,t,i,r,n){return this._query(e,t,i,r,!0,n)},Ye.prototype.hitTestCircle=function(e,t,i,r){return this._queryCircle(e,t,i,!0,r)},Ye.prototype._queryCell=function(e,t,i,r,n,a,o,s){var l=o.seenUids,c=this.boxCells[n];if(null!==c)for(var u=this.bboxes,h=0,p=c;h<p.length;h+=1){var d=p[h];if(!l.box[d]){l.box[d]=!0;var f=4*d;if(e<=u[f+2]&&t<=u[f+3]&&i>=u[f+0]&&r>=u[f+1]&&(!s||s(this.boxKeys[d]))){if(o.hitTest)return a.push(!0),!0;a.push({key:this.boxKeys[d],x1:u[f],y1:u[f+1],x2:u[f+2],y2:u[f+3]})}}}var m=this.circleCells[n];if(null!==m)for(var g=this.circles,_=0,y=m;_<y.length;_+=1){var v=y[_];if(!l.circle[v]){l.circle[v]=!0;var x=3*v;if(this._circleAndRectCollide(g[x],g[x+1],g[x+2],e,t,i,r)&&(!s||s(this.circleKeys[v]))){if(o.hitTest)return a.push(!0),!0;var b=g[x],w=g[x+1],S=g[x+2];a.push({key:this.circleKeys[v],x1:b-S,y1:w-S,x2:b+S,y2:w+S})}}}},Ye.prototype._queryCellCircle=function(e,t,i,r,n,a,o,s){var l=o.circle,c=o.seenUids,u=this.boxCells[n];if(null!==u)for(var h=this.bboxes,p=0,d=u;p<d.length;p+=1){var f=d[p];if(!c.box[f]){c.box[f]=!0;var m=4*f;if(this._circleAndRectCollide(l.x,l.y,l.radius,h[m+0],h[m+1],h[m+2],h[m+3])&&(!s||s(this.boxKeys[f])))return a.push(!0),!0}}var g=this.circleCells[n];if(null!==g)for(var _=this.circles,y=0,v=g;y<v.length;y+=1){var x=v[y];if(!c.circle[x]){c.circle[x]=!0;var b=3*x;if(this._circlesCollide(_[b],_[b+1],_[b+2],l.x,l.y,l.radius)&&(!s||s(this.circleKeys[x])))return a.push(!0),!0}}},Ye.prototype._forEachCell=function(e,t,i,r,n,a,o,s){for(var l=this._convertToXCellCoord(e),c=this._convertToYCellCoord(t),u=this._convertToXCellCoord(i),h=this._convertToYCellCoord(r),p=l;p<=u;p++)for(var d=c;d<=h;d++)if(n.call(this,e,t,i,r,this.xCellCount*d+p,a,o,s))return},Ye.prototype._convertToXCellCoord=function(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))},Ye.prototype._convertToYCellCoord=function(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))},Ye.prototype._circlesCollide=function(e,t,i,r,n,a){var o=r-e,s=n-t,l=i+a;return l*l>o*o+s*s},Ye.prototype._circleAndRectCollide=function(e,t,i,r,n,a,o){var s=(a-r)/2,l=Math.abs(e-(r+s));if(l>s+i)return!1;var c=(o-n)/2,u=Math.abs(t-(n+c));if(u>c+i)return!1;if(l<=s||u<=c)return!0;var h=l-s,p=u-c;return h*h+p*p<=i*i};var lt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ct(e,t){for(var i=0;i<e;i++){var r=t.length;t.resize(r+4),t.float32.set(lt,3*r)}}function ut(e,t,i){var r=t[0],n=t[1];return e[0]=i[0]*r+i[4]*n+i[12],e[1]=i[1]*r+i[5]*n+i[13],e[3]=i[3]*r+i[7]*n+i[15],e}var ht=function(e,t,i){void 0===t&&(t=new Ye(e.width+200,e.height+200,25)),void 0===i&&(i=new Ye(e.width+200,e.height+200,25)),this.transform=e,this.grid=t,this.ignoredGrid=i,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+100,this.screenBottomBoundary=e.height+100,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200};function pt(t,i,r){return i*(e.EXTENT/(t.tileSize*Math.pow(2,r-t.tileID.overscaledZ)))}ht.prototype.placeCollisionBox=function(e,t,i,r,n){var a=this.projectAndGetPerspectiveRatio(r,e.anchorPointX,e.anchorPointY),o=i*a.perspectiveRatio,s=e.x1*o+a.point.x,l=e.y1*o+a.point.y,c=e.x2*o+a.point.x,u=e.y2*o+a.point.y;return!this.isInsideGrid(s,l,c,u)||!t&&this.grid.hitTest(s,l,c,u,n)?{box:[],offscreen:!1}:{box:[s,l,c,u],offscreen:this.isOffscreen(s,l,c,u)}},ht.prototype.placeCollisionCircles=function(t,i,r,n,a,o,s,l,c,u,h,p,d){var f=[],m=new e.Point(i.anchorX,i.anchorY),g=Qe(m,o),_=et(this.transform.cameraToCenterDistance,g.signedDistanceFromCamera),y=(u?a/_:a*_)/e.ONE_EM,v=Qe(m,s).point,x=rt(y,n,i.lineOffsetX*y,i.lineOffsetY*y,!1,v,m,i,r,s,{}),b=!1,w=!1,S=!0;if(x){for(var M=.5*p*_+d,T=new e.Point(-100,-100),E=new e.Point(this.screenRightBoundary,this.screenBottomBoundary),C=new Xe,A=x.first,I=x.last,P=[],z=A.path.length-1;z>=1;z--)P.push(A.path[z]);for(var R=1;R<I.path.length;R++)P.push(I.path[R]);var k=2.5*M;if(l){var L=P.map((function(e){return Qe(e,l)}));P=L.some((function(e){return e.signedDistanceFromCamera<=0}))?[]:L.map((function(e){return e.point}))}var D=[];if(P.length>0){for(var B=P[0].clone(),F=P[0].clone(),O=1;O<P.length;O++)B.x=Math.min(B.x,P[O].x),B.y=Math.min(B.y,P[O].y),F.x=Math.max(F.x,P[O].x),F.y=Math.max(F.y,P[O].y);D=B.x>=T.x&&F.x<=E.x&&B.y>=T.y&&F.y<=E.y?[P]:F.x<T.x||B.x>E.x||F.y<T.y||B.y>E.y?[]:e.clipLine([P],T.x,T.y,E.x,E.y)}for(var N=0,V=D;N<V.length;N+=1){var U;C.reset(V[N],.25*M),U=C.length<=.5*M?1:Math.ceil(C.paddedLength/k)+1;for(var $=0;$<U;$++){var j=$/Math.max(U-1,1),q=C.lerp(j),G=q.x+100,H=q.y+100;f.push(G,H,M,0);var W=G-M,Z=H-M,X=G+M,Y=H+M;if(S=S&&this.isOffscreen(W,Z,X,Y),w=w||this.isInsideGrid(W,Z,X,Y),!t&&this.grid.hitTestCircle(G,H,M,h)&&(b=!0,!c))return{circles:[],offscreen:!1,collisionDetected:b}}}}return{circles:!c&&b||!w?[]:f,offscreen:S,collisionDetected:b}},ht.prototype.queryRenderedSymbols=function(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};for(var i=[],r=1/0,n=1/0,a=-1/0,o=-1/0,s=0,l=t;s<l.length;s+=1){var c=l[s],u=new e.Point(c.x+100,c.y+100);r=Math.min(r,u.x),n=Math.min(n,u.y),a=Math.max(a,u.x),o=Math.max(o,u.y),i.push(u)}for(var h={},p={},d=0,f=this.grid.query(r,n,a,o).concat(this.ignoredGrid.query(r,n,a,o));d<f.length;d+=1){var m=f[d],g=m.key;if(void 0===h[g.bucketInstanceId]&&(h[g.bucketInstanceId]={}),!h[g.bucketInstanceId][g.featureIndex]){var _=[new e.Point(m.x1,m.y1),new e.Point(m.x2,m.y1),new e.Point(m.x2,m.y2),new e.Point(m.x1,m.y2)];e.polygonIntersectsPolygon(i,_)&&(h[g.bucketInstanceId][g.featureIndex]=!0,void 0===p[g.bucketInstanceId]&&(p[g.bucketInstanceId]=[]),p[g.bucketInstanceId].push(g.featureIndex))}}return p},ht.prototype.insertCollisionBox=function(e,t,i,r,n){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:r,collisionGroupID:n},e[0],e[1],e[2],e[3])},ht.prototype.insertCollisionCircles=function(e,t,i,r,n){for(var a=t?this.ignoredGrid:this.grid,o={bucketInstanceId:i,featureIndex:r,collisionGroupID:n},s=0;s<e.length;s+=4)a.insertCircle(o,e[s],e[s+1],e[s+2])},ht.prototype.projectAndGetPerspectiveRatio=function(t,i,r){var n=[i,r,0,1];return ut(n,n,t),{point:new e.Point((n[0]/n[3]+1)/2*this.transform.width+100,(-n[1]/n[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/n[3]*.5}},ht.prototype.isOffscreen=function(e,t,i,r){return i<100||e>=this.screenRightBoundary||r<100||t>this.screenBottomBoundary},ht.prototype.isInsideGrid=function(e,t,i,r){return i>=0&&e<this.gridRightBoundary&&r>=0&&t<this.gridBottomBoundary},ht.prototype.getViewportMatrix=function(){var t=e.identity([]);return e.translate(t,t,[-100,-100,0]),t};var dt=function(e,t,i,r){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):r&&i?1:0,this.placed=i};dt.prototype.isHidden=function(){return 0===this.opacity&&!this.placed};var ft=function(e,t,i,r,n){this.text=new dt(e?e.text:null,t,i,n),this.icon=new dt(e?e.icon:null,t,r,n)};ft.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var mt=function(e,t,i){this.text=e,this.icon=t,this.skipFade=i},gt=function(){this.invProjMatrix=e.create(),this.viewportMatrix=e.create(),this.circles=[]},_t=function(e,t,i,r,n){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=i,this.bucketIndex=r,this.tileID=n},yt=function(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}};function vt(t,i,r,n,a){var o=e.getAnchorAlignment(t),s=-(o.horizontalAlign-.5)*i,l=-(o.verticalAlign-.5)*r,c=e.evaluateVariableOffset(t,n);return new e.Point(s+c[0]*a,l+c[1]*a)}function xt(t,i,r,n,a,o){var s=t.x1,l=t.x2,c=t.y1,u=t.y2,h=t.anchorPointX,p=t.anchorPointY,d=new e.Point(i,r);return n&&d._rotate(a?o:-o),{x1:s+d.x,y1:c+d.y,x2:l+d.x,y2:u+d.y,anchorPointX:h,anchorPointY:p}}yt.prototype.get=function(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){var t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:function(e){return e.collisionGroupID===t}}}return this.collisionGroups[e]};var bt=function(e,t,i,r){this.transform=e.clone(),this.collisionIndex=new ht(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new yt(i),this.collisionCircleArrays={},this.prevPlacement=r,r&&(r.prevPlacement=void 0),this.placedOrientations={}};function wt(e,t,i,r,n){e.emplaceBack(t?1:0,i?1:0,r||0,n||0),e.emplaceBack(t?1:0,i?1:0,r||0,n||0),e.emplaceBack(t?1:0,i?1:0,r||0,n||0),e.emplaceBack(t?1:0,i?1:0,r||0,n||0)}bt.prototype.getBucketParts=function(t,i,r,n){var a=r.getBucket(i),o=r.latestFeatureIndex;if(a&&o&&i.id===a.layerIds[0]){var s=r.collisionBoxArray,l=a.layers[0].layout,c=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),u=r.tileSize/e.EXTENT,h=this.transform.calculatePosMatrix(r.tileID.toUnwrapped()),p="map"===l.get("text-pitch-alignment"),d="map"===l.get("text-rotation-alignment"),f=pt(r,1,this.transform.zoom),m=Ke(h,p,d,this.transform,f),g=null;if(p){var _=Je(h,p,d,this.transform,f);g=e.multiply([],this.transform.labelPlaneMatrix,_)}this.retainedQueryData[a.bucketInstanceId]=new _t(a.bucketInstanceId,o,a.sourceLayerIndex,a.index,r.tileID);var y={bucket:a,layout:l,posMatrix:h,textLabelPlaneMatrix:m,labelToScreenMatrix:g,scale:c,textPixelRatio:u,holdingForFade:r.holdingForFade(),collisionBoxArray:s,partiallyEvaluatedTextSize:e.evaluateSizeForZoom(a.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(a.sourceID)};if(n)for(var v=0,x=a.sortKeyRanges;v<x.length;v+=1){var b=x[v];t.push({sortKey:b.sortKey,symbolInstanceStart:b.symbolInstanceStart,symbolInstanceEnd:b.symbolInstanceEnd,parameters:y})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:a.symbolInstances.length,parameters:y})}},bt.prototype.attemptAnchorPlacement=function(e,t,i,r,n,a,o,s,l,c,u,h,p,d,f){var m,g=[h.textOffset0,h.textOffset1],_=vt(e,i,r,g,n),y=this.collisionIndex.placeCollisionBox(xt(t,_.x,_.y,a,o,this.transform.angle),u,s,l,c.predicate);if(!f||0!==this.collisionIndex.placeCollisionBox(xt(f,_.x,_.y,a,o,this.transform.angle),u,s,l,c.predicate).box.length)return y.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID].text&&(m=this.prevPlacement.variableOffsets[h.crossTileID].anchor),this.variableOffsets[h.crossTileID]={textOffset:g,width:i,height:r,anchor:e,textBoxScale:n,prevAnchor:m},this.markUsedJustification(p,e,h,d),p.allowVerticalPlacement&&(this.markUsedOrientation(p,d,h),this.placedOrientations[h.crossTileID]=d),{shift:_,placedGlyphBoxes:y}):void 0},bt.prototype.placeLayerBucketPart=function(t,i,r){var n=this,a=t.parameters,o=a.bucket,s=a.layout,l=a.posMatrix,c=a.textLabelPlaneMatrix,u=a.labelToScreenMatrix,h=a.textPixelRatio,p=a.holdingForFade,d=a.collisionBoxArray,f=a.partiallyEvaluatedTextSize,m=a.collisionGroup,g=s.get("text-optional"),_=s.get("icon-optional"),y=s.get("text-allow-overlap"),v=s.get("icon-allow-overlap"),x="map"===s.get("text-rotation-alignment"),b="map"===s.get("text-pitch-alignment"),w="none"!==s.get("icon-text-fit"),S="viewport-y"===s.get("symbol-z-order"),M=y&&(v||!o.hasIconData()||_),T=v&&(y||!o.hasTextData()||g);!o.collisionArrays&&d&&o.deserializeCollisionBoxes(d);var E=function(t,a){if(!i[t.crossTileID])if(p)n.placements[t.crossTileID]=new mt(!1,!1,!1);else{var d,S=!1,E=!1,C=!0,A=null,I={box:null,offscreen:null},P={box:null,offscreen:null},z=null,R=null,k=0,L=0,D=0;a.textFeatureIndex?k=a.textFeatureIndex:t.useRuntimeCollisionCircles&&(k=t.featureIndex),a.verticalTextFeatureIndex&&(L=a.verticalTextFeatureIndex);var B=a.textBox;if(B){var F=function(i){var r=e.WritingMode.horizontal;if(o.allowVerticalPlacement&&!i&&n.prevPlacement){var a=n.prevPlacement.placedOrientations[t.crossTileID];a&&(n.placedOrientations[t.crossTileID]=a,n.markUsedOrientation(o,r=a,t))}return r},O=function(i,r){if(o.allowVerticalPlacement&&t.numVerticalGlyphVertices>0&&a.verticalTextBox)for(var n=0,s=o.writingModes;n<s.length&&(s[n]===e.WritingMode.vertical?(I=r(),P=I):I=i(),!(I&&I.box&&I.box.length));n+=1);else I=i()};if(s.get("text-variable-anchor")){var N=s.get("text-variable-anchor");if(n.prevPlacement&&n.prevPlacement.variableOffsets[t.crossTileID]){var V=n.prevPlacement.variableOffsets[t.crossTileID];N.indexOf(V.anchor)>0&&(N=N.filter((function(e){return e!==V.anchor}))).unshift(V.anchor)}var U=function(e,i,r){for(var a=e.x2-e.x1,s=e.y2-e.y1,c=t.textBoxScale,u=w&&!v?i:null,p={box:[],offscreen:!1},d=y?2*N.length:N.length,f=0;f<d;++f){var g=n.attemptAnchorPlacement(N[f%N.length],e,a,s,c,x,b,h,l,m,f>=N.length,t,o,r,u);if(g&&(p=g.placedGlyphBoxes)&&p.box&&p.box.length){S=!0,A=g.shift;break}}return p};O((function(){return U(B,a.iconBox,e.WritingMode.horizontal)}),(function(){var i=a.verticalTextBox;return o.allowVerticalPlacement&&!(I&&I.box&&I.box.length)&&t.numVerticalGlyphVertices>0&&i?U(i,a.verticalIconBox,e.WritingMode.vertical):{box:null,offscreen:null}})),I&&(S=I.box,C=I.offscreen);var $=F(I&&I.box);if(!S&&n.prevPlacement){var j=n.prevPlacement.variableOffsets[t.crossTileID];j&&(n.variableOffsets[t.crossTileID]=j,n.markUsedJustification(o,j.anchor,t,$))}}else{var q=function(e,i){var r=n.collisionIndex.placeCollisionBox(e,y,h,l,m.predicate);return r&&r.box&&r.box.length&&(n.markUsedOrientation(o,i,t),n.placedOrientations[t.crossTileID]=i),r};O((function(){return q(B,e.WritingMode.horizontal)}),(function(){var i=a.verticalTextBox;return o.allowVerticalPlacement&&t.numVerticalGlyphVertices>0&&i?q(i,e.WritingMode.vertical):{box:null,offscreen:null}})),F(I&&I.box&&I.box.length)}}if(S=(d=I)&&d.box&&d.box.length>0,C=d&&d.offscreen,t.useRuntimeCollisionCircles){var G=o.text.placedSymbolArray.get(t.centerJustifiedTextSymbolIndex),H=e.evaluateSizeForFeature(o.textSizeData,f,G),W=s.get("text-padding");z=n.collisionIndex.placeCollisionCircles(y,G,o.lineVertexArray,o.glyphOffsetArray,H,l,c,u,r,b,m.predicate,t.collisionCircleDiameter,W),S=y||z.circles.length>0&&!z.collisionDetected,C=C&&z.offscreen}if(a.iconFeatureIndex&&(D=a.iconFeatureIndex),a.iconBox){var Z=function(e){var t=w&&A?xt(e,A.x,A.y,x,b,n.transform.angle):e;return n.collisionIndex.placeCollisionBox(t,v,h,l,m.predicate)};E=P&&P.box&&P.box.length&&a.verticalIconBox?(R=Z(a.verticalIconBox)).box.length>0:(R=Z(a.iconBox)).box.length>0,C=C&&R.offscreen}var X=g||0===t.numHorizontalGlyphVertices&&0===t.numVerticalGlyphVertices,Y=_||0===t.numIconVertices;if(X||Y?Y?X||(E=E&&S):S=E&&S:E=S=E&&S,S&&d&&d.box&&n.collisionIndex.insertCollisionBox(d.box,s.get("text-ignore-placement"),o.bucketInstanceId,P&&P.box&&L?L:k,m.ID),E&&R&&n.collisionIndex.insertCollisionBox(R.box,s.get("icon-ignore-placement"),o.bucketInstanceId,D,m.ID),z&&(S&&n.collisionIndex.insertCollisionCircles(z.circles,s.get("text-ignore-placement"),o.bucketInstanceId,k,m.ID),r)){var K=o.bucketInstanceId,J=n.collisionCircleArrays[K];void 0===J&&(J=n.collisionCircleArrays[K]=new gt);for(var Q=0;Q<z.circles.length;Q+=4)J.circles.push(z.circles[Q+0]),J.circles.push(z.circles[Q+1]),J.circles.push(z.circles[Q+2]),J.circles.push(z.collisionDetected?1:0)}n.placements[t.crossTileID]=new mt(S||M,E||T,C||o.justReloaded),i[t.crossTileID]=!0}};if(S)for(var C=o.getSortedSymbolIndexes(this.transform.angle),A=C.length-1;A>=0;--A){var I=C[A];E(o.symbolInstances.get(I),o.collisionArrays[I])}else for(var P=t.symbolInstanceStart;P<t.symbolInstanceEnd;P++)E(o.symbolInstances.get(P),o.collisionArrays[P]);if(r&&o.bucketInstanceId in this.collisionCircleArrays){var z=this.collisionCircleArrays[o.bucketInstanceId];e.invert(z.invProjMatrix,l),z.viewportMatrix=this.collisionIndex.getViewportMatrix()}o.justReloaded=!1},bt.prototype.markUsedJustification=function(t,i,r,n){var a;a=n===e.WritingMode.vertical?r.verticalPlacedTextSymbolIndex:{left:r.leftJustifiedTextSymbolIndex,center:r.centerJustifiedTextSymbolIndex,right:r.rightJustifiedTextSymbolIndex}[e.getAnchorJustification(i)];for(var o=0,s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex,r.verticalPlacedTextSymbolIndex];o<s.length;o+=1){var l=s[o];l>=0&&(t.text.placedSymbolArray.get(l).crossTileID=a>=0&&l!==a?0:r.crossTileID)}},bt.prototype.markUsedOrientation=function(t,i,r){for(var n=i===e.WritingMode.horizontal||i===e.WritingMode.horizontalOnly?i:0,a=i===e.WritingMode.vertical?i:0,o=0,s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex];o<s.length;o+=1)t.text.placedSymbolArray.get(s[o]).placedOrientation=n;r.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).placedOrientation=a)},bt.prototype.commit=function(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;var t=this.prevPlacement,i=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;var r=t?t.symbolFadeChange(e):1,n=t?t.opacities:{},a=t?t.variableOffsets:{},o=t?t.placedOrientations:{};for(var s in this.placements){var l=this.placements[s],c=n[s];c?(this.opacities[s]=new ft(c,r,l.text,l.icon),i=i||l.text!==c.text.placed||l.icon!==c.icon.placed):(this.opacities[s]=new ft(null,r,l.text,l.icon,l.skipFade),i=i||l.text||l.icon)}for(var u in n){var h=n[u];if(!this.opacities[u]){var p=new ft(h,r,!1,!1);p.isHidden()||(this.opacities[u]=p,i=i||h.text.placed||h.icon.placed)}}for(var d in a)this.variableOffsets[d]||!this.opacities[d]||this.opacities[d].isHidden()||(this.variableOffsets[d]=a[d]);for(var f in o)this.placedOrientations[f]||!this.opacities[f]||this.opacities[f].isHidden()||(this.placedOrientations[f]=o[f]);i?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)},bt.prototype.updateLayerOpacities=function(e,t){for(var i={},r=0,n=t;r<n.length;r+=1){var a=n[r],o=a.getBucket(e);o&&a.latestFeatureIndex&&e.id===o.layerIds[0]&&this.updateBucketOpacities(o,i,a.collisionBoxArray)}},bt.prototype.updateBucketOpacities=function(t,i,r){var n=this;t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();var a=t.layers[0].layout,o=new ft(null,0,!1,!1,!0),s=a.get("text-allow-overlap"),l=a.get("icon-allow-overlap"),c=a.get("text-variable-anchor"),u="map"===a.get("text-rotation-alignment"),h="map"===a.get("text-pitch-alignment"),p="none"!==a.get("icon-text-fit"),d=new ft(null,0,s&&(l||!t.hasIconData()||a.get("icon-optional")),l&&(s||!t.hasTextData()||a.get("text-optional")),!0);!t.collisionArrays&&r&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(r);for(var f=function(e,t,i){for(var r=0;r<t/4;r++)e.opacityVertexArray.emplaceBack(i)},m=function(r){var a=t.symbolInstances.get(r),s=a.numHorizontalGlyphVertices,l=a.numVerticalGlyphVertices,m=a.crossTileID,g=n.opacities[m];i[m]?g=o:g||(n.opacities[m]=g=d),i[m]=!0;var _=a.numIconVertices>0,y=n.placedOrientations[a.crossTileID],v=y===e.WritingMode.vertical,x=y===e.WritingMode.horizontal||y===e.WritingMode.horizontalOnly;if(s>0||l>0){var b=Pt(g.text);f(t.text,s,v?zt:b),f(t.text,l,x?zt:b);var w=g.text.isHidden();[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((function(e){e>=0&&(t.text.placedSymbolArray.get(e).hidden=w||v?1:0)})),a.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).hidden=w||x?1:0);var S=n.variableOffsets[a.crossTileID];S&&n.markUsedJustification(t,S.anchor,a,y);var M=n.placedOrientations[a.crossTileID];M&&(n.markUsedJustification(t,"left",a,M),n.markUsedOrientation(t,M,a))}if(_){var T=Pt(g.icon),E=!(p&&a.verticalPlacedIconSymbolIndex&&v);a.placedIconSymbolIndex>=0&&(f(t.icon,a.numIconVertices,E?T:zt),t.icon.placedSymbolArray.get(a.placedIconSymbolIndex).hidden=g.icon.isHidden()),a.verticalPlacedIconSymbolIndex>=0&&(f(t.icon,a.numVerticalIconVertices,E?zt:T),t.icon.placedSymbolArray.get(a.verticalPlacedIconSymbolIndex).hidden=g.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){var C=t.collisionArrays[r];if(C){var A=new e.Point(0,0);if(C.textBox||C.verticalTextBox){var I=!0;if(c){var P=n.variableOffsets[m];P?(A=vt(P.anchor,P.width,P.height,P.textOffset,P.textBoxScale),u&&A._rotate(h?n.transform.angle:-n.transform.angle)):I=!1}C.textBox&&wt(t.textCollisionBox.collisionVertexArray,g.text.placed,!I||v,A.x,A.y),C.verticalTextBox&&wt(t.textCollisionBox.collisionVertexArray,g.text.placed,!I||x,A.x,A.y)}var z=Boolean(!x&&C.verticalIconBox);C.iconBox&&wt(t.iconCollisionBox.collisionVertexArray,g.icon.placed,z,p?A.x:0,p?A.y:0),C.verticalIconBox&&wt(t.iconCollisionBox.collisionVertexArray,g.icon.placed,!z,p?A.x:0,p?A.y:0)}}},g=0;g<t.symbolInstances.length;g++)m(g);if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){var _=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=_.invProjMatrix,t.placementViewportMatrix=_.viewportMatrix,t.collisionCircleArray=_.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}},bt.prototype.symbolFadeChange=function(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},bt.prototype.zoomAdjustment=function(e){return Math.max(0,(this.transform.zoom-e)/1.5)},bt.prototype.hasTransitions=function(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration},bt.prototype.stillRecent=function(e,t){var i=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*i>e},bt.prototype.setStale=function(){this.stale=!0};var St=Math.pow(2,25),Mt=Math.pow(2,24),Tt=Math.pow(2,17),Et=Math.pow(2,16),Ct=Math.pow(2,9),At=Math.pow(2,8),It=Math.pow(2,1);function Pt(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;var t=e.placed?1:0,i=Math.floor(127*e.opacity);return i*St+t*Mt+i*Tt+t*Et+i*Ct+t*At+i*It+t}var zt=0,Rt=function(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&void 0!==e.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Rt.prototype.continuePlacement=function(e,t,i,r,n){for(var a=this._bucketParts;this._currentTileIndex<e.length;)if(t.getBucketParts(a,r,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,n())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,a.sort((function(e,t){return e.sortKey-t.sortKey})));this._currentPartIndex<a.length;)if(t.placeLayerBucketPart(a[this._currentPartIndex],this._seenCrossTileIDs,i),this._currentPartIndex++,n())return!0;return!1};var kt=function(e,t,i,r,n,a,o){this.placement=new bt(e,n,a,o),this._currentPlacementIndex=t.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=r,this._done=!1};kt.prototype.isDone=function(){return this._done},kt.prototype.continuePlacement=function(t,i,r){for(var n=this,a=e.browser.now(),o=function(){var t=e.browser.now()-a;return!n._forceFullPlacement&&t>2};this._currentPlacementIndex>=0;){var s=i[t[this._currentPlacementIndex]],l=this.placement.collisionIndex.transform.zoom;if("symbol"===s.type&&(!s.minzoom||s.minzoom<=l)&&(!s.maxzoom||s.maxzoom>l)){if(this._inProgressLayer||(this._inProgressLayer=new Rt(s)),this._inProgressLayer.continuePlacement(r[s.source],this.placement,this._showCollisionBoxes,s,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},kt.prototype.commit=function(e){return this.placement.commit(e),this.placement};var Lt=512/e.EXTENT/2,Dt=function(e,t,i){this.tileID=e,this.indexedSymbolInstances={},this.bucketInstanceId=i;for(var r=0;r<t.length;r++){var n=t.get(r),a=n.key;this.indexedSymbolInstances[a]||(this.indexedSymbolInstances[a]=[]),this.indexedSymbolInstances[a].push({crossTileID:n.crossTileID,coord:this.getScaledCoordinates(n,e)})}};Dt.prototype.getScaledCoordinates=function(t,i){var r=Lt/Math.pow(2,i.canonical.z-this.tileID.canonical.z);return{x:Math.floor((i.canonical.x*e.EXTENT+t.anchorX)*r),y:Math.floor((i.canonical.y*e.EXTENT+t.anchorY)*r)}},Dt.prototype.findMatches=function(e,t,i){for(var r=this.tileID.canonical.z<t.canonical.z?1:Math.pow(2,this.tileID.canonical.z-t.canonical.z),n=0;n<e.length;n++){var a=e.get(n);if(!a.crossTileID){var o=this.indexedSymbolInstances[a.key];if(o)for(var s=this.getScaledCoordinates(a,t),l=0,c=o;l<c.length;l+=1){var u=c[l];if(Math.abs(u.coord.x-s.x)<=r&&Math.abs(u.coord.y-s.y)<=r&&!i[u.crossTileID]){i[u.crossTileID]=!0,a.crossTileID=u.crossTileID;break}}}}};var Bt=function(){this.maxCrossTileID=0};Bt.prototype.generate=function(){return++this.maxCrossTileID};var Ft=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Ft.prototype.handleWrapJump=function(e){var t=Math.round((e-this.lng)/360);if(0!==t)for(var i in this.indexes){var r=this.indexes[i],n={};for(var a in r){var o=r[a];o.tileID=o.tileID.unwrapTo(o.tileID.wrap+t),n[o.tileID.key]=o}this.indexes[i]=n}this.lng=e},Ft.prototype.addBucket=function(e,t,i){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(var r=0;r<t.symbolInstances.length;r++)t.symbolInstances.get(r).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});var n=this.usedCrossTileIDs[e.overscaledZ];for(var a in this.indexes){var o=this.indexes[a];if(Number(a)>e.overscaledZ)for(var s in o){var l=o[s];l.tileID.isChildOf(e)&&l.findMatches(t.symbolInstances,e,n)}else{var c=o[e.scaledTo(Number(a)).key];c&&c.findMatches(t.symbolInstances,e,n)}}for(var u=0;u<t.symbolInstances.length;u++){var h=t.symbolInstances.get(u);h.crossTileID||(h.crossTileID=i.generate(),n[h.crossTileID]=!0)}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Dt(e,t.symbolInstances,t.bucketInstanceId),!0},Ft.prototype.removeBucketCrossTileIDs=function(e,t){for(var i in t.indexedSymbolInstances)for(var r=0,n=t.indexedSymbolInstances[i];r<n.length;r+=1)delete this.usedCrossTileIDs[e][n[r].crossTileID]},Ft.prototype.removeStaleBuckets=function(e){var t=!1;for(var i in this.indexes){var r=this.indexes[i];for(var n in r)e[r[n].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,r[n]),delete r[n],t=!0)}return t};var Ot=function(){this.layerIndexes={},this.crossTileIDs=new Bt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Ot.prototype.addLayer=function(e,t,i){var r=this.layerIndexes[e.id];void 0===r&&(r=this.layerIndexes[e.id]=new Ft);var n=!1,a={};r.handleWrapJump(i);for(var o=0,s=t;o<s.length;o+=1){var l=s[o],c=l.getBucket(e);c&&e.id===c.layerIds[0]&&(c.bucketInstanceId||(c.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(l.tileID,c,this.crossTileIDs)&&(n=!0),a[c.bucketInstanceId]=!0)}return r.removeStaleBuckets(a)&&(n=!0),n},Ot.prototype.pruneUnusedLayers=function(e){var t={};for(var i in e.forEach((function(e){t[e]=!0})),this.layerIndexes)t[i]||delete this.layerIndexes[i]};var Nt=function(t,i){return e.emitValidationErrors(t,i&&i.filter((function(e){return"source.canvas"!==e.identifier})))},Vt=e.pick(Ue,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Ut=e.pick(Ue,["setCenter","setZoom","setBearing","setPitch"]),$t=function(){var t={},i=e.styleSpec.$version;for(var r in e.styleSpec.$root){var n,a=e.styleSpec.$root[r];a.required&&null!=(n="version"===r?i:"array"===a.type?[]:{})&&(t[r]=n)}return t}(),jt=function(t){function i(r,n){var a=this;void 0===n&&(n={}),t.call(this),this.map=r,this.dispatcher=new M(Oe(),this),this.imageManager=new p,this.imageManager.setEventedParent(this),this.glyphManager=new v(r._requestManager,n.localIdeographFontFamily),this.lineAtlas=new S(256,512),this.crossTileSymbolIndex=new Ot,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new e.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",e.getReferrer());var o=this;this._rtlTextPluginCallback=i.registerForPluginStateChange((function(t){o.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t.pluginStatus,pluginURL:t.pluginURL},(function(t,i){if(e.triggerPluginCompletionEvent(t),i&&i.every((function(e){return e})))for(var r in o.sourceCaches)o.sourceCaches[r].reload()}))})),this.on("data",(function(e){if("source"===e.dataType&&"metadata"===e.sourceDataType){var t=a.sourceCaches[e.sourceId];if(t){var i=t.getSource();if(i&&i.vectorLayerIds)for(var r in a._layers){var n=a._layers[r];n.source===i.id&&a._validateLayer(n)}}}}))}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.loadURL=function(t,i){var r=this;void 0===i&&(i={}),this.fire(new e.Event("dataloading",{dataType:"style"}));var n="boolean"==typeof i.validate?i.validate:!e.isMapboxURL(t);t=this.map._requestManager.normalizeStyleURL(t,i.accessToken);var a=this.map._requestManager.transformRequest(t,e.ResourceType.Style);this._request=e.getJSON(a,(function(t,i){r._request=null,t?r.fire(new e.ErrorEvent(t)):i&&r._load(i,n)}))},i.prototype.loadJSON=function(t,i){var r=this;void 0===i&&(i={}),this.fire(new e.Event("dataloading",{dataType:"style"})),this._request=e.browser.frame((function(){r._request=null,r._load(t,!1!==i.validate)}))},i.prototype.loadEmpty=function(){this.fire(new e.Event("dataloading",{dataType:"style"})),this._load($t,!1)},i.prototype._load=function(t,i){if(!i||!Nt(this,e.validateStyle(t))){for(var r in this._loaded=!0,this.stylesheet=t,t.sources)this.addSource(r,t.sources[r],{validate:!1});t.sprite?this._loadSprite(t.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(t.glyphs);var n=Ve(this.stylesheet.layers);this._order=n.map((function(e){return e.id})),this._layers={},this._serializedLayers={};for(var a=0,o=n;a<o.length;a+=1){var s=o[a];(s=e.createStyleLayer(s)).setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=s,this._serializedLayers[s.id]=s.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new w(this.stylesheet.light),this.fire(new e.Event("data",{dataType:"style"})),this.fire(new e.Event("style.load"))}},i.prototype._loadSprite=function(t){var i=this;this._spriteRequest=function(t,i,r){var n,a,o,s=e.browser.devicePixelRatio>1?"@2x":"",l=e.getJSON(i.transformRequest(i.normalizeSpriteURL(t,s,".json"),e.ResourceType.SpriteJSON),(function(e,t){l=null,o||(o=e,n=t,u())})),c=e.getImage(i.transformRequest(i.normalizeSpriteURL(t,s,".png"),e.ResourceType.SpriteImage),(function(e,t){c=null,o||(o=e,a=t,u())}));function u(){if(o)r(o);else if(n&&a){var t=e.browser.getImageData(a),i={};for(var s in n){var l=n[s],c=l.width,u=l.height,h=l.x,p=l.y,d=l.sdf,f=l.pixelRatio,m=l.stretchX,g=l.stretchY,_=l.content,y=new e.RGBAImage({width:c,height:u});e.RGBAImage.copy(t,y,{x:h,y:p},{x:0,y:0},{width:c,height:u}),i[s]={data:y,pixelRatio:f,sdf:d,stretchX:m,stretchY:g,content:_}}r(null,i)}}return{cancel:function(){l&&(l.cancel(),l=null),c&&(c.cancel(),c=null)}}}(t,this.map._requestManager,(function(t,r){if(i._spriteRequest=null,t)i.fire(new e.ErrorEvent(t));else if(r)for(var n in r)i.imageManager.addImage(n,r[n]);i.imageManager.setLoaded(!0),i._availableImages=i.imageManager.listImages(),i.dispatcher.broadcast("setImages",i._availableImages),i.fire(new e.Event("data",{dataType:"style"}))}))},i.prototype._validateLayer=function(t){var i=this.sourceCaches[t.source];if(i){var r=t.sourceLayer;if(r){var n=i.getSource();("geojson"===n.type||n.vectorLayerIds&&-1===n.vectorLayerIds.indexOf(r))&&this.fire(new e.ErrorEvent(new Error('Source layer "'+r+'" does not exist on source "'+n.id+'" as specified by style layer "'+t.id+'"')))}}},i.prototype.loaded=function(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()},i.prototype._serializeLayers=function(e){for(var t=[],i=0,r=e;i<r.length;i+=1){var n=this._layers[r[i]];"custom"!==n.type&&t.push(n.serialize())}return t},i.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(var t in this._layers)if(this._layers[t].hasTransition())return!0;return!1},i.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},i.prototype.update=function(t){if(this._loaded){var i=this._changed;if(this._changed){var r=Object.keys(this._updatedLayers),n=Object.keys(this._removedLayers);for(var a in(r.length||n.length)&&this._updateWorkerLayers(r,n),this._updatedSources){var o=this._updatedSources[a];"reload"===o?this._reloadSource(a):"clear"===o&&this._clearSource(a)}for(var s in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[s].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}var l={};for(var c in this.sourceCaches){var u=this.sourceCaches[c];l[c]=u.used,u.used=!1}for(var h=0,p=this._order;h<p.length;h+=1){var d=this._layers[p[h]];d.recalculate(t,this._availableImages),!d.isHidden(t.zoom)&&d.source&&(this.sourceCaches[d.source].used=!0)}for(var f in l){var m=this.sourceCaches[f];l[f]!==m.used&&m.fire(new e.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:f}))}this.light.recalculate(t),this.z=t.zoom,i&&this.fire(new e.Event("data",{dataType:"style"}))}},i.prototype._updateTilesForChangedImages=function(){var e=Object.keys(this._changedImages);if(e.length){for(var t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}},i.prototype._updateWorkerLayers=function(e,t){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(e),removedIds:t})},i.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},i.prototype.setState=function(t){var i=this;if(this._checkLoaded(),Nt(this,e.validateStyle(t)))return!1;(t=e.clone$1(t)).layers=Ve(t.layers);var r=function(t,i){if(!t)return[{command:Ue.setStyle,args:[i]}];var r=[];try{if(!e.deepEqual(t.version,i.version))return[{command:Ue.setStyle,args:[i]}];e.deepEqual(t.center,i.center)||r.push({command:Ue.setCenter,args:[i.center]}),e.deepEqual(t.zoom,i.zoom)||r.push({command:Ue.setZoom,args:[i.zoom]}),e.deepEqual(t.bearing,i.bearing)||r.push({command:Ue.setBearing,args:[i.bearing]}),e.deepEqual(t.pitch,i.pitch)||r.push({command:Ue.setPitch,args:[i.pitch]}),e.deepEqual(t.sprite,i.sprite)||r.push({command:Ue.setSprite,args:[i.sprite]}),e.deepEqual(t.glyphs,i.glyphs)||r.push({command:Ue.setGlyphs,args:[i.glyphs]}),e.deepEqual(t.transition,i.transition)||r.push({command:Ue.setTransition,args:[i.transition]}),e.deepEqual(t.light,i.light)||r.push({command:Ue.setLight,args:[i.light]});var n={},a=[];!function(t,i,r,n){var a;for(a in i=i||{},t=t||{})t.hasOwnProperty(a)&&(i.hasOwnProperty(a)||je(a,r,n));for(a in i)i.hasOwnProperty(a)&&(t.hasOwnProperty(a)?e.deepEqual(t[a],i[a])||("geojson"===t[a].type&&"geojson"===i[a].type&&Ge(t,i,a)?r.push({command:Ue.setGeoJSONSourceData,args:[a,i[a].data]}):qe(a,i,r,n)):$e(a,i,r))}(t.sources,i.sources,a,n);var o=[];t.layers&&t.layers.forEach((function(e){n[e.source]?r.push({command:Ue.removeLayer,args:[e.id]}):o.push(e)})),r=r.concat(a),function(t,i,r){i=i||[];var n,a,o,s,l,c,u,h=(t=t||[]).map(We),p=i.map(We),d=t.reduce(Ze,{}),f=i.reduce(Ze,{}),m=h.slice(),g=Object.create(null);for(n=0,a=0;n<h.length;n++)f.hasOwnProperty(o=h[n])?a++:(r.push({command:Ue.removeLayer,args:[o]}),m.splice(m.indexOf(o,a),1));for(n=0,a=0;n<p.length;n++)m[m.length-1-n]!==(o=p[p.length-1-n])&&(d.hasOwnProperty(o)?(r.push({command:Ue.removeLayer,args:[o]}),m.splice(m.lastIndexOf(o,m.length-a),1)):a++,r.push({command:Ue.addLayer,args:[f[o],c=m[m.length-n]]}),m.splice(m.length-n,0,o),g[o]=!0);for(n=0;n<p.length;n++)if(s=d[o=p[n]],l=f[o],!g[o]&&!e.deepEqual(s,l))if(e.deepEqual(s.source,l.source)&&e.deepEqual(s["source-layer"],l["source-layer"])&&e.deepEqual(s.type,l.type)){for(u in He(s.layout,l.layout,r,o,null,Ue.setLayoutProperty),He(s.paint,l.paint,r,o,null,Ue.setPaintProperty),e.deepEqual(s.filter,l.filter)||r.push({command:Ue.setFilter,args:[o,l.filter]}),e.deepEqual(s.minzoom,l.minzoom)&&e.deepEqual(s.maxzoom,l.maxzoom)||r.push({command:Ue.setLayerZoomRange,args:[o,l.minzoom,l.maxzoom]}),s)s.hasOwnProperty(u)&&"layout"!==u&&"paint"!==u&&"filter"!==u&&"metadata"!==u&&"minzoom"!==u&&"maxzoom"!==u&&(0===u.indexOf("paint.")?He(s[u],l[u],r,o,u.slice(6),Ue.setPaintProperty):e.deepEqual(s[u],l[u])||r.push({command:Ue.setLayerProperty,args:[o,u,l[u]]}));for(u in l)l.hasOwnProperty(u)&&!s.hasOwnProperty(u)&&"layout"!==u&&"paint"!==u&&"filter"!==u&&"metadata"!==u&&"minzoom"!==u&&"maxzoom"!==u&&(0===u.indexOf("paint.")?He(s[u],l[u],r,o,u.slice(6),Ue.setPaintProperty):e.deepEqual(s[u],l[u])||r.push({command:Ue.setLayerProperty,args:[o,u,l[u]]}))}else r.push({command:Ue.removeLayer,args:[o]}),c=m[m.lastIndexOf(o)+1],r.push({command:Ue.addLayer,args:[l,c]})}(o,i.layers,r)}catch(e){console.warn("Unable to compute style diff:",e),r=[{command:Ue.setStyle,args:[i]}]}return r}(this.serialize(),t).filter((function(e){return!(e.command in Ut)}));if(0===r.length)return!1;var n=r.filter((function(e){return!(e.command in Vt)}));if(n.length>0)throw new Error("Unimplemented: "+n.map((function(e){return e.command})).join(", ")+".");return r.forEach((function(e){"setTransition"!==e.command&&i[e.command].apply(i,e.args)})),this.stylesheet=t,!0},i.prototype.addImage=function(t,i){if(this.getImage(t))return this.fire(new e.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(t,i),this._afterImageUpdated(t)},i.prototype.updateImage=function(e,t){this.imageManager.updateImage(e,t)},i.prototype.getImage=function(e){return this.imageManager.getImage(e)},i.prototype.removeImage=function(t){if(!this.getImage(t))return this.fire(new e.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(t),this._afterImageUpdated(t)},i.prototype._afterImageUpdated=function(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new e.Event("data",{dataType:"style"}))},i.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},i.prototype.addSource=function(t,i,r){var n=this;if(void 0===r&&(r={}),this._checkLoaded(),void 0!==this.sourceCaches[t])throw new Error("There is already a source with this ID");if(!i.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(i).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(e.validateStyle.source,"sources."+t,i,null,r))){this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);var a=this.sourceCaches[t]=new Pe(t,i,this.dispatcher);a.style=this,a.setEventedParent(this,(function(){return{isSourceLoaded:n.loaded(),source:a.serialize(),sourceId:t}})),a.onAdd(this.map),this._changed=!0}},i.prototype.removeSource=function(t){if(this._checkLoaded(),void 0===this.sourceCaches[t])throw new Error("There is no source with this ID");for(var i in this._layers)if(this._layers[i].source===t)return this.fire(new e.ErrorEvent(new Error('Source "'+t+'" cannot be removed while layer "'+i+'" is using it.')));var r=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],r.fire(new e.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),r.setEventedParent(null),r.clearTiles(),r.onRemove&&r.onRemove(this.map),this._changed=!0},i.prototype.setGeoJSONSourceData=function(e,t){this._checkLoaded(),this.sourceCaches[e].getSource().setData(t),this._changed=!0},i.prototype.getSource=function(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()},i.prototype.addLayer=function(t,i,r){void 0===r&&(r={}),this._checkLoaded();var n=t.id;if(this.getLayer(n))this.fire(new e.ErrorEvent(new Error('Layer with id "'+n+'" already exists on this map')));else{var a;if("custom"===t.type){if(Nt(this,e.validateCustomStyleLayer(t)))return;a=e.createStyleLayer(t)}else{if("object"==typeof t.source&&(this.addSource(n,t.source),t=e.clone$1(t),t=e.extend(t,{source:n})),this._validate(e.validateStyle.layer,"layers."+n,t,{arrayIndex:-1},r))return;a=e.createStyleLayer(t),this._validateLayer(a),a.setEventedParent(this,{layer:{id:n}}),this._serializedLayers[a.id]=a.serialize()}var o=i?this._order.indexOf(i):this._order.length;if(i&&-1===o)this.fire(new e.ErrorEvent(new Error('Layer with id "'+i+'" does not exist on this map.')));else{if(this._order.splice(o,0,n),this._layerOrderChanged=!0,this._layers[n]=a,this._removedLayers[n]&&a.source&&"custom"!==a.type){var s=this._removedLayers[n];delete this._removedLayers[n],s.type!==a.type?this._updatedSources[a.source]="clear":(this._updatedSources[a.source]="reload",this.sourceCaches[a.source].pause())}this._updateLayer(a),a.onAdd&&a.onAdd(this.map)}}},i.prototype.moveLayer=function(t,i){if(this._checkLoaded(),this._changed=!0,this._layers[t]){if(t!==i){var r=this._order.indexOf(t);this._order.splice(r,1);var n=i?this._order.indexOf(i):this._order.length;i&&-1===n?this.fire(new e.ErrorEvent(new Error('Layer with id "'+i+'" does not exist on this map.'))):(this._order.splice(n,0,t),this._layerOrderChanged=!0)}}else this.fire(new e.ErrorEvent(new Error("The layer '"+t+"' does not exist in the map's style and cannot be moved.")))},i.prototype.removeLayer=function(t){this._checkLoaded();var i=this._layers[t];if(i){i.setEventedParent(null);var r=this._order.indexOf(t);this._order.splice(r,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=i,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],i.onRemove&&i.onRemove(this.map)}else this.fire(new e.ErrorEvent(new Error("The layer '"+t+"' does not exist in the map's style and cannot be removed.")))},i.prototype.getLayer=function(e){return this._layers[e]},i.prototype.hasLayer=function(e){return e in this._layers},i.prototype.setLayerZoomRange=function(t,i,r){this._checkLoaded();var n=this.getLayer(t);n?n.minzoom===i&&n.maxzoom===r||(null!=i&&(n.minzoom=i),null!=r&&(n.maxzoom=r),this._updateLayer(n)):this.fire(new e.ErrorEvent(new Error("The layer '"+t+"' does not exist in the map's style and cannot have zoom extent.")))},i.prototype.setFilter=function(t,i,r){void 0===r&&(r={}),this._checkLoaded();var n=this.getLayer(t);if(n){if(!e.deepEqual(n.filter,i))return null==i?(n.filter=void 0,void this._updateLayer(n)):void(this._validate(e.validateStyle.filter,"layers."+n.id+".filter",i,null,r)||(n.filter=e.clone$1(i),this._updateLayer(n)))}else this.fire(new e.ErrorEvent(new Error("The layer '"+t+"' does not exist in the map's style and cannot be filtered.")))},i.prototype.getFilter=function(t){return e.clone$1(this.getLayer(t).filter)},i.prototype.setLayoutProperty=function(t,i,r,n){void 0===n&&(n={}),this._checkLoaded();var a=this.getLayer(t);a?e.deepEqual(a.getLayoutProperty(i),r)||(a.setLayoutProperty(i,r,n),this._updateLayer(a)):this.fire(new e.ErrorEvent(new Error("The layer '"+t+"' does not exist in the map's style and cannot be styled.")))},i.prototype.getLayoutProperty=function(t,i){var r=this.getLayer(t);if(r)return r.getLayoutProperty(i);this.fire(new e.ErrorEvent(new Error("The layer '"+t+"' does not exist in the map's style.")))},i.prototype.setPaintProperty=function(t,i,r,n){void 0===n&&(n={}),this._checkLoaded();var a=this.getLayer(t);a?e.deepEqual(a.getPaintProperty(i),r)||(a.setPaintProperty(i,r,n)&&this._updateLayer(a),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new e.ErrorEvent(new Error("The layer '"+t+"' does not exist in the map's style and cannot be styled.")))},i.prototype.getPaintProperty=function(e,t){return this.getLayer(e).getPaintProperty(t)},i.prototype.setFeatureState=function(t,i){this._checkLoaded();var r=t.source,n=t.sourceLayer,a=this.sourceCaches[r];if(void 0!==a){var o=a.getSource().type;"geojson"===o&&n?this.fire(new e.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==o||n?(void 0===t.id&&this.fire(new e.ErrorEvent(new Error("The feature id parameter must be provided."))),a.setFeatureState(n,t.id,i)):this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new e.ErrorEvent(new Error("The source '"+r+"' does not exist in the map's style.")))},i.prototype.removeFeatureState=function(t,i){this._checkLoaded();var r=t.source,n=this.sourceCaches[r];if(void 0!==n){var a=n.getSource().type,o="vector"===a?t.sourceLayer:void 0;"vector"!==a||o?i&&"string"!=typeof t.id&&"number"!=typeof t.id?this.fire(new e.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):n.removeFeatureState(o,t.id,i):this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new e.ErrorEvent(new Error("The source '"+r+"' does not exist in the map's style.")))},i.prototype.getFeatureState=function(t){this._checkLoaded();var i=t.source,r=t.sourceLayer,n=this.sourceCaches[i];if(void 0!==n){if("vector"!==n.getSource().type||r)return void 0===t.id&&this.fire(new e.ErrorEvent(new Error("The feature id parameter must be provided."))),n.getFeatureState(r,t.id);this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new e.ErrorEvent(new Error("The source '"+i+"' does not exist in the map's style.")))},i.prototype.getTransition=function(){return e.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},i.prototype.serialize=function(){return e.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:e.mapObject(this.sourceCaches,(function(e){return e.serialize()})),layers:this._serializeLayers(this._order)},(function(e){return void 0!==e}))},i.prototype._updateLayer=function(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&"raster"!==this.sourceCaches[e.source].getSource().type&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._changed=!0},i.prototype._flattenAndSortRenderedFeatures=function(e){for(var t=this,i=function(e){return"fill-extrusion"===t._layers[e].type},r={},n=[],a=this._order.length-1;a>=0;a--){var o=this._order[a];if(i(o)){r[o]=a;for(var s=0,l=e;s<l.length;s+=1){var c=l[s][o];if(c)for(var u=0,h=c;u<h.length;u+=1)n.push(h[u])}}}n.sort((function(e,t){return t.intersectionZ-e.intersectionZ}));for(var p=[],d=this._order.length-1;d>=0;d--){var f=this._order[d];if(i(f))for(var m=n.length-1;m>=0;m--){var g=n[m].feature;if(r[g.layer.id]<d)break;p.push(g),n.pop()}else for(var _=0,y=e;_<y.length;_+=1){var v=y[_][f];if(v)for(var x=0,b=v;x<b.length;x+=1)p.push(b[x].feature)}}return p},i.prototype.queryRenderedFeatures=function(t,i,r){i&&i.filter&&this._validate(e.validateStyle.filter,"queryRenderedFeatures.filter",i.filter,null,i);var n={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new e.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var a=0,o=i.layers;a<o.length;a+=1){var s=o[a],l=this._layers[s];if(!l)return this.fire(new e.ErrorEvent(new Error("The layer '"+s+"' does not exist in the map's style and cannot be queried for features."))),[];n[l.source]=!0}}var c=[];for(var u in i.availableImages=this._availableImages,this.sourceCaches)i.layers&&!n[u]||c.push(F(this.sourceCaches[u],this._layers,this._serializedLayers,t,i,r));return this.placement&&c.push(function(e,t,i,r,n,a,o){for(var s={},l=a.queryRenderedSymbols(r),c=[],u=0,h=Object.keys(l).map(Number);u<h.length;u+=1)c.push(o[h[u]]);c.sort(O);for(var p=function(){var i=f[d],r=i.featureIndex.lookupSymbolFeatures(l[i.bucketInstanceId],t,i.bucketIndex,i.sourceLayerIndex,n.filter,n.layers,n.availableImages,e);for(var a in r){var o=s[a]=s[a]||[],c=r[a];c.sort((function(e,t){var r=i.featureSortOrder;if(r){var n=r.indexOf(e.featureIndex);return r.indexOf(t.featureIndex)-n}return t.featureIndex-e.featureIndex}));for(var u=0,h=c;u<h.length;u+=1)o.push(h[u])}},d=0,f=c;d<f.length;d+=1)p();var m=function(t){s[t].forEach((function(r){var n=r.feature,a=i[e[t].source].getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=a}))};for(var g in s)m(g);return s}(this._layers,this._serializedLayers,this.sourceCaches,t,i,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(c)},i.prototype.querySourceFeatures=function(t,i){i&&i.filter&&this._validate(e.validateStyle.filter,"querySourceFeatures.filter",i.filter,null,i);var r=this.sourceCaches[t];return r?function(e,t){for(var i=e.getRenderableIds().map((function(t){return e.getTileByID(t)})),r=[],n={},a=0;a<i.length;a++){var o=i[a],s=o.tileID.canonical.key;n[s]||(n[s]=!0,o.querySourceFeatures(r,t))}return r}(r,i):[]},i.prototype.addSourceType=function(e,t,r){return i.getSourceType(e)?r(new Error('A source type called "'+e+'" already exists.')):(i.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},r):r(null,null))},i.prototype.getLight=function(){return this.light.getLight()},i.prototype.setLight=function(t,i){void 0===i&&(i={}),this._checkLoaded();var r=this.light.getLight(),n=!1;for(var a in t)if(!e.deepEqual(t[a],r[a])){n=!0;break}if(n){var o={now:e.browser.now(),transition:e.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,i),this.light.updateTransitions(o)}},i.prototype._validate=function(t,i,r,n,a){return void 0===a&&(a={}),(!a||!1!==a.validate)&&Nt(this,t.call(e.validateStyle,e.extend({key:i,style:this.serialize(),value:r,styleSpec:e.styleSpec},n)))},i.prototype._remove=function(){for(var t in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),e.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[t].setEventedParent(null);for(var i in this.sourceCaches)this.sourceCaches[i].clearTiles(),this.sourceCaches[i].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},i.prototype._clearSource=function(e){this.sourceCaches[e].clearTiles()},i.prototype._reloadSource=function(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()},i.prototype._updateSources=function(e){for(var t in this.sourceCaches)this.sourceCaches[t].update(e)},i.prototype._generateCollisionBoxes=function(){for(var e in this.sourceCaches)this._reloadSource(e)},i.prototype._updatePlacement=function(t,i,r,n,a){void 0===a&&(a=!1);for(var o=!1,s=!1,l={},c=0,u=this._order;c<u.length;c+=1){var h=this._layers[u[c]];if("symbol"===h.type){if(!l[h.source]){var p=this.sourceCaches[h.source];l[h.source]=p.getRenderableIds(!0).map((function(e){return p.getTileByID(e)})).sort((function(e,t){return t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1)}))}var d=this.crossTileSymbolIndex.addLayer(h,l[h.source],t.center.lng);o=o||d}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((a=a||this._layerOrderChanged||0===r)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(e.browser.now(),t.zoom))&&(this.pauseablePlacement=new kt(t,this._order,a,i,r,n,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(e.browser.now()),s=!0),o&&this.pauseablePlacement.placement.setStale()),s||o)for(var f=0,m=this._order;f<m.length;f+=1){var g=this._layers[m[f]];"symbol"===g.type&&this.placement.updateLayerOpacities(g,l[g.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(e.browser.now())},i.prototype._releaseSymbolFadeTiles=function(){for(var e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()},i.prototype.getImages=function(e,t,i){this.imageManager.getImages(t.icons,i),this._updateTilesForChangedImages();var r=this.sourceCaches[t.source];r&&r.setDependencies(t.tileID.key,t.type,t.icons)},i.prototype.getGlyphs=function(e,t,i){this.glyphManager.getGlyphs(t.stacks,i)},i.prototype.getResource=function(t,i,r){return e.makeRequest(i,r)},i}(e.Evented);jt.getSourceType=function(e){return D[e]},jt.setSourceType=function(e,t){D[e]=t},jt.registerForPluginStateChange=e.registerForPluginStateChange;var qt=e.createLayout([{name:"a_pos",type:"Int16",components:2}]),Gt=_i("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}"),Ht=_i("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Wt=_i("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Zt=_i("varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),Xt=_i("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Yt=_i("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),Kt=_i("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Jt=_i("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Qt=_i("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),ei=_i("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),ti=_i("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),ii=_i("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),ri=_i("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),ni=_i("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),ai=_i("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),oi=_i("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),si=_i("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),li=_i("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),ci=_i("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),ui=_i("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),hi=_i("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),pi=_i("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),di=_i("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),fi=_i("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}"),mi=_i("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),gi=_i("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}");function _i(e,t){var i=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,r=t.match(/attribute ([\w]+) ([\w]+)/g),n=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),a=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),o=a?a.concat(n):n,s={};return{fragmentSource:e=e.replace(i,(function(e,t,i,r,n){return s[n]=!0,"define"===t?"\n#ifndef HAS_UNIFORM_u_"+n+"\nvarying "+i+" "+r+" "+n+";\n#else\nuniform "+i+" "+r+" u_"+n+";\n#endif\n":"\n#ifdef HAS_UNIFORM_u_"+n+"\n    "+i+" "+r+" "+n+" = u_"+n+";\n#endif\n"})),vertexSource:t=t.replace(i,(function(e,t,i,r,n){var a="float"===r?"vec2":"vec4",o=n.match(/color/)?"color":a;return s[n]?"define"===t?"\n#ifndef HAS_UNIFORM_u_"+n+"\nuniform lowp float u_"+n+"_t;\nattribute "+i+" "+a+" a_"+n+";\nvarying "+i+" "+r+" "+n+";\n#else\nuniform "+i+" "+r+" u_"+n+";\n#endif\n":"vec4"===o?"\n#ifndef HAS_UNIFORM_u_"+n+"\n    "+n+" = a_"+n+";\n#else\n    "+i+" "+r+" "+n+" = u_"+n+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+n+"\n    "+n+" = unpack_mix_"+o+"(a_"+n+", u_"+n+"_t);\n#else\n    "+i+" "+r+" "+n+" = u_"+n+";\n#endif\n":"define"===t?"\n#ifndef HAS_UNIFORM_u_"+n+"\nuniform lowp float u_"+n+"_t;\nattribute "+i+" "+a+" a_"+n+";\n#else\nuniform "+i+" "+r+" u_"+n+";\n#endif\n":"vec4"===o?"\n#ifndef HAS_UNIFORM_u_"+n+"\n    "+i+" "+r+" "+n+" = a_"+n+";\n#else\n    "+i+" "+r+" "+n+" = u_"+n+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+n+"\n    "+i+" "+r+" "+n+" = unpack_mix_"+o+"(a_"+n+", u_"+n+"_t);\n#else\n    "+i+" "+r+" "+n+" = u_"+n+";\n#endif\n"})),staticAttributes:r,staticUniforms:o}}var yi=Object.freeze({__proto__:null,prelude:Gt,background:Ht,backgroundPattern:Wt,circle:Zt,clippingMask:Xt,heatmap:Yt,heatmapTexture:Kt,collisionBox:Jt,collisionCircle:Qt,debug:ei,fill:ti,fillOutline:ii,fillOutlinePattern:ri,fillPattern:ni,fillExtrusion:ai,fillExtrusionPattern:oi,hillshadePrepare:si,hillshade:li,line:ci,lineGradient:ui,linePattern:hi,lineSDF:pi,raster:di,symbolIcon:fi,symbolSDF:mi,symbolTextAndIcon:gi}),vi=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function xi(e){for(var t=[],i=0;i<e.length;i++)if(null!==e[i]){var r=e[i].split(" ");t.push(r.pop())}return t}vi.prototype.bind=function(e,t,i,r,n,a,o,s){this.context=e;for(var l=this.boundPaintVertexBuffers.length!==r.length,c=0;!l&&c<r.length;c++)this.boundPaintVertexBuffers[c]!==r[c]&&(l=!0);e.extVertexArrayObject&&this.vao&&this.boundProgram===t&&this.boundLayoutVertexBuffer===i&&!l&&this.boundIndexBuffer===n&&this.boundVertexOffset===a&&this.boundDynamicVertexBuffer===o&&this.boundDynamicVertexBuffer2===s?(e.bindVertexArrayOES.set(this.vao),o&&o.bind(),n&&n.dynamicDraw&&n.bind(),s&&s.bind()):this.freshBind(t,i,r,n,a,o,s)},vi.prototype.freshBind=function(e,t,i,r,n,a,o){var s,l=e.numAttributes,c=this.context,u=c.gl;if(c.extVertexArrayObject)this.vao&&this.destroy(),this.vao=c.extVertexArrayObject.createVertexArrayOES(),c.bindVertexArrayOES.set(this.vao),s=0,this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=r,this.boundVertexOffset=n,this.boundDynamicVertexBuffer=a,this.boundDynamicVertexBuffer2=o;else{s=c.currentNumAttributes||0;for(var h=l;h<s;h++)u.disableVertexAttribArray(h)}t.enableAttributes(u,e);for(var p=0,d=i;p<d.length;p+=1)d[p].enableAttributes(u,e);a&&a.enableAttributes(u,e),o&&o.enableAttributes(u,e),t.bind(),t.setVertexAttribPointers(u,e,n);for(var f=0,m=i;f<m.length;f+=1){var g=m[f];g.bind(),g.setVertexAttribPointers(u,e,n)}a&&(a.bind(),a.setVertexAttribPointers(u,e,n)),r&&r.bind(),o&&(o.bind(),o.setVertexAttribPointers(u,e,n)),c.currentNumAttributes=l},vi.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var bi=function(e,t,i,r,n,a){var o=e.gl;this.program=o.createProgram();for(var s=xi(i.staticAttributes),l=r?r.getBinderAttributes():[],c=s.concat(l),u=i.staticUniforms?xi(i.staticUniforms):[],h=r?r.getBinderUniforms():[],p=[],d=0,f=u.concat(h);d<f.length;d+=1){var m=f[d];p.indexOf(m)<0&&p.push(m)}var g=r?r.defines():[];a&&g.push("#define OVERDRAW_INSPECTOR;");var _=g.concat(Gt.fragmentSource,i.fragmentSource).join("\n"),y=g.concat(Gt.vertexSource,i.vertexSource).join("\n"),v=o.createShader(o.FRAGMENT_SHADER);if(o.isContextLost())this.failedToCreate=!0;else{o.shaderSource(v,_),o.compileShader(v),o.attachShader(this.program,v);var x=o.createShader(o.VERTEX_SHADER);if(o.isContextLost())this.failedToCreate=!0;else{o.shaderSource(x,y),o.compileShader(x),o.attachShader(this.program,x),this.attributes={};var b={};this.numAttributes=c.length;for(var w=0;w<this.numAttributes;w++)c[w]&&(o.bindAttribLocation(this.program,w,c[w]),this.attributes[c[w]]=w);o.linkProgram(this.program),o.deleteShader(x),o.deleteShader(v);for(var S=0;S<p.length;S++){var M=p[S];if(M&&!b[M]){var T=o.getUniformLocation(this.program,M);T&&(b[M]=T)}}this.fixedUniforms=n(e,b),this.binderUniforms=r?r.getUniforms(e,b):[]}}};function wi(e,t,i){var r=1/pt(i,1,t.transform.tileZoom),n=Math.pow(2,i.tileID.overscaledZ),a=i.tileSize*Math.pow(2,t.transform.tileZoom)/n,o=a*(i.tileID.canonical.x+i.tileID.wrap*n),s=a*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[r,e.fromScale,e.toScale],u_fade:e.t,u_pixel_coord_upper:[o>>16,s>>16],u_pixel_coord_lower:[65535&o,65535&s]}}bi.prototype.draw=function(e,t,i,r,n,a,o,s,l,c,u,h,p,d,f,m){var g,_=e.gl;if(!this.failedToCreate){for(var y in e.program.set(this.program),e.setDepthMode(i),e.setStencilMode(r),e.setColorMode(n),e.setCullFace(a),this.fixedUniforms)this.fixedUniforms[y].set(o[y]);d&&d.setUniforms(e,this.binderUniforms,h,{zoom:p});for(var v=(g={},g[_.LINES]=2,g[_.TRIANGLES]=3,g[_.LINE_STRIP]=1,g)[t],x=0,b=u.get();x<b.length;x+=1){var w=b[x],S=w.vaos||(w.vaos={});(S[s]||(S[s]=new vi)).bind(e,this,l,d?d.getPaintVertexBuffers():[],c,w.vertexOffset,f,m),_.drawElements(t,w.primitiveLength*v,_.UNSIGNED_SHORT,w.primitiveOffset*v*2)}}};var Si=function(t,i,r,n){var a=i.style.light,o=a.properties.get("position"),s=[o.x,o.y,o.z],l=e.create$1();"viewport"===a.properties.get("anchor")&&e.fromRotation(l,-i.transform.angle),e.transformMat3(s,s,l);var c=a.properties.get("color");return{u_matrix:t,u_lightpos:s,u_lightintensity:a.properties.get("intensity"),u_lightcolor:[c.r,c.g,c.b],u_vertical_gradient:+r,u_opacity:n}},Mi=function(t,i,r,n,a,o,s){return e.extend(Si(t,i,r,n),wi(o,i,s),{u_height_factor:-Math.pow(2,a.overscaledZ)/s.tileSize/8})},Ti=function(e){return{u_matrix:e}},Ei=function(t,i,r,n){return e.extend(Ti(t),wi(r,i,n))},Ci=function(e,t){return{u_matrix:e,u_world:t}},Ai=function(t,i,r,n,a){return e.extend(Ei(t,i,r,n),{u_world:a})},Ii=function(t,i,r,n){var a,o,s=t.transform;if("map"===n.paint.get("circle-pitch-alignment")){var l=pt(r,1,s.zoom);a=!0,o=[l,l]}else a=!1,o=s.pixelsToGLUnits;return{u_camera_to_center_distance:s.cameraToCenterDistance,u_scale_with_map:+("map"===n.paint.get("circle-pitch-scale")),u_matrix:t.translatePosMatrix(i.posMatrix,r,n.paint.get("circle-translate"),n.paint.get("circle-translate-anchor")),u_pitch_with_map:+a,u_device_pixel_ratio:e.browser.devicePixelRatio,u_extrude_scale:o}},Pi=function(e,t,i){var r=pt(i,1,t.zoom),n=Math.pow(2,t.zoom-i.tileID.overscaledZ),a=i.tileID.overscaleFactor();return{u_matrix:e,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:r,u_extrude_scale:[t.pixelsToGLUnits[0]/(r*n),t.pixelsToGLUnits[1]/(r*n)],u_overscale_factor:a}},zi=function(e,t,i){return{u_matrix:e,u_inv_matrix:t,u_camera_to_center_distance:i.cameraToCenterDistance,u_viewport_size:[i.width,i.height]}},Ri=function(e,t,i){return void 0===i&&(i=1),{u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:i}},ki=function(e){return{u_matrix:e}},Li=function(e,t,i,r){return{u_matrix:e,u_extrude_scale:pt(t,1,i),u_intensity:r}},Di=function(t,i,r){var n=t.transform;return{u_matrix:Vi(t,i,r),u_ratio:1/pt(i,1,n.zoom),u_device_pixel_ratio:e.browser.devicePixelRatio,u_units_to_pixels:[1/n.pixelsToGLUnits[0],1/n.pixelsToGLUnits[1]]}},Bi=function(t,i,r,n){return e.extend(Di(t,i,r),{u_image:0,u_image_height:n})},Fi=function(t,i,r,n){var a=t.transform,o=Ni(i,a);return{u_matrix:Vi(t,i,r),u_texsize:i.imageAtlasTexture.size,u_ratio:1/pt(i,1,a.zoom),u_device_pixel_ratio:e.browser.devicePixelRatio,u_image:0,u_scale:[o,n.fromScale,n.toScale],u_fade:n.t,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]]}},Oi=function(t,i,r,n,a){var o=t.lineAtlas,s=Ni(i,t.transform),l="round"===r.layout.get("line-cap"),c=o.getDash(n.from,l),u=o.getDash(n.to,l),h=c.width*a.fromScale,p=u.width*a.toScale;return e.extend(Di(t,i,r),{u_patternscale_a:[s/h,-c.height/2],u_patternscale_b:[s/p,-u.height/2],u_sdfgamma:o.width/(256*Math.min(h,p)*e.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:c.y,u_tex_y_b:u.y,u_mix:a.t})};function Ni(e,t){return 1/pt(e,1,t.tileZoom)}function Vi(e,t,i){return e.translatePosMatrix(t.tileID.posMatrix,t,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}var Ui=function(e,t,i,r,n){return{u_matrix:e,u_tl_parent:t,u_scale_parent:i,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*n.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:n.paint.get("raster-brightness-min"),u_brightness_high:n.paint.get("raster-brightness-max"),u_saturation_factor:(o=n.paint.get("raster-saturation"),o>0?1-1/(1.001-o):-o),u_contrast_factor:(a=n.paint.get("raster-contrast"),a>0?1/(1-a):1+a),u_spin_weights:$i(n.paint.get("raster-hue-rotate"))};var a,o};function $i(e){e*=Math.PI/180;var t=Math.sin(e),i=Math.cos(e);return[(2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3]}var ji,qi=function(e,t,i,r,n,a,o,s,l,c){var u=n.transform;return{u_is_size_zoom_constant:+("constant"===e||"source"===e),u_is_size_feature_constant:+("constant"===e||"camera"===e),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:u.cameraToCenterDistance,u_pitch:u.pitch/360*2*Math.PI,u_rotate_symbol:+i,u_aspect_ratio:u.width/u.height,u_fade_change:n.options.fadeDuration?n.symbolFadeChange:1,u_matrix:a,u_label_plane_matrix:o,u_coord_matrix:s,u_is_text:+l,u_pitch_with_map:+r,u_texsize:c,u_texture:0}},Gi=function(t,i,r,n,a,o,s,l,c,u,h){var p=a.transform;return e.extend(qi(t,i,r,n,a,o,s,l,c,u),{u_gamma_scale:n?Math.cos(p._pitch)*p.cameraToCenterDistance:1,u_device_pixel_ratio:e.browser.devicePixelRatio,u_is_halo:+h})},Hi=function(t,i,r,n,a,o,s,l,c,u){return e.extend(Gi(t,i,r,n,a,o,s,l,!0,c,!0),{u_texsize_icon:u,u_texture_icon:1})},Wi=function(e,t,i){return{u_matrix:e,u_opacity:t,u_color:i}},Zi=function(t,i,r,n,a,o){return e.extend(function(e,t,i,r){var n=i.imageManager.getPattern(e.from.toString()),a=i.imageManager.getPattern(e.to.toString()),o=i.imageManager.getPixelSize(),s=o.width,l=o.height,c=Math.pow(2,r.tileID.overscaledZ),u=r.tileSize*Math.pow(2,i.transform.tileZoom)/c,h=u*(r.tileID.canonical.x+r.tileID.wrap*c),p=u*r.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:n.tl,u_pattern_br_a:n.br,u_pattern_tl_b:a.tl,u_pattern_br_b:a.br,u_texsize:[s,l],u_mix:t.t,u_pattern_size_a:n.displaySize,u_pattern_size_b:a.displaySize,u_scale_a:t.fromScale,u_scale_b:t.toScale,u_tile_units_to_pixels:1/pt(r,1,i.transform.tileZoom),u_pixel_coord_upper:[h>>16,p>>16],u_pixel_coord_lower:[65535&h,65535&p]}}(n,o,r,a),{u_matrix:t,u_opacity:i})},Xi={fillExtrusion:function(t,i){return{u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_lightpos:new e.Uniform3f(t,i.u_lightpos),u_lightintensity:new e.Uniform1f(t,i.u_lightintensity),u_lightcolor:new e.Uniform3f(t,i.u_lightcolor),u_vertical_gradient:new e.Uniform1f(t,i.u_vertical_gradient),u_opacity:new e.Uniform1f(t,i.u_opacity)}},fillExtrusionPattern:function(t,i){return{u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_lightpos:new e.Uniform3f(t,i.u_lightpos),u_lightintensity:new e.Uniform1f(t,i.u_lightintensity),u_lightcolor:new e.Uniform3f(t,i.u_lightcolor),u_vertical_gradient:new e.Uniform1f(t,i.u_vertical_gradient),u_height_factor:new e.Uniform1f(t,i.u_height_factor),u_image:new e.Uniform1i(t,i.u_image),u_texsize:new e.Uniform2f(t,i.u_texsize),u_pixel_coord_upper:new e.Uniform2f(t,i.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,i.u_pixel_coord_lower),u_scale:new e.Uniform3f(t,i.u_scale),u_fade:new e.Uniform1f(t,i.u_fade),u_opacity:new e.Uniform1f(t,i.u_opacity)}},fill:function(t,i){return{u_matrix:new e.UniformMatrix4f(t,i.u_matrix)}},fillPattern:function(t,i){return{u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_image:new e.Uniform1i(t,i.u_image),u_texsize:new e.Uniform2f(t,i.u_texsize),u_pixel_coord_upper:new e.Uniform2f(t,i.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,i.u_pixel_coord_lower),u_scale:new e.Uniform3f(t,i.u_scale),u_fade:new e.Uniform1f(t,i.u_fade)}},fillOutline:function(t,i){return{u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_world:new e.Uniform2f(t,i.u_world)}},fillOutlinePattern:function(t,i){return{u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_world:new e.Uniform2f(t,i.u_world),u_image:new e.Uniform1i(t,i.u_image),u_texsize:new e.Uniform2f(t,i.u_texsize),u_pixel_coord_upper:new e.Uniform2f(t,i.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,i.u_pixel_coord_lower),u_scale:new e.Uniform3f(t,i.u_scale),u_fade:new e.Uniform1f(t,i.u_fade)}},circle:function(t,i){return{u_camera_to_center_distance:new e.Uniform1f(t,i.u_camera_to_center_distance),u_scale_with_map:new e.Uniform1i(t,i.u_scale_with_map),u_pitch_with_map:new e.Uniform1i(t,i.u_pitch_with_map),u_extrude_scale:new e.Uniform2f(t,i.u_extrude_scale),u_device_pixel_ratio:new e.Uniform1f(t,i.u_device_pixel_ratio),u_matrix:new e.UniformMatrix4f(t,i.u_matrix)}},collisionBox:function(t,i){return{u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_camera_to_center_distance:new e.Uniform1f(t,i.u_camera_to_center_distance),u_pixels_to_tile_units:new e.Uniform1f(t,i.u_pixels_to_tile_units),u_extrude_scale:new e.Uniform2f(t,i.u_extrude_scale),u_overscale_factor:new e.Uniform1f(t,i.u_overscale_factor)}},collisionCircle:function(t,i){return{u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_inv_matrix:new e.UniformMatrix4f(t,i.u_inv_matrix),u_camera_to_center_distance:new e.Uniform1f(t,i.u_camera_to_center_distance),u_viewport_size:new e.Uniform2f(t,i.u_viewport_size)}},debug:function(t,i){return{u_color:new e.UniformColor(t,i.u_color),u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_overlay:new e.Uniform1i(t,i.u_overlay),u_overlay_scale:new e.Uniform1f(t,i.u_overlay_scale)}},clippingMask:function(t,i){return{u_matrix:new e.UniformMatrix4f(t,i.u_matrix)}},heatmap:function(t,i){return{u_extrude_scale:new e.Uniform1f(t,i.u_extrude_scale),u_intensity:new e.Uniform1f(t,i.u_intensity),u_matrix:new e.UniformMatrix4f(t,i.u_matrix)}},heatmapTexture:function(t,i){return{u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_world:new e.Uniform2f(t,i.u_world),u_image:new e.Uniform1i(t,i.u_image),u_color_ramp:new e.Uniform1i(t,i.u_color_ramp),u_opacity:new e.Uniform1f(t,i.u_opacity)}},hillshade:function(t,i){return{u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_image:new e.Uniform1i(t,i.u_image),u_latrange:new e.Uniform2f(t,i.u_latrange),u_light:new e.Uniform2f(t,i.u_light),u_shadow:new e.UniformColor(t,i.u_shadow),u_highlight:new e.UniformColor(t,i.u_highlight),u_accent:new e.UniformColor(t,i.u_accent)}},hillshadePrepare:function(t,i){return{u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_image:new e.Uniform1i(t,i.u_image),u_dimension:new e.Uniform2f(t,i.u_dimension),u_zoom:new e.Uniform1f(t,i.u_zoom),u_unpack:new e.Uniform4f(t,i.u_unpack)}},line:function(t,i){return{u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_ratio:new e.Uniform1f(t,i.u_ratio),u_device_pixel_ratio:new e.Uniform1f(t,i.u_device_pixel_ratio),u_units_to_pixels:new e.Uniform2f(t,i.u_units_to_pixels)}},lineGradient:function(t,i){return{u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_ratio:new e.Uniform1f(t,i.u_ratio),u_device_pixel_ratio:new e.Uniform1f(t,i.u_device_pixel_ratio),u_units_to_pixels:new e.Uniform2f(t,i.u_units_to_pixels),u_image:new e.Uniform1i(t,i.u_image),u_image_height:new e.Uniform1f(t,i.u_image_height)}},linePattern:function(t,i){return{u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_texsize:new e.Uniform2f(t,i.u_texsize),u_ratio:new e.Uniform1f(t,i.u_ratio),u_device_pixel_ratio:new e.Uniform1f(t,i.u_device_pixel_ratio),u_image:new e.Uniform1i(t,i.u_image),u_units_to_pixels:new e.Uniform2f(t,i.u_units_to_pixels),u_scale:new e.Uniform3f(t,i.u_scale),u_fade:new e.Uniform1f(t,i.u_fade)}},lineSDF:function(t,i){return{u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_ratio:new e.Uniform1f(t,i.u_ratio),u_device_pixel_ratio:new e.Uniform1f(t,i.u_device_pixel_ratio),u_units_to_pixels:new e.Uniform2f(t,i.u_units_to_pixels),u_patternscale_a:new e.Uniform2f(t,i.u_patternscale_a),u_patternscale_b:new e.Uniform2f(t,i.u_patternscale_b),u_sdfgamma:new e.Uniform1f(t,i.u_sdfgamma),u_image:new e.Uniform1i(t,i.u_image),u_tex_y_a:new e.Uniform1f(t,i.u_tex_y_a),u_tex_y_b:new e.Uniform1f(t,i.u_tex_y_b),u_mix:new e.Uniform1f(t,i.u_mix)}},raster:function(t,i){return{u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_tl_parent:new e.Uniform2f(t,i.u_tl_parent),u_scale_parent:new e.Uniform1f(t,i.u_scale_parent),u_buffer_scale:new e.Uniform1f(t,i.u_buffer_scale),u_fade_t:new e.Uniform1f(t,i.u_fade_t),u_opacity:new e.Uniform1f(t,i.u_opacity),u_image0:new e.Uniform1i(t,i.u_image0),u_image1:new e.Uniform1i(t,i.u_image1),u_brightness_low:new e.Uniform1f(t,i.u_brightness_low),u_brightness_high:new e.Uniform1f(t,i.u_brightness_high),u_saturation_factor:new e.Uniform1f(t,i.u_saturation_factor),u_contrast_factor:new e.Uniform1f(t,i.u_contrast_factor),u_spin_weights:new e.Uniform3f(t,i.u_spin_weights)}},symbolIcon:function(t,i){return{u_is_size_zoom_constant:new e.Uniform1i(t,i.u_is_size_zoom_constant),u_is_size_feature_constant:new e.Uniform1i(t,i.u_is_size_feature_constant),u_size_t:new e.Uniform1f(t,i.u_size_t),u_size:new e.Uniform1f(t,i.u_size),u_camera_to_center_distance:new e.Uniform1f(t,i.u_camera_to_center_distance),u_pitch:new e.Uniform1f(t,i.u_pitch),u_rotate_symbol:new e.Uniform1i(t,i.u_rotate_symbol),u_aspect_ratio:new e.Uniform1f(t,i.u_aspect_ratio),u_fade_change:new e.Uniform1f(t,i.u_fade_change),u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_label_plane_matrix:new e.UniformMatrix4f(t,i.u_label_plane_matrix),u_coord_matrix:new e.UniformMatrix4f(t,i.u_coord_matrix),u_is_text:new e.Uniform1i(t,i.u_is_text),u_pitch_with_map:new e.Uniform1i(t,i.u_pitch_with_map),u_texsize:new e.Uniform2f(t,i.u_texsize),u_texture:new e.Uniform1i(t,i.u_texture)}},symbolSDF:function(t,i){return{u_is_size_zoom_constant:new e.Uniform1i(t,i.u_is_size_zoom_constant),u_is_size_feature_constant:new e.Uniform1i(t,i.u_is_size_feature_constant),u_size_t:new e.Uniform1f(t,i.u_size_t),u_size:new e.Uniform1f(t,i.u_size),u_camera_to_center_distance:new e.Uniform1f(t,i.u_camera_to_center_distance),u_pitch:new e.Uniform1f(t,i.u_pitch),u_rotate_symbol:new e.Uniform1i(t,i.u_rotate_symbol),u_aspect_ratio:new e.Uniform1f(t,i.u_aspect_ratio),u_fade_change:new e.Uniform1f(t,i.u_fade_change),u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_label_plane_matrix:new e.UniformMatrix4f(t,i.u_label_plane_matrix),u_coord_matrix:new e.UniformMatrix4f(t,i.u_coord_matrix),u_is_text:new e.Uniform1i(t,i.u_is_text),u_pitch_with_map:new e.Uniform1i(t,i.u_pitch_with_map),u_texsize:new e.Uniform2f(t,i.u_texsize),u_texture:new e.Uniform1i(t,i.u_texture),u_gamma_scale:new e.Uniform1f(t,i.u_gamma_scale),u_device_pixel_ratio:new e.Uniform1f(t,i.u_device_pixel_ratio),u_is_halo:new e.Uniform1i(t,i.u_is_halo)}},symbolTextAndIcon:function(t,i){return{u_is_size_zoom_constant:new e.Uniform1i(t,i.u_is_size_zoom_constant),u_is_size_feature_constant:new e.Uniform1i(t,i.u_is_size_feature_constant),u_size_t:new e.Uniform1f(t,i.u_size_t),u_size:new e.Uniform1f(t,i.u_size),u_camera_to_center_distance:new e.Uniform1f(t,i.u_camera_to_center_distance),u_pitch:new e.Uniform1f(t,i.u_pitch),u_rotate_symbol:new e.Uniform1i(t,i.u_rotate_symbol),u_aspect_ratio:new e.Uniform1f(t,i.u_aspect_ratio),u_fade_change:new e.Uniform1f(t,i.u_fade_change),u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_label_plane_matrix:new e.UniformMatrix4f(t,i.u_label_plane_matrix),u_coord_matrix:new e.UniformMatrix4f(t,i.u_coord_matrix),u_is_text:new e.Uniform1i(t,i.u_is_text),u_pitch_with_map:new e.Uniform1i(t,i.u_pitch_with_map),u_texsize:new e.Uniform2f(t,i.u_texsize),u_texsize_icon:new e.Uniform2f(t,i.u_texsize_icon),u_texture:new e.Uniform1i(t,i.u_texture),u_texture_icon:new e.Uniform1i(t,i.u_texture_icon),u_gamma_scale:new e.Uniform1f(t,i.u_gamma_scale),u_device_pixel_ratio:new e.Uniform1f(t,i.u_device_pixel_ratio),u_is_halo:new e.Uniform1i(t,i.u_is_halo)}},background:function(t,i){return{u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_opacity:new e.Uniform1f(t,i.u_opacity),u_color:new e.UniformColor(t,i.u_color)}},backgroundPattern:function(t,i){return{u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_opacity:new e.Uniform1f(t,i.u_opacity),u_image:new e.Uniform1i(t,i.u_image),u_pattern_tl_a:new e.Uniform2f(t,i.u_pattern_tl_a),u_pattern_br_a:new e.Uniform2f(t,i.u_pattern_br_a),u_pattern_tl_b:new e.Uniform2f(t,i.u_pattern_tl_b),u_pattern_br_b:new e.Uniform2f(t,i.u_pattern_br_b),u_texsize:new e.Uniform2f(t,i.u_texsize),u_mix:new e.Uniform1f(t,i.u_mix),u_pattern_size_a:new e.Uniform2f(t,i.u_pattern_size_a),u_pattern_size_b:new e.Uniform2f(t,i.u_pattern_size_b),u_scale_a:new e.Uniform1f(t,i.u_scale_a),u_scale_b:new e.Uniform1f(t,i.u_scale_b),u_pixel_coord_upper:new e.Uniform2f(t,i.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,i.u_pixel_coord_lower),u_tile_units_to_pixels:new e.Uniform1f(t,i.u_tile_units_to_pixels)}}};function Yi(t,i,r,n,a,o,s){for(var l=t.context,c=l.gl,u=t.useProgram("collisionBox"),h=[],p=0,d=0,f=0;f<n.length;f++){var m=n[f],g=i.getTile(m),_=g.getBucket(r);if(_){var y=m.posMatrix;0===a[0]&&0===a[1]||(y=t.translatePosMatrix(m.posMatrix,g,a,o));var v=s?_.textCollisionBox:_.iconCollisionBox,x=_.collisionCircleArray;if(x.length>0){var b=e.create(),w=y;e.mul(b,_.placementInvProjMatrix,t.transform.glCoordMatrix),e.mul(b,b,_.placementViewportMatrix),h.push({circleArray:x,circleOffset:d,transform:w,invTransform:b}),d=p+=x.length/4}v&&u.draw(l,c.LINES,Te.disabled,Ee.disabled,t.colorModeForRenderPass(),Ae.disabled,Pi(y,t.transform,g),r.id,v.layoutVertexBuffer,v.indexBuffer,v.segments,null,t.transform.zoom,null,null,v.collisionVertexBuffer)}}if(s&&h.length){var S=t.useProgram("collisionCircle"),M=new e.StructArrayLayout2f1f2i16;M.resize(4*p),M._trim();for(var T=0,E=0,C=h;E<C.length;E+=1)for(var A=C[E],I=0;I<A.circleArray.length/4;I++){var P=4*I,z=A.circleArray[P+0],R=A.circleArray[P+1],k=A.circleArray[P+2],L=A.circleArray[P+3];M.emplace(T++,z,R,k,L,0),M.emplace(T++,z,R,k,L,1),M.emplace(T++,z,R,k,L,2),M.emplace(T++,z,R,k,L,3)}(!ji||ji.length<2*p)&&(ji=function(t){var i=2*t,r=new e.StructArrayLayout3ui6;r.resize(i),r._trim();for(var n=0;n<i;n++){var a=6*n;r.uint16[a+0]=4*n+0,r.uint16[a+1]=4*n+1,r.uint16[a+2]=4*n+2,r.uint16[a+3]=4*n+2,r.uint16[a+4]=4*n+3,r.uint16[a+5]=4*n+0}return r}(p));for(var D=l.createIndexBuffer(ji,!0),B=l.createVertexBuffer(M,e.collisionCircleLayout.members,!0),F=0,O=h;F<O.length;F+=1){var N=O[F],V=zi(N.transform,N.invTransform,t.transform);S.draw(l,c.TRIANGLES,Te.disabled,Ee.disabled,t.colorModeForRenderPass(),Ae.disabled,V,r.id,B,D,e.SegmentVector.simpleSegment(0,2*N.circleOffset,N.circleArray.length,N.circleArray.length/2),null,t.transform.zoom,null,null,null)}B.destroy(),D.destroy()}}var Ki=e.identity(new Float32Array(16));function Ji(t,i,r,n,a,o){var s=e.getAnchorAlignment(t),l=-(s.horizontalAlign-.5)*i,c=-(s.verticalAlign-.5)*r,u=e.evaluateVariableOffset(t,n);return new e.Point((l/a+u[0])*o,(c/a+u[1])*o)}function Qi(t,i,r,n,a,o,s,l,c,u,h){var p=t.text.placedSymbolArray,d=t.text.dynamicLayoutVertexArray,f=t.icon.dynamicLayoutVertexArray,m={};d.clear();for(var g=0;g<p.length;g++){var _=p.get(g),y=_.hidden||!_.crossTileID||t.allowVerticalPlacement&&!_.placedOrientation?null:n[_.crossTileID];if(y){var v=new e.Point(_.anchorX,_.anchorY),x=Qe(v,r?l:s),b=et(o.cameraToCenterDistance,x.signedDistanceFromCamera),w=a.evaluateSizeForFeature(t.textSizeData,u,_)*b/e.ONE_EM;r&&(w*=t.tilePixelRatio/c);for(var S=Ji(y.anchor,y.width,y.height,y.textOffset,y.textBoxScale,w),M=r?Qe(v.add(S),s).point:x.point.add(i?S.rotate(-o.angle):S),T=t.allowVerticalPlacement&&_.placedOrientation===e.WritingMode.vertical?Math.PI/2:0,E=0;E<_.numGlyphs;E++)e.addDynamicAttributes(d,M,T);h&&_.associatedIconIndex>=0&&(m[_.associatedIconIndex]={shiftedAnchor:M,angle:T})}else ct(_.numGlyphs,d)}if(h){f.clear();for(var C=t.icon.placedSymbolArray,A=0;A<C.length;A++){var I=C.get(A);if(I.hidden)ct(I.numGlyphs,f);else{var P=m[A];if(P)for(var z=0;z<I.numGlyphs;z++)e.addDynamicAttributes(f,P.shiftedAnchor,P.angle);else ct(I.numGlyphs,f)}}t.icon.dynamicLayoutVertexBuffer.updateData(f)}t.text.dynamicLayoutVertexBuffer.updateData(d)}function er(e,t,i){return i.iconsInText&&t?"symbolTextAndIcon":e?"symbolSDF":"symbolIcon"}function tr(t,i,r,n,a,o,s,l,c,u,h,p){for(var d=t.context,f=d.gl,m=t.transform,g="map"===l,_="map"===c,y=g&&"point"!==r.layout.get("symbol-placement"),v=g&&!_&&!y,x=void 0!==r.layout.get("symbol-sort-key").constantOr(1),b=!1,w=t.depthModeForSublayer(0,Te.ReadOnly),S=r.layout.get("text-variable-anchor"),M=[],T=0,E=n;T<E.length;T+=1){var C=E[T],A=i.getTile(C),I=A.getBucket(r);if(I){var P=a?I.text:I.icon;if(P&&P.segments.get().length){var z=P.programConfigurations.get(r.id),R=a||I.sdfIcons,k=a?I.textSizeData:I.iconSizeData,L=_||0!==m.pitch,D=t.useProgram(er(R,a,I),z),B=e.evaluateSizeForZoom(k,m.zoom),F=void 0,O=[0,0],N=void 0,V=void 0,U=null,$=void 0;if(a)N=A.glyphAtlasTexture,V=f.LINEAR,F=A.glyphAtlasTexture.size,I.iconsInText&&(O=A.imageAtlasTexture.size,U=A.imageAtlasTexture,$=L||t.options.rotating||t.options.zooming||"composite"===k.kind||"camera"===k.kind?f.LINEAR:f.NEAREST);else{var j=1!==r.layout.get("icon-size").constantOr(0)||I.iconsNeedLinear;N=A.imageAtlasTexture,V=R||t.options.rotating||t.options.zooming||j||L?f.LINEAR:f.NEAREST,F=A.imageAtlasTexture.size}var q=pt(A,1,t.transform.zoom),G=Ke(C.posMatrix,_,g,t.transform,q),H=Je(C.posMatrix,_,g,t.transform,q),W=S&&I.hasTextData(),Z="none"!==r.layout.get("icon-text-fit")&&W&&I.hasIconData();y&&it(I,C.posMatrix,t,a,G,H,_,u);var X=t.translatePosMatrix(C.posMatrix,A,o,s),Y=y||a&&S||Z?Ki:G,K=t.translatePosMatrix(H,A,o,s,!0),J=R&&0!==r.paint.get(a?"text-halo-width":"icon-halo-width").constantOr(1),Q={program:D,buffers:P,uniformValues:R?I.iconsInText?Hi(k.kind,B,v,_,t,X,Y,K,F,O):Gi(k.kind,B,v,_,t,X,Y,K,a,F,!0):qi(k.kind,B,v,_,t,X,Y,K,a,F),atlasTexture:N,atlasTextureIcon:U,atlasInterpolation:V,atlasInterpolationIcon:$,isSDF:R,hasHalo:J};if(x&&I.canOverlap){b=!0;for(var ee=0,te=P.segments.get();ee<te.length;ee+=1){var ie=te[ee];M.push({segments:new e.SegmentVector([ie]),sortKey:ie.sortKey,state:Q})}}else M.push({segments:P.segments,sortKey:0,state:Q})}}}b&&M.sort((function(e,t){return e.sortKey-t.sortKey}));for(var re=0,ne=M;re<ne.length;re+=1){var ae=ne[re],oe=ae.state;if(d.activeTexture.set(f.TEXTURE0),oe.atlasTexture.bind(oe.atlasInterpolation,f.CLAMP_TO_EDGE),oe.atlasTextureIcon&&(d.activeTexture.set(f.TEXTURE1),oe.atlasTextureIcon&&oe.atlasTextureIcon.bind(oe.atlasInterpolationIcon,f.CLAMP_TO_EDGE)),oe.isSDF){var se=oe.uniformValues;oe.hasHalo&&(se.u_is_halo=1,ir(oe.buffers,ae.segments,r,t,oe.program,w,h,p,se)),se.u_is_halo=0}ir(oe.buffers,ae.segments,r,t,oe.program,w,h,p,oe.uniformValues)}}function ir(e,t,i,r,n,a,o,s,l){var c=r.context;n.draw(c,c.gl.TRIANGLES,a,o,s,Ae.disabled,l,i.id,e.layoutVertexBuffer,e.indexBuffer,t,i.paint,r.transform.zoom,e.programConfigurations.get(i.id),e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer)}function rr(e,t,i,r,n,a,o){var s,l,c,u,h,p=e.context.gl,d=i.paint.get("fill-pattern"),f=d&&d.constantOr(1),m=i.getCrossfadeParameters();o?(l=f&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",s=p.LINES):(l=f?"fillPattern":"fill",s=p.TRIANGLES);for(var g=0,_=r;g<_.length;g+=1){var y=_[g],v=t.getTile(y);if(!f||v.patternsLoaded()){var x=v.getBucket(i);if(x){var b=x.programConfigurations.get(i.id),w=e.useProgram(l,b);f&&(e.context.activeTexture.set(p.TEXTURE0),v.imageAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),b.updatePaintBuffers(m));var S=d.constantOr(null);if(S&&v.imageAtlas){var M=v.imageAtlas,T=M.patternPositions[S.to.toString()],E=M.patternPositions[S.from.toString()];T&&E&&b.setConstantPatternPositions(T,E)}var C=e.translatePosMatrix(y.posMatrix,v,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor"));if(o){u=x.indexBuffer2,h=x.segments2;var A=[p.drawingBufferWidth,p.drawingBufferHeight];c="fillOutlinePattern"===l&&f?Ai(C,e,m,v,A):Ci(C,A)}else u=x.indexBuffer,h=x.segments,c=f?Ei(C,e,m,v):Ti(C);w.draw(e.context,s,n,e.stencilModeForClipping(y),a,Ae.disabled,c,i.id,x.layoutVertexBuffer,u,h,i.paint,e.transform.zoom,b)}}}}function nr(e,t,i,r,n,a,o){for(var s=e.context,l=s.gl,c=i.paint.get("fill-extrusion-pattern"),u=c.constantOr(1),h=i.getCrossfadeParameters(),p=i.paint.get("fill-extrusion-opacity"),d=0,f=r;d<f.length;d+=1){var m=f[d],g=t.getTile(m),_=g.getBucket(i);if(_){var y=_.programConfigurations.get(i.id),v=e.useProgram(u?"fillExtrusionPattern":"fillExtrusion",y);u&&(e.context.activeTexture.set(l.TEXTURE0),g.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),y.updatePaintBuffers(h));var x=c.constantOr(null);if(x&&g.imageAtlas){var b=g.imageAtlas,w=b.patternPositions[x.to.toString()],S=b.patternPositions[x.from.toString()];w&&S&&y.setConstantPatternPositions(w,S)}var M=e.translatePosMatrix(m.posMatrix,g,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),T=i.paint.get("fill-extrusion-vertical-gradient"),E=u?Mi(M,e,T,p,m,h,g):Si(M,e,T,p);v.draw(s,s.gl.TRIANGLES,n,a,o,Ae.backCCW,E,i.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,i.paint,e.transform.zoom,y)}}}function ar(t,i,r,n,a,o){var s=t.context,l=s.gl,c=i.fbo;if(c){var u=t.useProgram("hillshade");s.activeTexture.set(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,c.colorAttachment.get());var h=function(t,i,r){var n=r.paint.get("hillshade-shadow-color"),a=r.paint.get("hillshade-highlight-color"),o=r.paint.get("hillshade-accent-color"),s=r.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===r.paint.get("hillshade-illumination-anchor")&&(s-=t.transform.angle);var l,c,u,h=!t.options.moving;return{u_matrix:t.transform.calculatePosMatrix(i.tileID.toUnwrapped(),h),u_image:0,u_latrange:(l=i.tileID,c=Math.pow(2,l.canonical.z),u=l.canonical.y,[new e.MercatorCoordinate(0,u/c).toLngLat().lat,new e.MercatorCoordinate(0,(u+1)/c).toLngLat().lat]),u_light:[r.paint.get("hillshade-exaggeration"),s],u_shadow:n,u_highlight:a,u_accent:o}}(t,i,r);u.draw(s,l.TRIANGLES,n,a,o,Ae.disabled,h,r.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}}function or(t,i,r,n,a,o){var s=t.context,l=s.gl,c=i.dem;if(c&&c.data){var u=c.dim,h=c.stride,p=c.getPixels();if(s.activeTexture.set(l.TEXTURE1),s.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||t.getTileTexture(h),i.demTexture){var d=i.demTexture;d.update(p,{premultiply:!1}),d.bind(l.NEAREST,l.CLAMP_TO_EDGE)}else i.demTexture=new e.Texture(s,p,l.RGBA,{premultiply:!1}),i.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);s.activeTexture.set(l.TEXTURE0);var f=i.fbo;if(!f){var m=new e.Texture(s,{width:u,height:u,data:null},l.RGBA);m.bind(l.LINEAR,l.CLAMP_TO_EDGE),(f=i.fbo=s.createFramebuffer(u,u,!0)).colorAttachment.set(m.texture)}s.bindFramebuffer.set(f.framebuffer),s.viewport.set([0,0,u,u]),t.useProgram("hillshadePrepare").draw(s,l.TRIANGLES,n,a,o,Ae.disabled,function(t,i){var r=i.stride,n=e.create();return e.ortho(n,0,e.EXTENT,-e.EXTENT,0,0,1),e.translate(n,n,[0,-e.EXTENT,0]),{u_matrix:n,u_image:1,u_dimension:[r,r],u_zoom:t.overscaledZ,u_unpack:i.getUnpackVector()}}(i.tileID,c),r.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments),i.needsHillshadePrepare=!1}}function sr(t,i,r,n,a){var o=n.paint.get("raster-fade-duration");if(o>0){var s=e.browser.now(),l=(s-t.timeAdded)/o,c=i?(s-i.timeAdded)/o:-1,u=r.getSource(),h=a.coveringZoomLevel({tileSize:u.tileSize,roundZoom:u.roundZoom}),p=!i||Math.abs(i.tileID.overscaledZ-h)>Math.abs(t.tileID.overscaledZ-h),d=p&&t.refreshedUponExpiration?1:e.clamp(p?l:1-c,0,1);return t.refreshedUponExpiration&&l>=1&&(t.refreshedUponExpiration=!1),i?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}var lr=new e.Color(1,0,0,1),cr=new e.Color(0,1,0,1),ur=new e.Color(0,0,1,1),hr=new e.Color(1,0,1,1),pr=new e.Color(0,1,1,1);function dr(e,t,i,r){mr(e,0,t+i/2,e.transform.width,i,r)}function fr(e,t,i,r){mr(e,t-i/2,0,i,e.transform.height,r)}function mr(t,i,r,n,a,o){var s=t.context,l=s.gl;l.enable(l.SCISSOR_TEST),l.scissor(i*e.browser.devicePixelRatio,r*e.browser.devicePixelRatio,n*e.browser.devicePixelRatio,a*e.browser.devicePixelRatio),s.clear({color:o}),l.disable(l.SCISSOR_TEST)}function gr(t,i,r){var n=t.context,a=n.gl,o=r.posMatrix,s=t.useProgram("debug"),l=Te.disabled,c=Ee.disabled,u=t.colorModeForRenderPass();n.activeTexture.set(a.TEXTURE0),t.emptyTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),s.draw(n,a.LINE_STRIP,l,c,u,Ae.disabled,Ri(o,e.Color.red),"$debug",t.debugBuffer,t.tileBorderIndexBuffer,t.debugSegments);var h=i.getTileByID(r.key).latestRawTileData,p=Math.floor((h&&h.byteLength||0)/1024),d=i.getTile(r).tileSize,f=512/Math.min(d,512)*(r.overscaledZ/t.transform.zoom)*.5,m=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(m+=" => "+r.overscaledZ),function(e,t){e.initDebugOverlayCanvas();var i=e.debugOverlayCanvas,r=e.context.gl,n=e.debugOverlayCanvas.getContext("2d");n.clearRect(0,0,i.width,i.height),n.shadowColor="white",n.shadowBlur=2,n.lineWidth=1.5,n.strokeStyle="white",n.textBaseline="top",n.font="bold 36px Open Sans, sans-serif",n.fillText(t,5,5),n.strokeText(t,5,5),e.debugOverlayTexture.update(i),e.debugOverlayTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}(t,m+" "+p+"kb"),s.draw(n,a.TRIANGLES,l,c,Ce.alphaBlended,Ae.disabled,Ri(o,e.Color.transparent,f),"$debug",t.debugBuffer,t.quadTriangleIndexBuffer,t.debugSegments)}var _r={symbol:function(t,i,r,n,a){if("translucent"===t.renderPass){var o=Ee.disabled,s=t.colorModeForRenderPass();r.layout.get("text-variable-anchor")&&function(t,i,r,n,a,o,s){for(var l=i.transform,c="map"===a,u="map"===o,h=0,p=t;h<p.length;h+=1){var d=p[h],f=n.getTile(d),m=f.getBucket(r);if(m&&m.text&&m.text.segments.get().length){var g=e.evaluateSizeForZoom(m.textSizeData,l.zoom),_=pt(f,1,i.transform.zoom),y=Ke(d.posMatrix,u,c,i.transform,_),v="none"!==r.layout.get("icon-text-fit")&&m.hasIconData();if(g){var x=Math.pow(2,l.zoom-f.tileID.overscaledZ);Qi(m,c,u,s,e.symbolSize,l,y,d.posMatrix,x,g,v)}}}}(n,t,r,i,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),a),0!==r.paint.get("icon-opacity").constantOr(1)&&tr(t,i,r,n,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),o,s),0!==r.paint.get("text-opacity").constantOr(1)&&tr(t,i,r,n,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),o,s),i.map.showCollisionBoxes&&(Yi(t,i,r,n,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),Yi(t,i,r,n,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))}},circle:function(t,i,r,n){if("translucent"===t.renderPass){var a=r.paint.get("circle-opacity"),o=r.paint.get("circle-stroke-width"),s=r.paint.get("circle-stroke-opacity"),l=void 0!==r.layout.get("circle-sort-key").constantOr(1);if(0!==a.constantOr(1)||0!==o.constantOr(1)&&0!==s.constantOr(1)){for(var c=t.context,u=c.gl,h=t.depthModeForSublayer(0,Te.ReadOnly),p=Ee.disabled,d=t.colorModeForRenderPass(),f=[],m=0;m<n.length;m++){var g=n[m],_=i.getTile(g),y=_.getBucket(r);if(y){var v=y.programConfigurations.get(r.id),x={programConfiguration:v,program:t.useProgram("circle",v),layoutVertexBuffer:y.layoutVertexBuffer,indexBuffer:y.indexBuffer,uniformValues:Ii(t,g,_,r)};if(l)for(var b=0,w=y.segments.get();b<w.length;b+=1){var S=w[b];f.push({segments:new e.SegmentVector([S]),sortKey:S.sortKey,state:x})}else f.push({segments:y.segments,sortKey:0,state:x})}}l&&f.sort((function(e,t){return e.sortKey-t.sortKey}));for(var M=0,T=f;M<T.length;M+=1){var E=T[M],C=E.state;C.program.draw(c,u.TRIANGLES,h,p,d,Ae.disabled,C.uniformValues,r.id,C.layoutVertexBuffer,C.indexBuffer,E.segments,r.paint,t.transform.zoom,C.programConfiguration)}}}},heatmap:function(t,i,r,n){if(0!==r.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){var a=t.context,o=a.gl,s=Ee.disabled,l=new Ce([o.ONE,o.ONE],e.Color.transparent,[!0,!0,!0,!0]);!function(e,t,i){var r=e.gl;e.activeTexture.set(r.TEXTURE1),e.viewport.set([0,0,t.width/4,t.height/4]);var n=i.heatmapFbo;if(n)r.bindTexture(r.TEXTURE_2D,n.colorAttachment.get()),e.bindFramebuffer.set(n.framebuffer);else{var a=r.createTexture();r.bindTexture(r.TEXTURE_2D,a),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),n=i.heatmapFbo=e.createFramebuffer(t.width/4,t.height/4,!1),function(e,t,i,r){var n=e.gl;n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t.width/4,t.height/4,0,n.RGBA,e.extRenderToTextureHalfFloat?e.extTextureHalfFloat.HALF_FLOAT_OES:n.UNSIGNED_BYTE,null),r.colorAttachment.set(i)}(e,t,a,n)}}(a,t,r),a.clear({color:e.Color.transparent});for(var c=0;c<n.length;c++){var u=n[c];if(!i.hasRenderableParent(u)){var h=i.getTile(u),p=h.getBucket(r);if(p){var d=p.programConfigurations.get(r.id);t.useProgram("heatmap",d).draw(a,o.TRIANGLES,Te.disabled,s,l,Ae.disabled,Li(u.posMatrix,h,t.transform.zoom,r.paint.get("heatmap-intensity")),r.id,p.layoutVertexBuffer,p.indexBuffer,p.segments,r.paint,t.transform.zoom,d)}}}a.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,i){var r=t.context,n=r.gl,a=i.heatmapFbo;if(a){r.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,a.colorAttachment.get()),r.activeTexture.set(n.TEXTURE1);var o=i.colorRampTexture;o||(o=i.colorRampTexture=new e.Texture(r,i.colorRamp,n.RGBA)),o.bind(n.LINEAR,n.CLAMP_TO_EDGE),t.useProgram("heatmapTexture").draw(r,n.TRIANGLES,Te.disabled,Ee.disabled,t.colorModeForRenderPass(),Ae.disabled,function(t,i,r,n){var a=e.create();e.ortho(a,0,t.width,t.height,0,0,1);var o=t.context.gl;return{u_matrix:a,u_world:[o.drawingBufferWidth,o.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:i.paint.get("heatmap-opacity")}}(t,i),i.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,i.paint,t.transform.zoom)}}(t,r))},line:function(t,i,r,n){if("translucent"===t.renderPass){var a=r.paint.get("line-opacity"),o=r.paint.get("line-width");if(0!==a.constantOr(1)&&0!==o.constantOr(1))for(var s=t.depthModeForSublayer(0,Te.ReadOnly),l=t.colorModeForRenderPass(),c=r.paint.get("line-dasharray"),u=r.paint.get("line-pattern"),h=u.constantOr(1),p=r.paint.get("line-gradient"),d=r.getCrossfadeParameters(),f=h?"linePattern":c?"lineSDF":p?"lineGradient":"line",m=t.context,g=m.gl,_=!0,y=0,v=n;y<v.length;y+=1){var x=v[y],b=i.getTile(x);if(!h||b.patternsLoaded()){var w=b.getBucket(r);if(w){var S=w.programConfigurations.get(r.id),M=t.context.program.get(),T=t.useProgram(f,S),E=_||T.program!==M,C=u.constantOr(null);if(C&&b.imageAtlas){var A=b.imageAtlas,I=A.patternPositions[C.to.toString()],P=A.patternPositions[C.from.toString()];I&&P&&S.setConstantPatternPositions(I,P)}var z=h?Fi(t,b,r,d):c?Oi(t,b,r,c,d):p?Bi(t,b,r,w.lineClipsArray.length):Di(t,b,r);if(h)m.activeTexture.set(g.TEXTURE0),b.imageAtlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),S.updatePaintBuffers(d);else if(c&&(E||t.lineAtlas.dirty))m.activeTexture.set(g.TEXTURE0),t.lineAtlas.bind(m);else if(p){var R=w.gradients[r.id],k=R.texture;if(r.gradientVersion!==R.version){var L=256;if(r.stepInterpolant){var D=i.getSource().maxzoom,B=x.canonical.z===D?Math.ceil(1<<t.transform.maxZoom-x.canonical.z):1;L=e.clamp(e.nextPowerOfTwo(w.maxLineLength/e.EXTENT*1024*B),256,m.maxTextureSize)}R.gradient=e.renderColorRamp({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:L,image:R.gradient||void 0,clips:w.lineClipsArray}),R.texture?R.texture.update(R.gradient):R.texture=new e.Texture(m,R.gradient,g.RGBA),R.version=r.gradientVersion,k=R.texture}m.activeTexture.set(g.TEXTURE0),k.bind(r.stepInterpolant?g.NEAREST:g.LINEAR,g.CLAMP_TO_EDGE)}T.draw(m,g.TRIANGLES,s,t.stencilModeForClipping(x),l,Ae.disabled,z,r.id,w.layoutVertexBuffer,w.indexBuffer,w.segments,r.paint,t.transform.zoom,S,w.layoutVertexBuffer2),_=!1}}}}},fill:function(t,i,r,n){var a=r.paint.get("fill-color"),o=r.paint.get("fill-opacity");if(0!==o.constantOr(1)){var s=t.colorModeForRenderPass(),l=r.paint.get("fill-pattern"),c=t.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===a.constantOr(e.Color.transparent).a&&1===o.constantOr(0)?"opaque":"translucent";if(t.renderPass===c){var u=t.depthModeForSublayer(1,"opaque"===t.renderPass?Te.ReadWrite:Te.ReadOnly);rr(t,i,r,n,u,s,!1)}if("translucent"===t.renderPass&&r.paint.get("fill-antialias")){var h=t.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,Te.ReadOnly);rr(t,i,r,n,h,s,!0)}}},"fill-extrusion":function(e,t,i,r){var n=i.paint.get("fill-extrusion-opacity");if(0!==n&&"translucent"===e.renderPass){var a=new Te(e.context.gl.LEQUAL,Te.ReadWrite,e.depthRangeFor3D);if(1!==n||i.paint.get("fill-extrusion-pattern").constantOr(1))nr(e,t,i,r,a,Ee.disabled,Ce.disabled),nr(e,t,i,r,a,e.stencilModeFor3D(),e.colorModeForRenderPass());else{var o=e.colorModeForRenderPass();nr(e,t,i,r,a,Ee.disabled,o)}}},hillshade:function(e,t,i,r){if("offscreen"===e.renderPass||"translucent"===e.renderPass){for(var n=e.context,a=e.depthModeForSublayer(0,Te.ReadOnly),o=e.colorModeForRenderPass(),s="translucent"===e.renderPass?e.stencilConfigForOverlap(r):[{},r],l=s[0],c=0,u=s[1];c<u.length;c+=1){var h=u[c],p=t.getTile(h);p.needsHillshadePrepare&&"offscreen"===e.renderPass?or(e,p,i,a,Ee.disabled,o):"translucent"===e.renderPass&&ar(e,p,i,a,l[h.overscaledZ],o)}n.viewport.set([0,0,e.width,e.height])}},raster:function(e,t,i,r){if("translucent"===e.renderPass&&0!==i.paint.get("raster-opacity")&&r.length)for(var n=e.context,a=n.gl,o=t.getSource(),s=e.useProgram("raster"),l=e.colorModeForRenderPass(),c=o instanceof R?[{},r]:e.stencilConfigForOverlap(r),u=c[0],h=c[1],p=h[h.length-1].overscaledZ,d=!e.options.moving,f=0,m=h;f<m.length;f+=1){var g=m[f],_=e.depthModeForSublayer(g.overscaledZ-p,1===i.paint.get("raster-opacity")?Te.ReadWrite:Te.ReadOnly,a.LESS),y=t.getTile(g),v=e.transform.calculatePosMatrix(g.toUnwrapped(),d);y.registerFadeDuration(i.paint.get("raster-fade-duration"));var x=t.findLoadedParent(g,0),b=sr(y,x,t,i,e.transform),w=void 0,S=void 0,M="nearest"===i.paint.get("raster-resampling")?a.NEAREST:a.LINEAR;n.activeTexture.set(a.TEXTURE0),y.texture.bind(M,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST),n.activeTexture.set(a.TEXTURE1),x?(x.texture.bind(M,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST),w=Math.pow(2,x.tileID.overscaledZ-y.tileID.overscaledZ),S=[y.tileID.canonical.x*w%1,y.tileID.canonical.y*w%1]):y.texture.bind(M,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST);var T=Ui(v,S||[0,0],w||1,b,i);o instanceof R?s.draw(n,a.TRIANGLES,_,Ee.disabled,l,Ae.disabled,T,i.id,o.boundsBuffer,e.quadTriangleIndexBuffer,o.boundsSegments):s.draw(n,a.TRIANGLES,_,u[g.overscaledZ],l,Ae.disabled,T,i.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments)}},background:function(e,t,i){var r=i.paint.get("background-color"),n=i.paint.get("background-opacity");if(0!==n){var a=e.context,o=a.gl,s=e.transform,l=s.tileSize,c=i.paint.get("background-pattern");if(!e.isPatternMissing(c)){var u=!c&&1===r.a&&1===n&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass===u){var h=Ee.disabled,p=e.depthModeForSublayer(0,"opaque"===u?Te.ReadWrite:Te.ReadOnly),d=e.colorModeForRenderPass(),f=e.useProgram(c?"backgroundPattern":"background"),m=s.coveringTiles({tileSize:l});c&&(a.activeTexture.set(o.TEXTURE0),e.imageManager.bind(e.context));for(var g=i.getCrossfadeParameters(),_=0,y=m;_<y.length;_+=1){var v=y[_],x=e.transform.calculatePosMatrix(v.toUnwrapped()),b=c?Zi(x,n,e,c,{tileID:v,tileSize:l},g):Wi(x,n,r);f.draw(a,o.TRIANGLES,p,h,d,Ae.disabled,b,i.id,e.tileExtentBuffer,e.quadTriangleIndexBuffer,e.tileExtentSegments)}}}}},debug:function(e,t,i){for(var r=0;r<i.length;r++)gr(e,t,i[r])},custom:function(e,t,i){var r=e.context,n=i.implementation;if("offscreen"===e.renderPass){var a=n.prerender;a&&(e.setCustomLayerDefaults(),r.setColorMode(e.colorModeForRenderPass()),a.call(n,r.gl,e.transform.customLayerMatrix()),r.setDirty(),e.setBaseState())}else if("translucent"===e.renderPass){e.setCustomLayerDefaults(),r.setColorMode(e.colorModeForRenderPass()),r.setStencilMode(Ee.disabled);var o="3d"===n.renderingMode?new Te(e.context.gl.LEQUAL,Te.ReadWrite,e.depthRangeFor3D):e.depthModeForSublayer(0,Te.ReadOnly);r.setDepthMode(o),n.render(r.gl,e.transform.customLayerMatrix()),r.setDirty(),e.setBaseState(),r.bindFramebuffer.set(null)}}},yr=function(e,t){this.context=new Ie(e),this.transform=t,this._tileTextures={},this.setup(),this.numSublayers=Pe.maxUnderzooming+Pe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ot,this.gpuTimers={}};yr.prototype.resize=function(t,i){if(this.width=t*e.browser.devicePixelRatio,this.height=i*e.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var r=0,n=this.style._order;r<n.length;r+=1)this.style._layers[n[r]].resize()},yr.prototype.setup=function(){var t=this.context,i=new e.StructArrayLayout2i4;i.emplaceBack(0,0),i.emplaceBack(e.EXTENT,0),i.emplaceBack(0,e.EXTENT),i.emplaceBack(e.EXTENT,e.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(i,qt.members),this.tileExtentSegments=e.SegmentVector.simpleSegment(0,0,4,2);var r=new e.StructArrayLayout2i4;r.emplaceBack(0,0),r.emplaceBack(e.EXTENT,0),r.emplaceBack(0,e.EXTENT),r.emplaceBack(e.EXTENT,e.EXTENT),this.debugBuffer=t.createVertexBuffer(r,qt.members),this.debugSegments=e.SegmentVector.simpleSegment(0,0,4,5);var n=new e.StructArrayLayout4i8;n.emplaceBack(0,0,0,0),n.emplaceBack(e.EXTENT,0,e.EXTENT,0),n.emplaceBack(0,e.EXTENT,0,e.EXTENT),n.emplaceBack(e.EXTENT,e.EXTENT,e.EXTENT,e.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(n,z.members),this.rasterBoundsSegments=e.SegmentVector.simpleSegment(0,0,4,2);var a=new e.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(1,0),a.emplaceBack(0,1),a.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(a,qt.members),this.viewportSegments=e.SegmentVector.simpleSegment(0,0,4,2);var o=new e.StructArrayLayout1ui2;o.emplaceBack(0),o.emplaceBack(1),o.emplaceBack(3),o.emplaceBack(2),o.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(o);var s=new e.StructArrayLayout3ui6;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(s),this.emptyTexture=new e.Texture(t,{width:1,height:1,data:new Uint8Array([0,0,0,0])},t.gl.RGBA);var l=this.context.gl;this.stencilClearMode=new Ee({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO)},yr.prototype.clearStencil=function(){var t=this.context,i=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var r=e.create();e.ortho(r,0,this.width,this.height,0,0,1),e.scale(r,r,[i.drawingBufferWidth,i.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,i.TRIANGLES,Te.disabled,this.stencilClearMode,Ce.disabled,Ae.disabled,ki(r),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},yr.prototype._renderTileClippingMasks=function(e,t){if(this.currentStencilSource!==e.source&&e.isTileClipped()&&t&&t.length){this.currentStencilSource=e.source;var i=this.context,r=i.gl;this.nextStencilID+t.length>256&&this.clearStencil(),i.setColorMode(Ce.disabled),i.setDepthMode(Te.disabled);var n=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var a=0,o=t;a<o.length;a+=1){var s=o[a],l=this._tileClippingMaskIDs[s.key]=this.nextStencilID++;n.draw(i,r.TRIANGLES,Te.disabled,new Ee({func:r.ALWAYS,mask:0},l,255,r.KEEP,r.KEEP,r.REPLACE),Ce.disabled,Ae.disabled,ki(s.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},yr.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var e=this.nextStencilID++,t=this.context.gl;return new Ee({func:t.NOTEQUAL,mask:255},e,255,t.KEEP,t.KEEP,t.REPLACE)},yr.prototype.stencilModeForClipping=function(e){var t=this.context.gl;return new Ee({func:t.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,t.KEEP,t.KEEP,t.REPLACE)},yr.prototype.stencilConfigForOverlap=function(e){var t,i=this.context.gl,r=e.sort((function(e,t){return t.overscaledZ-e.overscaledZ})),n=r[r.length-1].overscaledZ,a=r[0].overscaledZ-n+1;if(a>1){this.currentStencilSource=void 0,this.nextStencilID+a>256&&this.clearStencil();for(var o={},s=0;s<a;s++)o[s+n]=new Ee({func:i.GEQUAL,mask:255},s+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=a,[o,r]}return[(t={},t[n]=Ee.disabled,t),r]},yr.prototype.colorModeForRenderPass=function(){var t=this.context.gl;return this._showOverdrawInspector?new Ce([t.CONSTANT_COLOR,t.ONE],new e.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?Ce.unblended:Ce.alphaBlended},yr.prototype.depthModeForSublayer=function(e,t,i){if(!this.opaquePassEnabledForLayer())return Te.disabled;var r=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Te(i||this.context.gl.LEQUAL,t,[r,r])},yr.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},yr.prototype.render=function(t,i){var r=this;this.style=t,this.options=i,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(e.browser.now()),this.imageManager.beginFrame();var n=this.style._order,a=this.style.sourceCaches;for(var o in a){var s=a[o];s.used&&s.prepare(this.context)}var l,c,u={},h={},p={};for(var d in a){var f=a[d];u[d]=f.getVisibleCoordinates(),h[d]=u[d].slice().reverse(),p[d]=f.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var m=0;m<n.length;m++)if(this.style._layers[n[m]].is3D()){this.opaquePassCutoff=m;break}this.renderPass="offscreen";for(var g=0,_=n;g<_.length;g+=1){var y=this.style._layers[_[g]];if(y.hasOffscreenPass()&&!y.isHidden(this.transform.zoom)){var v=h[y.source];("custom"===y.type||v.length)&&this.renderLayer(this,a[y.source],y,v)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:i.showOverdrawInspector?e.Color.black:e.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=i.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=n.length-1;this.currentLayer>=0;this.currentLayer--){var x=this.style._layers[n[this.currentLayer]],b=a[x.source],w=u[x.source];this._renderTileClippingMasks(x,w),this.renderLayer(this,b,x,w)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<n.length;this.currentLayer++){var S=this.style._layers[n[this.currentLayer]],M=a[S.source],T=("symbol"===S.type?p:h)[S.source];this._renderTileClippingMasks(S,u[S.source]),this.renderLayer(this,M,S,T)}this.options.showTileBoundaries&&(e.values(this.style._layers).forEach((function(e){e.source&&!e.isHidden(r.transform.zoom)&&(e.source!==(c&&c.id)&&(c=r.style.sourceCaches[e.source]),(!l||l.getSource().maxzoom<c.getSource().maxzoom)&&(l=c))})),l&&_r.debug(this,l,l.getVisibleCoordinates())),this.options.showPadding&&function(e){var t=e.transform.padding;dr(e,e.transform.height-(t.top||0),3,lr),dr(e,t.bottom||0,3,cr),fr(e,t.left||0,3,ur),fr(e,e.transform.width-(t.right||0),3,hr);var i=e.transform.centerPoint;!function(e,t,i,r){mr(e,t-1,i-10,2,20,r),mr(e,t-10,i-1,20,2,r)}(e,i.x,e.transform.height-i.y,pr)}(this),this.context.setDefault()},yr.prototype.renderLayer=function(e,t,i,r){i.isHidden(this.transform.zoom)||("background"===i.type||"custom"===i.type||r.length)&&(this.id=i.id,this.gpuTimingStart(i),_r[i.type](e,t,i,r,this.style.placement.variableOffsets),this.gpuTimingEnd())},yr.prototype.gpuTimingStart=function(e){if(this.options.gpuTiming){var t=this.context.extTimerQuery,i=this.gpuTimers[e.id];i||(i=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:t.createQueryEXT()}),i.calls++,t.beginQueryEXT(t.TIME_ELAPSED_EXT,i.query)}},yr.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var e=this.context.extTimerQuery;e.endQueryEXT(e.TIME_ELAPSED_EXT)}},yr.prototype.collectGpuTimers=function(){var e=this.gpuTimers;return this.gpuTimers={},e},yr.prototype.queryGpuTimers=function(e){var t={};for(var i in e){var r=e[i],n=this.context.extTimerQuery,a=n.getQueryObjectEXT(r.query,n.QUERY_RESULT_EXT)/1e6;n.deleteQueryEXT(r.query),t[i]=a}return t},yr.prototype.translatePosMatrix=function(t,i,r,n,a){if(!r[0]&&!r[1])return t;var o=a?"map"===n?this.transform.angle:0:"viewport"===n?-this.transform.angle:0;if(o){var s=Math.sin(o),l=Math.cos(o);r=[r[0]*l-r[1]*s,r[0]*s+r[1]*l]}var c=[a?r[0]:pt(i,r[0],this.transform.zoom),a?r[1]:pt(i,r[1],this.transform.zoom),0],u=new Float32Array(16);return e.translate(u,t,c),u},yr.prototype.saveTileTexture=function(e){var t=this._tileTextures[e.size[0]];t?t.push(e):this._tileTextures[e.size[0]]=[e]},yr.prototype.getTileTexture=function(e){var t=this._tileTextures[e];return t&&t.length>0?t.pop():null},yr.prototype.isPatternMissing=function(e){if(!e)return!1;if(!e.from||!e.to)return!0;var t=this.imageManager.getPattern(e.from.toString()),i=this.imageManager.getPattern(e.to.toString());return!t||!i},yr.prototype.useProgram=function(e,t){this.cache=this.cache||{};var i=""+e+(t?t.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[i]||(this.cache[i]=new bi(this.context,e,yi[e],t,Xi[e],this._showOverdrawInspector)),this.cache[i]},yr.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},yr.prototype.setBaseState=function(){var e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)},yr.prototype.initDebugOverlayCanvas=function(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=e.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new e.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},yr.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var vr=function(e,t){this.points=e,this.planes=t};vr.fromInvProjectionMatrix=function(t,i,r){var n=Math.pow(2,r),a=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((function(i){return e.transformMat4([],i,t)})).map((function(t){return e.scale$1([],t,1/t[3]/i*n)})),o=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((function(t){var i=e.sub([],a[t[0]],a[t[1]]),r=e.sub([],a[t[2]],a[t[1]]),n=e.normalize([],e.cross([],i,r)),o=-e.dot(n,a[t[1]]);return n.concat(o)}));return new vr(a,o)};var xr=function(t,i){this.min=t,this.max=i,this.center=e.scale$2([],e.add([],this.min,this.max),.5)};xr.prototype.quadrant=function(t){for(var i=[t%2==0,t<2],r=e.clone$2(this.min),n=e.clone$2(this.max),a=0;a<i.length;a++)r[a]=i[a]?this.min[a]:this.center[a],n[a]=i[a]?this.center[a]:this.max[a];return n[2]=this.max[2],new xr(r,n)},xr.prototype.distanceX=function(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]},xr.prototype.distanceY=function(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]},xr.prototype.intersects=function(t){for(var i=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],r=!0,n=0;n<t.planes.length;n++){for(var a=t.planes[n],o=0,s=0;s<i.length;s++)o+=e.dot$1(a,i[s])>=0;if(0===o)return 0;o!==i.length&&(r=!1)}if(r)return 2;for(var l=0;l<3;l++){for(var c=Number.MAX_VALUE,u=-Number.MAX_VALUE,h=0;h<t.points.length;h++){var p=t.points[h][l]-this.min[l];c=Math.min(c,p),u=Math.max(u,p)}if(u<0||c>this.max[l]-this.min[l])return 0}return 1};var br=function(e,t,i,r){if(void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=0),isNaN(e)||e<0||isNaN(t)||t<0||isNaN(i)||i<0||isNaN(r)||r<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=i,this.right=r};br.prototype.interpolate=function(t,i,r){return null!=i.top&&null!=t.top&&(this.top=e.number(t.top,i.top,r)),null!=i.bottom&&null!=t.bottom&&(this.bottom=e.number(t.bottom,i.bottom,r)),null!=i.left&&null!=t.left&&(this.left=e.number(t.left,i.left,r)),null!=i.right&&null!=t.right&&(this.right=e.number(t.right,i.right,r)),this},br.prototype.getCenter=function(t,i){var r=e.clamp((this.left+t-this.right)/2,0,t),n=e.clamp((this.top+i-this.bottom)/2,0,i);return new e.Point(r,n)},br.prototype.equals=function(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right},br.prototype.clone=function(){return new br(this.top,this.bottom,this.left,this.right)},br.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var wr=function(t,i,r,n,a){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===a||a,this._minZoom=t||0,this._maxZoom=i||22,this._minPitch=null==r?0:r,this._maxPitch=null==n?60:n,this.setMaxBounds(),this.width=0,this.height=0,this._center=new e.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new br,this._posMatrixCache={},this._alignedPosMatrixCache={}},Sr={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};wr.prototype.clone=function(){var e=new wr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.tileSize=this.tileSize,e.latRange=this.latRange,e.width=this.width,e.height=this.height,e._center=this._center,e.zoom=this.zoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._calcMatrices(),e},Sr.minZoom.get=function(){return this._minZoom},Sr.minZoom.set=function(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))},Sr.maxZoom.get=function(){return this._maxZoom},Sr.maxZoom.set=function(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))},Sr.minPitch.get=function(){return this._minPitch},Sr.minPitch.set=function(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))},Sr.maxPitch.get=function(){return this._maxPitch},Sr.maxPitch.set=function(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))},Sr.renderWorldCopies.get=function(){return this._renderWorldCopies},Sr.renderWorldCopies.set=function(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e},Sr.worldSize.get=function(){return this.tileSize*this.scale},Sr.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Sr.size.get=function(){return new e.Point(this.width,this.height)},Sr.bearing.get=function(){return-this.angle/Math.PI*180},Sr.bearing.set=function(t){var i=-e.wrap(t,-180,180)*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=e.create$2(),e.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Sr.pitch.get=function(){return this._pitch/Math.PI*180},Sr.pitch.set=function(t){var i=e.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())},Sr.fov.get=function(){return this._fov/Math.PI*180},Sr.fov.set=function(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())},Sr.zoom.get=function(){return this._zoom},Sr.zoom.set=function(e){var t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom,this._constrain(),this._calcMatrices())},Sr.center.get=function(){return this._center},Sr.center.set=function(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())},Sr.padding.get=function(){return this._edgeInsets.toJSON()},Sr.padding.set=function(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())},Sr.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},wr.prototype.isPaddingEqual=function(e){return this._edgeInsets.equals(e)},wr.prototype.interpolatePadding=function(e,t,i){this._unmodified=!1,this._edgeInsets.interpolate(e,t,i),this._constrain(),this._calcMatrices()},wr.prototype.coveringZoomLevel=function(e){var t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)},wr.prototype.getVisibleUnwrappedCoordinates=function(t){var i=[new e.UnwrappedTileID(0,t)];if(this._renderWorldCopies)for(var r=this.pointCoordinate(new e.Point(0,0)),n=this.pointCoordinate(new e.Point(this.width,0)),a=this.pointCoordinate(new e.Point(this.width,this.height)),o=this.pointCoordinate(new e.Point(0,this.height)),s=Math.floor(Math.min(r.x,n.x,a.x,o.x)),l=Math.floor(Math.max(r.x,n.x,a.x,o.x)),c=s-1;c<=l+1;c++)0!==c&&i.push(new e.UnwrappedTileID(c,t));return i},wr.prototype.coveringTiles=function(t){var i=this.coveringZoomLevel(t),r=i;if(void 0!==t.minzoom&&i<t.minzoom)return[];void 0!==t.maxzoom&&i>t.maxzoom&&(i=t.maxzoom);var n=e.MercatorCoordinate.fromLngLat(this.center),a=Math.pow(2,i),o=[a*n.x,a*n.y,0],s=vr.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i),l=t.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(l=i);var c=function(e){return{aabb:new xr([e*a,0,0],[(e+1)*a,a,0]),zoom:0,x:0,y:0,wrap:e,fullyVisible:!1}},u=[],h=[],p=i,d=t.reparseOverscaled?r:i;if(this._renderWorldCopies)for(var f=1;f<=3;f++)u.push(c(-f)),u.push(c(f));for(u.push(c(0));u.length>0;){var m=u.pop(),g=m.x,_=m.y,y=m.fullyVisible;if(!y){var v=m.aabb.intersects(s);if(0===v)continue;y=2===v}var x=m.aabb.distanceX(o),b=m.aabb.distanceY(o),w=Math.max(Math.abs(x),Math.abs(b));if(m.zoom===p||w>3+(1<<p-m.zoom)-2&&m.zoom>=l)h.push({tileID:new e.OverscaledTileID(m.zoom===p?d:m.zoom,m.wrap,m.zoom,g,_),distanceSq:e.sqrLen([o[0]-.5-g,o[1]-.5-_])});else for(var S=0;S<4;S++){var M=(g<<1)+S%2,T=(_<<1)+(S>>1);u.push({aabb:m.aabb.quadrant(S),zoom:m.zoom+1,x:M,y:T,wrap:m.wrap,fullyVisible:y})}}return h.sort((function(e,t){return e.distanceSq-t.distanceSq})).map((function(e){return e.tileID}))},wr.prototype.resize=function(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()},Sr.unmodified.get=function(){return this._unmodified},wr.prototype.zoomScale=function(e){return Math.pow(2,e)},wr.prototype.scaleZoom=function(e){return Math.log(e)/Math.LN2},wr.prototype.project=function(t){var i=e.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new e.Point(e.mercatorXfromLng(t.lng)*this.worldSize,e.mercatorYfromLat(i)*this.worldSize)},wr.prototype.unproject=function(t){return new e.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()},Sr.point.get=function(){return this.project(this.center)},wr.prototype.setLocationAtPoint=function(t,i){var r=this.pointCoordinate(i),n=this.pointCoordinate(this.centerPoint),a=this.locationCoordinate(t),o=new e.MercatorCoordinate(a.x-(r.x-n.x),a.y-(r.y-n.y));this.center=this.coordinateLocation(o),this._renderWorldCopies&&(this.center=this.center.wrap())},wr.prototype.locationPoint=function(e){return this.coordinatePoint(this.locationCoordinate(e))},wr.prototype.pointLocation=function(e){return this.coordinateLocation(this.pointCoordinate(e))},wr.prototype.locationCoordinate=function(t){return e.MercatorCoordinate.fromLngLat(t)},wr.prototype.coordinateLocation=function(e){return e.toLngLat()},wr.prototype.pointCoordinate=function(t){var i=[t.x,t.y,0,1],r=[t.x,t.y,1,1];e.transformMat4(i,i,this.pixelMatrixInverse),e.transformMat4(r,r,this.pixelMatrixInverse);var n=i[3],a=r[3],o=i[1]/n,s=r[1]/a,l=i[2]/n,c=r[2]/a,u=l===c?0:(0-l)/(c-l);return new e.MercatorCoordinate(e.number(i[0]/n,r[0]/a,u)/this.worldSize,e.number(o,s,u)/this.worldSize)},wr.prototype.coordinatePoint=function(t){var i=[t.x*this.worldSize,t.y*this.worldSize,0,1];return e.transformMat4(i,i,this.pixelMatrix),new e.Point(i[0]/i[3],i[1]/i[3])},wr.prototype.getBounds=function(){return(new e.LngLatBounds).extend(this.pointLocation(new e.Point(0,0))).extend(this.pointLocation(new e.Point(this.width,0))).extend(this.pointLocation(new e.Point(this.width,this.height))).extend(this.pointLocation(new e.Point(0,this.height)))},wr.prototype.getMaxBounds=function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new e.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},wr.prototype.setMaxBounds=function(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},wr.prototype.calculatePosMatrix=function(t,i){void 0===i&&(i=!1);var r=t.key,n=i?this._alignedPosMatrixCache:this._posMatrixCache;if(n[r])return n[r];var a=t.canonical,o=this.worldSize/this.zoomScale(a.z),s=a.x+Math.pow(2,a.z)*t.wrap,l=e.identity(new Float64Array(16));return e.translate(l,l,[s*o,a.y*o,0]),e.scale(l,l,[o/e.EXTENT,o/e.EXTENT,1]),e.multiply(l,i?this.alignedProjMatrix:this.projMatrix,l),n[r]=new Float32Array(l),n[r]},wr.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},wr.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var t,i,r,n,a=-90,o=90,s=-180,l=180,c=this.size,u=this._unmodified;if(this.latRange){var h=this.latRange;a=e.mercatorYfromLat(h[1])*this.worldSize,t=(o=e.mercatorYfromLat(h[0])*this.worldSize)-a<c.y?c.y/(o-a):0}if(this.lngRange){var p=this.lngRange;s=e.mercatorXfromLng(p[0])*this.worldSize,i=(l=e.mercatorXfromLng(p[1])*this.worldSize)-s<c.x?c.x/(l-s):0}var d=this.point,f=Math.max(i||0,t||0);if(f)return this.center=this.unproject(new e.Point(i?(l+s)/2:d.x,t?(o+a)/2:d.y)),this.zoom+=this.scaleZoom(f),this._unmodified=u,void(this._constraining=!1);if(this.latRange){var m=d.y,g=c.y/2;m-g<a&&(n=a+g),m+g>o&&(n=o-g)}if(this.lngRange){var _=d.x,y=c.x/2;_-y<s&&(r=s+y),_+y>l&&(r=l-y)}void 0===r&&void 0===n||(this.center=this.unproject(new e.Point(void 0!==r?r:d.x,void 0!==n?n:d.y))),this._unmodified=u,this._constraining=!1}},wr.prototype._calcMatrices=function(){if(this.height){var t=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var i=Math.PI/2+this._pitch,r=this._fov*(.5+t.y/this.height),n=Math.sin(r)*this.cameraToCenterDistance/Math.sin(e.clamp(Math.PI-i-r,.01,Math.PI-.01)),a=this.point,o=a.x,s=a.y,l=1.01*(Math.cos(Math.PI/2-this._pitch)*n+this.cameraToCenterDistance),c=this.height/50,u=new Float64Array(16);e.perspective(u,this._fov,this.width/this.height,c,l),u[8]=2*-t.x/this.width,u[9]=2*t.y/this.height,e.scale(u,u,[1,-1,1]),e.translate(u,u,[0,0,-this.cameraToCenterDistance]),e.rotateX(u,u,this._pitch),e.rotateZ(u,u,this.angle),e.translate(u,u,[-o,-s,0]),this.mercatorMatrix=e.scale([],u,[this.worldSize,this.worldSize,this.worldSize]),e.scale(u,u,[1,1,e.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=u,this.invProjMatrix=e.invert([],this.projMatrix);var h=this.width%2/2,p=this.height%2/2,d=Math.cos(this.angle),f=Math.sin(this.angle),m=o-Math.round(o)+d*h+f*p,g=s-Math.round(s)+d*p+f*h,_=new Float64Array(u);if(e.translate(_,_,[m>.5?m-1:m,g>.5?g-1:g,0]),this.alignedProjMatrix=_,u=e.create(),e.scale(u,u,[this.width/2,-this.height/2,1]),e.translate(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=e.create(),e.scale(u,u,[1,-1,1]),e.translate(u,u,[-1,-1,0]),e.scale(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u,this.pixelMatrix=e.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(u=e.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=u,this._posMatrixCache={},this._alignedPosMatrixCache={}}},wr.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var t=this.pointCoordinate(new e.Point(0,0)),i=[t.x*this.worldSize,t.y*this.worldSize,0,1];return e.transformMat4(i,i,this.pixelMatrix)[3]/this.cameraToCenterDistance},wr.prototype.getCameraPoint=function(){var t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.Point(0,t))},wr.prototype.getCameraQueryGeometry=function(t){var i=this.getCameraPoint();if(1===t.length)return[t[0],i];for(var r=i.x,n=i.y,a=i.x,o=i.y,s=0,l=t;s<l.length;s+=1){var c=l[s];r=Math.min(r,c.x),n=Math.min(n,c.y),a=Math.max(a,c.x),o=Math.max(o,c.y)}return[new e.Point(r,n),new e.Point(a,n),new e.Point(a,o),new e.Point(r,o),new e.Point(r,n)]},Object.defineProperties(wr.prototype,Sr);var Mr=function(t){var i,r,n,a;this._hashName=t&&encodeURIComponent(t),e.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(i=this._updateHashUnthrottled.bind(this),r=!1,n=null,a=function(){n=null,r&&(i(),n=setTimeout(a,300),r=!1)},function(){return r=!0,n||a(),n})};Mr.prototype.addTo=function(t){return this._map=t,e.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Mr.prototype.remove=function(){return e.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Mr.prototype.getHashString=function(t){var i=this._map.getCenter(),r=Math.round(100*this._map.getZoom())/100,n=Math.ceil((r*Math.LN2+Math.log(512/360/.5))/Math.LN10),a=Math.pow(10,n),o=Math.round(i.lng*a)/a,s=Math.round(i.lat*a)/a,l=this._map.getBearing(),c=this._map.getPitch(),u="";if(u+=t?"/"+o+"/"+s+"/"+r:r+"/"+s+"/"+o,(l||c)&&(u+="/"+Math.round(10*l)/10),c&&(u+="/"+Math.round(c)),this._hashName){var h=this._hashName,p=!1,d=e.window.location.hash.slice(1).split("&").map((function(e){var t=e.split("=")[0];return t===h?(p=!0,t+"="+u):e})).filter((function(e){return e}));return p||d.push(h+"="+u),"#"+d.join("&")}return"#"+u},Mr.prototype._getCurrentHash=function(){var t,i=this,r=e.window.location.hash.replace("#","");return this._hashName?(r.split("&").map((function(e){return e.split("=")})).forEach((function(e){e[0]===i._hashName&&(t=e)})),(t&&t[1]||"").split("/")):r.split("/")},Mr.prototype._onHashChange=function(){var e=this._getCurrentHash();if(e.length>=3&&!e.some((function(e){return isNaN(e)}))){var t=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(e[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:t,pitch:+(e[4]||0)}),!0}return!1},Mr.prototype._updateHashUnthrottled=function(){var t=e.window.location.href.replace(/(#.+)?$/,this.getHashString());try{e.window.history.replaceState(e.window.history.state,null,t)}catch(e){}};var Tr={linearity:.3,easing:e.bezier(0,0,.3,1)},Er=e.extend({deceleration:2500,maxSpeed:1400},Tr),Cr=e.extend({deceleration:20,maxSpeed:1400},Tr),Ar=e.extend({deceleration:1e3,maxSpeed:360},Tr),Ir=e.extend({deceleration:1e3,maxSpeed:90},Tr),Pr=function(e){this._map=e,this.clear()};function zr(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function Rr(t,i,r){var n=r.maxSpeed,a=r.linearity,o=r.deceleration,s=e.clamp(t*a/(i/1e3),-n,n),l=Math.abs(s)/(o*a);return{easing:r.easing,duration:1e3*l,amount:s*(l/2)}}Pr.prototype.clear=function(){this._inertiaBuffer=[]},Pr.prototype.record=function(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:e.browser.now(),settings:t})},Pr.prototype._drainInertiaBuffer=function(){for(var t=this._inertiaBuffer,i=e.browser.now();t.length>0&&i-t[0].time>160;)t.shift()},Pr.prototype._onMoveEnd=function(t){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var i={zoom:0,bearing:0,pitch:0,pan:new e.Point(0,0),pinchAround:void 0,around:void 0},r=0,n=this._inertiaBuffer;r<n.length;r+=1){var a=n[r].settings;i.zoom+=a.zoomDelta||0,i.bearing+=a.bearingDelta||0,i.pitch+=a.pitchDelta||0,a.panDelta&&i.pan._add(a.panDelta),a.around&&(i.around=a.around),a.pinchAround&&(i.pinchAround=a.pinchAround)}var o=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,s={};if(i.pan.mag()){var l=Rr(i.pan.mag(),o,e.extend({},Er,t||{}));s.offset=i.pan.mult(l.amount/i.pan.mag()),s.center=this._map.transform.center,zr(s,l)}if(i.zoom){var c=Rr(i.zoom,o,Cr);s.zoom=this._map.transform.zoom+c.amount,zr(s,c)}if(i.bearing){var u=Rr(i.bearing,o,Ar);s.bearing=this._map.transform.bearing+e.clamp(u.amount,-179,179),zr(s,u)}if(i.pitch){var h=Rr(i.pitch,o,Ir);s.pitch=this._map.transform.pitch+h.amount,zr(s,h)}if(s.zoom||s.bearing){var p=void 0===i.pinchAround?i.around:i.pinchAround;s.around=p?this._map.unproject(p):this._map.getCenter()}return this.clear(),e.extend(s,{noMoveStart:!0})}};var kr=function(t){function r(r,n,a,o){void 0===o&&(o={});var s=i.mousePos(n.getCanvasContainer(),a),l=n.unproject(s);t.call(this,r,e.extend({point:s,lngLat:l,originalEvent:a},o)),this._defaultPrevented=!1,this.target=n}t&&(r.__proto__=t),(r.prototype=Object.create(t&&t.prototype)).constructor=r;var n={defaultPrevented:{configurable:!0}};return r.prototype.preventDefault=function(){this._defaultPrevented=!0},n.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(r.prototype,n),r}(e.Event),Lr=function(t){function r(r,n,a){var o="touchend"===r?a.changedTouches:a.touches,s=i.touchPos(n.getCanvasContainer(),o),l=s.map((function(e){return n.unproject(e)})),c=s.reduce((function(e,t,i,r){return e.add(t.div(r.length))}),new e.Point(0,0)),u=n.unproject(c);t.call(this,r,{points:s,point:c,lngLats:l,lngLat:u,originalEvent:a}),this._defaultPrevented=!1}t&&(r.__proto__=t),(r.prototype=Object.create(t&&t.prototype)).constructor=r;var n={defaultPrevented:{configurable:!0}};return r.prototype.preventDefault=function(){this._defaultPrevented=!0},n.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(r.prototype,n),r}(e.Event),Dr=function(e){function t(t,i,r){e.call(this,t,{originalEvent:r}),this._defaultPrevented=!1}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var i={defaultPrevented:{configurable:!0}};return t.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(t.prototype,i),t}(e.Event),Br=function(e,t){this._map=e,this._clickTolerance=t.clickTolerance};Br.prototype.reset=function(){delete this._mousedownPos},Br.prototype.wheel=function(e){return this._firePreventable(new Dr(e.type,this._map,e))},Br.prototype.mousedown=function(e,t){return this._mousedownPos=t,this._firePreventable(new kr(e.type,this._map,e))},Br.prototype.mouseup=function(e){this._map.fire(new kr(e.type,this._map,e))},Br.prototype.click=function(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||this._map.fire(new kr(e.type,this._map,e))},Br.prototype.dblclick=function(e){return this._firePreventable(new kr(e.type,this._map,e))},Br.prototype.mouseover=function(e){this._map.fire(new kr(e.type,this._map,e))},Br.prototype.mouseout=function(e){this._map.fire(new kr(e.type,this._map,e))},Br.prototype.touchstart=function(e){return this._firePreventable(new Lr(e.type,this._map,e))},Br.prototype.touchmove=function(e){this._map.fire(new Lr(e.type,this._map,e))},Br.prototype.touchend=function(e){this._map.fire(new Lr(e.type,this._map,e))},Br.prototype.touchcancel=function(e){this._map.fire(new Lr(e.type,this._map,e))},Br.prototype._firePreventable=function(e){if(this._map.fire(e),e.defaultPrevented)return{}},Br.prototype.isEnabled=function(){return!0},Br.prototype.isActive=function(){return!1},Br.prototype.enable=function(){},Br.prototype.disable=function(){};var Fr=function(e){this._map=e};Fr.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Fr.prototype.mousemove=function(e){this._map.fire(new kr(e.type,this._map,e))},Fr.prototype.mousedown=function(){this._delayContextMenu=!0},Fr.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new kr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Fr.prototype.contextmenu=function(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new kr(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()},Fr.prototype.isEnabled=function(){return!0},Fr.prototype.isActive=function(){return!1},Fr.prototype.enable=function(){},Fr.prototype.disable=function(){};var Or=function(e,t){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1};function Nr(e,t){for(var i={},r=0;r<e.length;r++)i[e[r].identifier]=t[r];return i}Or.prototype.isEnabled=function(){return!!this._enabled},Or.prototype.isActive=function(){return!!this._active},Or.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Or.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Or.prototype.mousedown=function(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(i.disableDrag(),this._startPos=this._lastPos=t,this._active=!0)},Or.prototype.mousemoveWindow=function(e,t){if(this._active){var r=t;if(!(this._lastPos.equals(r)||!this._box&&r.dist(this._startPos)<this._clickTolerance)){var n=this._startPos;this._lastPos=r,this._box||(this._box=i.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));var a=Math.min(n.x,r.x),o=Math.max(n.x,r.x),s=Math.min(n.y,r.y),l=Math.max(n.y,r.y);i.setTransform(this._box,"translate("+a+"px,"+s+"px)"),this._box.style.width=o-a+"px",this._box.style.height=l-s+"px"}}},Or.prototype.mouseupWindow=function(t,r){var n=this;if(this._active&&0===t.button){var a=this._startPos,o=r;if(this.reset(),i.suppressClick(),a.x!==o.x||a.y!==o.y)return this._map.fire(new e.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:function(e){return e.fitScreenCoordinates(a,o,n._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",t)}},Or.prototype.keydown=function(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))},Or.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(i.remove(this._box),this._box=null),i.enableDrag(),delete this._startPos,delete this._lastPos},Or.prototype._fireEvent=function(t,i){return this._map.fire(new e.Event(t,{originalEvent:i}))};var Vr=function(e){this.reset(),this.numTouches=e.numTouches};Vr.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Vr.prototype.touchstart=function(t,i,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=t.timeStamp),r.length===this.numTouches&&(this.centroid=function(t){for(var i=new e.Point(0,0),r=0,n=t;r<n.length;r+=1)i._add(n[r]);return i.div(t.length)}(i),this.touches=Nr(r,i)))},Vr.prototype.touchmove=function(e,t,i){if(!this.aborted&&this.centroid){var r=Nr(i,t);for(var n in this.touches){var a=r[n];(!a||a.dist(this.touches[n])>30)&&(this.aborted=!0)}}},Vr.prototype.touchend=function(e,t,i){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===i.length){var r=!this.aborted&&this.centroid;if(this.reset(),r)return r}};var Ur=function(e){this.singleTap=new Vr(e),this.numTaps=e.numTaps,this.reset()};Ur.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Ur.prototype.touchstart=function(e,t,i){this.singleTap.touchstart(e,t,i)},Ur.prototype.touchmove=function(e,t,i){this.singleTap.touchmove(e,t,i)},Ur.prototype.touchend=function(e,t,i){var r=this.singleTap.touchend(e,t,i);if(r){var n=e.timeStamp-this.lastTime<500,a=!this.lastTap||this.lastTap.dist(r)<30;if(n&&a||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}};var $r=function(){this._zoomIn=new Ur({numTouches:1,numTaps:2}),this._zoomOut=new Ur({numTouches:2,numTaps:1}),this.reset()};$r.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},$r.prototype.touchstart=function(e,t,i){this._zoomIn.touchstart(e,t,i),this._zoomOut.touchstart(e,t,i)},$r.prototype.touchmove=function(e,t,i){this._zoomIn.touchmove(e,t,i),this._zoomOut.touchmove(e,t,i)},$r.prototype.touchend=function(e,t,i){var r=this,n=this._zoomIn.touchend(e,t,i),a=this._zoomOut.touchend(e,t,i);return n?(this._active=!0,e.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(t){return t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(n)},{originalEvent:e})}}):a?(this._active=!0,e.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(t){return t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(a)},{originalEvent:e})}}):void 0},$r.prototype.touchcancel=function(){this.reset()},$r.prototype.enable=function(){this._enabled=!0},$r.prototype.disable=function(){this._enabled=!1,this.reset()},$r.prototype.isEnabled=function(){return this._enabled},$r.prototype.isActive=function(){return this._active};var jr={0:1,2:2},qr=function(e){this.reset(),this._clickTolerance=e.clickTolerance||1};qr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},qr.prototype._correctButton=function(e,t){return!1},qr.prototype._move=function(e,t){return{}},qr.prototype.mousedown=function(e,t){if(!this._lastPoint){var r=i.mouseButton(e);this._correctButton(e,r)&&(this._lastPoint=t,this._eventButton=r)}},qr.prototype.mousemoveWindow=function(e,t){var i=this._lastPoint;if(i)if(e.preventDefault(),function(e,t){var i=jr[t];return void 0===e.buttons||(e.buttons&i)!==i}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(i,t)},qr.prototype.mouseupWindow=function(e){this._lastPoint&&i.mouseButton(e)===this._eventButton&&(this._moved&&i.suppressClick(),this.reset())},qr.prototype.enable=function(){this._enabled=!0},qr.prototype.disable=function(){this._enabled=!1,this.reset()},qr.prototype.isEnabled=function(){return this._enabled},qr.prototype.isActive=function(){return this._active};var Gr=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.mousedown=function(t,i){e.prototype.mousedown.call(this,t,i),this._lastPoint&&(this._active=!0)},t.prototype._correctButton=function(e,t){return 0===t&&!e.ctrlKey},t.prototype._move=function(e,t){return{around:t,panDelta:t.sub(e)}},t}(qr),Hr=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._correctButton=function(e,t){return 0===t&&e.ctrlKey||2===t},t.prototype._move=function(e,t){var i=.8*(t.x-e.x);if(i)return this._active=!0,{bearingDelta:i}},t.prototype.contextmenu=function(e){e.preventDefault()},t}(qr),Wr=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._correctButton=function(e,t){return 0===t&&e.ctrlKey||2===t},t.prototype._move=function(e,t){var i=-.5*(t.y-e.y);if(i)return this._active=!0,{pitchDelta:i}},t.prototype.contextmenu=function(e){e.preventDefault()},t}(qr),Zr=function(e){this._minTouches=1,this._clickTolerance=e.clickTolerance||1,this.reset()};Zr.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new e.Point(0,0)},Zr.prototype.touchstart=function(e,t,i){return this._calculateTransform(e,t,i)},Zr.prototype.touchmove=function(e,t,i){if(this._active&&!(i.length<this._minTouches))return e.preventDefault(),this._calculateTransform(e,t,i)},Zr.prototype.touchend=function(e,t,i){this._calculateTransform(e,t,i),this._active&&i.length<this._minTouches&&this.reset()},Zr.prototype.touchcancel=function(){this.reset()},Zr.prototype._calculateTransform=function(t,i,r){r.length>0&&(this._active=!0);var n=Nr(r,i),a=new e.Point(0,0),o=new e.Point(0,0),s=0;for(var l in n){var c=n[l],u=this._touches[l];u&&(a._add(c),o._add(c.sub(u)),s++,n[l]=c)}if(this._touches=n,!(s<this._minTouches)&&o.mag()){var h=o.div(s);if(this._sum._add(h),!(this._sum.mag()<this._clickTolerance))return{around:a.div(s),panDelta:h}}},Zr.prototype.enable=function(){this._enabled=!0},Zr.prototype.disable=function(){this._enabled=!1,this.reset()},Zr.prototype.isEnabled=function(){return this._enabled},Zr.prototype.isActive=function(){return this._active};var Xr=function(){this.reset()};function Yr(e,t,i){for(var r=0;r<e.length;r++)if(e[r].identifier===i)return t[r]}function Kr(e,t){return Math.log(e/t)/Math.LN2}Xr.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Xr.prototype._start=function(e){},Xr.prototype._move=function(e,t,i){return{}},Xr.prototype.touchstart=function(e,t,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([t[0],t[1]]))},Xr.prototype.touchmove=function(e,t,i){if(this._firstTwoTouches){e.preventDefault();var r=this._firstTwoTouches,n=r[1],a=Yr(i,t,r[0]),o=Yr(i,t,n);if(a&&o){var s=this._aroundCenter?null:a.add(o).div(2);return this._move([a,o],s,e)}}},Xr.prototype.touchend=function(e,t,r){if(this._firstTwoTouches){var n=this._firstTwoTouches,a=n[1],o=Yr(r,t,n[0]),s=Yr(r,t,a);o&&s||(this._active&&i.suppressClick(),this.reset())}},Xr.prototype.touchcancel=function(){this.reset()},Xr.prototype.enable=function(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around},Xr.prototype.disable=function(){this._enabled=!1,this.reset()},Xr.prototype.isEnabled=function(){return this._enabled},Xr.prototype.isActive=function(){return this._active};var Jr=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.reset=function(){e.prototype.reset.call(this),delete this._distance,delete this._startDistance},t.prototype._start=function(e){this._startDistance=this._distance=e[0].dist(e[1])},t.prototype._move=function(e,t){var i=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Kr(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Kr(this._distance,i),pinchAround:t}},t}(Xr);function Qr(e,t){return 180*e.angleWith(t)/Math.PI}var en=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.reset=function(){e.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},t.prototype._start=function(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])},t.prototype._move=function(e,t){var i=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Qr(this._vector,i),pinchAround:t}},t.prototype._isBelowThreshold=function(e){this._minDiameter=Math.min(this._minDiameter,e.mag());var t=25/(Math.PI*this._minDiameter)*360,i=Qr(e,this._startVector);return Math.abs(i)<t},t}(Xr);function tn(e){return Math.abs(e.y)>Math.abs(e.x)}var rn=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.reset=function(){e.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},t.prototype._start=function(e){this._lastPoints=e,tn(e[0].sub(e[1]))&&(this._valid=!1)},t.prototype._move=function(e,t,i){var r=e[0].sub(this._lastPoints[0]),n=e[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(r,n,i.timeStamp),this._valid)return this._lastPoints=e,this._active=!0,{pitchDelta:(r.y+n.y)/2*-.5}},t.prototype.gestureBeginsVertically=function(e,t,i){if(void 0!==this._valid)return this._valid;var r=e.mag()>=2,n=t.mag()>=2;if(r||n){if(!r||!n)return void 0===this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;var a=e.y>0==t.y>0;return tn(e)&&tn(t)&&a}},t}(Xr),nn={panStep:100,bearingStep:15,pitchStep:10},an=function(){var e=nn;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1};function on(e){return e*(2-e)}an.prototype.reset=function(){this._active=!1},an.prototype.keydown=function(e){var t=this;if(!(e.altKey||e.ctrlKey||e.metaKey)){var i=0,r=0,n=0,a=0,o=0;switch(e.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:e.shiftKey?r=-1:(e.preventDefault(),a=-1);break;case 39:e.shiftKey?r=1:(e.preventDefault(),a=1);break;case 38:e.shiftKey?n=1:(e.preventDefault(),o=-1);break;case 40:e.shiftKey?n=-1:(e.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(r=0,n=0),{cameraAnimation:function(s){var l=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:on,zoom:i?Math.round(l)+i*(e.shiftKey?2:1):l,bearing:s.getBearing()+r*t._bearingStep,pitch:s.getPitch()+n*t._pitchStep,offset:[-a*t._panStep,-o*t._panStep],center:s.getCenter()},{originalEvent:e})}}}},an.prototype.enable=function(){this._enabled=!0},an.prototype.disable=function(){this._enabled=!1,this.reset()},an.prototype.isEnabled=function(){return this._enabled},an.prototype.isActive=function(){return this._active},an.prototype.disableRotation=function(){this._rotationDisabled=!0},an.prototype.enableRotation=function(){this._rotationDisabled=!1};var sn=function(t,i){this._map=t,this._el=t.getCanvasContainer(),this._handler=i,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,e.bindAll(["_onTimeout"],this)};sn.prototype.setZoomRate=function(e){this._defaultZoomRate=e},sn.prototype.setWheelZoomRate=function(e){this._wheelZoomRate=e},sn.prototype.isEnabled=function(){return!!this._enabled},sn.prototype.isActive=function(){return!!this._active||void 0!==this._finishTimeout},sn.prototype.isZooming=function(){return!!this._zooming},sn.prototype.enable=function(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=e&&"center"===e.around)},sn.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},sn.prototype.wheel=function(t){if(this.isEnabled()){var i=t.deltaMode===e.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY,r=e.browser.now(),n=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,0!==i&&i%4.000244140625==0?this._type="wheel":0!==i&&Math.abs(i)<4?this._type="trackpad":n>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(n*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),t.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=t,this._delta-=i,this._active||this._start(t)),t.preventDefault()}},sn.prototype._onTimeout=function(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)},sn.prototype._start=function(t){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var r=i.mousePos(this._el,t);this._around=e.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(r)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},sn.prototype.renderFrame=function(){var t=this;if(this._frameId&&(this._frameId=null,this.isActive())){var i=this._map.transform;if(0!==this._delta){var r="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,n=2/(1+Math.exp(-Math.abs(this._delta*r)));this._delta<0&&0!==n&&(n=1/n);var a="number"==typeof this._targetZoom?i.zoomScale(this._targetZoom):i.scale;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(a*n))),"wheel"===this._type&&(this._startZoom=i.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var o,s="number"==typeof this._targetZoom?this._targetZoom:i.zoom,l=this._startZoom,c=this._easing,u=!1;if("wheel"===this._type&&l&&c){var h=Math.min((e.browser.now()-this._lastWheelEventTime)/200,1),p=c(h);o=e.number(l,s,p),h<1?this._frameId||(this._frameId=!0):u=!0}else o=s,u=!0;return this._active=!0,u&&(this._active=!1,this._finishTimeout=setTimeout((function(){t._zooming=!1,t._handler._triggerRenderFrame(),delete t._targetZoom,delete t._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!u,zoomDelta:o-i.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},sn.prototype._smoothOutEasing=function(t){var i=e.ease;if(this._prevEase){var r=this._prevEase,n=(e.browser.now()-r.start)/r.duration,a=r.easing(n+.01)-r.easing(n),o=.27/Math.sqrt(a*a+1e-4)*.01,s=Math.sqrt(.0729-o*o);i=e.bezier(o,s,.25,1)}return this._prevEase={start:e.browser.now(),duration:t,easing:i},i},sn.prototype.reset=function(){this._active=!1};var ln=function(e,t){this._clickZoom=e,this._tapZoom=t};ln.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},ln.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},ln.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},ln.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var cn=function(){this.reset()};cn.prototype.reset=function(){this._active=!1},cn.prototype.dblclick=function(e,t){return e.preventDefault(),{cameraAnimation:function(i){i.easeTo({duration:300,zoom:i.getZoom()+(e.shiftKey?-1:1),around:i.unproject(t)},{originalEvent:e})}}},cn.prototype.enable=function(){this._enabled=!0},cn.prototype.disable=function(){this._enabled=!1,this.reset()},cn.prototype.isEnabled=function(){return this._enabled},cn.prototype.isActive=function(){return this._active};var un=function(){this._tap=new Ur({numTouches:1,numTaps:1}),this.reset()};un.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},un.prototype.touchstart=function(e,t,i){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?i.length>0&&(this._swipePoint=t[0],this._swipeTouch=i[0].identifier):this._tap.touchstart(e,t,i))},un.prototype.touchmove=function(e,t,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;var r=t[0],n=r.y-this._swipePoint.y;return this._swipePoint=r,e.preventDefault(),this._active=!0,{zoomDelta:n/128}}}else this._tap.touchmove(e,t,i)},un.prototype.touchend=function(e,t,i){this._tapTime?this._swipePoint&&0===i.length&&this.reset():this._tap.touchend(e,t,i)&&(this._tapTime=e.timeStamp)},un.prototype.touchcancel=function(){this.reset()},un.prototype.enable=function(){this._enabled=!0},un.prototype.disable=function(){this._enabled=!1,this.reset()},un.prototype.isEnabled=function(){return this._enabled},un.prototype.isActive=function(){return this._active};var hn=function(e,t,i){this._el=e,this._mousePan=t,this._touchPan=i};hn.prototype.enable=function(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},hn.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},hn.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},hn.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var pn=function(e,t,i){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=i};pn.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},pn.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},pn.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},pn.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var dn=function(e,t,i,r){this._el=e,this._touchZoom=t,this._touchRotate=i,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0};dn.prototype.enable=function(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},dn.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},dn.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},dn.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},dn.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},dn.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var fn=function(e){return e.zoom||e.drag||e.pitch||e.rotate},mn=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(e.Event);function gn(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}var _n=function(t,r){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Pr(t),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r),e.bindAll(["handleEvent","handleWindowEvent"],this);var n=this._el;this._listeners=[[n,"touchstart",{passive:!0}],[n,"touchmove",{passive:!1}],[n,"touchend",void 0],[n,"touchcancel",void 0],[n,"mousedown",void 0],[n,"mousemove",void 0],[n,"mouseup",void 0],[e.window.document,"mousemove",{capture:!0}],[e.window.document,"mouseup",void 0],[n,"mouseover",void 0],[n,"mouseout",void 0],[n,"dblclick",void 0],[n,"click",void 0],[n,"keydown",{capture:!1}],[n,"keyup",void 0],[n,"wheel",{passive:!1}],[n,"contextmenu",void 0],[e.window,"blur",void 0]];for(var a=0,o=this._listeners;a<o.length;a+=1){var s=o[a],l=s[0];i.addEventListener(l,s[1],l===e.window.document?this.handleWindowEvent:this.handleEvent,s[2])}};_n.prototype.destroy=function(){for(var t=0,r=this._listeners;t<r.length;t+=1){var n=r[t],a=n[0];i.removeEventListener(a,n[1],a===e.window.document?this.handleWindowEvent:this.handleEvent,n[2])}},_n.prototype._addDefaultHandlers=function(e){var t=this._map,i=t.getCanvasContainer();this._add("mapEvent",new Br(t,e));var r=t.boxZoom=new Or(t,e);this._add("boxZoom",r);var n=new $r,a=new cn;t.doubleClickZoom=new ln(a,n),this._add("tapZoom",n),this._add("clickZoom",a);var o=new un;this._add("tapDragZoom",o);var s=t.touchPitch=new rn;this._add("touchPitch",s);var l=new Hr(e),c=new Wr(e);t.dragRotate=new pn(e,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);var u=new Gr(e),h=new Zr(e);t.dragPan=new hn(i,u,h),this._add("mousePan",u),this._add("touchPan",h,["touchZoom","touchRotate"]);var p=new en,d=new Jr;t.touchZoomRotate=new dn(i,d,p,o),this._add("touchRotate",p,["touchPan","touchZoom"]),this._add("touchZoom",d,["touchPan","touchRotate"]);var f=t.scrollZoom=new sn(t,this);this._add("scrollZoom",f,["mousePan"]);var m=t.keyboard=new an;this._add("keyboard",m),this._add("blockableMapEvent",new Fr(t));for(var g=0,_=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];g<_.length;g+=1){var y=_[g];e.interactive&&e[y]&&t[y].enable(e[y])}},_n.prototype._add=function(e,t,i){this._handlers.push({handlerName:e,handler:t,allowed:i}),this._handlersById[e]=t},_n.prototype.stop=function(e){if(!this._updatingCamera){for(var t=0,i=this._handlers;t<i.length;t+=1)i[t].handler.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}},_n.prototype.isActive=function(){for(var e=0,t=this._handlers;e<t.length;e+=1)if(t[e].handler.isActive())return!0;return!1},_n.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},_n.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},_n.prototype.isMoving=function(){return Boolean(fn(this._eventsInProgress))||this.isZooming()},_n.prototype._blockedByActive=function(e,t,i){for(var r in e)if(r!==i&&(!t||t.indexOf(r)<0))return!0;return!1},_n.prototype.handleWindowEvent=function(e){this.handleEvent(e,e.type+"Window")},_n.prototype._getMapTouches=function(e){for(var t=[],i=0,r=e;i<r.length;i+=1){var n=r[i];this._el.contains(n.target)&&t.push(n)}return t},_n.prototype.handleEvent=function(e,t){if("blur"!==e.type){this._updatingCamera=!0;for(var r="renderFrame"===e.type?void 0:e,n={needsRenderFrame:!1},a={},o={},s=e.touches?this._getMapTouches(e.touches):void 0,l=s?i.touchPos(this._el,s):i.mousePos(this._el,e),c=0,u=this._handlers;c<u.length;c+=1){var h=u[c],p=h.handlerName,d=h.handler,f=h.allowed;if(d.isEnabled()){var m=void 0;this._blockedByActive(o,f,p)?d.reset():d[t||e.type]&&(m=d[t||e.type](e,l,s),this.mergeHandlerResult(n,a,m,p,r),m&&m.needsRenderFrame&&this._triggerRenderFrame()),(m||d.isActive())&&(o[p]=d)}}var g={};for(var _ in this._previousActiveHandlers)o[_]||(g[_]=r);this._previousActiveHandlers=o,(Object.keys(g).length||gn(n))&&(this._changes.push([n,a,g]),this._triggerRenderFrame()),(Object.keys(o).length||gn(n))&&this._map._stop(!0),this._updatingCamera=!1;var y=n.cameraAnimation;y&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],y(this._map))}else this.stop(!0)},_n.prototype.mergeHandlerResult=function(t,i,r,n,a){if(r){e.extend(t,r);var o={handlerName:n,originalEvent:r.originalEvent||a};void 0!==r.zoomDelta&&(i.zoom=o),void 0!==r.panDelta&&(i.drag=o),void 0!==r.pitchDelta&&(i.pitch=o),void 0!==r.bearingDelta&&(i.rotate=o)}},_n.prototype._applyChanges=function(){for(var t={},i={},r={},n=0,a=this._changes;n<a.length;n+=1){var o=a[n],s=o[0],l=o[1],c=o[2];s.panDelta&&(t.panDelta=(t.panDelta||new e.Point(0,0))._add(s.panDelta)),s.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+s.zoomDelta),s.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+s.bearingDelta),s.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+s.pitchDelta),void 0!==s.around&&(t.around=s.around),void 0!==s.pinchAround&&(t.pinchAround=s.pinchAround),s.noInertia&&(t.noInertia=s.noInertia),e.extend(i,l),e.extend(r,c)}this._updateMapTransform(t,i,r),this._changes=[]},_n.prototype._updateMapTransform=function(e,t,i){var r=this._map,n=r.transform;if(!gn(e))return this._fireEvents(t,i,!0);var a=e.panDelta,o=e.zoomDelta,s=e.bearingDelta,l=e.pitchDelta,c=e.around,u=e.pinchAround;void 0!==u&&(c=u),r._stop(!0),c=c||r.transform.centerPoint;var h=n.pointLocation(a?c.sub(a):c);s&&(n.bearing+=s),l&&(n.pitch+=l),o&&(n.zoom+=o),n.setLocationAtPoint(h,c),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(t,i,!0)},_n.prototype._fireEvents=function(t,i,r){var n=this,a=fn(this._eventsInProgress),o=fn(t),s={};for(var l in t)this._eventsInProgress[l]||(s[l+"start"]=t[l].originalEvent),this._eventsInProgress[l]=t[l];for(var c in!a&&o&&this._fireEvent("movestart",o.originalEvent),s)this._fireEvent(c,s[c]);for(var u in o&&this._fireEvent("move",o.originalEvent),t)this._fireEvent(u,t[u].originalEvent);var h,p={};for(var d in this._eventsInProgress){var f=this._eventsInProgress[d],m=f.handlerName,g=f.originalEvent;this._handlersById[m].isActive()||(delete this._eventsInProgress[d],p[d+"end"]=h=i[m]||g)}for(var _ in p)this._fireEvent(_,p[_]);var y=fn(this._eventsInProgress);if(r&&(a||o)&&!y){this._updatingCamera=!0;var v=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),x=function(e){return 0!==e&&-n._bearingSnap<e&&e<n._bearingSnap};v?(x(v.bearing||this._map.getBearing())&&(v.bearing=0),this._map.easeTo(v,{originalEvent:h})):(this._map.fire(new e.Event("moveend",{originalEvent:h})),x(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},_n.prototype._fireEvent=function(t,i){this._map.fire(new e.Event(t,i?{originalEvent:i}:{}))},_n.prototype._requestFrame=function(){var e=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add((function(t){delete e._frameId,e.handleEvent(new mn("renderFrame",{timeStamp:t})),e._applyChanges()}))},_n.prototype._triggerRenderFrame=function(){void 0===this._frameId&&(this._frameId=this._requestFrame())};var yn=function(t){function i(i,r){t.call(this),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=r.bearingSnap,e.bindAll(["_renderFrameCallback"],this)}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.getCenter=function(){return new e.LngLat(this.transform.center.lng,this.transform.center.lat)},i.prototype.setCenter=function(e,t){return this.jumpTo({center:e},t)},i.prototype.panBy=function(t,i,r){return t=e.Point.convert(t).mult(-1),this.panTo(this.transform.center,e.extend({offset:t},i),r)},i.prototype.panTo=function(t,i,r){return this.easeTo(e.extend({center:t},i),r)},i.prototype.getZoom=function(){return this.transform.zoom},i.prototype.setZoom=function(e,t){return this.jumpTo({zoom:e},t),this},i.prototype.zoomTo=function(t,i,r){return this.easeTo(e.extend({zoom:t},i),r)},i.prototype.zoomIn=function(e,t){return this.zoomTo(this.getZoom()+1,e,t),this},i.prototype.zoomOut=function(e,t){return this.zoomTo(this.getZoom()-1,e,t),this},i.prototype.getBearing=function(){return this.transform.bearing},i.prototype.setBearing=function(e,t){return this.jumpTo({bearing:e},t),this},i.prototype.getPadding=function(){return this.transform.padding},i.prototype.setPadding=function(e,t){return this.jumpTo({padding:e},t),this},i.prototype.rotateTo=function(t,i,r){return this.easeTo(e.extend({bearing:t},i),r)},i.prototype.resetNorth=function(t,i){return this.rotateTo(0,e.extend({duration:1e3},t),i),this},i.prototype.resetNorthPitch=function(t,i){return this.easeTo(e.extend({bearing:0,pitch:0,duration:1e3},t),i),this},i.prototype.snapToNorth=function(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this},i.prototype.getPitch=function(){return this.transform.pitch},i.prototype.setPitch=function(e,t){return this.jumpTo({pitch:e},t),this},i.prototype.cameraForBounds=function(t,i){t=e.LngLatBounds.convert(t);var r=i&&i.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),r,i)},i.prototype._cameraForBoxAndBearing=function(t,i,r,n){var a={top:0,bottom:0,right:0,left:0};if("number"==typeof(n=e.extend({padding:a,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding){var o=n.padding;n.padding={top:o,bottom:o,right:o,left:o}}n.padding=e.extend(a,n.padding);var s=this.transform,l=s.padding,c=s.project(e.LngLat.convert(t)),u=s.project(e.LngLat.convert(i)),h=c.rotate(-r*Math.PI/180),p=u.rotate(-r*Math.PI/180),d=new e.Point(Math.max(h.x,p.x),Math.max(h.y,p.y)),f=new e.Point(Math.min(h.x,p.x),Math.min(h.y,p.y)),m=d.sub(f),g=(s.width-(l.left+l.right+n.padding.left+n.padding.right))/m.x,_=(s.height-(l.top+l.bottom+n.padding.top+n.padding.bottom))/m.y;if(!(_<0||g<0)){var y=Math.min(s.scaleZoom(s.scale*Math.min(g,_)),n.maxZoom),v="number"==typeof n.offset.x?new e.Point(n.offset.x,n.offset.y):e.Point.convert(n.offset),x=new e.Point((n.padding.left-n.padding.right)/2,(n.padding.top-n.padding.bottom)/2).rotate(r*Math.PI/180),b=v.add(x).mult(s.scale/s.zoomScale(y));return{center:s.unproject(c.add(u).div(2).sub(b)),zoom:y,bearing:r}}e.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},i.prototype.fitBounds=function(e,t,i){return this._fitInternal(this.cameraForBounds(e,t),t,i)},i.prototype.fitScreenCoordinates=function(t,i,r,n,a){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(e.Point.convert(t)),this.transform.pointLocation(e.Point.convert(i)),r,n),n,a)},i.prototype._fitInternal=function(t,i,r){return t?(delete(i=e.extend(t,i)).padding,i.linear?this.easeTo(i,r):this.flyTo(i,r)):this},i.prototype.jumpTo=function(t,i){this.stop();var r=this.transform,n=!1,a=!1,o=!1;return"zoom"in t&&r.zoom!==+t.zoom&&(n=!0,r.zoom=+t.zoom),void 0!==t.center&&(r.center=e.LngLat.convert(t.center)),"bearing"in t&&r.bearing!==+t.bearing&&(a=!0,r.bearing=+t.bearing),"pitch"in t&&r.pitch!==+t.pitch&&(o=!0,r.pitch=+t.pitch),null==t.padding||r.isPaddingEqual(t.padding)||(r.padding=t.padding),this.fire(new e.Event("movestart",i)).fire(new e.Event("move",i)),n&&this.fire(new e.Event("zoomstart",i)).fire(new e.Event("zoom",i)).fire(new e.Event("zoomend",i)),a&&this.fire(new e.Event("rotatestart",i)).fire(new e.Event("rotate",i)).fire(new e.Event("rotateend",i)),o&&this.fire(new e.Event("pitchstart",i)).fire(new e.Event("pitch",i)).fire(new e.Event("pitchend",i)),this.fire(new e.Event("moveend",i))},i.prototype.easeTo=function(t,i){var r=this;this._stop(!1,t.easeId),(!1===(t=e.extend({offset:[0,0],duration:500,easing:e.ease},t)).animate||!t.essential&&e.browser.prefersReducedMotion)&&(t.duration=0);var n=this.transform,a=this.getZoom(),o=this.getBearing(),s=this.getPitch(),l=this.getPadding(),c="zoom"in t?+t.zoom:a,u="bearing"in t?this._normalizeBearing(t.bearing,o):o,h="pitch"in t?+t.pitch:s,p="padding"in t?t.padding:n.padding,d=e.Point.convert(t.offset),f=n.centerPoint.add(d),m=n.pointLocation(f),g=e.LngLat.convert(t.center||m);this._normalizeCenter(g);var _,y,v=n.project(m),x=n.project(g).sub(v),b=n.zoomScale(c-a);t.around&&(_=e.LngLat.convert(t.around),y=n.locationPoint(_));var w={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||c!==a,this._rotating=this._rotating||o!==u,this._pitching=this._pitching||h!==s,this._padding=!n.isPaddingEqual(p),this._easeId=t.easeId,this._prepareEase(i,t.noMoveStart,w),this._ease((function(t){if(r._zooming&&(n.zoom=e.number(a,c,t)),r._rotating&&(n.bearing=e.number(o,u,t)),r._pitching&&(n.pitch=e.number(s,h,t)),r._padding&&(n.interpolatePadding(l,p,t),f=n.centerPoint.add(d)),_)n.setLocationAtPoint(_,y);else{var m=n.zoomScale(n.zoom-a),g=c>a?Math.min(2,b):Math.max(.5,b),w=Math.pow(g,1-t),S=n.unproject(v.add(x.mult(t*w)).mult(m));n.setLocationAtPoint(n.renderWorldCopies?S.wrap():S,f)}r._fireMoveEvents(i)}),(function(e){r._afterEase(i,e)}),t),this},i.prototype._prepareEase=function(t,i,r){void 0===r&&(r={}),this._moving=!0,i||r.moving||this.fire(new e.Event("movestart",t)),this._zooming&&!r.zooming&&this.fire(new e.Event("zoomstart",t)),this._rotating&&!r.rotating&&this.fire(new e.Event("rotatestart",t)),this._pitching&&!r.pitching&&this.fire(new e.Event("pitchstart",t))},i.prototype._fireMoveEvents=function(t){this.fire(new e.Event("move",t)),this._zooming&&this.fire(new e.Event("zoom",t)),this._rotating&&this.fire(new e.Event("rotate",t)),this._pitching&&this.fire(new e.Event("pitch",t))},i.prototype._afterEase=function(t,i){if(!this._easeId||!i||this._easeId!==i){delete this._easeId;var r=this._zooming,n=this._rotating,a=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,r&&this.fire(new e.Event("zoomend",t)),n&&this.fire(new e.Event("rotateend",t)),a&&this.fire(new e.Event("pitchend",t)),this.fire(new e.Event("moveend",t))}},i.prototype.flyTo=function(t,i){var r=this;if(!t.essential&&e.browser.prefersReducedMotion){var n=e.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(n,i)}this.stop(),t=e.extend({offset:[0,0],speed:1.2,curve:1.42,easing:e.ease},t);var a=this.transform,o=this.getZoom(),s=this.getBearing(),l=this.getPitch(),c=this.getPadding(),u="zoom"in t?e.clamp(+t.zoom,a.minZoom,a.maxZoom):o,h="bearing"in t?this._normalizeBearing(t.bearing,s):s,p="pitch"in t?+t.pitch:l,d="padding"in t?t.padding:a.padding,f=a.zoomScale(u-o),m=e.Point.convert(t.offset),g=a.centerPoint.add(m),_=a.pointLocation(g),y=e.LngLat.convert(t.center||_);this._normalizeCenter(y);var v=a.project(_),x=a.project(y).sub(v),b=t.curve,w=Math.max(a.width,a.height),S=w/f,M=x.mag();if("minZoom"in t){var T=e.clamp(Math.min(t.minZoom,o,u),a.minZoom,a.maxZoom),E=w/a.zoomScale(T-o);b=Math.sqrt(E/M*2)}var C=b*b;function A(e){var t=(S*S-w*w+(e?-1:1)*C*C*M*M)/(2*(e?S:w)*C*M);return Math.log(Math.sqrt(t*t+1)-t)}function I(e){return(Math.exp(e)-Math.exp(-e))/2}function P(e){return(Math.exp(e)+Math.exp(-e))/2}var z=A(0),R=function(e){return P(z)/P(z+b*e)},k=function(e){return w*((P(z)*(I(t=z+b*e)/P(t))-I(z))/C)/M;var t},L=(A(1)-z)/b;if(Math.abs(M)<1e-6||!isFinite(L)){if(Math.abs(w-S)<1e-6)return this.easeTo(t,i);var D=S<w?-1:1;L=Math.abs(Math.log(S/w))/b,k=function(){return 0},R=function(e){return Math.exp(D*b*e)}}return t.duration="duration"in t?+t.duration:1e3*L/("screenSpeed"in t?+t.screenSpeed/b:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=s!==h,this._pitching=p!==l,this._padding=!a.isPaddingEqual(d),this._prepareEase(i,!1),this._ease((function(t){var n=t*L,f=1/R(n);a.zoom=1===t?u:o+a.scaleZoom(f),r._rotating&&(a.bearing=e.number(s,h,t)),r._pitching&&(a.pitch=e.number(l,p,t)),r._padding&&(a.interpolatePadding(c,d,t),g=a.centerPoint.add(m));var _=1===t?y:a.unproject(v.add(x.mult(k(n))).mult(f));a.setLocationAtPoint(a.renderWorldCopies?_.wrap():_,g),r._fireMoveEvents(i)}),(function(){return r._afterEase(i)}),t),this},i.prototype.isEasing=function(){return!!this._easeFrameId},i.prototype.stop=function(){return this._stop()},i.prototype._stop=function(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var i=this._onEaseEnd;delete this._onEaseEnd,i.call(this,t)}if(!e){var r=this.handlers;r&&r.stop(!1)}return this},i.prototype._ease=function(t,i,r){!1===r.animate||0===r.duration?(t(1),i()):(this._easeStart=e.browser.now(),this._easeOptions=r,this._onEaseFrame=t,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},i.prototype._renderFrameCallback=function(){var t=Math.min((e.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},i.prototype._normalizeBearing=function(t,i){t=e.wrap(t,-180,180);var r=Math.abs(t-i);return Math.abs(t-360-i)<r&&(t-=360),Math.abs(t+360-i)<r&&(t+=360),t},i.prototype._normalizeCenter=function(e){var t=this.transform;if(t.renderWorldCopies&&!t.lngRange){var i=e.lng-t.center.lng;e.lng+=i>180?-360:i<-180?360:0}},i}(e.Evented),vn=function(t){void 0===t&&(t={}),this.options=t,e.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};vn.prototype.getDefaultPosition=function(){return"bottom-right"},vn.prototype.onAdd=function(e){var t=this.options&&this.options.compact;return this._map=e,this._container=i.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=i.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=i.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),t&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},vn.prototype.onRemove=function(){i.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},vn.prototype._setElementTitle=function(e,t){var i=this._map._getUIString("AttributionControl."+t);e.title=i,e.setAttribute("aria-label",i)},vn.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},vn.prototype._updateEditLink=function(){var t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));var i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||e.config.ACCESS_TOKEN}];if(t){var r=i.reduce((function(e,t,r){return t.value&&(e+=t.key+"="+t.value+(r<i.length-1?"&":"")),e}),"?");t.href=e.config.FEEDBACK_URL+"/"+r+(this._map._hash?this._map._hash.getHashString(!0):""),t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}},vn.prototype._updateData=function(e){!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink())},vn.prototype._updateAttributions=function(){if(this._map.style){var e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((function(e){return"string"!=typeof e?"":e}))):"string"==typeof this.options.customAttribution&&e.push(this.options.customAttribution)),this._map.style.stylesheet){var t=this._map.style.stylesheet;this.styleOwner=t.owner,this.styleId=t.id}var i=this._map.style.sourceCaches;for(var r in i){var n=i[r];if(n.used){var a=n.getSource();a.attribution&&e.indexOf(a.attribution)<0&&e.push(a.attribution)}}e.sort((function(e,t){return e.length-t.length}));var o=(e=e.filter((function(t,i){for(var r=i+1;r<e.length;r++)if(e[r].indexOf(t)>=0)return!1;return!0}))).join(" | ");o!==this._attribHTML&&(this._attribHTML=o,e.length?(this._innerContainer.innerHTML=o,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},vn.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var xn=function(){e.bindAll(["_updateLogo"],this),e.bindAll(["_updateCompact"],this)};xn.prototype.onAdd=function(e){this._map=e,this._container=i.create("div","mapboxgl-ctrl");var t=i.create("a","mapboxgl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://www.mapbox.com/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},xn.prototype.onRemove=function(){i.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},xn.prototype.getDefaultPosition=function(){return"bottom-left"},xn.prototype._updateLogo=function(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")},xn.prototype._logoRequired=function(){if(this._map.style){var e=this._map.style.sourceCaches;for(var t in e)if(e[t].getSource().mapbox_logo)return!0;return!1}},xn.prototype._updateCompact=function(){var e=this._container.children;if(e.length){var t=e[0];this._map.getCanvasContainer().offsetWidth<250?t.classList.add("mapboxgl-compact"):t.classList.remove("mapboxgl-compact")}};var bn=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};bn.prototype.add=function(e){var t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t},bn.prototype.remove=function(e){for(var t=this._currentlyRunning,i=0,r=t?this._queue.concat(t):this._queue;i<r.length;i+=1){var n=r[i];if(n.id===e)return void(n.cancelled=!0)}},bn.prototype.run=function(e){void 0===e&&(e=0);var t=this._currentlyRunning=this._queue;this._queue=[];for(var i=0,r=t;i<r.length;i+=1){var n=r[i];if(!n.cancelled&&(n.callback(e),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},bn.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var wn={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Sn=e.window.HTMLImageElement,Mn=e.window.HTMLElement,Tn=e.window.ImageBitmap,En={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Cn=function(r){function n(t){var i=this;if(null!=(t=e.extend({},En,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&t.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var n=new wr(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies);if(r.call(this,n,t),this._interactive=t.interactive,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._crossSourceCollisions=t.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=t.collectResourceTiming,this._renderTaskQueue=new bn,this._controls=[],this._mapId=e.uniqueId(),this._locale=e.extend({},wn,t.locale),this._clickTolerance=t.clickTolerance,this._requestManager=new e.RequestManager(t.transformRequest,t.accessToken),"string"==typeof t.container){if(this._container=e.window.document.getElementById(t.container),!this._container)throw new Error("Container '"+t.container+"' not found.")}else{if(!(t.container instanceof Mn))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(t.maxBounds&&this.setMaxBounds(t.maxBounds),e.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",(function(){return i._update(!1)})),this.on("moveend",(function(){return i._update(!1)})),this.on("zoom",(function(){return i._update(!0)})),void 0!==e.window&&(e.window.addEventListener("online",this._onWindowOnline,!1),e.window.addEventListener("resize",this._onWindowResize,!1),e.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new _n(this,t),this._hash=t.hash&&new Mr("string"==typeof t.hash&&t.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),t.bounds&&(this.resize(),this.fitBounds(t.bounds,e.extend({},t.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=t.localIdeographFontFamily,t.style&&this.setStyle(t.style,{localIdeographFontFamily:t.localIdeographFontFamily}),t.attributionControl&&this.addControl(new vn({customAttribution:t.customAttribution})),this.addControl(new xn,t.logoPosition),this.on("style.load",(function(){i.transform.unmodified&&i.jumpTo(i.style.stylesheet)})),this.on("data",(function(t){i._update("style"===t.dataType),i.fire(new e.Event(t.dataType+"data",t))})),this.on("dataloading",(function(t){i.fire(new e.Event(t.dataType+"dataloading",t))}))}r&&(n.__proto__=r),(n.prototype=Object.create(r&&r.prototype)).constructor=n;var a={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return n.prototype._getMapId=function(){return this._mapId},n.prototype.addControl=function(t,i){if(void 0===i&&(i=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new e.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var r=t.onAdd(this);this._controls.push(t);var n=this._controlPositions[i];return-1!==i.indexOf("bottom")?n.insertBefore(r,n.firstChild):n.appendChild(r),this},n.prototype.removeControl=function(t){if(!t||!t.onRemove)return this.fire(new e.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var i=this._controls.indexOf(t);return i>-1&&this._controls.splice(i,1),t.onRemove(this),this},n.prototype.hasControl=function(e){return this._controls.indexOf(e)>-1},n.prototype.resize=function(t){var i=this._containerDimensions(),r=i[0],n=i[1];this._resizeCanvas(r,n),this.transform.resize(r,n),this.painter.resize(r,n);var a=!this._moving;return a&&(this.stop(),this.fire(new e.Event("movestart",t)).fire(new e.Event("move",t))),this.fire(new e.Event("resize",t)),a&&this.fire(new e.Event("moveend",t)),this},n.prototype.getBounds=function(){return this.transform.getBounds()},n.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},n.prototype.setMaxBounds=function(t){return this.transform.setMaxBounds(e.LngLatBounds.convert(t)),this._update()},n.prototype.setMinZoom=function(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e&&this.setZoom(e),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},n.prototype.getMinZoom=function(){return this.transform.minZoom},n.prototype.setMaxZoom=function(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e&&this.setZoom(e),this;throw new Error("maxZoom must be greater than the current minZoom")},n.prototype.getMaxZoom=function(){return this.transform.maxZoom},n.prototype.setMinPitch=function(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this._update(),this.getPitch()<e&&this.setPitch(e),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},n.prototype.getMinPitch=function(){return this.transform.minPitch},n.prototype.setMaxPitch=function(e){if((e=null==e?60:e)>60)throw new Error("maxPitch must be less than or equal to 60");if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this._update(),this.getPitch()>e&&this.setPitch(e),this;throw new Error("maxPitch must be greater than the current minPitch")},n.prototype.getMaxPitch=function(){return this.transform.maxPitch},n.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},n.prototype.setRenderWorldCopies=function(e){return this.transform.renderWorldCopies=e,this._update()},n.prototype.project=function(t){return this.transform.locationPoint(e.LngLat.convert(t))},n.prototype.unproject=function(t){return this.transform.pointLocation(e.Point.convert(t))},n.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},n.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},n.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},n.prototype._createDelegatedListener=function(e,t,i){var r,n=this;if("mouseenter"===e||"mouseover"===e){var a=!1;return{layer:t,listener:i,delegates:{mousemove:function(r){var o=n.getLayer(t)?n.queryRenderedFeatures(r.point,{layers:[t]}):[];o.length?a||(a=!0,i.call(n,new kr(e,n,r.originalEvent,{features:o}))):a=!1},mouseout:function(){a=!1}}}}if("mouseleave"===e||"mouseout"===e){var o=!1;return{layer:t,listener:i,delegates:{mousemove:function(r){(n.getLayer(t)?n.queryRenderedFeatures(r.point,{layers:[t]}):[]).length?o=!0:o&&(o=!1,i.call(n,new kr(e,n,r.originalEvent)))},mouseout:function(t){o&&(o=!1,i.call(n,new kr(e,n,t.originalEvent)))}}}}return{layer:t,listener:i,delegates:(r={},r[e]=function(e){var r=n.getLayer(t)?n.queryRenderedFeatures(e.point,{layers:[t]}):[];r.length&&(e.features=r,i.call(n,e),delete e.features)},r)}},n.prototype.on=function(e,t,i){if(void 0===i)return r.prototype.on.call(this,e,t);var n=this._createDelegatedListener(e,t,i);for(var a in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(n),n.delegates)this.on(a,n.delegates[a]);return this},n.prototype.once=function(e,t,i){if(void 0===i)return r.prototype.once.call(this,e,t);var n=this._createDelegatedListener(e,t,i);for(var a in n.delegates)this.once(a,n.delegates[a]);return this},n.prototype.off=function(e,t,i){var n=this;return void 0===i?r.prototype.off.call(this,e,t):(this._delegatedListeners&&this._delegatedListeners[e]&&function(r){for(var a=r[e],o=0;o<a.length;o++){var s=a[o];if(s.layer===t&&s.listener===i){for(var l in s.delegates)n.off(l,s.delegates[l]);return a.splice(o,1),n}}}(this._delegatedListeners),this)},n.prototype.queryRenderedFeatures=function(t,i){if(!this.style)return[];var r;if(void 0!==i||void 0===t||t instanceof e.Point||Array.isArray(t)||(i=t,t=void 0),i=i||{},(t=t||[[0,0],[this.transform.width,this.transform.height]])instanceof e.Point||"number"==typeof t[0])r=[e.Point.convert(t)];else{var n=e.Point.convert(t[0]),a=e.Point.convert(t[1]);r=[n,new e.Point(a.x,n.y),a,new e.Point(n.x,a.y),n]}return this.style.queryRenderedFeatures(r,i,this.transform)},n.prototype.querySourceFeatures=function(e,t){return this.style.querySourceFeatures(e,t)},n.prototype.setStyle=function(t,i){return!1!==(i=e.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&t?(this._diffStyle(t,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._updateStyle(t,i))},n.prototype._getUIString=function(e){var t=this._locale[e];if(null==t)throw new Error("Missing UI string '"+e+"'");return t},n.prototype._updateStyle=function(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove()),e?(this.style=new jt(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e):this.style.loadJSON(e),this):(delete this.style,this)},n.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new jt(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},n.prototype._diffStyle=function(t,i){var r=this;if("string"==typeof t){var n=this._requestManager.normalizeStyleURL(t),a=this._requestManager.transformRequest(n,e.ResourceType.Style);e.getJSON(a,(function(t,n){t?r.fire(new e.ErrorEvent(t)):n&&r._updateDiff(n,i)}))}else"object"==typeof t&&this._updateDiff(t,i)},n.prototype._updateDiff=function(t,i){try{this.style.setState(t)&&this._update(!0)}catch(r){e.warnOnce("Unable to perform style diff: "+(r.message||r.error||r)+".  Rebuilding the style from scratch."),this._updateStyle(t,i)}},n.prototype.getStyle=function(){if(this.style)return this.style.serialize()},n.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():e.warnOnce("There is no style added to the map.")},n.prototype.addSource=function(e,t){return this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)},n.prototype.isSourceLoaded=function(t){var i=this.style&&this.style.sourceCaches[t];if(void 0!==i)return i.loaded();this.fire(new e.ErrorEvent(new Error("There is no source with ID '"+t+"'")))},n.prototype.areTilesLoaded=function(){var e=this.style&&this.style.sourceCaches;for(var t in e){var i=e[t]._tiles;for(var r in i){var n=i[r];if("loaded"!==n.state&&"errored"!==n.state)return!1}}return!0},n.prototype.addSourceType=function(e,t,i){return this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,i)},n.prototype.removeSource=function(e){return this.style.removeSource(e),this._update(!0)},n.prototype.getSource=function(e){return this.style.getSource(e)},n.prototype.addImage=function(t,i,r){void 0===r&&(r={});var n=r.pixelRatio;void 0===n&&(n=1);var a=r.sdf;void 0===a&&(a=!1);var o=r.stretchX,s=r.stretchY,l=r.content;if(this._lazyInitEmptyStyle(),i instanceof Sn||Tn&&i instanceof Tn){var c=e.browser.getImageData(i);this.style.addImage(t,{data:new e.RGBAImage({width:c.width,height:c.height},c.data),pixelRatio:n,stretchX:o,stretchY:s,content:l,sdf:a,version:0})}else{if(void 0===i.width||void 0===i.height)return this.fire(new e.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var u=i;this.style.addImage(t,{data:new e.RGBAImage({width:i.width,height:i.height},new Uint8Array(i.data)),pixelRatio:n,stretchX:o,stretchY:s,content:l,sdf:a,version:0,userImage:u}),u.onAdd&&u.onAdd(this,t)}},n.prototype.updateImage=function(t,i){var r=this.style.getImage(t);if(!r)return this.fire(new e.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var n=i instanceof Sn||Tn&&i instanceof Tn?e.browser.getImageData(i):i,a=n.width,o=n.height,s=n.data;return void 0===a||void 0===o?this.fire(new e.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):a!==r.data.width||o!==r.data.height?this.fire(new e.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(r.data.replace(s,!(i instanceof Sn||Tn&&i instanceof Tn)),void this.style.updateImage(t,r))},n.prototype.hasImage=function(t){return t?!!this.style.getImage(t):(this.fire(new e.ErrorEvent(new Error("Missing required image id"))),!1)},n.prototype.removeImage=function(e){this.style.removeImage(e)},n.prototype.loadImage=function(t,i){e.getImage(this._requestManager.transformRequest(t,e.ResourceType.Image),i)},n.prototype.listImages=function(){return this.style.listImages()},n.prototype.addLayer=function(e,t){return this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)},n.prototype.moveLayer=function(e,t){return this.style.moveLayer(e,t),this._update(!0)},n.prototype.removeLayer=function(e){return this.style.removeLayer(e),this._update(!0)},n.prototype.getLayer=function(e){return this.style.getLayer(e)},n.prototype.setLayerZoomRange=function(e,t,i){return this.style.setLayerZoomRange(e,t,i),this._update(!0)},n.prototype.setFilter=function(e,t,i){return void 0===i&&(i={}),this.style.setFilter(e,t,i),this._update(!0)},n.prototype.getFilter=function(e){return this.style.getFilter(e)},n.prototype.setPaintProperty=function(e,t,i,r){return void 0===r&&(r={}),this.style.setPaintProperty(e,t,i,r),this._update(!0)},n.prototype.getPaintProperty=function(e,t){return this.style.getPaintProperty(e,t)},n.prototype.setLayoutProperty=function(e,t,i,r){return void 0===r&&(r={}),this.style.setLayoutProperty(e,t,i,r),this._update(!0)},n.prototype.getLayoutProperty=function(e,t){return this.style.getLayoutProperty(e,t)},n.prototype.setLight=function(e,t){return void 0===t&&(t={}),this._lazyInitEmptyStyle(),this.style.setLight(e,t),this._update(!0)},n.prototype.getLight=function(){return this.style.getLight()},n.prototype.setFeatureState=function(e,t){return this.style.setFeatureState(e,t),this._update()},n.prototype.removeFeatureState=function(e,t){return this.style.removeFeatureState(e,t),this._update()},n.prototype.getFeatureState=function(e){return this.style.getFeatureState(e)},n.prototype.getContainer=function(){return this._container},n.prototype.getCanvasContainer=function(){return this._canvasContainer},n.prototype.getCanvas=function(){return this._canvas},n.prototype._containerDimensions=function(){var e=0,t=0;return this._container&&(e=this._container.clientWidth||400,t=this._container.clientHeight||300),[e,t]},n.prototype._detectMissingCSS=function(){"rgb(250, 128, 114)"!==e.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&e.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},n.prototype._setupContainer=function(){var e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=i.create("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();var t=this._canvasContainer=i.create("div","mapboxgl-canvas-container",e);this._interactive&&t.classList.add("mapboxgl-interactive"),this._canvas=i.create("canvas","mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var r=this._containerDimensions();this._resizeCanvas(r[0],r[1]);var n=this._controlContainer=i.create("div","mapboxgl-control-container",e),a=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((function(e){a[e]=i.create("div","mapboxgl-ctrl-"+e,n)})),this._container.addEventListener("scroll",this._onMapScroll,!1)},n.prototype._resizeCanvas=function(t,i){var r=e.browser.devicePixelRatio||1;this._canvas.width=r*t,this._canvas.height=r*i,this._canvas.style.width=t+"px",this._canvas.style.height=i+"px"},n.prototype._setupPainter=function(){var i=e.extend({},t.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",i)||this._canvas.getContext("experimental-webgl",i);r?(this.painter=new yr(r,this.transform),e.webpSupported.testSupport(r)):this.fire(new e.ErrorEvent(new Error("Failed to initialize WebGL")))},n.prototype._contextLost=function(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new e.Event("webglcontextlost",{originalEvent:t}))},n.prototype._contextRestored=function(t){this._setupPainter(),this.resize(),this._update(),this.fire(new e.Event("webglcontextrestored",{originalEvent:t}))},n.prototype._onMapScroll=function(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},n.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},n.prototype._update=function(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this},n.prototype._requestRenderFrame=function(e){return this._update(),this._renderTaskQueue.add(e)},n.prototype._cancelRenderFrame=function(e){this._renderTaskQueue.remove(e)},n.prototype._render=function(t){var i,r=this,n=0,a=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(i=a.createQueryEXT(),a.beginQueryEXT(a.TIME_ELAPSED_EXT,i),n=e.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(t),!this._removed){var o=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var s=this.transform.zoom,l=e.browser.now();this.style.zoomHistory.update(s,l);var c=new e.EvaluationParameters(s,{now:l,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),u=c.crossFadingFactor();1===u&&u===this._crossFadingFactor||(o=!0,this._crossFadingFactor=u),this.style.update(c)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new e.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new e.Event("load"))),this.style&&(this.style.hasTransitions()||o)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var h=e.browser.now()-n;a.endQueryEXT(a.TIME_ELAPSED_EXT,i),setTimeout((function(){var t=a.getQueryObjectEXT(i,a.QUERY_RESULT_EXT)/1e6;a.deleteQueryEXT(i),r.fire(new e.Event("gpu-timing-frame",{cpuTime:h,gpuTime:t}))}),50)}if(this.listens("gpu-timing-layer")){var p=this.painter.collectGpuTimers();setTimeout((function(){var t=r.painter.queryGpuTimers(p);r.fire(new e.Event("gpu-timing-layer",{layerTimes:t}))}),50)}var d=this._sourcesDirty||this._styleDirty||this._placementDirty;return d||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new e.Event("idle")),!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0),this}},n.prototype.remove=function(){this._hash&&this._hash.remove();for(var t=0,i=this._controls;t<i.length;t+=1)i[t].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==e.window&&(e.window.removeEventListener("resize",this._onWindowResize,!1),e.window.removeEventListener("orientationchange",this._onWindowResize,!1),e.window.removeEventListener("online",this._onWindowOnline,!1));var r=this.painter.context.gl.getExtension("WEBGL_lose_context");r&&r.loseContext(),An(this._canvasContainer),An(this._controlContainer),An(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new e.Event("remove"))},n.prototype.triggerRepaint=function(){var t=this;this.style&&!this._frame&&(this._frame=e.browser.frame((function(e){t._frame=null,t._render(e)})))},n.prototype._onWindowOnline=function(){this._update()},n.prototype._onWindowResize=function(e){this._trackResize&&this.resize({originalEvent:e})._update()},a.showTileBoundaries.get=function(){return!!this._showTileBoundaries},a.showTileBoundaries.set=function(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())},a.showPadding.get=function(){return!!this._showPadding},a.showPadding.set=function(e){this._showPadding!==e&&(this._showPadding=e,this._update())},a.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},a.showCollisionBoxes.set=function(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())},a.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},a.showOverdrawInspector.set=function(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())},a.repaint.get=function(){return!!this._repaint},a.repaint.set=function(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())},a.vertices.get=function(){return!!this._vertices},a.vertices.set=function(e){this._vertices=e,this._update()},n.prototype._setCacheLimits=function(t,i){e.setCacheLimits(t,i)},a.version.get=function(){return e.version},Object.defineProperties(n.prototype,a),n}(yn);function An(e){e.parentNode&&e.parentNode.removeChild(e)}var In={showCompass:!0,showZoom:!0,visualizePitch:!1},Pn=function(t){var r=this;this.options=e.extend({},In,t),this._container=i.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(function(e){return e.preventDefault()})),this.options.showZoom&&(e.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(function(e){return r._map.zoomIn({},{originalEvent:e})})),i.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(function(e){return r._map.zoomOut({},{originalEvent:e})})),i.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(e.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(function(e){r.options.visualizePitch?r._map.resetNorthPitch({},{originalEvent:e}):r._map.resetNorth({},{originalEvent:e})})),this._compassIcon=i.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Pn.prototype._updateZoomButtons=function(){var e=this._map.getZoom(),t=e===this._map.getMaxZoom(),i=e===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=i,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",i.toString())},Pn.prototype._rotateCompassArrow=function(){var e=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=e},Pn.prototype.onAdd=function(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new zn(this._map,this._compass,this.options.visualizePitch)),this._container},Pn.prototype.onRemove=function(){i.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Pn.prototype._createButton=function(e,t){var r=i.create("button",e,this._container);return r.type="button",r.addEventListener("click",t),r},Pn.prototype._setButtonTitle=function(e,t){var i=this._map._getUIString("NavigationControl."+t);e.title=i,e.setAttribute("aria-label",i)};var zn=function(t,r,n){void 0===n&&(n=!1),this._clickTolerance=10,this.element=r,this.mouseRotate=new Hr({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,n&&(this.mousePitch=new Wr({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),e.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),i.addEventListener(r,"mousedown",this.mousedown),i.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),i.addEventListener(r,"touchmove",this.touchmove),i.addEventListener(r,"touchend",this.touchend),i.addEventListener(r,"touchcancel",this.reset)};function Rn(t,i,r){if(t=new e.LngLat(t.lng,t.lat),i){var n=new e.LngLat(t.lng-360,t.lat),a=new e.LngLat(t.lng+360,t.lat),o=r.locationPoint(t).distSqr(i);r.locationPoint(n).distSqr(i)<o?t=n:r.locationPoint(a).distSqr(i)<o&&(t=a)}for(;Math.abs(t.lng-r.center.lng)>180;){var s=r.locationPoint(t);if(s.x>=0&&s.y>=0&&s.x<=r.width&&s.y<=r.height)break;t.lng>r.center.lng?t.lng-=360:t.lng+=360}return t}zn.prototype.down=function(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),i.disableDrag()},zn.prototype.move=function(e,t){var i=this.map,r=this.mouseRotate.mousemoveWindow(e,t);if(r&&r.bearingDelta&&i.setBearing(i.getBearing()+r.bearingDelta),this.mousePitch){var n=this.mousePitch.mousemoveWindow(e,t);n&&n.pitchDelta&&i.setPitch(i.getPitch()+n.pitchDelta)}},zn.prototype.off=function(){var e=this.element;i.removeEventListener(e,"mousedown",this.mousedown),i.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),i.removeEventListener(e,"touchmove",this.touchmove),i.removeEventListener(e,"touchend",this.touchend),i.removeEventListener(e,"touchcancel",this.reset),this.offTemp()},zn.prototype.offTemp=function(){i.enableDrag(),i.removeEventListener(e.window,"mousemove",this.mousemove),i.removeEventListener(e.window,"mouseup",this.mouseup)},zn.prototype.mousedown=function(t){this.down(e.extend({},t,{ctrlKey:!0,preventDefault:function(){return t.preventDefault()}}),i.mousePos(this.element,t)),i.addEventListener(e.window,"mousemove",this.mousemove),i.addEventListener(e.window,"mouseup",this.mouseup)},zn.prototype.mousemove=function(e){this.move(e,i.mousePos(this.element,e))},zn.prototype.mouseup=function(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()},zn.prototype.touchstart=function(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=i.touchPos(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return e.preventDefault()}},this._startPos))},zn.prototype.touchmove=function(e){1!==e.targetTouches.length?this.reset():(this._lastPos=i.touchPos(this.element,e.targetTouches)[0],this.move({preventDefault:function(){return e.preventDefault()}},this._lastPos))},zn.prototype.touchend=function(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},zn.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var kn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ln(e,t,i){var r=e.classList;for(var n in kn)r.remove("mapboxgl-"+i+"-anchor-"+n);r.add("mapboxgl-"+i+"-anchor-"+t)}var Dn,Bn=function(t){function r(r,n){if(t.call(this),(r instanceof e.window.HTMLElement||n)&&(r=e.extend({element:r},n)),e.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&"auto"!==r.pitchAlignment?r.pitchAlignment:this._rotationAlignment,r&&r.element)this._element=r.element,this._offset=e.Point.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=i.create("div"),this._element.setAttribute("aria-label","Map marker");var a=i.createNS("http://www.w3.org/2000/svg","svg");a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height","41px"),a.setAttributeNS(null,"width","27px"),a.setAttributeNS(null,"viewBox","0 0 27 41");var o=i.createNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"stroke","none"),o.setAttributeNS(null,"stroke-width","1"),o.setAttributeNS(null,"fill","none"),o.setAttributeNS(null,"fill-rule","evenodd");var s=i.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"fill-rule","nonzero");var l=i.createNS("http://www.w3.org/2000/svg","g");l.setAttributeNS(null,"transform","translate(3.0, 29.0)"),l.setAttributeNS(null,"fill","#000000");for(var c=0,u=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];c<u.length;c+=1){var h=u[c],p=i.createNS("http://www.w3.org/2000/svg","ellipse");p.setAttributeNS(null,"opacity","0.04"),p.setAttributeNS(null,"cx","10.5"),p.setAttributeNS(null,"cy","5.80029008"),p.setAttributeNS(null,"rx",h.rx),p.setAttributeNS(null,"ry",h.ry),l.appendChild(p)}var d=i.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"fill",this._color);var f=i.createNS("http://www.w3.org/2000/svg","path");f.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),d.appendChild(f);var m=i.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"opacity","0.25"),m.setAttributeNS(null,"fill","#000000");var g=i.createNS("http://www.w3.org/2000/svg","path");g.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),m.appendChild(g);var _=i.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"transform","translate(6.0, 7.0)"),_.setAttributeNS(null,"fill","#FFFFFF");var y=i.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"transform","translate(8.0, 8.0)");var v=i.createNS("http://www.w3.org/2000/svg","circle");v.setAttributeNS(null,"fill","#000000"),v.setAttributeNS(null,"opacity","0.25"),v.setAttributeNS(null,"cx","5.5"),v.setAttributeNS(null,"cy","5.5"),v.setAttributeNS(null,"r","5.4999962");var x=i.createNS("http://www.w3.org/2000/svg","circle");x.setAttributeNS(null,"fill","#FFFFFF"),x.setAttributeNS(null,"cx","5.5"),x.setAttributeNS(null,"cy","5.5"),x.setAttributeNS(null,"r","5.4999962"),y.appendChild(v),y.appendChild(x),s.appendChild(l),s.appendChild(d),s.appendChild(m),s.appendChild(_),s.appendChild(y),a.appendChild(s),a.setAttributeNS(null,"height",41*this._scale+"px"),a.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(a),this._offset=e.Point.convert(r&&r.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(function(e){e.preventDefault()})),this._element.addEventListener("mousedown",(function(e){e.preventDefault()})),Ln(this._element,this._anchor,"marker"),this._popup=null}return t&&(r.__proto__=t),(r.prototype=Object.create(t&&t.prototype)).constructor=r,r.prototype.addTo=function(e){return this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},r.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),i.remove(this._element),this._popup&&this._popup.remove(),this},r.prototype.getLngLat=function(){return this._lngLat},r.prototype.setLngLat=function(t){return this._lngLat=e.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},r.prototype.getElement=function(){return this._element},r.prototype.setPopup=function(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){var t=Math.sqrt(Math.pow(13.5,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[t,-1*(24.6+t)],"bottom-right":[-t,-1*(24.6+t)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=e,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},r.prototype._onKeyPress=function(e){var t=e.code,i=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==i&&13!==i||this.togglePopup()},r.prototype._onMapClick=function(e){var t=e.originalEvent.target,i=this._element;this._popup&&(t===i||i.contains(t))&&this.togglePopup()},r.prototype.getPopup=function(){return this._popup},r.prototype.togglePopup=function(){var e=this._popup;return e?(e.isOpen()?e.remove():e.addTo(this._map),this):this},r.prototype._update=function(e){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Rn(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var t="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?t="rotateZ("+this._rotation+"deg)":"map"===this._rotationAlignment&&(t="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var r="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?r="rotateX(0deg)":"map"===this._pitchAlignment&&(r="rotateX("+this._map.getPitch()+"deg)"),e&&"moveend"!==e.type||(this._pos=this._pos.round()),i.setTransform(this._element,kn[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+r+" "+t)}},r.prototype.getOffset=function(){return this._offset},r.prototype.setOffset=function(t){return this._offset=e.Point.convert(t),this._update(),this},r.prototype._onMove=function(t){if(!this._isDragging){var i=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=i}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.Event("dragstart"))),this.fire(new e.Event("drag")))},r.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new e.Event("dragend")),this._state="inactive"},r.prototype._addDragHandler=function(e){this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(this._pos).add(this._offset),this._pointerdownPos=e.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},r.prototype.setDraggable=function(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},r.prototype.isDraggable=function(){return this._draggable},r.prototype.setRotation=function(e){return this._rotation=e||0,this._update(),this},r.prototype.getRotation=function(){return this._rotation},r.prototype.setRotationAlignment=function(e){return this._rotationAlignment=e||"auto",this._update(),this},r.prototype.getRotationAlignment=function(){return this._rotationAlignment},r.prototype.setPitchAlignment=function(e){return this._pitchAlignment=e&&"auto"!==e?e:this._rotationAlignment,this._update(),this},r.prototype.getPitchAlignment=function(){return this._pitchAlignment},r}(e.Evented),Fn={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},On=0,Nn=!1,Vn=function(t){function r(i){t.call(this),this.options=e.extend({},Fn,i),e.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return t&&(r.__proto__=t),(r.prototype=Object.create(t&&t.prototype)).constructor=r,r.prototype.onAdd=function(t){var r;return this._map=t,this._container=i.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),r=this._setupUI,void 0!==Dn?r(Dn):void 0!==e.window.navigator.permissions?e.window.navigator.permissions.query({name:"geolocation"}).then((function(e){r(Dn="denied"!==e.state)})):r(Dn=!!e.window.navigator.geolocation),this._container},r.prototype.onRemove=function(){void 0!==this._geolocationWatchID&&(e.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),i.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,On=0,Nn=!1},r.prototype._isOutOfMapMaxBounds=function(e){var t=this._map.getMaxBounds(),i=e.coords;return t&&(i.longitude<t.getWest()||i.longitude>t.getEast()||i.latitude<t.getSouth()||i.latitude>t.getNorth())},r.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},r.prototype._onSuccess=function(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new e.Event("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new e.Event("geolocate",t)),this._finish()}},r.prototype._updateCamera=function(t){var i=new e.LngLat(t.coords.longitude,t.coords.latitude),r=t.coords.accuracy,n=this._map.getBearing(),a=e.extend({bearing:n},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(r),a,{geolocateSource:!0})},r.prototype._updateMarker=function(t){if(t){var i=new e.LngLat(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},r.prototype._updateCircleRadius=function(){var e=this._map._container.clientHeight/2,t=this._map.unproject([0,e]),i=this._map.unproject([1,e]),r=t.distanceTo(i),n=Math.ceil(2*this._accuracy/r);this._circleElement.style.width=n+"px",this._circleElement.style.height=n+"px"},r.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},r.prototype._onError=function(t){if(this._map){if(this.options.trackUserLocation)if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&Nn)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new e.Event("error",t)),this._finish()}},r.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},r.prototype._setupUI=function(t){var r=this;if(this._container.addEventListener("contextmenu",(function(e){return e.preventDefault()})),this._geolocateButton=i.create("button","mapboxgl-ctrl-geolocate",this._container),i.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===t){e.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{var a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=i.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Bn(this._dotElement),this._circleElement=i.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Bn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(function(t){t.geolocateSource||"ACTIVE_LOCK"!==r._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(r._watchState="BACKGROUND",r._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),r._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),r.fire(new e.Event("trackuserlocationend")))}))},r.prototype.trigger=function(){if(!this._setup)return e.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":On--,Nn=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new e.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){var t;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++On>1?(t={maximumAge:6e5,timeout:0},Nn=!0):(t=this.options.positionOptions,Nn=!1),this._geolocationWatchID=e.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,t)}}else e.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},r.prototype._clearWatch=function(){e.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},r}(e.Evented),Un={maxWidth:100,unit:"metric"},$n=function(t){this.options=e.extend({},Un,t),e.bindAll(["_onMove","setUnit"],this)};function jn(e,t,i){var r=i&&i.maxWidth||100,n=e._container.clientHeight/2,a=e.unproject([0,n]),o=e.unproject([r,n]),s=a.distanceTo(o);if(i&&"imperial"===i.unit){var l=3.2808*s;l>5280?qn(t,r,l/5280,e._getUIString("ScaleControl.Miles")):qn(t,r,l,e._getUIString("ScaleControl.Feet"))}else i&&"nautical"===i.unit?qn(t,r,s/1852,e._getUIString("ScaleControl.NauticalMiles")):s>=1e3?qn(t,r,s/1e3,e._getUIString("ScaleControl.Kilometers")):qn(t,r,s,e._getUIString("ScaleControl.Meters"))}function qn(e,t,i,r){var n,a,o,s=(n=i,(a=Math.pow(10,(""+Math.floor(n)).length-1))*(o=(o=n/a)>=10?10:o>=5?5:o>=3?3:o>=2?2:o>=1?1:function(e){var t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(o)));e.style.width=t*(s/i)+"px",e.innerHTML=s+"&nbsp;"+r}$n.prototype.getDefaultPosition=function(){return"bottom-left"},$n.prototype._onMove=function(){jn(this._map,this._container,this.options)},$n.prototype.onAdd=function(e){return this._map=e,this._container=i.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},$n.prototype.onRemove=function(){i.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},$n.prototype.setUnit=function(e){this.options.unit=e,jn(this._map,this._container,this.options)};var Gn=function(t){this._fullscreen=!1,t&&t.container&&(t.container instanceof e.window.HTMLElement?this._container=t.container:e.warnOnce("Full screen control 'container' must be a DOM element.")),e.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in e.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in e.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in e.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in e.window.document&&(this._fullscreenchange="MSFullscreenChange")};Gn.prototype.onAdd=function(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=i.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",e.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Gn.prototype.onRemove=function(){i.remove(this._controlContainer),this._map=null,e.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Gn.prototype._checkFullscreenSupport=function(){return!!(e.window.document.fullscreenEnabled||e.window.document.mozFullScreenEnabled||e.window.document.msFullscreenEnabled||e.window.document.webkitFullscreenEnabled)},Gn.prototype._setupUI=function(){var t=this._fullscreenButton=i.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);i.create("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden",!0),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),e.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Gn.prototype._updateTitle=function(){var e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.title=e},Gn.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Gn.prototype._isFullscreen=function(){return this._fullscreen},Gn.prototype._changeIcon=function(){(e.window.document.fullscreenElement||e.window.document.mozFullScreenElement||e.window.document.webkitFullscreenElement||e.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Gn.prototype._onClickFullscreen=function(){this._isFullscreen()?e.window.document.exitFullscreen?e.window.document.exitFullscreen():e.window.document.mozCancelFullScreen?e.window.document.mozCancelFullScreen():e.window.document.msExitFullscreen?e.window.document.msExitFullscreen():e.window.document.webkitCancelFullScreen&&e.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Hn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Wn=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Zn=function(t){function r(i){t.call(this),this.options=e.extend(Object.create(Hn),i),e.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return t&&(r.__proto__=t),(r.prototype=Object.create(t&&t.prototype)).constructor=r,r.prototype.addTo=function(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new e.Event("open")),this},r.prototype.isOpen=function(){return!!this._map},r.prototype.remove=function(){return this._content&&i.remove(this._content),this._container&&(i.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new e.Event("close")),this},r.prototype.getLngLat=function(){return this._lngLat},r.prototype.setLngLat=function(t){return this._lngLat=e.LngLat.convert(t),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},r.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},r.prototype.getElement=function(){return this._container},r.prototype.setText=function(t){return this.setDOMContent(e.window.document.createTextNode(t))},r.prototype.setHTML=function(t){var i,r=e.window.document.createDocumentFragment(),n=e.window.document.createElement("body");for(n.innerHTML=t;i=n.firstChild;)r.appendChild(i);return this.setDOMContent(r)},r.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},r.prototype.setMaxWidth=function(e){return this.options.maxWidth=e,this._update(),this},r.prototype.setDOMContent=function(e){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=i.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(e),this._createCloseButton(),this._update(),this._focusFirstElement(),this},r.prototype.addClassName=function(e){this._container&&this._container.classList.add(e)},r.prototype.removeClassName=function(e){this._container&&this._container.classList.remove(e)},r.prototype.setOffset=function(e){return this.options.offset=e,this._update(),this},r.prototype.toggleClassName=function(e){if(this._container)return this._container.classList.toggle(e)},r.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=i.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},r.prototype._onMouseUp=function(e){this._update(e.point)},r.prototype._onMouseMove=function(e){this._update(e.point)},r.prototype._onDrag=function(e){this._update(e.point)},r.prototype._update=function(t){var r=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=i.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=i.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach((function(e){return r._container.classList.add(e)})),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Rn(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||t)){var n=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat),a=this.options.anchor,o=function t(i){if(i){if("number"==typeof i){var r=Math.round(Math.sqrt(.5*Math.pow(i,2)));return{center:new e.Point(0,0),top:new e.Point(0,i),"top-left":new e.Point(r,r),"top-right":new e.Point(-r,r),bottom:new e.Point(0,-i),"bottom-left":new e.Point(r,-r),"bottom-right":new e.Point(-r,-r),left:new e.Point(i,0),right:new e.Point(-i,0)}}if(i instanceof e.Point||Array.isArray(i)){var n=e.Point.convert(i);return{center:n,top:n,"top-left":n,"top-right":n,bottom:n,"bottom-left":n,"bottom-right":n,left:n,right:n}}return{center:e.Point.convert(i.center||[0,0]),top:e.Point.convert(i.top||[0,0]),"top-left":e.Point.convert(i["top-left"]||[0,0]),"top-right":e.Point.convert(i["top-right"]||[0,0]),bottom:e.Point.convert(i.bottom||[0,0]),"bottom-left":e.Point.convert(i["bottom-left"]||[0,0]),"bottom-right":e.Point.convert(i["bottom-right"]||[0,0]),left:e.Point.convert(i.left||[0,0]),right:e.Point.convert(i.right||[0,0])}}return t(new e.Point(0,0))}(this.options.offset);if(!a){var s,l=this._container.offsetWidth,c=this._container.offsetHeight;s=n.y+o.bottom.y<c?["top"]:n.y>this._map.transform.height-c?["bottom"]:[],n.x<l/2?s.push("left"):n.x>this._map.transform.width-l/2&&s.push("right"),a=0===s.length?"bottom":s.join("-")}var u=n.add(o[a]).round();i.setTransform(this._container,kn[a]+" translate("+u.x+"px,"+u.y+"px)"),Ln(this._container,a,"popup")}},r.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var e=this._container.querySelector(Wn);e&&e.focus()}},r.prototype._onClose=function(){this.remove()},r}(e.Evented),Xn={version:e.version,supported:t,setRTLTextPlugin:e.setRTLTextPlugin,getRTLTextPluginStatus:e.getRTLTextPluginStatus,Map:Cn,NavigationControl:Pn,GeolocateControl:Vn,AttributionControl:vn,ScaleControl:$n,FullscreenControl:Gn,Popup:Zn,Marker:Bn,Style:jt,LngLat:e.LngLat,LngLatBounds:e.LngLatBounds,Point:e.Point,MercatorCoordinate:e.MercatorCoordinate,Evented:e.Evented,config:e.config,prewarm:function(){Oe().acquire(Le)},clearPrewarmedResources:function(){var e=Be;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(Le),Be=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return e.config.ACCESS_TOKEN},set accessToken(t){e.config.ACCESS_TOKEN=t},get baseApiUrl(){return e.config.API_URL},set baseApiUrl(t){e.config.API_URL=t},get workerCount(){return De.workerCount},set workerCount(e){De.workerCount=e},get maxParallelImageRequests(){return e.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){e.config.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage:function(t){e.clearTileCache(t)},workerUrl:""};return Xn})),i}()}},function(e){var t;t=41,e(e.s=t)}]);