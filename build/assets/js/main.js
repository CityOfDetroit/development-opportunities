/*! For license information please see main.js.LICENSE.txt */
!function(){try{var t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},e=(new Error).stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="0a41dfd9-f390-4193-b382-8ebc4f1a9dd9",t._sentryDebugIdIdentifier="sentry-dbid-0a41dfd9-f390-4193-b382-8ebc4f1a9dd9")}catch(t){}}();var _global="undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{};_global.SENTRY_RELEASE={id:"78fc81e5cf6d5b88241363db84881c0fe3705071"},(self.webpackChunkdevelopment_opportunities=self.webpackChunkdevelopment_opportunities||[]).push([[179],{518:function(t,e,i){"use strict";function n(){return"undefined"!==typeof __SENTRY_BROWSER_BUNDLE__&&!!__SENTRY_BROWSER_BUNDLE__}function r(){return"npm"}i.d(e,{S:function(){return r},n:function(){return n}})},422:function(t,e,i){"use strict";i.d(e,{KV:function(){return r},l$:function(){return a}});var n=i(518);function r(){return!(0,n.n)()&&"[object process]"===Object.prototype.toString.call("undefined"!==typeof process?process:0)}function a(t,e){return t.require(e)}t=i.hmd(t)},170:function(t,e,i){"use strict";i.d(e,{Z1:function(){return p},ph:function(){return u},yW:function(){return c}});var n=i(422),r=i(235);t=i.hmd(t);const a=(0,r.Rf)(),o={nowSeconds:()=>Date.now()/1e3};const s=(0,n.KV)()?function(){try{return(0,n.l$)(t,"perf_hooks").performance}catch(e){return}}():function(){const{performance:t}=a;if(!t||!t.now)return;return{now:()=>t.now(),timeOrigin:Date.now()-t.now()}}(),l=void 0===s?o:{nowSeconds:()=>(s.timeOrigin+s.now())/1e3},c=o.nowSeconds.bind(o),u=l.nowSeconds.bind(l);let h;const p=(()=>{const{performance:t}=a;if(!t||!t.now)return void(h="none");const e=36e5,i=t.now(),n=Date.now(),r=t.timeOrigin?Math.abs(t.timeOrigin+i-n):e,o=r<e,s=t.timing&&t.timing.navigationStart,l="number"===typeof s?Math.abs(s+i-n):e;return o||l<e?r<=l?(h="timeOrigin",t.timeOrigin):(h="navigationStart",s):(h="dateNow",n)})()},235:function(t,e,i){"use strict";function n(t){return t&&t.Math==Math?t:void 0}i.d(e,{Rf:function(){return a},YO:function(){return o},n2:function(){return r}});const r="object"==typeof globalThis&&n(globalThis)||"object"==typeof window&&n(window)||"object"==typeof self&&n(self)||"object"==typeof i.g&&n(i.g)||function(){return this}()||{};function a(){return r}function o(t,e,i){const n=i||r,a=n.__SENTRY__=n.__SENTRY__||{};return a[t]||(a[t]=e())}},302:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}var o=i(409),s=i(618),l=i.n(s),c=6371008.8,u={centimeters:637100880,centimetres:637100880,degrees:57.22891354143274,feet:20902260.511392,inches:39.37*c,kilometers:6371.0088,kilometres:6371.0088,meters:c,metres:c,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:c/1852,radians:1,yards:6967335.223679999};function h(t,e,i){void 0===i&&(i={});var n={type:"Feature"};return(0===i.id||i.id)&&(n.id=i.id),i.bbox&&(n.bbox=i.bbox),n.properties=e||{},n.geometry=t,n}function p(t,e,i){if(void 0===i&&(i={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!g(t[0])||!g(t[1]))throw new Error("coordinates must contain numbers");return h({type:"Point",coordinates:t},e,i)}function d(t,e){void 0===e&&(e="kilometers");var i=u[e];if(!i)throw new Error(e+" units is invalid");return t*i}function f(t){return 180*(t%(2*Math.PI))/Math.PI}function m(t){return t%360*Math.PI/180}function g(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function _(t,e,i){if(null!==t)for(var n,r,a,o,s,l,c,u,h=0,p=0,d=t.type,f="FeatureCollection"===d,m="Feature"===d,g=f?t.features.length:1,y=0;y<g;y++){s=(u=!!(c=f?t.features[y].geometry:m?t.geometry:t)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var v=0;v<s;v++){var x=0,b=0;if(null!==(o=u?c.geometries[v]:c)){l=o.coordinates;var w=o.type;switch(h=!i||"Polygon"!==w&&"MultiPolygon"!==w?0:1,w){case null:break;case"Point":if(!1===e(l,p,y,x,b))return!1;p++,x++;break;case"LineString":case"MultiPoint":for(n=0;n<l.length;n++){if(!1===e(l[n],p,y,x,b))return!1;p++,"MultiPoint"===w&&x++}"LineString"===w&&x++;break;case"Polygon":case"MultiLineString":for(n=0;n<l.length;n++){for(r=0;r<l[n].length-h;r++){if(!1===e(l[n][r],p,y,x,b))return!1;p++}"MultiLineString"===w&&x++,"Polygon"===w&&b++}"Polygon"===w&&x++;break;case"MultiPolygon":for(n=0;n<l.length;n++){for(b=0,r=0;r<l[n].length;r++){for(a=0;a<l[n][r].length-h;a++){if(!1===e(l[n][r][a],p,y,x,b))return!1;p++}b++}x++}break;case"GeometryCollection":for(n=0;n<o.geometries.length;n++)if(!1===_(o.geometries[n],e,i))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}var y=function(t,e){void 0===e&&(e={});var i=0,n=0,r=0;return _(t,(function(t){i+=t[0],n+=t[1],r++}),!0),p([i/r,n/r],e.properties)},v=JSON.parse('{"version":8,"sprite":"https://cdn.arcgis.com/sharing/rest/content/items/273bf8d5c8ac400183fc24e109d20bcf/resources/styles/../sprites/sprite","glyphs":"https://basemaps.arcgis.com/arcgis/rest/services/World_Basemap_v2/VectorTileServer/resources/fonts/{fontstack}/{range}.pbf","sources":{"esri":{"type":"vector","tiles":["https://basemaps.arcgis.com/arcgis/rest/services/World_Basemap_v2/VectorTileServer/tile/{z}/{y}/{x}.pbf"]},"parcels":{"type":"vector","tiles":["https://tiles.arcgis.com/tiles/qvkbeam7Wirps6zC/arcgis/rest/services/parcels/VectorTileServer/tile/{z}/{y}/{x}.pbf"]},"mapillary":{"type":"geojson","data":{"type":"FeatureCollection","features":[]}},"mly":{"type":"vector","tiles":["https://tiles.mapillary.com/maps/vtp/mly1_computed_public/2/{z}/{x}/{y}?access_token=MLY|4690399437648324|de87555bb6015affa20c3df794ebab15"],"maxzoom":14,"minzoom":14}},"layers":[{"id":"Land/Not ice","type":"fill","source":"esri","source-layer":"Land","filter":["==","_symbol",0],"minzoom":0,"layout":{},"paint":{"fill-color":{"stops":[[0,"#dce0ca"],[10,"#E6E5D6"],[15,"#f2eee9"]]}}},{"id":"Land/Ice","type":"fill","source":"esri","source-layer":"Land","filter":["==","_symbol",1],"minzoom":0,"layout":{},"paint":{"fill-color":"#E6E5D6"}},{"id":"Urban area","type":"fill","source":"esri","source-layer":"Urban area","minzoom":5,"maxzoom":15,"layout":{},"paint":{"fill-color":{"stops":[[5,"#e3dfdc"],[10,"#ECE8E3"],[15,"#f2eee9"]]},"fill-antialias":false}},{"id":"Parcel/fill","type":"fill","source":"esri","source-layer":"Parcel","minzoom":18,"layout":{},"paint":{"fill-color":"#f0ebe5"}},{"id":"Parcel/line","type":"line","source":"esri","source-layer":"Parcel","minzoom":17,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#dddbd8","line-width":{"base":1.2,"stops":[[17,0.6],[22,5]]}}},{"id":"Vegetation small scale/High density","type":"fill","source":"esri","source-layer":"Vegetation small scale","filter":["==","_symbol",0],"maxzoom":11,"layout":{},"paint":{"fill-color":"#c2e699","fill-opacity":{"stops":[[0,0.3],[5,0.28],[7,0.18],[10,0.08]]},"fill-antialias":false}},{"id":"Vegetation small scale/Low density","type":"fill","source":"esri","source-layer":"Vegetation small scale","filter":["==","_symbol",1],"maxzoom":11,"layout":{},"paint":{"fill-color":"#9ad666","fill-opacity":{"stops":[[0,0.3],[5,0.28],[7,0.18],[10,0.08]]},"fill-antialias":false}},{"id":"Indigenous","type":"fill","source":"esri","source-layer":"Indigenous","minzoom":6,"layout":{},"paint":{"fill-color":"#dbd5bd","fill-outline-color":"#d6d4c8","fill-opacity":0.35}},{"id":"Openspace or forest","type":"fill","source":"esri","source-layer":"Openspace or forest","minzoom":9,"layout":{},"paint":{"fill-color":"#CDDFB3","fill-antialias":false}},{"id":"Admin0 forest or park","type":"fill","source":"esri","source-layer":"Admin0 forest or park","minzoom":6,"layout":{},"paint":{"fill-color":"#CDDFB3","fill-opacity":{"stops":[[6,0.4],[8,1]]},"fill-antialias":false}},{"id":"Admin0 forest or park/line2","type":"line","source":"esri","source-layer":"Admin0 forest or park","minzoom":6,"layout":{},"paint":{"line-color":"#c0d3a5","line-opacity":0.3,"line-width":{"base":1.2,"stops":[[6,0.6],[15,15]]}}},{"id":"Admin0 forest or park/line","type":"line","source":"esri","source-layer":"Admin0 forest or park","minzoom":6,"layout":{},"paint":{"line-color":"#c0d3a5","line-opacity":{"stops":[[6,0.4],[8,1]]},"line-width":{"base":1.2,"stops":[[6,0.6],[9,1.1]]}}},{"id":"Admin1 forest or park","type":"fill","source":"esri","source-layer":"Admin1 forest or park","minzoom":7,"layout":{},"paint":{"fill-color":"#CDDFB3","fill-opacity":{"stops":[[6,0.4],[8,1]]},"fill-antialias":false}},{"id":"Admin1 forest or park/line2","type":"line","source":"esri","source-layer":"Admin1 forest or park","minzoom":7,"layout":{},"paint":{"line-color":"#c0d3a5","line-opacity":0.3,"line-width":{"base":1.2,"stops":[[6,0.6],[15,15]]}}},{"id":"Admin1 forest or park/line","type":"line","source":"esri","source-layer":"Admin1 forest or park","minzoom":7,"layout":{},"paint":{"line-color":"#c0d3a5","line-opacity":{"stops":[[6,0.4],[8,1]]},"line-width":{"base":1.2,"stops":[[6,0.6],[9,1.1]]}}},{"id":"Zoo","type":"fill","source":"esri","source-layer":"Zoo","minzoom":11,"layout":{},"paint":{"fill-color":{"stops":[[11,"#CDDFB3"],[17,"#A5C187"]]}}},{"id":"Military","type":"fill","source":"esri","source-layer":"Military","minzoom":6,"layout":{},"paint":{"fill-color":"#d9d9d9","fill-opacity":0.5,"fill-antialias":false}},{"id":"Port","type":"fill","source":"esri","source-layer":"Port","minzoom":12,"layout":{},"paint":{"fill-color":{"stops":[[13,"#d9d2c8"],[15,"#E6E0D9"],[19,"#ECE7E1"]]}}},{"id":"Transportation","type":"fill","source":"esri","source-layer":"Transportation","minzoom":13,"layout":{},"paint":{"fill-color":{"stops":[[13,"#ddd3c5"],[15,"#E8E1D7"],[19,"#EDE7E0"]]}}},{"id":"Industry","type":"fill","source":"esri","source-layer":"Industry","minzoom":12,"layout":{},"paint":{"fill-color":{"stops":[[13,"#d9d2c8"],[15,"#E2DCD4"],[19,"#ECE7E1"]]}}},{"id":"Golf course","type":"fill","source":"esri","source-layer":"Golf course","minzoom":11,"layout":{},"paint":{"fill-color":"#D6E6C3"}},{"id":"Airport/Airport property","type":"fill","source":"esri","source-layer":"Airport","filter":["==","_symbol",1],"minzoom":9,"layout":{},"paint":{"fill-color":{"stops":[[9,"#d9d6d2"],[11,"#e3e1df"],[15,"#EAE7E4"]]},"fill-outline-color":"#DDDBD9"}},{"id":"Airport/Airport runway","type":"fill","source":"esri","source-layer":"Airport","filter":["==","_symbol",0],"minzoom":11,"layout":{},"paint":{"fill-color":{"stops":[[11,"#dddbd9"],[22,"#8D8C8A"]]}}},{"id":"Retail","type":"fill","source":"esri","source-layer":"Retail","minzoom":13,"layout":{},"paint":{"fill-color":{"stops":[[11,"#f7c2b5"],[15,"#F5D8CF"],[19,"#F3E8E2"]]}}},{"id":"Water and wastewater","type":"fill","source":"esri","source-layer":"Water and wastewater","minzoom":13,"layout":{},"paint":{"fill-color":{"stops":[[13,"#ddd3c5"],[15,"#E8E1D7"],[19,"#EDE7E0"]]}}},{"id":"Freight","type":"fill","source":"esri","source-layer":"Freight","minzoom":12,"layout":{},"paint":{"fill-color":{"stops":[[13,"#d9d2c8"],[15,"#E2DCD4"],[19,"#EDE7E0"]]}}},{"id":"Cemetery","type":"fill","source":"esri","source-layer":"Cemetery","minzoom":13,"layout":{},"paint":{"fill-color":"#d3e6b9"}},{"id":"Finance","type":"fill","source":"esri","source-layer":"Finance","minzoom":13,"layout":{},"paint":{"fill-color":{"stops":[[11,"#f7c2b5"],[15,"#F5D8CF"],[19,"#F3E8E2"]]}}},{"id":"Government","type":"fill","source":"esri","source-layer":"Government","minzoom":13,"layout":{},"paint":{"fill-color":{"stops":[[13,"#ddd3c5"],[15,"#E8E1D7"],[19,"#EDE7E0"]]}}},{"id":"Emergency","type":"fill","source":"esri","source-layer":"Emergency","minzoom":13,"layout":{},"paint":{"fill-color":"#E8E7E5"}},{"id":"Landmark","type":"fill","source":"esri","source-layer":"Landmark","minzoom":13,"layout":{},"paint":{"fill-color":{"stops":[[10,"#d7ede6"],[15,"#E5EEE8"],[19,"#EBEEE8"]]}}},{"id":"Pedestrian","type":"fill","source":"esri","source-layer":"Pedestrian","minzoom":13,"layout":{},"paint":{"fill-color":"#E8E7E5","fill-outline-color":"#bcb7ae"}},{"id":"Education","type":"fill","source":"esri","source-layer":"Education","minzoom":11,"layout":{},"paint":{"fill-color":{"stops":[[11,"#dde2a9"],[15,"#E8E8C9"],[19,"#EEEBDB"]]}}},{"id":"Medical","type":"fill","source":"esri","source-layer":"Medical","minzoom":11,"layout":{},"paint":{"fill-color":{"stops":[[11,"#c7dff4"],[15,"#DDE7EF"],[19,"#E7EAEC"]]}}},{"id":"Park or farming","type":"fill","source":"esri","source-layer":"Park or farming","minzoom":11,"layout":{},"paint":{"fill-color":{"stops":[[11,"#CDDFB3"],[17,"#A5C187"]]}}},{"id":"Beach","type":"fill","source":"esri","source-layer":"Beach","minzoom":13,"layout":{},"paint":{"fill-pattern":"Special area of interest/Sand"}},{"id":"Special area of interest/Garden path","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",12],"minzoom":14,"layout":{"visibility":"none"},"paint":{"fill-color":"#f5f5f1","fill-outline-color":"#EBE8E8"}},{"id":"Special area of interest/Green openspace","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",11],"minzoom":14,"layout":{},"paint":{"fill-color":{"stops":[[14,"#c5e0a9"],[17,"#A5C187"]]}}},{"id":"Special area of interest/Grass","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",8],"minzoom":14,"layout":{},"paint":{"fill-color":{"stops":[[14,"#b4d197"],[17,"#84A661"]]}}},{"id":"Special area of interest/Grass/line","type":"line","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",8],"minzoom":14,"layout":{},"paint":{"line-color":{"stops":[[14,"#a4c683"],[17,"#739551"]]},"line-width":{"stops":[[15,1.1],[22,10]]},"line-blur":{"stops":[[15,1],[22,5]]}}},{"id":"Special area of interest/Grass/pattern","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",8],"minzoom":14,"layout":{},"paint":{"fill-pattern":"Special area of interest/Grass","fill-opacity":0.5}},{"id":"Special area of interest/Grass/pattern/1","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",8],"minzoom":14,"layout":{},"paint":{"fill-pattern":"Special area of interest/Small stipple"}},{"id":"Special area of interest/Baseball field or other grounds","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",1],"minzoom":14,"layout":{},"paint":{"fill-color":"#91a761"}},{"id":"Special area of interest/Baseball field or other grounds/pattern","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",1],"minzoom":14,"layout":{},"paint":{"fill-pattern":"Special area of interest/Baseball field or other grounds"}},{"id":"Special area of interest/Groundcover","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",13],"minzoom":14,"layout":{},"paint":{"fill-color":"#97be82"}},{"id":"Special area of interest/Groundcover/pattern","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",13],"minzoom":14,"layout":{},"paint":{"fill-pattern":"Special area of interest/Groundcover","fill-opacity":0.5}},{"id":"Special area of interest/Field or court exterior","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",5],"minzoom":14,"layout":{},"paint":{"fill-color":"#6E866E"}},{"id":"Special area of interest/Football field or court","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",4],"minzoom":14,"layout":{},"paint":{"fill-color":"#7fa57a"}},{"id":"Special area of interest/Football field or court/line","type":"line","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",4],"minzoom":14,"layout":{},"paint":{"line-color":"#e3e0da","line-opacity":0.8,"line-width":{"base":1.2,"stops":[[15,0.5],[20,4]]}}},{"id":"Special area of interest/Hardcourt","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",10],"minzoom":14,"layout":{},"paint":{"fill-color":{"stops":[[15,"#dddbd9"],[22,"#8D8C8A"]]}}},{"id":"Special area of interest/Hardcourt/line","type":"line","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",10],"minzoom":14,"layout":{},"paint":{"line-color":"#e3e0da","line-opacity":0.8,"line-width":{"base":1.2,"stops":[[15,0.5],[20,4]]}}},{"id":"Special area of interest/Mulch or dirt","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",14],"minzoom":14,"layout":{},"paint":{"fill-pattern":"Special area of interest/Mulch or dirt"}},{"id":"Special area of interest/Mulch or dirt/line","type":"line","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",14],"minzoom":14,"layout":{},"paint":{"line-color":"#c9b58b","line-width":{"stops":[[15,1.1],[22,10]]},"line-blur":{"stops":[[15,1],[22,5]]}}},{"id":"Special area of interest/Athletic track","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",0],"minzoom":14,"layout":{},"paint":{"fill-color":{"stops":[[14,"#d49a87"],[17,"#cb7169"]]}}},{"id":"Special area of interest/Athletic track/line","type":"line","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",0],"minzoom":14,"layout":{},"paint":{"line-color":"#e3e0da","line-opacity":0.8,"line-width":{"base":1.2,"stops":[[15,0.5],[20,4]]}}},{"id":"Special area of interest/Sand","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",6],"minzoom":14,"layout":{},"paint":{"fill-pattern":"Special area of interest/Sand"}},{"id":"Special area of interest/Parking/line","type":"line","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",15],"minzoom":15,"layout":{},"paint":{"line-color":{"stops":[[15,"#d1cfcd"],[22,"#7c7b79"]]},"line-opacity":0.8,"line-width":{"stops":[[15,1.1],[22,10]]},"line-blur":{"stops":[[15,1],[22,5]]}}},{"id":"Special area of interest/Parking","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",15],"minzoom":15,"layout":{},"paint":{"fill-color":{"stops":[[15,"#dddbd9"],[22,"#8D8C8A"]]}}},{"id":"Special area of interest/Parking/stipple","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",15],"minzoom":15,"layout":{},"paint":{"fill-pattern":"Special area of interest/Small stipple"}},{"id":"Special area of interest/Rock or gravel","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",16],"minzoom":14,"layout":{},"paint":{"fill-pattern":"Special area of interest/Rock or gravel"}},{"id":"Water line small scale","type":"line","source":"esri","source-layer":"Water line small scale","minzoom":1,"maxzoom":5,"layout":{"line-join":"round"},"paint":{"line-color":{"stops":[[1,"#B7D7D9"],[10.6,"#6BC4F0"]]},"line-width":{"base":1.2,"stops":[[1,0.5],[5,0.5]]}}},{"id":"Water line medium scale","type":"line","source":"esri","source-layer":"Water line medium scale","minzoom":5,"maxzoom":7,"layout":{"line-join":"round"},"paint":{"line-color":{"stops":[[1,"#B7D7D9"],[10.6,"#6BC4F0"]]},"line-width":{"base":1.2,"stops":[[5,0.5],[7,0.7]]}}},{"id":"Water line large scale","type":"line","source":"esri","source-layer":"Water line large scale","minzoom":7,"maxzoom":11,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[1,"#B7D7D9"],[10.6,"#6BC4F0"]]},"line-width":{"base":1.2,"stops":[[7,0.5],[11,0.7]]}}},{"id":"Water line/Waterfall","type":"line","source":"esri","source-layer":"Water line","filter":["==","_symbol",5],"minzoom":11,"layout":{"line-join":"round"},"paint":{"line-color":"#6BC4F0","line-width":0.8,"line-dasharray":[5,5]}},{"id":"Water line/Dam or weir","type":"line","source":"esri","source-layer":"Water line","filter":["==","_symbol",2],"minzoom":11,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#afafaf","line-width":{"base":1.2,"stops":[[11,0.7],[14,0.7],[17,2]]}}},{"id":"Water line/Levee/1","type":"line","source":"esri","source-layer":"Water line","filter":["==","_symbol",3],"minzoom":11,"layout":{"line-join":"round"},"paint":{"line-color":"#c3c3c3","line-width":{"base":1.2,"stops":[[11,0.7],[14,0.7],[20,2.5]]}}},{"id":"Water line/Levee/0","type":"symbol","source":"esri","source-layer":"Water line","filter":["==","_symbol",3],"minzoom":13,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"icon-image":"Water line/Levee/0","symbol-spacing":13.3,"icon-rotation-alignment":"map","icon-allow-overlap":true,"icon-padding":1},"paint":{}},{"id":"Water line/Canal or ditch","type":"line","source":"esri","source-layer":"Water line","filter":["==","_symbol",1],"minzoom":11,"layout":{"line-cap":"round"},"paint":{"line-color":"#6BC4F0","line-width":{"base":1.2,"stops":[[11,0.7],[14,0.7],[17,2]]}}},{"id":"Water line/Stream or river intermittent","type":"line","source":"esri","source-layer":"Water line","filter":["==","_symbol",4],"minzoom":11,"layout":{},"paint":{"line-color":"#6BC4F0","line-dasharray":[7,3],"line-width":{"base":1.2,"stops":[[11,0.7],[14,0.7],[17,2]]}}},{"id":"Water line/Stream or river","type":"line","source":"esri","source-layer":"Water line","filter":["==","_symbol",0],"minzoom":11,"layout":{"line-cap":"round"},"paint":{"line-color":"#6BC4F0","line-width":{"base":1.2,"stops":[[11,0.7],[14,0.7],[17,2]]}}},{"id":"Marine area/1","type":"fill","source":"esri","source-layer":"Marine area","minzoom":0,"layout":{},"paint":{"fill-color":{"stops":[[5,"#53B9EA"],[10.6,"#6BC4F0"]]},"fill-antialias":false}},{"id":"Bathymetry/depth 2 (shallow water)","type":"fill","source":"esri","source-layer":"Bathymetry","filter":["==","_symbol",0],"maxzoom":11,"layout":{},"paint":{"fill-color":{"stops":[[5,"#5BBDEC"],[10.6,"#6BC4F0"]]},"fill-antialias":false}},{"id":"Bathymetry/depth 3","type":"fill","source":"esri","source-layer":"Bathymetry","filter":["==","_symbol",1],"maxzoom":11,"layout":{},"paint":{"fill-color":{"stops":[[5,"#63C0EE"],[10.6,"#6BC4F0"]]},"fill-antialias":false}},{"id":"Bathymetry/depth 4","type":"fill","source":"esri","source-layer":"Bathymetry","filter":["==","_symbol",2],"maxzoom":11,"layout":{},"paint":{"fill-color":{"stops":[[5,"#6BC4F0"],[10.6,"#6BC4F0"]]},"fill-antialias":false}},{"id":"Bathymetry/depth 5","type":"fill","source":"esri","source-layer":"Bathymetry","filter":["==","_symbol",3],"maxzoom":11,"layout":{},"paint":{"fill-color":{"stops":[[5,"#72C8F1"],[10.6,"#6BC4F0"]]},"fill-antialias":false}},{"id":"Bathymetry/depth 6","type":"fill","source":"esri","source-layer":"Bathymetry","filter":["==","_symbol",4],"maxzoom":11,"layout":{},"paint":{"fill-color":{"stops":[[5,"#7ACBF3"],[10.6,"#6BC4F0"]]},"fill-antialias":false}},{"id":"Bathymetry/depth 7 (deep water)","type":"fill","source":"esri","source-layer":"Bathymetry","filter":["==","_symbol",5],"maxzoom":11,"layout":{},"paint":{"fill-color":{"stops":[[5,"#82CFF5"],[10.6,"#6BC4F0"]]},"fill-antialias":false}},{"id":"Water area small scale","type":"fill","source":"esri","source-layer":"Water area small scale","minzoom":1,"maxzoom":5,"layout":{},"paint":{"fill-color":{"stops":[[5,"#53B9EA"],[10.6,"#6BC4F0"]]},"fill-outline-color":"#53B9EA"}},{"id":"Water area medium scale/Lake intermittent","type":"fill","source":"esri","source-layer":"Water area medium scale","filter":["==","_symbol",1],"minzoom":5,"maxzoom":7,"layout":{},"paint":{"fill-pattern":"Water area/Lake or river intermittent"}},{"id":"Water area medium scale/Lake or river","type":"fill","source":"esri","source-layer":"Water area medium scale","filter":["==","_symbol",0],"minzoom":5,"maxzoom":7,"layout":{},"paint":{"fill-color":{"stops":[[5,"#53B9EA"],[10.6,"#6BC4F0"]]},"fill-outline-color":"#53B9EA"}},{"id":"Water area large scale/Lake intermittent","type":"fill","source":"esri","source-layer":"Water area large scale","filter":["==","_symbol",1],"minzoom":7,"maxzoom":11,"layout":{},"paint":{"fill-pattern":"Water area/Lake or river intermittent"}},{"id":"Water area large scale/Lake or river","type":"fill","source":"esri","source-layer":"Water area large scale","filter":["==","_symbol",0],"minzoom":7,"maxzoom":11,"layout":{},"paint":{"fill-color":{"stops":[[5,"#53B9EA"],[10.6,"#6BC4F0"]]},"fill-outline-color":{"stops":[[8,"#53B9EA"],[9,"#6BC4F0"]]}}},{"id":"Water area/Lake, river or bay","type":"fill","source":"esri","source-layer":"Water area","filter":["==","_symbol",7],"minzoom":11,"layout":{},"paint":{"fill-color":"#6BC4F0","fill-outline-color":"#6BC4F0"}},{"id":"Water area/Lake or river intermittent","type":"fill","source":"esri","source-layer":"Water area","filter":["==","_symbol",6],"minzoom":11,"layout":{},"paint":{"fill-pattern":"Water area/Lake or river intermittent"}},{"id":"Water area/Inundated area","type":"fill","source":"esri","source-layer":"Water area","filter":["==","_symbol",4],"minzoom":11,"layout":{},"paint":{"fill-pattern":"Water area/Inundated area"}},{"id":"Water area/Swamp or marsh","type":"fill","source":"esri","source-layer":"Water area","filter":["==","_symbol",3],"minzoom":11,"layout":{},"paint":{"fill-pattern":"Water area/Swamp or marsh","fill-opacity":0.45}},{"id":"Water area/Playa","type":"fill","source":"esri","source-layer":"Water area","filter":["==","_symbol",1],"minzoom":11,"layout":{},"paint":{"fill-pattern":"Water area/Playa"}},{"id":"Water area/Ice mass","type":"fill","source":"esri","source-layer":"Water area","filter":["==","_symbol",2],"minzoom":11,"layout":{},"paint":{"fill-pattern":"Water area/Ice mass","fill-opacity":0.5}},{"id":"Water area/Dam or weir","type":"fill","source":"esri","source-layer":"Water area","filter":["==","_symbol",5],"minzoom":11,"layout":{},"paint":{"fill-color":"#e5e5dd","fill-outline-color":"#d9d9d1"}},{"id":"Special area of interest/Bike, walk or pedestrian/line","type":"line","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",2],"minzoom":15,"layout":{},"paint":{"line-color":"#bcb7ae","line-width":{"stops":[[15,1.1],[22,10]]},"line-blur":{"stops":[[15,1],[22,5]]}}},{"id":"Special area of interest/Bike, walk or pedestrian","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",2],"minzoom":15,"layout":{},"paint":{"fill-color":"#E8E7E5","fill-outline-color":"#dbd9d5"}},{"id":"Special area of interest/Bike, walk or pedestrian/pattern","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",2],"minzoom":15,"layout":{},"paint":{"fill-pattern":"Special area of interest/Small stipple"}},{"id":"Special area of interest/Water","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",7],"minzoom":14,"layout":{},"paint":{"fill-color":"#6BC4F0"}},{"id":"Special area of interest/Water/line","type":"line","source":"esri","source-layer":"Special area of interest","filter":["==","_symbol",7],"minzoom":14,"layout":{},"paint":{"line-color":"#5db6e2","line-width":{"stops":[[15,1.1],[22,7]]},"line-blur":{"stops":[[15,1],[22,3.5]]}}},{"id":"Ferry/Ferry","type":"line","source":"esri","source-layer":"Ferry","filter":["all",["==","_symbol",0],["!in","Viz",2]],"minzoom":11,"layout":{"line-join":"round"},"paint":{"line-color":"#c1e1f0","line-opacity":0.8,"line-width":{"base":1.2,"stops":[[11,1.3],[14,1.5],[17,1.5]]},"line-dasharray":[3,4]}},{"id":"Railroad/2","type":"line","source":"esri","source-layer":"Railroad","minzoom":11,"layout":{"line-join":"round"},"paint":{"line-color":{"stops":[[11,"#dedcd9"],[17,"#B8B1AA"]]},"line-width":{"base":1.2,"stops":[[11,2.5],[14,2.5],[17,4]]}}},{"id":"Railroad/1","type":"line","source":"esri","source-layer":"Railroad","minzoom":11,"layout":{"line-join":"round"},"paint":{"line-dasharray":[6,7.5],"line-color":{"stops":[[11,"#E3E0D7"],[17,"#DBD8CB"]]},"line-width":{"base":1.2,"stops":[[11,0.75],[15,0.75],[17,2]]}}},{"id":"Ferry/Rail ferry/2","type":"line","source":"esri","source-layer":"Ferry","filter":["all",["==","_symbol",1],["!in","Viz",2]],"minzoom":11,"layout":{"line-join":"round"},"paint":{"line-color":{"stops":[[11,"#dedcd9"],[17,"#B8B1AA"]]},"line-width":{"base":1.2,"stops":[[11,2.5],[14,2.5],[17,4]]}}},{"id":"Ferry/Rail ferry/1","type":"line","source":"esri","source-layer":"Ferry","filter":["all",["==","_symbol",1],["!in","Viz",2]],"minzoom":11,"layout":{"line-join":"round"},"paint":{"line-dasharray":[6,7.5],"line-color":{"stops":[[11,"#E3E0D7"],[17,"#DBD8CB"]]},"line-width":{"base":1.2,"stops":[[11,0.75],[15,0.75],[17,2]]}}},{"id":"Special area of interest line/Sports field","type":"line","source":"esri","source-layer":"Special area of interest line","filter":["==","_symbol",6],"minzoom":15,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#e3e0da","line-opacity":0.8,"line-width":{"base":1.2,"stops":[[15,0.5],[20,4]]}}},{"id":"Road/4WD/1","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",10],["!in","Viz",2]],"minzoom":13,"layout":{"line-join":"round"},"paint":{"line-color":"#e3e1dc","line-dasharray":[2,1],"line-width":{"base":1.2,"stops":[[11,1.5],[14,2.3],[17,8.3],[20,50]]}}},{"id":"Road/Minor, ramp or traffic circle/1","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",6],["!in","Viz",2]],"minzoom":9,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[9,"#E2DFD6"],[10,"#dedbd1"],[12,"#e3e1dc"]]},"line-width":{"base":1.2,"stops":[[9.9,1],[14,4],[16,11.5],[17,19],[20,58]]}}},{"id":"Road/Minor/1","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",5],["!in","Viz",2]],"minzoom":9,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[9,"#E2DFD6"],[10,"#dedbd1"],[12,"#e3e1dc"]]},"line-width":{"base":1.2,"stops":[[9,1],[10,3.3],[14,5.5],[16,11.5],[17,19],[20,58]]}}},{"id":"Road/Major, ramp or traffic circle/1","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",4],["!in","Viz",2]],"minzoom":9,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[9,"#dedbd1"],[12,"#e3e1dc"]]},"line-width":{"base":1.2,"stops":[[9,3.3],[14,7.3],[16,12.3],[17,22],[20,63]]}}},{"id":"Road/Major/1","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",3],["!in","Viz",2]],"minzoom":8,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[8,"#dedbd1"],[12,"#e3e1dc"]]},"line-width":{"base":1,"stops":[[8,3.3],[14,7.3],[16,12.3],[17,22],[20,63]]}}},{"id":"Road/Service/1","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",8],["!in","Viz",2]],"minzoom":13,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#e3e1dc","line-width":{"base":1.2,"stops":[[11,2],[14,2.5],[17,10.3],[20,45]]}}},{"id":"Trail or path/1","type":"line","source":"esri","source-layer":"Trail or path","minzoom":15,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[15,"#dddbd5"],[17,"#e3e1dc"]]},"line-width":{"base":1.2,"stops":[[15,2.5],[16,3],[17,5],[20,20],[22,31]]}}},{"id":"Road/Pedestrian/1","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",9],["!in","Viz",2]],"minzoom":15,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[15,"#dddbd5"],[17,"#e3e1dc"]]},"line-width":{"base":1.2,"stops":[[15,2.5],[16,3],[17,5],[20,20],[22,31]]}}},{"id":"Road/Local/1","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",7],["!in","Viz",2]],"minzoom":12,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#e3e1dc","line-width":{"base":1.4,"stops":[[11,1.1],[14,3],[16,8],[17,16],[20,48]]}}},{"id":"Trail or path/0","type":"line","source":"esri","source-layer":"Trail or path","minzoom":15,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[15,"#f8f8f7"],[18,"#ffffff"]]},"line-dasharray":{"stops":[[15,[3,3]],[17,[2,2]]]},"line-width":{"base":1.2,"stops":[[15,1.3],[17,2.5]]}}},{"id":"Road/Pedestrian/0","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",9],["!in","Viz",2]],"minzoom":15,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[15,"#f8f8f7"],[18,"#ffffff"]]},"line-dasharray":{"stops":[[15,[3,3]],[17,[2,2]]]},"line-width":{"base":1.2,"stops":[[15,1.3],[17,2.5]]}}},{"id":"Road/4WD/0","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",10],["!in","Viz",2]],"minzoom":13,"layout":{"line-join":"round"},"paint":{"line-color":"#FFFFFF","line-width":{"base":1.2,"stops":[[11,0.75],[14,1.3],[17,7.3],[20,48]]}}},{"id":"Road/Service/0","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",8],["!in","Viz",2]],"minzoom":13,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#FFFFFF","line-width":{"base":1.2,"stops":[[11,0.75],[14,1.3],[17,8.3],[20,43]]}}},{"id":"Road/Local/0","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",7],["!in","Viz",2]],"minzoom":12,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[12,"#fcfbf9"],[13,"#ffffff"]]},"line-width":{"base":1.4,"stops":[[11,1.1],[14,2],[16,6],[17,14],[20,45]]}}},{"id":"Road/Minor, ramp or traffic circle/0","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",6],["!in","Viz",2]],"minzoom":9,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[9,"#f0efea"],[13,"#ffffff"]]},"line-width":{"base":1.2,"stops":[[9,0.75],[14,2],[16,9.5],[17,17],[20,55]]}}},{"id":"Road/Minor/0","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",5],["!in","Viz",2]],"minzoom":9,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[9,"#f0efea"],[13,"#ffffff"]]},"line-width":{"base":1.2,"stops":[[9,1.3],[14,4.5],[16,9.5],[17,17],[20,55]]}}},{"id":"Road/Major, ramp or traffic circle/0","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",4],["!in","Viz",2]],"minzoom":9,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[9,"#f0efea"],[13,"#ffffff"]]},"line-width":{"base":1.2,"stops":[[9,1.3],[14,5.3],[16,10.3],[17,20],[20,60]]}}},{"id":"Road/Major/0","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",3],["!in","Viz",2]],"minzoom":8,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[9,"#f0efea"],[13,"#ffffff"]]},"line-width":{"base":1.2,"stops":[[8,1.3],[14,5.3],[16,10.3],[17,20],[20,60]]}}},{"id":"Road/Freeway Motorway, ramp or traffic circle/1","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",2],["!in","Viz",2]],"minzoom":6,"layout":{"line-join":"round","line-cap":"round"},"paint":{"line-color":"#ffffff","line-width":{"base":1.2,"stops":[[9,0.3],[14,8.3],[16,14.3],[17,30],[20,52]]}}},{"id":"Road/Highway/1","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",1],["!in","Viz",2]],"minzoom":6,"layout":{"line-join":"round"},"paint":{"line-color":"#ffffff","line-width":{"base":1.2,"stops":[[6,0.3],[14,8.3],[16,14.3],[17,30],[20,52]]}}},{"id":"Road/Freeway Motorway/1","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",0],["!in","Viz",2]],"minzoom":5,"layout":{"line-join":"round"},"paint":{"line-color":"#ffffff","line-width":{"base":1.2,"stops":[[5,0.3],[14,8.3],[16,14.3],[17,30],[20,52]]}}},{"id":"Road/Freeway Motorway, ramp or traffic circle/0","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",2],["!in","Viz",2]],"minzoom":6,"layout":{"line-join":"round","line-cap":"round"},"paint":{"line-color":{"stops":[[6,"#F6CA91"],[8,"#F6CA91"],[12,"#F6CA91"]]},"line-width":{"base":1.2,"stops":[[9,0.7],[14,6.3],[16,12.3],[17,28],[20,50]]}}},{"id":"Road/Highway/0","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",1],["!in","Viz",2]],"minzoom":6,"layout":{"line-join":"round"},"paint":{"line-color":{"stops":[[6,"#F6CA91"],[8,"#F6CA91"],[12,"#F6CA91"]]},"line-width":{"base":1.2,"stops":[[6,0.7],[14,6.3],[16,12.3],[17,28],[20,50]]}}},{"id":"Road/Freeway Motorway/0","type":"line","source":"esri","source-layer":"Road","filter":["all",["==","_symbol",0],["!in","Viz",2]],"minzoom":5,"layout":{"line-join":"round"},"paint":{"line-color":"#F6CA91","line-width":{"base":1.2,"stops":[[5,0.7],[14,6.3],[16,12.3],[17,28],[20,50]]}}},{"id":"Special area of interest line/Dock or pier","type":"line","source":"esri","source-layer":"Special area of interest line","filter":["==","_symbol",0],"minzoom":15,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#E8E7E5","line-width":{"base":1.2,"stops":[[15,0.5],[20,4]]}}},{"id":"Special area of interest line/Fence (chain link)/1","type":"line","source":"esri","source-layer":"Special area of interest line","filter":["==","_symbol",1],"minzoom":16,"layout":{"line-join":"round"},"paint":{"line-color":"#686868","line-opacity":0.5,"line-width":{"base":1.2,"stops":[[16,0.7],[20,3]]}}},{"id":"Special area of interest line/Fence (chain link)/0","type":"symbol","source":"esri","source-layer":"Special area of interest line","filter":["==","_symbol",1],"minzoom":16,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"icon-image":"Special area of interest line/Fence (chain link)/0","symbol-spacing":{"stops":[[16,7],[22,20]]},"icon-rotation-alignment":"map","icon-allow-overlap":true,"icon-padding":1,"icon-size":{"stops":[[16,0.25],[22,1]]}},"paint":{}},{"id":"Special area of interest line/Fence (metal)/1","type":"line","source":"esri","source-layer":"Special area of interest line","filter":["==","_symbol",2],"minzoom":16,"layout":{"line-join":"round"},"paint":{"line-color":"#686868","line-opacity":0.5,"line-width":{"base":1.2,"stops":[[16,0.7],[20,3]]}}},{"id":"Special area of interest line/Fence (metal)/0","type":"symbol","source":"esri","source-layer":"Special area of interest line","filter":["==","_symbol",2],"minzoom":16,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"icon-image":"Special area of interest line/Fence (metal)/0","symbol-spacing":{"stops":[[16,7],[22,20]]},"icon-rotation-alignment":"map","icon-allow-overlap":true,"icon-padding":1,"icon-size":{"stops":[[16,0.2],[22,0.9]]}},"paint":{}},{"id":"Special area of interest line/Fence (wood)/1","type":"line","source":"esri","source-layer":"Special area of interest line","filter":["==","_symbol",3],"minzoom":16,"layout":{"line-join":"round"},"paint":{"line-color":"#CDAA66","line-opacity":0.5,"line-width":{"base":1.2,"stops":[[16,0.7],[20,3]]}}},{"id":"Special area of interest line/Fence (wood)/0","type":"symbol","source":"esri","source-layer":"Special area of interest line","filter":["==","_symbol",3],"minzoom":16,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"icon-image":"Special area of interest line/Fence (wood)/0","symbol-spacing":{"stops":[[16,7],[22,20]]},"icon-rotation-alignment":"map","icon-allow-overlap":true,"icon-padding":1,"icon-size":{"stops":[[16,0.2],[22,0.9]]}},"paint":{}},{"id":"Special area of interest line/Gate/2","type":"line","source":"esri","source-layer":"Special area of interest line","filter":["==","_symbol",4],"minzoom":16,"layout":{"line-join":"round"},"paint":{"line-color":"#686868","line-width":{"base":1.2,"stops":[[16,2],[20,7]]}}},{"id":"Special area of interest line/Gate/1","type":"line","source":"esri","source-layer":"Special area of interest line","filter":["==","_symbol",4],"minzoom":16,"layout":{"line-join":"round"},"paint":{"line-color":"#E1E1E1","line-width":{"base":1.2,"stops":[[16,1],[20,5]]}}},{"id":"Special area of interest line/Gate/0","type":"line","source":"esri","source-layer":"Special area of interest line","filter":["==","_symbol",4],"minzoom":16,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#686868","line-dasharray":[5,15],"line-width":0.7}},{"id":"Special area of interest line/Wall/2","type":"line","source":"esri","source-layer":"Special area of interest line","filter":["==","_symbol",7],"minzoom":16,"layout":{"line-join":"round"},"paint":{"line-color":"#BCB7AE","line-width":{"base":1.2,"stops":[[16,4],[20,7]]}}},{"id":"Special area of interest line/Wall/1","type":"line","source":"esri","source-layer":"Special area of interest line","filter":["==","_symbol",7],"minzoom":16,"layout":{"line-join":"round"},"paint":{"line-color":"#e3e3e1","line-width":{"base":1.2,"stops":[[16,2],[20,5]]}}},{"id":"Special area of interest line/Wall/0","type":"line","source":"esri","source-layer":"Special area of interest line","filter":["==","_symbol",7],"minzoom":16,"layout":{"line-join":"round"},"paint":{"line-color":"#BCB7AE","line-width":0.5}},{"id":"Building/1","type":"fill","source":"esri","source-layer":"Building","minzoom":18,"layout":{},"paint":{"fill-color":"#6f6c68","fill-opacity":0.15,"fill-translate":{"stops":[[18,[2,2]],[20,[10,10]]]},"fill-translate-anchor":"viewport"}},{"id":"Building/General","type":"fill","source":"esri","source-layer":"Building","minzoom":15,"layout":{},"paint":{"fill-color":{"stops":[[15,"#ebe7e2"],[20,"#D1C4BA"]]}}},{"id":"Building/pattern","type":"fill","source":"esri","source-layer":"Building","minzoom":16,"layout":{},"paint":{"fill-pattern":"Building","fill-opacity":0.15}},{"id":"Building/line","type":"line","source":"esri","source-layer":"Building","minzoom":15,"layout":{},"paint":{"line-color":{"stops":[[15,"#dbd4cb"],[22,"#ac9c92"]]},"line-width":{"stops":[[15,0.5],[20,1.5]]}}},{"id":"Special area of interest line/Parking lot","type":"line","source":"esri","source-layer":"Special area of interest line","filter":["==","_symbol",5],"minzoom":15,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#E8E7E5","line-width":{"base":1.2,"stops":[[15,0.5],[20,4]]}}},{"id":"Road tunnel/4WD/1","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",10],["!in","Viz",2]],"minzoom":13,"layout":{"line-join":"round"},"paint":{"line-color":"#e3e1dc","line-dasharray":[2,1],"line-opacity":0.5,"line-width":{"base":1.2,"stops":[[11,1.5],[14,2.3],[17,8.3],[20,49]]}}},{"id":"Road tunnel/Minor, ramp or traffic circle/1","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",6],["!in","Viz",2]],"minzoom":9,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[9,"#E2DFD6"],[10,"#dedbd1"],[12,"#e3e1dc"]]},"line-opacity":0.5,"line-width":{"base":1.2,"stops":[[9.9,1],[14,4],[16,11.5],[17,19],[20,57]]}}},{"id":"Road tunnel/Minor/1","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",5],["!in","Viz",2]],"minzoom":9,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[9,"#E2DFD6"],[10,"#dedbd1"],[12,"#e3e1dc"]]},"line-opacity":0.5,"line-width":{"base":1.2,"stops":[[9,1],[10,3.3],[14,5.5],[16,11.5],[17,19],[20,57]]}}},{"id":"Road tunnel/Major, ramp or traffic circle/1","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",4],["!in","Viz",2]],"minzoom":9,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[9,"#dedbd1"],[12,"#e3e1dc"]]},"line-opacity":0.5,"line-width":{"base":1.2,"stops":[[9,3.3],[14,7.3],[16,12.3],[17,22],[20,62]]}}},{"id":"Road tunnel/Major/1","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",3],["!in","Viz",2]],"minzoom":8,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[8,"#dedbd1"],[12,"#e3e1dc"]]},"line-opacity":0.5,"line-width":{"base":1,"stops":[[8,3.3],[14,7.3],[16,12.3],[17,22],[20,62]]}}},{"id":"Road tunnel/Pedestrian/0","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",9],["!in","Viz",2]],"minzoom":15,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#FFFFFF","line-opacity":0.5,"line-width":{"base":1.2,"stops":[[14,1.6],[16,2],[17,8],[20,45]]}}},{"id":"Road tunnel/4WD/0","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",10],["!in","Viz",2]],"minzoom":13,"layout":{"line-join":"round"},"paint":{"line-color":"#FFFFFF","line-opacity":0.5,"line-width":{"base":1.2,"stops":[[11,0.75],[14,1.3],[17,7.3],[20,48]]}}},{"id":"Road tunnel/Service/0","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",8],["!in","Viz",2]],"minzoom":13,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#FFFFFF","line-opacity":0.5,"line-width":{"base":1.2,"stops":[[11,0.75],[14,1.3],[17,8.3],[20,48]]}}},{"id":"Road tunnel/Local/0","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",7],["!in","Viz",2]],"minzoom":12,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[12,"#fcfbf9"],[13,"#ffffff"]]},"line-opacity":0.5,"line-width":{"base":1.4,"stops":[[11,1.1],[14,2],[16,6],[17,14],[20,55]]}}},{"id":"Road tunnel/Minor, ramp or traffic circle/0","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",6],["!in","Viz",2]],"minzoom":9,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[9,"#f0efea"],[13,"#ffffff"]]},"line-opacity":0.5,"line-width":{"base":1.2,"stops":[[9,0.75],[14,2],[16,9.5],[17,17],[20,55]]}}},{"id":"Road tunnel/Minor/0","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",5],["!in","Viz",2]],"minzoom":9,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[9,"#f0efea"],[13,"#ffffff"]]},"line-opacity":0.5,"line-width":{"base":1.2,"stops":[[9,1.3],[14,4.5],[16,9.5],[17,17],[20,55]]}}},{"id":"Road tunnel/Major, ramp or traffic circle/0","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",4],["!in","Viz",2]],"minzoom":9,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[9,"#f0efea"],[13,"#ffffff"]]},"line-opacity":0.5,"line-width":{"base":1.2,"stops":[[9,1.3],[14,5.3],[16,10.3],[17,20],[20,60]]}}},{"id":"Road tunnel/Major/0","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",3],["!in","Viz",2]],"minzoom":8,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[9,"#f0efea"],[13,"#ffffff"]]},"line-opacity":0.5,"line-width":{"base":1.2,"stops":[[8,1.3],[14,5.3],[16,10.3],[17,20],[20,60]]}}},{"id":"Road tunnel/Freeway Motorway, ramp or traffic circle/1","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",2],["!in","Viz",2]],"minzoom":6,"layout":{"line-join":"round","line-cap":"round"},"paint":{"line-color":"#ffffff","line-opacity":0.5,"line-width":{"base":1.2,"stops":[[9,0.3],[14,8.3],[16,14.3],[17,30],[20,52]]}}},{"id":"Road tunnel/Highway/1","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",1],["!in","Viz",2]],"minzoom":6,"layout":{"line-join":"round"},"paint":{"line-color":"#ffffff","line-opacity":0.5,"line-width":{"base":1.2,"stops":[[6,0.3],[14,8.3],[16,14.3],[17,30],[20,52]]}}},{"id":"Road tunnel/Freeway Motorway/1","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",0],["!in","Viz",2]],"minzoom":5,"layout":{"line-join":"round"},"paint":{"line-color":"#ffffff","line-opacity":0.5,"line-width":{"base":1.2,"stops":[[5,0.3],[14,8.3],[16,14.3],[17,30],[20,52]]}}},{"id":"Road tunnel/Freeway Motorway, ramp or traffic circle/0","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",2],["!in","Viz",2]],"minzoom":6,"layout":{"line-join":"round","line-cap":"round"},"paint":{"line-color":{"stops":[[6,"#F6CA91"],[8,"#F6CA91"],[12,"#F6CA91"]]},"line-opacity":0.5,"line-width":{"base":1.2,"stops":[[9,0.7],[14,6.3],[16,12.3],[17,28],[20,50]]}}},{"id":"Road tunnel/Highway/0","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",1],["!in","Viz",2]],"minzoom":6,"layout":{"line-join":"round"},"paint":{"line-color":{"stops":[[6,"#F6CA91"],[8,"#F6CA91"],[12,"#F6CA91"]]},"line-opacity":0.5,"line-width":{"base":1.2,"stops":[[6,0.7],[14,6.3],[16,12.3],[17,28],[20,50]]}}},{"id":"Road tunnel/Freeway Motorway/0","type":"line","source":"esri","source-layer":"Road tunnel","filter":["all",["==","_symbol",0],["!in","Viz",2]],"minzoom":5,"layout":{"line-join":"round"},"paint":{"line-color":"#F6CA91","line-opacity":0.5,"line-width":{"base":1.2,"stops":[[5,0.7],[14,6.3],[16,12.3],[17,28],[20,50]]}}},{"id":"Special area of interest/Gutter","type":"fill","source":"esri","source-layer":"Special area of interest","filter":["in","_symbol",9,3],"minzoom":14,"layout":{},"paint":{"fill-color":"#E8E7E5","fill-outline-color":"#bcb7ae"}},{"id":"Boundary line/Disputed admin2","type":"line","source":"esri","source-layer":"Boundary line","filter":["all",["==","_symbol",8],["!in","Viz",2]],"minzoom":9,"layout":{"line-join":"round"},"paint":{"line-color":{"stops":[[1,"#f5f5f5"],[3,"#fafafa"],[9,"#ffffff"]]},"line-width":{"base":1.2,"stops":[[1,0.65],[14,1.3],[17,2.5]]},"line-dasharray":[5,5]}},{"id":"Boundary line/Disputed admin1/1","type":"line","source":"esri","source-layer":"Boundary line","minzoom":3,"filter":["all",["==","_symbol",7],["!in","Viz",2]],"layout":{"line-join":"round"},"paint":{"line-color":"#c6c4b6","line-opacity":0.95,"line-width":{"base":1,"stops":[[4,0.5],[14,7],[17,7]]}}},{"id":"Boundary line/Disputed admin0/1","type":"line","source":"esri","source-layer":"Boundary line","filter":["all",["==","_symbol",6],["!in","Viz",2],["!in","DisputeID",8,16,90,96,0]],"minzoom":1,"layout":{"line-join":"round"},"paint":{"line-color":"#c6c4b6","line-opacity":0.95,"line-width":{"base":1,"stops":[[1,0.5],[14,9.3],[17,9.3]]}}},{"id":"Boundary line/Disputed admin1/0","type":"line","source":"esri","source-layer":"Boundary line","minzoom":3,"filter":["all",["==","_symbol",7],["!in","Viz",2]],"layout":{"line-join":"round"},"paint":{"line-color":{"stops":[[1,"#f5f5f5"],[3,"#fafafa"],[9,"#ffffff"]]},"line-width":{"base":1.2,"stops":[[1,0.65],[14,1.3],[17,2.5]]},"line-dasharray":[5,5]}},{"id":"Boundary line/Disputed admin0/0","type":"line","source":"esri","source-layer":"Boundary line","filter":["all",["==","_symbol",6],["!in","Viz",2],["!in","DisputeID",8,16,90,96,0]],"minzoom":1,"layout":{"line-join":"round"},"paint":{"line-color":{"stops":[[1,"#f5f5f5"],[3,"#fafafa"],[9,"#ffffff"]]},"line-width":{"base":1.2,"stops":[[1,0.65],[14,1.3],[17,2.5]]},"line-dasharray":[5,5]}},{"id":"Boundary line/Admin2/1","type":"line","source":"esri","source-layer":"Boundary line","filter":["all",["==","_symbol",2],["!in","Viz",2]],"minzoom":10,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#ede7e0","line-opacity":0.6,"line-width":{"base":1.2,"stops":[[8,2.3],[14,5.5],[17,7.5]]}}},{"id":"Boundary line/Admin1/1","type":"line","source":"esri","source-layer":"Boundary line","filter":["all",["==","_symbol",1],["!in","Viz",2]],"minzoom":3,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[3,"#DEE1CC"],[10,"#d1ceb8"]]},"line-opacity":0.5,"line-width":{"base":1,"stops":[[3,0.5],[14,9],[17,10]]}}},{"id":"Boundary line/Admin0/1","type":"line","source":"esri","source-layer":"Boundary line","filter":["all",["==","_symbol",0],["!in","Viz",2]],"minzoom":1,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#d1cfc2","line-width":{"base":1,"stops":[[1,0.5],[14,11.3],[17,12.3]]}}},{"id":"Boundary line/Admin5","type":"line","source":"esri","source-layer":"Boundary line","filter":["all",["==","_symbol",5],["!in","Viz",2]],"minzoom":16,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#9C9C9C","line-width":{"base":1.2,"stops":[[14,1],[17,1]]},"line-dasharray":[6,4]}},{"id":"Boundary line/Admin4","type":"line","source":"esri","source-layer":"Boundary line","filter":["all",["==","_symbol",4],["!in","Viz",2]],"minzoom":16,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#9C9C9C","line-width":{"base":1.2,"stops":[[14,1],[17,1]]},"line-dasharray":[6,4]}},{"id":"Boundary line/Admin3","type":"line","source":"esri","source-layer":"Boundary line","filter":["all",["==","_symbol",3],["!in","Viz",2]],"minzoom":16,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#9C9C9C","line-width":{"base":1.2,"stops":[[14,1],[17,1]]},"line-dasharray":[6,4]}},{"id":"Boundary line/Admin2/0","type":"line","source":"esri","source-layer":"Boundary line","filter":["all",["==","_symbol",2],["!in","Viz",2]],"minzoom":9,"layout":{"line-join":"round"},"paint":{"line-color":"#888577","line-dasharray":[7,5],"line-width":{"base":1.2,"stops":[[8,0.5],[14,1]]}}},{"id":"Boundary line/Admin1/0","type":"line","source":"esri","source-layer":"Boundary line","filter":["all",["==","_symbol",1],["!in","Viz",2]],"minzoom":3,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[3,"#c1bdb5"],[4,"#9b9382"]]},"line-width":{"base":1,"stops":[[4,0.5],[14,1.3],[17,1.3]]}}},{"id":"Boundary line/Admin0/0","type":"line","source":"esri","source-layer":"Boundary line","filter":["all",["==","_symbol",0],["!in","Viz",2]],"minzoom":1,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[1,"#b9b9b9"],[7,"#434242"]]},"line-width":{"base":1.2,"stops":[[1,0.5],[14,1.3],[17,2]]}}},{"id":"Coastline","type":"line","source":"esri","source-layer":"Coastline","maxzoom":9,"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":{"stops":[[0,"#53B9EA"],[7,"#53B9EA"],[9,"#6BC4F0"]]},"line-width":{"base":1.2,"stops":[[0,0.5],[9,1.3]]}}},{"id":"Tree/Elm","type":"symbol","source":"esri","source-layer":"Tree","filter":["==","_symbol",0],"minzoom":16,"layout":{"symbol-avoid-edges":true,"icon-image":"Tree/Elm","icon-allow-overlap":true,"icon-padding":1,"icon-size":{"stops":[[16,0.07],[17,0.18],[18,0.3],[20,1]]}},"paint":{"icon-opacity":{"stops":[[16,0.4],[17,0.6],[20,0.9]]}}},{"id":"Tree/Eucalyptus","type":"symbol","source":"esri","source-layer":"Tree","filter":["==","_symbol",1],"minzoom":16,"layout":{"symbol-avoid-edges":true,"icon-image":"Tree/Eucalyptus","icon-allow-overlap":true,"icon-padding":1,"icon-size":{"stops":[[16,0.07],[17,0.18],[18,0.3],[20,1]]}},"paint":{"icon-opacity":{"stops":[[16,0.4],[17,0.6],[20,0.9]]}}},{"id":"Tree/Maple","type":"symbol","source":"esri","source-layer":"Tree","filter":["==","_symbol",2],"minzoom":16,"layout":{"symbol-avoid-edges":true,"icon-image":"Tree/Maple","icon-allow-overlap":true,"icon-padding":1,"icon-size":{"stops":[[16,0.07],[17,0.18],[18,0.3],[20,1]]}},"paint":{"icon-opacity":{"stops":[[16,0.4],[17,0.6],[20,0.9]]}}},{"id":"Tree/Oak","type":"symbol","source":"esri","source-layer":"Tree","filter":["==","_symbol",3],"minzoom":16,"layout":{"symbol-avoid-edges":true,"icon-image":"Tree/Oak","icon-allow-overlap":true,"icon-padding":1,"icon-size":{"stops":[[16,0.07],[17,0.18],[18,0.3],[20,1]]}},"paint":{"icon-opacity":{"stops":[[16,0.4],[17,0.6],[20,0.9]]}}},{"id":"Tree/Orange","type":"symbol","source":"esri","source-layer":"Tree","filter":["==","_symbol",4],"minzoom":16,"layout":{"symbol-avoid-edges":true,"icon-image":"Tree/Orange","icon-allow-overlap":true,"icon-padding":1,"icon-size":{"stops":[[16,0.07],[17,0.18],[18,0.3],[20,1]]}},"paint":{"icon-opacity":{"stops":[[16,0.4],[17,0.6],[20,0.9]]}}},{"id":"Tree/Palm","type":"symbol","source":"esri","source-layer":"Tree","filter":["==","_symbol",5],"minzoom":16,"layout":{"symbol-avoid-edges":true,"icon-image":"Tree/Palm","icon-allow-overlap":true,"icon-padding":1,"icon-size":{"stops":[[16,0.07],[17,0.18],[18,0.3],[20,1]]}},"paint":{"icon-opacity":{"stops":[[16,0.4],[17,0.6],[20,0.9]]}}},{"id":"Tree/Pine","type":"symbol","source":"esri","source-layer":"Tree","filter":["==","_symbol",6],"minzoom":16,"layout":{"symbol-avoid-edges":true,"icon-image":"Tree/Pine","icon-allow-overlap":true,"icon-padding":1,"icon-size":{"stops":[[16,0.07],[17,0.18],[18,0.3],[20,1]]}},"paint":{"icon-opacity":{"stops":[[16,0.4],[17,0.6],[20,0.9]]}}},{"id":"Tree/Spruce","type":"symbol","source":"esri","source-layer":"Tree","filter":["==","_symbol",7],"minzoom":16,"layout":{"symbol-avoid-edges":true,"icon-image":"Tree/Spruce","icon-allow-overlap":true,"icon-padding":1,"icon-size":{"stops":[[16,0.07],[17,0.18],[18,0.3],[20,1]]}},"paint":{"icon-opacity":{"stops":[[16,0.4],[17,0.6],[20,0.9]]}}},{"id":"Shrub","type":"symbol","source":"esri","source-layer":"Shrub","minzoom":16,"layout":{"symbol-avoid-edges":true,"icon-image":"Shrub","icon-allow-overlap":true,"icon-padding":1,"icon-size":{"stops":[[16,0.07],[17,0.18],[18,0.3],[20,1]]}},"paint":{"icon-opacity":{"stops":[[16,0.4],[17,0.6],[20,0.9]]}}},{"id":"Pavement marking/Arrow","type":"symbol","source":"esri","source-layer":"Pavement marking","minzoom":17,"filter":["==","_symbol",0],"layout":{"icon-rotation-alignment":"map","icon-image":"Pavement marking/Arrow","icon-size":{"stops":[[17,0.5],[22,1]]},"icon-rotate":{"type":"identity","property":"angle","default":0},"icon-allow-overlap":true},"paint":{"icon-color":"#B2B2B2"}},{"id":"Pavement marking/Handicap","type":"symbol","source":"esri","source-layer":"Pavement marking","minzoom":18,"filter":["==","_symbol",1],"layout":{"icon-rotation-alignment":"map","icon-image":"Pavement marking/Handicap","icon-size":{"stops":[[18,0.5],[20,1],[22,1.25]]},"icon-rotate":{"type":"identity","property":"angle","default":0},"icon-allow-overlap":true},"paint":{"icon-color":"#296AA3","icon-opacity":{"stops":[[18,0.65],[20,1]]}}},{"id":"Pavement marking/Left turn","type":"symbol","source":"esri","source-layer":"Pavement marking","minzoom":17,"filter":["==","_symbol",2],"layout":{"icon-rotation-alignment":"map","icon-image":"Pavement marking/Left turn","icon-size":{"stops":[[17,0.5],[22,1]]},"icon-rotate":{"type":"identity","property":"angle","default":0},"icon-allow-overlap":true},"paint":{"icon-color":"#B2B2B2"}},{"id":"Pavement marking/Right turn","type":"symbol","source":"esri","source-layer":"Pavement marking","minzoom":17,"filter":["==","_symbol",3],"layout":{"icon-rotation-alignment":"map","icon-image":"Pavement marking/Right turn","icon-size":{"stops":[[17,0.5],[22,1]]},"icon-rotate":{"type":"identity","property":"angle","default":0},"icon-allow-overlap":true},"paint":{"icon-color":"#B2B2B2"}},{"id":"Pavement marking/Two-way left turn","type":"symbol","source":"esri","source-layer":"Pavement marking","minzoom":17,"filter":["==","_symbol",4],"layout":{"icon-rotation-alignment":"map","icon-image":"Pavement marking/Two-way left turn","icon-size":{"stops":[[17,0.5],[22,1]]},"icon-rotate":{"type":"identity","property":"angle","default":0},"icon-allow-overlap":true},"paint":{"icon-color":"#B2B2B2"}},{"id":"Pavement marking/U-turn","type":"symbol","source":"esri","source-layer":"Pavement marking","minzoom":17,"filter":["==","_symbol",5],"layout":{"icon-rotation-alignment":"map","icon-image":"Pavement marking/U-turn","icon-size":{"stops":[[17,0.5],[22,1]]},"icon-rotate":{"type":"identity","property":"angle","default":0},"icon-allow-overlap":true},"paint":{"icon-color":"#B2B2B2"}},{"id":"Water point/Sea or ocean","type":"symbol","source":"esri","source-layer":"Water point","filter":["==","_label_class",0],"minzoom":9,"layout":{"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":{"stops":[[9,8.5],[15,15.5]]},"text-letter-spacing":0.3,"text-line-height":1.6,"text-max-width":4,"text-field":"{_name_global}","text-padding":15},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#FFFFFF","text-halo-width":1}},{"id":"Water point/Island","type":"symbol","source":"esri","source-layer":"Water point","filter":["==","_label_class",7],"minzoom":9,"layout":{"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":{"stops":[[9,8.5],[15,10]]},"text-letter-spacing":0.1,"text-max-width":4,"text-field":"{_name_global}","text-padding":15},"paint":{"text-color":"#595959","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":1}},{"id":"Water point/Dam or weir","type":"symbol","source":"esri","source-layer":"Water point","filter":["==","_label_class",5],"minzoom":9,"layout":{"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[9,8.5],[15,10]]},"text-letter-spacing":0.1,"text-max-width":4,"text-field":"{_name_global}","text-padding":15},"paint":{"text-color":"#171310","text-halo-color":"#EBE7E2","text-halo-width":0.7,"text-halo-blur":1}},{"id":"Water point/Playa","type":"symbol","source":"esri","source-layer":"Water point","filter":["==","_label_class",6],"minzoom":9,"layout":{"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":{"stops":[[9,8.5],[15,10]]},"text-letter-spacing":0.1,"text-max-width":4,"text-field":"{_name_global}","text-padding":15},"paint":{"text-color":"#171310","text-halo-color":"#EBE7E2","text-halo-width":0.7,"text-halo-blur":1}},{"id":"Water point/Canal or ditch","type":"symbol","source":"esri","source-layer":"Water point","filter":["==","_label_class",4],"minzoom":9,"layout":{"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":{"stops":[[9,8.5],[15,10]]},"text-letter-spacing":0.13,"text-max-width":4,"text-field":"{_name_global}","text-padding":15},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":1}},{"id":"Water point/Stream or river","type":"symbol","source":"esri","source-layer":"Water point","filter":["==","_label_class",3],"minzoom":9,"layout":{"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":{"stops":[[9,8.5],[15,10]]},"text-letter-spacing":0.1,"text-max-width":4,"text-field":"{_name_global}","text-padding":15},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":0.5}},{"id":"Water point/Lake or reservoir","type":"symbol","source":"esri","source-layer":"Water point","filter":["==","_label_class",2],"minzoom":9,"layout":{"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":{"stops":[[9,8.5],[15,10]]},"text-letter-spacing":0.1,"text-max-width":4,"text-field":"{_name_global}","text-padding":15},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#FFFFFF","text-halo-width":0.5}},{"id":"Water point/Bay or inlet","type":"symbol","source":"esri","source-layer":"Water point","filter":["==","_label_class",1],"minzoom":9,"layout":{"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":{"stops":[[9,8.5],[15,10]]},"text-letter-spacing":0.1,"text-max-width":4,"text-field":"{_name_global}","text-padding":15},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":0.5}},{"id":"Ferry/label/Ferry","type":"symbol","source":"esri","source-layer":"Ferry/label","filter":["all",["==","_label_class",0],["!in","Viz",2]],"minzoom":12,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":10,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name_global}","text-padding":30},"paint":{"text-color":"#ffffff","text-halo-width":1.2,"text-halo-color":"#6BC4F0","text-halo-blur":1}},{"id":"Water line/label/Default","type":"symbol","source":"esri","source-layer":"Water line/label","minzoom":11,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":9.5,"text-letter-spacing":0.07,"text-max-width":8,"text-max-angle":35,"text-field":"{_name_global}","text-padding":1,"text-offset":[0,-0.5],"symbol-spacing":800},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":0.5}},{"id":"Water line large scale/label/Default","type":"symbol","source":"esri","source-layer":"Water line large scale/label","minzoom":7,"maxzoom":11,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":9.3,"text-letter-spacing":0.01,"text-max-width":8,"text-max-angle":{"stops":[[7,25],[11,35]]},"text-field":"{_name}","text-padding":1,"text-offset":[0,-0.5],"symbol-spacing":800},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":0.5}},{"id":"Water line medium scale/label/Default","type":"symbol","source":"esri","source-layer":"Water line medium scale/label","minzoom":5,"maxzoom":7,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":9.3,"text-letter-spacing":0.1,"text-max-width":8,"text-max-angle":{"stops":[[5,15],[6,25]]},"text-field":"{_name}","text-padding":1,"text-offset":[0,-0.5],"symbol-spacing":800},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":0.5}},{"id":"Water line small scale/label/Default","type":"symbol","source":"esri","source-layer":"Water line small scale/label","minzoom":4,"maxzoom":5,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":8.5,"text-letter-spacing":0.1,"text-max-width":8,"text-max-angle":18,"text-field":"{_name}","text-padding":1,"text-offset":[0,-0.5],"symbol-spacing":800},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":0.5}},{"id":"Marine park/label/Default","type":"symbol","source":"esri","source-layer":"Marine park/label","minzoom":11,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#3a7795"}},{"id":"Water area/label/Dam or weir","type":"symbol","source":"esri","source-layer":"Water area/label","filter":["==","_label_class",8],"minzoom":11,"layout":{"text-font":["Montserrat SemiBold"],"text-size":9.5,"text-letter-spacing":0.08,"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#171310","text-halo-color":"#EBE7E2","text-halo-width":0.5,"text-halo-blur":1}},{"id":"Water area/label/Playa","type":"symbol","source":"esri","source-layer":"Water area/label","filter":["==","_label_class",9],"minzoom":11,"layout":{"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":9.5,"text-letter-spacing":0.08,"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#171310","text-halo-color":"#EBE7E2","text-halo-width":0.5,"text-halo-blur":1}},{"id":"Water area/label/Canal or ditch","type":"symbol","source":"esri","source-layer":"Water area/label","filter":["==","_label_class",2],"minzoom":11,"layout":{"text-font":["Avenir Next LT Pro Demi Italic"],"symbol-placement":"line","symbol-spacing":1000,"text-size":10.5,"text-letter-spacing":0.13,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true,"text-max-width":5},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":0.5}},{"id":"Water area/label/Small river","type":"symbol","source":"esri","source-layer":"Water area/label","filter":["==","_label_class",7],"minzoom":11,"layout":{"text-font":["Avenir Next LT Pro Demi Italic"],"symbol-placement":"line","symbol-spacing":1000,"text-size":10.5,"text-letter-spacing":0.13,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true,"text-max-width":8},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":0.5}},{"id":"Water area/label/Large river","type":"symbol","source":"esri","source-layer":"Water area/label","filter":["==","_label_class",4],"minzoom":11,"layout":{"text-font":["Avenir Next LT Pro Demi Italic"],"symbol-placement":"line","symbol-spacing":1000,"text-size":10.5,"text-letter-spacing":0.13,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true,"text-max-width":8},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":0.5}},{"id":"Water area/label/Small lake or reservoir","type":"symbol","source":"esri","source-layer":"Water area/label","filter":["==","_label_class",6],"minzoom":11,"layout":{"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":10.5,"text-letter-spacing":0.13,"text-line-height":1,"text-max-width":4,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":0.5}},{"id":"Water area/label/Large lake or reservoir","type":"symbol","source":"esri","source-layer":"Water area/label","filter":["==","_label_class",3],"minzoom":11,"layout":{"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":10.5,"text-letter-spacing":0.13,"text-line-height":1.5,"text-max-width":4,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":0.5}},{"id":"Water area/label/Bay or inlet","type":"symbol","source":"esri","source-layer":"Water area/label","filter":["==","_label_class",1],"minzoom":11,"layout":{"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":10.5,"text-letter-spacing":0.13,"text-line-height":1.5,"text-max-width":4,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":0.5}},{"id":"Water area/label/Small island","type":"symbol","source":"esri","source-layer":"Water area/label","filter":["==","_label_class",0],"minzoom":11,"layout":{"text-size":10.5,"text-letter-spacing":0.1,"text-max-width":4,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Demi Italic"]},"paint":{"text-color":"#595959","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":1}},{"id":"Water area/label/Large island","type":"symbol","source":"esri","source-layer":"Water area/label","filter":["==","_label_class",5],"minzoom":11,"layout":{"text-size":10.5,"text-letter-spacing":0.13,"text-line-height":1.5,"text-max-width":4,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Demi Italic"]},"paint":{"text-color":"#595959","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":1}},{"id":"Water area large scale/label/River","type":"symbol","source":"esri","source-layer":"Water area large scale/label","filter":["==","_label_class",1],"minzoom":7,"maxzoom":11,"layout":{"text-font":["Avenir Next LT Pro Demi Italic"],"symbol-placement":"line","symbol-spacing":1000,"text-size":9.3,"text-letter-spacing":0.1,"text-field":"{_name}","text-padding":15,"symbol-avoid-edges":true,"text-max-width":4},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":0.5}},{"id":"Water area large scale/label/Lake or lake intermittent","type":"symbol","source":"esri","source-layer":"Water area large scale/label","filter":["==","_label_class",0],"minzoom":7,"maxzoom":11,"layout":{"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":9.3,"text-letter-spacing":0.1,"text-max-width":4,"text-field":"{_name}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":0.5}},{"id":"Water area medium scale/label/Default","type":"symbol","source":"esri","source-layer":"Water area medium scale/label","minzoom":5,"maxzoom":7,"layout":{"text-max-width":4,"text-field":"{_name}","text-padding":15,"symbol-avoid-edges":true,"text-letter-spacing":0.08,"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":9.3},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":0.5}},{"id":"Water area small scale/label/Default","type":"symbol","source":"esri","source-layer":"Water area small scale/label","minzoom":1,"maxzoom":5,"layout":{"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":9.3,"text-letter-spacing":0.08,"text-max-width":4,"text-field":"{_name}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":0.5}},{"id":"Marine area/label/Default","type":"symbol","source":"esri","source-layer":"Marine area/label","minzoom":11,"layout":{"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":10.5,"text-letter-spacing":0.13,"text-line-height":1.5,"text-max-width":4,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#82CFF5","text-halo-width":1}},{"id":"Marine waterbody/label/small","type":"symbol","source":"esri","source-layer":"Marine waterbody/label","filter":["==","_label_class",4],"minzoom":1,"maxzoom":10,"layout":{"text-font":["Avenir Next LT Pro Demi Italic"],"text-letter-spacing":{"stops":[[1,0.12],[10,0.25]]},"text-line-height":1.5,"text-max-width":6,"text-field":"{_name}","text-padding":15,"symbol-avoid-edges":true,"text-size":{"stops":[[1,8],[6,9.3]]}},"paint":{"text-color":{"stops":[[1,"#0d6c9a"],[6,"#0d6c9a"]]},"text-halo-blur":1,"text-halo-color":"#82CFF5","text-halo-width":0.5}},{"id":"Marine waterbody/label/medium","type":"symbol","source":"esri","source-layer":"Marine waterbody/label","filter":["==","_label_class",3],"minzoom":1,"maxzoom":10,"layout":{"text-font":["Avenir Next LT Pro Demi Italic"],"text-letter-spacing":{"stops":[[1,0.15],[10,0.3]]},"text-line-height":1.5,"text-max-width":6,"text-field":"{_name}","text-padding":15,"symbol-avoid-edges":true,"text-size":{"stops":[[1,8],[6,9.3]]}},"paint":{"text-color":{"stops":[[1,"#0d6c9a"],[6,"#0d6c9a"]]},"text-halo-blur":1,"text-halo-color":"#82CFF5","text-halo-width":0.5}},{"id":"Marine waterbody/label/large","type":"symbol","source":"esri","source-layer":"Marine waterbody/label","filter":["==","_label_class",2],"minzoom":1,"maxzoom":10,"layout":{"text-font":["Avenir Next LT Pro Demi Italic"],"text-letter-spacing":{"stops":[[1,0.18],[10,0.4]]},"text-line-height":1.5,"text-max-width":6,"text-field":"{_name}","text-padding":15,"symbol-avoid-edges":true,"text-size":{"stops":[[1,8],[6,10]]}},"paint":{"text-color":{"stops":[[1,"#0d6c9a"],[6,"#0d6c9a"]]},"text-halo-blur":1,"text-halo-color":"#82CFF5","text-halo-width":0.5}},{"id":"Marine waterbody/label/x large","type":"symbol","source":"esri","source-layer":"Marine waterbody/label","filter":["==","_label_class",1],"minzoom":1,"maxzoom":10,"layout":{"text-font":["Avenir Next LT Pro Demi Italic"],"text-letter-spacing":{"stops":[[1,0.2],[10,1.5]]},"text-line-height":1.5,"text-max-width":6,"text-field":"{_name}","text-padding":15,"symbol-avoid-edges":true,"text-size":{"stops":[[1,8],[6,11]]}},"paint":{"text-color":{"stops":[[1,"#0d6c9a"],[6,"#0d6c9a"]]},"text-halo-blur":1,"text-halo-color":"#82CFF5","text-halo-width":0.5}},{"id":"Marine waterbody/label/2x large","type":"symbol","source":"esri","source-layer":"Marine waterbody/label","filter":["==","_label_class",0],"minzoom":1,"maxzoom":10,"layout":{"text-font":["Avenir Next LT Pro Demi Italic"],"text-letter-spacing":{"stops":[[1,0.3],[10,2]]},"text-line-height":1.6,"text-max-width":6,"text-field":"{_name}","text-padding":15,"symbol-avoid-edges":true,"text-size":{"stops":[[1,10],[4,18]]}},"paint":{"text-color":"#0d6c9a","text-halo-blur":1,"text-halo-color":"#82CFF5","text-halo-width":0.5}},{"id":"Ferry/label/Rail ferry","type":"symbol","source":"esri","source-layer":"Ferry/label","filter":["all",["==","_label_class",1],["!in","Viz",2]],"minzoom":12,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":9,"text-letter-spacing":0.1,"text-max-width":8,"text-field":"{_name_global}","text-padding":5,"text-offset":[0,-0.6],"symbol-spacing":1000},"paint":{"text-color":"#4E4E4E","text-halo-color":"#FFFFFF","text-halo-width":1}},{"id":"Railroad/label/Default","type":"symbol","source":"esri","source-layer":"Railroad/label","minzoom":14,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":9,"text-letter-spacing":0.1,"text-max-width":8,"text-field":"{_name_global}","text-padding":5,"text-offset":[0,-0.6],"symbol-spacing":1000},"paint":{"text-color":"#4E4E4E","text-halo-color":"#EBE7E2","text-halo-width":1}},{"id":"Trail or path/label/Default","type":"symbol","source":"esri","source-layer":"Trail or path/label","minzoom":15,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"symbol-spacing":400,"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":9.3,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name_global}","text-padding":5},"paint":{"text-color":"#595959","text-halo-color":"#FFFFFF","text-halo-width":1}},{"id":"Road tunnel/label/Pedestrian","type":"symbol","source":"esri","source-layer":"Road tunnel/label","filter":["all",["==","_label_class",6],["!in","Viz",2]],"minzoom":15,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"symbol-spacing":400,"text-font":["Montserrat SemiBold"],"text-size":9.3,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name_global}","text-padding":5},"paint":{"text-color":"#595959","text-halo-color":"#FFFFFF","text-halo-width":1,"text-halo-blur":1}},{"id":"Road tunnel/label/Local, service, 4WD","type":"symbol","source":"esri","source-layer":"Road tunnel/label","filter":["all",["==","_label_class",5],["!in","Viz",2]],"minzoom":12,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"symbol-spacing":400,"text-font":["Montserrat SemiBold"],"text-size":9.5,"text-letter-spacing":0.09,"text-max-width":8,"text-field":"{_name_global}","text-padding":{"stops":[[12,5],[15,5],[16,15]]}},"paint":{"text-color":"#595959","text-halo-color":"#FFFFFF","text-halo-width":1,"text-halo-blur":1}},{"id":"Road tunnel/label/Minor","type":"symbol","source":"esri","source-layer":"Road tunnel/label","filter":["all",["==","_label_class",4],["!in","Viz",2]],"minzoom":10,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"symbol-spacing":400,"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[10,9.5],[14,10.5],[18,12.5]]},"text-letter-spacing":0.09,"text-max-width":8,"text-field":"{_name_global}","text-padding":{"stops":[[10,5],[15,5],[16,15]]}},"paint":{"text-color":"#595959","text-halo-color":"#FFFFFF","text-halo-width":1,"text-halo-blur":1}},{"id":"Road tunnel/label/Major, alt name","type":"symbol","source":"esri","source-layer":"Road tunnel/label","filter":["all",["==","_label_class",3],["!in","Viz",2]],"minzoom":10,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"symbol-spacing":400,"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[10,9.5],[14,10.5],[18,12.5]]},"text-letter-spacing":0.09,"text-max-width":8,"text-field":"{_name}","text-padding":{"stops":[[10,5],[15,5],[16,15]]}},"paint":{"text-color":"#4e4e4e","text-halo-color":"#FFFFFF","text-halo-width":1,"text-halo-blur":1}},{"id":"Road tunnel/label/Major","type":"symbol","source":"esri","source-layer":"Road tunnel/label","filter":["all",["==","_label_class",2],["!in","Viz",2]],"minzoom":10,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"symbol-spacing":400,"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[10,9.5],[14,10.5],[18,12.5]]},"text-letter-spacing":0.09,"text-max-width":8,"text-field":"{_name}","text-padding":{"stops":[[10,5],[15,5],[16,15]]}},"paint":{"text-color":"#4E4E4E","text-halo-color":"#FFFFFF","text-halo-width":1,"text-halo-blur":1}},{"id":"Road tunnel/label/Highway","type":"symbol","source":"esri","source-layer":"Road tunnel/label","filter":["all",["==","_label_class",7],["!in","Viz",2]],"minzoom":10,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"symbol-spacing":400,"text-font":["Avenir Next LT Pro Bold"],"text-size":{"stops":[[10,9.5],[14,10.5],[18,14.5]]},"text-letter-spacing":0.09,"text-max-width":8,"text-field":"{_name_global}","text-padding":{"stops":[[10,5],[15,5],[16,15]]}},"paint":{"text-color":"#4E4E4E","text-halo-color":"#FFFFFF","text-halo-width":1,"text-halo-blur":1}},{"id":"Road tunnel/label/Freeway Motorway, alt name","type":"symbol","source":"esri","source-layer":"Road tunnel/label","filter":["all",["==","_label_class",1],["!in","Viz",2]],"minzoom":10,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"symbol-spacing":400,"text-font":["Avenir Next LT Pro Bold"],"text-size":{"stops":[[10,9.5],[14,10.5],[18,14.5]]},"text-letter-spacing":0.09,"text-max-width":8,"text-field":"{_name_global}","text-padding":{"stops":[[10,5],[15,5],[16,15]]}},"paint":{"text-color":"#4E4E4E","text-halo-color":"#FFFFFF","text-halo-width":1,"text-halo-blur":1}},{"id":"Road tunnel/label/Freeway Motorway","type":"symbol","source":"esri","source-layer":"Road tunnel/label","filter":["all",["==","_label_class",0],["!in","Viz",2]],"minzoom":10,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"symbol-spacing":400,"text-font":["Avenir Next LT Pro Bold"],"text-size":{"stops":[[10,9.5],[14,10.5],[18,14.5]]},"text-letter-spacing":0.09,"text-max-width":8,"text-field":"{_name_global}","text-padding":{"stops":[[10,5],[15,5],[16,15]]}},"paint":{"text-color":"#4E4E4E","text-halo-color":"#FFFFFF","text-halo-width":1,"text-halo-blur":1}},{"id":"Road/label/Local","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",5],["!in","Viz",2]],"minzoom":12,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"symbol-spacing":400,"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[10,9.5],[14,10.5],[18,11.5]]},"text-letter-spacing":0.09,"text-max-width":8,"text-field":"{_name_global}","text-padding":{"stops":[[12,5],[15,5],[16,15]]}},"paint":{"text-color":"#595959","text-halo-color":"#FFFFFF","text-halo-width":1}},{"id":"Road/label/Minor","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",4],["!in","Viz",2]],"minzoom":10,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"symbol-spacing":400,"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[10,9.5],[14,10.5],[18,12.5]]},"text-letter-spacing":0.09,"text-max-width":8,"text-field":"{_name_global}","text-padding":{"stops":[[10,5],[15,5],[16,15]]}},"paint":{"text-color":"#595959","text-halo-color":"#FFFFFF","text-halo-width":1}},{"id":"Road/label/Major, alt name","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",3],["!in","Viz",2]],"minzoom":10,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"symbol-spacing":400,"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[10,9.5],[14,10.5],[18,12.5]]},"text-letter-spacing":0.09,"text-max-width":8,"text-field":"{_name}","text-padding":{"stops":[[10,5],[15,5],[16,15]]}},"paint":{"text-color":"#4E4E4E","text-halo-color":"#FFFFFF","text-halo-width":1}},{"id":"Road/label/Major","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",2],["!in","Viz",2]],"minzoom":10,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"symbol-spacing":400,"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[10,9.5],[14,10.5],[18,12.5]]},"text-letter-spacing":0.09,"text-max-width":8,"text-field":"{_name_global}","text-padding":{"stops":[[10,5],[15,5],[16,15]]}},"paint":{"text-color":"#4E4E4E","text-halo-color":"#FFFFFF","text-halo-width":1}},{"id":"Road/label/Highway","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",75],["!in","Viz",2]],"minzoom":10,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"symbol-spacing":400,"text-font":["Avenir Next LT Pro Bold"],"text-size":{"stops":[[10,9.5],[14,10.5],[18,14.5]]},"text-letter-spacing":0.09,"text-max-width":8,"text-field":"{_name_global}","text-padding":{"stops":[[10,5],[15,5],[16,15]]}},"paint":{"text-color":"#4E4E4E","text-halo-color":"#FFFFFF","text-halo-width":1}},{"id":"Road/label/Freeway Motorway, alt name","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",1],["!in","Viz",2]],"minzoom":10,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"symbol-spacing":400,"text-font":["Avenir Next LT Pro Bold"],"text-size":{"stops":[[10,9.5],[14,10.5],[18,14.5]]},"text-letter-spacing":0.09,"text-max-width":8,"text-field":"{_name}","text-padding":{"stops":[[10,5],[15,5],[16,15]]}},"paint":{"text-color":"#4E4E4E","text-halo-color":"#FFFFFF","text-halo-width":1}},{"id":"Road/label/Freeway Motorway","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",0],["!in","Viz",2]],"minzoom":10,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"symbol-spacing":400,"text-font":["Avenir Next LT Pro Bold"],"text-size":{"stops":[[10,9.5],[14,10.5],[18,14.5]]},"text-letter-spacing":0.09,"text-max-width":8,"text-field":"{_name_global}","text-padding":{"stops":[[10,5],[15,5],[16,15]]}},"paint":{"text-color":"#4E4E4E","text-halo-color":"#FFFFFF","text-halo-width":1}},{"id":"Road/label/Rectangle white black (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",32],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":9.3,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle white black (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Rectangle white black","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",31],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":9.3,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle white black/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Secondary Hwy red white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",16],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Secondary Hwy red white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Secondary Hwy red white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",15],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Secondary Hwy red white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/U-shaped yellow black (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",24],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/U-shaped yellow black (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/U-shaped yellow black","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",23],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/U-shaped yellow black/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/U-shaped red white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",26],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/U-shaped red white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/U-shaped red white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",25],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/U-shaped red white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/U-shaped blue white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",28],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/U-shaped blue white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/U-shaped blue white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",27],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/U-shaped blue white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/V-shaped white black (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",30],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/V-shaped white black (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/V-shaped white black","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",29],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/V-shaped white black/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/U-shaped white black (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",18],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/U-shaped white black (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/U-shaped white black","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",17],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/U-shaped white black/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/U-shaped white green (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",20],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/U-shaped white green (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/U-shaped white green","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",19],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/U-shaped white green/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/U-shaped green leaf (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",22],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/U-shaped green leaf (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/U-shaped green leaf","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",21],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/U-shaped green leaf/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Rectangle yellow black (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",38],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle yellow black (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Rectangle yellow black","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",37],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle yellow black/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Rectangle red white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",36],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle red white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Rectangle red white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",35],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle red white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Rectangle blue white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",34],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle blue white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Rectangle blue white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",33],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle blue white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Rectangle green white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",40],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle green white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Rectangle green white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",39],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle green white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Rectangle green yellow (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",42],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle green yellow (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#f1dfb7"}},{"id":"Road/label/Rectangle green yellow","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",41],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle green yellow/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#f1dfb7"}},{"id":"Road/label/Pentagon inverse white black (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",44],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":9.3,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Pentagon inverse white black/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Pentagon inverse white black","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",43],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":9.3,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Pentagon inverse white black (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Pentagon white black (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",46],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Pentagon white black (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Pentagon white black","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",45],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Pentagon white black/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Pentagon yellow black (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",50],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Pentagon yellow black (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Pentagon yellow black","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",49],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Pentagon yellow black/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Pentagon green white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",51],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Pentagon green white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Pentagon green white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",52],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Pentagon green white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Pentagon green yellow","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",53],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Pentagon green yellow/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#f1dfb7"}},{"id":"Road/label/Pentagon green yellow (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",54],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Pentagon green yellow (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#f1dfb7"}},{"id":"Road/label/Pentagon blue white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",48],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":9.3,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Pentagon blue white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Pentagon blue white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",47],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":9.3,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Pentagon blue white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Hexagon white black (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",56],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Hexagon white black (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Hexagon white black","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",55],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Hexagon white black/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Hexagon blue white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",57],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Hexagon blue white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Hexagon blue white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",58],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Hexagon blue white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Hexagon red white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",59],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Hexagon red white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Hexagon red white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",60],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Hexagon red white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Hexagon green white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",62],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Hexagon green white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Hexagon green white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",61],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Hexagon green white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Hexagon orange black","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",63],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Hexagon orange black/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Hexagon orange black (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",64],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Hexagon orange black (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Rectangle hexagon blue white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",66],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle hexagon blue white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Rectangle hexagon blue white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",65],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle hexagon blue white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Rectangle hexagon red white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",68],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle hexagon red white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Rectangle hexagon red white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",67],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle hexagon red white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Rectangle hexagon green white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",70],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle hexagon green white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Rectangle hexagon green white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",69],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle hexagon green white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Rectangle hexagon brown white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",72],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle hexagon brown white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Rectangle hexagon brown white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",71],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Rectangle hexagon brown white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Octagon green white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",74],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Octagon green white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Octagon green white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",73],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Octagon green white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Shield white black (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",10],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":9.3,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Shield white black (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Shield white black","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",9],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":9.3,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Shield white black/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Secondary Hwy green white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",14],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":9.3,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Secondary Hwy green white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Secondary Hwy green white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",13],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":9.3,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Secondary Hwy green white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Secondary Hwy white black (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",12],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Secondary Hwy white black (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Secondary Hwy white black","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",11],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Secondary Hwy white black/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{}},{"id":"Road/label/Shield blue white (Alt)","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",8],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Shield blue white (Alt)/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Shield blue white","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",7],["!in","Viz",2]],"minzoom":7,"layout":{"symbol-placement":"line","symbol-spacing":400,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":8.5,"text-max-width":8,"text-field":"{_name}","icon-image":"Road/Shield blue white/{_len}","icon-rotation-alignment":"viewport","text-rotation-alignment":"viewport","text-padding":{"stops":[[7,50],[10,50],[11,15]]}},"paint":{"text-color":"#ffffff"}},{"id":"Road/label/Pedestrian","type":"symbol","source":"esri","source-layer":"Road/label","filter":["all",["==","_label_class",6],["!in","Viz",2]],"minzoom":15,"layout":{"symbol-placement":"line","symbol-avoid-edges":true,"symbol-spacing":400,"text-font":["Montserrat SemiBold"],"text-size":9.3,"text-letter-spacing":0.05,"text-max-width":8,"text-field":"{_name_global}","text-padding":5},"paint":{"text-color":"#595959","text-halo-color":"#FFFFFF","text-halo-width":1}},{"id":"Building/label/Default","type":"symbol","source":"esri","source-layer":"Building/label","minzoom":15,"layout":{"visibility":"none","text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#5a3514","text-halo-color":"#EBE7E2","text-halo-width":0.7,"text-halo-blur":1}},{"id":"Cemetery/label/Default","type":"symbol","source":"esri","source-layer":"Cemetery/label","minzoom":13,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#2d4e28","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Freight/label/Default","type":"symbol","source":"esri","source-layer":"Freight/label","minzoom":12,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#4a2b1b","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Water and wastewater/label/Default","type":"symbol","source":"esri","source-layer":"Water and wastewater/label","minzoom":13,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#4a2b1b","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Port/label/Default","type":"symbol","source":"esri","source-layer":"Port/label","minzoom":12,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#4a2b1b","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Industry/label/Default","type":"symbol","source":"esri","source-layer":"Industry/label","minzoom":12,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#4a2b1b","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Government/label/Default","type":"symbol","source":"esri","source-layer":"Government/label","minzoom":13,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15},"paint":{"text-color":"#4a2b1b","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Finance/label/Default","type":"symbol","source":"esri","source-layer":"Finance/label","minzoom":13,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#9d5a48","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Emergency/label/Default","type":"symbol","source":"esri","source-layer":"Emergency/label","minzoom":13,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#33302f","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Indigenous/label/Default","type":"symbol","source":"esri","source-layer":"Indigenous/label","minzoom":7,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[9,8.5],[15,9.5],[20,12.5],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#533d32","text-halo-color":"#e8e6d6","text-halo-width":1,"text-halo-blur":1}},{"id":"Military/label/Default","type":"symbol","source":"esri","source-layer":"Military/label","minzoom":6,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[9,8.5],[15,9.5],[20,12.5],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":25,"symbol-avoid-edges":true},"paint":{"text-color":"#242221","text-halo-color":"#E0E0D9","text-halo-width":1,"text-halo-blur":1}},{"id":"Transportation/label/Default","type":"symbol","source":"esri","source-layer":"Transportation/label","minzoom":13,"layout":{"visibility":"none","text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#242221","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Pedestrian/label/Default","type":"symbol","source":"esri","source-layer":"Pedestrian/label","minzoom":13,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15},"paint":{"text-color":"#242221","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Beach/label/Default","type":"symbol","source":"esri","source-layer":"Beach/label","minzoom":13,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":0.08,"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#806b3c","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Golf course/label/Default","type":"symbol","source":"esri","source-layer":"Golf course/label","minzoom":11,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#2d4e28","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Zoo/label/Default","type":"symbol","source":"esri","source-layer":"Zoo/label","minzoom":11,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#2d4e28","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Retail/label/Default","type":"symbol","source":"esri","source-layer":"Retail/label","minzoom":13,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#9d5a48","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Landmark/label/Default","type":"symbol","source":"esri","source-layer":"Landmark/label","minzoom":13,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#446757","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Openspace or forest/label/Default","type":"symbol","source":"esri","source-layer":"Openspace or forest/label","minzoom":10,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":25},"paint":{"text-color":"#006200","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Park or farming/label/Default","type":"symbol","source":"esri","source-layer":"Park or farming/label","minzoom":11,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":25},"paint":{"text-color":"#006200","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Point of interest/Park","type":"symbol","source":"esri","source-layer":"Point of interest","filter":["==","_label_class",1],"minzoom":9,"layout":{"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15},"paint":{"text-color":"#006200","text-halo-width":1,"text-halo-color":"#EBE7E2","text-halo-blur":1}},{"id":"Education/label/Default","type":"symbol","source":"esri","source-layer":"Education/label","minzoom":11,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#505000","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Medical/label/Default","type":"symbol","source":"esri","source-layer":"Medical/label","minzoom":11,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#3d5d69","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Admin1 forest or park/label/Default","type":"symbol","source":"esri","source-layer":"Admin1 forest or park/label","minzoom":7,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[9,8.5],[15,9.5],[20,12.5],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":25},"paint":{"text-color":"#006200","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Admin0 forest or park/label/Default","type":"symbol","source":"esri","source-layer":"Admin0 forest or park/label","minzoom":6,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[9,8.5],[15,9.5],[20,12.5],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":25,"symbol-avoid-edges":true},"paint":{"text-color":"#006200","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Airport/label/Airport property","type":"symbol","source":"esri","source-layer":"Airport/label","minzoom":9,"layout":{"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[9,8.5],[15,9.5],[20,12.5],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15,"symbol-avoid-edges":true},"paint":{"text-color":"#5f5e5c","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Admin2 area/label/small","type":"symbol","source":"esri","source-layer":"Admin2 area/label","filter":["==","_label_class",1],"minzoom":9,"maxzoom":11,"layout":{"text-letter-spacing":0.2,"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":11,"text-max-width":8,"text-field":"{_name}","text-padding":1,"symbol-avoid-edges":true,"text-transform":"uppercase"},"paint":{"text-color":"#80755f","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Admin2 area/label/large","type":"symbol","source":"esri","source-layer":"Admin2 area/label","filter":["==","_label_class",0],"minzoom":9,"maxzoom":11,"layout":{"text-letter-spacing":0.2,"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":13,"text-max-width":8,"text-field":"{_name}","text-padding":1,"symbol-avoid-edges":true,"text-transform":"uppercase"},"paint":{"text-color":"#80755f","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Admin1 area/label/x small","type":"symbol","source":"esri","source-layer":"Admin1 area/label","filter":["==","_label_class",5],"minzoom":4,"maxzoom":10,"layout":{"text-font":["Montserrat SemiBold"],"text-transform":"uppercase","text-max-width":8,"text-field":"{_name}","text-padding":1,"symbol-avoid-edges":true,"text-size":{"stops":[[4,8.5],[5,9.5],[6,10.3],[9,11]]},"text-letter-spacing":{"stops":[[4,0.1],[8,0.2]]}},"paint":{"text-color":{"stops":[[4,"#554434"],[6,"#39240e"]]},"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Admin1 area/label/small","type":"symbol","source":"esri","source-layer":"Admin1 area/label","filter":["==","_label_class",4],"minzoom":4,"maxzoom":10,"layout":{"text-font":["Montserrat SemiBold"],"text-transform":"uppercase","text-max-width":8,"text-field":"{_name}","text-padding":1,"symbol-avoid-edges":true,"text-size":{"stops":[[4,8.5],[5,9.5],[6,10.5],[9,11.5]]},"text-letter-spacing":{"stops":[[4,0.1],[8,0.2]]}},"paint":{"text-color":{"stops":[[4,"#554434"],[6,"#39240e"]]},"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Admin1 area/label/medium","type":"symbol","source":"esri","source-layer":"Admin1 area/label","filter":["==","_label_class",3],"minzoom":4,"maxzoom":10,"layout":{"text-font":["Montserrat SemiBold"],"text-transform":"uppercase","text-max-width":8,"text-field":"{_name}","text-padding":1,"symbol-avoid-edges":true,"text-size":{"stops":[[4,9.5],[5,10.5],[6,11.3],[9,12]]},"text-letter-spacing":{"stops":[[4,0.15],[8,0.4]]}},"paint":{"text-color":{"stops":[[4,"#554434"],[6,"#39240e"]]},"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Admin1 area/label/large","type":"symbol","source":"esri","source-layer":"Admin1 area/label","filter":["==","_label_class",2],"minzoom":4,"maxzoom":10,"layout":{"text-font":["Montserrat SemiBold"],"text-transform":"uppercase","text-max-width":8,"text-field":"{_name}","text-padding":1,"symbol-avoid-edges":true,"text-size":{"stops":[[4,9.5],[5,11.3],[6,13],[9,17]]},"text-letter-spacing":{"stops":[[4,0.1],[8,0.5]]}},"paint":{"text-color":{"stops":[[4,"#554434"],[6,"#39240e"]]},"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Admin1 area/label/x large","type":"symbol","source":"esri","source-layer":"Admin1 area/label","filter":["==","_label_class",1],"minzoom":4,"maxzoom":10,"layout":{"text-font":["Montserrat SemiBold"],"text-transform":"uppercase","text-max-width":8,"text-field":"{_name}","text-padding":1,"symbol-avoid-edges":true,"text-size":{"stops":[[4,10.3],[5,12],[6,13.5],[9,19]]},"text-letter-spacing":{"stops":[[4,0.15],[8,0.6]]}},"paint":{"text-color":{"stops":[[4,"#554434"],[6,"#39240e"]]},"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Admin1 area/label/2x large","type":"symbol","source":"esri","source-layer":"Admin1 area/label","filter":["==","_label_class",0],"minzoom":4,"maxzoom":10,"layout":{"text-font":["Montserrat SemiBold"],"text-transform":"uppercase","text-max-width":8,"text-field":"{_name}","text-padding":1,"symbol-avoid-edges":true,"text-size":{"stops":[[4,11.5],[5,12.3],[6,14],[9,19]]},"text-letter-spacing":{"stops":[[4,0.15],[8,0.75]]}},"paint":{"text-color":{"stops":[[4,"#554434"],[6,"#39240e"]]},"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Point of interest/General","type":"symbol","source":"esri","source-layer":"Point of interest","filter":["==","_label_class",0],"minzoom":9,"layout":{"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15},"paint":{"text-color":{"stops":[[9,"#5a3514"],[11,"#5a3514"]]},"text-halo-width":1,"text-halo-color":"#EBE7E2","text-halo-blur":1}},{"id":"Point of interest/Bus station","type":"symbol","source":"esri","source-layer":"Point of interest","filter":["==","_symbol",2],"minzoom":12,"layout":{"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15},"paint":{"text-color":{"stops":[[9,"#5a3514"],[11,"#5a3514"]]},"text-halo-width":1,"text-halo-color":"#EBE7E2","text-halo-blur":1}},{"id":"Point of interest/Rail station","type":"symbol","source":"esri","source-layer":"Point of interest","filter":["==","_symbol",3],"minzoom":12,"layout":{"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[15,9.5],[20,11],[22,15]]},"text-letter-spacing":{"stops":[[15,0.05],[20,0.15]]},"text-max-width":8,"text-field":"{_name_global}","text-padding":15},"paint":{"text-color":{"stops":[[9,"#5a3514"],[11,"#5a3514"]]},"text-halo-width":1,"text-halo-color":"#EBE7E2","text-halo-blur":1}},{"id":"Neighborhood","type":"symbol","source":"esri","source-layer":"Neighborhood","minzoom":14,"maxzoom":17,"layout":{"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[10,10],[16,14]]},"text-letter-spacing":0.08,"text-max-width":8,"text-field":"{_name_global}","text-padding":1},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City large scale/town small","type":"symbol","source":"esri","source-layer":"City large scale","filter":["==","_label_class",5],"minzoom":10,"maxzoom":17,"layout":{"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[10,11],[16,15]]},"text-letter-spacing":0.08,"text-max-width":8,"text-field":"{_name_global}","text-padding":15},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City large scale/town large","type":"symbol","source":"esri","source-layer":"City large scale","filter":["==","_label_class",4],"minzoom":10,"maxzoom":17,"layout":{"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-size":{"stops":[[10,11],[16,17]]},"text-letter-spacing":0.09,"text-max-width":8,"text-field":"{_name_global}","text-padding":1},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City large scale/small","type":"symbol","source":"esri","source-layer":"City large scale","filter":["==","_label_class",3],"minzoom":10,"maxzoom":17,"layout":{"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-letter-spacing":0.1,"text-max-width":8,"text-field":"{_name_global}","text-padding":1,"text-size":{"stops":[[10,12],[16,18]]}},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City large scale/medium","type":"symbol","source":"esri","source-layer":"City large scale","filter":["==","_label_class",2],"minzoom":10,"maxzoom":17,"layout":{"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-letter-spacing":0.1,"text-max-width":8,"text-field":"{_name_global}","text-padding":1,"text-size":{"stops":[[10,13],[16,20]]}},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City large scale/large","type":"symbol","source":"esri","source-layer":"City large scale","filter":["==","_label_class",1],"minzoom":10,"maxzoom":17,"layout":{"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-letter-spacing":0.1,"text-max-width":8,"text-field":"{_name_global}","text-padding":1,"text-size":{"stops":[[10,14],[16,26]]}},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City large scale/x large","type":"symbol","source":"esri","source-layer":"City large scale","filter":["==","_label_class",0],"minzoom":10,"maxzoom":17,"layout":{"symbol-avoid-edges":true,"text-font":["Montserrat SemiBold"],"text-letter-spacing":0.1,"text-max-width":8,"text-field":"{_name_global}","text-padding":1,"text-size":{"stops":[[10,14.5],[16,31]]}},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/town small non capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",17],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-size":11,"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left"},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/town large non capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",15],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-size":11,"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left"},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/small non capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",12],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-size":11.5,"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left"},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/medium non capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",9],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left","text-size":{"stops":[[4,12.3],[6,12.3],[8,13]]}},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/other capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",18],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-size":11.5,"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left"},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/town large other capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",14],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-size":11.5,"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left"},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/small other capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",11],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-size":11.5,"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left"},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/medium other capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",8],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left","text-size":{"stops":[[4,12.3],[6,12.3],[8,13]]}},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Admin0 point/x small","type":"symbol","source":"esri","source-layer":"Admin0 point","filter":["==","_label_class",5],"minzoom":5,"maxzoom":10,"layout":{"text-font":["Avenir Next LT Pro Bold"],"text-max-width":8,"text-field":"{_name}","text-padding":1,"symbol-avoid-edges":true,"text-letter-spacing":{"stops":[[5,0.13],[8,0.5]]},"text-size":{"stops":[[5,13],[10,18]]}},"paint":{"text-color":"#0f010f","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Admin0 point/small","type":"symbol","source":"esri","source-layer":"Admin0 point","filter":["==","_label_class",4],"minzoom":4,"maxzoom":10,"layout":{"text-font":["Avenir Next LT Pro Bold"],"text-max-width":8,"text-field":"{_name}","text-padding":1,"symbol-avoid-edges":true,"text-letter-spacing":{"stops":[[4,0.13],[8,0.5]]},"text-size":{"stops":[[4,13],[10,18]]}},"paint":{"text-color":"#0f010f","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Admin0 point/medium","type":"symbol","source":"esri","source-layer":"Admin0 point","filter":["==","_label_class",3],"minzoom":2,"maxzoom":10,"layout":{"text-font":["Avenir Next LT Pro Bold"],"text-max-width":8,"text-field":"{_name}","text-padding":1,"symbol-avoid-edges":true,"text-letter-spacing":{"stops":[[2,0.13],[8,0.5]]},"text-size":{"stops":[[2,10],[4,14],[10,22]]}},"paint":{"text-color":"#0f010f","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Admin0 point/large","type":"symbol","source":"esri","source-layer":"Admin0 point","filter":["==","_label_class",2],"minzoom":2,"maxzoom":10,"layout":{"text-font":["Avenir Next LT Pro Bold"],"text-max-width":8,"text-field":"{_name}","text-padding":1,"symbol-avoid-edges":true,"text-letter-spacing":{"stops":[[2,0.13],[8,0.5]]},"text-size":{"stops":[[2,11],[4,14],[6,22]]}},"paint":{"text-color":"#0f010f","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Admin0 point/x large","type":"symbol","source":"esri","source-layer":"Admin0 point","filter":["==","_label_class",1],"minzoom":2,"maxzoom":8,"layout":{"text-max-width":8,"text-field":"{_name}","text-padding":1,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-line-height":1.5,"text-letter-spacing":{"stops":[[2,0.15],[6,0.5]]},"text-size":{"stops":[[2,11.5],[4,15],[6,23]]}},"paint":{"text-color":"#0f010f","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/town small admin0 capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",16],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left","text-size":{"stops":[[4,12.3],[6,13.5],[8,14.3]]}},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/town large admin0 capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",13],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left","text-size":{"stops":[[4,12.3],[6,13.5],[8,14.3]]}},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/small admin0 capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",10],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left","text-size":{"stops":[[4,12.3],[6,13.5],[8,14.3]]}},"paint":{"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/medium admin0 capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",7],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left","text-size":{"stops":[[4,12.3],[6,13.5],[8,14.3]]}},"paint":{"text-color":"#343434","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/large other capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",5],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left","text-size":{"stops":[[4,12.3],[6,12.3],[8,13]]}},"paint":{"text-color":{"stops":[[2,"#343434"],[3,"#000000"]]},"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/x large admin2 capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",2],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left","text-size":{"stops":[[4,12.3],[6,13.5],[8,14.3]]}},"paint":{"text-color":{"stops":[[2,"#343434"],[3,"#000000"]]},"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/large non capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",6],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left","text-size":{"stops":[[4,12.3],[6,12.3],[8,13]]}},"paint":{"text-color":{"stops":[[2,"#343434"],[3,"#000000"]]},"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/large admin0 capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",4],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left","text-size":{"stops":[[4,12.3],[6,13.5],[8,14.3]]}},"paint":{"text-color":{"stops":[[2,"#2d2d2d"],[3,"#000000"]]},"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/x large non capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",3],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left","text-size":{"stops":[[4,12.3],[6,13.5],[8,14.3]]}},"paint":{"text-color":{"stops":[[2,"#343434"],[3,"#000000"]]},"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/x large admin1 capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",1],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left","text-size":{"stops":[[4,12.3],[6,13.5],[8,14.3]]}},"paint":{"text-color":{"stops":[[2,"#343434"],[3,"#000000"]]},"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"City small scale/x large admin0 capital","type":"symbol","source":"esri","source-layer":"City small scale","filter":["==","_symbol",0],"minzoom":3,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"icon-image":"City small scale","icon-padding":1,"text-font":["Montserrat SemiBold"],"text-anchor":"bottom-left","text-max-width":8,"text-field":"{_name}","text-padding":1,"text-offset":[0.2,0.1],"text-justify":"left","text-size":{"stops":[[4,12.3],[6,13.5],[8,14.3]]}},"paint":{"text-color":{"stops":[[2,"#2d2d2d"],[3,"#000000"]]},"text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Admin0 point/2x large","type":"symbol","source":"esri","source-layer":"Admin0 point","filter":["==","_label_class",0],"minzoom":2,"maxzoom":6,"layout":{"text-max-width":8,"text-field":"{_name}","text-padding":1,"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-line-height":1.7,"text-letter-spacing":{"stops":[[2,0.3],[5,0.5]]},"text-size":{"stops":[[2,14],[4,22.5],[5,28]]}},"paint":{"text-color":"#0f010f","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Continent","type":"symbol","source":"esri","source-layer":"Continent","maxzoom":2,"layout":{"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":{"stops":[[0,8.3],[1,10.3]]},"text-letter-spacing":0.35,"text-max-width":8,"text-line-height":1.75,"text-field":"{_name_global}","text-padding":1,"text-transform":"uppercase"},"paint":{"text-color":"#363636","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"Disputed label point/Island","type":"symbol","source":"esri","source-layer":"Disputed label point","filter":["all",["==","_label_class",1],["in","DisputeID",0]],"minzoom":6,"layout":{"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":{"stops":[[6,7],[15,10]]},"text-letter-spacing":0.13,"text-line-height":1.5,"text-max-width":4,"text-field":"{_name}","text-padding":1},"paint":{"text-color":"#595959","text-halo-blur":1,"text-halo-color":"#EBE7E2","text-halo-width":1}},{"id":"Disputed label point/Waterbody","type":"symbol","source":"esri","source-layer":"Disputed label point","filter":["all",["==","_label_class",0],["in","DisputeID",1006]],"minzoom":2,"maxzoom":10,"layout":{"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Demi Italic"],"text-size":{"stops":[[2,8],[6,9.3]]},"text-letter-spacing":0.1,"text-max-width":6,"text-field":"{_name}","text-padding":1},"paint":{"text-color":{"stops":[[1,"#0d6c9a"],[6,"#0d6c9a"]]},"text-halo-blur":1,"text-halo-color":"#82CFF5","text-halo-width":0.5}},{"id":"Disputed label point/Admin0","type":"symbol","source":"esri","source-layer":"Disputed label point","filter":["all",["==","_label_class",2],["in","DisputeID",1021]],"minzoom":2,"layout":{"symbol-avoid-edges":true,"text-font":["Avenir Next LT Pro Bold"],"text-size":{"stops":[[2,10],[4,14],[10,22]]},"text-letter-spacing":{"stops":[[2,0.13],[8,0.5]]},"text-max-width":8,"text-field":"{_name}","text-padding":1},"paint":{"text-color":"#1f1d1f","text-halo-color":"#EBE7E2","text-halo-width":1,"text-halo-blur":1}},{"id":"mapillary-images","type":"circle","source":"mly","source-layer":"image","maxzoom":22,"minzoom":11,"filter":["all",["==","is_pano",true],["==","organization_id",518073312556755]],"layout":{"visibility":"visible"},"paint":{"circle-radius":{"base":1,"stops":[[13,0.1],[14,0.5],[17,2],[18.5,4],[19,7],[19.5,10]]},"circle-color":"rgba(20,20,120,0)"}},{"id":"mapillary-location","type":"symbol","source":"mapillary","layout":{"icon-rotate":["get","bearing"],"icon-rotation-alignment":"map","icon-image":"video"}},{"id":"parcels","type":"line","source":"parcels","source-layer":"parcels","minzoom":11,"layout":{"visibility":"visible"},"paint":{"line-color":{"stops":[[14,"#222"],[17,"#333"],[17.1,"#444"],[18,"#333"]]},"line-width":{"base":1,"stops":[[12,0.1],[14,0.75],[17,1.5],[20,4]]},"line-opacity":{"base":1,"stops":[[12,0],[12.1,0.5],[22,1]]}}},{"id":"parcels-highlight","type":"line","source":"parcels","source-layer":"parcels","minzoom":11,"filter":["==","parcelno",""],"layout":{"visibility":"visible"},"paint":{"line-color":"#feb70d","line-width":{"base":1,"stops":[[12,0.5],[14,2],[15,3],[22,10]]},"line-opacity":{"base":1,"stops":[[12,0],[12.1,0.1],[12.5,1],[22,1]]}}},{"id":"parcels-fill","type":"fill","source":"parcels","source-layer":"parcels","interactive":true,"minzoom":12,"layout":{"visibility":"visible"},"paint":{"fill-color":"rgba(0,0,0,0)"}}],"metadata":{"arcgisStyleUrl":"https://www.arcgis.com/sharing/rest/content/items/273bf8d5c8ac400183fc24e109d20bcf/resources/styles/root.json","arcgisOriginalItemTitle":"Community"}}'),x=function(){function t(e,i){var r,a,s;n(this,t),s=function(t,e){var i=Array.from(e);return t.filter((function(t,e,n){return e===n.findIndex((function(e){return isPropValuesEqual(e,t,i)}))}))},(a="getUniqueItemsByProperties")in(r=this)?Object.defineProperty(r,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[a]=s,this.app=i,this.svCoords={lng:-83.1,lat:42.36},this.svBearing=180,this.map=new o.Map({container:e,style:v,center:[this.svCoords.lng,this.svCoords.lat],zoom:12}),this.init(this)}return a(t,[{key:"init",value:function(t){t.map.addControl(new o.NavigationControl),t.map.on("load",(function(){t.map.addSource("markers",{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[12.695600612967427,56.04351888068181]},properties:{}}}),t.map.addSource("zoning",{type:"vector",tiles:["https://tiles.arcgis.com/tiles/qvkbeam7Wirps6zC/arcgis/rest/services/Zoning_Vector_Tiles/VectorTileServer/tile/{z}/{y}/{x}.pbf"],maxzoom:19}),t.map.addSource("peoplemover",{type:"geojson",data:"https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/Detroit_People_Mover_Route/FeatureServer/0/query?outFields=*&outSR=4326&where=1%3D1&f=geojson"}),t.map.addSource("mogobikes",{type:"geojson",data:"https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/MoGo_Bike_Share_Locations/FeatureServer/0/query?outFields=*&outSR=4326&where=1%3D1&f=geojson"}),t.map.addSource("smartroutes",{type:"geojson",data:"https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/SMART_Bus_Routes/FeatureServer/0/query?outFields=*&outSR=4326&where=1%3D1&f=geojson"}),t.map.addSource("qlineroute",{type:"geojson",data:"https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/QLine_Route/FeatureServer/0/query?outFields=*&outSR=4326&where=1%3D1&f=geojson"}),t.map.addSource("qlinestops",{type:"geojson",data:"https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/QLine_Stops/FeatureServer/0/query?outFields=*&outSR=4326&where=1%3D1&f=geojson"}),t.map.addSource("police-stations",{type:"geojson",data:"https://services2.arcgis.com/qvkbeam7Wirps6zC/ArcGIS/rest/services/Precinct_Buildings/FeatureServer/0/query?where=1%3D1&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=&returnGeometry=true&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pgeojson&token="}),t.map.addSource("fire-stations",{type:"geojson",data:"https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/Firehouse_Locations/FeatureServer/0/query?where=1%3D1&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnGeometry=true&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pgeojson&token="}),t.map.addSource("active-parks",{type:"geojson",data:"https://services2.arcgis.com/qvkbeam7Wirps6zC/ArcGIS/rest/services/Parks_Marijuana/FeatureServer/0/query?where=1%3D1&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnGeometry=true&returnCentroid=false&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pgeojson&token="}),t.map.addSource("marijuana-legacy-structure",{type:"geojson",data:"https://services2.arcgis.com/qvkbeam7Wirps6zC/ArcGIS/rest/services/City_Owned_Land_and_Structures_Set_Aside_for_Adult_Use_Marijuana/FeatureServer/1/query?where=1%3D1&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnGeometry=true&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pgeojson&token="}),t.map.addSource("marijuana-legacy-land",{type:"geojson",data:"https://services2.arcgis.com/qvkbeam7Wirps6zC/ArcGIS/rest/services/City_Owned_Land_and_Structures_Set_Aside_for_Adult_Use_Marijuana/FeatureServer/2/query?where=1%3D1&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnGeometry=true&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pgeojson&token="}),t.map.addSource("public-properties",{type:"vector",bounds:[-83.2847,42.2657,-82.9238,42.4499],minzoom:0,maxzoom:19,scheme:"xyz",url:"https://vectortileservices2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/DevelopmentOpportunitiesLayers/VectorTileServer",tiles:["https://vectortileservices2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/DevelopmentOpportunitiesLayers/VectorTileServer/tile/{z}/{y}/{x}.pbf"]}),t.map.addSource("opp-zones",{type:"geojson",data:"https://opendata.arcgis.com/datasets/4e50576fb1ee4a2db4208c220747831b_0.geojson"}),t.map.addSource("snf",{type:"geojson",data:"https://opendata.arcgis.com/datasets/dafad9fc0e854d9fb03d9cb00ea5e69c_0.geojson"}),t.map.addSource("tmah",{type:"geojson",data:"https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/Targeted_Multifamily_Affordable_Housing/FeatureServer/0/query?where=1%3D1&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnGeometry=true&returnCentroid=false&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pgeojson&token="}),t.map.addLayer({id:"r-zoning",type:"line",source:"zoning","source-layer":"Zoning",paint:{"line-color":["match",["get","ZONING_REV"],"R1","#FCF3CF","R2","#F9E79F","R3","#F4D03F","R4","#F1C40F","R5","#D4AC0D","R6","#B7950B","#ccc"],"line-width":3},filter:["in","ZONING_REV"]}),t.map.addLayer({id:"b-zoning",type:"line",source:"zoning","source-layer":"Zoning",paint:{"line-color":["match",["get","ZONING_REV"],"B1","#F1948A","B2","#EC7063","B3","#E74C3C","B4","#A93226","B5","#922B21","B6","#7B241C","#ccc"],"line-width":3},filter:["in","ZONING_REV"]}),t.map.addLayer({id:"m-zoning",type:"line",source:"zoning","source-layer":"Zoning",paint:{"line-color":["match",["get","ZONING_REV"],"M1","#EBDEF0","M2","#C39BD3","M3","#9B59B6","M4","#7D3C98","M5","#4A235A","#ccc"],"line-width":3},filter:["in","ZONING_REV"]}),t.map.addLayer({id:"s-zoning",type:"line",source:"zoning","source-layer":"Zoning",paint:{"line-color":["match",["get","ZONING_REV"],"P1","#CCD1D1","PC","#884EA0","PCA","#2471A3","PD","#3498DB","PR","#1E8449","SD1","#D4E6F1","SD2","#7FB3D5","SD3","#D7BDE2","SD4","#45B39D","SD5","#ff8f00","TM","#A2D9CE","W1","#82E0AA","#ccc"],"line-width":3},filter:["in","ZONING_REV"]}),t.map.addLayer({id:"peoplemover",type:"line",source:"peoplemover",layout:{visibility:"none"},paint:{"line-color":"#2c5490","line-width":2}}),t.map.addLayer({id:"smartroutes",type:"line",source:"smartroutes",layout:{visibility:"none"},paint:{"line-color":"#eb7609","line-width":2}}),t.map.addLayer({id:"mogobikes",type:"circle",source:"mogobikes",layout:{visibility:"none"},paint:{"circle-radius":{base:5,stops:[[12,5],[22,120]]},"circle-color":"#ee382a"}}),t.map.addLayer({id:"qlinestops",type:"circle",source:"qlinestops",layout:{visibility:"none"},paint:{"circle-radius":{base:5,stops:[[12,5],[22,120]]},"circle-color":"#7fb6ab"}}),t.map.addLayer({id:"qlineroute",type:"line",source:"qlineroute",layout:{visibility:"none"},paint:{"line-color":"#7fb6ab","line-width":2}}),t.map.addLayer({id:"fire-stations",type:"circle",source:"fire-stations",layout:{visibility:"none"},paint:{"circle-radius":{base:5,stops:[[12,5],[22,120]]},"circle-color":"#8f0408"}}),t.map.addLayer({id:"police-stations",type:"circle",source:"police-stations",layout:{visibility:"none"},paint:{"circle-radius":{base:5,stops:[[12,5],[22,120]]},"circle-color":"#00158b"}}),t.map.addLayer({id:"parks-fill",type:"fill",source:"active-parks",layout:{visibility:"none"},paint:{"fill-color":"#28f572","fill-opacity":.5}}),t.map.addLayer({id:"parks-line",type:"line",source:"active-parks",layout:{visibility:"none"},paint:{"line-color":"#28f572"}}),t.map.addLayer({id:"city-structures",type:"fill",source:"public-properties","source-layer":"City Real Estate Surplus Buildings",layout:{visibility:"none"},paint:{"fill-color":"#009980","fill-opacity":.7}}),t.map.addLayer({id:"city-land",type:"fill",source:"public-properties","source-layer":"City Real Estate Surplus Land",layout:{visibility:"none"},paint:{"fill-color":"#00f8cf","fill-opacity":.7}}),t.map.addLayer({id:"dlba-structures",type:"fill",source:"public-properties","source-layer":"dlba_structures",layout:{visibility:"none"},paint:{"fill-color":"#009980","fill-opacity":.7}}),t.map.addLayer({id:"dlba-land",type:"fill",source:"public-properties","source-layer":"dlba_land",layout:{visibility:"none"},paint:{"fill-color":"#00f8cf","fill-opacity":.7}}),t.map.addLayer({id:"marijuana-legacy-land",type:"circle",source:"marijuana-legacy-land",layout:{visibility:"none"},paint:{"circle-radius":{base:5,stops:[[12,5],[22,120]]},"circle-color":"#002e00"}}),t.map.addLayer({id:"marijuana-legacy-structure",type:"circle",source:"marijuana-legacy-structure",layout:{visibility:"none"},paint:{"circle-radius":{base:5,stops:[[12,5],[22,120]]},"circle-color":"#028302"}}),t.map.addLayer({id:"opp-zones-fill",type:"fill",source:"opp-zones",layout:{visibility:"none"},paint:{"fill-color":"#83027d","fill-opacity":.5}}),t.map.addLayer({id:"opp-zones-line",type:"line",source:"opp-zones",layout:{visibility:"none"},paint:{"line-color":"#83027d"}}),t.map.addLayer({id:"snf-fill",type:"fill",source:"snf",layout:{visibility:"none"},paint:{"fill-color":"#804d24","fill-opacity":.5}}),t.map.addLayer({id:"snf-line",type:"line",source:"snf",layout:{visibility:"none"},paint:{"line-color":"#804d24"}}),t.map.addLayer({id:"tmah-fill",type:"fill",source:"tmah",layout:{visibility:"none"},paint:{"fill-color":"#0060dd","fill-opacity":.5}}),t.map.addLayer({id:"tmah-line",type:"line",source:"tmah",layout:{visibility:"none"},paint:{"line-color":"#0060dd"}}),t.map.loadImage("https://detroitmi.gov/sites/detroitmi.localhost/files/styles/default/public/2021-02/video.png",(function(e,i){if(e)throw e;t.map.addImage("video",i)})),t.map.on("style.load",(function(){t.map.loadImage(videoIcon,(function(e,i){if(e)throw e;t.map.addImage("video",i),t.map.setFilter("parcels-highlight",["==","parcelno",t.app.parcel?t.app.parcel:""]),t.svCoords&&t.map.getSource("mapillary").setData({type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[t.svCoords.lon,t.svCoords.lat]},properties:{bearing:t.svBearing-90}}]})}))})),t.map.on("click","parcels-fill",(function(e){var i=t.map.queryRenderedFeatures(e.point,{layers:["parcels-fill"]});t.app.parcel=i[0].properties.parcelno,t.map.flyTo({center:[e.lngLat.lng,e.lngLat.lat],zoom:18,essential:!0}),i[0]._geometry?t.app.centroid=y(i[0]._geometry):t.app.centroid=y(i[0].geometry),t.app.coords=t.app.centroid.geometry.coordinates,t.map.setFilter("parcels-highlight",["==","parcelno",t.app.parcel?t.app.parcel:""])})),t.map.on("moveend",(function(e){try{switch(!0){case"WheelEvent"===e.originalEvent:case"MouseEvent"===e.originalEvent:break;default:if(t.map.getZoom()>17.5&&null!=t.app.parcel){var i=t.map.queryRenderedFeatures({layers:["mapillary-images"]}),n=l()(i,"properties.id");t.app.imageKeys=n,t.app.checkSpecialProperties(t.app.parcel,t.app)}}}catch(r){console.log(r)}})),t.map.on("click",(function(e){document.getElementById("initial-loader-overlay").className="active",t.map.queryRenderedFeatures(e.point,{layers:["parcels-fill"]}).length<1&&(t.app.panel.dashLast="city",t.app.panel.createPanel(t.app.panel,"dash"))})),document.querySelector("#initial-loader-overlay").className=""}))}},{key:"changeVisibility",value:function(t,e,i){t.forEach((function(t){i.map.setLayoutProperty(t,"visibility",e)}))}}]),t}(),b=function(){function t(e,i){n(this,t),this.form=null,this.expansion={forSale:!1,transportation:!1,publicAssests:!1,planningHousing:!1,zoning:!1,zoningB:!1,zoningM:!1,zoningS:!1},this.app=i,this.container=document.getElementById(e),this.buidlForm(document.getElementById(e),this)}return a(t,[{key:"checkLock",value:function(t){return 1==t.lock}},{key:"changeLock",value:function(t){1==t.lock?t.lock=!1:t.lock=!0}},{key:"removeForm",value:function(t){t.removeChild(t.childNodes[1])}},{key:"updateFilters",value:function(t,e){var i="none";if(t.target.checked)i="visible",e.app.filters.includes(t.target.id)||e.app.filters.push(t.target.id);else if(e.app.filters.includes(t.target.id)){var n=e.app.filters.filter((function(e,i,n){return e!=t.target.id}));e.app.filters=n}if(t.target.name.includes("zoning-data")){var r=e.buildNewZoningFilter(t,e,i);e.app.map.map.setFilter("".concat(t.target.name.charAt(0),"-zoning"),r)}else{var a=t.target.value.split(",");e.app.map.changeVisibility(a,i,e.app.map)}"parent-filter"==t.target.className&&e.changeSubsets(t,e)}},{key:"buildNewZoningFilter",value:function(t,e,i){var n=t.target.value.split(","),r=["in","ZONING_REV"];if("visible"==i)e.app.zoning[t.target.name.charAt(0)].length>0&&(e.app.zoning[t.target.name.charAt(0)].shift(),e.app.zoning[t.target.name.charAt(0)].shift()),n.forEach((function(i){e.app.zoning[t.target.name.charAt(0)].includes(i)||e.app.zoning[t.target.name.charAt(0)].push(i)})),e.app.zoning[t.target.name.charAt(0)].forEach((function(t){r.push(t)}));else{var a=e.app.zoning[t.target.name.charAt(0)];n.forEach((function(t){if(a.includes(t)){var e=a.filter((function(e,i,n){return e!=t}));a=e}})),r=a}return e.app.zoning[t.target.name.charAt(0)]=r,r}},{key:"changeSubsets",value:function(t,e){var i=t.target.value.split(",");if(t.target.checked)i.forEach((function(t){e.app.filters.includes(t)||e.app.filters.push(t)}));else{var n=e.app.filters,r=e.app.filters;i.forEach((function(t){n.includes(t)&&(r=r.filter((function(e,i,n){return e!=t})))})),e.app.filters=r}e.removeForm(e.container),e.buidlForm(e.container,e)}},{key:"buidlForm",value:function(t,e){e.form=document.createElement("form");var i=document.createElement("article"),n=document.createElement("input"),r=document.createElement("label"),a=document.createElement("button"),o=document.createElement("article"),s=document.createElement("input"),l=document.createElement("span"),c=document.createElement("label"),u=document.createElement("div"),h=document.createElement("input"),p=document.createElement("span"),d=document.createElement("label"),f=document.createElement("div"),m=document.createElement("input"),g=document.createElement("span"),_=document.createElement("label"),y=document.createElement("div"),v=document.createElement("input"),x=document.createElement("span"),b=document.createElement("label"),w=document.createElement("div");i.className="parent-filter-container",n.type="checkbox",n.value="city-land,dlba-land,city-structures,dlba-structures,marijuana-legacy-structure,marijuana-legacy-land",n.id="forSale-all",n.name="forSale-data",e.app.filters.includes("forSale-all")?n.checked=!0:n.checked=!1,n.className="parent-filter",r.innerText="Public Properties for Sale",r.setAttribute("for","forSale-all"),a.type="expand",n.addEventListener("change",(function(t){e.updateFilters(t,e)})),e.expansion.forSale?a.innerHTML='<i class="fas fa-minus"></i>':a.innerHTML='<i class="fas fa-plus"></i>',a.addEventListener("click",(function(t){e.expansion.forSale?e.expansion.forSale=!1:e.expansion.forSale=!0,e.removeForm(e.container),e.buidlForm(e.container,e)})),e.expansion.forSale?o.className="filter-subset active":o.className="filter-subset",s.type="checkbox",s.name="forSale-data",s.id="public-land",s.value="city-land,dlba-land",e.app.filters.includes("city-land")?s.checked=!0:s.checked=!1,s.addEventListener("change",(function(t){e.updateFilters(t,e)})),c.innerText="Public Land",c.setAttribute("for","public-land"),l.className="circle public-land",c.appendChild(l),u.appendChild(s),u.appendChild(c),o.appendChild(u),h.type="checkbox",h.name="forSale-data",h.id="public-structure",h.value="city-structures,dlba-structures",e.app.filters.includes("city-structures")?h.checked=!0:h.checked=!1,h.addEventListener("change",(function(t){e.updateFilters(t,e)})),d.innerText="Public Structure",d.setAttribute("for","public-structure"),p.className="circle public-structure",d.appendChild(p),f.appendChild(h),f.appendChild(d),o.appendChild(f),m.type="checkbox",m.name="forSale-data",m.id="marijuana-legacy-land",m.value="marijuana-legacy-land",e.app.filters.includes("marijuana-legacy-land")?m.checked=!0:m.checked=!1,m.addEventListener("change",(function(t){e.updateFilters(t,e)})),_.innerText="Marijuana Legacy Land",_.setAttribute("for","marijuana-legacy-land"),g.className="circle marijuana-land",_.appendChild(g),y.appendChild(m),y.appendChild(_),o.appendChild(y),v.type="checkbox",v.name="forSale-data",v.id="marijuana-legacy-structure",v.value="marijuana-legacy-structure",e.app.filters.includes("marijuana-legacy-structure")?v.checked=!0:v.checked=!1,v.addEventListener("change",(function(t){e.updateFilters(t,e)})),b.innerText="Marijuana Legacy Structures",b.setAttribute("for","marijuana-legacy-structure"),x.className="circle marijuana-structure",b.appendChild(x),w.appendChild(v),w.appendChild(b),o.appendChild(w),i.appendChild(n),i.appendChild(r),i.appendChild(a),e.form.appendChild(i),e.form.appendChild(o);var S=document.createElement("article"),E=document.createElement("input"),T=document.createElement("label"),M=document.createElement("button"),C=document.createElement("article"),I=document.createElement("input"),A=document.createElement("span"),k=document.createElement("label"),R=document.createElement("div"),z=document.createElement("input"),P=document.createElement("span"),D=document.createElement("label"),L=document.createElement("div"),B=document.createElement("input"),O=document.createElement("span"),F=document.createElement("label"),N=document.createElement("div");S.className="parent-filter-container",E.type="checkbox",E.value="fire-stations,police-stations,parks-fill,parks-line",E.id="publicAssests-all",E.name="publicAssests-data",e.app.filters.includes("publicAssests-all")?E.checked=!0:E.checked=!1,E.className="parent-filter",T.innerText="Public Assets",T.setAttribute("for","publicAssests-all"),M.type="expand",E.addEventListener("change",(function(t){e.updateFilters(t,e)})),e.expansion.publicAssests?M.innerHTML='<i class="fas fa-minus"></i>':M.innerHTML='<i class="fas fa-plus"></i>',M.addEventListener("click",(function(t){e.expansion.publicAssests?e.expansion.publicAssests=!1:e.expansion.publicAssests=!0,e.removeForm(e.container),e.buidlForm(e.container,e)})),e.expansion.publicAssests?C.className="filter-subset active":C.className="filter-subset",I.type="checkbox",I.name="publicAssests-data",I.id="fire-stations",I.value="fire-stations",e.app.filters.includes("fire-stations")?I.checked=!0:I.checked=!1,I.addEventListener("change",(function(t){e.updateFilters(t,e)})),k.innerText="Fire Stations",k.setAttribute("for","fire-stations"),A.className="circle fire",k.appendChild(A),R.appendChild(I),R.appendChild(k),C.appendChild(R),z.type="checkbox",z.name="publicAssests-data",z.id="police-stations",z.value="police-stations",e.app.filters.includes("police-stations")?z.checked=!0:z.checked=!1,z.addEventListener("change",(function(t){e.updateFilters(t,e)})),D.innerText="Police Stations",D.setAttribute("for","police-stations"),P.className="circle police",D.appendChild(P),L.appendChild(z),L.appendChild(D),C.appendChild(L),B.type="checkbox",B.name="publicAssests-data",B.id="active-parks",B.value="parks-fill,parks-line",e.app.filters.includes("parks-fill")?B.checked=!0:B.checked=!1,B.addEventListener("change",(function(t){e.updateFilters(t,e)})),F.innerText="Active Parks",F.setAttribute("for","active-parks"),O.className="square parks",F.appendChild(O),N.appendChild(B),N.appendChild(F),C.appendChild(N),S.appendChild(E),S.appendChild(T),S.appendChild(M),e.form.appendChild(S),e.form.appendChild(C);var U=document.createElement("article"),$=document.createElement("input"),V=document.createElement("label"),j=document.createElement("button"),q=document.createElement("article"),G=document.createElement("input"),H=document.createElement("span"),W=document.createElement("label"),Z=document.createElement("div"),Y=document.createElement("input"),X=document.createElement("span"),K=document.createElement("label"),J=document.createElement("div"),Q=document.createElement("input"),tt=document.createElement("span"),et=document.createElement("label"),it=document.createElement("div");U.className="parent-filter-container",$.type="checkbox",$.value="opp-zones-fill,opp-zones-line,snf-fill,snf-line,tmah-fill,tmah-line",$.id="planningHousing-all",$.name="planningHousing-data",e.app.filters.includes("planningHousing-all")?$.checked=!0:$.checked=!1,$.className="parent-filter",V.innerText="Planning and Housing",V.setAttribute("for","planningHousing-all"),j.type="expand",$.addEventListener("change",(function(t){e.updateFilters(t,e)})),e.expansion.planningHousing?j.innerHTML='<i class="fas fa-minus"></i>':j.innerHTML='<i class="fas fa-plus"></i>',j.addEventListener("click",(function(t){e.expansion.planningHousing?e.expansion.planningHousing=!1:e.expansion.planningHousing=!0,e.removeForm(e.container),e.buidlForm(e.container,e)})),e.expansion.planningHousing?q.className="filter-subset active":q.className="filter-subset",G.type="checkbox",G.name="trans-data",G.id="opp-zones",G.value="opp-zones-fill,opp-zones-line",e.app.filters.includes("opp-zones-fill")?G.checked=!0:G.checked=!1,G.addEventListener("change",(function(t){e.updateFilters(t,e)})),W.innerText="Opportunity Zones",W.setAttribute("for","opp-zones"),H.className="square opp-zones",W.appendChild(H),Z.appendChild(G),Z.appendChild(W),q.appendChild(Z),Y.type="checkbox",Y.name="trans-data",Y.id="snf",Y.value="snf-fill,snf-line",e.app.filters.includes("snf-fill")?Y.checked=!0:Y.checked=!1,Y.addEventListener("change",(function(t){e.updateFilters(t,e)})),K.innerText="Strategic Neighborhood Fund",K.setAttribute("for","snf"),X.className="square snf",K.appendChild(X),J.appendChild(Y),J.appendChild(K),q.appendChild(J),Q.type="checkbox",Q.name="trans-data",Q.id="tmah",Q.value="tmah-fill,tmah-line",e.app.filters.includes("tmah-fill")?Q.checked=!0:Q.checked=!1,Q.addEventListener("change",(function(t){e.updateFilters(t,e)})),et.innerText="Targeted Multifamily Housing Areas",et.setAttribute("for","tmah"),tt.className="square tmah",et.appendChild(tt),it.appendChild(Q),it.appendChild(et),q.appendChild(it),U.appendChild($),U.appendChild(V),U.appendChild(j),e.form.appendChild(U),e.form.appendChild(q);var nt=document.createElement("article"),rt=document.createElement("input"),at=document.createElement("label"),ot=document.createElement("button"),st=document.createElement("article"),lt=document.createElement("input"),ct=document.createElement("span"),ut=document.createElement("label"),ht=document.createElement("div"),pt=document.createElement("input"),dt=document.createElement("span"),ft=document.createElement("label"),mt=document.createElement("div"),gt=document.createElement("input"),_t=document.createElement("span"),yt=document.createElement("label"),vt=document.createElement("div"),xt=document.createElement("input"),bt=document.createElement("span"),wt=document.createElement("label"),St=document.createElement("div");nt.className="parent-filter-container",rt.type="checkbox",rt.value="smartroutes,qlineroute,qlinestops,peoplemover,mogobikes",rt.id="transportation-all",rt.name="trans-data",e.app.filters.includes("transportation-all")?rt.checked=!0:rt.checked=!1,rt.className="parent-filter",at.innerText="Transportation",at.setAttribute("for","transportation-all"),ot.type="expand",rt.addEventListener("change",(function(t){e.updateFilters(t,e)})),e.expansion.transportation?ot.innerHTML='<i class="fas fa-minus"></i>':ot.innerHTML='<i class="fas fa-plus"></i>',ot.addEventListener("click",(function(t){e.expansion.transportation?e.expansion.transportation=!1:e.expansion.transportation=!0,e.removeForm(e.container),e.buidlForm(e.container,e)})),e.expansion.transportation?st.className="filter-subset active":st.className="filter-subset",lt.type="checkbox",lt.name="trans-data",lt.id="qlineroute",lt.value="qlineroute,qlinestops",e.app.filters.includes("qlineroute")?lt.checked=!0:lt.checked=!1,lt.addEventListener("change",(function(t){e.updateFilters(t,e)})),ut.innerText="Q-Line",ut.setAttribute("for","qlineroute"),ct.className="line qline",ut.appendChild(ct),ht.appendChild(lt),ht.appendChild(ut),st.appendChild(ht),pt.type="checkbox",pt.name="trans-data",pt.id="smartroutes",pt.value="smartroutes",e.app.filters.includes("smartroutes")?pt.checked=!0:pt.checked=!1,pt.addEventListener("change",(function(t){e.updateFilters(t,e)})),ft.innerText="Smart Buses",ft.setAttribute("for","smartroutes"),dt.className="line smart-bus",ft.appendChild(dt),mt.appendChild(pt),mt.appendChild(ft),st.appendChild(mt),gt.type="checkbox",gt.name="trans-data",gt.id="peoplemover",gt.value="peoplemover",e.app.filters.includes("peoplemover")?gt.checked=!0:gt.checked=!1,gt.addEventListener("change",(function(t){e.updateFilters(t,e)})),yt.innerText="People Mover",yt.setAttribute("for","peoplemover"),_t.className="line p-mover",yt.appendChild(_t),vt.appendChild(gt),vt.appendChild(yt),st.appendChild(vt),xt.type="checkbox",xt.name="trans-data",xt.id="mogobikes",xt.value="mogobikes",e.app.filters.includes("mogobikes")?xt.checked=!0:xt.checked=!1,xt.addEventListener("change",(function(t){e.updateFilters(t,e)})),wt.innerText="MoGo Bike Station",wt.setAttribute("for","mogobikes"),bt.className="circle mogo",wt.appendChild(bt),St.appendChild(xt),St.appendChild(wt),st.appendChild(St),nt.appendChild(rt),nt.appendChild(at),nt.appendChild(ot),e.form.appendChild(nt),e.form.appendChild(st);var Et=document.createElement("article"),Tt=document.createElement("input"),Mt=document.createElement("label"),Ct=document.createElement("button"),It=document.createElement("article"),At=document.createElement("input"),kt=document.createElement("span"),Rt=document.createElement("label"),zt=document.createElement("div"),Pt=document.createElement("input"),Dt=document.createElement("span"),Lt=document.createElement("label"),Bt=document.createElement("div"),Ot=document.createElement("input"),Ft=document.createElement("span"),Nt=document.createElement("label"),Ut=document.createElement("div"),$t=document.createElement("input"),Vt=document.createElement("span"),jt=document.createElement("label"),qt=document.createElement("div"),Gt=document.createElement("input"),Ht=document.createElement("span"),Wt=document.createElement("label"),Zt=document.createElement("div"),Yt=document.createElement("input"),Xt=document.createElement("span"),Kt=document.createElement("label"),Jt=document.createElement("div");Et.className="parent-filter-container",Tt.type="checkbox",Tt.value="R1,R2,R3,R4,R5,R6",Tt.id="r-zoning-all",Tt.name="r-zoning-data",e.app.filters.includes("r-zoning-all")?Tt.checked=!0:Tt.checked=!1,Tt.className="parent-filter",Mt.innerText="Residential Zoning",Mt.setAttribute("for","r-zoning-all"),Ct.type="expand",Tt.addEventListener("change",(function(t){e.updateFilters(t,e)})),e.expansion.zoning?Ct.innerHTML='<i class="fas fa-minus"></i>':Ct.innerHTML='<i class="fas fa-plus"></i>',Ct.addEventListener("click",(function(t){e.expansion.zoning?e.expansion.zoning=!1:e.expansion.zoning=!0,e.removeForm(e.container),e.buidlForm(e.container,e)})),e.expansion.zoning?It.className="filter-subset active":It.className="filter-subset",At.type="checkbox",At.name="r-zoning-data",At.id="R1",At.value="R1",e.app.filters.includes("R1")?At.checked=!0:At.checked=!1,At.addEventListener("change",(function(t){e.updateFilters(t,e)})),Rt.innerText="R1 - Zoning",Rt.setAttribute("for","R1"),kt.className="line R1",Rt.appendChild(kt),zt.appendChild(At),zt.appendChild(Rt),It.appendChild(zt),Pt.type="checkbox",Pt.name="r-zoning-data",Pt.id="R2",Pt.value="R2",e.app.filters.includes("R2")?Pt.checked=!0:Pt.checked=!1,Pt.addEventListener("change",(function(t){e.updateFilters(t,e)})),Lt.innerText="R2 - Zoning",Lt.setAttribute("for","R2"),Dt.className="line R2",Lt.appendChild(Dt),Bt.appendChild(Pt),Bt.appendChild(Lt),It.appendChild(Bt),Ot.type="checkbox",Ot.name="r-zoning-data",Ot.id="R3",Ot.value="R3",e.app.filters.includes("R3")?Ot.checked=!0:Ot.checked=!1,Ot.addEventListener("change",(function(t){e.updateFilters(t,e)})),Nt.innerText="R3 - Zoning",Nt.setAttribute("for","R3"),Ft.className="line R3",Nt.appendChild(Ft),Ut.appendChild(Ot),Ut.appendChild(Nt),It.appendChild(Ut),$t.type="checkbox",$t.name="r-zoning-data",$t.id="R4",$t.value="R4",e.app.filters.includes("R4")?$t.checked=!0:$t.checked=!1,$t.addEventListener("change",(function(t){e.updateFilters(t,e)})),jt.innerText="R4 - Zoning",jt.setAttribute("for","R4"),Vt.className="line R4",jt.appendChild(Vt),qt.appendChild($t),qt.appendChild(jt),It.appendChild(qt),Gt.type="checkbox",Gt.name="r-zoning-data",Gt.id="R5",Gt.value="R5",e.app.filters.includes("R5")?Gt.checked=!0:Gt.checked=!1,Gt.addEventListener("change",(function(t){e.updateFilters(t,e)})),Wt.innerText="R5 - Zoning",Wt.setAttribute("for","R5"),Ht.className="line R5",Wt.appendChild(Ht),Zt.appendChild(Gt),Zt.appendChild(Wt),It.appendChild(Zt),Yt.type="checkbox",Yt.name="r-zoning-data",Yt.id="R6",Yt.value="R6",e.app.filters.includes("R6")?Yt.checked=!0:Yt.checked=!1,Yt.addEventListener("change",(function(t){e.updateFilters(t,e)})),Kt.innerText="R6 - Zoning",Kt.setAttribute("for","R6"),Xt.className="line R6",Kt.appendChild(Xt),Jt.appendChild(Yt),Jt.appendChild(Kt),It.appendChild(Jt),Et.appendChild(Tt),Et.appendChild(Mt),Et.appendChild(Ct),e.form.appendChild(Et),e.form.appendChild(It);var Qt=document.createElement("article"),te=document.createElement("input"),ee=document.createElement("label"),ie=document.createElement("button"),ne=document.createElement("article"),re=document.createElement("input"),ae=document.createElement("span"),oe=document.createElement("label"),se=document.createElement("div"),le=document.createElement("input"),ce=document.createElement("span"),ue=document.createElement("label"),he=document.createElement("div"),pe=document.createElement("input"),de=document.createElement("span"),fe=document.createElement("label"),me=document.createElement("div"),ge=document.createElement("input"),_e=document.createElement("span"),ye=document.createElement("label"),ve=document.createElement("div"),xe=document.createElement("input"),be=document.createElement("span"),we=document.createElement("label"),Se=document.createElement("div"),Ee=document.createElement("input"),Te=document.createElement("span"),Me=document.createElement("label"),Ce=document.createElement("div");Qt.className="parent-filter-container",te.type="checkbox",te.value="B1,B2,B3,B4,B5,B6",te.id="b-zoning-all",te.name="b-zoning-data",e.app.filters.includes("b-zoning-all")?te.checked=!0:te.checked=!1,te.className="parent-filter",ee.innerText="Business Zoning",ee.setAttribute("for","b-zoning-all"),ie.type="expand",te.addEventListener("change",(function(t){e.updateFilters(t,e)})),e.expansion.zoningB?ie.innerHTML='<i class="fas fa-minus"></i>':ie.innerHTML='<i class="fas fa-plus"></i>',ie.addEventListener("click",(function(t){e.expansion.zoningB?e.expansion.zoningB=!1:e.expansion.zoningB=!0,e.removeForm(e.container),e.buidlForm(e.container,e)})),e.expansion.zoningB?ne.className="filter-subset active":ne.className="filter-subset",re.type="checkbox",re.name="b-zoning-data",re.id="B1",re.value="B1",e.app.filters.includes("B1")?re.checked=!0:re.checked=!1,re.addEventListener("change",(function(t){e.updateFilters(t,e)})),oe.innerText="B1 - Zoning",oe.setAttribute("for","B1"),ae.className="line B1",oe.appendChild(ae),se.appendChild(re),se.appendChild(oe),ne.appendChild(se),le.type="checkbox",le.name="b-zoning-data",le.id="B2",le.value="B2",e.app.filters.includes("B2")?le.checked=!0:le.checked=!1,le.addEventListener("change",(function(t){e.updateFilters(t,e)})),ue.innerText="B2 - Zoning",ue.setAttribute("for","B2"),ce.className="line B2",ue.appendChild(ce),he.appendChild(le),he.appendChild(ue),ne.appendChild(he),pe.type="checkbox",pe.name="b-zoning-data",pe.id="B3",pe.value="B3",e.app.filters.includes("B3")?pe.checked=!0:pe.checked=!1,pe.addEventListener("change",(function(t){e.updateFilters(t,e)})),fe.innerText="B3 - Zoning",fe.setAttribute("for","B3"),de.className="line B3",fe.appendChild(de),me.appendChild(pe),me.appendChild(fe),ne.appendChild(me),ge.type="checkbox",ge.name="b-zoning-data",ge.id="B4",ge.value="B4",e.app.filters.includes("B4")?ge.checked=!0:ge.checked=!1,ge.addEventListener("change",(function(t){e.updateFilters(t,e)})),ye.innerText="B4 - Zoning",ye.setAttribute("for","B4"),_e.className="line B4",ye.appendChild(_e),ve.appendChild(ge),ve.appendChild(ye),ne.appendChild(ve),xe.type="checkbox",xe.name="b-zoning-data",xe.id="B5",xe.value="B5",e.app.filters.includes("B5")?xe.checked=!0:xe.checked=!1,xe.addEventListener("change",(function(t){e.updateFilters(t,e)})),we.innerText="B5 - Zoning",we.setAttribute("for","B5"),be.className="line B5",we.appendChild(be),Se.appendChild(xe),Se.appendChild(we),ne.appendChild(Se),Ee.type="checkbox",Ee.name="b-zoning-data",Ee.id="B6",Ee.value="B6",e.app.filters.includes("B6")?Ee.checked=!0:Ee.checked=!1,Ee.addEventListener("change",(function(t){e.updateFilters(t,e)})),Me.innerText="B6 - Zoning",Me.setAttribute("for","B6"),Te.className="line B6",Me.appendChild(Te),Ce.appendChild(Ee),Ce.appendChild(Me),ne.appendChild(Ce),Qt.appendChild(te),Qt.appendChild(ee),Qt.appendChild(ie),e.form.appendChild(Qt),e.form.appendChild(ne);var Ie=document.createElement("article"),Ae=document.createElement("input"),ke=document.createElement("label"),Re=document.createElement("button"),ze=document.createElement("article"),Pe=document.createElement("input"),De=document.createElement("span"),Le=document.createElement("label"),Be=document.createElement("div"),Oe=document.createElement("input"),Fe=document.createElement("span"),Ne=document.createElement("label"),Ue=document.createElement("div"),$e=document.createElement("input"),Ve=document.createElement("span"),je=document.createElement("label"),qe=document.createElement("div"),Ge=document.createElement("input"),He=document.createElement("span"),We=document.createElement("label"),Ze=document.createElement("div"),Ye=document.createElement("input"),Xe=document.createElement("span"),Ke=document.createElement("label"),Je=document.createElement("div");Ie.className="parent-filter-container",Ae.type="checkbox",Ae.value="M1,M2,M3,M4,M5",Ae.id="m-zoning-all",Ae.name="m-zoning-data",e.app.filters.includes("m-zoning-all")?Ae.checked=!0:Ae.checked=!1,Ae.className="parent-filter",ke.innerText="Industrial Zoning",ke.setAttribute("for","m-zoning-all"),Re.type="expand",Ae.addEventListener("change",(function(t){e.updateFilters(t,e)})),e.expansion.zoningM?Re.innerHTML='<i class="fas fa-minus"></i>':Re.innerHTML='<i class="fas fa-plus"></i>',Re.addEventListener("click",(function(t){e.expansion.zoningM?e.expansion.zoningM=!1:e.expansion.zoningM=!0,e.removeForm(e.container),e.buidlForm(e.container,e)})),e.expansion.zoningM?ze.className="filter-subset active":ze.className="filter-subset",Pe.type="checkbox",Pe.name="m-zoning-data",Pe.id="M1",Pe.value="M1",e.app.filters.includes("M1")?Pe.checked=!0:Pe.checked=!1,Pe.addEventListener("change",(function(t){e.updateFilters(t,e)})),Le.innerText="M1 - Zoning",Le.setAttribute("for","M1"),De.className="line M1",Le.appendChild(De),Be.appendChild(Pe),Be.appendChild(Le),ze.appendChild(Be),Oe.type="checkbox",Oe.name="m-zoning-data",Oe.id="M2",Oe.value="M2",e.app.filters.includes("M2")?Oe.checked=!0:Oe.checked=!1,Oe.addEventListener("change",(function(t){e.updateFilters(t,e)})),Ne.innerText="M2 - Zoning",Ne.setAttribute("for","M2"),Fe.className="line M2",Ne.appendChild(Fe),Ue.appendChild(Oe),Ue.appendChild(Ne),ze.appendChild(Ue),$e.type="checkbox",$e.name="m-zoning-data",$e.id="M3",$e.value="M3",e.app.filters.includes("M3")?$e.checked=!0:$e.checked=!1,$e.addEventListener("change",(function(t){e.updateFilters(t,e)})),je.innerText="M3 - Zoning",je.setAttribute("for","M3"),Ve.className="line M3",je.appendChild(Ve),qe.appendChild($e),qe.appendChild(je),ze.appendChild(qe),Ge.type="checkbox",Ge.name="m-zoning-data",Ge.id="M4",Ge.value="M4",e.app.filters.includes("M4")?Ge.checked=!0:Ge.checked=!1,Ge.addEventListener("change",(function(t){e.updateFilters(t,e)})),We.innerText="M4 - Zoning",We.setAttribute("for","M4"),He.className="line M4",We.appendChild(He),Ze.appendChild(Ge),Ze.appendChild(We),ze.appendChild(Ze),Ye.type="checkbox",Ye.name="m-zoning-data",Ye.id="M5",Ye.value="M5",e.app.filters.includes("M5")?Ye.checked=!0:Ye.checked=!1,Ye.addEventListener("change",(function(t){e.updateFilters(t,e)})),Ke.innerText="M5 - Zoning",Ke.setAttribute("for","M5"),Xe.className="line M5",Ke.appendChild(Xe),Je.appendChild(Ye),Je.appendChild(Ke),ze.appendChild(Je),Ie.appendChild(Ae),Ie.appendChild(ke),Ie.appendChild(Re),e.form.appendChild(Ie),e.form.appendChild(ze);var Qe=document.createElement("article"),ti=document.createElement("input"),ei=document.createElement("label"),ii=document.createElement("button"),ni=document.createElement("article"),ri=document.createElement("input"),ai=document.createElement("span"),oi=document.createElement("label"),si=document.createElement("div"),li=document.createElement("input"),ci=document.createElement("span"),ui=document.createElement("label"),hi=document.createElement("div"),pi=document.createElement("input"),di=document.createElement("span"),fi=document.createElement("label"),mi=document.createElement("div"),gi=document.createElement("input"),_i=document.createElement("span"),yi=document.createElement("label"),vi=document.createElement("div"),xi=document.createElement("input"),bi=document.createElement("span"),wi=document.createElement("label"),Si=document.createElement("div"),Ei=document.createElement("input"),Ti=document.createElement("span"),Mi=document.createElement("label"),Ci=document.createElement("div"),Ii=document.createElement("input"),Ai=document.createElement("span"),ki=document.createElement("label"),Ri=document.createElement("div"),zi=document.createElement("input"),Pi=document.createElement("span"),Di=document.createElement("label"),Li=document.createElement("div"),Bi=document.createElement("input"),Oi=document.createElement("span"),Fi=document.createElement("label"),Ni=document.createElement("div"),Ui=document.createElement("input"),$i=document.createElement("span"),Vi=document.createElement("label"),ji=document.createElement("div"),qi=document.createElement("input"),Gi=document.createElement("span"),Hi=document.createElement("label"),Wi=document.createElement("div"),Zi=document.createElement("input"),Yi=document.createElement("span"),Xi=document.createElement("label"),Ki=document.createElement("div");Qe.className="parent-filter-container",ti.type="checkbox",ti.value="P1,PC,PCA,PD,PR,SD1,SD2,SD3,SD4,SD5,TM,W5",ti.id="s-zoning-all",ti.name="s-zoning-data",e.app.filters.includes("s-zoning-all")?ti.checked=!0:ti.checked=!1,ti.className="parent-filter",ei.innerText="Special Zoning",ei.setAttribute("for","s-zoning-all"),ii.type="expand",ti.addEventListener("change",(function(t){e.updateFilters(t,e)})),e.expansion.zoningS?ii.innerHTML='<i class="fas fa-minus"></i>':ii.innerHTML='<i class="fas fa-plus"></i>',ii.addEventListener("click",(function(t){e.expansion.zoningS?e.expansion.zoningS=!1:e.expansion.zoningS=!0,e.removeForm(e.container),e.buidlForm(e.container,e)})),e.expansion.zoningS?ni.className="filter-subset active":ni.className="filter-subset",ri.type="checkbox",ri.name="s-zoning-data",ri.id="P1",ri.value="P1",e.app.filters.includes("P1")?ri.checked=!0:ri.checked=!1,ri.addEventListener("change",(function(t){e.updateFilters(t,e)})),oi.innerText="P1 - Zoning",oi.setAttribute("for","P1"),ai.className="line P1",oi.appendChild(ai),si.appendChild(ri),si.appendChild(oi),ni.appendChild(si),li.type="checkbox",li.name="s-zoning-data",li.id="PC",li.value="PC",e.app.filters.includes("PC")?li.checked=!0:li.checked=!1,li.addEventListener("change",(function(t){e.updateFilters(t,e)})),ui.innerText="PC - Zoning",ui.setAttribute("for","PC"),ci.className="line PC",ui.appendChild(ci),hi.appendChild(li),hi.appendChild(ui),ni.appendChild(hi),pi.type="checkbox",pi.name="s-zoning-data",pi.id="PCA",pi.value="PCA",e.app.filters.includes("PCA")?pi.checked=!0:pi.checked=!1,pi.addEventListener("change",(function(t){e.updateFilters(t,e)})),fi.innerText="PCA - Zoning",fi.setAttribute("for","PCA"),di.className="line PCA",fi.appendChild(di),mi.appendChild(pi),mi.appendChild(fi),ni.appendChild(mi),gi.type="checkbox",gi.name="s-zoning-data",gi.id="PD",gi.value="PD",e.app.filters.includes("PD")?gi.checked=!0:gi.checked=!1,gi.addEventListener("change",(function(t){e.updateFilters(t,e)})),yi.innerText="PD - Zoning",yi.setAttribute("for","PD"),_i.className="line PD",yi.appendChild(_i),vi.appendChild(gi),vi.appendChild(yi),ni.appendChild(vi),xi.type="checkbox",xi.name="s-zoning-data",xi.id="PR",xi.value="PR",e.app.filters.includes("PR")?xi.checked=!0:xi.checked=!1,xi.addEventListener("change",(function(t){e.updateFilters(t,e)})),wi.innerText="PR - Zoning",wi.setAttribute("for","PR"),bi.className="line PR",wi.appendChild(bi),Si.appendChild(xi),Si.appendChild(wi),ni.appendChild(Si),Ei.type="checkbox",Ei.name="s-zoning-data",Ei.id="SD1",Ei.value="SD1",e.app.filters.includes("SD1")?Ei.checked=!0:Ei.checked=!1,Ei.addEventListener("change",(function(t){e.updateFilters(t,e)})),Mi.innerText="SD1 - Zoning",Mi.setAttribute("for","SD1"),Ti.className="line SD1",Mi.appendChild(Ti),Ci.appendChild(Ei),Ci.appendChild(Mi),ni.appendChild(Ci),Ii.type="checkbox",Ii.name="s-zoning-data",Ii.id="SD2",Ii.value="SD2",e.app.filters.includes("SD2")?Ii.checked=!0:Ii.checked=!1,Ii.addEventListener("change",(function(t){e.updateFilters(t,e)})),ki.innerText="SD2 - Zoning",ki.setAttribute("for","SD2"),Ai.className="line SD2",ki.appendChild(Ai),Ri.appendChild(Ii),Ri.appendChild(ki),ni.appendChild(Ri),zi.type="checkbox",zi.name="s-zoning-data",zi.id="SD3",zi.value="SD3",e.app.filters.includes("SD3")?zi.checked=!0:zi.checked=!1,zi.addEventListener("change",(function(t){e.updateFilters(t,e)})),Di.innerText="SD3 - Zoning",Di.setAttribute("for","SD3"),Pi.className="line SD3",Di.appendChild(Pi),Li.appendChild(zi),Li.appendChild(Di),ni.appendChild(Li),Bi.type="checkbox",Bi.name="s-zoning-data",Bi.id="SD4",Bi.value="SD4",e.app.filters.includes("SD4")?Bi.checked=!0:Bi.checked=!1,Bi.addEventListener("change",(function(t){e.updateFilters(t,e)})),Fi.innerText="SD4 - Zoning",Fi.setAttribute("for","SD4"),Oi.className="line SD4",Fi.appendChild(Oi),Ni.appendChild(Bi),Ni.appendChild(Fi),ni.appendChild(Ni),Ui.type="checkbox",Ui.name="s-zoning-data",Ui.id="SD5",Ui.value="SD5",e.app.filters.includes("SD5")?Ui.checked=!0:Ui.checked=!1,Ui.addEventListener("change",(function(t){e.updateFilters(t,e)})),Vi.innerText="SD5 - Zoning",Vi.setAttribute("for","SD5"),$i.className="line SD5",Vi.appendChild($i),ji.appendChild(Ui),ji.appendChild(Vi),ni.appendChild(ji),qi.type="checkbox",qi.name="s-zoning-data",qi.id="TM",qi.value="TM",e.app.filters.includes("TM")?qi.checked=!0:qi.checked=!1,qi.addEventListener("change",(function(t){e.updateFilters(t,e)})),Hi.innerText="TM - Zoning",Hi.setAttribute("for","TM"),Gi.className="line TM",Hi.appendChild(Gi),Wi.appendChild(qi),Wi.appendChild(Hi),ni.appendChild(Wi),Zi.type="checkbox",Zi.name="s-zoning-data",Zi.id="W5",Zi.value="W5",e.app.filters.includes("W5")?Zi.checked=!0:Zi.checked=!1,Zi.addEventListener("change",(function(t){e.updateFilters(t,e)})),Xi.innerText="W5 - Zoning",Xi.setAttribute("for","W5"),Yi.className="line W5",Xi.appendChild(Yi),Ki.appendChild(Zi),Ki.appendChild(Xi),ni.appendChild(Ki),Qe.appendChild(ti),Qe.appendChild(ei),Qe.appendChild(ii),e.form.appendChild(Qe),e.form.appendChild(ni),e.form.addEventListener("submit",(function(t){t.preventDefault(),console.log(t)})),t.appendChild(e.form)}}]),t}(),w=function(t,e){return w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},w(t,e)};function S(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}w(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}function E(t,e,i,n){return new(i||(i=Promise))((function(r,a){function o(t){try{l(n.next(t))}catch(e){a(e)}}function s(t){try{l(n.throw(t))}catch(e){a(e)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,s)}l((n=n.apply(t,e||[])).next())}))}function T(t,e){var i,n,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,n&&(r=2&a[0]?n.return:a[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,a[1])).done)return r;switch(n=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=(r=o.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(s){a=[6,s],n=0}finally{i=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function M(t){var e="function"===typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"===typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function C(t,e){var i="function"===typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,r,a=i.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(n=a.next()).done;)o.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return o}function I(t,e){for(var i=0,n=e.length,r=t.length;i<n;i++,r++)t[r]=e[i];return t}function A(t){return this instanceof A?(this.v=t,this):new A(t)}function k(t,e,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,r=i.apply(t,e||[]),a=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(t){r[t]&&(n[t]=function(e){return new Promise((function(i,n){a.push([t,e,i,n])>1||s(t,e)}))})}function s(t,e){try{!function(t){t.value instanceof A?Promise.resolve(t.value.v).then(l,c):u(a[0][2],t)}(r[t](e))}catch(i){u(a[0][3],i)}}function l(t){s("next",t)}function c(t){s("throw",t)}function u(t,e){t(e),a.shift(),a.length&&s(a[0][0],a[0][1])}}function R(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,i=t[Symbol.asyncIterator];return i?i.call(t):(t=M(t),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(i){e[i]=t[i]&&function(e){return new Promise((function(n,r){(function(t,e,i,n){Promise.resolve(n).then((function(e){t({value:e,done:i})}),e)})(n,r,(e=t[i](e)).done,e.value)}))}}}function z(t){return"function"===typeof t}function P(t){var e=t((function(t){Error.call(t),t.stack=(new Error).stack}));return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var D=P((function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}}));function L(t,e){if(t){var i=t.indexOf(e);0<=i&&t.splice(i,1)}}var B=function(){function t(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._teardowns=null}return t.prototype.unsubscribe=function(){var t,e,i,n,r;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var o=M(a),s=o.next();!s.done;s=o.next()){s.value.remove(this)}}catch(d){t={error:d}}finally{try{s&&!s.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}else a.remove(this);var l=this.initialTeardown;if(z(l))try{l()}catch(f){r=f instanceof D?f.errors:[f]}var c=this._teardowns;if(c){this._teardowns=null;try{for(var u=M(c),h=u.next();!h.done;h=u.next()){var p=h.value;try{N(p)}catch(kx){r=null!==r&&void 0!==r?r:[],kx instanceof D?r=I(I([],C(r)),C(kx.errors)):r.push(kx)}}}catch(m){i={error:m}}finally{try{h&&!h.done&&(n=u.return)&&n.call(u)}finally{if(i)throw i.error}}}if(r)throw new D(r)}},t.prototype.add=function(e){var i;if(e&&e!==this)if(this.closed)N(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._teardowns=null!==(i=this._teardowns)&&void 0!==i?i:[]).push(e)}},t.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},t.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},t.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&L(e,t)},t.prototype.remove=function(e){var i=this._teardowns;i&&L(i,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}(),O=B.EMPTY;function F(t){return t instanceof B||t&&"closed"in t&&z(t.remove)&&z(t.add)&&z(t.unsubscribe)}function N(t){z(t)?t():t.unsubscribe()}var U={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},$={setTimeout:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=$.delegate;return((null===i||void 0===i?void 0:i.setTimeout)||setTimeout).apply(void 0,I([],C(t)))},clearTimeout:function(t){var e=$.delegate;return((null===e||void 0===e?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function V(t){$.setTimeout((function(){throw t}))}function j(){}var q=G("C",void 0,void 0);function G(t,e,i){return{kind:t,value:e,error:i}}var H=null;function W(t){if(U.useDeprecatedSynchronousErrorHandling){var e=!H;if(e&&(H={errorThrown:!1,error:null}),t(),e){var i=H,n=i.errorThrown,r=i.error;if(H=null,n)throw r}}else t()}var Z=function(t){function e(e){var i=t.call(this)||this;return i.isStopped=!1,e?(i.destination=e,F(e)&&e.add(i)):i.destination=Q,i}return S(e,t),e.create=function(t,e,i){return new Y(t,e,i)},e.prototype.next=function(t){this.isStopped?J(function(t){return G("N",t,void 0)}(t),this):this._next(t)},e.prototype.error=function(t){this.isStopped?J(G("E",void 0,t),this):(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped?J(q,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(B),Y=function(t){function e(e,i,n){var r,a=t.call(this)||this;if(z(e))r=e;else if(e){var o;r=e.next,i=e.error,n=e.complete,a&&U.useDeprecatedNextContext?(o=Object.create(e)).unsubscribe=function(){return a.unsubscribe()}:o=e,r=null===r||void 0===r?void 0:r.bind(o),i=null===i||void 0===i?void 0:i.bind(o),n=null===n||void 0===n?void 0:n.bind(o)}return a.destination={next:r?X(r):j,error:X(null!==i&&void 0!==i?i:K),complete:n?X(n):j},a}return S(e,t),e}(Z);function X(t,e){return function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];try{t.apply(void 0,I([],C(e)))}catch(kx){V(kx)}}}function K(t){throw t}function J(t,e){var i=U.onStoppedNotification;i&&$.setTimeout((function(){return i(t,e)}))}var Q={closed:!0,next:j,error:K,complete:j},tt="function"===typeof Symbol&&Symbol.observable||"@@observable";function et(t){return t}function it(t){return 0===t.length?et:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var nt=function(){function t(t){t&&(this._subscribe=t)}return t.prototype.lift=function(e){var i=new t;return i.source=this,i.operator=e,i},t.prototype.subscribe=function(t,e,i){var n,r=this,a=(n=t)&&n instanceof Z||function(t){return t&&z(t.next)&&z(t.error)&&z(t.complete)}(n)&&F(n)?t:new Y(t,e,i);return W((function(){var t=r,e=t.operator,i=t.source;a.add(e?e.call(a,i):i?r._subscribe(a):r._trySubscribe(a))})),a},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(kx){t.error(kx)}},t.prototype.forEach=function(t,e){var i=this;return new(e=rt(e))((function(e,n){var r;r=i.subscribe((function(e){try{t(e)}catch(kx){n(kx),null===r||void 0===r||r.unsubscribe()}}),n,e)}))},t.prototype._subscribe=function(t){var e;return null===(e=this.source)||void 0===e?void 0:e.subscribe(t)},t.prototype[tt]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return it(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=rt(t))((function(t,i){var n;e.subscribe((function(t){return n=t}),(function(t){return i(t)}),(function(){return t(n)}))}))},t.create=function(e){return new t(e)},t}();function rt(t){var e;return null!==(e=null!==t&&void 0!==t?t:U.Promise)&&void 0!==e?e:Promise}function at(t){return z(null===t||void 0===t?void 0:t.lift)}function ot(t){return function(e){if(at(e))return e.lift((function(e){try{return t(e,this)}catch(kx){this.error(kx)}}));throw new TypeError("Unable to lift unknown Observable type")}}var st=function(t){function e(e,i,n,r,a){var o=t.call(this,e)||this;return o.onFinalize=a,o._next=i?function(t){try{i(t)}catch(kx){e.error(kx)}}:t.prototype._next,o._error=r?function(t){try{r(t)}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._error,o._complete=n?function(){try{n()}catch(kx){e.error(kx)}finally{this.unsubscribe()}}:t.prototype._complete,o}return S(e,t),e.prototype.unsubscribe=function(){var e,i=this.closed;t.prototype.unsubscribe.call(this),!i&&(null===(e=this.onFinalize)||void 0===e||e.call(this))},e}(Z);function lt(){return ot((function(t,e){var i=null;t._refCount++;var n=new st(e,void 0,void 0,void 0,(function(){if(!t||t._refCount<=0||0<--t._refCount)i=null;else{var n=t._connection,r=i;i=null,!n||r&&n!==r||n.unsubscribe(),e.unsubscribe()}}));t.subscribe(n),n.closed||(i=t.connect())}))}var ct=function(t){function e(e,i){var n=t.call(this)||this;return n.source=e,n.subjectFactory=i,n._subject=null,n._refCount=0,n._connection=null,at(e)&&(n.lift=e.lift),n}return S(e,t),e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return t&&!t.isStopped||(this._subject=this.subjectFactory()),this._subject},e.prototype._teardown=function(){this._refCount=0;var t=this._connection;this._subject=this._connection=null,null===t||void 0===t||t.unsubscribe()},e.prototype.connect=function(){var t=this,e=this._connection;if(!e){e=this._connection=new B;var i=this.getSubject();e.add(this.source.subscribe(new st(i,void 0,(function(){t._teardown(),i.complete()}),(function(e){t._teardown(),i.error(e)}),(function(){return t._teardown()})))),e.closed&&(this._connection=null,e=B.EMPTY)}return e},e.prototype.refCount=function(){return lt()(this)},e}(nt),ut=P((function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),ht=function(t){function e(){var e=t.call(this)||this;return e.closed=!1,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return S(e,t),e.prototype.lift=function(t){var e=new pt(this,this);return e.operator=t,e},e.prototype._throwIfClosed=function(){if(this.closed)throw new ut},e.prototype.next=function(t){var e=this;W((function(){var i,n;if(e._throwIfClosed(),!e.isStopped){var r=e.observers.slice();try{for(var a=M(r),o=a.next();!o.done;o=a.next()){o.value.next(t)}}catch(s){i={error:s}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}}}))},e.prototype.error=function(t){var e=this;W((function(){if(e._throwIfClosed(),!e.isStopped){e.hasError=e.isStopped=!0,e.thrownError=t;for(var i=e.observers;i.length;)i.shift().error(t)}}))},e.prototype.complete=function(){var t=this;W((function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var e=t.observers;e.length;)e.shift().complete()}}))},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(e){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var e=this,i=e.hasError,n=e.isStopped,r=e.observers;return i||n?O:(r.push(t),new B((function(){return L(r,t)})))},e.prototype._checkFinalizedStatuses=function(t){var e=this,i=e.hasError,n=e.thrownError,r=e.isStopped;i?t.error(n):r&&t.complete()},e.prototype.asObservable=function(){var t=new nt;return t.source=this,t},e.create=function(t,e){return new pt(t,e)},e}(nt),pt=function(t){function e(e,i){var n=t.call(this)||this;return n.destination=e,n.source=i,n}return S(e,t),e.prototype.next=function(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===i||i.call(e,t)},e.prototype.error=function(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===i||i.call(e,t)},e.prototype.complete=function(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)},e.prototype._subscribe=function(t){var e,i;return null!==(i=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==i?i:O},e}(ht),dt=function(t){function e(e){var i=t.call(this)||this;return i._value=e,i}return S(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(e){var i=t.prototype._subscribe.call(this,e);return!i.closed&&e.next(this._value),i},e.prototype.getValue=function(){var t=this,e=t.hasError,i=t.thrownError,n=t._value;if(e)throw i;return this._throwIfClosed(),n},e.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},e}(ht),ft={now:function(){return(ft.delegate||Date).now()},delegate:void 0},mt=function(t){function e(e,i,n){void 0===e&&(e=1/0),void 0===i&&(i=1/0),void 0===n&&(n=ft);var r=t.call(this)||this;return r._bufferSize=e,r._windowTime=i,r._timestampProvider=n,r._buffer=[],r._infiniteTimeWindow=!0,r._infiniteTimeWindow=i===1/0,r._bufferSize=Math.max(1,e),r._windowTime=Math.max(1,i),r}return S(e,t),e.prototype.next=function(e){var i=this,n=i.isStopped,r=i._buffer,a=i._infiniteTimeWindow,o=i._timestampProvider,s=i._windowTime;n||(r.push(e),!a&&r.push(o.now()+s)),this._trimBuffer(),t.prototype.next.call(this,e)},e.prototype._subscribe=function(t){this._throwIfClosed(),this._trimBuffer();for(var e=this._innerSubscribe(t),i=this._infiniteTimeWindow,n=this._buffer.slice(),r=0;r<n.length&&!t.closed;r+=i?1:2)t.next(n[r]);return this._checkFinalizedStatuses(t),e},e.prototype._trimBuffer=function(){var t=this,e=t._bufferSize,i=t._timestampProvider,n=t._buffer,r=t._infiniteTimeWindow,a=(r?1:2)*e;if(e<1/0&&a<n.length&&n.splice(0,n.length-a),!r){for(var o=i.now(),s=0,l=1;l<n.length&&n[l]<=o;l+=2)s=l;s&&n.splice(0,s+1)}},e}(ht),gt=function(t){function e(e,i){return t.call(this)||this}return S(e,t),e.prototype.schedule=function(t,e){return this},e}(B),_t={setInterval:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=_t.delegate;return((null===i||void 0===i?void 0:i.setInterval)||setInterval).apply(void 0,I([],C(t)))},clearInterval:function(t){var e=_t.delegate;return((null===e||void 0===e?void 0:e.clearInterval)||clearInterval)(t)},delegate:void 0},yt=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n.scheduler=e,n.work=i,n.pending=!1,n}return S(e,t),e.prototype.schedule=function(t,e){if(void 0===e&&(e=0),this.closed)return this;this.state=t;var i=this.id,n=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(n,i,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(n,this.id,e),this},e.prototype.requestAsyncId=function(t,e,i){return void 0===i&&(i=0),_t.setInterval(t.flush.bind(t,this),i)},e.prototype.recycleAsyncId=function(t,e,i){if(void 0===i&&(i=0),null!=i&&this.delay===i&&!1===this.pending)return e;_t.clearInterval(e)},e.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(t,e);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,e){var i,n=!1;try{this.work(t)}catch(r){n=!0,i=!!r&&r||new Error(r)}if(n)return this.unsubscribe(),i},e.prototype.unsubscribe=function(){if(!this.closed){var e=this.id,i=this.scheduler,n=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,L(n,this),null!=e&&(this.id=this.recycleAsyncId(i,e,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(gt),vt=function(){function t(e,i){void 0===i&&(i=t.now),this.schedulerActionCtor=e,this.now=i}return t.prototype.schedule=function(t,e,i){return void 0===e&&(e=0),new this.schedulerActionCtor(this,t).schedule(i,e)},t.now=ft.now,t}(),xt=function(t){function e(e,i){void 0===i&&(i=vt.now);var n=t.call(this,e,i)||this;return n.actions=[],n._active=!1,n._scheduled=void 0,n}return S(e,t),e.prototype.flush=function(t){var e=this.actions;if(this._active)e.push(t);else{var i;this._active=!0;do{if(i=t.execute(t.state,t.delay))break}while(t=e.shift());if(this._active=!1,i){for(;t=e.shift();)t.unsubscribe();throw i}}},e}(vt),bt=new xt(yt),wt=bt,St=new nt((function(t){return t.complete()}));function Et(t){return t?function(t){return new nt((function(e){return t.schedule((function(){return e.complete()}))}))}(t):St}function Tt(t,e){return new nt((function(i){var n=0;return e.schedule((function(){n===t.length?i.complete():(i.next(t[n++]),i.closed||this.schedule())}))}))}var Mt=function(t){return t&&"number"===typeof t.length&&"function"!==typeof t};function Ct(t){return z(null===t||void 0===t?void 0:t.then)}var It="function"===typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function At(t,e,i,n){void 0===n&&(n=0);var r=e.schedule((function(){try{i.call(this)}catch(kx){t.error(kx)}}),n);return t.add(r),r}function kt(t,e){if(!t)throw new Error("Iterable cannot be null");return new nt((function(i){var n=new B;return n.add(e.schedule((function(){var r=t[Symbol.asyncIterator]();n.add(e.schedule((function(){var t=this;r.next().then((function(e){e.done?i.complete():(i.next(e.value),t.schedule())}))})))}))),n}))}function Rt(t){return z(t[tt])}function zt(t){return z(null===t||void 0===t?void 0:t[It])}function Pt(t){return Symbol.asyncIterator&&z(null===t||void 0===t?void 0:t[Symbol.asyncIterator])}function Dt(t){return new TypeError("You provided "+(null!==t&&"object"===typeof t?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Lt(t){return k(this,arguments,(function(){var e,i,n;return T(this,(function(r){switch(r.label){case 0:e=t.getReader(),r.label=1;case 1:r.trys.push([1,,9,10]),r.label=2;case 2:return[4,A(e.read())];case 3:return i=r.sent(),n=i.value,i.done?[4,A(void 0)]:[3,5];case 4:return[2,r.sent()];case 5:return[4,A(n)];case 6:return[4,r.sent()];case 7:return r.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}}))}))}function Bt(t){return z(null===t||void 0===t?void 0:t.getReader)}function Ot(t,e){if(null!=t){if(Rt(t))return function(t,e){return new nt((function(i){var n=new B;return n.add(e.schedule((function(){var r=t[tt]();n.add(r.subscribe({next:function(t){n.add(e.schedule((function(){return i.next(t)})))},error:function(t){n.add(e.schedule((function(){return i.error(t)})))},complete:function(){n.add(e.schedule((function(){return i.complete()})))}}))}))),n}))}(t,e);if(Mt(t))return Tt(t,e);if(Ct(t))return function(t,e){return new nt((function(i){return e.schedule((function(){return t.then((function(t){i.add(e.schedule((function(){i.next(t),i.add(e.schedule((function(){return i.complete()})))})))}),(function(t){i.add(e.schedule((function(){return i.error(t)})))}))}))}))}(t,e);if(Pt(t))return kt(t,e);if(zt(t))return function(t,e){return new nt((function(i){var n;return i.add(e.schedule((function(){n=t[It](),At(i,e,(function(){var t=n.next(),e=t.value;t.done?i.complete():(i.next(e),this.schedule())}))}))),function(){return z(null===n||void 0===n?void 0:n.return)&&n.return()}}))}(t,e);if(Bt(t))return function(t,e){return kt(Lt(t),e)}(t,e)}throw Dt(t)}function Ft(t,e){return e?Ot(t,e):Nt(t)}function Nt(t){if(t instanceof nt)return t;if(null!=t){if(Rt(t))return n=t,new nt((function(t){var e=n[tt]();if(z(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(Mt(t))return Ut(t);if(Ct(t))return i=t,new nt((function(t){i.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,V)}));if(Pt(t))return $t(t);if(zt(t))return e=t,new nt((function(t){var i,n;try{for(var r=M(e),a=r.next();!a.done;a=r.next()){var o=a.value;if(t.next(o),t.closed)return}}catch(s){i={error:s}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}t.complete()}));if(Bt(t))return $t(Lt(t))}var e,i,n;throw Dt(t)}function Ut(t){return new nt((function(e){for(var i=0;i<t.length&&!e.closed;i++)e.next(t[i]);e.complete()}))}function $t(t){return new nt((function(e){(function(t,e){var i,n,r,a;return E(this,void 0,void 0,(function(){var o,s;return T(this,(function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),i=R(t),l.label=1;case 1:return[4,i.next()];case 2:if((n=l.sent()).done)return[3,4];if(o=n.value,e.next(o),e.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=l.sent(),r={error:s},[3,11];case 6:return l.trys.push([6,,9,10]),n&&!n.done&&(a=i.return)?[4,a.call(i)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(r)throw r.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}}))}))})(t,e).catch((function(t){return e.error(t)}))}))}function Vt(t,e){return e?Tt(t,e):Ut(t)}function jt(t){return t&&z(t.schedule)}function qt(t){return t[t.length-1]}function Gt(t){return z(qt(t))?t.pop():void 0}function Ht(t){return jt(qt(t))?t.pop():void 0}function Wt(t,e){return"number"===typeof qt(t)?t.pop():e}function Zt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=Ht(t);return i?Tt(t,i):Vt(t)}function Yt(t,e){var i=z(t)?t:function(){return t},n=function(t){return t.error(i())};return new nt(e?function(t){return e.schedule(n,0,t)}:n)}var Xt=P((function(t){return function(){t(this),this.name="EmptyError",this.message="no elements in sequence"}}));function Kt(t){return t instanceof Date&&!isNaN(t)}var Jt=P((function(t){return function(e){void 0===e&&(e=null),t(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}}));function Qt(t,e){var i=Kt(t)?{first:t}:"number"===typeof t?{each:t}:t,n=i.first,r=i.each,a=i.with,o=void 0===a?te:a,s=i.scheduler,l=void 0===s?null!==e&&void 0!==e?e:bt:s,c=i.meta,u=void 0===c?null:c;if(null==n&&null==r)throw new TypeError("No timeout provided.");return ot((function(t,e){var i,a,s=null,c=0,h=function(t){a=At(e,l,(function(){i.unsubscribe(),Nt(o({meta:u,lastValue:s,seen:c})).subscribe(e)}),t)};i=t.subscribe(new st(e,(function(t){null===a||void 0===a||a.unsubscribe(),c++,e.next(s=t),r>0&&h(r)}),void 0,void 0,(function(){(null===a||void 0===a?void 0:a.closed)||null===a||void 0===a||a.unsubscribe(),s=null}))),h(null!=n?"number"===typeof n?n:+n-l.now():r)}))}function te(t){throw new Jt(t)}function ee(t,e){return ot((function(i,n){var r=0;i.subscribe(new st(n,(function(i){n.next(t.call(e,i,r++))})))}))}var ie=Array.isArray;function ne(t){return ee((function(e){return function(t,e){return ie(e)?t.apply(void 0,I([],C(e))):t(e)}(t,e)}))}var re=Array.isArray,ae=Object.getPrototypeOf,oe=Object.prototype,se=Object.keys;function le(t){if(1===t.length){var e=t[0];if(re(e))return{args:e,keys:null};if((n=e)&&"object"===typeof n&&ae(n)===oe){var i=se(e);return{args:i.map((function(t){return e[t]})),keys:i}}}var n;return{args:t,keys:null}}function ce(t,e){return t.reduce((function(t,i,n){return t[i]=e[n],t}),{})}function ue(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=Ht(t),n=Gt(t),r=le(t),a=r.args,o=r.keys;if(0===a.length)return Ft([],i);var s=new nt(he(a,i,o?function(t){return ce(o,t)}:et));return n?s.pipe(ne(n)):s}function he(t,e,i){return void 0===i&&(i=et),function(n){pe(e,(function(){for(var r=t.length,a=new Array(r),o=r,s=r,l=function(r){pe(e,(function(){var l=Ft(t[r],e),c=!1;l.subscribe(new st(n,(function(t){a[r]=t,c||(c=!0,s--),s||n.next(i(a.slice()))}),(function(){--o||n.complete()})))}),n)},c=0;c<r;c++)l(c)}),n)}}function pe(t,e,i){t?i.add(t.schedule(e)):e()}function de(t,e,i,n,r,a,o,s){var l=[],c=0,u=0,h=!1,p=function(){!h||l.length||c||e.complete()},d=function(t){return c<n?f(t):l.push(t)},f=function(t){a&&e.next(t),c++;var s=!1;Nt(i(t,u++)).subscribe(new st(e,(function(t){null===r||void 0===r||r(t),a?d(t):e.next(t)}),(function(){s=!0}),void 0,(function(){if(s)try{c--;for(var t=function(){var t=l.shift();o?e.add(o.schedule((function(){return f(t)}))):f(t)};l.length&&c<n;)t();p()}catch(kx){e.error(kx)}})))};return t.subscribe(new st(e,d,(function(){h=!0,p()}))),function(){null===s||void 0===s||s()}}function fe(t,e,i){return void 0===i&&(i=1/0),z(e)?fe((function(i,n){return ee((function(t,r){return e(i,t,n,r)}))(Nt(t(i,n)))}),i):("number"===typeof e&&(i=e),ot((function(e,n){return de(e,n,t,i)})))}function me(t){return void 0===t&&(t=1/0),fe(et,t)}function ge(){return me(1)}function _e(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return ge()(Vt(t,Ht(t)))}var ye=["addListener","removeListener"],ve=["addEventListener","removeEventListener"],xe=["on","off"];function be(t,e,i,n){if(z(i)&&(n=i,i=void 0),n)return be(t,e,i).pipe(ne(n));var r=C(function(t){return z(t.addEventListener)&&z(t.removeEventListener)}(t)?ve.map((function(n){return function(r){return t[n](e,r,i)}})):function(t){return z(t.addListener)&&z(t.removeListener)}(t)?ye.map(we(t,e)):function(t){return z(t.on)&&z(t.off)}(t)?xe.map(we(t,e)):[],2),a=r[0],o=r[1];if(!a&&Mt(t))return fe((function(t){return be(t,e,i)}))(Vt(t));if(!a)throw new TypeError("Invalid event target");return new nt((function(t){var e=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return t.next(1<e.length?e:e[0])};return a(e),function(){return o(e)}}))}function we(t,e){return function(i){return function(n){return t[i](e,n)}}}function Se(t,e,i){void 0===t&&(t=0),void 0===i&&(i=wt);var n=-1;return null!=e&&(jt(e)?i=e:n=e),new nt((function(e){var r=Kt(t)?+t-i.now():t;r<0&&(r=0);var a=0;return i.schedule((function(){e.closed||(e.next(a++),0<=n?this.schedule(void 0,n):e.complete())}),r)}))}function Ee(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=Ht(t),n=Wt(t,1/0),r=t;return r.length?1===r.length?Nt(r[0]):me(n)(Vt(r,i)):St}var Te=Array.isArray;function Me(t){return 1===t.length&&Te(t[0])?t[0]:t}function Ce(t,e){return ot((function(i,n){var r=0;i.subscribe(new st(n,(function(i){return t.call(e,i,r++)&&n.next(i)})))}))}function Ie(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=Gt(t),n=Me(t);return n.length?new nt((function(t){var e=n.map((function(){return[]})),r=n.map((function(){return!1}));t.add((function(){e=r=null}));for(var a=function(a){Nt(n[a]).subscribe(new st(t,(function(n){if(e[a].push(n),e.every((function(t){return t.length}))){var o=e.map((function(t){return t.shift()}));t.next(i?i.apply(void 0,I([],C(o))):o),e.some((function(t,e){return!t.length&&r[e]}))&&t.complete()}}),(function(){r[a]=!0,!e[a].length&&t.complete()})))},o=0;!t.closed&&o<n.length;o++)a(o);return function(){e=r=null}})):St}function Ae(t,e){return void 0===e&&(e=wt),i=function(){return Se(t,e)},ot((function(t,e){var n=!1,r=null,a=null,o=!1,s=function(){if(null===a||void 0===a||a.unsubscribe(),a=null,n){n=!1;var t=r;r=null,e.next(t)}o&&e.complete()},l=function(){a=null,o&&e.complete()};t.subscribe(new st(e,(function(t){n=!0,r=t,a||Nt(i(t)).subscribe(a=new st(e,s,l))}),(function(){o=!0,(!n||!a||a.closed)&&e.complete()})))}));var i}function ke(t,e){return void 0===e&&(e=null),e=null!==e&&void 0!==e?e:t,ot((function(i,n){var r=[],a=0;i.subscribe(new st(n,(function(i){var o,s,l,c,u=null;a++%e===0&&r.push([]);try{for(var h=M(r),p=h.next();!p.done;p=h.next()){(m=p.value).push(i),t<=m.length&&(u=null!==u&&void 0!==u?u:[]).push(m)}}catch(g){o={error:g}}finally{try{p&&!p.done&&(s=h.return)&&s.call(h)}finally{if(o)throw o.error}}if(u)try{for(var d=M(u),f=d.next();!f.done;f=d.next()){var m=f.value;L(r,m),n.next(m)}}catch(_){l={error:_}}finally{try{f&&!f.done&&(c=d.return)&&c.call(d)}finally{if(l)throw l.error}}}),(function(){var t,e;try{for(var i=M(r),a=i.next();!a.done;a=i.next()){var o=a.value;n.next(o)}}catch(s){t={error:s}}finally{try{a&&!a.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}n.complete()}),void 0,(function(){r=null})))}))}function Re(t){return ot((function(e,i){var n,r=null,a=!1;r=e.subscribe(new st(i,void 0,void 0,(function(o){n=Nt(t(o,Re(t)(e))),r?(r.unsubscribe(),r=null,n.subscribe(i)):a=!0}))),a&&(r.unsubscribe(),r=null,n.subscribe(i))}))}function ze(t,e,i,n,r){return function(a,o){var s=i,l=e,c=0;a.subscribe(new st(o,(function(e){var i=c++;l=s?t(l,e,i):(s=!0,e),n&&o.next(l)}),r&&function(){s&&o.next(l),o.complete()}))}}function Pe(t,e){return ot(ze(t,e,arguments.length>=2,!1,!0))}function De(t,e){return z(e)?fe(t,e,1):fe(t,1)}var Le={connector:function(){return new ht}};function Be(t,e){void 0===e&&(e=Le);var i=e.connector;return ot((function(e,n){var r,a=i();Ft(t((r=a,new nt((function(t){return r.subscribe(t)}))))).subscribe(n),n.add(e.subscribe(a))}))}function Oe(t,e){return void 0===e&&(e=bt),ot((function(i,n){var r=null,a=null,o=null,s=function(){if(r){r.unsubscribe(),r=null;var t=a;a=null,n.next(t)}};function l(){var i=o+t,a=e.now();if(a<i)return r=this.schedule(void 0,i-a),void n.add(r);s()}i.subscribe(new st(n,(function(i){a=i,o=e.now(),r||(r=e.schedule(l,t),n.add(r))}),(function(){s(),n.complete()}),void 0,(function(){a=r=null})))}))}function Fe(t){return ot((function(e,i){var n=!1;e.subscribe(new st(i,(function(t){n=!0,i.next(t)}),(function(){n||i.next(t),i.complete()})))}))}function Ne(t){return t<=0?function(){return St}:ot((function(e,i){var n=0;e.subscribe(new st(i,(function(e){++n<=t&&(i.next(e),t<=n&&i.complete())})))}))}function Ue(t,e){return void 0===e&&(e=et),t=null!==t&&void 0!==t?t:$e,ot((function(i,n){var r,a=!0;i.subscribe(new st(n,(function(i){var o=e(i);!a&&t(r,o)||(a=!1,r=o,n.next(i))})))}))}function $e(t,e){return t===e}function Ve(t){return void 0===t&&(t=je),ot((function(e,i){var n=!1;e.subscribe(new st(i,(function(t){n=!0,i.next(t)}),(function(){return n?i.complete():i.error(t())})))}))}function je(){return new Xt}function qe(t,e,i){return void 0===e&&(e=1/0),e=(e||0)<1?1/0:e,ot((function(n,r){return de(n,r,t,e,void 0,!0,i)}))}function Ge(t){return ot((function(e,i){try{e.subscribe(i)}finally{i.add(t)}}))}function He(t,e){var i=arguments.length>=2;return function(n){return n.pipe(t?Ce((function(e,i){return t(e,i,n)})):et,Ne(1),i?Fe(e):Ve((function(){return new Xt})))}}function We(t){return t<=0?function(){return St}:ot((function(e,i){var n=[];e.subscribe(new st(i,(function(e){n.push(e),t<n.length&&n.shift()}),(function(){var t,e;try{for(var r=M(n),a=r.next();!a.done;a=r.next()){var o=a.value;i.next(o)}}catch(s){t={error:s}}finally{try{a&&!a.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}i.complete()}),void 0,(function(){n=null})))}))}function Ze(t,e){var i=arguments.length>=2;return function(n){return n.pipe(t?Ce((function(e,i){return t(e,i,n)})):et,We(1),i?Fe(e):Ve((function(){return new Xt})))}}function Ye(t,e){var i=z(t)?t:function(){return t};return z(e)?Be(e,{connector:i}):function(t){return new ct(t,i)}}function Xe(){return ot((function(t,e){var i,n=!1;t.subscribe(new st(e,(function(t){var r=i;i=t,n&&e.next([r,t]),n=!0})))}))}function Ke(t){return t?function(e){return Be(t)(e)}:function(t){return Ye(new ht)(t)}}function Je(t,e,i,n){i&&!z(i)&&(n=i);var r=z(i)?i:void 0;return function(i){return Ye(new mt(t,e,n),r)(i)}}function Qe(t){var e;void 0===t&&(t=1/0);var i=(e=t&&"object"===typeof t?t:{count:t}).count,n=void 0===i?1/0:i,r=e.delay,a=e.resetOnSuccess,o=void 0!==a&&a;return n<=0?et:ot((function(t,e){var i,a=0,s=function(){var l=!1;i=t.subscribe(new st(e,(function(t){o&&(a=0),e.next(t)}),void 0,(function(t){if(a++<n){var o=function(){i?(i.unsubscribe(),i=null,s()):l=!0};if(null!=r){var c="number"===typeof r?Se(r):Nt(r(t,a)),u=new st(e,(function(){u.unsubscribe(),o()}),(function(){e.complete()}));c.subscribe(u)}else o()}else e.error(t)}))),l&&(i.unsubscribe(),i=null,s())};s()}))}function ti(t,e){return ot(ze(t,e,arguments.length>=2,!0))}function ei(t){void 0===t&&(t={});var e=t.connector,i=void 0===e?function(){return new ht}:e,n=t.resetOnError,r=void 0===n||n,a=t.resetOnComplete,o=void 0===a||a,s=t.resetOnRefCountZero,l=void 0===s||s;return function(t){var e=null,n=null,a=null,s=0,c=!1,u=!1,h=function(){null===n||void 0===n||n.unsubscribe(),n=null},p=function(){h(),e=a=null,c=u=!1},d=function(){var t=e;p(),null===t||void 0===t||t.unsubscribe()};return ot((function(t,f){s++,u||c||h();var m=a=null!==a&&void 0!==a?a:i();f.add((function(){0!==--s||u||c||(n=ii(d,l))})),m.subscribe(f),e||(e=new Y({next:function(t){return m.next(t)},error:function(t){u=!0,h(),n=ii(p,r,t),m.error(t)},complete:function(){c=!0,h(),n=ii(p,o),m.complete()}}),Ft(t).subscribe(e))}))(t)}}function ii(t,e){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];return!0===e?(t(),null):!1===e?null:e.apply(void 0,I([],C(i))).pipe(Ne(1)).subscribe((function(){return t()}))}function ni(t){return Ce((function(e,i){return t<=i}))}function ri(t){return ot((function(e,i){var n=!1,r=0;e.subscribe(new st(i,(function(e){return(n||(n=!t(e,r++)))&&i.next(e)})))}))}function ai(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=Ht(t);return ot((function(e,n){(i?_e(t,e,i):_e(t,e)).subscribe(n)}))}function oi(t,e){return ot((function(i,n){var r=null,a=0,o=!1,s=function(){return o&&!r&&n.complete()};i.subscribe(new st(n,(function(i){null===r||void 0===r||r.unsubscribe();var o=0,l=a++;Nt(t(i,l)).subscribe(r=new st(n,(function(t){return n.next(e?e(i,t,l,o++):t)}),(function(){r=null,s()})))}),(function(){o=!0,s()})))}))}function si(t){return ot((function(e,i){Nt(t).subscribe(new st(i,(function(){return i.complete()}),j)),!i.closed&&e.subscribe(i)}))}function li(t,e){return void 0===e&&(e=!1),ot((function(i,n){var r=0;i.subscribe(new st(n,(function(i){var a=t(i,r++);(a||e)&&n.next(i),!a&&n.complete()})))}))}function ci(t,e,i){var n=z(t)||e||i?{next:t,error:e,complete:i}:t;return n?ot((function(t,e){var i;null===(i=n.subscribe)||void 0===i||i.call(n);var r=!0;t.subscribe(new st(e,(function(t){var i;null===(i=n.next)||void 0===i||i.call(n,t),e.next(t)}),(function(){var t;r=!1,null===(t=n.complete)||void 0===t||t.call(n),e.complete()}),(function(t){var i;r=!1,null===(i=n.error)||void 0===i||i.call(n,t),e.error(t)}),(function(){var t,e;r&&(null===(t=n.unsubscribe)||void 0===t||t.call(n)),null===(e=n.finalize)||void 0===e||e.call(n)})))})):et}function ui(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=Gt(t);return ot((function(e,n){for(var r=t.length,a=new Array(r),o=t.map((function(){return!1})),s=!1,l=function(e){Nt(t[e]).subscribe(new st(n,(function(t){a[e]=t,s||o[e]||(o[e]=!0,(s=o.every(et))&&(o=null))}),j))},c=0;c<r;c++)l(c);e.subscribe(new st(n,(function(t){if(s){var e=I([t],C(a));n.next(i?i.apply(void 0,I([],C(e))):e)}})))}))}class hi{createFilter(t){return new Function("node","return "+this._compile(t)+";")}_compile(t){if(null==t||t.length<=1)return"true";const e=t[0];return"("+("=="===e?this._compileComparisonOp("===",t[1],t[2],!1):"!="===e?this._compileComparisonOp("!==",t[1],t[2],!1):">"===e||">="===e||"<"===e||"<="===e?this._compileComparisonOp(e,t[1],t[2],!0):"in"===e?this._compileInOp(t[1],t.slice(2)):"!in"===e?this._compileNegation(this._compileInOp(t[1],t.slice(2))):"all"===e?this._compileLogicalOp(t.slice(1),"&&"):"true")+")"}_compare(t,e){return t<e?-1:t>e?1:0}_compileComparisonOp(t,e,i,n){const r=this._compilePropertyReference(e),a=JSON.stringify(i);return(n?"typeof "+r+"===typeof "+a+"&&":"")+r+t+a}_compileInOp(t,e){const i=this._compare;return JSON.stringify(e.sort(i))+".indexOf("+this._compilePropertyReference(t)+")!==-1"}_compileLogicalOp(t,e){const i=this._compile.bind(this);return t.map(i).join(e)}_compileNegation(t){return"!("+t+")"}_compilePropertyReference(t){return"node["+JSON.stringify(t)+"]"}}const pi=100,di=301,fi=302,mi=306,gi=1e3,_i=1001,yi=1002,vi=1003,xi=1006,bi=1008,wi=1009,Si=1012,Ei=1014,Ti=1015,Mi=1016,Ci=1020,Ii=1022,Ai=1023,ki=1026,Ri=1027,zi=2300,Pi=2301,Di=2302,Li=2400,Bi=2401,Oi=2402,Fi=2500,Ni=3e3,Ui=3001,$i=3007,Vi=3002,ji=7680,qi=35044,Gi=35048,Hi="300 es";class Wi{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const i=this._listeners[t];if(void 0!==i){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const i=e.slice(0);for(let e=0,n=i.length;e<n;e++)i[e].call(this,t);t.target=null}}}let Zi=1234567;const Yi=Math.PI/180,Xi=180/Math.PI,Ki=[];for(let tz=0;tz<256;tz++)Ki[tz]=(tz<16?"0":"")+tz.toString(16);const Ji="undefined"!==typeof crypto&&"randomUUID"in crypto;function Qi(){if(Ji)return crypto.randomUUID().toUpperCase();const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(Ki[255&t]+Ki[t>>8&255]+Ki[t>>16&255]+Ki[t>>24&255]+"-"+Ki[255&e]+Ki[e>>8&255]+"-"+Ki[e>>16&15|64]+Ki[e>>24&255]+"-"+Ki[63&i|128]+Ki[i>>8&255]+"-"+Ki[i>>16&255]+Ki[i>>24&255]+Ki[255&n]+Ki[n>>8&255]+Ki[n>>16&255]+Ki[n>>24&255]).toUpperCase()}function tn(t,e,i){return Math.max(e,Math.min(i,t))}function en(t,e){return(t%e+e)%e}function nn(t,e,i){return(1-i)*t+i*e}function rn(t){return 0===(t&t-1)&&0!==t}function an(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}var on=Object.freeze({__proto__:null,DEG2RAD:Yi,RAD2DEG:Xi,generateUUID:Qi,clamp:tn,euclideanModulo:en,mapLinear:function(t,e,i,n,r){return n+(t-e)*(r-n)/(i-e)},inverseLerp:function(t,e,i){return t!==e?(i-t)/(e-t):0},lerp:nn,damp:function(t,e,i,n){return nn(t,e,1-Math.exp(-i*n))},pingpong:function(t,e=1){return e-Math.abs(en(t,2*e)-e)},smoothstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*(3-2*t)},smootherstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){return void 0!==t&&(Zi=t%2147483647),Zi=16807*Zi%2147483647,(Zi-1)/2147483646},degToRad:function(t){return t*Yi},radToDeg:function(t){return t*Xi},isPowerOfTwo:rn,ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:an,setQuaternionFromProperEuler:function(t,e,i,n,r){const a=Math.cos,o=Math.sin,s=a(i/2),l=o(i/2),c=a((e+n)/2),u=o((e+n)/2),h=a((e-n)/2),p=o((e-n)/2),d=a((n-e)/2),f=o((n-e)/2);switch(r){case"XYX":t.set(s*u,l*h,l*p,s*c);break;case"YZY":t.set(l*p,s*u,l*h,s*c);break;case"ZXZ":t.set(l*h,l*p,s*u,s*c);break;case"XZX":t.set(s*u,l*f,l*d,s*c);break;case"YXY":t.set(l*d,s*u,l*f,s*c);break;case"ZYZ":t.set(l*f,l*d,s*u,s*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}});class sn{constructor(t=0,e=0){this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6],this.y=n[1]*e+n[4]*i+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),n=Math.sin(e),r=this.x-t.x,a=this.y-t.y;return this.x=r*i-a*n+t.x,this.y=r*n+a*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}sn.prototype.isVector2=!0;class ln{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,n,r,a,o,s,l){const c=this.elements;return c[0]=t,c[1]=n,c[2]=o,c[3]=e,c[4]=r,c[5]=s,c[6]=i,c[7]=a,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,r=this.elements,a=i[0],o=i[3],s=i[6],l=i[1],c=i[4],u=i[7],h=i[2],p=i[5],d=i[8],f=n[0],m=n[3],g=n[6],_=n[1],y=n[4],v=n[7],x=n[2],b=n[5],w=n[8];return r[0]=a*f+o*_+s*x,r[3]=a*m+o*y+s*b,r[6]=a*g+o*v+s*w,r[1]=l*f+c*_+u*x,r[4]=l*m+c*y+u*b,r[7]=l*g+c*v+u*w,r[2]=h*f+p*_+d*x,r[5]=h*m+p*y+d*b,r[8]=h*g+p*v+d*w,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],a=t[4],o=t[5],s=t[6],l=t[7],c=t[8];return e*a*c-e*o*l-i*r*c+i*o*s+n*r*l-n*a*s}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],a=t[4],o=t[5],s=t[6],l=t[7],c=t[8],u=c*a-o*l,h=o*s-c*r,p=l*r-a*s,d=e*u+i*h+n*p;if(0===d)return this.set(0,0,0,0,0,0,0,0,0);const f=1/d;return t[0]=u*f,t[1]=(n*l-c*i)*f,t[2]=(o*i-n*a)*f,t[3]=h*f,t[4]=(c*e-n*s)*f,t[5]=(n*r-o*e)*f,t[6]=p*f,t[7]=(i*s-l*e)*f,t[8]=(a*e-i*r)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,n,r,a,o){const s=Math.cos(r),l=Math.sin(r);return this.set(i*s,i*l,-i*(s*a+l*o)+a+t,-n*l,n*s,-n*(-l*a+s*o)+o+e,0,0,1),this}scale(t,e){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=e,i[4]*=e,i[7]*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),n=this.elements,r=n[0],a=n[3],o=n[6],s=n[1],l=n[4],c=n[7];return n[0]=e*r+i*s,n[3]=e*a+i*l,n[6]=e*o+i*c,n[1]=-i*r+e*s,n[4]=-i*a+e*l,n[7]=-i*o+e*c,this}translate(t,e){const i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=e*i[2],i[4]+=e*i[5],i[7]+=e*i[8],this}equals(t){const e=this.elements,i=t.elements;for(let n=0;n<9;n++)if(e[n]!==i[n])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}function cn(t){if(0===t.length)return-1/0;let e=t[0];for(let i=1,n=t.length;i<n;++i)t[i]>e&&(e=t[i]);return e}function un(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function hn(t,e=0){let i=3735928559^e,n=1103547991^e;for(let r,a=0;a<t.length;a++)r=t.charCodeAt(a),i=Math.imul(i^r,2654435761),n=Math.imul(n^r,1597334677);return i=Math.imul(i^i>>>16,2246822507)^Math.imul(n^n>>>13,3266489909),n=Math.imul(n^n>>>16,2246822507)^Math.imul(i^i>>>13,3266489909),4294967296*(2097151&n)+(i>>>0)}let pn;ln.prototype.isMatrix3=!0;class dn{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===pn&&(pn=un("canvas")),pn.width=t.width,pn.height=t.height;const i=pn.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=pn}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}}let fn=0;class mn extends Wi{constructor(t=mn.DEFAULT_IMAGE,e=mn.DEFAULT_MAPPING,i=1001,n=1001,r=1006,a=1008,o=1023,s=1009,l=1,c=3e3){super(),Object.defineProperty(this,"id",{value:fn++}),this.uuid=Qi(),this.name="",this.image=t,this.mipmaps=[],this.mapping=e,this.wrapS=i,this.wrapT=n,this.magFilter=r,this.minFilter=a,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=s,this.offset=new sn(0,0),this.repeat=new sn(1,1),this.center=new sn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ln,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this}toJSON(t){const e=void 0===t||"string"===typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const n=this.image;if(void 0===n.uuid&&(n.uuid=Qi()),!e&&void 0===t.images[n.uuid]){let e;if(Array.isArray(n)){e=[];for(let t=0,i=n.length;t<i;t++)n[t].isDataTexture?e.push(gn(n[t].image)):e.push(gn(n[t]))}else e=gn(n);t.images[n.uuid]={uuid:n.uuid,url:e}}i.image=n.uuid}return"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case gi:t.x=t.x-Math.floor(t.x);break;case _i:t.x=t.x<0?0:1;break;case yi:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case gi:t.y=t.y-Math.floor(t.y);break;case _i:t.y=t.y<0?0:1;break;case yi:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&this.version++}}function gn(t){return"undefined"!==typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&t instanceof ImageBitmap?dn.getDataURL(t):t.data?{data:Array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}mn.DEFAULT_IMAGE=void 0,mn.DEFAULT_MAPPING=300,mn.prototype.isTexture=!0;class _n{constructor(t=0,e=0,i=0,n=1){this.x=t,this.y=e,this.z=i,this.w=n}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,r=this.w,a=t.elements;return this.x=a[0]*e+a[4]*i+a[8]*n+a[12]*r,this.y=a[1]*e+a[5]*i+a[9]*n+a[13]*r,this.z=a[2]*e+a[6]*i+a[10]*n+a[14]*r,this.w=a[3]*e+a[7]*i+a[11]*n+a[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,n,r;const a=.01,o=.1,s=t.elements,l=s[0],c=s[4],u=s[8],h=s[1],p=s[5],d=s[9],f=s[2],m=s[6],g=s[10];if(Math.abs(c-h)<a&&Math.abs(u-f)<a&&Math.abs(d-m)<a){if(Math.abs(c+h)<o&&Math.abs(u+f)<o&&Math.abs(d+m)<o&&Math.abs(l+p+g-3)<o)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,s=(p+1)/2,_=(g+1)/2,y=(c+h)/4,v=(u+f)/4,x=(d+m)/4;return t>s&&t>_?t<a?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(t),n=y/i,r=v/i):s>_?s<a?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(s),i=y/n,r=x/n):_<a?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(_),i=v/r,n=x/r),this.set(i,n,r,e),this}let _=Math.sqrt((m-d)*(m-d)+(u-f)*(u-f)+(h-c)*(h-c));return Math.abs(_)<.001&&(_=1),this.x=(m-d)/_,this.y=(u-f)/_,this.z=(h-c)/_,this.w=Math.acos((l+p+g-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}_n.prototype.isVector4=!0;class yn extends Wi{constructor(t,e,i={}){super(),this.width=t,this.height=e,this.depth=1,this.scissor=new _n(0,0,t,e),this.scissorTest=!1,this.viewport=new _n(0,0,t,e),this.texture=new mn(void 0,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:t,height:e,depth:1},this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:xi,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}setTexture(t){t.image={width:this.width,height:this.height,depth:this.depth},this.texture=t}setSize(t,e,i=1){this.width===t&&this.height===e&&this.depth===i||(this.width=t,this.height=e,this.depth=i,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}yn.prototype.isWebGLRenderTarget=!0;(class extends yn{constructor(t,e,i){super(t,e);const n=this.texture;this.texture=[];for(let r=0;r<i;r++)this.texture[r]=n.clone()}setSize(t,e,i=1){if(this.width!==t||this.height!==e||this.depth!==i){this.width=t,this.height=e,this.depth=i;for(let n=0,r=this.texture.length;n<r;n++)this.texture[n].image.width=t,this.texture[n].image.height=e,this.texture[n].image.depth=i;this.dispose()}return this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e),this}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this.texture.length=0;for(let e=0,i=t.texture.length;e<i;e++)this.texture[e]=t.texture[e].clone();return this}}).prototype.isWebGLMultipleRenderTargets=!0;class vn extends yn{constructor(t,e,i){super(t,e,i),this.samples=4}copy(t){return super.copy.call(this,t),this.samples=t.samples,this}}vn.prototype.isWebGLMultisampleRenderTarget=!0;class xn{constructor(t=0,e=0,i=0,n=1){this._x=t,this._y=e,this._z=i,this._w=n}static slerp(t,e,i,n){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(t,e,n)}static slerpFlat(t,e,i,n,r,a,o){let s=i[n+0],l=i[n+1],c=i[n+2],u=i[n+3];const h=r[a+0],p=r[a+1],d=r[a+2],f=r[a+3];if(0===o)return t[e+0]=s,t[e+1]=l,t[e+2]=c,void(t[e+3]=u);if(1===o)return t[e+0]=h,t[e+1]=p,t[e+2]=d,void(t[e+3]=f);if(u!==f||s!==h||l!==p||c!==d){let t=1-o;const e=s*h+l*p+c*d+u*f,i=e>=0?1:-1,n=1-e*e;if(n>Number.EPSILON){const r=Math.sqrt(n),a=Math.atan2(r,e*i);t=Math.sin(t*a)/r,o=Math.sin(o*a)/r}const r=o*i;if(s=s*t+h*r,l=l*t+p*r,c=c*t+d*r,u=u*t+f*r,t===1-o){const t=1/Math.sqrt(s*s+l*l+c*c+u*u);s*=t,l*=t,c*=t,u*=t}}t[e]=s,t[e+1]=l,t[e+2]=c,t[e+3]=u}static multiplyQuaternionsFlat(t,e,i,n,r,a){const o=i[n],s=i[n+1],l=i[n+2],c=i[n+3],u=r[a],h=r[a+1],p=r[a+2],d=r[a+3];return t[e]=o*d+c*u+s*p-l*h,t[e+1]=s*d+c*h+l*u-o*p,t[e+2]=l*d+c*p+o*h-s*u,t[e+3]=c*d-o*u-s*h-l*p,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=t._x,n=t._y,r=t._z,a=t._order,o=Math.cos,s=Math.sin,l=o(i/2),c=o(n/2),u=o(r/2),h=s(i/2),p=s(n/2),d=s(r/2);switch(a){case"XYZ":this._x=h*c*u+l*p*d,this._y=l*p*u-h*c*d,this._z=l*c*d+h*p*u,this._w=l*c*u-h*p*d;break;case"YXZ":this._x=h*c*u+l*p*d,this._y=l*p*u-h*c*d,this._z=l*c*d-h*p*u,this._w=l*c*u+h*p*d;break;case"ZXY":this._x=h*c*u-l*p*d,this._y=l*p*u+h*c*d,this._z=l*c*d+h*p*u,this._w=l*c*u-h*p*d;break;case"ZYX":this._x=h*c*u-l*p*d,this._y=l*p*u+h*c*d,this._z=l*c*d-h*p*u,this._w=l*c*u+h*p*d;break;case"YZX":this._x=h*c*u+l*p*d,this._y=l*p*u+h*c*d,this._z=l*c*d-h*p*u,this._w=l*c*u-h*p*d;break;case"XZY":this._x=h*c*u-l*p*d,this._y=l*p*u-h*c*d,this._z=l*c*d+h*p*u,this._w=l*c*u+h*p*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],n=e[4],r=e[8],a=e[1],o=e[5],s=e[9],l=e[2],c=e[6],u=e[10],h=i+o+u;if(h>0){const t=.5/Math.sqrt(h+1);this._w=.25/t,this._x=(c-s)*t,this._y=(r-l)*t,this._z=(a-n)*t}else if(i>o&&i>u){const t=2*Math.sqrt(1+i-o-u);this._w=(c-s)/t,this._x=.25*t,this._y=(n+a)/t,this._z=(r+l)/t}else if(o>u){const t=2*Math.sqrt(1+o-i-u);this._w=(r-l)/t,this._x=(n+a)/t,this._y=.25*t,this._z=(s+c)/t}else{const t=2*Math.sqrt(1+u-i-o);this._w=(a-n)/t,this._x=(r+l)/t,this._y=(s+c)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(tn(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const n=Math.min(1,e/i);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,n=t._y,r=t._z,a=t._w,o=e._x,s=e._y,l=e._z,c=e._w;return this._x=i*c+a*o+n*l-r*s,this._y=n*c+a*s+r*o-i*l,this._z=r*c+a*l+i*s-n*o,this._w=a*c-i*o-n*s-r*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const i=this._x,n=this._y,r=this._z,a=this._w;let o=a*t._w+i*t._x+n*t._y+r*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=a,this._x=i,this._y=n,this._z=r,this;const s=1-o*o;if(s<=Number.EPSILON){const t=1-e;return this._w=t*a+e*this._w,this._x=t*i+e*this._x,this._y=t*n+e*this._y,this._z=t*r+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(s),c=Math.atan2(l,o),u=Math.sin((1-e)*c)/l,h=Math.sin(e*c)/l;return this._w=a*u+this._w*h,this._x=i*u+this._x*h,this._y=n*u+this._y*h,this._z=r*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(t,e,i){this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),n=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(n),i*Math.sin(r),i*Math.cos(r),e*Math.sin(n))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}xn.prototype.isQuaternion=!0;class bn{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Sn.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Sn.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*n,this.y=r[1]*e+r[4]*i+r[7]*n,this.z=r[2]*e+r[5]*i+r[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,r=t.elements,a=1/(r[3]*e+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*n+r[12])*a,this.y=(r[1]*e+r[5]*i+r[9]*n+r[13])*a,this.z=(r[2]*e+r[6]*i+r[10]*n+r[14])*a,this}applyQuaternion(t){const e=this.x,i=this.y,n=this.z,r=t.x,a=t.y,o=t.z,s=t.w,l=s*e+a*n-o*i,c=s*i+o*e-r*n,u=s*n+r*i-a*e,h=-r*e-a*i-o*n;return this.x=l*s+h*-r+c*-o-u*-a,this.y=c*s+h*-a+u*-r-l*-o,this.z=u*s+h*-o+l*-a-c*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n,this.y=r[1]*e+r[5]*i+r[9]*n,this.z=r[2]*e+r[6]*i+r[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,n=t.y,r=t.z,a=e.x,o=e.y,s=e.z;return this.x=n*s-r*o,this.y=r*a-i*s,this.z=i*o-n*a,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return wn.copy(this).projectOnVector(t),this.sub(wn)}reflect(t){return this.sub(wn.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(tn(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const n=Math.sin(e)*t;return this.x=n*Math.sin(i),this.y=Math.cos(e)*t,this.z=n*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}bn.prototype.isVector3=!0;const wn=new bn,Sn=new xn;class En{constructor(t=new bn(1/0,1/0,1/0),e=new bn(-1/0,-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,i=1/0,n=1/0,r=-1/0,a=-1/0,o=-1/0;for(let s=0,l=t.length;s<l;s+=3){const l=t[s],c=t[s+1],u=t[s+2];l<e&&(e=l),c<i&&(i=c),u<n&&(n=u),l>r&&(r=l),c>a&&(a=c),u>o&&(o=u)}return this.min.set(e,i,n),this.max.set(r,a,o),this}setFromBufferAttribute(t){let e=1/0,i=1/0,n=1/0,r=-1/0,a=-1/0,o=-1/0;for(let s=0,l=t.count;s<l;s++){const l=t.getX(s),c=t.getY(s),u=t.getZ(s);l<e&&(e=l),c<i&&(i=c),u<n&&(n=u),l>r&&(r=l),c>a&&(a=c),u>o&&(o=u)}return this.min.set(e,i,n),this.max.set(r,a,o),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=Mn.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t){return this.makeEmpty(),this.expandByObject(t)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t){t.updateWorldMatrix(!1,!1);const e=t.geometry;void 0!==e&&(null===e.boundingBox&&e.computeBoundingBox(),Cn.copy(e.boundingBox),Cn.applyMatrix4(t.matrixWorld),this.union(Cn));const i=t.children;for(let n=0,r=i.length;n<r;n++)this.expandByObject(i[n]);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,Mn),Mn.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Dn),Ln.subVectors(this.max,Dn),In.subVectors(t.a,Dn),An.subVectors(t.b,Dn),kn.subVectors(t.c,Dn),Rn.subVectors(An,In),zn.subVectors(kn,An),Pn.subVectors(In,kn);let e=[0,-Rn.z,Rn.y,0,-zn.z,zn.y,0,-Pn.z,Pn.y,Rn.z,0,-Rn.x,zn.z,0,-zn.x,Pn.z,0,-Pn.x,-Rn.y,Rn.x,0,-zn.y,zn.x,0,-Pn.y,Pn.x,0];return!!Fn(e,In,An,kn,Ln)&&(e=[1,0,0,0,1,0,0,0,1],!!Fn(e,In,An,kn,Ln)&&(Bn.crossVectors(Rn,zn),e=[Bn.x,Bn.y,Bn.z],Fn(e,In,An,kn,Ln)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return Mn.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=.5*this.getSize(Mn).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(Tn[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Tn[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Tn[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Tn[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Tn[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Tn[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Tn[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Tn[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Tn)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}En.prototype.isBox3=!0;const Tn=[new bn,new bn,new bn,new bn,new bn,new bn,new bn,new bn],Mn=new bn,Cn=new En,In=new bn,An=new bn,kn=new bn,Rn=new bn,zn=new bn,Pn=new bn,Dn=new bn,Ln=new bn,Bn=new bn,On=new bn;function Fn(t,e,i,n,r){for(let a=0,o=t.length-3;a<=o;a+=3){On.fromArray(t,a);const o=r.x*Math.abs(On.x)+r.y*Math.abs(On.y)+r.z*Math.abs(On.z),s=e.dot(On),l=i.dot(On),c=n.dot(On);if(Math.max(-Math.max(s,l,c),Math.min(s,l,c))>o)return!1}return!0}const Nn=new En,Un=new bn,$n=new bn,Vn=new bn;class jn{constructor(t=new bn,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;void 0!==e?i.copy(e):Nn.setFromPoints(t).getCenter(i);let n=0;for(let r=0,a=t.length;r<a;r++)n=Math.max(n,i.distanceToSquared(t[r]));return this.radius=Math.sqrt(n),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){Vn.subVectors(t,this.center);const e=Vn.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),i=.5*(t-this.radius);this.center.add(Vn.multiplyScalar(i/t)),this.radius+=i}return this}union(t){return $n.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(Un.copy(t.center).add($n)),this.expandByPoint(Un.copy(t.center).sub($n)),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const qn=new bn,Gn=new bn,Hn=new bn,Wn=new bn,Zn=new bn,Yn=new bn,Xn=new bn;class Kn{constructor(t=new bn,e=new bn(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,qn)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=qn.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(qn.copy(this.direction).multiplyScalar(e).add(this.origin),qn.distanceToSquared(t))}distanceSqToSegment(t,e,i,n){Gn.copy(t).add(e).multiplyScalar(.5),Hn.copy(e).sub(t).normalize(),Wn.copy(this.origin).sub(Gn);const r=.5*t.distanceTo(e),a=-this.direction.dot(Hn),o=Wn.dot(this.direction),s=-Wn.dot(Hn),l=Wn.lengthSq(),c=Math.abs(1-a*a);let u,h,p,d;if(c>0)if(u=a*s-o,h=a*o-s,d=r*c,u>=0)if(h>=-d)if(h<=d){const t=1/c;u*=t,h*=t,p=u*(u+a*h+2*o)+h*(a*u+h+2*s)+l}else h=r,u=Math.max(0,-(a*h+o)),p=-u*u+h*(h+2*s)+l;else h=-r,u=Math.max(0,-(a*h+o)),p=-u*u+h*(h+2*s)+l;else h<=-d?(u=Math.max(0,-(-a*r+o)),h=u>0?-r:Math.min(Math.max(-r,-s),r),p=-u*u+h*(h+2*s)+l):h<=d?(u=0,h=Math.min(Math.max(-r,-s),r),p=h*(h+2*s)+l):(u=Math.max(0,-(a*r+o)),h=u>0?r:Math.min(Math.max(-r,-s),r),p=-u*u+h*(h+2*s)+l);else h=a>0?-r:r,u=Math.max(0,-(a*h+o)),p=-u*u+h*(h+2*s)+l;return i&&i.copy(this.direction).multiplyScalar(u).add(this.origin),n&&n.copy(Hn).multiplyScalar(h).add(Gn),p}intersectSphere(t,e){qn.subVectors(t.center,this.origin);const i=qn.dot(this.direction),n=qn.dot(qn)-i*i,r=t.radius*t.radius;if(n>r)return null;const a=Math.sqrt(r-n),o=i-a,s=i+a;return o<0&&s<0?null:o<0?this.at(s,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return null===i?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,n,r,a,o,s;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(i=(t.min.x-h.x)*l,n=(t.max.x-h.x)*l):(i=(t.max.x-h.x)*l,n=(t.min.x-h.x)*l),c>=0?(r=(t.min.y-h.y)*c,a=(t.max.y-h.y)*c):(r=(t.max.y-h.y)*c,a=(t.min.y-h.y)*c),i>a||r>n?null:((r>i||i!==i)&&(i=r),(a<n||n!==n)&&(n=a),u>=0?(o=(t.min.z-h.z)*u,s=(t.max.z-h.z)*u):(o=(t.max.z-h.z)*u,s=(t.min.z-h.z)*u),i>s||o>n?null:((o>i||i!==i)&&(i=o),(s<n||n!==n)&&(n=s),n<0?null:this.at(i>=0?i:n,e)))}intersectsBox(t){return null!==this.intersectBox(t,qn)}intersectTriangle(t,e,i,n,r){Zn.subVectors(e,t),Yn.subVectors(i,t),Xn.crossVectors(Zn,Yn);let a,o=this.direction.dot(Xn);if(o>0){if(n)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}Wn.subVectors(this.origin,t);const s=a*this.direction.dot(Yn.crossVectors(Wn,Yn));if(s<0)return null;const l=a*this.direction.dot(Zn.cross(Wn));if(l<0)return null;if(s+l>o)return null;const c=-a*Wn.dot(Xn);return c<0?null:this.at(c/o,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Jn{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,n,r,a,o,s,l,c,u,h,p,d,f,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=i,g[12]=n,g[1]=r,g[5]=a,g[9]=o,g[13]=s,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=p,g[7]=d,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Jn).fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,n=1/Qn.setFromMatrixColumn(t,0).length(),r=1/Qn.setFromMatrixColumn(t,1).length(),a=1/Qn.setFromMatrixColumn(t,2).length();return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=0,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=0,e[8]=i[8]*a,e[9]=i[9]*a,e[10]=i[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,i=t.x,n=t.y,r=t.z,a=Math.cos(i),o=Math.sin(i),s=Math.cos(n),l=Math.sin(n),c=Math.cos(r),u=Math.sin(r);if("XYZ"===t.order){const t=a*c,i=a*u,n=o*c,r=o*u;e[0]=s*c,e[4]=-s*u,e[8]=l,e[1]=i+n*l,e[5]=t-r*l,e[9]=-o*s,e[2]=r-t*l,e[6]=n+i*l,e[10]=a*s}else if("YXZ"===t.order){const t=s*c,i=s*u,n=l*c,r=l*u;e[0]=t+r*o,e[4]=n*o-i,e[8]=a*l,e[1]=a*u,e[5]=a*c,e[9]=-o,e[2]=i*o-n,e[6]=r+t*o,e[10]=a*s}else if("ZXY"===t.order){const t=s*c,i=s*u,n=l*c,r=l*u;e[0]=t-r*o,e[4]=-a*u,e[8]=n+i*o,e[1]=i+n*o,e[5]=a*c,e[9]=r-t*o,e[2]=-a*l,e[6]=o,e[10]=a*s}else if("ZYX"===t.order){const t=a*c,i=a*u,n=o*c,r=o*u;e[0]=s*c,e[4]=n*l-i,e[8]=t*l+r,e[1]=s*u,e[5]=r*l+t,e[9]=i*l-n,e[2]=-l,e[6]=o*s,e[10]=a*s}else if("YZX"===t.order){const t=a*s,i=a*l,n=o*s,r=o*l;e[0]=s*c,e[4]=r-t*u,e[8]=n*u+i,e[1]=u,e[5]=a*c,e[9]=-o*c,e[2]=-l*c,e[6]=i*u+n,e[10]=t-r*u}else if("XZY"===t.order){const t=a*s,i=a*l,n=o*s,r=o*l;e[0]=s*c,e[4]=-u,e[8]=l*c,e[1]=t*u+r,e[5]=a*c,e[9]=i*u-n,e[2]=n*u-i,e[6]=o*c,e[10]=r*u+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(er,t,ir)}lookAt(t,e,i){const n=this.elements;return ar.subVectors(t,e),0===ar.lengthSq()&&(ar.z=1),ar.normalize(),nr.crossVectors(i,ar),0===nr.lengthSq()&&(1===Math.abs(i.z)?ar.x+=1e-4:ar.z+=1e-4,ar.normalize(),nr.crossVectors(i,ar)),nr.normalize(),rr.crossVectors(ar,nr),n[0]=nr.x,n[4]=rr.x,n[8]=ar.x,n[1]=nr.y,n[5]=rr.y,n[9]=ar.y,n[2]=nr.z,n[6]=rr.z,n[10]=ar.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,r=this.elements,a=i[0],o=i[4],s=i[8],l=i[12],c=i[1],u=i[5],h=i[9],p=i[13],d=i[2],f=i[6],m=i[10],g=i[14],_=i[3],y=i[7],v=i[11],x=i[15],b=n[0],w=n[4],S=n[8],E=n[12],T=n[1],M=n[5],C=n[9],I=n[13],A=n[2],k=n[6],R=n[10],z=n[14],P=n[3],D=n[7],L=n[11],B=n[15];return r[0]=a*b+o*T+s*A+l*P,r[4]=a*w+o*M+s*k+l*D,r[8]=a*S+o*C+s*R+l*L,r[12]=a*E+o*I+s*z+l*B,r[1]=c*b+u*T+h*A+p*P,r[5]=c*w+u*M+h*k+p*D,r[9]=c*S+u*C+h*R+p*L,r[13]=c*E+u*I+h*z+p*B,r[2]=d*b+f*T+m*A+g*P,r[6]=d*w+f*M+m*k+g*D,r[10]=d*S+f*C+m*R+g*L,r[14]=d*E+f*I+m*z+g*B,r[3]=_*b+y*T+v*A+x*P,r[7]=_*w+y*M+v*k+x*D,r[11]=_*S+y*C+v*R+x*L,r[15]=_*E+y*I+v*z+x*B,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],n=t[8],r=t[12],a=t[1],o=t[5],s=t[9],l=t[13],c=t[2],u=t[6],h=t[10],p=t[14];return t[3]*(+r*s*u-n*l*u-r*o*h+i*l*h+n*o*p-i*s*p)+t[7]*(+e*s*p-e*l*h+r*a*h-n*a*p+n*l*c-r*s*c)+t[11]*(+e*l*u-e*o*p-r*a*u+i*a*p+r*o*c-i*l*c)+t[15]*(-n*o*c-e*s*u+e*o*h+n*a*u-i*a*h+i*s*c)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],a=t[4],o=t[5],s=t[6],l=t[7],c=t[8],u=t[9],h=t[10],p=t[11],d=t[12],f=t[13],m=t[14],g=t[15],_=u*m*l-f*h*l+f*s*p-o*m*p-u*s*g+o*h*g,y=d*h*l-c*m*l-d*s*p+a*m*p+c*s*g-a*h*g,v=c*f*l-d*u*l+d*o*p-a*f*p-c*o*g+a*u*g,x=d*u*s-c*f*s-d*o*h+a*f*h+c*o*m-a*u*m,b=e*_+i*y+n*v+r*x;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/b;return t[0]=_*w,t[1]=(f*h*r-u*m*r-f*n*p+i*m*p+u*n*g-i*h*g)*w,t[2]=(o*m*r-f*s*r+f*n*l-i*m*l-o*n*g+i*s*g)*w,t[3]=(u*s*r-o*h*r-u*n*l+i*h*l+o*n*p-i*s*p)*w,t[4]=y*w,t[5]=(c*m*r-d*h*r+d*n*p-e*m*p-c*n*g+e*h*g)*w,t[6]=(d*s*r-a*m*r-d*n*l+e*m*l+a*n*g-e*s*g)*w,t[7]=(a*h*r-c*s*r+c*n*l-e*h*l-a*n*p+e*s*p)*w,t[8]=v*w,t[9]=(d*u*r-c*f*r-d*i*p+e*f*p+c*i*g-e*u*g)*w,t[10]=(a*f*r-d*o*r+d*i*l-e*f*l-a*i*g+e*o*g)*w,t[11]=(c*o*r-a*u*r-c*i*l+e*u*l+a*i*p-e*o*p)*w,t[12]=x*w,t[13]=(c*f*n-d*u*n+d*i*h-e*f*h-c*i*m+e*u*m)*w,t[14]=(d*o*n-a*f*n-d*i*s+e*f*s+a*i*m-e*o*m)*w,t[15]=(a*u*n-c*o*n+c*i*s-e*u*s-a*i*h+e*o*h)*w,this}scale(t){const e=this.elements,i=t.x,n=t.y,r=t.z;return e[0]*=i,e[4]*=n,e[8]*=r,e[1]*=i,e[5]*=n,e[9]*=r,e[2]*=i,e[6]*=n,e[10]*=r,e[3]*=i,e[7]*=n,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),n=Math.sin(e),r=1-i,a=t.x,o=t.y,s=t.z,l=r*a,c=r*o;return this.set(l*a+i,l*o-n*s,l*s+n*o,0,l*o+n*s,c*o+i,c*s-n*a,0,l*s-n*o,c*s+n*a,r*s*s+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,n,r,a){return this.set(1,i,r,0,t,1,a,0,e,n,1,0,0,0,0,1),this}compose(t,e,i){const n=this.elements,r=e._x,a=e._y,o=e._z,s=e._w,l=r+r,c=a+a,u=o+o,h=r*l,p=r*c,d=r*u,f=a*c,m=a*u,g=o*u,_=s*l,y=s*c,v=s*u,x=i.x,b=i.y,w=i.z;return n[0]=(1-(f+g))*x,n[1]=(p+v)*x,n[2]=(d-y)*x,n[3]=0,n[4]=(p-v)*b,n[5]=(1-(h+g))*b,n[6]=(m+_)*b,n[7]=0,n[8]=(d+y)*w,n[9]=(m-_)*w,n[10]=(1-(h+f))*w,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,e,i){const n=this.elements;let r=Qn.set(n[0],n[1],n[2]).length();const a=Qn.set(n[4],n[5],n[6]).length(),o=Qn.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),t.x=n[12],t.y=n[13],t.z=n[14],tr.copy(this);const s=1/r,l=1/a,c=1/o;return tr.elements[0]*=s,tr.elements[1]*=s,tr.elements[2]*=s,tr.elements[4]*=l,tr.elements[5]*=l,tr.elements[6]*=l,tr.elements[8]*=c,tr.elements[9]*=c,tr.elements[10]*=c,e.setFromRotationMatrix(tr),i.x=r,i.y=a,i.z=o,this}makePerspective(t,e,i,n,r,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const o=this.elements,s=2*r/(e-t),l=2*r/(i-n),c=(e+t)/(e-t),u=(i+n)/(i-n),h=-(a+r)/(a-r),p=-2*a*r/(a-r);return o[0]=s,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=p,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,e,i,n,r,a){const o=this.elements,s=1/(e-t),l=1/(i-n),c=1/(a-r),u=(e+t)*s,h=(i+n)*l,p=(a+r)*c;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-p,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let n=0;n<16;n++)if(e[n]!==i[n])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}Jn.prototype.isMatrix4=!0;const Qn=new bn,tr=new Jn,er=new bn(0,0,0),ir=new bn(1,1,1),nr=new bn,rr=new bn,ar=new bn,or=new Jn,sr=new xn;class lr{constructor(t=0,e=0,i=0,n=lr.DefaultOrder){this._x=t,this._y=e,this._z=i,this._order=n}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,n=this._order){return this._x=t,this._y=e,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const n=t.elements,r=n[0],a=n[4],o=n[8],s=n[1],l=n[5],c=n[9],u=n[2],h=n[6],p=n[10];switch(e){case"XYZ":this._y=Math.asin(tn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,p),this._z=Math.atan2(-a,r)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-tn(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,p),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(tn(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,p),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(s,r));break;case"ZYX":this._y=Math.asin(-tn(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,p),this._z=Math.atan2(s,r)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(tn(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(o,p));break;case"XZY":this._z=Math.asin(-tn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-c,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===i&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return or.makeRotationFromQuaternion(t),this.setFromRotationMatrix(or,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return sr.setFromEuler(this),this.setFromQuaternion(sr,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}toVector3(t){return t?t.set(this._x,this._y,this._z):new bn(this._x,this._y,this._z)}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}lr.prototype.isEuler=!0,lr.DefaultOrder="XYZ",lr.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class cr{constructor(){this.mask=1}set(t){this.mask=1<<t|0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!==(this.mask&t.mask)}}let ur=0;const hr=new bn,pr=new xn,dr=new Jn,fr=new bn,mr=new bn,gr=new bn,_r=new xn,yr=new bn(1,0,0),vr=new bn(0,1,0),xr=new bn(0,0,1),br={type:"added"},wr={type:"removed"};class Sr extends Wi{constructor(){super(),Object.defineProperty(this,"id",{value:ur++}),this.uuid=Qi(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Sr.DefaultUp.clone();const t=new bn,e=new lr,i=new xn,n=new bn(1,1,1);e._onChange((function(){i.setFromEuler(e,!1)})),i._onChange((function(){e.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Jn},normalMatrix:{value:new ln}}),this.matrix=new Jn,this.matrixWorld=new Jn,this.matrixAutoUpdate=Sr.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new cr,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return pr.setFromAxisAngle(t,e),this.quaternion.multiply(pr),this}rotateOnWorldAxis(t,e){return pr.setFromAxisAngle(t,e),this.quaternion.premultiply(pr),this}rotateX(t){return this.rotateOnAxis(yr,t)}rotateY(t){return this.rotateOnAxis(vr,t)}rotateZ(t){return this.rotateOnAxis(xr,t)}translateOnAxis(t,e){return hr.copy(t).applyQuaternion(this.quaternion),this.position.add(hr.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(yr,t)}translateY(t){return this.translateOnAxis(vr,t)}translateZ(t){return this.translateOnAxis(xr,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(dr.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?fr.copy(t):fr.set(t,e,i);const n=this.parent;this.updateWorldMatrix(!0,!1),mr.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?dr.lookAt(mr,fr,this.up):dr.lookAt(fr,mr,this.up),this.quaternion.setFromRotationMatrix(dr),n&&(dr.extractRotation(n.matrixWorld),pr.setFromRotationMatrix(dr),this.quaternion.premultiply(pr.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(br)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(wr)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(wr)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),dr.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),dr.multiply(t.parent.matrixWorld)),t.applyMatrix4(dr),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,n=this.children.length;i<n;i++){const n=this.children[i].getObjectByProperty(t,e);if(void 0!==n)return n}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(mr,t,gr),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(mr,_r,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].updateMatrixWorld(t)}updateWorldMatrix(t,e){const i=this.parent;if(!0===t&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,i=t.length;e<i;e++)t[e].updateWorldMatrix(!1,!0)}}toJSON(t){const e=void 0===t||"string"===typeof t,i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const n={};function r(e,i){return void 0===e[i.uuid]&&(e[i.uuid]=i.toJSON(t)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&(n.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=r(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const i=e.shapes;if(Array.isArray(i))for(let e=0,n=i.length;e<n;e++){const n=i[e];r(t.shapes,n)}else r(t.shapes,i)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(t.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let i=0,n=this.material.length;i<n;i++)e.push(r(t.materials,this.material[i]));n.material=e}else n.material=r(t.materials,this.material);if(this.children.length>0){n.children=[];for(let e=0;e<this.children.length;e++)n.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){n.animations=[];for(let e=0;e<this.animations.length;e++){const i=this.animations[e];n.animations.push(r(t.animations,i))}}if(e){const e=a(t.geometries),n=a(t.materials),r=a(t.textures),o=a(t.images),s=a(t.shapes),l=a(t.skeletons),c=a(t.animations);e.length>0&&(i.geometries=e),n.length>0&&(i.materials=n),r.length>0&&(i.textures=r),o.length>0&&(i.images=o),s.length>0&&(i.shapes=s),l.length>0&&(i.skeletons=l),c.length>0&&(i.animations=c)}return i.object=n,i;function a(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let i=0;i<t.children.length;i++){const e=t.children[i];this.add(e.clone())}return this}}Sr.DefaultUp=new bn(0,1,0),Sr.DefaultMatrixAutoUpdate=!0,Sr.prototype.isObject3D=!0;const Er=new bn,Tr=new bn,Mr=new bn,Cr=new bn,Ir=new bn,Ar=new bn,kr=new bn,Rr=new bn,zr=new bn,Pr=new bn;class Dr{constructor(t=new bn,e=new bn,i=new bn){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,n){n.subVectors(i,e),Er.subVectors(t,e),n.cross(Er);const r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(t,e,i,n,r){Er.subVectors(n,e),Tr.subVectors(i,e),Mr.subVectors(t,e);const a=Er.dot(Er),o=Er.dot(Tr),s=Er.dot(Mr),l=Tr.dot(Tr),c=Tr.dot(Mr),u=a*l-o*o;if(0===u)return r.set(-2,-1,-1);const h=1/u,p=(l*s-o*c)*h,d=(a*c-o*s)*h;return r.set(1-p-d,d,p)}static containsPoint(t,e,i,n){return this.getBarycoord(t,e,i,n,Cr),Cr.x>=0&&Cr.y>=0&&Cr.x+Cr.y<=1}static getUV(t,e,i,n,r,a,o,s){return this.getBarycoord(t,e,i,n,Cr),s.set(0,0),s.addScaledVector(r,Cr.x),s.addScaledVector(a,Cr.y),s.addScaledVector(o,Cr.z),s}static isFrontFacing(t,e,i,n){return Er.subVectors(i,e),Tr.subVectors(t,e),Er.cross(Tr).dot(n)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,n){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[n]),this}setFromAttributeAndIndices(t,e,i,n){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Er.subVectors(this.c,this.b),Tr.subVectors(this.a,this.b),.5*Er.cross(Tr).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Dr.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Dr.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,i,n,r){return Dr.getUV(t,this.a,this.b,this.c,e,i,n,r)}containsPoint(t){return Dr.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Dr.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const i=this.a,n=this.b,r=this.c;let a,o;Ir.subVectors(n,i),Ar.subVectors(r,i),Rr.subVectors(t,i);const s=Ir.dot(Rr),l=Ar.dot(Rr);if(s<=0&&l<=0)return e.copy(i);zr.subVectors(t,n);const c=Ir.dot(zr),u=Ar.dot(zr);if(c>=0&&u<=c)return e.copy(n);const h=s*u-c*l;if(h<=0&&s>=0&&c<=0)return a=s/(s-c),e.copy(i).addScaledVector(Ir,a);Pr.subVectors(t,r);const p=Ir.dot(Pr),d=Ar.dot(Pr);if(d>=0&&p<=d)return e.copy(r);const f=p*l-s*d;if(f<=0&&l>=0&&d<=0)return o=l/(l-d),e.copy(i).addScaledVector(Ar,o);const m=c*d-p*u;if(m<=0&&u-c>=0&&p-d>=0)return kr.subVectors(r,n),o=(u-c)/(u-c+(p-d)),e.copy(n).addScaledVector(kr,o);const g=1/(m+f+h);return a=f*g,o=h*g,e.copy(i).addScaledVector(Ir,a).addScaledVector(Ar,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let Lr=0;class Br extends Wi{constructor(){super(),Object.defineProperty(this,"id",{value:Lr++}),this.uuid=Qi(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.format=Ai,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=pi,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ji,this.stencilZFail=ji,this.stencilZPass=ji,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!==t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const i=t[e];if(void 0===i){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if("shading"===e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===i;continue}const n=this[e];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[e]=i:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}}toJSON(t){const e=void 0===t||"string"===typeof t;e&&(t={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(i.blending=this.blending),0!==this.side&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.format!==Ai&&(i.format=this.format),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),e){const e=n(t.textures),r=n(t.images);e.length>0&&(i.textures=e),r.length>0&&(i.images=r)}return i}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.format=t.format,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(null!==e){const t=e.length;i=new Array(t);for(let n=0;n!==t;++n)i[n]=e[n].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}Br.prototype.isMaterial=!0;const Or={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Fr={h:0,s:0,l:0},Nr={h:0,s:0,l:0};function Ur(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}function $r(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Vr(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}class jr{constructor(t,e,i){return void 0===e&&void 0===i?this.set(t):this.setRGB(t,e,i)}set(t){return t&&t.isColor?this.copy(t):"number"===typeof t?this.setHex(t):"string"===typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}setRGB(t,e,i){return this.r=t,this.g=e,this.b=i,this}setHSL(t,e,i){if(t=en(t,1),e=tn(e,0,1),i=tn(i,0,1),0===e)this.r=this.g=this.b=i;else{const n=i<=.5?i*(1+e):i+e-i*e,r=2*i-n;this.r=Ur(r,n,t+1/3),this.g=Ur(r,n,t),this.b=Ur(r,n,t-1/3)}return this}setStyle(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let t;const n=i[1],r=i[2];switch(n){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,e(t[4]),this;if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,e(t[4]),this;break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r)){const i=parseFloat(t[1])/360,n=parseInt(t[2],10)/100,r=parseInt(t[3],10)/100;return e(t[4]),this.setHSL(i,n,r)}}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const t=i[1],e=t.length;if(3===e)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,this;if(6===e)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this}setColorName(t){const e=Or[t.toLowerCase()];return void 0!==e?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copyGammaToLinear(t,e=2){return this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this}copyLinearToGamma(t,e=2){const i=e>0?1/e:1;return this.r=Math.pow(t.r,i),this.g=Math.pow(t.g,i),this.b=Math.pow(t.b,i),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.r=$r(t.r),this.g=$r(t.g),this.b=$r(t.b),this}copyLinearToSRGB(t){return this.r=Vr(t.r),this.g=Vr(t.g),this.b=Vr(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(t){const e=this.r,i=this.g,n=this.b,r=Math.max(e,i,n),a=Math.min(e,i,n);let o,s;const l=(a+r)/2;if(a===r)o=0,s=0;else{const t=r-a;switch(s=l<=.5?t/(r+a):t/(2-r-a),r){case e:o=(i-n)/t+(i<n?6:0);break;case i:o=(n-e)/t+2;break;case n:o=(e-i)/t+4}o/=6}return t.h=o,t.s=s,t.l=l,t}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(t,e,i){return this.getHSL(Fr),Fr.h+=t,Fr.s+=e,Fr.l+=i,this.setHSL(Fr.h,Fr.s,Fr.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(Fr),t.getHSL(Nr);const i=nn(Fr.h,Nr.h,e),n=nn(Fr.s,Nr.s,e),r=nn(Fr.l,Nr.l,e);return this.setHSL(i,n,r),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}jr.NAMES=Or,jr.prototype.isColor=!0,jr.prototype.r=1,jr.prototype.g=1,jr.prototype.b=1;class qr extends Br{constructor(t){super(),this.type="MeshBasicMaterial",this.color=new jr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}qr.prototype.isMeshBasicMaterial=!0;const Gr=new bn,Hr=new sn;class Wr{constructor(t,e,i){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===i,this.usage=qi,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let n=0,r=this.itemSize;n<r;n++)this.array[t+n]=e.array[i+n];return this}copyArray(t){return this.array.set(t),this}copyColorsArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),r=new jr),e[i++]=r.r,e[i++]=r.g,e[i++]=r.b}return this}copyVector2sArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),r=new sn),e[i++]=r.x,e[i++]=r.y}return this}copyVector3sArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),r=new bn),e[i++]=r.x,e[i++]=r.y,e[i++]=r.z}return this}copyVector4sArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),r=new _n),e[i++]=r.x,e[i++]=r.y,e[i++]=r.z,e[i++]=r.w}return this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,i=this.count;e<i;e++)Hr.fromBufferAttribute(this,e),Hr.applyMatrix3(t),this.setXY(e,Hr.x,Hr.y);else if(3===this.itemSize)for(let e=0,i=this.count;e<i;e++)Gr.fromBufferAttribute(this,e),Gr.applyMatrix3(t),this.setXYZ(e,Gr.x,Gr.y,Gr.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)Gr.x=this.getX(e),Gr.y=this.getY(e),Gr.z=this.getZ(e),Gr.applyMatrix4(t),this.setXYZ(e,Gr.x,Gr.y,Gr.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)Gr.x=this.getX(e),Gr.y=this.getY(e),Gr.z=this.getZ(e),Gr.applyNormalMatrix(t),this.setXYZ(e,Gr.x,Gr.y,Gr.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)Gr.x=this.getX(e),Gr.y=this.getY(e),Gr.z=this.getZ(e),Gr.transformDirection(t),this.setXYZ(e,Gr.x,Gr.y,Gr.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){return this.array[t*this.itemSize]}setX(t,e){return this.array[t*this.itemSize]=e,this}getY(t){return this.array[t*this.itemSize+1]}setY(t,e){return this.array[t*this.itemSize+1]=e,this}getZ(t){return this.array[t*this.itemSize+2]}setZ(t,e){return this.array[t*this.itemSize+2]=e,this}getW(t){return this.array[t*this.itemSize+3]}setW(t,e){return this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this}setXYZW(t,e,i,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==qi&&(t.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(t.updateRange=this.updateRange),t}}Wr.prototype.isBufferAttribute=!0;class Zr extends Wr{constructor(t,e,i){super(new Uint16Array(t),e,i)}}class Yr extends Wr{constructor(t,e,i){super(new Uint32Array(t),e,i)}}(class extends Wr{constructor(t,e,i){super(new Uint16Array(t),e,i)}}).prototype.isFloat16BufferAttribute=!0;class Xr extends Wr{constructor(t,e,i){super(new Float32Array(t),e,i)}}let Kr=0;const Jr=new Jn,Qr=new Sr,ta=new bn,ea=new En,ia=new En,na=new bn;class ra extends Wi{constructor(){super(),Object.defineProperty(this,"id",{value:Kr++}),this.uuid=Qi(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(cn(t)>65535?Yr:Zr)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const e=(new ln).getNormalMatrix(t);i.applyNormalMatrix(e),i.needsUpdate=!0}const n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(t),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return Jr.makeRotationFromQuaternion(t),this.applyMatrix4(Jr),this}rotateX(t){return Jr.makeRotationX(t),this.applyMatrix4(Jr),this}rotateY(t){return Jr.makeRotationY(t),this.applyMatrix4(Jr),this}rotateZ(t){return Jr.makeRotationZ(t),this.applyMatrix4(Jr),this}translate(t,e,i){return Jr.makeTranslation(t,e,i),this.applyMatrix4(Jr),this}scale(t,e,i){return Jr.makeScale(t,e,i),this.applyMatrix4(Jr),this}lookAt(t){return Qr.lookAt(t),Qr.updateMatrix(),this.applyMatrix4(Qr.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(ta).negate(),this.translate(ta.x,ta.y,ta.z),this}setFromPoints(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i];e.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new Xr(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new En);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new bn(-1/0,-1/0,-1/0),new bn(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let i=0,n=e.length;i<n;i++){const t=e[i];ea.setFromBufferAttribute(t),this.morphTargetsRelative?(na.addVectors(this.boundingBox.min,ea.min),this.boundingBox.expandByPoint(na),na.addVectors(this.boundingBox.max,ea.max),this.boundingBox.expandByPoint(na)):(this.boundingBox.expandByPoint(ea.min),this.boundingBox.expandByPoint(ea.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new jn);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new bn,1/0);if(t){const i=this.boundingSphere.center;if(ea.setFromBufferAttribute(t),e)for(let t=0,r=e.length;t<r;t++){const i=e[t];ia.setFromBufferAttribute(i),this.morphTargetsRelative?(na.addVectors(ea.min,ia.min),ea.expandByPoint(na),na.addVectors(ea.max,ia.max),ea.expandByPoint(na)):(ea.expandByPoint(ia.min),ea.expandByPoint(ia.max))}ea.getCenter(i);let n=0;for(let e=0,r=t.count;e<r;e++)na.fromBufferAttribute(t,e),n=Math.max(n,i.distanceToSquared(na));if(e)for(let r=0,a=e.length;r<a;r++){const a=e[r],o=this.morphTargetsRelative;for(let e=0,r=a.count;e<r;e++)na.fromBufferAttribute(a,e),o&&(ta.fromBufferAttribute(t,e),na.add(ta)),n=Math.max(n,i.distanceToSquared(na))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=t.array,n=e.position.array,r=e.normal.array,a=e.uv.array,o=n.length/3;void 0===e.tangent&&this.setAttribute("tangent",new Wr(new Float32Array(4*o),4));const s=e.tangent.array,l=[],c=[];for(let T=0;T<o;T++)l[T]=new bn,c[T]=new bn;const u=new bn,h=new bn,p=new bn,d=new sn,f=new sn,m=new sn,g=new bn,_=new bn;function y(t,e,i){u.fromArray(n,3*t),h.fromArray(n,3*e),p.fromArray(n,3*i),d.fromArray(a,2*t),f.fromArray(a,2*e),m.fromArray(a,2*i),h.sub(u),p.sub(u),f.sub(d),m.sub(d);const r=1/(f.x*m.y-m.x*f.y);isFinite(r)&&(g.copy(h).multiplyScalar(m.y).addScaledVector(p,-f.y).multiplyScalar(r),_.copy(p).multiplyScalar(f.x).addScaledVector(h,-m.x).multiplyScalar(r),l[t].add(g),l[e].add(g),l[i].add(g),c[t].add(_),c[e].add(_),c[i].add(_))}let v=this.groups;0===v.length&&(v=[{start:0,count:i.length}]);for(let T=0,M=v.length;T<M;++T){const t=v[T],e=t.start;for(let n=e,r=e+t.count;n<r;n+=3)y(i[n+0],i[n+1],i[n+2])}const x=new bn,b=new bn,w=new bn,S=new bn;function E(t){w.fromArray(r,3*t),S.copy(w);const e=l[t];x.copy(e),x.sub(w.multiplyScalar(w.dot(e))).normalize(),b.crossVectors(S,e);const i=b.dot(c[t])<0?-1:1;s[4*t]=x.x,s[4*t+1]=x.y,s[4*t+2]=x.z,s[4*t+3]=i}for(let T=0,M=v.length;T<M;++T){const t=v[T],e=t.start;for(let n=e,r=e+t.count;n<r;n+=3)E(i[n+0]),E(i[n+1]),E(i[n+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let i=this.getAttribute("normal");if(void 0===i)i=new Wr(new Float32Array(3*e.count),3),this.setAttribute("normal",i);else for(let t=0,e=i.count;t<e;t++)i.setXYZ(t,0,0,0);const n=new bn,r=new bn,a=new bn,o=new bn,s=new bn,l=new bn,c=new bn,u=new bn;if(t)for(let h=0,p=t.count;h<p;h+=3){const p=t.getX(h+0),d=t.getX(h+1),f=t.getX(h+2);n.fromBufferAttribute(e,p),r.fromBufferAttribute(e,d),a.fromBufferAttribute(e,f),c.subVectors(a,r),u.subVectors(n,r),c.cross(u),o.fromBufferAttribute(i,p),s.fromBufferAttribute(i,d),l.fromBufferAttribute(i,f),o.add(c),s.add(c),l.add(c),i.setXYZ(p,o.x,o.y,o.z),i.setXYZ(d,s.x,s.y,s.z),i.setXYZ(f,l.x,l.y,l.z)}else for(let t=0,h=e.count;t<h;t+=3)n.fromBufferAttribute(e,t+0),r.fromBufferAttribute(e,t+1),a.fromBufferAttribute(e,t+2),c.subVectors(a,r),u.subVectors(n,r),c.cross(u),i.setXYZ(t+0,c.x,c.y,c.z),i.setXYZ(t+1,c.x,c.y,c.z),i.setXYZ(t+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(t,e){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const i=this.attributes;for(const n in i){if(void 0===t.attributes[n])continue;const r=i[n].array,a=t.attributes[n],o=a.array,s=a.itemSize*e,l=Math.min(o.length,r.length-s);for(let t=0,e=s;t<l;t++,e++)r[e]=o[t]}return this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)na.fromBufferAttribute(t,e),na.normalize(),t.setXYZ(e,na.x,na.y,na.z)}toNonIndexed(){function t(t,e){const i=t.array,n=t.itemSize,r=t.normalized,a=new i.constructor(e.length*n);let o=0,s=0;for(let l=0,c=e.length;l<c;l++){o=t.isInterleavedBufferAttribute?e[l]*t.data.stride+t.offset:e[l]*n;for(let t=0;t<n;t++)a[s++]=i[o++]}return new Wr(a,n,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new ra,i=this.index.array,n=this.attributes;for(const o in n){const r=t(n[o],i);e.setAttribute(o,r)}const r=this.morphAttributes;for(const o in r){const n=[],a=r[o];for(let e=0,r=a.length;e<r;e++){const r=t(a[e],i);n.push(r)}e.morphAttributes[o]=n}e.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,s=a.length;o<s;o++){const t=a[o];e.addGroup(t.start,t.count,t.materialIndex)}return e}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const i in e)void 0!==e[i]&&(t[i]=e[i]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const s in i){const e=i[s];t.data.attributes[s]=e.toJSON(t.data)}const n={};let r=!1;for(const s in this.morphAttributes){const e=this.morphAttributes[s],i=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];i.push(r.toJSON(t.data))}i.length>0&&(n[s]=i,r=!0)}r&&(t.data.morphAttributes=n,t.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;null!==i&&this.setIndex(i.clone(e));const n=t.attributes;for(const l in n){const t=n[l];this.setAttribute(l,t.clone(e))}const r=t.morphAttributes;for(const l in r){const t=[],i=r[l];for(let n=0,r=i.length;n<r;n++)t.push(i[n].clone(e));this.morphAttributes[l]=t}this.morphTargetsRelative=t.morphTargetsRelative;const a=t.groups;for(let l=0,c=a.length;l<c;l++){const t=a[l];this.addGroup(t.start,t.count,t.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const s=t.boundingSphere;return null!==s&&(this.boundingSphere=s.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,void 0!==t.parameters&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}ra.prototype.isBufferGeometry=!0;const aa=new Jn,oa=new Kn,sa=new jn,la=new bn,ca=new bn,ua=new bn,ha=new bn,pa=new bn,da=new bn,fa=new bn,ma=new bn,ga=new bn,_a=new sn,ya=new sn,va=new sn,xa=new bn,ba=new bn;class wa extends Sr{constructor(t=new ra,e=new qr){super(),this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(t,e){const i=this.geometry,n=this.material,r=this.matrixWorld;if(void 0===n)return;if(null===i.boundingSphere&&i.computeBoundingSphere(),sa.copy(i.boundingSphere),sa.applyMatrix4(r),!1===t.ray.intersectsSphere(sa))return;if(aa.copy(r).invert(),oa.copy(t.ray).applyMatrix4(aa),null!==i.boundingBox&&!1===oa.intersectsBox(i.boundingBox))return;let a;if(i.isBufferGeometry){const r=i.index,o=i.attributes.position,s=i.morphAttributes.position,l=i.morphTargetsRelative,c=i.attributes.uv,u=i.attributes.uv2,h=i.groups,p=i.drawRange;if(null!==r)if(Array.isArray(n))for(let i=0,d=h.length;i<d;i++){const d=h[i],f=n[d.materialIndex];for(let i=Math.max(d.start,p.start),n=Math.min(r.count,Math.min(d.start+d.count,p.start+p.count));i<n;i+=3){const n=r.getX(i),h=r.getX(i+1),p=r.getX(i+2);a=Sa(this,f,t,oa,o,s,l,c,u,n,h,p),a&&(a.faceIndex=Math.floor(i/3),a.face.materialIndex=d.materialIndex,e.push(a))}}else{for(let i=Math.max(0,p.start),h=Math.min(r.count,p.start+p.count);i<h;i+=3){const h=r.getX(i),p=r.getX(i+1),d=r.getX(i+2);a=Sa(this,n,t,oa,o,s,l,c,u,h,p,d),a&&(a.faceIndex=Math.floor(i/3),e.push(a))}}else if(void 0!==o)if(Array.isArray(n))for(let i=0,d=h.length;i<d;i++){const r=h[i],d=n[r.materialIndex];for(let i=Math.max(r.start,p.start),n=Math.min(o.count,Math.min(r.start+r.count,p.start+p.count));i<n;i+=3){a=Sa(this,d,t,oa,o,s,l,c,u,i,i+1,i+2),a&&(a.faceIndex=Math.floor(i/3),a.face.materialIndex=r.materialIndex,e.push(a))}}else{for(let i=Math.max(0,p.start),r=Math.min(o.count,p.start+p.count);i<r;i+=3){a=Sa(this,n,t,oa,o,s,l,c,u,i,i+1,i+2),a&&(a.faceIndex=Math.floor(i/3),e.push(a))}}}else i.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function Sa(t,e,i,n,r,a,o,s,l,c,u,h){la.fromBufferAttribute(r,c),ca.fromBufferAttribute(r,u),ua.fromBufferAttribute(r,h);const p=t.morphTargetInfluences;if(a&&p){fa.set(0,0,0),ma.set(0,0,0),ga.set(0,0,0);for(let t=0,e=a.length;t<e;t++){const e=p[t],i=a[t];0!==e&&(ha.fromBufferAttribute(i,c),pa.fromBufferAttribute(i,u),da.fromBufferAttribute(i,h),o?(fa.addScaledVector(ha,e),ma.addScaledVector(pa,e),ga.addScaledVector(da,e)):(fa.addScaledVector(ha.sub(la),e),ma.addScaledVector(pa.sub(ca),e),ga.addScaledVector(da.sub(ua),e)))}la.add(fa),ca.add(ma),ua.add(ga)}t.isSkinnedMesh&&(t.boneTransform(c,la),t.boneTransform(u,ca),t.boneTransform(h,ua));const d=function(t,e,i,n,r,a,o,s){let l;if(l=1===e.side?n.intersectTriangle(o,a,r,!0,s):n.intersectTriangle(r,a,o,2!==e.side,s),null===l)return null;ba.copy(s),ba.applyMatrix4(t.matrixWorld);const c=i.ray.origin.distanceTo(ba);return c<i.near||c>i.far?null:{distance:c,point:ba.clone(),object:t}}(t,e,i,n,la,ca,ua,xa);if(d){s&&(_a.fromBufferAttribute(s,c),ya.fromBufferAttribute(s,u),va.fromBufferAttribute(s,h),d.uv=Dr.getUV(xa,la,ca,ua,_a,ya,va,new sn)),l&&(_a.fromBufferAttribute(l,c),ya.fromBufferAttribute(l,u),va.fromBufferAttribute(l,h),d.uv2=Dr.getUV(xa,la,ca,ua,_a,ya,va,new sn));const t={a:c,b:u,c:h,normal:new bn,materialIndex:0};Dr.getNormal(la,ca,ua,t.normal),d.face=t}return d}wa.prototype.isMesh=!0;class Ea extends ra{constructor(t=1,e=1,i=1,n=1,r=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:r,depthSegments:a};const o=this;n=Math.floor(n),r=Math.floor(r),a=Math.floor(a);const s=[],l=[],c=[],u=[];let h=0,p=0;function d(t,e,i,n,r,a,d,f,m,g,_){const y=a/m,v=d/g,x=a/2,b=d/2,w=f/2,S=m+1,E=g+1;let T=0,M=0;const C=new bn;for(let o=0;o<E;o++){const a=o*v-b;for(let s=0;s<S;s++){const h=s*y-x;C[t]=h*n,C[e]=a*r,C[i]=w,l.push(C.x,C.y,C.z),C[t]=0,C[e]=0,C[i]=f>0?1:-1,c.push(C.x,C.y,C.z),u.push(s/m),u.push(1-o/g),T+=1}}for(let o=0;o<g;o++)for(let t=0;t<m;t++){const e=h+t+S*o,i=h+t+S*(o+1),n=h+(t+1)+S*(o+1),r=h+(t+1)+S*o;s.push(e,i,r),s.push(i,n,r),M+=6}o.addGroup(p,M,_),p+=M,h+=T}d("z","y","x",-1,-1,i,e,t,a,r,0),d("z","y","x",1,-1,i,e,-t,a,r,1),d("x","z","y",1,1,t,i,e,n,a,2),d("x","z","y",1,-1,t,i,-e,n,a,3),d("x","y","z",1,-1,t,e,i,n,r,4),d("x","y","z",-1,-1,t,e,-i,n,r,5),this.setIndex(s),this.setAttribute("position",new Xr(l,3)),this.setAttribute("normal",new Xr(c,3)),this.setAttribute("uv",new Xr(u,2))}static fromJSON(t){return new Ea(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function Ta(t){const e={};for(const i in t){e[i]={};for(const n in t[i]){const r=t[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?e[i][n]=r.clone():Array.isArray(r)?e[i][n]=r.slice():e[i][n]=r}}return e}function Ma(t){const e={};for(let i=0;i<t.length;i++){const n=Ta(t[i]);for(const t in n)e[t]=n[t]}return e}const Ca={clone:Ta,merge:Ma};class Ia extends Br{constructor(t){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Ta(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const n in this.uniforms){const i=this.uniforms[n].value;i&&i.isTexture?e.uniforms[n]={type:"t",value:i.toJSON(t).uuid}:i&&i.isColor?e.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?e.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?e.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?e.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?e.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?e.uniforms[n]={type:"m4",value:i.toArray()}:e.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const i={};for(const n in this.extensions)!0===this.extensions[n]&&(i[n]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}}Ia.prototype.isShaderMaterial=!0;class Aa extends Sr{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new Jn,this.projectionMatrix=new Jn,this.projectionMatrixInverse=new Jn}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}Aa.prototype.isCamera=!0;class ka extends Aa{constructor(t=50,e=1,i=.1,n=2e3){super(),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*Xi*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*Yi*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*Xi*Math.atan(Math.tan(.5*Yi*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,n,r,a){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*Yi*this.fov)/this.zoom,i=2*e,n=this.aspect*i,r=-.5*n;const a=this.view;if(null!==this.view&&this.view.enabled){const t=a.fullWidth,o=a.fullHeight;r+=a.offsetX*n/t,e-=a.offsetY*i/o,n*=a.width/t,i*=a.height/o}const o=this.filmOffset;0!==o&&(r+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,e,e-i,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}ka.prototype.isPerspectiveCamera=!0;const Ra=90;class za extends Sr{constructor(t,e,i){if(super(),this.type="CubeCamera",!0!==i.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=i;const n=new ka(Ra,1,t,e);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new bn(1,0,0)),this.add(n);const r=new ka(Ra,1,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new bn(-1,0,0)),this.add(r);const a=new ka(Ra,1,t,e);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(new bn(0,1,0)),this.add(a);const o=new ka(Ra,1,t,e);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new bn(0,-1,0)),this.add(o);const s=new ka(Ra,1,t,e);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new bn(0,0,1)),this.add(s);const l=new ka(Ra,1,t,e);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new bn(0,0,-1)),this.add(l)}update(t,e){null===this.parent&&this.updateMatrixWorld();const i=this.renderTarget,[n,r,a,o,s,l]=this.children,c=t.xr.enabled,u=t.getRenderTarget();t.xr.enabled=!1;const h=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0),t.render(e,n),t.setRenderTarget(i,1),t.render(e,r),t.setRenderTarget(i,2),t.render(e,a),t.setRenderTarget(i,3),t.render(e,o),t.setRenderTarget(i,4),t.render(e,s),i.texture.generateMipmaps=h,t.setRenderTarget(i,5),t.render(e,l),t.setRenderTarget(u),t.xr.enabled=c}}class Pa extends mn{constructor(t,e,i,n,r,a,o,s,l,c){super(t=void 0!==t?t:[],e=void 0!==e?e:di,i,n,r,a,o,s,l,c),this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}Pa.prototype.isCubeTexture=!0;class Da extends yn{constructor(t,e,i){Number.isInteger(e)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),e=i),super(t,t,e),e=e||{},this.texture=new Pa(void 0,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:xi,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.format=Ai,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},n=new Ea(5,5,5),r=new Ia({name:"CubemapFromEquirect",uniforms:Ta(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:1,blending:0});r.uniforms.tEquirect.value=e;const a=new wa(n,r),o=e.minFilter;e.minFilter===bi&&(e.minFilter=xi);return new za(1,10,this).update(t,a),e.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(t,e,i,n){const r=t.getRenderTarget();for(let a=0;a<6;a++)t.setRenderTarget(this,a),t.clear(e,i,n);t.setRenderTarget(r)}}Da.prototype.isWebGLCubeRenderTarget=!0;const La=new bn,Ba=new bn,Oa=new ln;class Fa{constructor(t=new bn(1,0,0),e=0){this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){const n=La.subVectors(i,e).cross(Ba.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){const i=t.delta(La),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const r=-(t.start.dot(this.normal)+this.constant)/n;return r<0||r>1?null:e.copy(i).multiplyScalar(r).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const i=e||Oa.getNormalMatrix(t),n=this.coplanarPoint(La).applyMatrix4(t),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}Fa.prototype.isPlane=!0;const Na=new jn,Ua=new bn;class $a{constructor(t=new Fa,e=new Fa,i=new Fa,n=new Fa,r=new Fa,a=new Fa){this.planes=[t,e,i,n,r,a]}set(t,e,i,n,r,a){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(i),o[3].copy(n),o[4].copy(r),o[5].copy(a),this}copy(t){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t){const e=this.planes,i=t.elements,n=i[0],r=i[1],a=i[2],o=i[3],s=i[4],l=i[5],c=i[6],u=i[7],h=i[8],p=i[9],d=i[10],f=i[11],m=i[12],g=i[13],_=i[14],y=i[15];return e[0].setComponents(o-n,u-s,f-h,y-m).normalize(),e[1].setComponents(o+n,u+s,f+h,y+m).normalize(),e[2].setComponents(o+r,u+l,f+p,y+g).normalize(),e[3].setComponents(o-r,u-l,f-p,y-g).normalize(),e[4].setComponents(o-a,u-c,f-d,y-_).normalize(),e[5].setComponents(o+a,u+c,f+d,y+_).normalize(),this}intersectsObject(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),Na.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Na)}intersectsSprite(t){return Na.center.set(0,0,0),Na.radius=.7071067811865476,Na.applyMatrix4(t.matrixWorld),this.intersectsSphere(Na)}intersectsSphere(t){const e=this.planes,i=t.center,n=-t.radius;for(let r=0;r<6;r++){if(e[r].distanceToPoint(i)<n)return!1}return!0}intersectsBox(t){const e=this.planes;for(let i=0;i<6;i++){const n=e[i];if(Ua.x=n.normal.x>0?t.max.x:t.min.x,Ua.y=n.normal.y>0?t.max.y:t.min.y,Ua.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(Ua)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Va(){let t=null,e=!1,i=null,n=null;function r(e,a){i(e,a),n=t.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==i&&(n=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(t){i=t},setContext:function(e){t=e}}}function ja(t,e){const i=e.isWebGL2,n=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),n.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const i=n.get(e);i&&(t.deleteBuffer(i.buffer),n.delete(e))},update:function(e,r){if(e.isGLBufferAttribute){const t=n.get(e);return void((!t||t.version<e.version)&&n.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const a=n.get(e);void 0===a?n.set(e,function(e,n){const r=e.array,a=e.usage,o=t.createBuffer();t.bindBuffer(n,o),t.bufferData(n,r,a),e.onUploadCallback();let s=5126;return r instanceof Float32Array?s=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?e.isFloat16BufferAttribute?i?s=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):s=5123:r instanceof Int16Array?s=5122:r instanceof Uint32Array?s=5125:r instanceof Int32Array?s=5124:r instanceof Int8Array?s=5120:(r instanceof Uint8Array||r instanceof Uint8ClampedArray)&&(s=5121),{buffer:o,type:s,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version}}(e,r)):a.version<e.version&&(!function(e,n,r){const a=n.array,o=n.updateRange;t.bindBuffer(r,e),-1===o.count?t.bufferSubData(r,0,a):(i?t.bufferSubData(r,o.offset*a.BYTES_PER_ELEMENT,a,o.offset,o.count):t.bufferSubData(r,o.offset*a.BYTES_PER_ELEMENT,a.subarray(o.offset,o.offset+o.count)),o.count=-1)}(a.buffer,e,r),a.version=e.version)}}}class qa extends ra{constructor(t=1,e=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n};const r=t/2,a=e/2,o=Math.floor(i),s=Math.floor(n),l=o+1,c=s+1,u=t/o,h=e/s,p=[],d=[],f=[],m=[];for(let g=0;g<c;g++){const t=g*h-a;for(let e=0;e<l;e++){const i=e*u-r;d.push(i,-t,0),f.push(0,0,1),m.push(e/o),m.push(1-g/s)}}for(let g=0;g<s;g++)for(let t=0;t<o;t++){const e=t+l*g,i=t+l*(g+1),n=t+1+l*(g+1),r=t+1+l*g;p.push(e,i,r),p.push(i,n,r)}this.setIndex(p),this.setAttribute("position",new Xr(d,3)),this.setAttribute("normal",new Xr(f,3)),this.setAttribute("uv",new Xr(m,2))}static fromJSON(t){return new qa(t.width,t.height,t.widthSegments,t.heightSegments)}}const Ga={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec;\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\t\treflectVec = reflect( - viewDir, normal );\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#else\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\n\t\t\t#endif\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tlightMapIrradiance *= PI;\n\t#endif\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= specularColorMapTexelToLinear( texture2D( specularColorMap, vUv ) ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= sheenColorMapTexelToLinear( texture2D( sheenColorMap, vUv ) ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1, 2 ) * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform vec2 morphTargetsTextureSize;\n\t\tvec3 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset, const in int stride ) {\n\t\t\tfloat texelIndex = float( vertexIndex * stride + offset );\n\t\t\tfloat y = floor( texelIndex / morphTargetsTextureSize.x );\n\t\t\tfloat x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tvec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );\n\t\t\treturn texture( morphTargetsTexture, morphUV ).xyz;\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\t#ifndef USE_MORPHNORMALS\n\t\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 1 ) * morphTargetInfluences[ i ];\n\t\t\t#else\n\t\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 2 ) * morphTargetInfluences[ i ];\n\t\t\t#endif\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( float roughness, float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 diffuseColor, vec3 specularColor, float specularF90,\n\t\tvec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,\n\t\tvec3 attenuationColor, float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - clearcoat * Fcc ) + clearcoatSpecular * clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},Ha={common:{diffuse:{value:new jr(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new ln},uv2Transform:{value:new ln},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new sn(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new jr(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new jr(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ln}},sprite:{diffuse:{value:new jr(16777215)},opacity:{value:1},center:{value:new sn(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ln}}},Wa={basic:{uniforms:Ma([Ha.common,Ha.specularmap,Ha.envmap,Ha.aomap,Ha.lightmap,Ha.fog]),vertexShader:Ga.meshbasic_vert,fragmentShader:Ga.meshbasic_frag},lambert:{uniforms:Ma([Ha.common,Ha.specularmap,Ha.envmap,Ha.aomap,Ha.lightmap,Ha.emissivemap,Ha.fog,Ha.lights,{emissive:{value:new jr(0)}}]),vertexShader:Ga.meshlambert_vert,fragmentShader:Ga.meshlambert_frag},phong:{uniforms:Ma([Ha.common,Ha.specularmap,Ha.envmap,Ha.aomap,Ha.lightmap,Ha.emissivemap,Ha.bumpmap,Ha.normalmap,Ha.displacementmap,Ha.fog,Ha.lights,{emissive:{value:new jr(0)},specular:{value:new jr(1118481)},shininess:{value:30}}]),vertexShader:Ga.meshphong_vert,fragmentShader:Ga.meshphong_frag},standard:{uniforms:Ma([Ha.common,Ha.envmap,Ha.aomap,Ha.lightmap,Ha.emissivemap,Ha.bumpmap,Ha.normalmap,Ha.displacementmap,Ha.roughnessmap,Ha.metalnessmap,Ha.fog,Ha.lights,{emissive:{value:new jr(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ga.meshphysical_vert,fragmentShader:Ga.meshphysical_frag},toon:{uniforms:Ma([Ha.common,Ha.aomap,Ha.lightmap,Ha.emissivemap,Ha.bumpmap,Ha.normalmap,Ha.displacementmap,Ha.gradientmap,Ha.fog,Ha.lights,{emissive:{value:new jr(0)}}]),vertexShader:Ga.meshtoon_vert,fragmentShader:Ga.meshtoon_frag},matcap:{uniforms:Ma([Ha.common,Ha.bumpmap,Ha.normalmap,Ha.displacementmap,Ha.fog,{matcap:{value:null}}]),vertexShader:Ga.meshmatcap_vert,fragmentShader:Ga.meshmatcap_frag},points:{uniforms:Ma([Ha.points,Ha.fog]),vertexShader:Ga.points_vert,fragmentShader:Ga.points_frag},dashed:{uniforms:Ma([Ha.common,Ha.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ga.linedashed_vert,fragmentShader:Ga.linedashed_frag},depth:{uniforms:Ma([Ha.common,Ha.displacementmap]),vertexShader:Ga.depth_vert,fragmentShader:Ga.depth_frag},normal:{uniforms:Ma([Ha.common,Ha.bumpmap,Ha.normalmap,Ha.displacementmap,{opacity:{value:1}}]),vertexShader:Ga.meshnormal_vert,fragmentShader:Ga.meshnormal_frag},sprite:{uniforms:Ma([Ha.sprite,Ha.fog]),vertexShader:Ga.sprite_vert,fragmentShader:Ga.sprite_frag},background:{uniforms:{uvTransform:{value:new ln},t2D:{value:null}},vertexShader:Ga.background_vert,fragmentShader:Ga.background_frag},cube:{uniforms:Ma([Ha.envmap,{opacity:{value:1}}]),vertexShader:Ga.cube_vert,fragmentShader:Ga.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ga.equirect_vert,fragmentShader:Ga.equirect_frag},distanceRGBA:{uniforms:Ma([Ha.common,Ha.displacementmap,{referencePosition:{value:new bn},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ga.distanceRGBA_vert,fragmentShader:Ga.distanceRGBA_frag},shadow:{uniforms:Ma([Ha.lights,Ha.fog,{color:{value:new jr(0)},opacity:{value:1}}]),vertexShader:Ga.shadow_vert,fragmentShader:Ga.shadow_frag}};function Za(t,e,i,n,r){const a=new jr(0);let o,s,l=0,c=null,u=0,h=null;function p(t,e){i.buffers.color.setClear(t.r,t.g,t.b,e,r)}return{getClearColor:function(){return a},setClearColor:function(t,e=1){a.set(t),l=e,p(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(t){l=t,p(a,l)},render:function(i,r){let d=!1,f=!0===r.isScene?r.background:null;f&&f.isTexture&&(f=e.get(f));const m=t.xr,g=m.getSession&&m.getSession();g&&"additive"===g.environmentBlendMode&&(f=null),null===f?p(a,l):f&&f.isColor&&(p(f,1),d=!0),(t.autoClear||d)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),f&&(f.isCubeTexture||f.mapping===mi)?(void 0===s&&(s=new wa(new Ea(1,1,1),new Ia({name:"BackgroundCubeMaterial",uniforms:Ta(Wa.cube.uniforms),vertexShader:Wa.cube.vertexShader,fragmentShader:Wa.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),s.geometry.deleteAttribute("normal"),s.geometry.deleteAttribute("uv"),s.onBeforeRender=function(t,e,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(s.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(s)),s.material.uniforms.envMap.value=f,s.material.uniforms.flipEnvMap.value=f.isCubeTexture&&!1===f.isRenderTargetTexture?-1:1,c===f&&u===f.version&&h===t.toneMapping||(s.material.needsUpdate=!0,c=f,u=f.version,h=t.toneMapping),i.unshift(s,s.geometry,s.material,0,0,null)):f&&f.isTexture&&(void 0===o&&(o=new wa(new qa(2,2),new Ia({name:"BackgroundMaterial",uniforms:Ta(Wa.background.uniforms),vertexShader:Wa.background.vertexShader,fragmentShader:Wa.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(o)),o.material.uniforms.t2D.value=f,!0===f.matrixAutoUpdate&&f.updateMatrix(),o.material.uniforms.uvTransform.value.copy(f.matrix),c===f&&u===f.version&&h===t.toneMapping||(o.material.needsUpdate=!0,c=f,u=f.version,h=t.toneMapping),i.unshift(o,o.geometry,o.material,0,0,null))}}}function Ya(t,e,i,n){const r=t.getParameter(34921),a=n.isWebGL2?null:e.get("OES_vertex_array_object"),o=n.isWebGL2||null!==a,s={},l=p(null);let c=l;function u(e){return n.isWebGL2?t.bindVertexArray(e):a.bindVertexArrayOES(e)}function h(e){return n.isWebGL2?t.deleteVertexArray(e):a.deleteVertexArrayOES(e)}function p(t){const e=[],i=[],n=[];for(let a=0;a<r;a++)e[a]=0,i[a]=0,n[a]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:i,attributeDivisors:n,object:t,attributes:{},index:null}}function d(){const t=c.newAttributes;for(let e=0,i=t.length;e<i;e++)t[e]=0}function f(t){m(t,0)}function m(i,r){const a=c.newAttributes,o=c.enabledAttributes,s=c.attributeDivisors;if(a[i]=1,0===o[i]&&(t.enableVertexAttribArray(i),o[i]=1),s[i]!==r){(n.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,r),s[i]=r}}function g(){const e=c.newAttributes,i=c.enabledAttributes;for(let n=0,r=i.length;n<r;n++)i[n]!==e[n]&&(t.disableVertexAttribArray(n),i[n]=0)}function _(e,i,r,a,o,s){!0!==n.isWebGL2||5124!==r&&5125!==r?t.vertexAttribPointer(e,i,r,a,o,s):t.vertexAttribIPointer(e,i,r,o,s)}function y(){v(),c!==l&&(c=l,u(c.object))}function v(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,h,y,v){let x=!1;if(o){const e=function(e,i,r){const o=!0===r.wireframe;let l=s[e.id];void 0===l&&(l={},s[e.id]=l);let c=l[i.id];void 0===c&&(c={},l[i.id]=c);let u=c[o];void 0===u&&(u=p(n.isWebGL2?t.createVertexArray():a.createVertexArrayOES()),c[o]=u);return u}(y,h,l);c!==e&&(c=e,u(c.object)),x=function(t,e){const i=c.attributes,n=t.attributes;let r=0;for(const a in n){const t=i[a],e=n[a];if(void 0===t)return!0;if(t.attribute!==e)return!0;if(t.data!==e.data)return!0;r++}return c.attributesNum!==r||c.index!==e}(y,v),x&&function(t,e){const i={},n=t.attributes;let r=0;for(const a in n){const t=n[a],e={};e.attribute=t,t.data&&(e.data=t.data),i[a]=e,r++}c.attributes=i,c.attributesNum=r,c.index=e}(y,v)}else{const t=!0===l.wireframe;c.geometry===y.id&&c.program===h.id&&c.wireframe===t||(c.geometry=y.id,c.program=h.id,c.wireframe=t,x=!0)}!0===r.isInstancedMesh&&(x=!0),null!==v&&i.update(v,34963),x&&(!function(r,a,o,s){if(!1===n.isWebGL2&&(r.isInstancedMesh||s.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;d();const l=s.attributes,c=o.getAttributes(),u=a.defaultAttributeValues;for(const e in c){const n=c[e];if(n.location>=0){let a=l[e];if(void 0===a&&("instanceMatrix"===e&&r.instanceMatrix&&(a=r.instanceMatrix),"instanceColor"===e&&r.instanceColor&&(a=r.instanceColor)),void 0!==a){const e=a.normalized,o=a.itemSize,l=i.get(a);if(void 0===l)continue;const c=l.buffer,u=l.type,h=l.bytesPerElement;if(a.isInterleavedBufferAttribute){const i=a.data,l=i.stride,p=a.offset;if(i&&i.isInstancedInterleavedBuffer){for(let t=0;t<n.locationSize;t++)m(n.location+t,i.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=i.meshPerAttribute*i.count)}else for(let t=0;t<n.locationSize;t++)f(n.location+t);t.bindBuffer(34962,c);for(let t=0;t<n.locationSize;t++)_(n.location+t,o/n.locationSize,u,e,l*h,(p+o/n.locationSize*t)*h)}else{if(a.isInstancedBufferAttribute){for(let t=0;t<n.locationSize;t++)m(n.location+t,a.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=a.meshPerAttribute*a.count)}else for(let t=0;t<n.locationSize;t++)f(n.location+t);t.bindBuffer(34962,c);for(let t=0;t<n.locationSize;t++)_(n.location+t,o/n.locationSize,u,e,o*h,o/n.locationSize*t*h)}}else if(void 0!==u){const i=u[e];if(void 0!==i)switch(i.length){case 2:t.vertexAttrib2fv(n.location,i);break;case 3:t.vertexAttrib3fv(n.location,i);break;case 4:t.vertexAttrib4fv(n.location,i);break;default:t.vertexAttrib1fv(n.location,i)}}}}g()}(r,l,h,y),null!==v&&t.bindBuffer(34963,i.get(v).buffer))},reset:y,resetDefaultState:v,dispose:function(){y();for(const t in s){const e=s[t];for(const t in e){const i=e[t];for(const t in i)h(i[t].object),delete i[t];delete e[t]}delete s[t]}},releaseStatesOfGeometry:function(t){if(void 0===s[t.id])return;const e=s[t.id];for(const i in e){const t=e[i];for(const e in t)h(t[e].object),delete t[e];delete e[i]}delete s[t.id]},releaseStatesOfProgram:function(t){for(const e in s){const i=s[e];if(void 0===i[t.id])continue;const n=i[t.id];for(const t in n)h(n[t].object),delete n[t];delete i[t.id]}},initAttributes:d,enableAttribute:f,disableUnusedAttributes:g}}function Xa(t,e,i,n){const r=n.isWebGL2;let a;this.setMode=function(t){a=t},this.render=function(e,n){t.drawArrays(a,e,n),i.update(n,a,1)},this.renderInstances=function(n,o,s){if(0===s)return;let l,c;if(r)l=t,c="drawArraysInstanced";else if(l=e.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](a,n,o,s),i.update(o,a,s)}}function Ka(t,e,i){let n;function r(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const a="undefined"!==typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!==typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let o=void 0!==i.precision?i.precision:"highp";const s=r(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);const l=a||e.has("WEBGL_draw_buffers"),c=!0===i.logarithmicDepthBuffer,u=t.getParameter(34930),h=t.getParameter(35660),p=t.getParameter(3379),d=t.getParameter(34076),f=t.getParameter(34921),m=t.getParameter(36347),g=t.getParameter(36348),_=t.getParameter(36349),y=h>0,v=a||e.has("OES_texture_float");return{isWebGL2:a,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==n)return n;if(!0===e.has("EXT_texture_filter_anisotropic")){const i=e.get("EXT_texture_filter_anisotropic");n=t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:r,precision:o,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:h,maxTextureSize:p,maxCubemapSize:d,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:_,vertexTextures:y,floatFragmentTextures:v,floatVertexTextures:y&&v,maxSamples:a?t.getParameter(36183):0}}function Ja(t){const e=this;let i=null,n=0,r=!1,a=!1;const o=new Fa,s=new ln,l={value:null,needsUpdate:!1};function c(){l.value!==i&&(l.value=i,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function u(t,i,n,r){const a=null!==t?t.length:0;let c=null;if(0!==a){if(c=l.value,!0!==r||null===c){const e=n+4*a,r=i.matrixWorldInverse;s.getNormalMatrix(r),(null===c||c.length<e)&&(c=new Float32Array(e));for(let i=0,l=n;i!==a;++i,l+=4)o.copy(t[i]).applyMatrix4(r,s),o.normal.toArray(c,l),c[l+3]=o.constant}l.value=c,l.needsUpdate=!0}return e.numPlanes=a,e.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,a){const o=0!==t.length||e||0!==n||r;return r=e,i=u(t,a,0),n=t.length,o},this.beginShadows=function(){a=!0,u(null)},this.endShadows=function(){a=!1,c()},this.setState=function(e,o,s){const h=e.clippingPlanes,p=e.clipIntersection,d=e.clipShadows,f=t.get(e);if(!r||null===h||0===h.length||a&&!d)a?u(null):c();else{const t=a?0:n,e=4*t;let r=f.clippingState||null;l.value=r,r=u(h,o,e,s);for(let n=0;n!==e;++n)r[n]=i[n];f.clippingState=r,this.numIntersection=p?this.numPlanes:0,this.numPlanes+=t}}}function Qa(t){let e=new WeakMap;function i(t,e){return 303===e?t.mapping=di:304===e&&(t.mapping=fi),t}function n(t){const i=t.target;i.removeEventListener("dispose",n);const r=e.get(i);void 0!==r&&(e.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){const a=r.mapping;if(303===a||304===a){if(e.has(r)){return i(e.get(r).texture,r.mapping)}{const a=r.image;if(a&&a.height>0){const o=t.getRenderTarget(),s=new Da(a.height/2);return s.fromEquirectangularTexture(t,r),e.set(r,s),t.setRenderTarget(o),r.addEventListener("dispose",n),i(s.texture,r.mapping)}return null}}}return r},dispose:function(){e=new WeakMap}}}Wa.physical={uniforms:Ma([Wa.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new sn(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new jr(0)},sheenColorMap:{value:null},sheenRoughness:{value:0},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new sn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new jr(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularColor:{value:new jr(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Ga.meshphysical_vert,fragmentShader:Ga.meshphysical_frag};class to extends Aa{constructor(t=-1,e=1,i=1,n=-1,r=.1,a=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=n,this.near=r,this.far=a,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,i,n,r,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let r=i-t,a=i+t,o=n+e,s=n-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=t*this.view.offsetX,a=r+t*this.view.width,o-=e*this.view.offsetY,s=o-e*this.view.height}this.projectionMatrix.makeOrthographic(r,a,o,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}to.prototype.isOrthographicCamera=!0;class eo extends Ia{constructor(t){super(t),this.type="RawShaderMaterial"}}eo.prototype.isRawShaderMaterial=!0;const io=Math.pow(2,8),no=[.125,.215,.35,.446,.526,.582],ro=5+no.length,ao=20,oo={[Ni]:0,[Ui]:1,[Vi]:2,3004:3,3005:4,3006:5,[$i]:6},so=new to,{_lodPlanes:lo,_sizeLods:co,_sigmas:uo}=vo(),ho=new jr;let po=null;const fo=(1+Math.sqrt(5))/2,mo=1/fo,go=[new bn(1,1,1),new bn(-1,1,1),new bn(1,1,-1),new bn(-1,1,-1),new bn(0,fo,mo),new bn(0,fo,-mo),new bn(mo,0,fo),new bn(-mo,0,fo),new bn(fo,mo,0),new bn(-fo,mo,0)];class _o{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=function(t){const e=new Float32Array(t),i=new bn(0,1,0);return new eo({name:"SphericalGaussianBlur",defines:{n:t},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i},inputEncoding:{value:oo[3e3]},outputEncoding:{value:oo[3e3]}},vertexShader:Eo(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t${To()}\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:0,depthTest:!1,depthWrite:!1})}(ao),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,i=.1,n=100){po=this._renderer.getRenderTarget();const r=this._allocateTargets();return this._sceneToCubeUV(t,i,n,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t){return this._fromTexture(t)}fromCubemap(t){return this._fromTexture(t)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=So(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=wo(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let t=0;t<lo.length;t++)lo[t].dispose()}_cleanup(t){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(po),t.scissorTest=!1,bo(t,0,0,t.width,t.height)}_fromTexture(t){po=this._renderer.getRenderTarget();const e=this._allocateTargets(t);return this._textureToCubeUV(t,e),this._applyPMREM(e),this._cleanup(e),e}_allocateTargets(t){const e={magFilter:vi,minFilter:vi,generateMipmaps:!1,type:wi,format:1023,encoding:yo(t)?t.encoding:Vi,depthBuffer:!1},i=xo(e);return i.depthBuffer=!t,this._pingPongRenderTarget=xo(e),i}_compileMaterial(t){const e=new wa(lo[0],t);this._renderer.compile(e,so)}_sceneToCubeUV(t,e,i,n){const r=new ka(90,1,e,i),a=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],s=this._renderer,l=s.autoClear,c=s.outputEncoding,u=s.toneMapping;s.getClearColor(ho),s.toneMapping=0,s.outputEncoding=Ni,s.autoClear=!1;const h=new qr({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),p=new wa(new Ea,h);let d=!1;const f=t.background;f?f.isColor&&(h.color.copy(f),t.background=null,d=!0):(h.color.copy(ho),d=!0);for(let m=0;m<6;m++){const e=m%3;0==e?(r.up.set(0,a[m],0),r.lookAt(o[m],0,0)):1==e?(r.up.set(0,0,a[m]),r.lookAt(0,o[m],0)):(r.up.set(0,a[m],0),r.lookAt(0,0,o[m])),bo(n,e*io,m>2?io:0,io,io),s.setRenderTarget(n),d&&s.render(p,r),s.render(t,r)}p.geometry.dispose(),p.material.dispose(),s.toneMapping=u,s.outputEncoding=c,s.autoClear=l,t.background=f}_setEncoding(t,e){!0===this._renderer.capabilities.isWebGL2&&e.format===Ai&&e.type===wi&&e.encoding===Ui?t.value=oo[3e3]:t.value=oo[e.encoding]}_textureToCubeUV(t,e){const i=this._renderer,n=t.mapping===di||t.mapping===fi;n?null==this._cubemapShader&&(this._cubemapShader=So()):null==this._equirectShader&&(this._equirectShader=wo());const r=n?this._cubemapShader:this._equirectShader,a=new wa(lo[0],r),o=r.uniforms;o.envMap.value=t,n||o.texelSize.value.set(1/t.image.width,1/t.image.height),this._setEncoding(o.inputEncoding,t),this._setEncoding(o.outputEncoding,e.texture),bo(e,0,0,3*io,2*io),i.setRenderTarget(e),i.render(a,so)}_applyPMREM(t){const e=this._renderer,i=e.autoClear;e.autoClear=!1;for(let n=1;n<ro;n++){const e=Math.sqrt(uo[n]*uo[n]-uo[n-1]*uo[n-1]),i=go[(n-1)%go.length];this._blur(t,n-1,n,e,i)}e.autoClear=i}_blur(t,e,i,n,r){const a=this._pingPongRenderTarget;this._halfBlur(t,a,e,i,n,"latitudinal",r),this._halfBlur(a,t,i,i,n,"longitudinal",r)}_halfBlur(t,e,i,n,r,a,o){const s=this._renderer,l=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new wa(lo[n],l),u=l.uniforms,h=co[i]-1,p=isFinite(r)?Math.PI/(2*h):2*Math.PI/39,d=r/p,f=isFinite(r)?1+Math.floor(3*d):ao;f>ao&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let y=0;y<ao;++y){const t=y/d,e=Math.exp(-t*t/2);m.push(e),0==y?g+=e:y<f&&(g+=2*e)}for(let y=0;y<m.length;y++)m[y]=m[y]/g;u.envMap.value=t.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value="latitudinal"===a,o&&(u.poleAxis.value=o),u.dTheta.value=p,u.mipInt.value=8-i,this._setEncoding(u.inputEncoding,t.texture),this._setEncoding(u.outputEncoding,t.texture);const _=co[n];bo(e,3*Math.max(0,io-2*_),(0===n?0:2*io)+2*_*(n>4?n-8+4:0),3*_,2*_),s.setRenderTarget(e),s.render(c,so)}}function yo(t){return void 0!==t&&t.type===wi&&(t.encoding===Ni||t.encoding===Ui||t.encoding===$i)}function vo(){const t=[],e=[],i=[];let n=8;for(let r=0;r<ro;r++){const a=Math.pow(2,n);e.push(a);let o=1/a;r>4?o=no[r-8+4-1]:0==r&&(o=0),i.push(o);const s=1/(a-1),l=-s/2,c=1+s/2,u=[l,l,c,l,c,c,l,l,c,c,l,c],h=6,p=6,d=3,f=2,m=1,g=new Float32Array(d*p*h),_=new Float32Array(f*p*h),y=new Float32Array(m*p*h);for(let t=0;t<h;t++){const e=t%3*2/3-1,i=t>2?0:-1,n=[e,i,0,e+2/3,i,0,e+2/3,i+1,0,e,i,0,e+2/3,i+1,0,e,i+1,0];g.set(n,d*p*t),_.set(u,f*p*t);const r=[t,t,t,t,t,t];y.set(r,m*p*t)}const v=new ra;v.setAttribute("position",new Wr(g,d)),v.setAttribute("uv",new Wr(_,f)),v.setAttribute("faceIndex",new Wr(y,m)),t.push(v),n>4&&n--}return{_lodPlanes:t,_sizeLods:e,_sigmas:i}}function xo(t){const e=new yn(3*io,3*io,t);return e.texture.mapping=mi,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function bo(t,e,i,n,r){t.viewport.set(e,i,n,r),t.scissor.set(e,i,n,r)}function wo(){const t=new sn(1,1);return new eo({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:t},inputEncoding:{value:oo[3e3]},outputEncoding:{value:oo[3e3]}},vertexShader:Eo(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t${To()}\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:0,depthTest:!1,depthWrite:!1})}function So(){return new eo({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:oo[3e3]},outputEncoding:{value:oo[3e3]}},vertexShader:Eo(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t${To()}\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:0,depthTest:!1,depthWrite:!1})}function Eo(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function To(){return"\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t"}function Mo(t){let e=new WeakMap,i=null;function n(t){const i=t.target;i.removeEventListener("dispose",n);const r=e.get(i);void 0!==r&&(e.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){const a=r.mapping,o=303===a||304===a,s=a===di||a===fi;if(o||s){if(e.has(r))return e.get(r).texture;{const a=r.image;if(o&&a&&a.height>0||s&&a&&function(t){let e=0;const i=6;for(let n=0;n<i;n++)void 0!==t[n]&&e++;return e===i}(a)){const a=t.getRenderTarget();null===i&&(i=new _o(t));const s=o?i.fromEquirectangular(r):i.fromCubemap(r);return e.set(r,s),t.setRenderTarget(a),r.addEventListener("dispose",n),s.texture}return null}}}return r},dispose:function(){e=new WeakMap,null!==i&&(i.dispose(),i=null)}}}function Co(t){const e={};function i(i){if(void 0!==e[i])return e[i];let n;switch(i){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=t.getExtension(i)}return e[i]=n,n}return{has:function(t){return null!==i(t)},init:function(t){t.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float")},get:function(t){const e=i(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function Io(t,e,i,n){const r={},a=new WeakMap;function o(t){const s=t.target;null!==s.index&&e.remove(s.index);for(const i in s.attributes)e.remove(s.attributes[i]);s.removeEventListener("dispose",o),delete r[s.id];const l=a.get(s);l&&(e.remove(l),a.delete(s)),n.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,i.memory.geometries--}function s(t){const i=[],n=t.index,r=t.attributes.position;let o=0;if(null!==n){const t=n.array;o=n.version;for(let e=0,n=t.length;e<n;e+=3){const n=t[e+0],r=t[e+1],a=t[e+2];i.push(n,r,r,a,a,n)}}else{const t=r.array;o=r.version;for(let e=0,n=t.length/3-1;e<n;e+=3){const t=e+0,n=e+1,r=e+2;i.push(t,n,n,r,r,t)}}const s=new(cn(i)>65535?Yr:Zr)(i,1);s.version=o;const l=a.get(t);l&&e.remove(l),a.set(t,s)}return{get:function(t,e){return!0===r[e.id]||(e.addEventListener("dispose",o),r[e.id]=!0,i.memory.geometries++),e},update:function(t){const i=t.attributes;for(const r in i)e.update(i[r],34962);const n=t.morphAttributes;for(const r in n){const t=n[r];for(let i=0,n=t.length;i<n;i++)e.update(t[i],34962)}},getWireframeAttribute:function(t){const e=a.get(t);if(e){const i=t.index;null!==i&&e.version<i.version&&s(t)}else s(t);return a.get(t)}}}function Ao(t,e,i,n){const r=n.isWebGL2;let a,o,s;this.setMode=function(t){a=t},this.setIndex=function(t){o=t.type,s=t.bytesPerElement},this.render=function(e,n){t.drawElements(a,n,o,e*s),i.update(n,a,1)},this.renderInstances=function(n,l,c){if(0===c)return;let u,h;if(r)u=t,h="drawElementsInstanced";else if(u=e.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[h](a,l,o,n*s,c),i.update(l,a,c)}}function ko(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,i,n){switch(e.calls++,i){case 4:e.triangles+=n*(t/3);break;case 1:e.lines+=n*(t/2);break;case 3:e.lines+=n*(t-1);break;case 2:e.lines+=n*t;break;case 0:e.points+=n*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}class Ro extends mn{constructor(t=null,e=1,i=1,n=1){super(null),this.image={data:t,width:e,height:i,depth:n},this.magFilter=vi,this.minFilter=vi,this.wrapR=_i,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}function zo(t,e){return t[0]-e[0]}function Po(t,e){return Math.abs(e[1])-Math.abs(t[1])}function Do(t,e){let i=1;const n=e.isInterleavedBufferAttribute?e.data.array:e.array;n instanceof Int8Array?i=127:n instanceof Int16Array?i=32767:n instanceof Int32Array?i=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",n),t.divideScalar(i)}function Lo(t,e,i){const n={},r=new Float32Array(8),a=new WeakMap,o=new bn,s=[];for(let l=0;l<8;l++)s[l]=[l,0];return{update:function(l,c,u,h){const p=l.morphTargetInfluences;if(!0===e.isWebGL2){const n=c.morphAttributes.position.length;let r=a.get(c);if(void 0===r||r.count!==n){void 0!==r&&r.texture.dispose();const t=void 0!==c.morphAttributes.normal,i=c.morphAttributes.position,s=c.morphAttributes.normal||[],l=!0===t?2:1;let u=c.attributes.position.count*l,h=1;u>e.maxTextureSize&&(h=Math.ceil(u/e.maxTextureSize),u=e.maxTextureSize);const p=new Float32Array(u*h*4*n),d=new Ro(p,u,h,n);d.format=Ai,d.type=Ti;const f=4*l;for(let e=0;e<n;e++){const n=i[e],r=s[e],a=u*h*4*e;for(let e=0;e<n.count;e++){o.fromBufferAttribute(n,e),!0===n.normalized&&Do(o,n);const i=e*f;p[a+i+0]=o.x,p[a+i+1]=o.y,p[a+i+2]=o.z,p[a+i+3]=0,!0===t&&(o.fromBufferAttribute(r,e),!0===r.normalized&&Do(o,r),p[a+i+4]=o.x,p[a+i+5]=o.y,p[a+i+6]=o.z,p[a+i+7]=0)}}r={count:n,texture:d,size:new sn(u,h)},a.set(c,r)}let s=0;for(let t=0;t<p.length;t++)s+=p[t];const l=c.morphTargetsRelative?1:1-s;h.getUniforms().setValue(t,"morphTargetBaseInfluence",l),h.getUniforms().setValue(t,"morphTargetInfluences",p),h.getUniforms().setValue(t,"morphTargetsTexture",r.texture,i),h.getUniforms().setValue(t,"morphTargetsTextureSize",r.size)}else{const e=void 0===p?0:p.length;let i=n[c.id];if(void 0===i||i.length!==e){i=[];for(let t=0;t<e;t++)i[t]=[t,0];n[c.id]=i}for(let t=0;t<e;t++){const e=i[t];e[0]=t,e[1]=p[t]}i.sort(Po);for(let t=0;t<8;t++)t<e&&i[t][1]?(s[t][0]=i[t][0],s[t][1]=i[t][1]):(s[t][0]=Number.MAX_SAFE_INTEGER,s[t][1]=0);s.sort(zo);const a=c.morphAttributes.position,o=c.morphAttributes.normal;let l=0;for(let t=0;t<8;t++){const e=s[t],i=e[0],n=e[1];i!==Number.MAX_SAFE_INTEGER&&n?(a&&c.getAttribute("morphTarget"+t)!==a[i]&&c.setAttribute("morphTarget"+t,a[i]),o&&c.getAttribute("morphNormal"+t)!==o[i]&&c.setAttribute("morphNormal"+t,o[i]),r[t]=n,l+=n):(a&&!0===c.hasAttribute("morphTarget"+t)&&c.deleteAttribute("morphTarget"+t),o&&!0===c.hasAttribute("morphNormal"+t)&&c.deleteAttribute("morphNormal"+t),r[t]=0)}const u=c.morphTargetsRelative?1:1-l;h.getUniforms().setValue(t,"morphTargetBaseInfluence",u),h.getUniforms().setValue(t,"morphTargetInfluences",r)}}}}function Bo(t,e,i,n){let r=new WeakMap;function a(t){const e=t.target;e.removeEventListener("dispose",a),i.remove(e.instanceMatrix),null!==e.instanceColor&&i.remove(e.instanceColor)}return{update:function(t){const o=n.render.frame,s=t.geometry,l=e.get(t,s);return r.get(l)!==o&&(e.update(l),r.set(l,o)),t.isInstancedMesh&&(!1===t.hasEventListener("dispose",a)&&t.addEventListener("dispose",a),i.update(t.instanceMatrix,34962),null!==t.instanceColor&&i.update(t.instanceColor,34962)),l},dispose:function(){r=new WeakMap}}}Ro.prototype.isDataTexture2DArray=!0;class Oo extends mn{constructor(t=null,e=1,i=1,n=1){super(null),this.image={data:t,width:e,height:i,depth:n},this.magFilter=vi,this.minFilter=vi,this.wrapR=_i,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Oo.prototype.isDataTexture3D=!0;const Fo=new mn,No=new Ro,Uo=new Oo,$o=new Pa,Vo=[],jo=[],qo=new Float32Array(16),Go=new Float32Array(9),Ho=new Float32Array(4);function Wo(t,e,i){const n=t[0];if(n<=0||n>0)return t;const r=e*i;let a=Vo[r];if(void 0===a&&(a=new Float32Array(r),Vo[r]=a),0!==e){n.toArray(a,0);for(let n=1,r=0;n!==e;++n)r+=i,t[n].toArray(a,r)}return a}function Zo(t,e){if(t.length!==e.length)return!1;for(let i=0,n=t.length;i<n;i++)if(t[i]!==e[i])return!1;return!0}function Yo(t,e){for(let i=0,n=e.length;i<n;i++)t[i]=e[i]}function Xo(t,e){let i=jo[e];void 0===i&&(i=new Int32Array(e),jo[e]=i);for(let n=0;n!==e;++n)i[n]=t.allocateTextureUnit();return i}function Ko(t,e){const i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function Jo(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(Zo(i,e))return;t.uniform2fv(this.addr,e),Yo(i,e)}}function Qo(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(void 0!==e.r)i[0]===e.r&&i[1]===e.g&&i[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(Zo(i,e))return;t.uniform3fv(this.addr,e),Yo(i,e)}}function ts(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(Zo(i,e))return;t.uniform4fv(this.addr,e),Yo(i,e)}}function es(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(Zo(i,e))return;t.uniformMatrix2fv(this.addr,!1,e),Yo(i,e)}else{if(Zo(i,n))return;Ho.set(n),t.uniformMatrix2fv(this.addr,!1,Ho),Yo(i,n)}}function is(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(Zo(i,e))return;t.uniformMatrix3fv(this.addr,!1,e),Yo(i,e)}else{if(Zo(i,n))return;Go.set(n),t.uniformMatrix3fv(this.addr,!1,Go),Yo(i,n)}}function ns(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(Zo(i,e))return;t.uniformMatrix4fv(this.addr,!1,e),Yo(i,e)}else{if(Zo(i,n))return;qo.set(n),t.uniformMatrix4fv(this.addr,!1,qo),Yo(i,n)}}function rs(t,e){const i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function as(t,e){const i=this.cache;Zo(i,e)||(t.uniform2iv(this.addr,e),Yo(i,e))}function os(t,e){const i=this.cache;Zo(i,e)||(t.uniform3iv(this.addr,e),Yo(i,e))}function ss(t,e){const i=this.cache;Zo(i,e)||(t.uniform4iv(this.addr,e),Yo(i,e))}function ls(t,e){const i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function cs(t,e){const i=this.cache;Zo(i,e)||(t.uniform2uiv(this.addr,e),Yo(i,e))}function us(t,e){const i=this.cache;Zo(i,e)||(t.uniform3uiv(this.addr,e),Yo(i,e))}function hs(t,e){const i=this.cache;Zo(i,e)||(t.uniform4uiv(this.addr,e),Yo(i,e))}function ps(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.safeSetTexture2D(e||Fo,r)}function ds(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(e||Uo,r)}function fs(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.safeSetTextureCube(e||$o,r)}function ms(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(e||No,r)}function gs(t,e){t.uniform1fv(this.addr,e)}function _s(t,e){const i=Wo(e,this.size,2);t.uniform2fv(this.addr,i)}function ys(t,e){const i=Wo(e,this.size,3);t.uniform3fv(this.addr,i)}function vs(t,e){const i=Wo(e,this.size,4);t.uniform4fv(this.addr,i)}function xs(t,e){const i=Wo(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function bs(t,e){const i=Wo(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function ws(t,e){const i=Wo(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function Ss(t,e){t.uniform1iv(this.addr,e)}function Es(t,e){t.uniform2iv(this.addr,e)}function Ts(t,e){t.uniform3iv(this.addr,e)}function Ms(t,e){t.uniform4iv(this.addr,e)}function Cs(t,e){t.uniform1uiv(this.addr,e)}function Is(t,e){t.uniform2uiv(this.addr,e)}function As(t,e){t.uniform3uiv(this.addr,e)}function ks(t,e){t.uniform4uiv(this.addr,e)}function Rs(t,e,i){const n=e.length,r=Xo(i,n);t.uniform1iv(this.addr,r);for(let a=0;a!==n;++a)i.safeSetTexture2D(e[a]||Fo,r[a])}function zs(t,e,i){const n=e.length,r=Xo(i,n);t.uniform1iv(this.addr,r);for(let a=0;a!==n;++a)i.safeSetTextureCube(e[a]||$o,r[a])}function Ps(t,e,i){this.id=t,this.addr=i,this.cache=[],this.setValue=function(t){switch(t){case 5126:return Ko;case 35664:return Jo;case 35665:return Qo;case 35666:return ts;case 35674:return es;case 35675:return is;case 35676:return ns;case 5124:case 35670:return rs;case 35667:case 35671:return as;case 35668:case 35672:return os;case 35669:case 35673:return ss;case 5125:return ls;case 36294:return cs;case 36295:return us;case 36296:return hs;case 35678:case 36198:case 36298:case 36306:case 35682:return ps;case 35679:case 36299:case 36307:return ds;case 35680:case 36300:case 36308:case 36293:return fs;case 36289:case 36303:case 36311:case 36292:return ms}}(e.type)}function Ds(t,e,i){this.id=t,this.addr=i,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return gs;case 35664:return _s;case 35665:return ys;case 35666:return vs;case 35674:return xs;case 35675:return bs;case 35676:return ws;case 5124:case 35670:return Ss;case 35667:case 35671:return Es;case 35668:case 35672:return Ts;case 35669:case 35673:return Ms;case 5125:return Cs;case 36294:return Is;case 36295:return As;case 36296:return ks;case 35678:case 36198:case 36298:case 36306:case 35682:return Rs;case 35680:case 36300:case 36308:case 36293:return zs}}(e.type)}function Ls(t){this.id=t,this.seq=[],this.map={}}Ds.prototype.updateCache=function(t){const e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),Yo(e,t)},Ls.prototype.setValue=function(t,e,i){const n=this.seq;for(let r=0,a=n.length;r!==a;++r){const a=n[r];a.setValue(t,e[a.id],i)}};const Bs=/(\w+)(\])?(\[|\.)?/g;function Os(t,e){t.seq.push(e),t.map[e.id]=e}function Fs(t,e,i){const n=t.name,r=n.length;for(Bs.lastIndex=0;;){const a=Bs.exec(n),o=Bs.lastIndex;let s=a[1];const l="]"===a[2],c=a[3];if(l&&(s|=0),void 0===c||"["===c&&o+2===r){Os(i,void 0===c?new Ps(s,t,e):new Ds(s,t,e));break}{let t=i.map[s];void 0===t&&(t=new Ls(s),Os(i,t)),i=t}}}function Ns(t,e){this.seq=[],this.map={};const i=t.getProgramParameter(e,35718);for(let n=0;n<i;++n){const i=t.getActiveUniform(e,n);Fs(i,t.getUniformLocation(e,i.name),this)}}function Us(t,e,i){const n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),n}Ns.prototype.setValue=function(t,e,i,n){const r=this.map[e];void 0!==r&&r.setValue(t,i,n)},Ns.prototype.setOptional=function(t,e,i){const n=e[i];void 0!==n&&this.setValue(t,i,n)},Ns.upload=function(t,e,i,n){for(let r=0,a=e.length;r!==a;++r){const a=e[r],o=i[a.id];!1!==o.needsUpdate&&a.setValue(t,o.value,n)}},Ns.seqWithValue=function(t,e){const i=[];for(let n=0,r=t.length;n!==r;++n){const r=t[n];r.id in e&&i.push(r)}return i};let $s=0;function Vs(t){switch(t){case Ni:return["Linear","( value )"];case Ui:return["sRGB","( value )"];case Vi:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case $i:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function js(t,e,i){const n=t.getShaderParameter(e,35713),r=t.getShaderInfoLog(e).trim();return n&&""===r?"":i.toUpperCase()+"\n\n"+r+"\n\n"+function(t){const e=t.split("\n");for(let i=0;i<e.length;i++)e[i]=i+1+": "+e[i];return e.join("\n")}(t.getShaderSource(e))}function qs(t,e){const i=Vs(e);return"vec4 "+t+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function Gs(t,e){const i=Vs(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function Hs(t,e){let i;switch(e){case 1:i="Linear";break;case 2:i="Reinhard";break;case 3:i="OptimizedCineon";break;case 4:i="ACESFilmic";break;case 5:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function Ws(t){return""!==t}function Zs(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Ys(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Xs=/^[ \t]*#include +<([\w\d./]+)>/gm;function Ks(t){return t.replace(Xs,Js)}function Js(t,e){const i=Ga[e];if(void 0===i)throw new Error("Can not resolve #include <"+e+">");return Ks(i)}const Qs=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,tl=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function el(t){return t.replace(tl,nl).replace(Qs,il)}function il(t,e,i,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),nl(t,e,i,n)}function nl(t,e,i,n){let r="";for(let a=parseInt(e);a<parseInt(i);a++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return r}function rl(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function al(t,e,i,n){const r=t.getContext(),a=i.defines;let o=i.vertexShader,s=i.fragmentShader;const l=function(t){let e="SHADOWMAP_TYPE_BASIC";return 1===t.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===t.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===t.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(i),c=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case di:case fi:e="ENVMAP_TYPE_CUBE";break;case mi:case 307:e="ENVMAP_TYPE_CUBE_UV"}return e}(i),u=function(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case fi:case 307:e="ENVMAP_MODE_REFRACTION"}return e}(i),h=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(i),p=t.gammaFactor>0?t.gammaFactor:1,d=i.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Ws).join("\n")}(i),f=function(t){const e=[];for(const i in t){const n=t[i];!1!==n&&e.push("#define "+i+" "+n)}return e.join("\n")}(a),m=r.createProgram();let g,_,y=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(g=[f].filter(Ws).join("\n"),g.length>0&&(g+="\n"),_=[d,f].filter(Ws).join("\n"),_.length>0&&(_+="\n")):(g=[rl(i),"#define SHADER_NAME "+i.shaderName,f,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+p,"#define MAX_BONES "+i.maxBones,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.morphTargets&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargets&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Ws).join("\n"),_=[d,rl(i),"#define SHADER_NAME "+i.shaderName,f,"#define GAMMA_FACTOR "+p,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+u:"",i.envMap?"#define "+h:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(i.extensionShaderTextureLOD||i.envMap)&&i.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==i.toneMapping?"#define TONE_MAPPING":"",0!==i.toneMapping?Ga.tonemapping_pars_fragment:"",0!==i.toneMapping?Hs("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.format===Ii?"#define OPAQUE":"",Ga.encodings_pars_fragment,i.map?qs("mapTexelToLinear",i.mapEncoding):"",i.matcap?qs("matcapTexelToLinear",i.matcapEncoding):"",i.envMap?qs("envMapTexelToLinear",i.envMapEncoding):"",i.emissiveMap?qs("emissiveMapTexelToLinear",i.emissiveMapEncoding):"",i.specularColorMap?qs("specularColorMapTexelToLinear",i.specularColorMapEncoding):"",i.sheenColorMap?qs("sheenColorMapTexelToLinear",i.sheenColorMapEncoding):"",i.lightMap?qs("lightMapTexelToLinear",i.lightMapEncoding):"",Gs("linearToOutputTexel",i.outputEncoding),i.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(Ws).join("\n")),o=Ks(o),o=Zs(o,i),o=Ys(o,i),s=Ks(s),s=Zs(s,i),s=Ys(s,i),o=el(o),s=el(s),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(y="#version 300 es\n",g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,_=["#define varying in",i.glslVersion===Hi?"":"out highp vec4 pc_fragColor;",i.glslVersion===Hi?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+_);const v=y+_+s,x=Us(r,35633,y+g+o),b=Us(r,35632,v);if(r.attachShader(m,x),r.attachShader(m,b),void 0!==i.index0AttributeName?r.bindAttribLocation(m,0,i.index0AttributeName):!0===i.morphTargets&&r.bindAttribLocation(m,0,"position"),r.linkProgram(m),t.debug.checkShaderErrors){const t=r.getProgramInfoLog(m).trim(),e=r.getShaderInfoLog(x).trim(),i=r.getShaderInfoLog(b).trim();let n=!0,a=!0;if(!1===r.getProgramParameter(m,35714)){n=!1;const e=js(r,x,"vertex"),i=js(r,b,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(m,35715)+"\n\nProgram Info Log: "+t+"\n"+e+"\n"+i)}else""!==t?console.warn("THREE.WebGLProgram: Program Info Log:",t):""!==e&&""!==i||(a=!1);a&&(this.diagnostics={runnable:n,programLog:t,vertexShader:{log:e,prefix:g},fragmentShader:{log:i,prefix:_}})}let w,S;return r.deleteShader(x),r.deleteShader(b),this.getUniforms=function(){return void 0===w&&(w=new Ns(r,m)),w},this.getAttributes=function(){return void 0===S&&(S=function(t,e){const i={},n=t.getProgramParameter(e,35721);for(let r=0;r<n;r++){const n=t.getActiveAttrib(e,r),a=n.name;let o=1;35674===n.type&&(o=2),35675===n.type&&(o=3),35676===n.type&&(o=4),i[a]={type:n.type,location:t.getAttribLocation(e,a),locationSize:o}}return i}(r,m)),S},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(m),this.program=void 0},this.name=i.shaderName,this.id=$s++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=x,this.fragmentShader=b,this}function ol(t,e,i,n,r,a,o){const s=[],l=r.isWebGL2,c=r.logarithmicDepthBuffer,u=r.floatVertexTextures,h=r.maxVertexUniforms,p=r.vertexTextures;let d=r.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},m=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoat","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap",,"roughnessMap","metalnessMap","gradientMap","alphaMap","alphaTest","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","morphTargetsCount","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","format","specularIntensityMap","specularColorMap","specularColorMapEncoding","transmission","transmissionMap","thicknessMap","sheen","sheenColorMap","sheenColorMapEncoding","sheenRoughnessMap"];function g(t){let e;return t&&t.isTexture?e=t.encoding:t&&t.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e=t.texture.encoding):e=Ni,l&&t&&t.isTexture&&t.format===Ai&&t.type===wi&&t.encoding===Ui&&(e=Ni),e}return{getParameters:function(a,s,m,_,y){const v=_.fog,x=a.isMeshStandardMaterial?_.environment:null,b=(a.isMeshStandardMaterial?i:e).get(a.envMap||x),w=f[a.type],S=y.isSkinnedMesh?function(t){const e=t.skeleton.bones;if(u)return 1024;{const t=h,i=Math.floor((t-20)/4),n=Math.min(i,e.length);return n<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+n+"."),0):n}}(y):0;let E,T;if(null!==a.precision&&(d=r.getMaxPrecision(a.precision),d!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",d,"instead.")),w){const t=Wa[w];E=t.vertexShader,T=t.fragmentShader}else E=a.vertexShader,T=a.fragmentShader;const M=t.getRenderTarget(),C=a.alphaTest>0,I=a.clearcoat>0;return{isWebGL2:l,shaderID:w,shaderName:a.type,vertexShader:E,fragmentShader:T,defines:a.defines,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:d,instancing:!0===y.isInstancedMesh,instancingColor:!0===y.isInstancedMesh&&null!==y.instanceColor,supportsVertexTextures:p,outputEncoding:null!==M?g(M.texture):t.outputEncoding,map:!!a.map,mapEncoding:g(a.map),matcap:!!a.matcap,matcapEncoding:g(a.matcap),envMap:!!b,envMapMode:b&&b.mapping,envMapEncoding:g(b),envMapCubeUV:!!b&&(b.mapping===mi||307===b.mapping),lightMap:!!a.lightMap,lightMapEncoding:g(a.lightMap),aoMap:!!a.aoMap,emissiveMap:!!a.emissiveMap,emissiveMapEncoding:g(a.emissiveMap),bumpMap:!!a.bumpMap,normalMap:!!a.normalMap,objectSpaceNormalMap:1===a.normalMapType,tangentSpaceNormalMap:0===a.normalMapType,clearcoat:I,clearcoatMap:I&&!!a.clearcoatMap,clearcoatRoughnessMap:I&&!!a.clearcoatRoughnessMap,clearcoatNormalMap:I&&!!a.clearcoatNormalMap,displacementMap:!!a.displacementMap,roughnessMap:!!a.roughnessMap,metalnessMap:!!a.metalnessMap,specularMap:!!a.specularMap,specularIntensityMap:!!a.specularIntensityMap,specularColorMap:!!a.specularColorMap,specularColorMapEncoding:g(a.specularColorMap),alphaMap:!!a.alphaMap,alphaTest:C,gradientMap:!!a.gradientMap,sheen:a.sheen>0,sheenColorMap:!!a.sheenColorMap,sheenColorMapEncoding:g(a.sheenColorMap),sheenRoughnessMap:!!a.sheenRoughnessMap,transmission:a.transmission>0,transmissionMap:!!a.transmissionMap,thicknessMap:!!a.thicknessMap,combine:a.combine,vertexTangents:!!a.normalMap&&!!y.geometry&&!!y.geometry.attributes.tangent,vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!y.geometry&&!!y.geometry.attributes.color&&4===y.geometry.attributes.color.itemSize,vertexUvs:!!a.map||!!a.bumpMap||!!a.normalMap||!!a.specularMap||!!a.alphaMap||!!a.emissiveMap||!!a.roughnessMap||!!a.metalnessMap||!!a.clearcoatMap||!!a.clearcoatRoughnessMap||!!a.clearcoatNormalMap||!!a.displacementMap||!!a.transmissionMap||!!a.thicknessMap||!!a.specularIntensityMap||!!a.specularColorMap||!!a.sheenColorMap||a.sheenRoughnessMap,uvsVertexOnly:!(a.map||a.bumpMap||a.normalMap||a.specularMap||a.alphaMap||a.emissiveMap||a.roughnessMap||a.metalnessMap||a.clearcoatNormalMap||a.transmission>0||a.transmissionMap||a.thicknessMap||a.specularIntensityMap||a.specularColorMap||!!a.sheen>0||a.sheenColorMap||a.sheenRoughnessMap)&&!!a.displacementMap,fog:!!v,useFog:a.fog,fogExp2:v&&v.isFogExp2,flatShading:!!a.flatShading,sizeAttenuation:a.sizeAttenuation,logarithmicDepthBuffer:c,skinning:!0===y.isSkinnedMesh&&S>0,maxBones:S,useVertexTexture:u,morphTargets:!!y.geometry&&!!y.geometry.morphAttributes.position,morphNormals:!!y.geometry&&!!y.geometry.morphAttributes.normal,morphTargetsCount:y.geometry&&y.geometry.morphAttributes.position?y.geometry.morphAttributes.position.length:0,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,format:a.format,dithering:a.dithering,shadowMapEnabled:t.shadowMap.enabled&&m.length>0,shadowMapType:t.shadowMap.type,toneMapping:a.toneMapped?t.toneMapping:0,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:a.premultipliedAlpha,doubleSided:2===a.side,flipSided:1===a.side,depthPacking:void 0!==a.depthPacking&&a.depthPacking,index0AttributeName:a.index0AttributeName,extensionDerivatives:a.extensions&&a.extensions.derivatives,extensionFragDepth:a.extensions&&a.extensions.fragDepth,extensionDrawBuffers:a.extensions&&a.extensions.drawBuffers,extensionShaderTextureLOD:a.extensions&&a.extensions.shaderTextureLOD,rendererExtensionFragDepth:l||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:l||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:l||n.has("EXT_shader_texture_lod"),customProgramCacheKey:a.customProgramCacheKey()}},getProgramCacheKey:function(e){const i=[];if(e.shaderID?i.push(e.shaderID):(i.push(hn(e.fragmentShader)),i.push(hn(e.vertexShader))),void 0!==e.defines)for(const t in e.defines)i.push(t),i.push(e.defines[t]);if(!1===e.isRawShaderMaterial){for(let t=0;t<m.length;t++)i.push(e[m[t]]);i.push(t.outputEncoding),i.push(t.gammaFactor)}return i.push(e.customProgramCacheKey),i.join()},getUniforms:function(t){const e=f[t.type];let i;if(e){const t=Wa[e];i=Ca.clone(t.uniforms)}else i=t.uniforms;return i},acquireProgram:function(e,i){let n;for(let t=0,r=s.length;t<r;t++){const e=s[t];if(e.cacheKey===i){n=e,++n.usedTimes;break}}return void 0===n&&(n=new al(t,i,e,a),s.push(n)),n},releaseProgram:function(t){if(0===--t.usedTimes){const e=s.indexOf(t);s[e]=s[s.length-1],s.pop(),t.destroy()}},programs:s}}function sl(){let t=new WeakMap;return{get:function(e){let i=t.get(e);return void 0===i&&(i={},t.set(e,i)),i},remove:function(e){t.delete(e)},update:function(e,i,n){t.get(e)[i]=n},dispose:function(){t=new WeakMap}}}function ll(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function cl(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function ul(t){const e=[];let i=0;const n=[],r=[],a=[],o={id:-1};function s(n,r,a,s,l,c){let u=e[i];const h=t.get(a);return void 0===u?(u={id:n.id,object:n,geometry:r,material:a,program:h.program||o,groupOrder:s,renderOrder:n.renderOrder,z:l,group:c},e[i]=u):(u.id=n.id,u.object=n,u.geometry=r,u.material=a,u.program=h.program||o,u.groupOrder=s,u.renderOrder=n.renderOrder,u.z=l,u.group=c),i++,u}return{opaque:n,transmissive:r,transparent:a,init:function(){i=0,n.length=0,r.length=0,a.length=0},push:function(t,e,i,o,l,c){const u=s(t,e,i,o,l,c);i.transmission>0?r.push(u):!0===i.transparent?a.push(u):n.push(u)},unshift:function(t,e,i,o,l,c){const u=s(t,e,i,o,l,c);i.transmission>0?r.unshift(u):!0===i.transparent?a.unshift(u):n.unshift(u)},finish:function(){for(let t=i,n=e.length;t<n;t++){const i=e[t];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.program=null,i.group=null}},sort:function(t,e){n.length>1&&n.sort(t||ll),r.length>1&&r.sort(e||cl),a.length>1&&a.sort(e||cl)}}}function hl(t){let e=new WeakMap;return{get:function(i,n){let r;return!1===e.has(i)?(r=new ul(t),e.set(i,[r])):n>=e.get(i).length?(r=new ul(t),e.get(i).push(r)):r=e.get(i)[n],r},dispose:function(){e=new WeakMap}}}function pl(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new bn,color:new jr};break;case"SpotLight":i={position:new bn,direction:new bn,color:new jr,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new bn,color:new jr,distance:0,decay:0};break;case"HemisphereLight":i={direction:new bn,skyColor:new jr,groundColor:new jr};break;case"RectAreaLight":i={color:new jr,position:new bn,halfWidth:new bn,halfHeight:new bn}}return t[e.id]=i,i}}}let dl=0;function fl(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function ml(t,e){const i=new pl,n=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new sn};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new sn,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=i,i}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let l=0;l<9;l++)r.probe.push(new bn);const a=new bn,o=new Jn,s=new Jn;return{setup:function(a,o){let s=0,l=0,c=0;for(let t=0;t<9;t++)r.probe[t].set(0,0,0);let u=0,h=0,p=0,d=0,f=0,m=0,g=0,_=0;a.sort(fl);const y=!0!==o?Math.PI:1;for(let t=0,e=a.length;t<e;t++){const e=a[t],o=e.color,v=e.intensity,x=e.distance,b=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)s+=o.r*v*y,l+=o.g*v*y,c+=o.b*v*y;else if(e.isLightProbe)for(let t=0;t<9;t++)r.probe[t].addScaledVector(e.sh.coefficients[t],v);else if(e.isDirectionalLight){const t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*y),e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,r.directionalShadow[u]=i,r.directionalShadowMap[u]=b,r.directionalShadowMatrix[u]=e.shadow.matrix,m++}r.directional[u]=t,u++}else if(e.isSpotLight){const t=i.get(e);if(t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(o).multiplyScalar(v*y),t.distance=x,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,r.spotShadow[p]=i,r.spotShadowMap[p]=b,r.spotShadowMatrix[p]=e.shadow.matrix,_++}r.spot[p]=t,p++}else if(e.isRectAreaLight){const t=i.get(e);t.color.copy(o).multiplyScalar(v),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),r.rectArea[d]=t,d++}else if(e.isPointLight){const t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*y),t.distance=e.distance,t.decay=e.decay,e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,i.shadowCameraNear=t.camera.near,i.shadowCameraFar=t.camera.far,r.pointShadow[h]=i,r.pointShadowMap[h]=b,r.pointShadowMatrix[h]=e.shadow.matrix,g++}r.point[h]=t,h++}else if(e.isHemisphereLight){const t=i.get(e);t.skyColor.copy(e.color).multiplyScalar(v*y),t.groundColor.copy(e.groundColor).multiplyScalar(v*y),r.hemi[f]=t,f++}}d>0&&(e.isWebGL2||!0===t.has("OES_texture_float_linear")?(r.rectAreaLTC1=Ha.LTC_FLOAT_1,r.rectAreaLTC2=Ha.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=Ha.LTC_HALF_1,r.rectAreaLTC2=Ha.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=s,r.ambient[1]=l,r.ambient[2]=c;const v=r.hash;v.directionalLength===u&&v.pointLength===h&&v.spotLength===p&&v.rectAreaLength===d&&v.hemiLength===f&&v.numDirectionalShadows===m&&v.numPointShadows===g&&v.numSpotShadows===_||(r.directional.length=u,r.spot.length=p,r.rectArea.length=d,r.point.length=h,r.hemi.length=f,r.directionalShadow.length=m,r.directionalShadowMap.length=m,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=_,r.spotShadowMap.length=_,r.directionalShadowMatrix.length=m,r.pointShadowMatrix.length=g,r.spotShadowMatrix.length=_,v.directionalLength=u,v.pointLength=h,v.spotLength=p,v.rectAreaLength=d,v.hemiLength=f,v.numDirectionalShadows=m,v.numPointShadows=g,v.numSpotShadows=_,r.version=dl++)},setupView:function(t,e){let i=0,n=0,l=0,c=0,u=0;const h=e.matrixWorldInverse;for(let p=0,d=t.length;p<d;p++){const e=t[p];if(e.isDirectionalLight){const t=r.directional[i];t.direction.setFromMatrixPosition(e.matrixWorld),a.setFromMatrixPosition(e.target.matrixWorld),t.direction.sub(a),t.direction.transformDirection(h),i++}else if(e.isSpotLight){const t=r.spot[l];t.position.setFromMatrixPosition(e.matrixWorld),t.position.applyMatrix4(h),t.direction.setFromMatrixPosition(e.matrixWorld),a.setFromMatrixPosition(e.target.matrixWorld),t.direction.sub(a),t.direction.transformDirection(h),l++}else if(e.isRectAreaLight){const t=r.rectArea[c];t.position.setFromMatrixPosition(e.matrixWorld),t.position.applyMatrix4(h),s.identity(),o.copy(e.matrixWorld),o.premultiply(h),s.extractRotation(o),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),t.halfWidth.applyMatrix4(s),t.halfHeight.applyMatrix4(s),c++}else if(e.isPointLight){const t=r.point[n];t.position.setFromMatrixPosition(e.matrixWorld),t.position.applyMatrix4(h),n++}else if(e.isHemisphereLight){const t=r.hemi[u];t.direction.setFromMatrixPosition(e.matrixWorld),t.direction.transformDirection(h),t.direction.normalize(),u++}}},state:r}}function gl(t,e){const i=new ml(t,e),n=[],r=[];return{init:function(){n.length=0,r.length=0},state:{lightsArray:n,shadowsArray:r,lights:i},setupLights:function(t){i.setup(n,t)},setupLightsView:function(t){i.setupView(n,t)},pushLight:function(t){n.push(t)},pushShadow:function(t){r.push(t)}}}function _l(t,e){let i=new WeakMap;return{get:function(n,r=0){let a;return!1===i.has(n)?(a=new gl(t,e),i.set(n,[a])):r>=i.get(n).length?(a=new gl(t,e),i.get(n).push(a)):a=i.get(n)[r],a},dispose:function(){i=new WeakMap}}}class yl extends Br{constructor(t){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}yl.prototype.isMeshDepthMaterial=!0;class vl extends Br{constructor(t){super(),this.type="MeshDistanceMaterial",this.referencePosition=new bn,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}vl.prototype.isMeshDistanceMaterial=!0;function xl(t,e,i){let n=new $a;const r=new sn,a=new sn,o=new _n,s=new yl({depthPacking:3201}),l=new vl,c={},u=i.maxTextureSize,h={0:1,1:0,2:2},p=new Ia({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new sn},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),d=p.clone();d.defines.HORIZONTAL_PASS=1;const f=new ra;f.setAttribute("position",new Wr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new wa(f,p),g=this;function _(i,n){const r=e.update(m);p.defines.VSM_SAMPLES!==i.blurSamples&&(p.defines.VSM_SAMPLES=i.blurSamples,d.defines.VSM_SAMPLES=i.blurSamples,p.needsUpdate=!0,d.needsUpdate=!0),p.uniforms.shadow_pass.value=i.map.texture,p.uniforms.resolution.value=i.mapSize,p.uniforms.radius.value=i.radius,t.setRenderTarget(i.mapPass),t.clear(),t.renderBufferDirect(n,null,r,p,m,null),d.uniforms.shadow_pass.value=i.mapPass.texture,d.uniforms.resolution.value=i.mapSize,d.uniforms.radius.value=i.radius,t.setRenderTarget(i.map),t.clear(),t.renderBufferDirect(n,null,r,d,m,null)}function y(e,i,n,r,a,o,u){let p=null;const d=!0===r.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(p=void 0!==d?d:!0===r.isPointLight?l:s,t.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0){const t=p.uuid,e=n.uuid;let i=c[t];void 0===i&&(i={},c[t]=i);let r=i[e];void 0===r&&(r=p.clone(),i[e]=r),p=r}return p.visible=n.visible,p.wireframe=n.wireframe,p.side=3===u?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:h[n.side],p.alphaMap=n.alphaMap,p.alphaTest=n.alphaTest,p.clipShadows=n.clipShadows,p.clippingPlanes=n.clippingPlanes,p.clipIntersection=n.clipIntersection,p.displacementMap=n.displacementMap,p.displacementScale=n.displacementScale,p.displacementBias=n.displacementBias,p.wireframeLinewidth=n.wireframeLinewidth,p.linewidth=n.linewidth,!0===r.isPointLight&&!0===p.isMeshDistanceMaterial&&(p.referencePosition.setFromMatrixPosition(r.matrixWorld),p.nearDistance=a,p.farDistance=o),p}function v(i,r,a,o,s){if(!1===i.visible)return;if(i.layers.test(r.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&3===s)&&(!i.frustumCulled||n.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,i.matrixWorld);const n=e.update(i),r=i.material;if(Array.isArray(r)){const e=n.groups;for(let l=0,c=e.length;l<c;l++){const c=e[l],u=r[c.materialIndex];if(u&&u.visible){const e=y(i,0,u,o,a.near,a.far,s);t.renderBufferDirect(a,null,n,e,i,c)}}}else if(r.visible){const e=y(i,0,r,o,a.near,a.far,s);t.renderBufferDirect(a,null,n,e,i,null)}}const l=i.children;for(let t=0,e=l.length;t<e;t++)v(l[t],r,a,o,s)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(e,i,s){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===e.length)return;const l=t.getRenderTarget(),c=t.getActiveCubeFace(),h=t.getActiveMipmapLevel(),p=t.state;p.setBlending(0),p.buffers.color.setClear(1,1,1,1),p.buffers.depth.setTest(!0),p.setScissorTest(!1);for(let d=0,f=e.length;d<f;d++){const l=e[d],c=l.shadow;if(void 0===c){console.warn("THREE.WebGLShadowMap:",l,"has no shadow.");continue}if(!1===c.autoUpdate&&!1===c.needsUpdate)continue;r.copy(c.mapSize);const h=c.getFrameExtents();if(r.multiply(h),a.copy(c.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(a.x=Math.floor(u/h.x),r.x=a.x*h.x,c.mapSize.x=a.x),r.y>u&&(a.y=Math.floor(u/h.y),r.y=a.y*h.y,c.mapSize.y=a.y)),null===c.map&&!c.isPointLightShadow&&3===this.type){const t={minFilter:xi,magFilter:xi,format:Ai};c.map=new yn(r.x,r.y,t),c.map.texture.name=l.name+".shadowMap",c.mapPass=new yn(r.x,r.y,t),c.camera.updateProjectionMatrix()}if(null===c.map){const t={minFilter:vi,magFilter:vi,format:Ai};c.map=new yn(r.x,r.y,t),c.map.texture.name=l.name+".shadowMap",c.camera.updateProjectionMatrix()}t.setRenderTarget(c.map),t.clear();const f=c.getViewportCount();for(let t=0;t<f;t++){const e=c.getViewport(t);o.set(a.x*e.x,a.y*e.y,a.x*e.z,a.y*e.w),p.viewport(o),c.updateMatrices(l,t),n=c.getFrustum(),v(i,s,c.camera,l,this.type)}c.isPointLightShadow||3!==this.type||_(c,s),c.needsUpdate=!1}g.needsUpdate=!1,t.setRenderTarget(l,c,h)}}function bl(t,e,i){const n=i.isWebGL2;const r=new function(){let e=!1;const i=new _n;let n=null;const r=new _n(0,0,0,0);return{setMask:function(i){n===i||e||(t.colorMask(i,i,i,i),n=i)},setLocked:function(t){e=t},setClear:function(e,n,a,o,s){!0===s&&(e*=o,n*=o,a*=o),i.set(e,n,a,o),!1===r.equals(i)&&(t.clearColor(e,n,a,o),r.copy(i))},reset:function(){e=!1,n=null,r.set(-1,0,0,0)}}},a=new function(){let e=!1,i=null,n=null,r=null;return{setTest:function(t){t?O(2929):F(2929)},setMask:function(n){i===n||e||(t.depthMask(n),i=n)},setFunc:function(e){if(n!==e){if(e)switch(e){case 0:t.depthFunc(512);break;case 1:t.depthFunc(519);break;case 2:t.depthFunc(513);break;case 3:default:t.depthFunc(515);break;case 4:t.depthFunc(514);break;case 5:t.depthFunc(518);break;case 6:t.depthFunc(516);break;case 7:t.depthFunc(517)}else t.depthFunc(515);n=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1,i=null,n=null,r=null}}},o=new function(){let e=!1,i=null,n=null,r=null,a=null,o=null,s=null,l=null,c=null;return{setTest:function(t){e||(t?O(2960):F(2960))},setMask:function(n){i===n||e||(t.stencilMask(n),i=n)},setFunc:function(e,i,o){n===e&&r===i&&a===o||(t.stencilFunc(e,i,o),n=e,r=i,a=o)},setOp:function(e,i,n){o===e&&s===i&&l===n||(t.stencilOp(e,i,n),o=e,s=i,l=n)},setLocked:function(t){e=t},setClear:function(e){c!==e&&(t.clearStencil(e),c=e)},reset:function(){e=!1,i=null,n=null,r=null,a=null,o=null,s=null,l=null,c=null}}};let s={},l=null,c={},u=null,h=!1,p=null,d=null,f=null,m=null,g=null,_=null,y=null,v=!1,x=null,b=null,w=null,S=null,E=null;const T=t.getParameter(35661);let M=!1,C=0;const I=t.getParameter(7938);-1!==I.indexOf("WebGL")?(C=parseFloat(/^WebGL (\d)/.exec(I)[1]),M=C>=1):-1!==I.indexOf("OpenGL ES")&&(C=parseFloat(/^OpenGL ES (\d)/.exec(I)[1]),M=C>=2);let A=null,k={};const R=t.getParameter(3088),z=t.getParameter(2978),P=(new _n).fromArray(R),D=(new _n).fromArray(z);function L(e,i,n){const r=new Uint8Array(4),a=t.createTexture();t.bindTexture(e,a),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(let o=0;o<n;o++)t.texImage2D(i+o,0,6408,1,1,0,6408,5121,r);return a}const B={};function O(e){!0!==s[e]&&(t.enable(e),s[e]=!0)}function F(e){!1!==s[e]&&(t.disable(e),s[e]=!1)}B[3553]=L(3553,3553,1),B[34067]=L(34067,34069,6),r.setClear(0,0,0,1),a.setClear(1),o.setClear(0),O(2929),a.setFunc(3),V(!1),j(1),O(2884),$(0);const N={[pi]:32774,101:32778,102:32779};if(n)N[103]=32775,N[104]=32776;else{const t=e.get("EXT_blend_minmax");null!==t&&(N[103]=t.MIN_EXT,N[104]=t.MAX_EXT)}const U={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function $(e,i,n,r,a,o,s,l){if(0!==e){if(!1===h&&(O(3042),h=!0),5===e)a=a||i,o=o||n,s=s||r,i===d&&a===g||(t.blendEquationSeparate(N[i],N[a]),d=i,g=a),n===f&&r===m&&o===_&&s===y||(t.blendFuncSeparate(U[n],U[r],U[o],U[s]),f=n,m=r,_=o,y=s),p=e,v=null;else if(e!==p||l!==v){if(d===pi&&g===pi||(t.blendEquation(32774),d=pi,g=pi),l)switch(e){case 1:t.blendFuncSeparate(1,771,1,771);break;case 2:t.blendFunc(1,1);break;case 3:t.blendFuncSeparate(0,0,769,771);break;case 4:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(770,771,1,771);break;case 2:t.blendFunc(770,1);break;case 3:t.blendFunc(0,769);break;case 4:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}f=null,m=null,_=null,y=null,p=e,v=l}}else!0===h&&(F(3042),h=!1)}function V(e){x!==e&&(e?t.frontFace(2304):t.frontFace(2305),x=e)}function j(e){0!==e?(O(2884),e!==b&&(1===e?t.cullFace(1029):2===e?t.cullFace(1028):t.cullFace(1032))):F(2884),b=e}function q(e,i,n){e?(O(32823),S===i&&E===n||(t.polygonOffset(i,n),S=i,E=n)):F(32823)}function G(e){void 0===e&&(e=33984+T-1),A!==e&&(t.activeTexture(e),A=e)}return{buffers:{color:r,depth:a,stencil:o},enable:O,disable:F,bindFramebuffer:function(e,i){return null===i&&null!==l&&(i=l),c[e]!==i&&(t.bindFramebuffer(e,i),c[e]=i,n&&(36009===e&&(c[36160]=i),36160===e&&(c[36009]=i)),!0)},bindXRFramebuffer:function(e){e!==l&&(t.bindFramebuffer(36160,e),l=e)},useProgram:function(e){return u!==e&&(t.useProgram(e),u=e,!0)},setBlending:$,setMaterial:function(t,e){2===t.side?F(2884):O(2884);let i=1===t.side;e&&(i=!i),V(i),1===t.blending&&!1===t.transparent?$(0):$(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),a.setFunc(t.depthFunc),a.setTest(t.depthTest),a.setMask(t.depthWrite),r.setMask(t.colorWrite);const n=t.stencilWrite;o.setTest(n),n&&(o.setMask(t.stencilWriteMask),o.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),o.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),q(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?O(32926):F(32926)},setFlipSided:V,setCullFace:j,setLineWidth:function(e){e!==w&&(M&&t.lineWidth(e),w=e)},setPolygonOffset:q,setScissorTest:function(t){t?O(3089):F(3089)},activeTexture:G,bindTexture:function(e,i){null===A&&G();let n=k[A];void 0===n&&(n={type:void 0,texture:void 0},k[A]=n),n.type===e&&n.texture===i||(t.bindTexture(e,i||B[e]),n.type=e,n.texture=i)},unbindTexture:function(){const e=k[A];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(e){!1===P.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),P.copy(e))},viewport:function(e){!1===D.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),D.copy(e))},reset:function(){t.disable(3042),t.disable(2884),t.disable(2929),t.disable(32823),t.disable(3089),t.disable(2960),t.disable(32926),t.blendEquation(32774),t.blendFunc(1,0),t.blendFuncSeparate(1,0,1,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(513),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(519,0,4294967295),t.stencilOp(7680,7680,7680),t.clearStencil(0),t.cullFace(1029),t.frontFace(2305),t.polygonOffset(0,0),t.activeTexture(33984),t.bindFramebuffer(36160,null),!0===n&&(t.bindFramebuffer(36009,null),t.bindFramebuffer(36008,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),s={},A=null,k={},l=null,c={},u=null,h=!1,p=null,d=null,f=null,m=null,g=null,_=null,y=null,v=!1,x=null,b=null,w=null,S=null,E=null,P.set(0,0,t.canvas.width,t.canvas.height),D.set(0,0,t.canvas.width,t.canvas.height),r.reset(),a.reset(),o.reset()}}}function wl(t,e,i,n,r,a,o){const s=r.isWebGL2,l=r.maxTextures,c=r.maxCubemapSize,u=r.maxTextureSize,h=r.maxSamples,p=new WeakMap;let d,f=!1;try{f="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(kx){}function m(t,e){return f?new OffscreenCanvas(t,e):un("canvas")}function g(t,e,i,n){let r=1;if((t.width>n||t.height>n)&&(r=n/Math.max(t.width,t.height)),r<1||!0===e){if("undefined"!==typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&t instanceof ImageBitmap){const n=e?an:Math.floor,a=n(r*t.width),o=n(r*t.height);void 0===d&&(d=m(a,o));const s=i?m(a,o):d;s.width=a,s.height=o;return s.getContext("2d").drawImage(t,0,0,a,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+a+"x"+o+")."),s}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function _(t){return rn(t.width)&&rn(t.height)}function y(t,e){return t.generateMipmaps&&e&&t.minFilter!==vi&&t.minFilter!==xi}function v(e,i,r,a,o=1){t.generateMipmap(e);n.get(i).__maxMipLevel=Math.log2(Math.max(r,a,o))}function x(i,n,r,a){if(!1===s)return n;if(null!==i){if(void 0!==t[i])return t[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let o=n;return 6403===n&&(5126===r&&(o=33326),5131===r&&(o=33325),5121===r&&(o=33321)),6407===n&&(5126===r&&(o=34837),5131===r&&(o=34843),5121===r&&(o=32849)),6408===n&&(5126===r&&(o=34836),5131===r&&(o=34842),5121===r&&(o=a===Ui?35907:32856)),33325!==o&&33326!==o&&34842!==o&&34836!==o||e.get("EXT_color_buffer_float"),o}function b(t){return t===vi||1004===t||1005===t?9728:9729}function w(e){const i=e.target;i.removeEventListener("dispose",w),function(e){const i=n.get(e);if(void 0===i.__webglInit)return;t.deleteTexture(i.__webglTexture),n.remove(e)}(i),i.isVideoTexture&&p.delete(i),o.memory.textures--}function S(e){const i=e.target;i.removeEventListener("dispose",S),function(e){const i=e.texture,r=n.get(e),a=n.get(i);if(!e)return;void 0!==a.__webglTexture&&(t.deleteTexture(a.__webglTexture),o.memory.textures--);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(let n=0;n<6;n++)t.deleteFramebuffer(r.__webglFramebuffer[n]),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer[n]);else t.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&t.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer&&t.deleteRenderbuffer(r.__webglColorRenderbuffer),r.__webglDepthRenderbuffer&&t.deleteRenderbuffer(r.__webglDepthRenderbuffer);if(e.isWebGLMultipleRenderTargets)for(let s=0,l=i.length;s<l;s++){const e=n.get(i[s]);e.__webglTexture&&(t.deleteTexture(e.__webglTexture),o.memory.textures--),n.remove(i[s])}n.remove(i),n.remove(e)}(i)}let E=0;function T(t,e){const r=n.get(t);if(t.isVideoTexture&&function(t){const e=o.render.frame;p.get(t)!==e&&(p.set(t,e),t.update())}(t),t.version>0&&r.__version!==t.version){const i=t.image;if(void 0===i)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==i.complete)return void R(r,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.activeTexture(33984+e),i.bindTexture(3553,r.__webglTexture)}function M(e,r){const o=n.get(e);e.version>0&&o.__version!==e.version?function(e,n,r){if(6!==n.image.length)return;k(e,n),i.activeTexture(33984+r),i.bindTexture(34067,e.__webglTexture),t.pixelStorei(37440,n.flipY),t.pixelStorei(37441,n.premultiplyAlpha),t.pixelStorei(3317,n.unpackAlignment),t.pixelStorei(37443,0);const o=n&&(n.isCompressedTexture||n.image[0].isCompressedTexture),l=n.image[0]&&n.image[0].isDataTexture,u=[];for(let t=0;t<6;t++)u[t]=o||l?l?n.image[t].image:n.image[t]:g(n.image[t],!1,!0,c);const h=u[0],p=_(h)||s,d=a.convert(n.format),f=a.convert(n.type),m=x(n.internalFormat,d,f,n.encoding);let b;if(A(34067,n,p),o){for(let t=0;t<6;t++){b=u[t].mipmaps;for(let e=0;e<b.length;e++){const r=b[e];n.format!==Ai&&n.format!==Ii?null!==d?i.compressedTexImage2D(34069+t,e,m,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(34069+t,e,m,r.width,r.height,0,d,f,r.data)}}e.__maxMipLevel=b.length-1}else{b=n.mipmaps;for(let t=0;t<6;t++)if(l){i.texImage2D(34069+t,0,m,u[t].width,u[t].height,0,d,f,u[t].data);for(let e=0;e<b.length;e++){const n=b[e].image[t].image;i.texImage2D(34069+t,e+1,m,n.width,n.height,0,d,f,n.data)}}else{i.texImage2D(34069+t,0,m,d,f,u[t]);for(let e=0;e<b.length;e++){const n=b[e];i.texImage2D(34069+t,e+1,m,d,f,n.image[t])}}e.__maxMipLevel=b.length}y(n,p)&&v(34067,n,h.width,h.height);e.__version=n.version,n.onUpdate&&n.onUpdate(n)}(o,e,r):(i.activeTexture(33984+r),i.bindTexture(34067,o.__webglTexture))}const C={[gi]:10497,[_i]:33071,[yi]:33648},I={[vi]:9728,1004:9984,1005:9986,[xi]:9729,1007:9985,[bi]:9987};function A(i,a,o){if(o?(t.texParameteri(i,10242,C[a.wrapS]),t.texParameteri(i,10243,C[a.wrapT]),32879!==i&&35866!==i||t.texParameteri(i,32882,C[a.wrapR]),t.texParameteri(i,10240,I[a.magFilter]),t.texParameteri(i,10241,I[a.minFilter])):(t.texParameteri(i,10242,33071),t.texParameteri(i,10243,33071),32879!==i&&35866!==i||t.texParameteri(i,32882,33071),a.wrapS===_i&&a.wrapT===_i||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(i,10240,b(a.magFilter)),t.texParameteri(i,10241,b(a.minFilter)),a.minFilter!==vi&&a.minFilter!==xi&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===e.has("EXT_texture_filter_anisotropic")){const o=e.get("EXT_texture_filter_anisotropic");if(a.type===Ti&&!1===e.has("OES_texture_float_linear"))return;if(!1===s&&a.type===Mi&&!1===e.has("OES_texture_half_float_linear"))return;(a.anisotropy>1||n.get(a).__currentAnisotropy)&&(t.texParameterf(i,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,r.getMaxAnisotropy())),n.get(a).__currentAnisotropy=a.anisotropy)}}function k(e,i){void 0===e.__webglInit&&(e.__webglInit=!0,i.addEventListener("dispose",w),e.__webglTexture=t.createTexture(),o.memory.textures++)}function R(e,n,r){let o=3553;n.isDataTexture2DArray&&(o=35866),n.isDataTexture3D&&(o=32879),k(e,n),i.activeTexture(33984+r),i.bindTexture(o,e.__webglTexture),t.pixelStorei(37440,n.flipY),t.pixelStorei(37441,n.premultiplyAlpha),t.pixelStorei(3317,n.unpackAlignment),t.pixelStorei(37443,0);const l=function(t){return!s&&(t.wrapS!==_i||t.wrapT!==_i||t.minFilter!==vi&&t.minFilter!==xi)}(n)&&!1===_(n.image),c=g(n.image,l,!1,u),h=_(c)||s,p=a.convert(n.format);let d,f=a.convert(n.type),m=x(n.internalFormat,p,f,n.encoding);A(o,n,h);const b=n.mipmaps;if(n.isDepthTexture)m=6402,s?m=n.type===Ti?36012:n.type===Ei?33190:n.type===Ci?35056:33189:n.type===Ti&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),n.format===ki&&6402===m&&n.type!==Si&&n.type!==Ei&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=Si,f=a.convert(n.type)),n.format===Ri&&6402===m&&(m=34041,n.type!==Ci&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=Ci,f=a.convert(n.type))),i.texImage2D(3553,0,m,c.width,c.height,0,p,f,null);else if(n.isDataTexture)if(b.length>0&&h){for(let t=0,e=b.length;t<e;t++)d=b[t],i.texImage2D(3553,t,m,d.width,d.height,0,p,f,d.data);n.generateMipmaps=!1,e.__maxMipLevel=b.length-1}else i.texImage2D(3553,0,m,c.width,c.height,0,p,f,c.data),e.__maxMipLevel=0;else if(n.isCompressedTexture){for(let t=0,e=b.length;t<e;t++)d=b[t],n.format!==Ai&&n.format!==Ii?null!==p?i.compressedTexImage2D(3553,t,m,d.width,d.height,0,d.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(3553,t,m,d.width,d.height,0,p,f,d.data);e.__maxMipLevel=b.length-1}else if(n.isDataTexture2DArray)i.texImage3D(35866,0,m,c.width,c.height,c.depth,0,p,f,c.data),e.__maxMipLevel=0;else if(n.isDataTexture3D)i.texImage3D(32879,0,m,c.width,c.height,c.depth,0,p,f,c.data),e.__maxMipLevel=0;else if(b.length>0&&h){for(let t=0,e=b.length;t<e;t++)d=b[t],i.texImage2D(3553,t,m,p,f,d);n.generateMipmaps=!1,e.__maxMipLevel=b.length-1}else i.texImage2D(3553,0,m,p,f,c),e.__maxMipLevel=0;y(n,h)&&v(o,n,c.width,c.height),e.__version=n.version,n.onUpdate&&n.onUpdate(n)}function z(e,r,o,s,l){const c=a.convert(o.format),u=a.convert(o.type),h=x(o.internalFormat,c,u,o.encoding);32879===l||35866===l?i.texImage3D(l,0,h,r.width,r.height,r.depth,0,c,u,null):i.texImage2D(l,0,h,r.width,r.height,0,c,u,null),i.bindFramebuffer(36160,e),t.framebufferTexture2D(36160,s,l,n.get(o).__webglTexture,0),i.bindFramebuffer(36160,null)}function P(e,i,n){if(t.bindRenderbuffer(36161,e),i.depthBuffer&&!i.stencilBuffer){let r=33189;if(n){const e=i.depthTexture;e&&e.isDepthTexture&&(e.type===Ti?r=36012:e.type===Ei&&(r=33190));const n=L(i);t.renderbufferStorageMultisample(36161,n,r,i.width,i.height)}else t.renderbufferStorage(36161,r,i.width,i.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(i.depthBuffer&&i.stencilBuffer){if(n){const e=L(i);t.renderbufferStorageMultisample(36161,e,35056,i.width,i.height)}else t.renderbufferStorage(36161,34041,i.width,i.height);t.framebufferRenderbuffer(36160,33306,36161,e)}else{const e=!0===i.isWebGLMultipleRenderTargets?i.texture[0]:i.texture,r=a.convert(e.format),o=a.convert(e.type),s=x(e.internalFormat,r,o,e.encoding);if(n){const e=L(i);t.renderbufferStorageMultisample(36161,e,s,i.width,i.height)}else t.renderbufferStorage(36161,s,i.width,i.height)}t.bindRenderbuffer(36161,null)}function D(e){const r=n.get(e),a=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture){if(a)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),T(r.depthTexture,0);const a=n.get(r.depthTexture).__webglTexture;if(r.depthTexture.format===ki)t.framebufferTexture2D(36160,36096,3553,a,0);else{if(r.depthTexture.format!==Ri)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(36160,33306,3553,a,0)}}(r.__webglFramebuffer,e)}else if(a){r.__webglDepthbuffer=[];for(let n=0;n<6;n++)i.bindFramebuffer(36160,r.__webglFramebuffer[n]),r.__webglDepthbuffer[n]=t.createRenderbuffer(),P(r.__webglDepthbuffer[n],e,!1)}else i.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=t.createRenderbuffer(),P(r.__webglDepthbuffer,e,!1);i.bindFramebuffer(36160,null)}function L(t){return s&&t.isWebGLMultisampleRenderTarget?Math.min(h,t.samples):0}let B=!1,O=!1;this.allocateTextureUnit=function(){const t=E;return t>=l&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+l),E+=1,t},this.resetTextureUnits=function(){E=0},this.setTexture2D=T,this.setTexture2DArray=function(t,e){const r=n.get(t);t.version>0&&r.__version!==t.version?R(r,t,e):(i.activeTexture(33984+e),i.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(t,e){const r=n.get(t);t.version>0&&r.__version!==t.version?R(r,t,e):(i.activeTexture(33984+e),i.bindTexture(32879,r.__webglTexture))},this.setTextureCube=M,this.setupRenderTarget=function(e){const l=e.texture,c=n.get(e),u=n.get(l);e.addEventListener("dispose",S),!0!==e.isWebGLMultipleRenderTargets&&(u.__webglTexture=t.createTexture(),u.__version=l.version,o.memory.textures++);const h=!0===e.isWebGLCubeRenderTarget,p=!0===e.isWebGLMultipleRenderTargets,d=!0===e.isWebGLMultisampleRenderTarget,f=l.isDataTexture3D||l.isDataTexture2DArray,m=_(e)||s;if(!s||l.format!==Ii||l.type!==Ti&&l.type!==Mi||(l.format=Ai,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),h){c.__webglFramebuffer=[];for(let e=0;e<6;e++)c.__webglFramebuffer[e]=t.createFramebuffer()}else if(c.__webglFramebuffer=t.createFramebuffer(),p)if(r.drawBuffers){const i=e.texture;for(let e=0,r=i.length;e<r;e++){const r=n.get(i[e]);void 0===r.__webglTexture&&(r.__webglTexture=t.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(d)if(s){c.__webglMultisampledFramebuffer=t.createFramebuffer(),c.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,c.__webglColorRenderbuffer);const n=a.convert(l.format),r=a.convert(l.type),o=x(l.internalFormat,n,r,l.encoding),s=L(e);t.renderbufferStorageMultisample(36161,s,o,e.width,e.height),i.bindFramebuffer(36160,c.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,c.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(c.__webglDepthRenderbuffer=t.createRenderbuffer(),P(c.__webglDepthRenderbuffer,e,!0)),i.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(h){i.bindTexture(34067,u.__webglTexture),A(34067,l,m);for(let t=0;t<6;t++)z(c.__webglFramebuffer[t],e,l,36064,34069+t);y(l,m)&&v(34067,l,e.width,e.height),i.unbindTexture()}else if(p){const t=e.texture;for(let r=0,a=t.length;r<a;r++){const a=t[r],o=n.get(a);i.bindTexture(3553,o.__webglTexture),A(3553,a,m),z(c.__webglFramebuffer,e,a,36064+r,3553),y(a,m)&&v(3553,a,e.width,e.height)}i.unbindTexture()}else{let t=3553;if(f)if(s){t=l.isDataTexture3D?32879:35866}else console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.");i.bindTexture(t,u.__webglTexture),A(t,l,m),z(c.__webglFramebuffer,e,l,36064,t),y(l,m)&&v(t,l,e.width,e.height,e.depth),i.unbindTexture()}e.depthBuffer&&D(e)},this.updateRenderTargetMipmap=function(t){const e=_(t)||s,r=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let a=0,o=r.length;a<o;a++){const o=r[a];if(y(o,e)){const e=t.isWebGLCubeRenderTarget?34067:3553,r=n.get(o).__webglTexture;i.bindTexture(e,r),v(e,o,t.width,t.height),i.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(e.isWebGLMultisampleRenderTarget)if(s){const r=e.width,a=e.height;let o=16384;e.depthBuffer&&(o|=256),e.stencilBuffer&&(o|=1024);const s=n.get(e);i.bindFramebuffer(36008,s.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,s.__webglFramebuffer),t.blitFramebuffer(0,0,r,a,0,0,r,a,o,9728),i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,s.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(t,e){t&&t.isWebGLRenderTarget&&(!1===B&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),B=!0),t=t.texture),T(t,e)},this.safeSetTextureCube=function(t,e){t&&t.isWebGLCubeRenderTarget&&(!1===O&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),O=!0),t=t.texture),M(t,e)}}function Sl(t,e,i){const n=i.isWebGL2;return{convert:function(t){let i;if(t===wi)return 5121;if(1017===t)return 32819;if(1018===t)return 32820;if(1019===t)return 33635;if(1010===t)return 5120;if(1011===t)return 5122;if(t===Si)return 5123;if(1013===t)return 5124;if(t===Ei)return 5125;if(t===Ti)return 5126;if(t===Mi)return n?5131:(i=e.get("OES_texture_half_float"),null!==i?i.HALF_FLOAT_OES:null);if(1021===t)return 6406;if(t===Ii)return 6407;if(t===Ai)return 6408;if(1024===t)return 6409;if(1025===t)return 6410;if(t===ki)return 6402;if(t===Ri)return 34041;if(1028===t)return 6403;if(1029===t)return 36244;if(1030===t)return 33319;if(1031===t)return 33320;if(1032===t)return 36248;if(1033===t)return 36249;if(33776===t||33777===t||33778===t||33779===t){if(i=e.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(33776===t)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===t)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===t)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===t)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===t||35841===t||35842===t||35843===t){if(i=e.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(35840===t)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===t)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===t)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===t)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===t)return i=e.get("WEBGL_compressed_texture_etc1"),null!==i?i.COMPRESSED_RGB_ETC1_WEBGL:null;if((37492===t||37496===t)&&(i=e.get("WEBGL_compressed_texture_etc"),null!==i)){if(37492===t)return i.COMPRESSED_RGB8_ETC2;if(37496===t)return i.COMPRESSED_RGBA8_ETC2_EAC}return 37808===t||37809===t||37810===t||37811===t||37812===t||37813===t||37814===t||37815===t||37816===t||37817===t||37818===t||37819===t||37820===t||37821===t||37840===t||37841===t||37842===t||37843===t||37844===t||37845===t||37846===t||37847===t||37848===t||37849===t||37850===t||37851===t||37852===t||37853===t?(i=e.get("WEBGL_compressed_texture_astc"),null!==i?t:null):36492===t?(i=e.get("EXT_texture_compression_bptc"),null!==i?t:null):t===Ci?n?34042:(i=e.get("WEBGL_depth_texture"),null!==i?i.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class El extends ka{constructor(t=[]){super(),this.cameras=t}}El.prototype.isArrayCamera=!0;class Tl extends Sr{constructor(){super(),this.type="Group"}}Tl.prototype.isGroup=!0;const Ml={type:"move"};class Cl{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Tl,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Tl,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new bn,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new bn),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Tl,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new bn,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new bn),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,i){let n=null,r=null,a=null;const o=this._targetRay,s=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState)if(null!==o&&(n=e.getPose(t.targetRaySpace,i),null!==n&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(Ml))),l&&t.hand){a=!0;for(const a of t.hand.values()){const t=e.getJointPose(a,i);if(void 0===l.joints[a.jointName]){const t=new Tl;t.matrixAutoUpdate=!1,t.visible=!1,l.joints[a.jointName]=t,l.add(t)}const n=l.joints[a.jointName];null!==t&&(n.matrix.fromArray(t.transform.matrix),n.matrix.decompose(n.position,n.rotation,n.scale),n.jointRadius=t.radius),n.visible=null!==t}const n=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],o=n.position.distanceTo(r.position),s=.02,c=.005;l.inputState.pinching&&o>s+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&o<=s-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==s&&t.gripSpace&&(r=e.getPose(t.gripSpace,i),null!==r&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),r.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(r.linearVelocity)):s.hasLinearVelocity=!1,r.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(r.angularVelocity)):s.hasAngularVelocity=!1));return null!==o&&(o.visible=null!==n),null!==s&&(s.visible=null!==r),null!==l&&(l.visible=null!==a),this}}class Il extends Wi{constructor(t,e){super();const i=this,n=t.state;let r=null,a=1,o=null,s="local-floor",l=null,c=null,u=null,h=null,p=null,d=!1,f=null,m=null,g=null,_=null,y=null,v=null;const x=[],b=new Map,w=new ka;w.layers.enable(1),w.viewport=new _n;const S=new ka;S.layers.enable(2),S.viewport=new _n;const E=[w,S],T=new El;T.layers.enable(1),T.layers.enable(2);let M=null,C=null;function I(t){const e=b.get(t.inputSource);e&&e.dispatchEvent({type:t.type,data:t.inputSource})}function A(){b.forEach((function(t,e){t.disconnect(e)})),b.clear(),M=null,C=null,n.bindXRFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),u&&e.deleteFramebuffer(u),f&&e.deleteFramebuffer(f),m&&e.deleteRenderbuffer(m),g&&e.deleteRenderbuffer(g),u=null,f=null,m=null,g=null,p=null,h=null,c=null,r=null,L.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function k(t){const e=r.inputSources;for(let i=0;i<x.length;i++)b.set(e[i],x[i]);for(let i=0;i<t.removed.length;i++){const e=t.removed[i],n=b.get(e);n&&(n.dispatchEvent({type:"disconnected",data:e}),b.delete(e))}for(let i=0;i<t.added.length;i++){const e=t.added[i],n=b.get(e);n&&n.dispatchEvent({type:"connected",data:e})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=x[t];return void 0===e&&(e=new Cl,x[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=x[t];return void 0===e&&(e=new Cl,x[t]=e),e.getGripSpace()},this.getHand=function(t){let e=x[t];return void 0===e&&(e=new Cl,x[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){a=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){s=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getBaseLayer=function(){return null!==h?h:p},this.getBinding=function(){return c},this.getFrame=function(){return _},this.getSession=function(){return r},this.setSession=async function(t){if(r=t,null!==r){r.addEventListener("select",I),r.addEventListener("selectstart",I),r.addEventListener("selectend",I),r.addEventListener("squeeze",I),r.addEventListener("squeezestart",I),r.addEventListener("squeezeend",I),r.addEventListener("end",A),r.addEventListener("inputsourceschange",k);const t=e.getContextAttributes();if(!0!==t.xrCompatible&&await e.makeXRCompatible(),void 0===r.renderState.layers){const i={antialias:t.antialias,alpha:t.alpha,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:a};p=new XRWebGLLayer(r,e,i),r.updateRenderState({baseLayer:p})}else if(e instanceof WebGLRenderingContext){const i={antialias:!0,alpha:t.alpha,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:a};p=new XRWebGLLayer(r,e,i),r.updateRenderState({layers:[p]})}else{d=t.antialias;let i=null;t.depth&&(v=256,t.stencil&&(v|=1024),y=t.stencil?33306:36096,i=t.stencil?35056:33190);const o={colorFormat:t.alpha?32856:32849,depthFormat:i,scaleFactor:a};c=new XRWebGLBinding(r,e),h=c.createProjectionLayer(o),u=e.createFramebuffer(),r.updateRenderState({layers:[h]}),d&&(f=e.createFramebuffer(),m=e.createRenderbuffer(),e.bindRenderbuffer(36161,m),e.renderbufferStorageMultisample(36161,4,32856,h.textureWidth,h.textureHeight),n.bindFramebuffer(36160,f),e.framebufferRenderbuffer(36160,36064,36161,m),e.bindRenderbuffer(36161,null),null!==i&&(g=e.createRenderbuffer(),e.bindRenderbuffer(36161,g),e.renderbufferStorageMultisample(36161,4,i,h.textureWidth,h.textureHeight),e.framebufferRenderbuffer(36160,y,36161,g),e.bindRenderbuffer(36161,null)),n.bindFramebuffer(36160,null))}o=await r.requestReferenceSpace(s),L.setContext(r),L.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};const R=new bn,z=new bn;function P(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===r)return;T.near=S.near=w.near=t.near,T.far=S.far=w.far=t.far,M===T.near&&C===T.far||(r.updateRenderState({depthNear:T.near,depthFar:T.far}),M=T.near,C=T.far);const e=t.parent,i=T.cameras;P(T,e);for(let r=0;r<i.length;r++)P(i[r],e);T.matrixWorld.decompose(T.position,T.quaternion,T.scale),t.position.copy(T.position),t.quaternion.copy(T.quaternion),t.scale.copy(T.scale),t.matrix.copy(T.matrix),t.matrixWorld.copy(T.matrixWorld);const n=t.children;for(let r=0,a=n.length;r<a;r++)n[r].updateMatrixWorld(!0);2===i.length?function(t,e,i){R.setFromMatrixPosition(e.matrixWorld),z.setFromMatrixPosition(i.matrixWorld);const n=R.distanceTo(z),r=e.projectionMatrix.elements,a=i.projectionMatrix.elements,o=r[14]/(r[10]-1),s=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],u=(r[8]-1)/r[0],h=(a[8]+1)/a[0],p=o*u,d=o*h,f=n/(-u+h),m=f*-u;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const g=o+f,_=s+f,y=p-m,v=d+(n-m),x=l*s/_*g,b=c*s/_*g;t.projectionMatrix.makePerspective(y,v,x,b,g,_)}(T,w,S):T.projectionMatrix.copy(w.projectionMatrix)},this.getCamera=function(){return T},this.getFoveation=function(){return null!==h?h.fixedFoveation:null!==p?p.fixedFoveation:void 0},this.setFoveation=function(t){null!==h&&(h.fixedFoveation=t),null!==p&&void 0!==p.fixedFoveation&&(p.fixedFoveation=t)};let D=null;const L=new Va;L.setAnimationLoop((function(t,i){if(l=i.getViewerPose(o),_=i,null!==l){const t=l.views;null!==p&&n.bindXRFramebuffer(p.framebuffer);let i=!1;t.length!==T.cameras.length&&(T.cameras.length=0,i=!0);for(let r=0;r<t.length;r++){const a=t[r];let o=null;if(null!==p)o=p.getViewport(a);else{const t=c.getViewSubImage(h,a);n.bindXRFramebuffer(u),void 0!==t.depthStencilTexture&&e.framebufferTexture2D(36160,y,3553,t.depthStencilTexture,0),e.framebufferTexture2D(36160,36064,3553,t.colorTexture,0),o=t.viewport}const s=E[r];s.matrix.fromArray(a.transform.matrix),s.projectionMatrix.fromArray(a.projectionMatrix),s.viewport.set(o.x,o.y,o.width,o.height),0===r&&T.matrix.copy(s.matrix),!0===i&&T.cameras.push(s)}d&&(n.bindXRFramebuffer(f),null!==v&&e.clear(v))}const a=r.inputSources;for(let e=0;e<x.length;e++){const t=x[e],n=a[e];t.update(n,i,o)}if(D&&D(t,i),d){const t=h.textureWidth,i=h.textureHeight;n.bindFramebuffer(36008,f),n.bindFramebuffer(36009,u),e.invalidateFramebuffer(36008,[y]),e.invalidateFramebuffer(36009,[y]),e.blitFramebuffer(0,0,t,i,0,0,t,i,16384,9728),e.invalidateFramebuffer(36008,[36064]),n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,null),n.bindFramebuffer(36160,f)}_=null})),this.setAnimationLoop=function(t){D=t},this.dispose=function(){}}}function Al(t){function e(e,i){e.opacity.value=i.opacity,i.color&&e.diffuse.value.copy(i.color),i.emissive&&e.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(e.map.value=i.map),i.alphaMap&&(e.alphaMap.value=i.alphaMap),i.specularMap&&(e.specularMap.value=i.specularMap),i.alphaTest>0&&(e.alphaTest.value=i.alphaTest);const n=t.get(i).envMap;if(n){e.envMap.value=n,e.flipEnvMap.value=n.isCubeTexture&&!1===n.isRenderTargetTexture?-1:1,e.reflectivity.value=i.reflectivity,e.ior.value=i.ior,e.refractionRatio.value=i.refractionRatio;const r=t.get(n).__maxMipLevel;void 0!==r&&(e.maxMipLevel.value=r)}let r,a;i.lightMap&&(e.lightMap.value=i.lightMap,e.lightMapIntensity.value=i.lightMapIntensity),i.aoMap&&(e.aoMap.value=i.aoMap,e.aoMapIntensity.value=i.aoMapIntensity),i.map?r=i.map:i.specularMap?r=i.specularMap:i.displacementMap?r=i.displacementMap:i.normalMap?r=i.normalMap:i.bumpMap?r=i.bumpMap:i.roughnessMap?r=i.roughnessMap:i.metalnessMap?r=i.metalnessMap:i.alphaMap?r=i.alphaMap:i.emissiveMap?r=i.emissiveMap:i.clearcoatMap?r=i.clearcoatMap:i.clearcoatNormalMap?r=i.clearcoatNormalMap:i.clearcoatRoughnessMap?r=i.clearcoatRoughnessMap:i.specularIntensityMap?r=i.specularIntensityMap:i.specularColorMap?r=i.specularColorMap:i.transmissionMap?r=i.transmissionMap:i.thicknessMap?r=i.thicknessMap:i.sheenColorMap?r=i.sheenColorMap:i.sheenRoughnessMap&&(r=i.sheenRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix)),i.aoMap?a=i.aoMap:i.lightMap&&(a=i.lightMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),e.uv2Transform.value.copy(a.matrix))}function i(e,i){e.roughness.value=i.roughness,e.metalness.value=i.metalness,i.roughnessMap&&(e.roughnessMap.value=i.roughnessMap),i.metalnessMap&&(e.metalnessMap.value=i.metalnessMap),i.emissiveMap&&(e.emissiveMap.value=i.emissiveMap),i.bumpMap&&(e.bumpMap.value=i.bumpMap,e.bumpScale.value=i.bumpScale,1===i.side&&(e.bumpScale.value*=-1)),i.normalMap&&(e.normalMap.value=i.normalMap,e.normalScale.value.copy(i.normalScale),1===i.side&&e.normalScale.value.negate()),i.displacementMap&&(e.displacementMap.value=i.displacementMap,e.displacementScale.value=i.displacementScale,e.displacementBias.value=i.displacementBias);t.get(i).envMap&&(e.envMapIntensity.value=i.envMapIntensity)}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,n,r,a,o){n.isMeshBasicMaterial?e(t,n):n.isMeshLambertMaterial?(e(t,n),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(t,n)):n.isMeshToonMaterial?(e(t,n),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap);e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshPhongMaterial?(e(t,n),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshStandardMaterial?(e(t,n),n.isMeshPhysicalMaterial?function(t,e,n){i(t,e),t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap));e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap),e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,1===e.side&&t.clearcoatNormalScale.value.negate()));e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=n.texture,t.transmissionSamplerSize.value.set(n.width,n.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor));t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap);e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap)}(t,n,o):i(t,n)):n.isMeshMatcapMaterial?(e(t,n),function(t,e){e.matcap&&(t.matcap.value=e.matcap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshDepthMaterial?(e(t,n),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshDistanceMaterial?(e(t,n),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias);t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,n)):n.isMeshNormalMaterial?(e(t,n),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,n),n.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,n)):n.isPointsMaterial?function(t,e,i,n){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*i,t.scale.value=.5*n,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);e.alphaTest>0&&(t.alphaTest.value=e.alphaTest);let r;e.map?r=e.map:e.alphaMap&&(r=e.alphaMap);void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}(t,n,r,a):n.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);e.alphaTest>0&&(t.alphaTest.value=e.alphaTest);let i;e.map?i=e.map:e.alphaMap&&(i=e.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix))}(t,n):n.isShadowMaterial?(t.color.value.copy(n.color),t.opacity.value=n.opacity):n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)}}}function kl(t={}){const e=void 0!==t.canvas?t.canvas:function(){const t=un("canvas");return t.style.display="block",t}(),i=void 0!==t.context?t.context:null,n=void 0!==t.alpha&&t.alpha,r=void 0===t.depth||t.depth,a=void 0===t.stencil||t.stencil,o=void 0!==t.antialias&&t.antialias,s=void 0===t.premultipliedAlpha||t.premultipliedAlpha,l=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,c=void 0!==t.powerPreference?t.powerPreference:"default",u=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let h=null,p=null;const d=[],f=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Ni,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const m=this;let g=!1,_=0,y=0,v=null,x=-1,b=null;const w=new _n,S=new _n;let E=null,T=e.width,M=e.height,C=1,I=null,A=null;const k=new _n(0,0,T,M),R=new _n(0,0,T,M);let z=!1;const P=[],D=new $a;let L=!1,B=!1,O=null;const F=new Jn,N=new bn,U={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function $(){return null===v?C:1}let V,j,q,G,H,W,Z,Y,X,K,J,Q,tt,et,it,nt,rt,at,ot,st,lt,ct,ut,ht=i;function pt(t,i){for(let n=0;n<t.length;n++){const r=t[n],a=e.getContext(r,i);if(null!==a)return a}return null}try{const t={alpha:n,depth:r,stencil:a,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if(e.addEventListener("webglcontextlost",mt,!1),e.addEventListener("webglcontextrestored",gt,!1),null===ht){const e=["webgl2","webgl","experimental-webgl"];if(!0===m.isWebGL1Renderer&&e.shift(),ht=pt(e,t),null===ht)throw pt(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ht.getShaderPrecisionFormat&&(ht.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(It){throw console.error("THREE.WebGLRenderer: "+It.message),It}function dt(){V=new Co(ht),j=new Ka(ht,V,t),V.init(j),ct=new Sl(ht,V,j),q=new bl(ht,V,j),P[0]=1029,G=new ko(ht),H=new sl,W=new wl(ht,V,q,H,j,ct,G),Z=new Qa(m),Y=new Mo(m),X=new ja(ht,j),ut=new Ya(ht,V,X,j),K=new Io(ht,X,G,ut),J=new Bo(ht,K,X,G),ot=new Lo(ht,j,W),nt=new Ja(H),Q=new ol(m,Z,Y,V,j,ut,nt),tt=new Al(H),et=new hl(H),it=new _l(V,j),at=new Za(m,Z,q,J,s),rt=new xl(m,J,j),st=new Xa(ht,V,G,j),lt=new Ao(ht,V,G,j),G.programs=Q.programs,m.capabilities=j,m.extensions=V,m.properties=H,m.renderLists=et,m.shadowMap=rt,m.state=q,m.info=G}dt();const ft=new Il(m,ht);function mt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function gt(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;const t=G.autoReset,e=rt.enabled,i=rt.autoUpdate,n=rt.needsUpdate,r=rt.type;dt(),G.autoReset=t,rt.enabled=e,rt.autoUpdate=i,rt.needsUpdate=n,rt.type=r}function _t(t){const e=t.target;e.removeEventListener("dispose",_t),function(t){(function(t){const e=H.get(t).programs;void 0!==e&&e.forEach((function(t){Q.releaseProgram(t)}))})(t),H.remove(t)}(e)}this.xr=ft,this.getContext=function(){return ht},this.getContextAttributes=function(){return ht.getContextAttributes()},this.forceContextLoss=function(){const t=V.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=V.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return C},this.setPixelRatio=function(t){void 0!==t&&(C=t,this.setSize(T,M,!1))},this.getSize=function(t){return t.set(T,M)},this.setSize=function(t,i,n){ft.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(T=t,M=i,e.width=Math.floor(t*C),e.height=Math.floor(i*C),!1!==n&&(e.style.width=t+"px",e.style.height=i+"px"),this.setViewport(0,0,t,i))},this.getDrawingBufferSize=function(t){return t.set(T*C,M*C).floor()},this.setDrawingBufferSize=function(t,i,n){T=t,M=i,C=n,e.width=Math.floor(t*n),e.height=Math.floor(i*n),this.setViewport(0,0,t,i)},this.getCurrentViewport=function(t){return t.copy(w)},this.getViewport=function(t){return t.copy(k)},this.setViewport=function(t,e,i,n){t.isVector4?k.set(t.x,t.y,t.z,t.w):k.set(t,e,i,n),q.viewport(w.copy(k).multiplyScalar(C).floor())},this.getScissor=function(t){return t.copy(R)},this.setScissor=function(t,e,i,n){t.isVector4?R.set(t.x,t.y,t.z,t.w):R.set(t,e,i,n),q.scissor(S.copy(R).multiplyScalar(C).floor())},this.getScissorTest=function(){return z},this.setScissorTest=function(t){q.setScissorTest(z=t)},this.setOpaqueSort=function(t){I=t},this.setTransparentSort=function(t){A=t},this.getClearColor=function(t){return t.copy(at.getClearColor())},this.setClearColor=function(){at.setClearColor.apply(at,arguments)},this.getClearAlpha=function(){return at.getClearAlpha()},this.setClearAlpha=function(){at.setClearAlpha.apply(at,arguments)},this.clear=function(t,e,i){let n=0;(void 0===t||t)&&(n|=16384),(void 0===e||e)&&(n|=256),(void 0===i||i)&&(n|=1024),ht.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",mt,!1),e.removeEventListener("webglcontextrestored",gt,!1),et.dispose(),it.dispose(),H.dispose(),Z.dispose(),Y.dispose(),J.dispose(),ut.dispose(),ft.dispose(),ft.removeEventListener("sessionstart",vt),ft.removeEventListener("sessionend",xt),O&&(O.dispose(),O=null),bt.stop()},this.renderBufferDirect=function(t,e,i,n,r,a){null===e&&(e=U);const o=r.isMesh&&r.matrixWorld.determinant()<0,s=function(t,e,i,n,r){!0!==e.isScene&&(e=U);W.resetTextureUnits();const a=e.fog,o=n.isMeshStandardMaterial?e.environment:null,s=null===v?m.outputEncoding:v.texture.encoding,l=(n.isMeshStandardMaterial?Y:Z).get(n.envMap||o),c=!0===n.vertexColors&&!!i.attributes.color&&4===i.attributes.color.itemSize,u=!!n.normalMap&&!!i.attributes.tangent,h=!!i.morphAttributes.position,d=!!i.morphAttributes.normal,f=i.morphAttributes.position?i.morphAttributes.position.length:0,g=H.get(n),_=p.state.lights;if(!0===L&&(!0===B||t!==b)){const e=t===b&&n.id===x;nt.setState(n,t,e)}let y=!1;n.version===g.__version?g.needsLights&&g.lightsStateVersion!==_.state.version||g.outputEncoding!==s||r.isInstancedMesh&&!1===g.instancing?y=!0:r.isInstancedMesh||!0!==g.instancing?r.isSkinnedMesh&&!1===g.skinning?y=!0:r.isSkinnedMesh||!0!==g.skinning?g.envMap!==l||n.fog&&g.fog!==a?y=!0:void 0===g.numClippingPlanes||g.numClippingPlanes===nt.numPlanes&&g.numIntersection===nt.numIntersection?(g.vertexAlphas!==c||g.vertexTangents!==u||g.morphTargets!==h||g.morphNormals!==d||!0===j.isWebGL2&&g.morphTargetsCount!==f)&&(y=!0):y=!0:y=!0:y=!0:(y=!0,g.__version=n.version);let w=g.currentProgram;!0===y&&(w=Mt(n,e,r));let S=!1,E=!1,T=!1;const I=w.getUniforms(),A=g.uniforms;q.useProgram(w.program)&&(S=!0,E=!0,T=!0);n.id!==x&&(x=n.id,E=!0);if(S||b!==t){if(I.setValue(ht,"projectionMatrix",t.projectionMatrix),j.logarithmicDepthBuffer&&I.setValue(ht,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),b!==t&&(b=t,E=!0,T=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const e=I.map.cameraPosition;void 0!==e&&e.setValue(ht,N.setFromMatrixPosition(t.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&I.setValue(ht,"isOrthographic",!0===t.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||r.isSkinnedMesh)&&I.setValue(ht,"viewMatrix",t.matrixWorldInverse)}if(r.isSkinnedMesh){I.setOptional(ht,r,"bindMatrix"),I.setOptional(ht,r,"bindMatrixInverse");const t=r.skeleton;t&&(j.floatVertexTextures?(null===t.boneTexture&&t.computeBoneTexture(),I.setValue(ht,"boneTexture",t.boneTexture,W),I.setValue(ht,"boneTextureSize",t.boneTextureSize)):I.setOptional(ht,t,"boneMatrices"))}!i||void 0===i.morphAttributes.position&&void 0===i.morphAttributes.normal||ot.update(r,i,n,w);(E||g.receiveShadow!==r.receiveShadow)&&(g.receiveShadow=r.receiveShadow,I.setValue(ht,"receiveShadow",r.receiveShadow));E&&(I.setValue(ht,"toneMappingExposure",m.toneMappingExposure),g.needsLights&&(R=T,(k=A).ambientLightColor.needsUpdate=R,k.lightProbe.needsUpdate=R,k.directionalLights.needsUpdate=R,k.directionalLightShadows.needsUpdate=R,k.pointLights.needsUpdate=R,k.pointLightShadows.needsUpdate=R,k.spotLights.needsUpdate=R,k.spotLightShadows.needsUpdate=R,k.rectAreaLights.needsUpdate=R,k.hemisphereLights.needsUpdate=R),a&&n.fog&&tt.refreshFogUniforms(A,a),tt.refreshMaterialUniforms(A,n,C,M,O),Ns.upload(ht,g.uniformsList,A,W));var k,R;n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(Ns.upload(ht,g.uniformsList,A,W),n.uniformsNeedUpdate=!1);n.isSpriteMaterial&&I.setValue(ht,"center",r.center);return I.setValue(ht,"modelViewMatrix",r.modelViewMatrix),I.setValue(ht,"normalMatrix",r.normalMatrix),I.setValue(ht,"modelMatrix",r.matrixWorld),w}(t,e,i,n,r);q.setMaterial(n,o);let l=i.index;const c=i.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let u,h=1;!0===n.wireframe&&(l=K.getWireframeAttribute(i),h=2),ut.setup(r,n,s,i,l);let d=st;null!==l&&(u=X.get(l),d=lt,d.setIndex(u));const f=null!==l?l.count:c.count,g=i.drawRange.start*h,_=i.drawRange.count*h,y=null!==a?a.start*h:0,w=null!==a?a.count*h:1/0,S=Math.max(g,y),E=Math.min(f,g+_,y+w)-1,T=Math.max(0,E-S+1);if(0!==T){if(r.isMesh)!0===n.wireframe?(q.setLineWidth(n.wireframeLinewidth*$()),d.setMode(1)):d.setMode(4);else if(r.isLine){let t=n.linewidth;void 0===t&&(t=1),q.setLineWidth(t*$()),r.isLineSegments?d.setMode(1):r.isLineLoop?d.setMode(2):d.setMode(3)}else r.isPoints?d.setMode(0):r.isSprite&&d.setMode(4);if(r.isInstancedMesh)d.renderInstances(S,T,r.count);else if(i.isInstancedBufferGeometry){const t=Math.min(i.instanceCount,i._maxInstanceCount);d.renderInstances(S,T,t)}else d.render(S,T)}},this.compile=function(t,e){p=it.get(t),p.init(),f.push(p),t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(p.pushLight(t),t.castShadow&&p.pushShadow(t))})),p.setupLights(m.physicallyCorrectLights),t.traverse((function(e){const i=e.material;if(i)if(Array.isArray(i))for(let n=0;n<i.length;n++){Mt(i[n],t,e)}else Mt(i,t,e)})),f.pop(),p=null};let yt=null;function vt(){bt.stop()}function xt(){bt.start()}const bt=new Va;function wt(t,e,i,n){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)i=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)p.pushLight(t),t.castShadow&&p.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||D.intersectsSprite(t)){n&&N.setFromMatrixPosition(t.matrixWorld).applyMatrix4(F);const e=J.update(t),r=t.material;r.visible&&h.push(t,e,r,i,N.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==G.render.frame&&(t.skeleton.update(),t.skeleton.frame=G.render.frame),!t.frustumCulled||D.intersectsObject(t))){n&&N.setFromMatrixPosition(t.matrixWorld).applyMatrix4(F);const e=J.update(t),r=t.material;if(Array.isArray(r)){const n=e.groups;for(let a=0,o=n.length;a<o;a++){const o=n[a],s=r[o.materialIndex];s&&s.visible&&h.push(t,e,s,i,N.z,o)}}else r.visible&&h.push(t,e,r,i,N.z,null)}const r=t.children;for(let a=0,o=r.length;a<o;a++)wt(r[a],e,i,n)}function St(t,e,i,n){const r=t.opaque,a=t.transmissive,s=t.transparent;p.setupLightsView(i),a.length>0&&function(t,e,i){if(null===O){const t=!0===o&&!0===j.isWebGL2;O=new(t?vn:yn)(1024,1024,{generateMipmaps:!0,type:null!==ct.convert(Mi)?Mi:wi,minFilter:bi,magFilter:vi,wrapS:_i,wrapT:_i})}const n=m.getRenderTarget();m.setRenderTarget(O),m.clear();const r=m.toneMapping;m.toneMapping=0,Et(t,e,i),m.toneMapping=r,W.updateMultisampleRenderTarget(O),W.updateRenderTargetMipmap(O),m.setRenderTarget(n)}(r,e,i),n&&q.viewport(w.copy(n)),r.length>0&&Et(r,e,i),a.length>0&&Et(a,e,i),s.length>0&&Et(s,e,i)}function Et(t,e,i){const n=!0===e.isScene?e.overrideMaterial:null;for(let r=0,a=t.length;r<a;r++){const a=t[r],o=a.object,s=a.geometry,l=null===n?a.material:n,c=a.group;o.layers.test(i.layers)&&Tt(o,e,i,s,l,c)}}function Tt(t,e,i,n,r,a){t.onBeforeRender(m,e,i,n,r,a),t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),r.onBeforeRender(m,e,i,n,t,a),!0===r.transparent&&2===r.side?(r.side=1,r.needsUpdate=!0,m.renderBufferDirect(i,e,n,r,t,a),r.side=0,r.needsUpdate=!0,m.renderBufferDirect(i,e,n,r,t,a),r.side=2):m.renderBufferDirect(i,e,n,r,t,a),t.onAfterRender(m,e,i,n,r,a)}function Mt(t,e,i){!0!==e.isScene&&(e=U);const n=H.get(t),r=p.state.lights,a=p.state.shadowsArray,o=r.state.version,s=Q.getParameters(t,r.state,a,e,i),l=Q.getProgramCacheKey(s);let c=n.programs;n.environment=t.isMeshStandardMaterial?e.environment:null,n.fog=e.fog,n.envMap=(t.isMeshStandardMaterial?Y:Z).get(t.envMap||n.environment),void 0===c&&(t.addEventListener("dispose",_t),c=new Map,n.programs=c);let u=c.get(l);if(void 0!==u){if(n.currentProgram===u&&n.lightsStateVersion===o)return Ct(t,s),u}else s.uniforms=Q.getUniforms(t),t.onBuild(i,s,m),t.onBeforeCompile(s,m),u=Q.acquireProgram(s,l),c.set(l,u),n.uniforms=s.uniforms;const h=n.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(h.clippingPlanes=nt.uniform),Ct(t,s),n.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),n.lightsStateVersion=o,n.needsLights&&(h.ambientLightColor.value=r.state.ambient,h.lightProbe.value=r.state.probe,h.directionalLights.value=r.state.directional,h.directionalLightShadows.value=r.state.directionalShadow,h.spotLights.value=r.state.spot,h.spotLightShadows.value=r.state.spotShadow,h.rectAreaLights.value=r.state.rectArea,h.ltc_1.value=r.state.rectAreaLTC1,h.ltc_2.value=r.state.rectAreaLTC2,h.pointLights.value=r.state.point,h.pointLightShadows.value=r.state.pointShadow,h.hemisphereLights.value=r.state.hemi,h.directionalShadowMap.value=r.state.directionalShadowMap,h.directionalShadowMatrix.value=r.state.directionalShadowMatrix,h.spotShadowMap.value=r.state.spotShadowMap,h.spotShadowMatrix.value=r.state.spotShadowMatrix,h.pointShadowMap.value=r.state.pointShadowMap,h.pointShadowMatrix.value=r.state.pointShadowMatrix);const d=u.getUniforms(),f=Ns.seqWithValue(d.seq,h);return n.currentProgram=u,n.uniformsList=f,u}function Ct(t,e){const i=H.get(t);i.outputEncoding=e.outputEncoding,i.instancing=e.instancing,i.skinning=e.skinning,i.morphTargets=e.morphTargets,i.morphNormals=e.morphNormals,i.morphTargetsCount=e.morphTargetsCount,i.numClippingPlanes=e.numClippingPlanes,i.numIntersection=e.numClipIntersection,i.vertexAlphas=e.vertexAlphas,i.vertexTangents=e.vertexTangents}bt.setAnimationLoop((function(t){yt&&yt(t)})),"undefined"!==typeof window&&bt.setContext(window),this.setAnimationLoop=function(t){yt=t,ft.setAnimationLoop(t),null===t?bt.stop():bt.start()},ft.addEventListener("sessionstart",vt),ft.addEventListener("sessionend",xt),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===g)return;!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===ft.enabled&&!0===ft.isPresenting&&(!0===ft.cameraAutoUpdate&&ft.updateCamera(e),e=ft.getCamera()),!0===t.isScene&&t.onBeforeRender(m,t,e,v),p=it.get(t,f.length),p.init(),f.push(p),F.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),D.setFromProjectionMatrix(F),B=this.localClippingEnabled,L=nt.init(this.clippingPlanes,B,e),h=et.get(t,d.length),h.init(),d.push(h),wt(t,e,0,m.sortObjects),h.finish(),!0===m.sortObjects&&h.sort(I,A),!0===L&&nt.beginShadows();const i=p.state.shadowsArray;if(rt.render(i,t,e),!0===L&&nt.endShadows(),!0===this.info.autoReset&&this.info.reset(),at.render(h,t),p.setupLights(m.physicallyCorrectLights),e.isArrayCamera){const i=e.cameras;for(let e=0,n=i.length;e<n;e++){const n=i[e];St(h,t,n,n.viewport)}}else St(h,t,e);null!==v&&(W.updateMultisampleRenderTarget(v),W.updateRenderTargetMipmap(v)),!0===t.isScene&&t.onAfterRender(m,t,e),q.buffers.depth.setTest(!0),q.buffers.depth.setMask(!0),q.buffers.color.setMask(!0),q.setPolygonOffset(!1),ut.resetDefaultState(),x=-1,b=null,f.pop(),p=f.length>0?f[f.length-1]:null,d.pop(),h=d.length>0?d[d.length-1]:null},this.getActiveCubeFace=function(){return _},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return v},this.setRenderTarget=function(t,e=0,i=0){v=t,_=e,y=i,t&&void 0===H.get(t).__webglFramebuffer&&W.setupRenderTarget(t);let n=null,r=!1,a=!1;if(t){const i=t.texture;(i.isDataTexture3D||i.isDataTexture2DArray)&&(a=!0);const o=H.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(n=o[e],r=!0):n=t.isWebGLMultisampleRenderTarget?H.get(t).__webglMultisampledFramebuffer:o,w.copy(t.viewport),S.copy(t.scissor),E=t.scissorTest}else w.copy(k).multiplyScalar(C).floor(),S.copy(R).multiplyScalar(C).floor(),E=z;if(q.bindFramebuffer(36160,n)&&j.drawBuffers){let e=!1;if(t)if(t.isWebGLMultipleRenderTargets){const i=t.texture;if(P.length!==i.length||36064!==P[0]){for(let t=0,e=i.length;t<e;t++)P[t]=36064+t;P.length=i.length,e=!0}}else 1===P.length&&36064===P[0]||(P[0]=36064,P.length=1,e=!0);else 1===P.length&&1029===P[0]||(P[0]=1029,P.length=1,e=!0);e&&(j.isWebGL2?ht.drawBuffers(P):V.get("WEBGL_draw_buffers").drawBuffersWEBGL(P))}if(q.viewport(w),q.scissor(S),q.setScissorTest(E),r){const n=H.get(t.texture);ht.framebufferTexture2D(36160,36064,34069+e,n.__webglTexture,i)}else if(a){const n=H.get(t.texture),r=e||0;ht.framebufferTextureLayer(36160,36064,n.__webglTexture,i||0,r)}x=-1},this.readRenderTargetPixels=function(t,e,i,n,r,a,o){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let s=H.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(s=s[o]),s){q.bindFramebuffer(36160,s);try{const o=t.texture,s=o.format,l=o.type;if(s!==Ai&&ct.convert(s)!==ht.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===Mi&&(V.has("EXT_color_buffer_half_float")||j.isWebGL2&&V.has("EXT_color_buffer_float"));if(l!==wi&&ct.convert(l)!==ht.getParameter(35738)&&(l!==Ti||!(j.isWebGL2||V.has("OES_texture_float")||V.has("WEBGL_color_buffer_float")))&&!c)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===ht.checkFramebufferStatus(36160)?e>=0&&e<=t.width-n&&i>=0&&i<=t.height-r&&ht.readPixels(e,i,n,r,ct.convert(s),ct.convert(l),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const t=null!==v?H.get(v).__webglFramebuffer:null;q.bindFramebuffer(36160,t)}}},this.copyFramebufferToTexture=function(t,e,i=0){const n=Math.pow(2,-i),r=Math.floor(e.image.width*n),a=Math.floor(e.image.height*n);let o=ct.convert(e.format);j.isWebGL2&&(6407===o&&(o=32849),6408===o&&(o=32856)),W.setTexture2D(e,0),ht.copyTexImage2D(3553,i,o,t.x,t.y,r,a,0),q.unbindTexture()},this.copyTextureToTexture=function(t,e,i,n=0){const r=e.image.width,a=e.image.height,o=ct.convert(i.format),s=ct.convert(i.type);W.setTexture2D(i,0),ht.pixelStorei(37440,i.flipY),ht.pixelStorei(37441,i.premultiplyAlpha),ht.pixelStorei(3317,i.unpackAlignment),e.isDataTexture?ht.texSubImage2D(3553,n,t.x,t.y,r,a,o,s,e.image.data):e.isCompressedTexture?ht.compressedTexSubImage2D(3553,n,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,o,e.mipmaps[0].data):ht.texSubImage2D(3553,n,t.x,t.y,o,s,e.image),0===n&&i.generateMipmaps&&ht.generateMipmap(3553),q.unbindTexture()},this.copyTextureToTexture3D=function(t,e,i,n,r=0){if(m.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const a=t.max.x-t.min.x+1,o=t.max.y-t.min.y+1,s=t.max.z-t.min.z+1,l=ct.convert(n.format),c=ct.convert(n.type);let u;if(n.isDataTexture3D)W.setTexture3D(n,0),u=32879;else{if(!n.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");W.setTexture2DArray(n,0),u=35866}ht.pixelStorei(37440,n.flipY),ht.pixelStorei(37441,n.premultiplyAlpha),ht.pixelStorei(3317,n.unpackAlignment);const h=ht.getParameter(3314),p=ht.getParameter(32878),d=ht.getParameter(3316),f=ht.getParameter(3315),g=ht.getParameter(32877),_=i.isCompressedTexture?i.mipmaps[0]:i.image;ht.pixelStorei(3314,_.width),ht.pixelStorei(32878,_.height),ht.pixelStorei(3316,t.min.x),ht.pixelStorei(3315,t.min.y),ht.pixelStorei(32877,t.min.z),i.isDataTexture||i.isDataTexture3D?ht.texSubImage3D(u,r,e.x,e.y,e.z,a,o,s,l,c,_.data):i.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ht.compressedTexSubImage3D(u,r,e.x,e.y,e.z,a,o,s,l,_.data)):ht.texSubImage3D(u,r,e.x,e.y,e.z,a,o,s,l,c,_),ht.pixelStorei(3314,h),ht.pixelStorei(32878,p),ht.pixelStorei(3316,d),ht.pixelStorei(3315,f),ht.pixelStorei(32877,g),0===r&&n.generateMipmaps&&ht.generateMipmap(u),q.unbindTexture()},this.initTexture=function(t){W.setTexture2D(t,0),q.unbindTexture()},this.resetState=function(){_=0,y=0,v=null,q.reset(),ut.reset()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}kl.prototype.isWebGLRenderer=!0;(class extends kl{}).prototype.isWebGL1Renderer=!0;class Rl extends Sr{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}Rl.prototype.isScene=!0;class zl{constructor(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=qi,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Qi()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,i){t*=this.stride,i*=e.stride;for(let n=0,r=this.stride;n<r;n++)this.array[t+n]=e.array[i+n];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Qi()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Qi()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}zl.prototype.isInterleavedBuffer=!0;const Pl=new bn;class Dl{constructor(t,e,i,n=!1){this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=!0===n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,i=this.data.count;e<i;e++)Pl.x=this.getX(e),Pl.y=this.getY(e),Pl.z=this.getZ(e),Pl.applyMatrix4(t),this.setXYZ(e,Pl.x,Pl.y,Pl.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)Pl.x=this.getX(e),Pl.y=this.getY(e),Pl.z=this.getZ(e),Pl.applyNormalMatrix(t),this.setXYZ(e,Pl.x,Pl.y,Pl.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)Pl.x=this.getX(e),Pl.y=this.getY(e),Pl.z=this.getZ(e),Pl.transformDirection(t),this.setXYZ(e,Pl.x,Pl.y,Pl.z);return this}setX(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){return this.data.array[t*this.data.stride+this.offset]}getY(t){return this.data.array[t*this.data.stride+this.offset+1]}getZ(t){return this.data.array[t*this.data.stride+this.offset+2]}getW(t){return this.data.array[t*this.data.stride+this.offset+3]}setXY(t,e,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this}setXYZ(t,e,i,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this}setXYZW(t,e,i,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this.data.array[t+3]=r,this}clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return new Wr(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Dl(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}Dl.prototype.isInterleavedBufferAttribute=!0;class Ll extends Br{constructor(t){super(),this.type="SpriteMaterial",this.color=new jr(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this}}let Bl;Ll.prototype.isSpriteMaterial=!0;const Ol=new bn,Fl=new bn,Nl=new bn,Ul=new sn,$l=new sn,Vl=new Jn,jl=new bn,ql=new bn,Gl=new bn,Hl=new sn,Wl=new sn,Zl=new sn;class Yl extends Sr{constructor(t){if(super(),this.type="Sprite",void 0===Bl){Bl=new ra;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new zl(t,5);Bl.setIndex([0,1,2,0,2,3]),Bl.setAttribute("position",new Dl(e,3,0,!1)),Bl.setAttribute("uv",new Dl(e,2,3,!1))}this.geometry=Bl,this.material=void 0!==t?t:new Ll,this.center=new sn(.5,.5)}raycast(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Fl.setFromMatrixScale(this.matrixWorld),Vl.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),Nl.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Fl.multiplyScalar(-Nl.z);const i=this.material.rotation;let n,r;0!==i&&(r=Math.cos(i),n=Math.sin(i));const a=this.center;Xl(jl.set(-.5,-.5,0),Nl,a,Fl,n,r),Xl(ql.set(.5,-.5,0),Nl,a,Fl,n,r),Xl(Gl.set(.5,.5,0),Nl,a,Fl,n,r),Hl.set(0,0),Wl.set(1,0),Zl.set(1,1);let o=t.ray.intersectTriangle(jl,ql,Gl,!1,Ol);if(null===o&&(Xl(ql.set(-.5,.5,0),Nl,a,Fl,n,r),Wl.set(0,1),o=t.ray.intersectTriangle(jl,Gl,ql,!1,Ol),null===o))return;const s=t.ray.origin.distanceTo(Ol);s<t.near||s>t.far||e.push({distance:s,point:Ol.clone(),uv:Dr.getUV(Ol,jl,ql,Gl,Hl,Wl,Zl,new sn),face:null,object:this})}copy(t){return super.copy(t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}function Xl(t,e,i,n,r,a){Ul.subVectors(t,i).addScalar(.5).multiply(n),void 0!==r?($l.x=a*Ul.x-r*Ul.y,$l.y=r*Ul.x+a*Ul.y):$l.copy(Ul),t.copy(e),t.x+=$l.x,t.y+=$l.y,t.applyMatrix4(Vl)}Yl.prototype.isSprite=!0;const Kl=new bn,Jl=new _n,Ql=new _n,tc=new bn,ec=new Jn;class ic extends wa{constructor(t,e){super(t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Jn,this.bindMatrixInverse=new Jn}copy(t){return super.copy(t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new _n,e=this.geometry.attributes.skinWeight;for(let i=0,n=e.count;i<n;i++){t.x=e.getX(i),t.y=e.getY(i),t.z=e.getZ(i),t.w=e.getW(i);const n=1/t.manhattanLength();n!==1/0?t.multiplyScalar(n):t.set(1,0,0,0),e.setXYZW(i,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(t,e){const i=this.skeleton,n=this.geometry;Jl.fromBufferAttribute(n.attributes.skinIndex,t),Ql.fromBufferAttribute(n.attributes.skinWeight,t),Kl.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let r=0;r<4;r++){const t=Ql.getComponent(r);if(0!==t){const n=Jl.getComponent(r);ec.multiplyMatrices(i.bones[n].matrixWorld,i.boneInverses[n]),e.addScaledVector(tc.copy(Kl).applyMatrix4(ec),t)}}return e.applyMatrix4(this.bindMatrixInverse)}}ic.prototype.isSkinnedMesh=!0;(class extends Sr{constructor(){super(),this.type="Bone"}}).prototype.isBone=!0;(class extends mn{constructor(t=null,e=1,i=1,n,r,a,o,s,l=1003,c=1003,u,h){super(null,a,o,s,l,c,n,r,u,h),this.image={data:t,width:e,height:i},this.magFilter=l,this.minFilter=c,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}).prototype.isDataTexture=!0;class nc extends Wr{constructor(t,e,i,n=1){"number"===typeof i&&(n=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(t,e,i),this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}nc.prototype.isInstancedBufferAttribute=!0;const rc=new Jn,ac=new Jn,oc=[],sc=new wa;(class extends wa{constructor(t,e,i){super(t,e),this.instanceMatrix=new nc(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}copy(t){return super.copy(t),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}raycast(t,e){const i=this.matrixWorld,n=this.count;if(sc.geometry=this.geometry,sc.material=this.material,void 0!==sc.material)for(let r=0;r<n;r++){this.getMatrixAt(r,rc),ac.multiplyMatrices(i,rc),sc.matrixWorld=ac,sc.raycast(t,oc);for(let t=0,i=oc.length;t<i;t++){const i=oc[t];i.instanceId=r,i.object=this,e.push(i)}oc.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new nc(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}).prototype.isInstancedMesh=!0;class lc extends Br{constructor(t){super(),this.type="LineBasicMaterial",this.color=new jr(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this}}lc.prototype.isLineBasicMaterial=!0;const cc=new bn,uc=new bn,hc=new Jn,pc=new Kn,dc=new jn;class fc extends Sr{constructor(t=new ra,e=new lc){super(),this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,i=[0];for(let t=1,n=e.count;t<n;t++)cc.fromBufferAttribute(e,t-1),uc.fromBufferAttribute(e,t),i[t]=i[t-1],i[t]+=cc.distanceTo(uc);t.setAttribute("lineDistance",new Xr(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,r=t.params.Line.threshold,a=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),dc.copy(i.boundingSphere),dc.applyMatrix4(n),dc.radius+=r,!1===t.ray.intersectsSphere(dc))return;hc.copy(n).invert(),pc.copy(t.ray).applyMatrix4(hc);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,l=new bn,c=new bn,u=new bn,h=new bn,p=this.isLineSegments?2:1;if(i.isBufferGeometry){const n=i.index,r=i.attributes.position;if(null!==n){for(let i=Math.max(0,a.start),o=Math.min(n.count,a.start+a.count)-1;i<o;i+=p){const a=n.getX(i),o=n.getX(i+1);l.fromBufferAttribute(r,a),c.fromBufferAttribute(r,o);if(pc.distanceSqToSegment(l,c,h,u)>s)continue;h.applyMatrix4(this.matrixWorld);const p=t.ray.origin.distanceTo(h);p<t.near||p>t.far||e.push({distance:p,point:u.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else{for(let i=Math.max(0,a.start),n=Math.min(r.count,a.start+a.count)-1;i<n;i+=p){l.fromBufferAttribute(r,i),c.fromBufferAttribute(r,i+1);if(pc.distanceSqToSegment(l,c,h,u)>s)continue;h.applyMatrix4(this.matrixWorld);const n=t.ray.origin.distanceTo(h);n<t.near||n>t.far||e.push({distance:n,point:u.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}}else i.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}fc.prototype.isLine=!0;const mc=new bn,gc=new bn;class _c extends fc{constructor(t,e){super(t,e),this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,i=[];for(let t=0,n=e.count;t<n;t+=2)mc.fromBufferAttribute(e,t),gc.fromBufferAttribute(e,t+1),i[t]=0===t?0:i[t-1],i[t+1]=i[t]+mc.distanceTo(gc);t.setAttribute("lineDistance",new Xr(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}_c.prototype.isLineSegments=!0;(class extends fc{constructor(t,e){super(t,e),this.type="LineLoop"}}).prototype.isLineLoop=!0;class yc extends Br{constructor(t){super(),this.type="PointsMaterial",this.color=new jr(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this}}yc.prototype.isPointsMaterial=!0;const vc=new Jn,xc=new Kn,bc=new jn,wc=new bn;class Sc extends Sr{constructor(t=new ra,e=new yc){super(),this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,r=t.params.Points.threshold,a=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),bc.copy(i.boundingSphere),bc.applyMatrix4(n),bc.radius+=r,!1===t.ray.intersectsSphere(bc))return;vc.copy(n).invert(),xc.copy(t.ray).applyMatrix4(vc);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o;if(i.isBufferGeometry){const r=i.index,o=i.attributes.position;if(null!==r){for(let i=Math.max(0,a.start),l=Math.min(r.count,a.start+a.count);i<l;i++){const a=r.getX(i);wc.fromBufferAttribute(o,a),Ec(wc,a,s,n,t,e,this)}}else{for(let i=Math.max(0,a.start),r=Math.min(o.count,a.start+a.count);i<r;i++)wc.fromBufferAttribute(o,i),Ec(wc,i,s,n,t,e,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function Ec(t,e,i,n,r,a,o){const s=xc.distanceSqToPoint(t);if(s<i){const i=new bn;xc.closestPointToPoint(t,i),i.applyMatrix4(n);const l=r.ray.origin.distanceTo(i);if(l<r.near||l>r.far)return;a.push({distance:l,distanceToRay:Math.sqrt(s),point:i,index:e,face:null,object:o})}}Sc.prototype.isPoints=!0;(class extends mn{constructor(t,e,i,n,r,a,o,s,l){super(t,e,i,n,r,a,o,s,l),this.format=void 0!==o?o:Ii,this.minFilter=void 0!==a?a:xi,this.magFilter=void 0!==r?r:xi,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function e(){c.needsUpdate=!0,t.requestVideoFrameCallback(e)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;!1==="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}).prototype.isVideoTexture=!0;(class extends mn{constructor(t,e,i,n,r,a,o,s,l,c,u,h){super(null,a,o,s,l,c,n,r,u,h),this.image={width:e,height:i},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}).prototype.isCompressedTexture=!0;(class extends mn{constructor(t,e,i,n,r,a,o,s,l){super(t,e,i,n,r,a,o,s,l),this.needsUpdate=!0}}).prototype.isCanvasTexture=!0;(class extends mn{constructor(t,e,i,n,r,a,o,s,l,c){if((c=void 0!==c?c:ki)!==ki&&c!==Ri)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&c===ki&&(i=Si),void 0===i&&c===Ri&&(i=Ci),super(null,n,r,a,o,s,c,i,l),this.image={width:t,height:e},this.magFilter=void 0!==o?o:vi,this.minFilter=void 0!==s?s:vi,this.flipY=!1,this.generateMipmaps=!1}}).prototype.isDepthTexture=!0;new bn,new bn,new bn,new Dr;class Tc{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const i=this.getUtoTmapping(t);return this.getPoint(i,e)}getPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return e}getSpacedPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let i,n=this.getPoint(0),r=0;e.push(0);for(let a=1;a<=t;a++)i=this.getPoint(a/t),r+=i.distanceTo(n),e.push(r),n=i;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const i=this.getLengths();let n=0;const r=i.length;let a;a=e||t*i[r-1];let o,s=0,l=r-1;for(;s<=l;)if(n=Math.floor(s+(l-s)/2),o=i[n]-a,o<0)s=n+1;else{if(!(o>0)){l=n;break}l=n-1}if(n=l,i[n]===a)return n/(r-1);const c=i[n];return(n+(a-c)/(i[n+1]-c))/(r-1)}getTangent(t,e){const i=1e-4;let n=t-i,r=t+i;n<0&&(n=0),r>1&&(r=1);const a=this.getPoint(n),o=this.getPoint(r),s=e||(a.isVector2?new sn:new bn);return s.copy(o).sub(a).normalize(),s}getTangentAt(t,e){const i=this.getUtoTmapping(t);return this.getTangent(i,e)}computeFrenetFrames(t,e){const i=new bn,n=[],r=[],a=[],o=new bn,s=new Jn;for(let p=0;p<=t;p++){const e=p/t;n[p]=this.getTangentAt(e,new bn)}r[0]=new bn,a[0]=new bn;let l=Number.MAX_VALUE;const c=Math.abs(n[0].x),u=Math.abs(n[0].y),h=Math.abs(n[0].z);c<=l&&(l=c,i.set(1,0,0)),u<=l&&(l=u,i.set(0,1,0)),h<=l&&i.set(0,0,1),o.crossVectors(n[0],i).normalize(),r[0].crossVectors(n[0],o),a[0].crossVectors(n[0],r[0]);for(let p=1;p<=t;p++){if(r[p]=r[p-1].clone(),a[p]=a[p-1].clone(),o.crossVectors(n[p-1],n[p]),o.length()>Number.EPSILON){o.normalize();const t=Math.acos(tn(n[p-1].dot(n[p]),-1,1));r[p].applyMatrix4(s.makeRotationAxis(o,t))}a[p].crossVectors(n[p],r[p])}if(!0===e){let e=Math.acos(tn(r[0].dot(r[t]),-1,1));e/=t,n[0].dot(o.crossVectors(r[0],r[t]))>0&&(e=-e);for(let i=1;i<=t;i++)r[i].applyMatrix4(s.makeRotationAxis(n[i],e*i)),a[i].crossVectors(n[i],r[i])}return{tangents:n,normals:r,binormals:a}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class Mc extends Tc{constructor(t=0,e=0,i=1,n=1,r=0,a=2*Math.PI,o=!1,s=0){super(),this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=a,this.aClockwise=o,this.aRotation=s}getPoint(t,e){const i=e||new sn,n=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const a=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=a?0:n),!0!==this.aClockwise||a||(r===n?r=-n:r-=n);const o=this.aStartAngle+t*r;let s=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),i=s-this.aX,n=l-this.aY;s=i*t-n*e+this.aX,l=i*e+n*t+this.aY}return i.set(s,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}Mc.prototype.isEllipseCurve=!0;class Cc extends Mc{constructor(t,e,i,n,r,a){super(t,e,i,i,n,r,a),this.type="ArcCurve"}}function Ic(){let t=0,e=0,i=0,n=0;function r(r,a,o,s){t=r,e=o,i=-3*r+3*a-2*o-s,n=2*r-2*a+o+s}return{initCatmullRom:function(t,e,i,n,a){r(e,i,a*(i-t),a*(n-e))},initNonuniformCatmullRom:function(t,e,i,n,a,o,s){let l=(e-t)/a-(i-t)/(a+o)+(i-e)/o,c=(i-e)/o-(n-e)/(o+s)+(n-i)/s;l*=o,c*=o,r(e,i,l,c)},calc:function(r){const a=r*r;return t+e*r+i*a+n*(a*r)}}}Cc.prototype.isArcCurve=!0;const Ac=new bn,kc=new Ic,Rc=new Ic,zc=new Ic;class Pc extends Tc{constructor(t=[],e=!1,i="centripetal",n=.5){super(),this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=i,this.tension=n}getPoint(t,e=new bn){const i=e,n=this.points,r=n.length,a=(r-(this.closed?0:1))*t;let o,s,l=Math.floor(a),c=a-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===c&&l===r-1&&(l=r-2,c=1),this.closed||l>0?o=n[(l-1)%r]:(Ac.subVectors(n[0],n[1]).add(n[0]),o=Ac);const u=n[l%r],h=n[(l+1)%r];if(this.closed||l+2<r?s=n[(l+2)%r]:(Ac.subVectors(n[r-1],n[r-2]).add(n[r-1]),s=Ac),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(o.distanceToSquared(u),t),i=Math.pow(u.distanceToSquared(h),t),n=Math.pow(h.distanceToSquared(s),t);i<1e-4&&(i=1),e<1e-4&&(e=i),n<1e-4&&(n=i),kc.initNonuniformCatmullRom(o.x,u.x,h.x,s.x,e,i,n),Rc.initNonuniformCatmullRom(o.y,u.y,h.y,s.y,e,i,n),zc.initNonuniformCatmullRom(o.z,u.z,h.z,s.z,e,i,n)}else"catmullrom"===this.curveType&&(kc.initCatmullRom(o.x,u.x,h.x,s.x,this.tension),Rc.initCatmullRom(o.y,u.y,h.y,s.y,this.tension),zc.initCatmullRom(o.z,u.z,h.z,s.z,this.tension));return i.set(kc.calc(c),Rc.calc(c),zc.calc(c)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new bn).fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function Dc(t,e,i,n,r){const a=.5*(n-e),o=.5*(r-i),s=t*t;return(2*i-2*n+a+o)*(t*s)+(-3*i+3*n-2*a-o)*s+a*t+i}function Lc(t,e,i,n){return function(t,e){const i=1-t;return i*i*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,i)+function(t,e){return t*t*e}(t,n)}function Bc(t,e,i,n,r){return function(t,e){const i=1-t;return i*i*i*e}(t,e)+function(t,e){const i=1-t;return 3*i*i*t*e}(t,i)+function(t,e){return 3*(1-t)*t*t*e}(t,n)+function(t,e){return t*t*t*e}(t,r)}Pc.prototype.isCatmullRomCurve3=!0;class Oc extends Tc{constructor(t=new sn,e=new sn,i=new sn,n=new sn){super(),this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new sn){const i=e,n=this.v0,r=this.v1,a=this.v2,o=this.v3;return i.set(Bc(t,n.x,r.x,a.x,o.x),Bc(t,n.y,r.y,a.y,o.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}Oc.prototype.isCubicBezierCurve=!0;class Fc extends Tc{constructor(t=new bn,e=new bn,i=new bn,n=new bn){super(),this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new bn){const i=e,n=this.v0,r=this.v1,a=this.v2,o=this.v3;return i.set(Bc(t,n.x,r.x,a.x,o.x),Bc(t,n.y,r.y,a.y,o.y),Bc(t,n.z,r.z,a.z,o.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}Fc.prototype.isCubicBezierCurve3=!0;class Nc extends Tc{constructor(t=new sn,e=new sn){super(),this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new sn){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){const i=e||new sn;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Nc.prototype.isLineCurve=!0;class Uc extends Tc{constructor(t=new sn,e=new sn,i=new sn){super(),this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new sn){const i=e,n=this.v0,r=this.v1,a=this.v2;return i.set(Lc(t,n.x,r.x,a.x),Lc(t,n.y,r.y,a.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Uc.prototype.isQuadraticBezierCurve=!0;class $c extends Tc{constructor(t=new bn,e=new bn,i=new bn){super(),this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new bn){const i=e,n=this.v0,r=this.v1,a=this.v2;return i.set(Lc(t,n.x,r.x,a.x),Lc(t,n.y,r.y,a.y),Lc(t,n.z,r.z,a.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}$c.prototype.isQuadraticBezierCurve3=!0;class Vc extends Tc{constructor(t=[]){super(),this.type="SplineCurve",this.points=t}getPoint(t,e=new sn){const i=e,n=this.points,r=(n.length-1)*t,a=Math.floor(r),o=r-a,s=n[0===a?a:a-1],l=n[a],c=n[a>n.length-2?n.length-1:a+1],u=n[a>n.length-3?n.length-1:a+2];return i.set(Dc(o,s.x,l.x,c.x,u.x),Dc(o,s.y,l.y,c.y,u.y)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new sn).fromArray(i))}return this}}Vc.prototype.isSplineCurve=!0;var jc=Object.freeze({__proto__:null,ArcCurve:Cc,CatmullRomCurve3:Pc,CubicBezierCurve:Oc,CubicBezierCurve3:Fc,EllipseCurve:Mc,LineCurve:Nc,LineCurve3:class extends Tc{constructor(t=new bn,e=new bn){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=t,this.v2=e}getPoint(t,e=new bn){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},QuadraticBezierCurve:Uc,QuadraticBezierCurve3:$c,SplineCurve:Vc});class qc extends Tc{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new Nc(e,t))}getPoint(t,e){const i=t*this.getLength(),n=this.getCurveLengths();let r=0;for(;r<n.length;){if(n[r]>=i){const t=n[r]-i,a=this.curves[r],o=a.getLength(),s=0===o?0:1-t/o;return a.getPointAt(s,e)}r++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let i=0,n=this.curves.length;i<n;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let i;for(let n=0,r=this.curves;n<r.length;n++){const a=r[n],o=a&&a.isEllipseCurve?2*t:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?t*a.points.length:t,s=a.getPoints(o);for(let t=0;t<s.length;t++){const n=s[t];i&&i.equals(n)||(e.push(n),i=n)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,i=this.curves.length;e<i;e++){const i=this.curves[e];t.curves.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push((new jc[i.type]).fromJSON(i))}return this}}class Gc extends qc{constructor(t){super(),this.type="Path",this.currentPoint=new sn,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const i=new Nc(this.currentPoint.clone(),new sn(t,e));return this.curves.push(i),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,i,n){const r=new Uc(this.currentPoint.clone(),new sn(t,e),new sn(i,n));return this.curves.push(r),this.currentPoint.set(i,n),this}bezierCurveTo(t,e,i,n,r,a){const o=new Oc(this.currentPoint.clone(),new sn(t,e),new sn(i,n),new sn(r,a));return this.curves.push(o),this.currentPoint.set(r,a),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),i=new Vc(e);return this.curves.push(i),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,i,n,r,a){const o=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(t+o,e+s,i,n,r,a),this}absarc(t,e,i,n,r,a){return this.absellipse(t,e,i,i,n,r,a),this}ellipse(t,e,i,n,r,a,o,s){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+l,e+c,i,n,r,a,o,s),this}absellipse(t,e,i,n,r,a,o,s){const l=new Mc(t,e,i,n,r,a,o,s);if(this.curves.length>0){const t=l.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class Hc extends Gc{constructor(t){super(t),this.uuid=Qi(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let i=0,n=this.holes.length;i<n;i++)e[i]=this.holes[i].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,i=this.holes.length;e<i;e++){const i=this.holes[e];t.holes.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push((new Gc).fromJSON(i))}return this}}const Wc=function(t,e,i=2){const n=e&&e.length,r=n?e[0]*i:t.length;let a=Zc(t,0,r,i,!0);const o=[];if(!a||a.next===a.prev)return o;let s,l,c,u,h,p,d;if(n&&(a=function(t,e,i,n){const r=[];let a,o,s,l,c;for(a=0,o=e.length;a<o;a++)s=e[a]*n,l=a<o-1?e[a+1]*n:t.length,c=Zc(t,s,l,n,!1),c===c.next&&(c.steiner=!0),r.push(au(c));for(r.sort(eu),a=0;a<r.length;a++)iu(r[a],i),i=Yc(i,i.next);return i}(t,e,a,i)),t.length>80*i){s=c=t[0],l=u=t[1];for(let e=i;e<r;e+=i)h=t[e],p=t[e+1],h<s&&(s=h),p<l&&(l=p),h>c&&(c=h),p>u&&(u=p);d=Math.max(c-s,u-l),d=0!==d?1/d:0}return Xc(a,o,i,s,l,d),o};function Zc(t,e,i,n,r){let a,o;if(r===function(t,e,i,n){let r=0;for(let a=e,o=i-n;a<i;a+=n)r+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;return r}(t,e,i,n)>0)for(a=e;a<i;a+=n)o=mu(a,t[a],t[a+1],o);else for(a=i-n;a>=e;a-=n)o=mu(a,t[a],t[a+1],o);return o&&cu(o,o.next)&&(gu(o),o=o.next),o}function Yc(t,e){if(!t)return t;e||(e=t);let i,n=t;do{if(i=!1,n.steiner||!cu(n,n.next)&&0!==lu(n.prev,n,n.next))n=n.next;else{if(gu(n),n=e=n.prev,n===n.next)break;i=!0}}while(i||n!==e);return e}function Xc(t,e,i,n,r,a,o){if(!t)return;!o&&a&&function(t,e,i,n){let r=t;do{null===r.z&&(r.z=ru(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){let e,i,n,r,a,o,s,l,c=1;do{for(i=t,t=null,a=null,o=0;i;){for(o++,n=i,s=0,e=0;e<c&&(s++,n=n.nextZ,n);e++);for(l=c;s>0||l>0&&n;)0!==s&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,s--):(r=n,n=n.nextZ,l--),a?a.nextZ=r:t=r,r.prevZ=a,a=r;i=n}a.nextZ=null,c*=2}while(o>1)}(r)}(t,n,r,a);let s,l,c=t;for(;t.prev!==t.next;)if(s=t.prev,l=t.next,a?Jc(t,n,r,a):Kc(t))e.push(s.i/i),e.push(t.i/i),e.push(l.i/i),gu(t),t=l.next,c=l.next;else if((t=l)===c){o?1===o?Xc(t=Qc(Yc(t),e,i),e,i,n,r,a,2):2===o&&tu(t,e,i,n,r,a):Xc(Yc(t),e,i,n,r,a,1);break}}function Kc(t){const e=t.prev,i=t,n=t.next;if(lu(e,i,n)>=0)return!1;let r=t.next.next;for(;r!==t.prev;){if(ou(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&lu(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function Jc(t,e,i,n){const r=t.prev,a=t,o=t.next;if(lu(r,a,o)>=0)return!1;const s=r.x<a.x?r.x<o.x?r.x:o.x:a.x<o.x?a.x:o.x,l=r.y<a.y?r.y<o.y?r.y:o.y:a.y<o.y?a.y:o.y,c=r.x>a.x?r.x>o.x?r.x:o.x:a.x>o.x?a.x:o.x,u=r.y>a.y?r.y>o.y?r.y:o.y:a.y>o.y?a.y:o.y,h=ru(s,l,e,i,n),p=ru(c,u,e,i,n);let d=t.prevZ,f=t.nextZ;for(;d&&d.z>=h&&f&&f.z<=p;){if(d!==t.prev&&d!==t.next&&ou(r.x,r.y,a.x,a.y,o.x,o.y,d.x,d.y)&&lu(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,f!==t.prev&&f!==t.next&&ou(r.x,r.y,a.x,a.y,o.x,o.y,f.x,f.y)&&lu(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;d&&d.z>=h;){if(d!==t.prev&&d!==t.next&&ou(r.x,r.y,a.x,a.y,o.x,o.y,d.x,d.y)&&lu(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;f&&f.z<=p;){if(f!==t.prev&&f!==t.next&&ou(r.x,r.y,a.x,a.y,o.x,o.y,f.x,f.y)&&lu(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function Qc(t,e,i){let n=t;do{const r=n.prev,a=n.next.next;!cu(r,a)&&uu(r,n,n.next,a)&&du(r,a)&&du(a,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(a.i/i),gu(n),gu(n.next),n=t=a),n=n.next}while(n!==t);return Yc(n)}function tu(t,e,i,n,r,a){let o=t;do{let t=o.next.next;for(;t!==o.prev;){if(o.i!==t.i&&su(o,t)){let s=fu(o,t);return o=Yc(o,o.next),s=Yc(s,s.next),Xc(o,e,i,n,r,a),void Xc(s,e,i,n,r,a)}t=t.next}o=o.next}while(o!==t)}function eu(t,e){return t.x-e.x}function iu(t,e){if(e=function(t,e){let i=e;const n=t.x,r=t.y;let a,o=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){const t=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=n&&t>o){if(o=t,t===n){if(r===i.y)return i;if(r===i.next.y)return i.next}a=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!a)return null;if(n===o)return a;const s=a,l=a.x,c=a.y;let u,h=1/0;i=a;do{n>=i.x&&i.x>=l&&n!==i.x&&ou(r<c?n:o,r,l,c,r<c?o:n,r,i.x,i.y)&&(u=Math.abs(r-i.y)/(n-i.x),du(i,t)&&(u<h||u===h&&(i.x>a.x||i.x===a.x&&nu(a,i)))&&(a=i,h=u)),i=i.next}while(i!==s);return a}(t,e),e){const i=fu(e,t);Yc(e,e.next),Yc(i,i.next)}}function nu(t,e){return lu(t.prev,t,e.prev)<0&&lu(e.next,t,t.next)<0}function ru(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function au(t){let e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function ou(t,e,i,n,r,a,o,s){return(r-o)*(e-s)-(t-o)*(a-s)>=0&&(t-o)*(n-s)-(i-o)*(e-s)>=0&&(i-o)*(a-s)-(r-o)*(n-s)>=0}function su(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&uu(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(du(t,e)&&du(e,t)&&function(t,e){let i=t,n=!1;const r=(t.x+e.x)/2,a=(t.y+e.y)/2;do{i.y>a!==i.next.y>a&&i.next.y!==i.y&&r<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(lu(t.prev,t,e.prev)||lu(t,e.prev,e))||cu(t,e)&&lu(t.prev,t,t.next)>0&&lu(e.prev,e,e.next)>0)}function lu(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function cu(t,e){return t.x===e.x&&t.y===e.y}function uu(t,e,i,n){const r=pu(lu(t,e,i)),a=pu(lu(t,e,n)),o=pu(lu(i,n,t)),s=pu(lu(i,n,e));return r!==a&&o!==s||(!(0!==r||!hu(t,i,e))||(!(0!==a||!hu(t,n,e))||(!(0!==o||!hu(i,t,n))||!(0!==s||!hu(i,e,n)))))}function hu(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function pu(t){return t>0?1:t<0?-1:0}function du(t,e){return lu(t.prev,t,t.next)<0?lu(t,e,t.next)>=0&&lu(t,t.prev,e)>=0:lu(t,e,t.prev)<0||lu(t,t.next,e)<0}function fu(t,e){const i=new _u(t.i,t.x,t.y),n=new _u(e.i,e.x,e.y),r=t.next,a=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,a.next=n,n.prev=a,n}function mu(t,e,i,n){const r=new _u(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function gu(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function _u(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class yu{static area(t){const e=t.length;let i=0;for(let n=e-1,r=0;r<e;n=r++)i+=t[n].x*t[r].y-t[r].x*t[n].y;return.5*i}static isClockWise(t){return yu.area(t)<0}static triangulateShape(t,e){const i=[],n=[],r=[];vu(t),xu(i,t);let a=t.length;e.forEach(vu);for(let s=0;s<e.length;s++)n.push(a),a+=e[s].length,xu(i,e[s]);const o=Wc(i,n);for(let s=0;s<o.length;s+=3)r.push(o.slice(s,s+3));return r}}function vu(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function xu(t,e){for(let i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}class bu extends ra{constructor(t=new Hc([new sn(.5,.5),new sn(-.5,.5),new sn(-.5,-.5),new sn(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const i=this,n=[],r=[];for(let o=0,s=t.length;o<s;o++){a(t[o])}function a(t){const a=[],o=void 0!==e.curveSegments?e.curveSegments:12,s=void 0!==e.steps?e.steps:1;let l=void 0!==e.depth?e.depth:1,c=void 0===e.bevelEnabled||e.bevelEnabled,u=void 0!==e.bevelThickness?e.bevelThickness:.2,h=void 0!==e.bevelSize?e.bevelSize:u-.1,p=void 0!==e.bevelOffset?e.bevelOffset:0,d=void 0!==e.bevelSegments?e.bevelSegments:3;const f=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:wu;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=e.amount);let g,_,y,v,x,b=!1;f&&(g=f.getSpacedPoints(s),b=!0,c=!1,_=f.computeFrenetFrames(s,!1),y=new bn,v=new bn,x=new bn),c||(d=0,u=0,h=0,p=0);const w=t.extractPoints(o);let S=w.shape;const E=w.holes;if(!yu.isClockWise(S)){S=S.reverse();for(let t=0,e=E.length;t<e;t++){const e=E[t];yu.isClockWise(e)&&(E[t]=e.reverse())}}const T=yu.triangulateShape(S,E),M=S;for(let e=0,i=E.length;e<i;e++){const t=E[e];S=S.concat(t)}function C(t,e,i){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(i).add(t)}const I=S.length,A=T.length;function k(t,e,i){let n,r,a;const o=t.x-e.x,s=t.y-e.y,l=i.x-t.x,c=i.y-t.y,u=o*o+s*s,h=o*c-s*l;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),p=Math.sqrt(l*l+c*c),d=e.x-s/h,f=e.y+o/h,m=((i.x-c/p-d)*c-(i.y+l/p-f)*l)/(o*c-s*l);n=d+o*m-t.x,r=f+s*m-t.y;const g=n*n+r*r;if(g<=2)return new sn(n,r);a=Math.sqrt(g/2)}else{let t=!1;o>Number.EPSILON?l>Number.EPSILON&&(t=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(t=!0):Math.sign(s)===Math.sign(c)&&(t=!0),t?(n=-s,r=o,a=Math.sqrt(u)):(n=o,r=s,a=Math.sqrt(u/2))}return new sn(n/a,r/a)}const R=[];for(let e=0,i=M.length,n=i-1,r=e+1;e<i;e++,n++,r++)n===i&&(n=0),r===i&&(r=0),R[e]=k(M[e],M[n],M[r]);const z=[];let P,D=R.concat();for(let e=0,i=E.length;e<i;e++){const t=E[e];P=[];for(let e=0,i=t.length,n=i-1,r=e+1;e<i;e++,n++,r++)n===i&&(n=0),r===i&&(r=0),P[e]=k(t[e],t[n],t[r]);z.push(P),D=D.concat(P)}for(let e=0;e<d;e++){const t=e/d,i=u*Math.cos(t*Math.PI/2),n=h*Math.sin(t*Math.PI/2)+p;for(let e=0,r=M.length;e<r;e++){const t=C(M[e],R[e],n);O(t.x,t.y,-i)}for(let e=0,r=E.length;e<r;e++){const t=E[e];P=z[e];for(let e=0,r=t.length;e<r;e++){const r=C(t[e],P[e],n);O(r.x,r.y,-i)}}}const L=h+p;for(let e=0;e<I;e++){const t=c?C(S[e],D[e],L):S[e];b?(v.copy(_.normals[0]).multiplyScalar(t.x),y.copy(_.binormals[0]).multiplyScalar(t.y),x.copy(g[0]).add(v).add(y),O(x.x,x.y,x.z)):O(t.x,t.y,0)}for(let e=1;e<=s;e++)for(let t=0;t<I;t++){const i=c?C(S[t],D[t],L):S[t];b?(v.copy(_.normals[e]).multiplyScalar(i.x),y.copy(_.binormals[e]).multiplyScalar(i.y),x.copy(g[e]).add(v).add(y),O(x.x,x.y,x.z)):O(i.x,i.y,l/s*e)}for(let e=d-1;e>=0;e--){const t=e/d,i=u*Math.cos(t*Math.PI/2),n=h*Math.sin(t*Math.PI/2)+p;for(let e=0,r=M.length;e<r;e++){const t=C(M[e],R[e],n);O(t.x,t.y,l+i)}for(let e=0,r=E.length;e<r;e++){const t=E[e];P=z[e];for(let e=0,r=t.length;e<r;e++){const r=C(t[e],P[e],n);b?O(r.x,r.y+g[s-1].y,g[s-1].x+i):O(r.x,r.y,l+i)}}}function B(t,e){let i=t.length;for(;--i>=0;){const n=i;let r=i-1;r<0&&(r=t.length-1);for(let t=0,i=s+2*d;t<i;t++){const i=I*t,a=I*(t+1);N(e+n+i,e+r+i,e+r+a,e+n+a)}}}function O(t,e,i){a.push(t),a.push(e),a.push(i)}function F(t,e,r){U(t),U(e),U(r);const a=n.length/3,o=m.generateTopUV(i,n,a-3,a-2,a-1);$(o[0]),$(o[1]),$(o[2])}function N(t,e,r,a){U(t),U(e),U(a),U(e),U(r),U(a);const o=n.length/3,s=m.generateSideWallUV(i,n,o-6,o-3,o-2,o-1);$(s[0]),$(s[1]),$(s[3]),$(s[1]),$(s[2]),$(s[3])}function U(t){n.push(a[3*t+0]),n.push(a[3*t+1]),n.push(a[3*t+2])}function $(t){r.push(t.x),r.push(t.y)}!function(){const t=n.length/3;if(c){let t=0,e=I*t;for(let i=0;i<A;i++){const t=T[i];F(t[2]+e,t[1]+e,t[0]+e)}t=s+2*d,e=I*t;for(let i=0;i<A;i++){const t=T[i];F(t[0]+e,t[1]+e,t[2]+e)}}else{for(let t=0;t<A;t++){const e=T[t];F(e[2],e[1],e[0])}for(let t=0;t<A;t++){const e=T[t];F(e[0]+I*s,e[1]+I*s,e[2]+I*s)}}i.addGroup(t,n.length/3-t,0)}(),function(){const t=n.length/3;let e=0;B(M,e),e+=M.length;for(let i=0,n=E.length;i<n;i++){const t=E[i];B(t,e),e+=t.length}i.addGroup(t,n.length/3-t,1)}()}this.setAttribute("position",new Xr(n,3)),this.setAttribute("uv",new Xr(r,2)),this.computeVertexNormals()}toJSON(){const t=super.toJSON();return function(t,e,i){if(i.shapes=[],Array.isArray(t))for(let n=0,r=t.length;n<r;n++){const e=t[n];i.shapes.push(e.uuid)}else i.shapes.push(t.uuid);void 0!==e.extrudePath&&(i.options.extrudePath=e.extrudePath.toJSON());return i}(this.parameters.shapes,this.parameters.options,t)}static fromJSON(t,e){const i=[];for(let r=0,a=t.shapes.length;r<a;r++){const n=e[t.shapes[r]];i.push(n)}const n=t.options.extrudePath;return void 0!==n&&(t.options.extrudePath=(new jc[n.type]).fromJSON(n)),new bu(i,t.options)}}const wu={generateTopUV:function(t,e,i,n,r){const a=e[3*i],o=e[3*i+1],s=e[3*n],l=e[3*n+1],c=e[3*r],u=e[3*r+1];return[new sn(a,o),new sn(s,l),new sn(c,u)]},generateSideWallUV:function(t,e,i,n,r,a){const o=e[3*i],s=e[3*i+1],l=e[3*i+2],c=e[3*n],u=e[3*n+1],h=e[3*n+2],p=e[3*r],d=e[3*r+1],f=e[3*r+2],m=e[3*a],g=e[3*a+1],_=e[3*a+2];return Math.abs(s-u)<Math.abs(o-c)?[new sn(o,1-l),new sn(c,1-h),new sn(p,1-f),new sn(m,1-_)]:[new sn(s,1-l),new sn(u,1-h),new sn(d,1-f),new sn(g,1-_)]}};class Su extends ra{constructor(t=new Hc([new sn(0,.5),new sn(-.5,-.5),new sn(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const i=[],n=[],r=[],a=[];let o=0,s=0;if(!1===Array.isArray(t))l(t);else for(let c=0;c<t.length;c++)l(t[c]),this.addGroup(o,s,c),o+=s,s=0;function l(t){const o=n.length/3,l=t.extractPoints(e);let c=l.shape;const u=l.holes;!1===yu.isClockWise(c)&&(c=c.reverse());for(let e=0,i=u.length;e<i;e++){const t=u[e];!0===yu.isClockWise(t)&&(u[e]=t.reverse())}const h=yu.triangulateShape(c,u);for(let e=0,i=u.length;e<i;e++){const t=u[e];c=c.concat(t)}for(let e=0,i=c.length;e<i;e++){const t=c[e];n.push(t.x,t.y,0),r.push(0,0,1),a.push(t.x,t.y)}for(let e=0,n=h.length;e<n;e++){const t=h[e],n=t[0]+o,r=t[1]+o,a=t[2]+o;i.push(n,r,a),s+=3}}this.setIndex(i),this.setAttribute("position",new Xr(n,3)),this.setAttribute("normal",new Xr(r,3)),this.setAttribute("uv",new Xr(a,2))}toJSON(){const t=super.toJSON();return function(t,e){if(e.shapes=[],Array.isArray(t))for(let i=0,n=t.length;i<n;i++){const n=t[i];e.shapes.push(n.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}static fromJSON(t,e){const i=[];for(let n=0,r=t.shapes.length;n<r;n++){const r=e[t.shapes[n]];i.push(r)}return new Su(i,t.curveSegments)}}class Eu extends ra{constructor(t=1,e=32,i=16,n=0,r=2*Math.PI,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:n,phiLength:r,thetaStart:a,thetaLength:o},e=Math.max(3,Math.floor(e)),i=Math.max(2,Math.floor(i));const s=Math.min(a+o,Math.PI);let l=0;const c=[],u=new bn,h=new bn,p=[],d=[],f=[],m=[];for(let g=0;g<=i;g++){const p=[],_=g/i;let y=0;0==g&&0==a?y=.5/e:g==i&&s==Math.PI&&(y=-.5/e);for(let i=0;i<=e;i++){const s=i/e;u.x=-t*Math.cos(n+s*r)*Math.sin(a+_*o),u.y=t*Math.cos(a+_*o),u.z=t*Math.sin(n+s*r)*Math.sin(a+_*o),d.push(u.x,u.y,u.z),h.copy(u).normalize(),f.push(h.x,h.y,h.z),m.push(s+y,1-_),p.push(l++)}c.push(p)}for(let g=0;g<i;g++)for(let t=0;t<e;t++){const e=c[g][t+1],n=c[g][t],r=c[g+1][t],o=c[g+1][t+1];(0!==g||a>0)&&p.push(e,n,o),(g!==i-1||s<Math.PI)&&p.push(n,r,o)}this.setIndex(p),this.setAttribute("position",new Xr(d,3)),this.setAttribute("normal",new Xr(f,3)),this.setAttribute("uv",new Xr(m,2))}static fromJSON(t){return new Eu(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}(class extends Br{constructor(t){super(),this.type="ShadowMaterial",this.color=new jr(0),this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this}}).prototype.isShadowMaterial=!0;class Tu extends Br{constructor(t){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new jr(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new sn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}Tu.prototype.isMeshStandardMaterial=!0;(class extends Tu{constructor(t){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new sn(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return tn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenColor=new jr(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new jr(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new jr(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(t)}get sheen(){return this._sheen}set sheen(t){this._sheen>0!==t>0&&this.version++,this._sheen=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!==t>0&&this.version++,this._clearcoat=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!==t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}).prototype.isMeshPhysicalMaterial=!0;(class extends Br{constructor(t){super(),this.type="MeshPhongMaterial",this.color=new jr(16777215),this.specular=new jr(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new sn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}).prototype.isMeshPhongMaterial=!0;(class extends Br{constructor(t){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new jr(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new sn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}).prototype.isMeshToonMaterial=!0;(class extends Br{constructor(t){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new sn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}).prototype.isMeshNormalMaterial=!0;(class extends Br{constructor(t){super(),this.type="MeshLambertMaterial",this.color=new jr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}).prototype.isMeshLambertMaterial=!0;(class extends Br{constructor(t){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new jr(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new sn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this}}).prototype.isMeshMatcapMaterial=!0;(class extends lc{constructor(t){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}).prototype.isLineDashedMaterial=!0;const Mu={arraySlice:function(t,e,i){return Mu.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==i?i:t.length)):t.slice(e,i)},convertArray:function(t,e,i){return!t||!i&&t.constructor===e?t:"number"===typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){const e=t.length,i=new Array(e);for(let n=0;n!==e;++n)i[n]=n;return i.sort((function(e,i){return t[e]-t[i]})),i},sortedArray:function(t,e,i){const n=t.length,r=new t.constructor(n);for(let a=0,o=0;o!==n;++a){const n=i[a]*e;for(let i=0;i!==e;++i)r[o++]=t[n+i]}return r},flattenJSON:function(t,e,i,n){let r=1,a=t[0];for(;void 0!==a&&void 0===a[n];)a=t[r++];if(void 0===a)return;let o=a[n];if(void 0!==o)if(Array.isArray(o))do{o=a[n],void 0!==o&&(e.push(a.time),i.push.apply(i,o)),a=t[r++]}while(void 0!==a);else if(void 0!==o.toArray)do{o=a[n],void 0!==o&&(e.push(a.time),o.toArray(i,i.length)),a=t[r++]}while(void 0!==a);else do{o=a[n],void 0!==o&&(e.push(a.time),i.push(o)),a=t[r++]}while(void 0!==a)},subclip:function(t,e,i,n,r=30){const a=t.clone();a.name=e;const o=[];for(let l=0;l<a.tracks.length;++l){const t=a.tracks[l],e=t.getValueSize(),s=[],c=[];for(let a=0;a<t.times.length;++a){const o=t.times[a]*r;if(!(o<i||o>=n)){s.push(t.times[a]);for(let i=0;i<e;++i)c.push(t.values[a*e+i])}}0!==s.length&&(t.times=Mu.convertArray(s,t.times.constructor),t.values=Mu.convertArray(c,t.values.constructor),o.push(t))}a.tracks=o;let s=1/0;for(let l=0;l<a.tracks.length;++l)s>a.tracks[l].times[0]&&(s=a.tracks[l].times[0]);for(let l=0;l<a.tracks.length;++l)a.tracks[l].shift(-1*s);return a.resetDuration(),a},makeClipAdditive:function(t,e=0,i=t,n=30){n<=0&&(n=30);const r=i.tracks.length,a=e/n;for(let o=0;o<r;++o){const e=i.tracks[o],n=e.ValueTypeName;if("bool"===n||"string"===n)continue;const r=t.tracks.find((function(t){return t.name===e.name&&t.ValueTypeName===n}));if(void 0===r)continue;let s=0;const l=e.getValueSize();e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(s=l/3);let c=0;const u=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);const h=e.times.length-1;let p;if(a<=e.times[0]){const t=s,i=l-s;p=Mu.arraySlice(e.values,t,i)}else if(a>=e.times[h]){const t=h*l+s,i=t+l-s;p=Mu.arraySlice(e.values,t,i)}else{const t=e.createInterpolant(),i=s,n=l-s;t.evaluate(a),p=Mu.arraySlice(t.resultBuffer,i,n)}if("quaternion"===n){(new xn).fromArray(p).normalize().conjugate().toArray(p)}const d=r.times.length;for(let t=0;t<d;++t){const e=t*u+c;if("quaternion"===n)xn.multiplyQuaternionsFlat(r.values,e,p,0,r.values,e);else{const t=u-2*c;for(let i=0;i<t;++i)r.values[e+i]-=p[i]}}}return t.blendMode=2501,t}};class Cu{constructor(t,e,i,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let i=this._cachedIndex,n=e[i],r=e[i-1];t:{e:{let a;i:{n:if(!(t<n)){for(let a=i+2;;){if(void 0===n){if(t<r)break n;return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,t,r)}if(i===a)break;if(r=n,n=e[++i],t<n)break e}a=e.length;break i}if(t>=r)break t;{const o=e[1];t<o&&(i=2,r=o);for(let a=i-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(i===a)break;if(n=r,r=e[--i-1],t>=r)break e}a=i,i=0}}for(;i<a;){const n=i+a>>>1;t<e[n]?a=n:i=n+1}if(n=e[i],r=e[i-1],void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(void 0===n)return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,r,t)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,t,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=t*n;for(let a=0;a!==n;++a)e[a]=i[r+a];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}Cu.prototype.beforeStart_=Cu.prototype.copySampleValue_,Cu.prototype.afterEnd_=Cu.prototype.copySampleValue_;class Iu extends Cu{constructor(t,e,i,n){super(t,e,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Li,endingEnd:Li}}intervalChanged_(t,e,i){const n=this.parameterPositions;let r=t-2,a=t+1,o=n[r],s=n[a];if(void 0===o)switch(this.getSettings_().endingStart){case Bi:r=t,o=2*e-i;break;case Oi:r=n.length-2,o=e+n[r]-n[r+1];break;default:r=t,o=i}if(void 0===s)switch(this.getSettings_().endingEnd){case Bi:a=t,s=2*i-e;break;case Oi:a=1,s=i+n[1]-n[0];break;default:a=t-1,s=e}const l=.5*(i-e),c=this.valueSize;this._weightPrev=l/(e-o),this._weightNext=l/(s-i),this._offsetPrev=r*c,this._offsetNext=a*c}interpolate_(t,e,i,n){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=t*o,l=s-o,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,p=this._weightNext,d=(i-e)/(n-e),f=d*d,m=f*d,g=-h*m+2*h*f-h*d,_=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*d+1,y=(-1-p)*m+(1.5+p)*f+.5*d,v=p*m-p*f;for(let x=0;x!==o;++x)r[x]=g*a[c+x]+_*a[l+x]+y*a[s+x]+v*a[u+x];return r}}class Au extends Cu{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=t*o,l=s-o,c=(i-e)/(n-e),u=1-c;for(let h=0;h!==o;++h)r[h]=a[l+h]*u+a[s+h]*c;return r}}class ku extends Cu{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t){return this.copySampleValue_(t-1)}}class Ru{constructor(t,e,i,n){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Mu.convertArray(e,this.TimeBufferType),this.values=Mu.convertArray(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let i;if(e.toJSON!==this.toJSON)i=e.toJSON(t);else{i={name:t.name,times:Mu.convertArray(t.times,Array),values:Mu.convertArray(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(i.interpolation=e)}return i.type=t.ValueTypeName,i}InterpolantFactoryMethodDiscrete(t){return new ku(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Au(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new Iu(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case zi:e=this.InterpolantFactoryMethodDiscrete;break;case Pi:e=this.InterpolantFactoryMethodLinear;break;case Di:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return zi;case this.InterpolantFactoryMethodLinear:return Pi;case this.InterpolantFactoryMethodSmooth:return Di}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]*=t}return this}trim(t,e){const i=this.times,n=i.length;let r=0,a=n-1;for(;r!==n&&i[r]<t;)++r;for(;-1!==a&&i[a]>e;)--a;if(++a,0!==r||a!==n){r>=a&&(a=Math.max(a,1),r=a-1);const t=this.getValueSize();this.times=Mu.arraySlice(i,r,a),this.values=Mu.arraySlice(this.values,r*t,a*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const i=this.times,n=this.values,r=i.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let a=null;for(let o=0;o!==r;o++){const e=i[o];if("number"===typeof e&&isNaN(e)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,e),t=!1;break}if(null!==a&&a>e){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,e,a),t=!1;break}a=e}if(void 0!==n&&Mu.isTypedArray(n))for(let o=0,s=n.length;o!==s;++o){const e=n[o];if(isNaN(e)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,e),t=!1;break}}return t}optimize(){const t=Mu.arraySlice(this.times),e=Mu.arraySlice(this.values),i=this.getValueSize(),n=this.getInterpolation()===Di,r=t.length-1;let a=1;for(let o=1;o<r;++o){let r=!1;const s=t[o];if(s!==t[o+1]&&(1!==o||s!==t[0]))if(n)r=!0;else{const t=o*i,n=t-i,a=t+i;for(let o=0;o!==i;++o){const i=e[t+o];if(i!==e[n+o]||i!==e[a+o]){r=!0;break}}}if(r){if(o!==a){t[a]=t[o];const n=o*i,r=a*i;for(let t=0;t!==i;++t)e[r+t]=e[n+t]}++a}}if(r>0){t[a]=t[r];for(let t=r*i,n=a*i,o=0;o!==i;++o)e[n+o]=e[t+o];++a}return a!==t.length?(this.times=Mu.arraySlice(t,0,a),this.values=Mu.arraySlice(e,0,a*i)):(this.times=t,this.values=e),this}clone(){const t=Mu.arraySlice(this.times,0),e=Mu.arraySlice(this.values,0),i=new(0,this.constructor)(this.name,t,e);return i.createInterpolant=this.createInterpolant,i}}Ru.prototype.TimeBufferType=Float32Array,Ru.prototype.ValueBufferType=Float32Array,Ru.prototype.DefaultInterpolation=Pi;class zu extends Ru{}zu.prototype.ValueTypeName="bool",zu.prototype.ValueBufferType=Array,zu.prototype.DefaultInterpolation=zi,zu.prototype.InterpolantFactoryMethodLinear=void 0,zu.prototype.InterpolantFactoryMethodSmooth=void 0;class Pu extends Ru{}Pu.prototype.ValueTypeName="color";class Du extends Ru{}Du.prototype.ValueTypeName="number";class Lu extends Cu{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=(i-e)/(n-e);let l=t*o;for(let c=l+o;l!==c;l+=4)xn.slerpFlat(r,0,a,l-o,a,l,s);return r}}class Bu extends Ru{InterpolantFactoryMethodLinear(t){return new Lu(this.times,this.values,this.getValueSize(),t)}}Bu.prototype.ValueTypeName="quaternion",Bu.prototype.DefaultInterpolation=Pi,Bu.prototype.InterpolantFactoryMethodSmooth=void 0;class Ou extends Ru{}Ou.prototype.ValueTypeName="string",Ou.prototype.ValueBufferType=Array,Ou.prototype.DefaultInterpolation=zi,Ou.prototype.InterpolantFactoryMethodLinear=void 0,Ou.prototype.InterpolantFactoryMethodSmooth=void 0;class Fu extends Ru{}Fu.prototype.ValueTypeName="vector";class Nu{constructor(t,e=-1,i,n=2500){this.name=t,this.tracks=i,this.duration=e,this.blendMode=n,this.uuid=Qi(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],i=t.tracks,n=1/(t.fps||1);for(let a=0,o=i.length;a!==o;++a)e.push(Uu(i[a]).scale(n));const r=new this(t.name,t.duration,e,t.blendMode);return r.uuid=t.uuid,r}static toJSON(t){const e=[],i=t.tracks,n={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let r=0,a=i.length;r!==a;++r)e.push(Ru.toJSON(i[r]));return n}static CreateFromMorphTargetSequence(t,e,i,n){const r=e.length,a=[];for(let o=0;o<r;o++){let t=[],s=[];t.push((o+r-1)%r,o,(o+1)%r),s.push(0,1,0);const l=Mu.getKeyframeOrder(t);t=Mu.sortedArray(t,1,l),s=Mu.sortedArray(s,1,l),n||0!==t[0]||(t.push(r),s.push(s[0])),a.push(new Du(".morphTargetInfluences["+e[o].name+"]",t,s).scale(1/i))}return new this(t,-1,a)}static findByName(t,e){let i=t;if(!Array.isArray(t)){const e=t;i=e.geometry&&e.geometry.animations||e.animations}for(let n=0;n<i.length;n++)if(i[n].name===e)return i[n];return null}static CreateClipsFromMorphTargetSequences(t,e,i){const n={},r=/^([\w-]*?)([\d]+)$/;for(let o=0,s=t.length;o<s;o++){const e=t[o],i=e.name.match(r);if(i&&i.length>1){const t=i[1];let r=n[t];r||(n[t]=r=[]),r.push(e)}}const a=[];for(const o in n)a.push(this.CreateFromMorphTargetSequence(o,n[o],e,i));return a}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(t,e,i,n,r){if(0!==i.length){const a=[],o=[];Mu.flattenJSON(i,a,o,n),0!==a.length&&r.push(new t(e,a,o))}},n=[],r=t.name||"default",a=t.fps||30,o=t.blendMode;let s=t.length||-1;const l=t.hierarchy||[];for(let c=0;c<l.length;c++){const t=l[c].keys;if(t&&0!==t.length)if(t[0].morphTargets){const e={};let i;for(i=0;i<t.length;i++)if(t[i].morphTargets)for(let n=0;n<t[i].morphTargets.length;n++)e[t[i].morphTargets[n]]=-1;for(const r in e){const e=[],a=[];for(let n=0;n!==t[i].morphTargets.length;++n){const n=t[i];e.push(n.time),a.push(n.morphTarget===r?1:0)}n.push(new Du(".morphTargetInfluence["+r+"]",e,a))}s=e.length*(a||1)}else{const r=".bones["+e[c].name+"]";i(Fu,r+".position",t,"pos",n),i(Bu,r+".quaternion",t,"rot",n),i(Fu,r+".scale",t,"scl",n)}}if(0===n.length)return null;return new this(r,s,n,o)}resetDuration(){let t=0;for(let e=0,i=this.tracks.length;e!==i;++e){const i=this.tracks[e];t=Math.max(t,i.times[i.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Uu(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Du;case"vector":case"vector2":case"vector3":case"vector4":return Fu;case"color":return Pu;case"quaternion":return Bu;case"bool":case"boolean":return zu;case"string":return Ou}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],i=[];Mu.flattenJSON(t.keys,e,i,"value"),t.times=e,t.values=i}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const $u={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};const Vu=new class{constructor(t,e,i){const n=this;let r,a=!1,o=0,s=0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(t){s++,!1===a&&void 0!==n.onStart&&n.onStart(t,o,s),a=!0},this.itemEnd=function(t){o++,void 0!==n.onProgress&&n.onProgress(t,o,s),o===s&&(a=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(t){void 0!==n.onError&&n.onError(t)},this.resolveURL=function(t){return r?r(t):t},this.setURLModifier=function(t){return r=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,i=l.length;e<i;e+=2){const i=l[e],n=l[e+1];if(i.global&&(i.lastIndex=0),i.test(t))return n}return null}}};class ju{constructor(t){this.manager=void 0!==t?t:Vu,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const i=this;return new Promise((function(n,r){i.load(t,n,e,r)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}const qu={};class Gu extends ju{constructor(t){super(t)}load(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=$u.get(t);if(void 0!==r)return this.manager.itemStart(t),setTimeout((()=>{e&&e(r),this.manager.itemEnd(t)}),0),r;if(void 0!==qu[t])return void qu[t].push({onLoad:e,onProgress:i,onError:n});qu[t]=[],qu[t].push({onLoad:e,onProgress:i,onError:n});const a=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"});fetch(a).then((e=>{if(200===e.status||0===e.status){0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");const i=qu[t],n=e.body.getReader(),r=e.headers.get("Content-Length"),a=r?parseInt(r):0,o=0!==a;let s=0;return new ReadableStream({start(t){!function e(){n.read().then((({done:n,value:r})=>{if(n)t.close();else{s+=r.byteLength;const n=new ProgressEvent("progress",{lengthComputable:o,loaded:s,total:a});for(let t=0,e=i.length;t<e;t++){const e=i[t];e.onProgress&&e.onProgress(n)}t.enqueue(r),e()}}))}()}})}throw Error(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`)})).then((t=>{const e=new Response(t);switch(this.responseType){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((t=>(new DOMParser).parseFromString(t,this.mimeType)));case"json":return e.json();default:return e.text()}})).then((e=>{$u.add(t,e);const i=qu[t];delete qu[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onLoad&&n.onLoad(e)}this.manager.itemEnd(t)})).catch((e=>{const i=qu[t];delete qu[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onError&&n.onError(e)}this.manager.itemError(t),this.manager.itemEnd(t)})),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class Hu extends ju{constructor(t){super(t)}load(t,e,i,n){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,a=$u.get(t);if(void 0!==a)return r.manager.itemStart(t),setTimeout((function(){e&&e(a),r.manager.itemEnd(t)}),0),a;const o=un("img");function s(){c(),$u.add(t,this),e&&e(this),r.manager.itemEnd(t)}function l(e){c(),n&&n(e),r.manager.itemError(t),r.manager.itemEnd(t)}function c(){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",s,!1),o.addEventListener("error",l,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),r.manager.itemStart(t),o.src=t,o}}class Wu extends ju{constructor(t){super(t)}load(t,e,i,n){const r=new Pa,a=new Hu(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let o=0;function s(i){a.load(t[i],(function(t){r.images[i]=t,o++,6===o&&(r.needsUpdate=!0,e&&e(r))}),void 0,n)}for(let l=0;l<t.length;++l)s(l);return r}}class Zu extends ju{constructor(t){super(t)}load(t,e,i,n){const r=new mn,a=new Hu(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(t,(function(t){r.image=t,r.needsUpdate=!0,void 0!==e&&e(r)}),i,n),r}}class Yu extends Sr{constructor(t,e=1){super(),this.type="Light",this.color=new jr(t),this.intensity=e}dispose(){}copy(t){return super.copy(t),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}Yu.prototype.isLight=!0;(class extends Yu{constructor(t,e,i){super(t,i),this.type="HemisphereLight",this.position.copy(Sr.DefaultUp),this.updateMatrix(),this.groundColor=new jr(e)}copy(t){return Yu.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}).prototype.isHemisphereLight=!0;const Xu=new Jn,Ku=new bn,Ju=new bn;class Qu{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new sn(512,512),this.map=null,this.mapPass=null,this.matrix=new Jn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new $a,this._frameExtents=new sn(1,1),this._viewportCount=1,this._viewports=[new _n(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,i=this.matrix;Ku.setFromMatrixPosition(t.matrixWorld),e.position.copy(Ku),Ju.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(Ju),e.updateMatrixWorld(),Xu.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Xu),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(e.projectionMatrix),i.multiply(e.matrixWorldInverse)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class th extends Qu{constructor(){super(new ka(50,1,.5,500)),this.focus=1}updateMatrices(t){const e=this.camera,i=2*Xi*t.angle*this.focus,n=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;i===e.fov&&n===e.aspect&&r===e.far||(e.fov=i,e.aspect=n,e.far=r,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}th.prototype.isSpotLightShadow=!0;(class extends Yu{constructor(t,e,i=0,n=Math.PI/3,r=0,a=1){super(t,e),this.type="SpotLight",this.position.copy(Sr.DefaultUp),this.updateMatrix(),this.target=new Sr,this.distance=i,this.angle=n,this.penumbra=r,this.decay=a,this.shadow=new th}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}).prototype.isSpotLight=!0;const eh=new Jn,ih=new bn,nh=new bn;class rh extends Qu{constructor(){super(new ka(90,1,.5,500)),this._frameExtents=new sn(4,2),this._viewportCount=6,this._viewports=[new _n(2,1,1,1),new _n(0,1,1,1),new _n(3,1,1,1),new _n(1,1,1,1),new _n(3,0,1,1),new _n(1,0,1,1)],this._cubeDirections=[new bn(1,0,0),new bn(-1,0,0),new bn(0,0,1),new bn(0,0,-1),new bn(0,1,0),new bn(0,-1,0)],this._cubeUps=[new bn(0,1,0),new bn(0,1,0),new bn(0,1,0),new bn(0,1,0),new bn(0,0,1),new bn(0,0,-1)]}updateMatrices(t,e=0){const i=this.camera,n=this.matrix,r=t.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),ih.setFromMatrixPosition(t.matrixWorld),i.position.copy(ih),nh.copy(i.position),nh.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(nh),i.updateMatrixWorld(),n.makeTranslation(-ih.x,-ih.y,-ih.z),eh.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(eh)}}rh.prototype.isPointLightShadow=!0;(class extends Yu{constructor(t,e,i=0,n=1){super(t,e),this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new rh}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}).prototype.isPointLight=!0;class ah extends Qu{constructor(){super(new to(-5,5,5,-5,.5,500))}}ah.prototype.isDirectionalLightShadow=!0;(class extends Yu{constructor(t,e){super(t,e),this.type="DirectionalLight",this.position.copy(Sr.DefaultUp),this.updateMatrix(),this.target=new Sr,this.shadow=new ah}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}).prototype.isDirectionalLight=!0;(class extends Yu{constructor(t,e){super(t,e),this.type="AmbientLight"}}).prototype.isAmbientLight=!0;(class extends Yu{constructor(t,e,i=10,n=10){super(t,e),this.type="RectAreaLight",this.width=i,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}).prototype.isRectAreaLight=!0;class oh{constructor(){this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new bn)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const i=t.x,n=t.y,r=t.z,a=this.coefficients;return e.copy(a[0]).multiplyScalar(.282095),e.addScaledVector(a[1],.488603*n),e.addScaledVector(a[2],.488603*r),e.addScaledVector(a[3],.488603*i),e.addScaledVector(a[4],i*n*1.092548),e.addScaledVector(a[5],n*r*1.092548),e.addScaledVector(a[6],.315392*(3*r*r-1)),e.addScaledVector(a[7],i*r*1.092548),e.addScaledVector(a[8],.546274*(i*i-n*n)),e}getIrradianceAt(t,e){const i=t.x,n=t.y,r=t.z,a=this.coefficients;return e.copy(a[0]).multiplyScalar(.886227),e.addScaledVector(a[1],1.023328*n),e.addScaledVector(a[2],1.023328*r),e.addScaledVector(a[3],1.023328*i),e.addScaledVector(a[4],.858086*i*n),e.addScaledVector(a[5],.858086*n*r),e.addScaledVector(a[6],.743125*r*r-.247708),e.addScaledVector(a[7],.858086*i*r),e.addScaledVector(a[8],.429043*(i*i-n*n)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(t.coefficients[i],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let i=0;i<9;i++)this.coefficients[i].lerp(t.coefficients[i],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].fromArray(t,e+3*n);return this}toArray(t=[],e=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].toArray(t,e+3*n);return t}static getBasisAt(t,e){const i=t.x,n=t.y,r=t.z;e[0]=.282095,e[1]=.488603*n,e[2]=.488603*r,e[3]=.488603*i,e[4]=1.092548*i*n,e[5]=1.092548*n*r,e[6]=.315392*(3*r*r-1),e[7]=1.092548*i*r,e[8]=.546274*(i*i-n*n)}}oh.prototype.isSphericalHarmonics3=!0;class sh extends Yu{constructor(t=new oh,e=1){super(void 0,e),this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}sh.prototype.isLightProbe=!0;(class extends ra{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const t=super.toJSON(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}).prototype.isInstancedBufferGeometry=!0;let lh;(class extends ju{constructor(t){super(t),"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,a=$u.get(t);if(void 0!==a)return r.manager.itemStart(t),setTimeout((function(){e&&e(a),r.manager.itemEnd(t)}),0),a;const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(t,o).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(i){$u.add(t,i),e&&e(i),r.manager.itemEnd(t)})).catch((function(e){n&&n(e),r.manager.itemError(t),r.manager.itemEnd(t)})),r.manager.itemStart(t)}}).prototype.isImageBitmapLoader=!0;const ch=function(){return void 0===lh&&(lh=new(window.AudioContext||window.webkitAudioContext)),lh};class uh extends ju{constructor(t){super(t)}load(t,e,i,n){const r=this,a=new Gu(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,(function(i){try{const t=i.slice(0);ch().decodeAudioData(t,(function(t){e(t)}))}catch(a){n?n(a):console.error(a),r.manager.itemError(t)}}),i,n)}}(class extends sh{constructor(t,e,i=1){super(void 0,i);const n=(new jr).set(t),r=(new jr).set(e),a=new bn(n.r,n.g,n.b),o=new bn(r.r,r.g,r.b),s=Math.sqrt(Math.PI),l=s*Math.sqrt(.75);this.sh.coefficients[0].copy(a).add(o).multiplyScalar(s),this.sh.coefficients[1].copy(a).sub(o).multiplyScalar(l)}}).prototype.isHemisphereLightProbe=!0;(class extends sh{constructor(t,e=1){super(void 0,e);const i=(new jr).set(t);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}).prototype.isAmbientLightProbe=!0;class hh{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=ph(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=ph();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function ph(){return("undefined"===typeof performance?Date:performance).now()}class dh{constructor(t,e,i){let n,r,a;switch(this.binding=t,this.valueSize=i,e){case"quaternion":n=this._slerp,r=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":n=this._select,r=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:n=this._lerp,r=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=r,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const i=this.buffer,n=this.valueSize,r=t*n+n;let a=this.cumulativeWeight;if(0===a){for(let t=0;t!==n;++t)i[r+t]=i[t];a=e}else{a+=e;const t=e/a;this._mixBufferRegion(i,r,0,t,n)}this.cumulativeWeight=a}accumulateAdditive(t){const e=this.buffer,i=this.valueSize,n=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,n,0,t,i),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,i=this.buffer,n=t*e+e,r=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const t=e*this._origIndex;this._mixBufferRegion(i,n,t,1-r,e)}a>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*e,1,e);for(let s=e,l=e+e;s!==l;++s)if(i[s]!==i[s+e]){o.setValue(i,n);break}}saveOriginalState(){const t=this.binding,e=this.buffer,i=this.valueSize,n=i*this._origIndex;t.getValue(e,n);for(let r=i,a=n;r!==a;++r)e[r]=e[n+r%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let i=t;i<e;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[e+i]=this.buffer[t+i]}_select(t,e,i,n,r){if(n>=.5)for(let a=0;a!==r;++a)t[e+a]=t[i+a]}_slerp(t,e,i,n){xn.slerpFlat(t,e,t,e,t,i,n)}_slerpAdditive(t,e,i,n,r){const a=this._workIndex*r;xn.multiplyQuaternionsFlat(t,a,t,e,t,i),xn.slerpFlat(t,e,t,e,t,a,n)}_lerp(t,e,i,n,r){const a=1-n;for(let o=0;o!==r;++o){const r=e+o;t[r]=t[r]*a+t[i+o]*n}}_lerpAdditive(t,e,i,n,r){for(let a=0;a!==r;++a){const r=e+a;t[r]=t[r]+t[i+a]*n}}}const fh="\\[\\]\\.:\\/",mh=new RegExp("[\\[\\]\\.:\\/]","g"),gh="[^\\[\\]\\.:\\/]",_h="[^"+fh.replace("\\.","")+"]",yh=/((?:WC+[\/:])*)/.source.replace("WC",gh),vh=/(WCOD+)?/.source.replace("WCOD",_h),xh=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",gh),bh=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",gh),wh=new RegExp("^"+yh+vh+xh+bh+"$"),Sh=["material","materials","bones"];class Eh{constructor(t,e,i){this.path=e,this.parsedPath=i||Eh.parseTrackName(e),this.node=Eh.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,i){return t&&t.isAnimationObjectGroup?new Eh.Composite(t,e,i):new Eh(t,e,i)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(mh,"")}static parseTrackName(t){const e=wh.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const i={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){const t=i.nodeName.substring(n+1);-1!==Sh.indexOf(t)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=t)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}static findNode(t,e){if(!e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const i=t.skeleton.getBoneByName(e);if(void 0!==i)return i}if(t.children){const i=function(t){for(let n=0;n<t.length;n++){const r=t[n];if(r.name===e||r.uuid===e)return r;const a=i(r.children);if(a)return a}return null},n=i(t.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)t[e++]=i[n]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,i=e.objectName,n=e.propertyName;let r=e.propertyIndex;if(t||(t=Eh.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(i){let n=e.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===n){n=e;break}break;default:if(void 0===t[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==n){if(void 0===t[n])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[n]}}const a=t[n];if(void 0===a){const i=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+n+" but it wasn't found.",t)}let o=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let s=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[r]&&(r=t.morphTargetDictionary[r])}s=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=r}else void 0!==a.fromArray&&void 0!==a.toArray?(s=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(s=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=n;this.getValue=this.GetterByBindingType[s],this.setValue=this.SetterByBindingTypeAndVersioning[s][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Eh.Composite=class{constructor(t,e,i){const n=i||Eh.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}getValue(t,e){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(t,e)}setValue(t,e){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}},Eh.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Eh.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Eh.prototype.GetterByBindingType=[Eh.prototype._getValue_direct,Eh.prototype._getValue_array,Eh.prototype._getValue_arrayElement,Eh.prototype._getValue_toArray],Eh.prototype.SetterByBindingTypeAndVersioning=[[Eh.prototype._setValue_direct,Eh.prototype._setValue_direct_setNeedsUpdate,Eh.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Eh.prototype._setValue_array,Eh.prototype._setValue_array_setNeedsUpdate,Eh.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Eh.prototype._setValue_arrayElement,Eh.prototype._setValue_arrayElement_setNeedsUpdate,Eh.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Eh.prototype._setValue_fromArray,Eh.prototype._setValue_fromArray_setNeedsUpdate,Eh.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Th{constructor(t,e,i=null,n=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=i,this.blendMode=n;const r=e.tracks,a=r.length,o=new Array(a),s={endingStart:Li,endingEnd:Li};for(let l=0;l!==a;++l){const t=r[l].createInterpolant(null);o[l]=t,t.settings=s}this._interpolantSettings=s,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,i){if(t.fadeOut(e),this.fadeIn(e),i){const i=this._clip.duration,n=t._clip.duration,r=n/i,a=i/n;t.warp(1,r,e),this.warp(a,1,e)}return this}crossFadeTo(t,e,i){return t.crossFadeFrom(this,e,i)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,i){const n=this._mixer,r=n.time,a=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);const s=o.parameterPositions,l=o.sampleValues;return s[0]=r,s[1]=r+i,l[0]=t/a,l[1]=e/a,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,i,n){if(!this.enabled)return void this._updateWeight(t);const r=this._startTime;if(null!==r){const n=(t-r)*i;if(n<0||0===i)return;this._startTime=null,e=i*n}e*=this._updateTimeScale(t);const a=this._updateTime(e),o=this._updateWeight(t);if(o>0){const t=this._interpolants,e=this._propertyBindings;if(2501===this.blendMode)for(let i=0,n=t.length;i!==n;++i)t[i].evaluate(a),e[i].accumulateAdditive(o);else for(let i=0,r=t.length;i!==r;++i)t[i].evaluate(a),e[i].accumulate(n,o)}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const i=this._weightInterpolant;if(null!==i){const n=i.evaluate(t)[0];e*=n,t>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const i=this._timeScaleInterpolant;if(null!==i){e*=i.evaluate(t)[0],t>i.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,i=this.loop;let n=this.time+t,r=this._loopCount;const a=2202===i;if(0===t)return-1===r?n:a&&1===(1&r)?e-n:n;if(2200===i){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(n>=e)n=e;else{if(!(n<0)){this.time=n;break t}n=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),n>=e||n<0){const i=Math.floor(n/e);n-=e*i,r+=Math.abs(i);const o=this.repetitions-r;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=t>0?e:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===o){const e=t<0;this._setEndings(e,!e,a)}else this._setEndings(!1,!1,a);this._loopCount=r,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=n;if(a&&1===(1&r))return e-n}return n}_setEndings(t,e,i){const n=this._interpolantSettings;i?(n.endingStart=Bi,n.endingEnd=Bi):(n.endingStart=t?this.zeroSlopeAtStart?Bi:Li:Oi,n.endingEnd=e?this.zeroSlopeAtEnd?Bi:Li:Oi)}_scheduleFading(t,e,i){const n=this._mixer,r=n.time;let a=this._weightInterpolant;null===a&&(a=n._lendControlInterpolant(),this._weightInterpolant=a);const o=a.parameterPositions,s=a.sampleValues;return o[0]=r,s[0]=e,o[1]=r+t,s[1]=i,this}}(class extends Wi{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const i=t._localRoot||this._root,n=t._clip.tracks,r=n.length,a=t._propertyBindings,o=t._interpolants,s=i.uuid,l=this._bindingsByRootAndName;let c=l[s];void 0===c&&(c={},l[s]=c);for(let u=0;u!==r;++u){const t=n[u],r=t.name;let l=c[r];if(void 0!==l)a[u]=l;else{if(l=a[u],void 0!==l){null===l._cacheIndex&&(++l.referenceCount,this._addInactiveBinding(l,s,r));continue}const n=e&&e._propertyBindings[u].binding.parsedPath;l=new dh(Eh.create(i,r,n),t.ValueTypeName,t.getValueSize()),++l.referenceCount,this._addInactiveBinding(l,s,r),a[u]=l}o[u].resultBuffer=l.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,i=t._clip.uuid,n=this._actionsByClip[i];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,i,e)}const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0===i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0===--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,i){const n=this._actions,r=this._actionsByClip;let a=r[e];if(void 0===a)a={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=a;else{const e=a.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=n.length,n.push(t),a.actionByRoot[i]=t}_removeInactiveAction(t){const e=this._actions,i=e[e.length-1],n=t._cacheIndex;i._cacheIndex=n,e[n]=i,e.pop(),t._cacheIndex=null;const r=t._clip.uuid,a=this._actionsByClip,o=a[r],s=o.knownActions,l=s[s.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,s[c]=l,s.pop(),t._byClipCacheIndex=null;delete o.actionByRoot[(t._localRoot||this._root).uuid],0===s.length&&delete a[r],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let i=0,n=e.length;i!==n;++i){const t=e[i];0===--t.referenceCount&&this._removeInactiveBinding(t)}}_lendAction(t){const e=this._actions,i=t._cacheIndex,n=this._nActiveActions++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_takeBackAction(t){const e=this._actions,i=t._cacheIndex,n=--this._nActiveActions,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_addInactiveBinding(t,e,i){const n=this._bindingsByRootAndName,r=this._bindings;let a=n[e];void 0===a&&(a={},n[e]=a),a[i]=t,t._cacheIndex=r.length,r.push(t)}_removeInactiveBinding(t){const e=this._bindings,i=t.binding,n=i.rootNode.uuid,r=i.path,a=this._bindingsByRootAndName,o=a[n],s=e[e.length-1],l=t._cacheIndex;s._cacheIndex=l,e[l]=s,e.pop(),delete o[r],0===Object.keys(o).length&&delete a[n]}_lendBinding(t){const e=this._bindings,i=t._cacheIndex,n=this._nActiveBindings++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_takeBackBinding(t){const e=this._bindings,i=t._cacheIndex,n=--this._nActiveBindings,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let i=t[e];return void 0===i&&(i=new Au(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=e,t[e]=i),i}_takeBackControlInterpolant(t){const e=this._controlInterpolants,i=t.__cacheIndex,n=--this._nActiveControlInterpolants,r=e[n];t.__cacheIndex=n,e[n]=t,r.__cacheIndex=i,e[i]=r}clipAction(t,e,i){const n=e||this._root,r=n.uuid;let a="string"===typeof t?Nu.findByName(n,t):t;const o=null!==a?a.uuid:t,s=this._actionsByClip[o];let l=null;if(void 0===i&&(i=null!==a?a.blendMode:Fi),void 0!==s){const t=s.actionByRoot[r];if(void 0!==t&&t.blendMode===i)return t;l=s.knownActions[0],null===a&&(a=l._clip)}if(null===a)return null;const c=new Th(this,a,e,i);return this._bindAction(c,l),this._addInactiveAction(c,o,r),c}existingAction(t,e){const i=e||this._root,n=i.uuid,r="string"===typeof t?Nu.findByName(i,t):t,a=r?r.uuid:t,o=this._actionsByClip[a];return void 0!==o&&o.actionByRoot[n]||null}stopAllAction(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;const e=this._actions,i=this._nActiveActions,n=this.time+=t,r=Math.sign(t),a=this._accuIndex^=1;for(let l=0;l!==i;++l){e[l]._update(n,t,r,a)}const o=this._bindings,s=this._nActiveBindings;for(let l=0;l!==s;++l)o[l].apply(a);return this}setTime(t){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,i=t.uuid,n=this._actionsByClip,r=n[i];if(void 0!==r){const t=r.knownActions;for(let i=0,n=t.length;i!==n;++i){const n=t[i];this._deactivateAction(n);const r=n._cacheIndex,a=e[e.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,a._cacheIndex=r,e[r]=a,e.pop(),this._removeInactiveBindingsForAction(n)}delete n[i]}}uncacheRoot(t){const e=t.uuid,i=this._actionsByClip;for(const r in i){const t=i[r].actionByRoot[e];void 0!==t&&(this._deactivateAction(t),this._removeInactiveAction(t))}const n=this._bindingsByRootAndName[e];if(void 0!==n)for(const r in n){const t=n[r];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(t,e){const i=this.existingAction(t,e);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}).prototype._controlInterpolantsResultBuffer=new Float32Array(1);(class extends zl{constructor(t,e,i=1){super(t,e),this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}).prototype.isInstancedInterleavedBuffer=!0;class Mh{constructor(t,e,i=0,n=1/0){this.ray=new Kn(t,e),this.near=i,this.far=n,this.camera=null,this.layers=new cr,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(t,e=!0,i=[]){return Ih(t,this,i,e),i.sort(Ch),i}intersectObjects(t,e=!0,i=[]){for(let n=0,r=t.length;n<r;n++)Ih(t[n],this,i,e);return i.sort(Ch),i}}function Ch(t,e){return t.distance-e.distance}function Ih(t,e,i,n){if(t.layers.test(e.layers)&&t.raycast(e,i),!0===n){const n=t.children;for(let t=0,r=n.length;t<r;t++)Ih(n[t],e,i,!0)}}const Ah=new bn,kh=new Jn,Rh=new Jn;function zh(t){const e=[];t&&t.isBone&&e.push(t);for(let i=0;i<t.children.length;i++)e.push.apply(e,zh(t.children[i]));return e}const Ph=new Float32Array(1);new Int32Array(Ph.buffer),Tc.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(Tc.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Gc.prototype.fromPoints=function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)},class extends _c{constructor(t=10,e=10,i=4473924,n=8947848){i=new jr(i),n=new jr(n);const r=e/2,a=t/e,o=t/2,s=[],l=[];for(let u=0,h=0,p=-o;u<=e;u++,p+=a){s.push(-o,0,p,o,0,p),s.push(p,0,-o,p,0,o);const t=u===r?i:n;t.toArray(l,h),h+=3,t.toArray(l,h),h+=3,t.toArray(l,h),h+=3,t.toArray(l,h),h+=3}const c=new ra;c.setAttribute("position",new Xr(s,3)),c.setAttribute("color",new Xr(l,3));super(c,new lc({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},class extends _c{constructor(t){const e=zh(t),i=new ra,n=[],r=[],a=new jr(0,0,1),o=new jr(0,1,0);for(let s=0;s<e.length;s++){const t=e[s];t.parent&&t.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),r.push(a.r,a.g,a.b),r.push(o.r,o.g,o.b))}i.setAttribute("position",new Xr(n,3)),i.setAttribute("color",new Xr(r,3));super(i,new lc({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,i=this.geometry,n=i.getAttribute("position");Rh.copy(this.root.matrixWorld).invert();for(let r=0,a=0;r<e.length;r++){const t=e[r];t.parent&&t.parent.isBone&&(kh.multiplyMatrices(Rh,t.matrixWorld),Ah.setFromMatrixPosition(kh),n.setXYZ(a,Ah.x,Ah.y,Ah.z),kh.multiplyMatrices(Rh,t.parent.matrixWorld),Ah.setFromMatrixPosition(kh),n.setXYZ(a+1,Ah.x,Ah.y,Ah.z),a+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},ju.prototype.extractUrlBase=function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),class{static decodeText(t){if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let n=0,r=t.length;n<r;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch(i){return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)}static resolveURL(t,e){return"string"!==typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}.extractUrlBase(t)},ju.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},En.prototype.center=function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},En.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},En.prototype.isIntersectionBox=function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},En.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},En.prototype.size=function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)},jn.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},$a.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},ln.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},ln.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},ln.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},ln.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},ln.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},ln.prototype.getInverse=function(t){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},Jn.prototype.extractPosition=function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},Jn.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},Jn.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new bn).setFromMatrixColumn(this,3)},Jn.prototype.setRotationFromQuaternion=function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},Jn.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},Jn.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},Jn.prototype.multiplyVector4=function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},Jn.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},Jn.prototype.rotateAxis=function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},Jn.prototype.crossVector=function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},Jn.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},Jn.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},Jn.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},Jn.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},Jn.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},Jn.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},Jn.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},Jn.prototype.makeFrustum=function(t,e,i,n,r,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,n,i,r,a)},Jn.prototype.getInverse=function(t){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},Fa.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},xn.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},xn.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},Kn.prototype.isIntersectionBox=function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},Kn.prototype.isIntersectionPlane=function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},Kn.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},Dr.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},Dr.prototype.barycoordFromPoint=function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},Dr.prototype.midpoint=function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},Dr.prototypenormal=function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},Dr.prototype.plane=function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)},Dr.barycoordFromPoint=function(t,e,i,n,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Dr.getBarycoord(t,e,i,n,r)},Dr.normal=function(t,e,i,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Dr.getNormal(t,e,i,n)},Hc.prototype.extractAllPoints=function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},Hc.prototype.extrude=function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new bu(this,t)},Hc.prototype.makeGeometry=function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Su(this,t)},sn.prototype.fromAttribute=function(t,e,i){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)},sn.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},sn.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},bn.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},bn.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},bn.prototype.getPositionFromMatrix=function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},bn.prototype.getScaleFromMatrix=function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},bn.prototype.getColumnFromMatrix=function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},bn.prototype.applyProjection=function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},bn.prototype.fromAttribute=function(t,e,i){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)},bn.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},bn.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},_n.prototype.fromAttribute=function(t,e,i){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)},_n.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Sr.prototype.getChildByName=function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},Sr.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},Sr.prototype.translate=function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},Sr.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},Sr.prototype.applyMatrix=function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(Sr.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),wa.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(wa.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),ic.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},ka.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(Yu.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(Wr.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Gi},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Gi)}}}),Wr.prototype.setDynamic=function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?Gi:qi),this},Wr.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Wr.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},ra.prototype.addIndex=function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},ra.prototype.addAttribute=function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new Wr(arguments[1],arguments[2])))},ra.prototype.addDrawCall=function(t,e,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},ra.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},ra.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},ra.prototype.removeAttribute=function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},ra.prototype.applyMatrix=function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(ra.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),zl.prototype.setDynamic=function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?Gi:qi),this},zl.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},bu.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},bu.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},bu.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},Rl.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},Object.defineProperties(Br.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new jr}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===t}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(Ia.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),kl.prototype.clearTarget=function(t,e,i,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,i,n)},kl.prototype.animate=function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},kl.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},kl.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},kl.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},kl.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},kl.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},kl.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},kl.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},kl.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},kl.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},kl.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},kl.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},kl.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},kl.prototype.enableScissorTest=function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},kl.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},kl.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},kl.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},kl.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},kl.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},kl.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},kl.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},kl.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},kl.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},kl.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(kl.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?Ui:Ni}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(xl.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(yn.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),class extends Sr{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}.prototype.load=function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return(new uh).load(t,(function(t){e.setBuffer(t)})),this},za.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)},za.prototype.clear=function(t,e,i,n){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(t,e,i,n)},dn.crossOrigin=void 0,dn.loadTexture=function(t,e,i,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const r=new Zu;r.setCrossOrigin(this.crossOrigin);const a=r.load(t,i,void 0,n);return e&&(a.mapping=e),a},dn.loadTextureCube=function(t,e,i,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const r=new Wu;r.setCrossOrigin(this.crossOrigin);const a=r.load(t,i,void 0,n);return e&&(a.mapping=e),a},dn.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},dn.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"134"}})),"undefined"!==typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="134");const Dh=Math.PI/180,Lh=180/Math.PI,Bh=6378137,Oh=6356752.31424518;function Fh(t,e,i,n,r,a){const o=Uh(t,e,i);return function(t,e,i,n,r,a){const o=Uh(n,r,a),s=[t-o[0],e-o[1],i-o[2]];n*=Dh,r*=Dh;const l=Math.cos(n),c=Math.sin(n),u=Math.cos(r),h=Math.sin(r),p=-c*s[0]+l*s[1],d=-h*l*s[0]-h*c*s[1]+u*s[2],f=u*l*s[0]+u*c*s[1]+h*s[2];return[p,d,f]}(o[0],o[1],o[2],n,r,a)}function Nh(t,e,i,n,r,a){const o=function(t,e,i,n,r,a){const o=Uh(n,r,a);n*=Dh,r*=Dh;const s=Math.cos(n),l=Math.sin(n),c=Math.cos(r),u=Math.sin(r),h=-l*t-u*s*e+c*s*i+o[0],p=s*t-u*l*e+c*l*i+o[1],d=c*e+u*i+o[2];return[h,p,d]}(t,e,i,n,r,a);return function(t,e,i){const n=Bh,r=Oh,a=n*n,o=r*r,s=a-o,l=Math.sqrt(s/a),c=Math.sqrt(s/o),u=Math.sqrt(t*t+e*e),h=Math.atan2(i*n,u*r),p=Math.sin(h),d=Math.cos(h),f=Math.atan2(e,t),m=Math.atan2(i+c*c*r*p*p*p,u-l*l*n*d*d*d),g=Math.sin(m),_=Math.cos(m),y=n/Math.sqrt(1-l*l*g*g);return[f*Lh,m*Lh,u/_-y]}(o[0],o[1],o[2])}function Uh(t,e,i){const n=Bh,r=Oh;t*=Dh,e*=Dh;const a=Math.cos(t),o=Math.sin(t),s=Math.cos(e),l=Math.sin(e),c=n*n,u=r*r,h=1/Math.sqrt(c*s*s+u*l*l),p=(c*h+i)*s;return[p*a,p*o,(u*h+i)*l]}class $h{boundingBoxCorners(t,e){const i=Nh(-e,-e,0,t.lng,t.lat,0),n=Nh(e,e,0,t.lng,t.lat,0);return[{lat:i[1],lng:i[0]},{lat:n[1],lng:n[0]}]}rotationFromCompass(t,e){let i=0,n=0,r=0;switch(e){case 1:i=Math.PI/2;break;case 3:i=-Math.PI/2,r=Math.PI;break;case 6:n=-Math.PI/2,r=-Math.PI/2;break;case 8:n=Math.PI/2,r=Math.PI/2}const a=(new Jn).makeRotationZ(r),o=new lr(i,n,t*Math.PI/180,"XYZ"),s=(new Jn).makeRotationFromEuler(o),l=(new _n).setAxisAngleFromRotationMatrix(s.multiply(a));return l.multiplyScalar(l.w).toArray().slice(0,3)}}class Vh{constructor(t){if(!t)throw new Error(`Incorrect core image data ${t}`);this._cache=null,this._core=t,this._spatial=null}get assetsCached(){return null!=this._core&&null!=this._spatial&&null!=this._cache&&null!=this._cache.image&&null!=this._cache.mesh}get cameraParameters(){return this._spatial.camera_parameters}get cameraType(){return this._spatial.camera_type}get capturedAt(){return this._spatial.captured_at}get clusterId(){return this._spatial.cluster?this._spatial.cluster.id:null}get clusterUrl(){return this._spatial.cluster?this._spatial.cluster.url:null}get compassAngle(){return null!=this._spatial.computed_compass_angle?this._spatial.computed_compass_angle:this._spatial.compass_angle}get complete(){return null!=this._spatial}get computedAltitude(){return this._spatial.computed_altitude}get computedCompassAngle(){return this._spatial.computed_compass_angle}get computedLngLat(){return this._core.computed_geometry}get creatorId(){return this._spatial.creator.id}get creatorUsername(){return this._spatial.creator.username}get exifOrientation(){return this._spatial.exif_orientation}get height(){return this._spatial.height}get image(){return this._cache.image}get image$(){return this._cache.image$}get id(){return this._core.id}get lngLat(){return null!=this._core.computed_geometry?this._core.computed_geometry:this._core.geometry}get merged(){return null!=this._spatial&&null!=this._spatial.merge_id}get mergeId(){return this._spatial.merge_id}get mesh(){return this._cache.mesh}get originalAltitude(){return this._spatial.altitude}get originalCompassAngle(){return this._spatial.compass_angle}get originalLngLat(){return this._core.geometry}get ownerId(){return this._spatial.owner?this._spatial.owner.id:null}get private(){return this._spatial.private}get qualityScore(){return this._spatial.quality_score}get rotation(){return this._spatial.computed_rotation}get scale(){return this._spatial.atomic_scale}get sequenceId(){return this._core.sequence?this._core.sequence.id:null}get sequenceEdges(){return this._cache.sequenceEdges}get sequenceEdges$(){return this._cache.sequenceEdges$}get spatialEdges(){return this._cache.spatialEdges}get spatialEdges$(){return this._cache.spatialEdges$}get width(){return this._spatial.width}cacheAssets$(){return this._cache.cacheAssets$(this._spatial,this.merged).pipe(ee((()=>this)))}cacheImage$(){return this._cache.cacheImage$(this._spatial).pipe(ee((()=>this)))}cacheSequenceEdges(t){this._cache.cacheSequenceEdges(t)}cacheSpatialEdges(t){this._cache.cacheSpatialEdges(t)}dispose(){null!=this._cache&&(this._cache.dispose(),this._cache=null),this._core=null,this._spatial=null}initializeCache(t){if(null!=this._cache)throw new Error(`Image cache already initialized (${this.id}).`);this._cache=t}makeComplete(t){if(null==t)throw new Error("Fill can not be null.");this._spatial=t}resetSequenceEdges(){this._cache.resetSequenceEdges()}resetSpatialEdges(){this._cache.resetSpatialEdges()}uncache(){null!=this._cache&&(this._cache.dispose(),this._cache=null)}}class jh{constructor(t){this._disposed=!1,this._provider=t,this._image=null,this._mesh=null,this._sequenceEdges={cached:!1,edges:[]},this._spatialEdges={cached:!1,edges:[]},this._imageChanged$=new ht,this._image$=this._imageChanged$.pipe(ai(null),Je(1),lt()),this._iamgeSubscription=this._image$.subscribe(),this._sequenceEdgesChanged$=new ht,this._sequenceEdges$=this._sequenceEdgesChanged$.pipe(ai(this._sequenceEdges),Je(1),lt()),this._sequenceEdgesSubscription=this._sequenceEdges$.subscribe((()=>{})),this._spatialEdgesChanged$=new ht,this._spatialEdges$=this._spatialEdgesChanged$.pipe(ai(this._spatialEdges),Je(1),lt()),this._spatialEdgesSubscription=this._spatialEdges$.subscribe((()=>{})),this._cachingAssets$=null}get image(){return this._image}get image$(){return this._image$}get mesh(){return this._mesh}get sequenceEdges(){return this._sequenceEdges}get sequenceEdges$(){return this._sequenceEdges$}get spatialEdges(){return this._spatialEdges}get spatialEdges$(){return this._spatialEdges$}cacheAssets$(t,e){return null!=this._cachingAssets$||(this._cachingAssets$=ue(this._cacheImage$(t),this._cacheMesh$(t,e)).pipe(ee((([t,e])=>(this._image=t,this._mesh=e,this))),Ge((()=>{this._cachingAssets$=null})),Je(1),lt()),this._cachingAssets$.pipe(He((t=>!!t._image))).subscribe((()=>{this._imageChanged$.next(this._image)}),(()=>{}))),this._cachingAssets$}cacheImage$(t){if(null!=this._image)return Zt(this);const e=this._cacheImage$(t).pipe(He((t=>!!t)),ci((t=>{this._disposeImage(),this._image=t})),ee((()=>this)),Je(1),lt());return e.subscribe((()=>{this._imageChanged$.next(this._image)}),(()=>{})),e}cacheSequenceEdges(t){this._sequenceEdges={cached:!0,edges:t},this._sequenceEdgesChanged$.next(this._sequenceEdges)}cacheSpatialEdges(t){this._spatialEdges={cached:!0,edges:t},this._spatialEdgesChanged$.next(this._spatialEdges)}dispose(){this._iamgeSubscription.unsubscribe(),this._sequenceEdgesSubscription.unsubscribe(),this._spatialEdgesSubscription.unsubscribe(),this._disposeImage(),this._mesh=null,this._sequenceEdges={cached:!1,edges:[]},this._spatialEdges={cached:!1,edges:[]},this._imageChanged$.next(null),this._sequenceEdgesChanged$.next(this._sequenceEdges),this._spatialEdgesChanged$.next(this._spatialEdges),this._disposed=!0,null!=this._imageAborter&&(this._imageAborter(),this._imageAborter=null),null!=this._meshAborter&&(this._meshAborter(),this._meshAborter=null)}resetSequenceEdges(){this._sequenceEdges={cached:!1,edges:[]},this._sequenceEdgesChanged$.next(this._sequenceEdges)}resetSpatialEdges(){this._spatialEdges={cached:!1,edges:[]},this._spatialEdgesChanged$.next(this._spatialEdges)}_cacheImage$(t){return nt.create((e=>{const i=new Promise(((t,e)=>{this._imageAborter=e})),n=t.thumb.url;if(n)this._provider.getImageBuffer(n,i).then((t=>{this._imageAborter=null;const i=new Image;i.crossOrigin="Anonymous",i.onload=()=>{if(this._disposed){window.URL.revokeObjectURL(i.src);const t=`Image load was aborted (${n})`;e.error(new Error(t))}else e.next(i),e.complete()},i.onerror=()=>{this._imageAborter=null,e.error(new Error(`Failed to load image (${n})`))};const r=new Blob([t]);i.src=window.URL.createObjectURL(r)}),(t=>{this._imageAborter=null,e.error(t)}));else{const i=t.thumb.id,r=`Incorrect thumb URL for ${t.id} (${i}, ${n})`;e.error(new Error(r))}}))}_cacheMesh$(t,e){return nt.create((i=>{if(!e)return i.next(this._createEmptyMesh()),void i.complete();const n=t.mesh.url;if(!n){const e=t.mesh.id,r=`Incorrect mesh URL for ${t.id} (${e}, ${n})`;return console.warn(r),i.next(this._createEmptyMesh()),void i.complete()}const r=new Promise(((t,e)=>{this._meshAborter=e}));this._provider.getMesh(n,r).then((t=>{this._meshAborter=null,this._disposed||(i.next(t),i.complete())}),(t=>{this._meshAborter=null,console.error(t),i.next(this._createEmptyMesh()),i.complete()}))}))}_createEmptyMesh(){return{faces:[],vertices:[]}}_disposeImage(){null!=this._image&&window.URL.revokeObjectURL(this._image.src),this._image=null}}class qh{constructor(t){this._id=t.id,this._imageIds=t.image_ids}get id(){return this._id}get imageIds(){return this._imageIds}dispose(){this._id=null,this._imageIds=null}findNext(t){let e=this._imageIds.indexOf(t);return e+1>=this._imageIds.length||-1===e?null:this._imageIds[e+1]}findPrev(t){let e=this._imageIds.indexOf(t);return 0===e||-1===e?null:this._imageIds[e-1]}}class Gh{constructor(){this.sphericalPreferredDistance=2,this.sphericalMotion=2,this.sphericalSequencePenalty=1,this.sphericalMergeCCPenalty=4,this.stepPreferredDistance=4,this.stepMotion=3,this.stepRotation=4,this.stepSequencePenalty=2,this.stepMergeCCPenalty=6,this.similarDistance=2,this.similarRotation=3,this.turnDistance=4,this.turnMotion=2,this.turnSequencePenalty=1,this.turnMergeCCPenalty=4}}var Hh;!function(t){t[t.Next=0]="Next",t[t.Prev=1]="Prev",t[t.StepLeft=2]="StepLeft",t[t.StepRight=3]="StepRight",t[t.StepForward=4]="StepForward",t[t.StepBackward=5]="StepBackward",t[t.TurnLeft=6]="TurnLeft",t[t.TurnRight=7]="TurnRight",t[t.TurnU=8]="TurnU",t[t.Spherical=9]="Spherical",t[t.Similar=10]="Similar"}(Hh||(Hh={}));class Wh{constructor(){this.steps={},this.turns={},this.spherical={},this.steps[Hh.StepForward]={direction:Hh.StepForward,motionChange:0,useFallback:!0},this.steps[Hh.StepBackward]={direction:Hh.StepBackward,motionChange:Math.PI,useFallback:!0},this.steps[Hh.StepLeft]={direction:Hh.StepLeft,motionChange:Math.PI/2,useFallback:!1},this.steps[Hh.StepRight]={direction:Hh.StepRight,motionChange:-Math.PI/2,useFallback:!1},this.turns[Hh.TurnLeft]={direction:Hh.TurnLeft,directionChange:Math.PI/2,motionChange:Math.PI/4},this.turns[Hh.TurnRight]={direction:Hh.TurnRight,directionChange:-Math.PI/2,motionChange:-Math.PI/4},this.turns[Hh.TurnU]={direction:Hh.TurnU,directionChange:Math.PI,motionChange:null},this.spherical[Hh.StepForward]={direction:Hh.StepForward,directionChange:0,next:Hh.StepLeft,prev:Hh.StepRight},this.spherical[Hh.StepBackward]={direction:Hh.StepBackward,directionChange:Math.PI,next:Hh.StepRight,prev:Hh.StepLeft},this.spherical[Hh.StepLeft]={direction:Hh.StepLeft,directionChange:Math.PI/2,next:Hh.StepBackward,prev:Hh.StepForward},this.spherical[Hh.StepRight]={direction:Hh.StepRight,directionChange:-Math.PI/2,next:Hh.StepForward,prev:Hh.StepBackward}}}class Zh{constructor(){this.sphericalMinDistance=.1,this.sphericalMaxDistance=20,this.sphericalPreferredDistance=5,this.sphericalMaxItems=4,this.sphericalMaxStepTurnChange=Math.PI/8,this.rotationMaxDistance=this.turnMaxRigDistance,this.rotationMaxDirectionChange=Math.PI/6,this.rotationMaxVerticalDirectionChange=Math.PI/8,this.similarMaxDirectionChange=Math.PI/8,this.similarMaxDistance=12,this.similarMinTimeDifference=432e5,this.stepMaxDistance=20,this.stepMaxDirectionChange=Math.PI/6,this.stepMaxDrift=Math.PI/6,this.stepPreferredDistance=4,this.turnMaxDistance=15,this.turnMaxDirectionChange=2*Math.PI/9,this.turnMaxRigDistance=.65,this.turnMinRigDirectionChange=Math.PI/6}get maxDistance(){return Math.max(this.sphericalMaxDistance,this.similarMaxDistance,this.stepMaxDistance,this.turnMaxDistance)}}class Yh extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Yh.prototype),this.name="MapillaryError"}}class Xh extends Yh{constructor(t){super(null!=t?t:"The argument is not valid."),Object.setPrototypeOf(this,Xh.prototype),this.name="ArgumentMapillaryError"}}class Kh{constructor(){this._epsilon=1e-9}azimuthalToBearing(t){return-t+Math.PI/2}degToRad(t){return Math.PI*t/180}radToDeg(t){return 180*t/Math.PI}rotationMatrix(t){let e=new bn(t[0],t[1],t[2]),i=e.length();return i>0&&e.normalize(),(new Jn).makeRotationAxis(e,i)}rotate(t,e){let i=new bn(t[0],t[1],t[2]),n=this.rotationMatrix(e);return i.applyMatrix4(n),i}opticalCenter(t,e){let i=[-t[0],-t[1],-t[2]],n=[-e[0],-e[1],-e[2]];return this.rotate(n,i)}viewingDirection(t){let e=[-t[0],-t[1],-t[2]];return this.rotate([0,0,1],e)}wrap(t,e,i){if(i<e)throw new Error("Invalid arguments: max must be larger than min.");let n=i-e;for(;t>i||t<e;)t>i?t-=n:t<e&&(t+=n);return t}wrapAngle(t){return this.wrap(t,-Math.PI,Math.PI)}clamp(t,e,i){return t<e?e:t>i?i:t}angleBetweenVector2(t,e,i,n){let r=Math.atan2(n,i)-Math.atan2(e,t);return this.wrapAngle(r)}angleDifference(t,e){let i=e-t;return this.wrapAngle(i)}relativeRotationAngle(t,e){let i=this.rotationMatrix([-t[0],-t[1],-t[2]]),n=this.rotationMatrix(e),r=i.multiply(n).elements,a=r[0]+r[5]+r[10];return Math.acos(Math.max(Math.min((a-1)/2,1),-1))}angleToPlane(t,e){let i=(new bn).fromArray(t),n=i.length();if(n<this._epsilon)return 0;let r=i.dot((new bn).fromArray(e));return Math.asin(r/n)}azimuthal(t,e){const i=(new bn).fromArray(t),n=(new bn).fromArray(e),r=i.clone().dot(n),a=i.clone().sub(n.clone().multiplyScalar(r));return Math.atan2(a.y,a.x)}distanceFromLngLat(t,e,i,n){let r=this.degToRad(n-e),a=this.degToRad(i-t),o=Math.sin(r/2)*Math.sin(r/2)+Math.cos(this.degToRad(e))*Math.cos(this.degToRad(n))*Math.sin(a/2)*Math.sin(a/2);return 12742e3*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))}}const Jh=new Kh;function Qh(t){return"spherical"===t}function tp(t){return"fisheye"===t}function ep(t,e,i){const n=Fh(t.lng,t.lat,t.alt,i.lng,i.lat,i.alt),r=Jh.rotate(n,e);return[-r.x,-r.y,-r.z]}function ip(t,e,i,n,r){const a=[];for(let s=0;s<e.length;++s){const t=e[s],r=i[s];for(let e=0;e<=n;++e)a.push([t[0]+r[0]*e/n,t[1]+r[1]*e/n])}const o=new Aa;o.up.copy(t.upVector()),o.position.copy((new bn).fromArray(t.unprojectSfM([0,0],0))),o.lookAt((new bn).fromArray(t.unprojectSfM([0,0],10))),o.updateMatrix(),o.updateMatrixWorld(!0);return a.map((e=>{const i=t.unprojectBasic(e,1e4),n=r.worldToCamera(i,o);return[Math.abs(n[0]/n[2]),Math.abs(n[1]/n[2])]}))}class np{constructor(t,e,i){this._spatial=new Kh,this._settings=null!=t?t:new Zh,this._directions=null!=e?e:new Wh,this._coefficients=null!=i?i:new Gh}getPotentialEdges(t,e,i){if(!t.complete)throw new Xh("Image has to be full.");if(!t.merged)return[];let n=this._spatial.viewingDirection(t.rotation),r=this._spatial.angleToPlane(n.toArray(),[0,0,1]),a=[];for(let o of e){if(!o.merged||o.id===t.id)continue;let e=Fh(o.lngLat.lng,o.lngLat.lat,o.computedAltitude,t.lngLat.lng,t.lngLat.lat,t.computedAltitude),s=new bn(e[0],e[1],e[2]),l=s.length();if(l>this._settings.maxDistance&&i.indexOf(o.id)<0)continue;let c=this._spatial.angleBetweenVector2(n.x,n.y,s.x,s.y),u=this._spatial.angleToPlane(s.toArray(),[0,0,1]),h=this._spatial.viewingDirection(o.rotation),p=this._spatial.angleBetweenVector2(n.x,n.y,h.x,h.y),d=this._spatial.angleToPlane(h.toArray(),[0,0,1])-r,f=this._spatial.relativeRotationAngle(t.rotation,o.rotation),m=this._spatial.angleBetweenVector2(1,0,s.x,s.y),g=null!=o.sequenceId&&null!=t.sequenceId&&o.sequenceId===t.sequenceId,_=o.mergeId===t.mergeId,y=o.creatorId===t.creatorId,v={capturedAt:o.capturedAt,directionChange:p,distance:l,spherical:Qh(o.cameraType),id:o.id,motionChange:c,rotation:f,sameMergeCC:_,sameSequence:g,sameUser:y,sequenceId:o.sequenceId,verticalDirectionChange:d,verticalMotion:u,worldMotionAzimuth:m};a.push(v)}return a}computeSequenceEdges(t,e){if(!t.complete)throw new Xh("Image has to be full.");if(t.sequenceId!==e.id)throw new Xh("Image and sequence does not correspond.");let i=[],n=e.findNext(t.id);null!=n&&i.push({data:{direction:Hh.Next,worldMotionAzimuth:Number.NaN},source:t.id,target:n});let r=e.findPrev(t.id);return null!=r&&i.push({data:{direction:Hh.Prev,worldMotionAzimuth:Number.NaN},source:t.id,target:r}),i}computeSimilarEdges(t,e){if(!t.complete)throw new Xh("Image has to be full.");let i=Qh(t.cameraType),n={};for(let o of e)if(null!=o.sequenceId&&!o.sameSequence){if(i){if(!o.spherical)continue}else if(!o.spherical&&Math.abs(o.directionChange)>this._settings.similarMaxDirectionChange)continue;o.distance>this._settings.similarMaxDistance||o.sameUser&&Math.abs(o.capturedAt-t.capturedAt)<this._settings.similarMinTimeDifference||(null==n[o.sequenceId]&&(n[o.sequenceId]=[]),n[o.sequenceId].push(o))}let r=[],a=Qh(t.cameraType)?t=>t.distance:t=>this._coefficients.similarDistance*t.distance+this._coefficients.similarRotation*t.rotation;for(let o in n){if(!n.hasOwnProperty(o))continue;let t=Number.MAX_VALUE,e=null;for(let i of n[o]){let n=a(i);n<t&&(t=n,e=i)}null!=e&&r.push(e)}return r.map((e=>({data:{direction:Hh.Similar,worldMotionAzimuth:e.worldMotionAzimuth},source:t.id,target:e.id})))}computeStepEdges(t,e,i,n){if(!t.complete)throw new Xh("Image has to be full.");let r=[];if(Qh(t.cameraType))return r;for(let a in this._directions.steps){if(!this._directions.steps.hasOwnProperty(a))continue;let o=this._directions.steps[a],s=Number.MAX_VALUE,l=null,c=null;for(let t of e){if(t.spherical)continue;if(Math.abs(t.directionChange)>this._settings.stepMaxDirectionChange)continue;let e=this._spatial.angleDifference(o.motionChange,t.motionChange),r=this._spatial.angleDifference(t.directionChange,e),a=Math.max(Math.abs(e),Math.abs(r));if(Math.abs(a)>this._settings.stepMaxDrift)continue;let u=t.id;if(!o.useFallback||u!==i&&u!==n||(c=t),t.distance>this._settings.stepMaxDistance)continue;e=Math.sqrt(e*e+t.verticalMotion*t.verticalMotion);let h=this._coefficients.stepPreferredDistance*Math.abs(t.distance-this._settings.stepPreferredDistance)/this._settings.stepMaxDistance+this._coefficients.stepMotion*e/this._settings.stepMaxDrift+this._coefficients.stepRotation*t.rotation/this._settings.stepMaxDirectionChange+this._coefficients.stepSequencePenalty*(t.sameSequence?0:1)+this._coefficients.stepMergeCCPenalty*(t.sameMergeCC?0:1);h<s&&(s=h,l=t)}l=null==l?c:l,null!=l&&r.push({data:{direction:o.direction,worldMotionAzimuth:l.worldMotionAzimuth},source:t.id,target:l.id})}return r}computeTurnEdges(t,e){if(!t.complete)throw new Xh("Image has to be full.");let i=[];if(Qh(t.cameraType))return i;for(let n in this._directions.turns){if(!this._directions.turns.hasOwnProperty(n))continue;let r=this._directions.turns[n],a=Number.MAX_VALUE,o=null;for(let t of e){if(t.spherical)continue;if(t.distance>this._settings.turnMaxDistance)continue;let e,i=r.direction!==Hh.TurnU&&t.distance<this._settings.turnMaxRigDistance&&Math.abs(t.directionChange)>this._settings.turnMinRigDirectionChange,n=this._spatial.angleDifference(r.directionChange,t.directionChange);if(i&&t.directionChange*r.directionChange>0&&Math.abs(t.directionChange)<Math.abs(r.directionChange))e=-Math.PI/2+Math.abs(t.directionChange);else{if(Math.abs(n)>this._settings.turnMaxDirectionChange)continue;let i=r.motionChange?this._spatial.angleDifference(r.motionChange,t.motionChange):0;i=Math.sqrt(i*i+t.verticalMotion*t.verticalMotion),e=this._coefficients.turnDistance*t.distance/this._settings.turnMaxDistance+this._coefficients.turnMotion*i/Math.PI+this._coefficients.turnSequencePenalty*(t.sameSequence?0:1)+this._coefficients.turnMergeCCPenalty*(t.sameMergeCC?0:1)}e<a&&(a=e,o=t)}null!=o&&i.push({data:{direction:r.direction,worldMotionAzimuth:o.worldMotionAzimuth},source:t.id,target:o.id})}return i}computePerspectiveToSphericalEdges(t,e){if(!t.complete)throw new Xh("Image has to be full.");if(Qh(t.cameraType))return[];let i=Number.MAX_VALUE,n=null;for(let r of e){if(!r.spherical)continue;let t=this._coefficients.sphericalPreferredDistance*Math.abs(r.distance-this._settings.sphericalPreferredDistance)/this._settings.sphericalMaxDistance+this._coefficients.sphericalMotion*Math.abs(r.motionChange)/Math.PI+this._coefficients.sphericalMergeCCPenalty*(r.sameMergeCC?0:1);t<i&&(i=t,n=r)}return null==n?[]:[{data:{direction:Hh.Spherical,worldMotionAzimuth:n.worldMotionAzimuth},source:t.id,target:n.id}]}computeSphericalEdges(t,e){if(!t.complete)throw new Xh("Image has to be full.");if(!Qh(t.cameraType))return[];let i=[],n=[],r=[];for(let c of e)if(!(c.distance>this._settings.sphericalMaxDistance))if(c.spherical){if(c.distance<this._settings.sphericalMinDistance)continue;n.push(c)}else for(let t in this._directions.spherical){if(!this._directions.spherical.hasOwnProperty(t))continue;let e=this._directions.spherical[t],i=this._spatial.angleDifference(c.directionChange,c.motionChange),n=this._spatial.angleDifference(e.directionChange,i);if(!(Math.abs(n)>this._settings.sphericalMaxStepTurnChange)){r.push([e.direction,c]);break}}let a=Math.PI/this._settings.sphericalMaxItems,o=[],s=[];for(let c=0;c<this._settings.sphericalMaxItems;c++){let e=c/this._settings.sphericalMaxItems*2*Math.PI,r=Number.MAX_VALUE,l=null;for(let t of n){let i=this._spatial.angleDifference(e,t.motionChange);if(Math.abs(i)>a)continue;let n=Number.MAX_VALUE;for(let e of o){let i=Math.abs(this._spatial.angleDifference(e,t.motionChange));i<n&&(n=i)}if(n<=a)continue;let s=this._coefficients.sphericalPreferredDistance*Math.abs(t.distance-this._settings.sphericalPreferredDistance)/this._settings.sphericalMaxDistance+this._coefficients.sphericalMotion*Math.abs(i)/a+this._coefficients.sphericalSequencePenalty*(t.sameSequence?0:1)+this._coefficients.sphericalMergeCCPenalty*(t.sameMergeCC?0:1);s<r&&(r=s,l=t)}null!=l?(o.push(l.motionChange),i.push({data:{direction:Hh.Spherical,worldMotionAzimuth:l.worldMotionAzimuth},source:t.id,target:l.id})):s.push(e)}let l={};l[Hh.Spherical]=o,l[Hh.StepForward]=[],l[Hh.StepLeft]=[],l[Hh.StepBackward]=[],l[Hh.StepRight]=[];for(let c of s){let e=[];for(let n in this._directions.spherical){if(!this._directions.spherical.hasOwnProperty(n))continue;let o=this._directions.spherical[n],s=l[Hh.Spherical].concat(l[o.direction]).concat(l[o.prev]).concat(l[o.next]),u=Number.MAX_VALUE,h=null;for(let t of r){if(t[0]!==o.direction)continue;let e=this._spatial.angleDifference(c,t[1].motionChange);if(Math.abs(e)>a)continue;let i=Number.MAX_VALUE;for(let r of s){let e=Math.abs(this._spatial.angleDifference(r,t[1].motionChange));e<i&&(i=e)}if(i<=a)continue;let n=this._coefficients.sphericalPreferredDistance*Math.abs(t[1].distance-this._settings.sphericalPreferredDistance)/this._settings.sphericalMaxDistance+this._coefficients.sphericalMotion*Math.abs(e)/a+this._coefficients.sphericalMergeCCPenalty*(t[1].sameMergeCC?0:1);n<u&&(u=n,h=t)}null!=h&&(e.push(h),i.push({data:{direction:h[0],worldMotionAzimuth:h[1].worldMotionAzimuth},source:t.id,target:h[1].id}))}for(let t of e)l[t[0]].push(t[1].motionChange)}return i}}class rp extends Yh{constructor(t){super(t),Object.setPrototypeOf(this,rp.prototype),this.name="GraphMapillaryError"}}class ap{constructor(t,e,i,n,r,a){this._api=t,this._cachedNodes={},this._cachedNodeTiles={},this._cachedSequenceNodes={},this._cachedSpatialEdges={},this._cachedTiles={},this._cachingFill$={},this._cachingFull$={},this._cachingSequenceNodes$={},this._cachingSequences$={},this._cachingSpatialArea$={},this._cachingTiles$={},this._changed$=new ht,this._filterCreator=null!==r&&void 0!==r?r:new hi,this._filter=this._filterCreator.createFilter(void 0),this._filterSubject$=new ht,this._filter$=_e(Zt(this._filter),this._filterSubject$).pipe(Je(1),lt()),this._filterSubscription=this._filter$.subscribe((()=>{})),this._defaultAlt=2,this._edgeCalculator=null!==n&&void 0!==n?n:new np,this._graphCalculator=null!==i&&void 0!==i?i:new $h,this._configuration=null!==a&&void 0!==a?a:{maxSequences:50,maxUnusedImages:100,maxUnusedPreStoredImages:30,maxUnusedTiles:20},this._nodes={},this._nodeIndex=null!==e&&void 0!==e?e:new ap._spatialIndex(16),this._nodeIndexTiles={},this._nodeToTile={},this._preStored={},this._requiredNodeTiles={},this._requiredSpatialArea={},this._sequences={},this._tileThreshold=20}static register(t){ap._spatialIndex=t}get api(){return this._api}get changed$(){return this._changed$}get filter$(){return this._filter$}cacheBoundingBox$(t,e){const i=this._api.data.geometry.bboxToCellIds(t,e).filter((t=>!(t in this._cachedTiles))).map((t=>t in this._cachingTiles$?this._cachingTiles$[t]:this._cacheTile$(t)));return 0===i.length&&i.push(Zt(this)),Ft(i).pipe(me(),Ze(),fe((()=>{const i=this._nodeIndex.search({maxX:e.lng,maxY:e.lat,minX:t.lng,minY:t.lat}).map((t=>t.node)),n=[],r=[];for(const t of i)t.complete?n.push(t):r.push(t.id);const a=[];for(;r.length>0;)a.push(r.splice(0,200));return Ee(Zt(n),Ft(a.map((t=>this._api.getSpatialImages$(t).pipe(ee((t=>{const e=[];for(const i of t){if(!this.hasNode(i.node_id))continue;const t=this.getNode(i.node_id);t.complete||this._makeFull(t,i.node),e.push(t)}return e})))))).pipe(me()))})),Pe(((t,e)=>t.concat(e))))}cacheCell$(t){return(t in this._cachedTiles?Zt(this):t in this._cachingTiles$?this._cachingTiles$[t]:this._cacheTile$(t)).pipe(fe((()=>{const e=this._cachedTiles[t];e.accessed=(new Date).getTime();const i=e.nodes,n=[],r=[];for(const t of i)t.complete?n.push(t):r.push(t.id);const a=[];for(;r.length>0;)a.push(r.splice(0,200));return Ee(Zt(n),Ft(a.map((t=>this._api.getSpatialImages$(t).pipe(ee((t=>{const e=[];for(const i of t){if(!i.node){console.warn(`Image is empty (${i.node})`);continue}const t=i.node_id;if(!this.hasNode(t))continue;const n=this.getNode(t);n.complete||this._makeFull(n,i.node),e.push(n)}return e})))))).pipe(me()))})),Pe(((t,e)=>t.concat(e))))}cacheFill$(t){if(t in this._cachingFull$)throw new rp(`Cannot fill node while caching full (${t}).`);if(!this.hasNode(t))throw new rp(`Cannot fill node that does not exist in graph (${t}).`);if(t in this._cachingFill$)return this._cachingFill$[t];const e=this.getNode(t);if(e.complete)throw new rp(`Cannot fill node that is already full (${t}).`);return this._cachingFill$[t]=this._api.getSpatialImages$([t]).pipe(ci((t=>{for(const i of t)i.node||console.warn(`Image is empty ${i.node_id}`),e.complete||this._makeFull(e,i.node),delete this._cachingFill$[i.node_id]})),ee((()=>this)),Ge((()=>{t in this._cachingFill$&&delete this._cachingFill$[t],this._changed$.next(this)})),Ke(),lt()),this._cachingFill$[t]}cacheFull$(t){if(t in this._cachingFull$)return this._cachingFull$[t];if(this.hasNode(t))throw new rp(`Cannot cache full node that already exist in graph (${t}).`);return this._cachingFull$[t]=this._api.getImages$([t]).pipe(ci((e=>{for(const i of e){if(!i.node)throw new rp(`Image does not exist (${t}, ${i.node}).`);const e=i.node_id;if(this.hasNode(e)){const e=this.getNode(t);e.complete||this._makeFull(e,i.node)}else{if(null==i.node.sequence.id)throw new rp(`Image has no sequence key (${t}).`);const n=new Vh(i.node);this._makeFull(n,i.node);const r=this._api.data.geometry.lngLatToCellId(n.originalLngLat);this._preStore(r,n),this._setNode(n),delete this._cachingFull$[e]}}})),ee((()=>this)),Ge((()=>{t in this._cachingFull$&&delete this._cachingFull$[t],this._changed$.next(this)})),Ke(),lt()),this._cachingFull$[t]}cacheNodeSequence$(t){if(!this.hasNode(t))throw new rp(`Cannot cache sequence edges of node that does not exist in graph (${t}).`);let e=this.getNode(t);if(e.sequenceId in this._sequences)throw new rp(`Sequence already cached (${t}), (${e.sequenceId}).`);return this._cacheSequence$(e.sequenceId)}cacheSequence$(t){if(t in this._sequences)throw new rp(`Sequence already cached (${t})`);return this._cacheSequence$(t)}cacheSequenceEdges(t){let e=this.getNode(t);if(!(e.sequenceId in this._sequences))throw new rp(`Sequence is not cached (${t}), (${e.sequenceId})`);let i=this._sequences[e.sequenceId].sequence,n=this._edgeCalculator.computeSequenceEdges(e,i);e.cacheSequenceEdges(n)}cacheSequenceNodes$(t,e){if(!this.hasSequence(t))throw new rp(`Cannot cache sequence nodes of sequence that does not exist in graph (${t}).`);if(this.hasSequenceNodes(t))throw new rp(`Sequence nodes already cached (${t}).`);const i=this.getSequence(t);if(i.id in this._cachingSequenceNodes$)return this._cachingSequenceNodes$[i.id];const n=[],r=i.imageIds.slice();if(e&&r.length>50){const t=r.indexOf(e),i=Math.max(0,Math.min(t-25,r.length-50));n.push(r.splice(i,50))}for(;r.length>0;)n.push(r.splice(0,200));let a=n.length;const o=Ft(n).pipe(fe((t=>this._api.getImages$(t).pipe(ci((t=>{for(const e of t){if(!e.node){console.warn(`Image empty (${e.node_id})`);continue}const t=e.node_id;if(this.hasNode(t)){const i=this.getNode(t);i.complete||this._makeFull(i,e.node)}else{null==e.node.sequence.id&&console.warn(`Sequence missing, discarding node (${e.node_id})`);const t=new Vh(e.node);this._makeFull(t,e.node);const i=this._api.data.geometry.lngLatToCellId(t.originalLngLat);this._preStore(i,t),this._setNode(t)}}a--})),ee((()=>this)))),6),Ze(),Ge((()=>{delete this._cachingSequenceNodes$[i.id],0===a&&(this._cachedSequenceNodes[i.id]=!0)})),Ke(),lt());return this._cachingSequenceNodes$[i.id]=o,o}cacheSpatialArea$(t){if(!this.hasNode(t))throw new rp(`Cannot cache spatial area of node that does not exist in graph (${t}).`);if(t in this._cachedSpatialEdges)throw new rp(`Image already spatially cached (${t}).`);if(!(t in this._requiredSpatialArea))throw new rp(`Spatial area not determined (${t}).`);let e=this._requiredSpatialArea[t];if(0===Object.keys(e.cacheNodes).length)throw new rp(`Spatial nodes already cached (${t}).`);if(t in this._cachingSpatialArea$)return this._cachingSpatialArea$[t];let i=[];for(;e.cacheKeys.length>0;)i.push(e.cacheKeys.splice(0,200));let n=i.length,r=[];for(let a of i){let i=this._api.getSpatialImages$(a).pipe(ci((i=>{for(const t of i){if(!t.node){console.warn(`Image is empty (${t.node_id})`);continue}const i=t.node_id,n=e.cacheNodes[i];n.complete?delete e.cacheNodes[i]:(this._makeFull(n,t.node),delete e.cacheNodes[i])}0===--n&&delete this._cachingSpatialArea$[t]})),ee((()=>this)),Re((i=>{for(let t of a)t in e.all&&delete e.all[t],t in e.cacheNodes&&delete e.cacheNodes[t];throw 0===--n&&delete this._cachingSpatialArea$[t],i})),Ge((()=>{0===Object.keys(e.cacheNodes).length&&this._changed$.next(this)})),Ke(),lt());r.push(i)}return this._cachingSpatialArea$[t]=r,r}cacheSpatialEdges(t){if(t in this._cachedSpatialEdges)throw new rp(`Spatial edges already cached (${t}).`);let e=this.getNode(t),i=this._sequences[e.sequenceId].sequence,n=[],r=i.findPrev(e.id);null!=r&&n.push(r);let a=i.findNext(e.id);null!=a&&n.push(a);let o=this._requiredSpatialArea[t].all,s=[],l=this._filter;for(let h in o){if(!o.hasOwnProperty(h))continue;let t=o[h];l(t)&&s.push(t)}let c=this._edgeCalculator.getPotentialEdges(e,s,n),u=this._edgeCalculator.computeStepEdges(e,c,r,a);u=u.concat(this._edgeCalculator.computeTurnEdges(e,c)),u=u.concat(this._edgeCalculator.computeSphericalEdges(e,c)),u=u.concat(this._edgeCalculator.computePerspectiveToSphericalEdges(e,c)),u=u.concat(this._edgeCalculator.computeSimilarEdges(e,c)),e.cacheSpatialEdges(u),this._cachedSpatialEdges[t]=e,delete this._requiredSpatialArea[t],delete this._cachedNodeTiles[t]}cacheTiles$(t){if(t in this._cachedNodeTiles)throw new rp(`Tiles already cached (${t}).`);if(t in this._cachedSpatialEdges)throw new rp(`Spatial edges already cached so tiles considered cached (${t}).`);if(!(t in this._requiredNodeTiles))throw new rp(`Tiles have not been determined (${t}).`);let e=this._requiredNodeTiles[t];if(0===e.cache.length&&0===e.caching.length)throw new rp(`Tiles already cached (${t}).`);if(!this.hasNode(t))throw new rp(`Cannot cache tiles of node that does not exist in graph (${t}).`);let i=e.cache.slice();e.caching=this._requiredNodeTiles[t].caching.concat(i),e.cache=[];let n=[];for(let r of e.caching){const i=r in this._cachingTiles$?this._cachingTiles$[r]:this._cacheTile$(r);n.push(i.pipe(ci((i=>{let n=e.caching.indexOf(r);n>-1&&e.caching.splice(n,1),0===e.caching.length&&0===e.cache.length&&(delete this._requiredNodeTiles[t],this._cachedNodeTiles[t]=!0)})),Re((i=>{let n=e.caching.indexOf(r);throw n>-1&&e.caching.splice(n,1),0===e.caching.length&&0===e.cache.length&&(delete this._requiredNodeTiles[t],this._cachedNodeTiles[t]=!0),i})),Ge((()=>{this._changed$.next(this)})),Ke(),lt()))}return n}initializeCache(t){if(t in this._cachedNodes)throw new rp(`Image already in cache (${t}).`);const e=this.getNode(t),i=this._api.data;e.initializeCache(new jh(i));const n=(new Date).getTime();this._cachedNodes[t]={accessed:n,node:e},this._updateCachedTileAccess(t,n)}isCachingFill(t){return t in this._cachingFill$}isCachingFull(t){return t in this._cachingFull$}isCachingNodeSequence(t){return this.getNode(t).sequenceId in this._cachingSequences$}isCachingSequence(t){return t in this._cachingSequences$}isCachingSequenceNodes(t){return t in this._cachingSequenceNodes$}isCachingTiles(t){return t in this._requiredNodeTiles&&0===this._requiredNodeTiles[t].cache.length&&this._requiredNodeTiles[t].caching.length>0}hasInitializedCache(t){return t in this._cachedNodes}hasNode(t){let e=(new Date).getTime();return this._updateCachedNodeAccess(t,e),this._updateCachedTileAccess(t,e),t in this._nodes}hasNodeSequence(t){let e=this.getNode(t).sequenceId,i=e in this._sequences;return i&&(this._sequences[e].accessed=(new Date).getTime()),i}hasSequence(t){let e=t in this._sequences;return e&&(this._sequences[t].accessed=(new Date).getTime()),e}hasSequenceNodes(t){return t in this._cachedSequenceNodes}hasSpatialArea(t){if(!this.hasNode(t))throw new rp(`Spatial area nodes cannot be determined if node not in graph (${t}).`);if(t in this._cachedSpatialEdges)return!0;if(t in this._requiredSpatialArea)return 0===Object.keys(this._requiredSpatialArea[t].cacheNodes).length;let e=this.getNode(t),i=this._graphCalculator.boundingBoxCorners(e.lngLat,this._tileThreshold),n=this._nodeIndex.search({maxX:i[1].lng,maxY:i[1].lat,minX:i[0].lng,minY:i[0].lat}),r={all:{},cacheKeys:[],cacheNodes:{}};for(let a of n)r.all[a.node.id]=a.node,a.node.complete||(r.cacheKeys.push(a.node.id),r.cacheNodes[a.node.id]=a.node);return this._requiredSpatialArea[t]=r,0===r.cacheKeys.length}hasTiles(t){if(t in this._cachedNodeTiles)return!0;if(t in this._cachedSpatialEdges)return!0;if(!this.hasNode(t))throw new rp(`Image does not exist in graph (${t}).`);let e={cache:[],caching:[]};if(t in this._requiredNodeTiles)e=this._requiredNodeTiles[t];else{const i=this.getNode(t),[n,r]=this._graphCalculator.boundingBoxCorners(i.lngLat,this._tileThreshold);e.cache=this._api.data.geometry.bboxToCellIds(n,r).filter((t=>!(t in this._cachedTiles))),e.cache.length>0&&(this._requiredNodeTiles[t]=e)}return 0===e.cache.length&&0===e.caching.length}getNode(t){let e=(new Date).getTime();return this._updateCachedNodeAccess(t,e),this._updateCachedTileAccess(t,e),this._nodes[t]}getSequence(t){let e=this._sequences[t];return e.accessed=(new Date).getTime(),e.sequence}resetSpatialEdges(){let t=Object.keys(this._cachedSpatialEdges);for(let e of t){this._cachedSpatialEdges[e].resetSpatialEdges(),delete this._cachedSpatialEdges[e]}}reset(t){const e=[];for(const i of t){if(!this.hasNode(i))throw new Error(`Image does not exist ${i}`);const t=this.getNode(i);t.resetSequenceEdges(),t.resetSpatialEdges(),e.push(t)}for(let i of Object.keys(this._cachedNodes))-1===t.indexOf(i)&&(this._cachedNodes[i].node.dispose(),delete this._cachedNodes[i]);this._cachedNodeTiles={},this._cachedSpatialEdges={},this._cachedTiles={},this._cachingFill$={},this._cachingFull$={},this._cachingSequences$={},this._cachingSpatialArea$={},this._cachingTiles$={},this._nodes={},this._nodeToTile={},this._preStored={};for(const i of e){this._nodes[i.id]=i;const t=this._api.data.geometry.lngLatToCellId(i.originalLngLat);this._preStore(t,i)}this._requiredNodeTiles={},this._requiredSpatialArea={},this._sequences={},this._nodeIndexTiles={},this._nodeIndex.clear()}setFilter(t){this._filter=this._filterCreator.createFilter(t),this._filterSubject$.next(this._filter)}uncache(t,e,i){const n={};this._addNewKeys(n,this._cachingFull$),this._addNewKeys(n,this._cachingFill$),this._addNewKeys(n,this._cachingSpatialArea$),this._addNewKeys(n,this._requiredNodeTiles),this._addNewKeys(n,this._requiredSpatialArea);for(const _ of t)_ in n||(n[_]=!0);const r=this._tileThreshold,a=this._graphCalculator,o=this._api.data.geometry,s=new Set(e);for(let _ in n){if(!n.hasOwnProperty(_))continue;const t=this._nodes[_],[e,i]=a.boundingBoxCorners(t.lngLat,r),l=o.bboxToCellIds(e,i);for(const n of l)s.has(n)||s.add(n)}const l=[];for(let _ in this._cachedTiles)this._cachedTiles.hasOwnProperty(_)&&!s.has(_)&&l.push([_,this._cachedTiles[_]]);const c=l.sort(((t,e)=>e[1].accessed-t[1].accessed)).slice(this._configuration.maxUnusedTiles).map((t=>t[0]));for(let _ of c)this._uncacheTile(_,i);const u=[],h=[];for(let _ in this._preStored){if(!this._preStored.hasOwnProperty(_)||_ in this._cachingTiles$)continue;const t=this._preStored[_];for(let e in t)t.hasOwnProperty(e)&&!(e in n)&&t[e].sequenceId!==i&&(e in this._cachedNodes?u.push([this._cachedNodes[e],_]):h.push([e,_]))}const p=u.sort((([t],[e])=>e.accessed-t.accessed)).slice(this._configuration.maxUnusedPreStoredImages).map((([t,e])=>[t.node.id,e]));this._uncachePreStored(h),this._uncachePreStored(p);const d=[];for(let _ in this._cachedNodes)this._cachedNodes.hasOwnProperty(_)&&!(_ in n)&&d.push(this._cachedNodes[_]);const f=d.sort(((t,e)=>e.accessed-t.accessed)).slice(this._configuration.maxUnusedImages);for(const _ of f){_.node.uncache();const t=_.node.id;delete this._cachedNodes[t],t in this._cachedNodeTiles&&delete this._cachedNodeTiles[t],t in this._cachedSpatialEdges&&delete this._cachedSpatialEdges[t]}const m=[];for(let _ in this._sequences)this._sequences.hasOwnProperty(_)&&!(_ in this._cachingSequences$)&&_!==i&&m.push(this._sequences[_]);const g=m.sort(((t,e)=>e.accessed-t.accessed)).slice(this._configuration.maxSequences);for(const _ of g){const t=_.sequence.id;delete this._sequences[t],t in this._cachedSequenceNodes&&delete this._cachedSequenceNodes[t],_.sequence.dispose()}}updateCells$(t){const e=this._cachedTiles,i=this._cachingTiles$;return Ft(t).pipe(fe((t=>t in e?this._updateCell$(t):t in i?i[t].pipe(Re((()=>Zt(this))),fe((()=>this._updateCell$(t)))):Et())))}unsubscribe(){this._filterSubscription.unsubscribe()}_addNewKeys(t,e){for(let i in e)e.hasOwnProperty(i)&&this.hasNode(i)&&(i in t||(t[i]=!0))}_cacheSequence$(t){return t in this._cachingSequences$||(this._cachingSequences$[t]=this._api.getSequence$(t).pipe(ci((e=>{e?(e.id in this._sequences||(this._sequences[e.id]={accessed:(new Date).getTime(),sequence:new qh(e)}),delete this._cachingSequences$[t]):console.warn(`Sequence does not exist (${t})`)})),ee((()=>this)),Ge((()=>{t in this._cachingSequences$&&delete this._cachingSequences$[t],this._changed$.next(this)})),Ke(),lt())),this._cachingSequences$[t]}_cacheTile$(t){return this._cachingTiles$[t]=this._api.getCoreImages$(t).pipe(ci((e=>{if(t in this._cachedTiles)return;const i=e.images;this._nodeIndexTiles[t]=[],this._cachedTiles[t]={accessed:(new Date).getTime(),nodes:[]};const n=this._cachedTiles[t].nodes,r=this._removeFromPreStore(t);for(const a of i){if(!a)break;if(null==a.sequence.id){console.warn(`Sequence missing, discarding node (${a.id})`);continue}if(null!=r&&a.id in r){const e=r[a.id];delete r[a.id],n.push(e);const i={lat:e.lngLat.lat,lng:e.lngLat.lng,node:e};this._nodeIndex.insert(i),this._nodeIndexTiles[t].push(i),this._nodeToTile[e.id]=t;continue}const e=new Vh(a);n.push(e);const i={lat:e.lngLat.lat,lng:e.lngLat.lng,node:e};this._nodeIndex.insert(i),this._nodeIndexTiles[t].push(i),this._nodeToTile[e.id]=t,this._setNode(e)}delete this._cachingTiles$[t]})),ee((()=>this)),Re((e=>{throw delete this._cachingTiles$[t],e})),Ke(),lt()),this._cachingTiles$[t]}_makeFull(t,e){null==e.computed_altitude&&(e.computed_altitude=this._defaultAlt),null==e.computed_rotation&&(e.computed_rotation=this._graphCalculator.rotationFromCompass(e.compass_angle,e.exif_orientation)),t.makeComplete(e)}_preStore(t,e){t in this._preStored||(this._preStored[t]={}),this._preStored[t][e.id]=e}_removeFromPreStore(t){let e=null;return t in this._preStored&&(e=this._preStored[t],delete this._preStored[t]),e}_setNode(t){let e=t.id;if(this.hasNode(e))throw new rp(`Image already exist (${e}).`);this._nodes[e]=t}_uncacheTile(t,e){for(let i of this._cachedTiles[t].nodes){let n=i.id;delete this._nodeToTile[n],n in this._cachedNodes&&delete this._cachedNodes[n],n in this._cachedNodeTiles&&delete this._cachedNodeTiles[n],n in this._cachedSpatialEdges&&delete this._cachedSpatialEdges[n],i.sequenceId===e?(this._preStore(t,i),i.uncache()):(delete this._nodes[n],i.sequenceId in this._cachedSequenceNodes&&delete this._cachedSequenceNodes[i.sequenceId],i.dispose())}for(let i of this._nodeIndexTiles[t])this._nodeIndex.remove(i);delete this._nodeIndexTiles[t],delete this._cachedTiles[t]}_uncachePreStored(t){let e={};for(let[i,n]of t){i in this._nodes&&delete this._nodes[i],i in this._cachedNodes&&delete this._cachedNodes[i];let t=this._preStored[n][i];t.sequenceId in this._cachedSequenceNodes&&delete this._cachedSequenceNodes[t.sequenceId],delete this._preStored[n][i],t.dispose(),e[n]=!0}for(let i in e)e.hasOwnProperty(i)&&0===Object.keys(this._preStored[i]).length&&delete this._preStored[i]}_updateCachedTileAccess(t,e){t in this._nodeToTile&&(this._cachedTiles[this._nodeToTile[t]].accessed=e)}_updateCachedNodeAccess(t,e){t in this._cachedNodes&&(this._cachedNodes[t].accessed=e)}_updateCell$(t){return this._api.getCoreImages$(t).pipe(fe((e=>{if(!(t in this._cachedTiles))return Et();const i=this._nodeIndex,n=this._nodeIndexTiles[t],r=this._nodeToTile,a=this._cachedTiles[t];a.accessed=(new Date).getTime();const o=a.nodes,s=e.images;for(const l of s){if(null==l)break;if(this.hasNode(l.id))continue;if(null==l.sequence.id){console.warn(`Sequence missing, discarding node (${l.id})`);continue}const e=new Vh(l);o.push(e);const a={lat:e.lngLat.lat,lng:e.lngLat.lng,node:e};i.insert(a),n.push(a),r[e.id]=t,this._setNode(e)}return Zt(t)})),Re((t=>(console.error(t),Et()))))}}class op{constructor(){this._hash={},this._index=new op._spatialIndex(16),this._indexChanged$=new ht,this._updated$=new ht}static register(t){op._spatialIndex=t}get changed$(){return this._indexChanged$}get updated$(){return this._updated$}add(t){const e=[],i=this._hash,n=this._index;for(const r of t){const t=r.id;t in i&&(n.remove(i[t]),e.push(r));const a={lat:r.lngLat.lat,lng:r.lngLat.lng,marker:r};i[t]=a,n.insert(a)}e.length>0&&this._updated$.next(e),t.length>e.length&&this._indexChanged$.next(this)}has(t){return t in this._hash}get(t){return this.has(t)?this._hash[t].marker:void 0}getAll(){return this._index.all().map((t=>t.marker))}remove(t){const e=this._hash,i=this._index;let n=!1;for(const r of t){if(!(r in e))continue;const t=e[r];i.remove(t),delete e[r],n=!0}n&&this._indexChanged$.next(this)}removeAll(){this._hash={},this._index.clear(),this._indexChanged$.next(this)}search([t,e]){return this._index.search({maxX:e.lng,maxY:e.lat,minX:t.lng,minY:t.lat}).map((t=>t.marker))}update(t){const e=this._hash,i=this._index,n=t.id;if(!(n in e))return;i.remove(e[n]);const r={lat:t.lngLat.lat,lng:t.lngLat.lng,marker:t};e[n]=r,i.insert(r)}}function sp(t,e,i,n,r){lp(t,e,i||0,n||t.length-1,r||up)}function lp(t,e,i,n,r){for(;n>i;){if(n-i>600){var a=n-i+1,o=e-i+1,s=Math.log(a),l=.5*Math.exp(2*s/3),c=.5*Math.sqrt(s*l*(a-l)/a)*(o-a/2<0?-1:1);lp(t,e,Math.max(i,Math.floor(e-o*l/a+c)),Math.min(n,Math.floor(e+(a-o)*l/a+c)),r)}var u=t[e],h=i,p=n;for(cp(t,i,e),r(t[n],u)>0&&cp(t,i,n);h<p;){for(cp(t,h,p),h++,p--;r(t[h],u)<0;)h++;for(;r(t[p],u)>0;)p--}0===r(t[i],u)?cp(t,i,p):cp(t,++p,n),p<=e&&(i=p+1),e<=p&&(n=p-1)}}function cp(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function up(t,e){return t<e?-1:t>e?1:0}function hp(t,e,i){if(!i)return e.indexOf(t);for(let n=0;n<e.length;n++)if(i(t,e[n]))return n;return-1}function pp(t,e){dp(t,0,t.children.length,e,t)}function dp(t,e,i,n,r){r||(r=wp(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let a=e;a<i;a++){const e=t.children[a];fp(r,t.leaf?n(e):e)}return r}function fp(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function mp(t,e){return t.minX-e.minX}function gp(t,e){return t.minY-e.minY}function _p(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function yp(t){return t.maxX-t.minX+(t.maxY-t.minY)}function vp(t,e){const i=Math.max(t.minX,e.minX),n=Math.max(t.minY,e.minY),r=Math.min(t.maxX,e.maxX),a=Math.min(t.maxY,e.maxY);return Math.max(0,r-i)*Math.max(0,a-n)}function xp(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function bp(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function wp(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Sp(t,e,i,n,r){const a=[e,i];for(;a.length;){if((i=a.pop())-(e=a.pop())<=n)continue;const o=e+Math.ceil((i-e)/n/2)*n;sp(t,o,e,i,r),a.push(e,o,o,i)}}class Ep extends class{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const i=[];if(!bp(t,e))return i;const n=this.toBBox,r=[];for(;e;){for(let a=0;a<e.children.length;a++){const o=e.children[a],s=e.leaf?n(o):o;bp(t,s)&&(e.leaf?i.push(o):xp(t,s)?this._all(o,i):r.push(o))}e=r.pop()}return i}collides(t){let e=this.data;if(!bp(t,e))return!1;const i=[];for(;e;){for(let n=0;n<e.children.length;n++){const r=e.children[n],a=e.leaf?this.toBBox(r):r;if(bp(t,a)){if(e.leaf||xp(t,a))return!0;i.push(r)}}e=i.pop()}return!1}load(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(let e=0;e<t.length;e++)this.insert(t[e]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const t=this.data;this.data=e,e=t}this._insert(e,this.data.height-e.height-1,!0)}else this.data=e;return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=wp([]),this}remove(t,e){if(!t)return this;let i=this.data;const n=this.toBBox(t),r=[],a=[];let o,s,l;for(;i||r.length;){if(i||(i=r.pop(),s=r[r.length-1],o=a.pop(),l=!0),i.leaf){const n=hp(t,i.children,e);if(-1!==n)return i.children.splice(n,1),r.push(i),this._condense(r),this}l||i.leaf||!xp(i,n)?s?(o++,i=s.children[o],l=!1):i=null:(r.push(i),a.push(o),o=0,s=i,i=i.children[0])}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const i=[];for(;t;)t.leaf?e.push(...t.children):i.push(...t.children),t=i.pop();return e}_build(t,e,i,n){const r=i-e+1;let a,o=this._maxEntries;if(r<=o)return a=wp(t.slice(e,i+1)),pp(a,this.toBBox),a;n||(n=Math.ceil(Math.log(r)/Math.log(o)),o=Math.ceil(r/Math.pow(o,n-1))),a=wp([]),a.leaf=!1,a.height=n;const s=Math.ceil(r/o),l=s*Math.ceil(Math.sqrt(o));Sp(t,e,i,l,this.compareMinX);for(let c=e;c<=i;c+=l){const e=Math.min(c+l-1,i);Sp(t,c,e,s,this.compareMinY);for(let i=c;i<=e;i+=s){const r=Math.min(i+s-1,e);a.children.push(this._build(t,i,r,n-1))}}return pp(a,this.toBBox),a}_chooseSubtree(t,e,i,n){for(;n.push(e),!e.leaf&&n.length-1!==i;){let i,n=1/0,o=1/0;for(let s=0;s<e.children.length;s++){const l=e.children[s],c=_p(l),u=(r=t,a=l,(Math.max(a.maxX,r.maxX)-Math.min(a.minX,r.minX))*(Math.max(a.maxY,r.maxY)-Math.min(a.minY,r.minY))-c);u<o?(o=u,n=c<n?c:n,i=l):u===o&&c<n&&(n=c,i=l)}e=i||e.children[0]}var r,a;return e}_insert(t,e,i){const n=i?t:this.toBBox(t),r=[],a=this._chooseSubtree(n,this.data,e,r);for(a.children.push(t),fp(a,n);e>=0&&r[e].children.length>this._maxEntries;)this._split(r,e),e--;this._adjustParentBBoxes(n,r,e)}_split(t,e){const i=t[e],n=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,n);const a=this._chooseSplitIndex(i,r,n),o=wp(i.children.splice(a,i.children.length-a));o.height=i.height,o.leaf=i.leaf,pp(i,this.toBBox),pp(o,this.toBBox),e?t[e-1].children.push(o):this._splitRoot(i,o)}_splitRoot(t,e){this.data=wp([t,e]),this.data.height=t.height+1,this.data.leaf=!1,pp(this.data,this.toBBox)}_chooseSplitIndex(t,e,i){let n,r=1/0,a=1/0;for(let o=e;o<=i-e;o++){const e=dp(t,0,o,this.toBBox),s=dp(t,o,i,this.toBBox),l=vp(e,s),c=_p(e)+_p(s);l<r?(r=l,n=o,a=c<a?c:a):l===r&&c<a&&(a=c,n=o)}return n||i-e}_chooseSplitAxis(t,e,i){const n=t.leaf?this.compareMinX:mp,r=t.leaf?this.compareMinY:gp;this._allDistMargin(t,e,i,n)<this._allDistMargin(t,e,i,r)&&t.children.sort(n)}_allDistMargin(t,e,i,n){t.children.sort(n);const r=this.toBBox,a=dp(t,0,e,r),o=dp(t,i-e,i,r);let s=yp(a)+yp(o);for(let l=e;l<i-e;l++){const e=t.children[l];fp(a,t.leaf?r(e):e),s+=yp(a)}for(let l=i-e-1;l>=e;l--){const e=t.children[l];fp(o,t.leaf?r(e):e),s+=yp(o)}return s}_adjustParentBBoxes(t,e,i){for(let n=i;n>=0;n--)fp(e[n],t)}_condense(t){for(let e,i=t.length-1;i>=0;i--)0===t[i].children.length?i>0?(e=t[i-1].children,e.splice(e.indexOf(t[i]),1)):this.clear():pp(t[i],this.toBBox)}}{compareMinX(t,e){return t.lng-e.lng}compareMinY(t,e){return t.lat-e.lat}toBBox(t){return{minX:t.lng,minY:t.lat,maxX:t.lng,maxY:t.lat}}}class Tp{constructor(t,e){this._components={};for(const i in Tp.registeredComponents){if(!Tp.registeredComponents.hasOwnProperty(i))continue;const n=Tp.registeredComponents[i];this._components[i]={active:!1,component:new n(i,t,e)}}this._coverComponent=new Tp.registeredCoverComponent("cover",t,e),this._coverComponent.activate(),this._coverActivated=!0}static register(t){void 0===Tp.registeredComponents[t.componentName]&&(Tp.registeredComponents[t.componentName]=t)}static registerCover(t){Tp.registeredCoverComponent=t}get coverActivated(){return this._coverActivated}activateCover(){if(!this._coverActivated){this._coverActivated=!0;for(const t in this._components){if(!this._components.hasOwnProperty(t))continue;const e=this._components[t];e.active&&e.component.deactivate()}}}deactivateCover(){if(this._coverActivated){this._coverActivated=!1;for(const t in this._components){if(!this._components.hasOwnProperty(t))continue;const e=this._components[t];e.active&&e.component.activate()}}}activate(t){this._checkName(t),this._components[t].active=!0,this._coverActivated||this.get(t).activate()}configure(t,e){this._checkName(t),this.get(t).configure(e)}deactivate(t){this._checkName(t),this._components[t].active=!1,this._coverActivated||this.get(t).deactivate()}get(t){return this._components[t].component}getCover(){return this._coverComponent}remove(){this._coverComponent.deactivate();for(const t in this._components)this._components.hasOwnProperty(t)&&this._components[t].component.deactivate()}_checkName(t){if(!(t in this._components))throw new Xh(`Component does not exist: ${t}`)}}Tp.registeredComponents={};var Mp="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{};function Cp(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach((function(i){var n=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(e,i,n.get?n:{enumerable:!0,get:function(){return t[i]}})})),e}var Ip=Array.isArray,Ap=Object.prototype.toString,kp=Ip||function(t){return"[object Array]"===Ap.call(t)};zp.NONE=0,zp.VTEXT=1,zp.VNODE=2,zp.WIDGET=3,zp.PROPS=4,zp.ORDER=5,zp.INSERT=6,zp.REMOVE=7,zp.THUNK=8;var Rp=zp;function zp(t,e,i){this.type=Number(t),this.vNode=e,this.patch=i}zp.prototype.version="2",zp.prototype.type="VirtualPatch";var Pp=function(t){return t&&"VirtualNode"===t.type&&"2"===t.version};var Dp=function(t){return t&&"VirtualText"===t.type&&"2"===t.version};var Lp=function(t){return t&&"Widget"===t.type};var Bp=function(t){return t&&"Thunk"===t.type};var Op=Pp,Fp=Dp,Np=Lp,Up=Bp,$p=function(t,e){var i=t,n=e;Up(e)&&(n=Vp(e,t));Up(t)&&(i=Vp(t,null));return{a:i,b:n}};function Vp(t,e){var i=t.vnode;if(i||(i=t.vnode=t.render(e)),!(Op(i)||Fp(i)||Np(i)))throw new Error("thunk did not return a valid node");return i}var jp=function(t){return"object"===typeof t&&null!==t},qp=function(t){return t&&("function"===typeof t.hook&&!t.hasOwnProperty("hook")||"function"===typeof t.unhook&&!t.hasOwnProperty("unhook"))};var Gp=jp,Hp=qp,Wp=function t(e,i){var n;for(var r in e){r in i||((n=n||{})[r]=void 0);var a=e[r],o=i[r];if(a!==o)if(Gp(a)&&Gp(o))if(Zp(o)!==Zp(a))(n=n||{})[r]=o;else if(Hp(o))(n=n||{})[r]=o;else{var s=t(a,o);s&&((n=n||{})[r]=s)}else(n=n||{})[r]=o}for(var l in i)l in e||((n=n||{})[l]=i[l]);return n};function Zp(t){return Object.getPrototypeOf?Object.getPrototypeOf(t):t.__proto__?t.__proto__:t.constructor?t.constructor.prototype:void 0}var Yp=kp,Xp=Rp,Kp=Pp,Jp=Dp,Qp=Lp,td=Bp,ed=$p,id=Wp;function nd(t,e){var i={a:t};return rd(t,e,i,0),i}function rd(t,e,i,n){if(t!==e){var r=i[n],a=!1;if(td(t)||td(e))sd(t,e,i,n);else if(null==e)Qp(t)||(ad(t,i,n),r=i[n]),r=hd(r,new Xp(Xp.REMOVE,t,e));else if(Kp(e))if(Kp(t))if(t.tagName===e.tagName&&t.namespace===e.namespace&&t.key===e.key){var o=id(t.properties,e.properties);o&&(r=hd(r,new Xp(Xp.PROPS,t,o))),r=function(t,e,i,n,r){for(var a=t.children,o=function(t,e){var i=ud(e),n=i.keys,r=i.free;if(r.length===e.length)return{children:e,moves:null};var a=ud(t),o=a.keys;if(a.free.length===t.length)return{children:e,moves:null};for(var s=[],l=0,c=r.length,u=0,h=0;h<t.length;h++){var p,d=t[h];d.key?n.hasOwnProperty(d.key)?(p=n[d.key],s.push(e[p])):(p=h-u++,s.push(null)):l<c?(p=r[l++],s.push(e[p])):(p=h-u++,s.push(null))}for(var f=l>=r.length?e.length:r[l],m=0;m<e.length;m++){var g=e[m];g.key?o.hasOwnProperty(g.key)||s.push(g):m>=f&&s.push(g)}for(var _,y=s.slice(),v=0,x=[],b=[],w=0;w<e.length;){var S=e[w];for(_=y[v];null===_&&y.length;)x.push(cd(y,v,null)),_=y[v];_&&_.key===S.key?(v++,w++):S.key?(_&&_.key&&n[_.key]!==w+1?(x.push(cd(y,v,_.key)),(_=y[v])&&_.key===S.key?v++:b.push({key:S.key,to:w})):b.push({key:S.key,to:w}),w++):_&&_.key&&x.push(cd(y,v,_.key))}for(;v<y.length;)_=y[v],x.push(cd(y,v,_&&_.key));if(x.length===u&&!b.length)return{children:s,moves:null};return{children:s,moves:{removes:x,inserts:b}}}(a,e.children),s=o.children,l=a.length,c=s.length,u=l>c?l:c,h=0;h<u;h++){var p=a[h],d=s[h];r+=1,p?rd(p,d,i,r):d&&(n=hd(n,new Xp(Xp.INSERT,null,d))),Kp(p)&&p.count&&(r+=p.count)}o.moves&&(n=hd(n,new Xp(Xp.ORDER,t,o.moves)));return n}(t,e,i,r,n)}else r=hd(r,new Xp(Xp.VNODE,t,e)),a=!0;else r=hd(r,new Xp(Xp.VNODE,t,e)),a=!0;else Jp(e)?Jp(t)?t.text!==e.text&&(r=hd(r,new Xp(Xp.VTEXT,t,e))):(r=hd(r,new Xp(Xp.VTEXT,t,e)),a=!0):Qp(e)&&(Qp(t)||(a=!0),r=hd(r,new Xp(Xp.WIDGET,t,e)));r&&(i[n]=r),a&&ad(t,i,n)}}function ad(t,e,i){ld(t,e,i),od(t,e,i)}function od(t,e,i){if(Qp(t))"function"===typeof t.destroy&&(e[i]=hd(e[i],new Xp(Xp.REMOVE,t,null)));else if(Kp(t)&&(t.hasWidgets||t.hasThunks))for(var n=t.children,r=n.length,a=0;a<r;a++){var o=n[a];od(o,e,i+=1),Kp(o)&&o.count&&(i+=o.count)}else td(t)&&sd(t,null,e,i)}function sd(t,e,i,n){var r=ed(t,e),a=nd(r.a,r.b);(function(t){for(var e in t)if("a"!==e)return!0;return!1})(a)&&(i[n]=new Xp(Xp.THUNK,null,a))}function ld(t,e,i){if(Kp(t)){if(t.hooks&&(e[i]=hd(e[i],new Xp(Xp.PROPS,t,function(t){var e={};for(var i in t)e[i]=void 0;return e}(t.hooks)))),t.descendantHooks||t.hasThunks)for(var n=t.children,r=n.length,a=0;a<r;a++){var o=n[a];ld(o,e,i+=1),Kp(o)&&o.count&&(i+=o.count)}}else td(t)&&sd(t,null,e,i)}function cd(t,e,i){return t.splice(e,1),{from:e,key:i}}function ud(t){for(var e={},i=[],n=t.length,r=0;r<n;r++){var a=t[r];a.key?e[a.key]=r:i.push(r)}return{keys:e,free:i}}function hd(t,e){return t?(Yp(t)?t.push(e):t=[t,e],t):e}var pd=nd,dd=Array.prototype.slice,fd=function(t,e){"length"in t||(t=[t]);t=dd.call(t);for(;t.length;){var i=t.shift(),n=e(i);if(n)return n;i.childNodes&&i.childNodes.length&&(t=dd.call(i.childNodes).concat(t))}};var md=gd;function gd(t,e){if(!(this instanceof gd))return new gd(t,e);this.data=t,this.nodeValue=t,this.length=t.length,this.ownerDocument=e||null}gd.prototype.nodeType=8,gd.prototype.nodeName="#comment",gd.prototype.toString=function(){return"[object Comment]"};var _d=yd;function yd(t,e){if(!(this instanceof yd))return new yd(t);this.data=t||"",this.length=this.data.length,this.ownerDocument=e||null}yd.prototype.type="DOMTextNode",yd.prototype.nodeType=3,yd.prototype.nodeName="#text",yd.prototype.toString=function(){return this.data},yd.prototype.replaceData=function(t,e,i){var n=this.data,r=n.substring(0,t),a=n.substring(t+e,n.length);this.data=r+i+a,this.length=this.data.length};var vd=function(t){var e=this,i=t.type;t.target||(t.target=e);e.listeners||(e.listeners={});var n=e.listeners[i];if(n)return n.forEach((function(i){t.currentTarget=e,"function"===typeof i?i(t):i.handleEvent(t)}));e.parentNode&&e.parentNode.dispatchEvent(t)};var xd=function(t,e){var i=this;i.listeners||(i.listeners={});i.listeners[t]||(i.listeners[t]=[]);-1===i.listeners[t].indexOf(e)&&i.listeners[t].push(e)};var bd=function(t,e){var i=this;if(!i.listeners)return;if(!i.listeners[t])return;var n=i.listeners[t],r=n.indexOf(e);-1!==r&&n.splice(r,1)};var wd=["area","base","br","col","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"];function Sd(t){switch(t.nodeType){case 3:return Md(t.data);case 8:return"\x3c!--"+t.data+"--\x3e";default:return function(t){var e=[],i=t.tagName;"http://www.w3.org/1999/xhtml"===t.namespaceURI&&(i=i.toLowerCase());e.push("<"+i+function(t){var e=[];for(var i in t)Ed(t,i)&&e.push({name:i,value:t[i]});for(var n in t._attributes)for(var r in t._attributes[n]){var a=t._attributes[n][r],o=(a.prefix?a.prefix+":":"")+r;e.push({name:o,value:a.value})}t.className&&e.push({name:"class",value:t.className});return e.length?Td(e):""}(t)+function(t){var e=t.dataset,i=[];for(var n in e)i.push({name:"data-"+n,value:e[n]});return i.length?Td(i):""}(t)),wd.indexOf(i)>-1?e.push(" />"):(e.push(">"),t.childNodes.length?e.push.apply(e,t.childNodes.map(Sd)):t.textContent||t.innerText?e.push(Md(t.textContent||t.innerText)):t.innerHTML&&e.push(t.innerHTML),e.push("</"+i+">"));return e.join("")}(t)}}function Ed(t,e){var i=typeof t[e];return"style"===e&&Object.keys(t.style).length>0||t.hasOwnProperty(e)&&("string"===i||"boolean"===i||"number"===i)&&"nodeName"!==e&&"className"!==e&&"tagName"!==e&&"textContent"!==e&&"innerText"!==e&&"namespaceURI"!==e&&"innerHTML"!==e}function Td(t){var e=[];return t.forEach((function(t){var i=t.name,n=t.value;"style"===i&&(n=function(t){if("string"===typeof t)return t;var e="";return Object.keys(t).forEach((function(i){var n=t[i];i=i.replace(/[A-Z]/g,(function(t){return"-"+t.toLowerCase()})),e+=i+":"+n+";"})),e}(n)),e.push(i+'="'+(Md(n).replace(/"/g,"&quot;")+'"'))})),e.length?" "+e.join(" "):""}function Md(t){var e="";return"string"===typeof t?e=t:t&&(e=t.toString()),e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var Cd=fd,Id=vd,Ad=xd,kd=bd,Rd=Sd,zd="http://www.w3.org/1999/xhtml",Pd=Dd;function Dd(t,e,i){if(!(this instanceof Dd))return new Dd(t);var n=void 0===i?zd:i||null;this.tagName=n===zd?String(t).toUpperCase():t,this.nodeName=this.tagName,this.className="",this.dataset={},this.childNodes=[],this.parentNode=null,this.style={},this.ownerDocument=e||null,this.namespaceURI=n,this._attributes={},"INPUT"===this.tagName&&(this.type="text")}Dd.prototype.type="DOMElement",Dd.prototype.nodeType=1,Dd.prototype.appendChild=function(t){return t.parentNode&&t.parentNode.removeChild(t),this.childNodes.push(t),t.parentNode=this,t},Dd.prototype.replaceChild=function(t,e){t.parentNode&&t.parentNode.removeChild(t);var i=this.childNodes.indexOf(e);return e.parentNode=null,this.childNodes[i]=t,t.parentNode=this,e},Dd.prototype.removeChild=function(t){var e=this.childNodes.indexOf(t);return this.childNodes.splice(e,1),t.parentNode=null,t},Dd.prototype.insertBefore=function(t,e){t.parentNode&&t.parentNode.removeChild(t);var i=null===e||void 0===e?-1:this.childNodes.indexOf(e);return i>-1?this.childNodes.splice(i,0,t):this.childNodes.push(t),t.parentNode=this,t},Dd.prototype.setAttributeNS=function(t,e,i){var n=null,r=e,a=e.indexOf(":");(a>-1&&(n=e.substr(0,a),r=e.substr(a+1)),"INPUT"===this.tagName&&"type"===e)?this.type=i:(this._attributes[t]||(this._attributes[t]={}))[r]={value:i,prefix:n}},Dd.prototype.getAttributeNS=function(t,e){var i=this._attributes[t],n=i&&i[e]&&i[e].value;return"INPUT"===this.tagName&&"type"===e?this.type:"string"!==typeof n?null:n},Dd.prototype.removeAttributeNS=function(t,e){var i=this._attributes[t];i&&delete i[e]},Dd.prototype.hasAttributeNS=function(t,e){var i=this._attributes[t];return!!i&&e in i},Dd.prototype.setAttribute=function(t,e){return this.setAttributeNS(null,t,e)},Dd.prototype.getAttribute=function(t){return this.getAttributeNS(null,t)},Dd.prototype.removeAttribute=function(t){return this.removeAttributeNS(null,t)},Dd.prototype.hasAttribute=function(t){return this.hasAttributeNS(null,t)},Dd.prototype.removeEventListener=kd,Dd.prototype.addEventListener=Ad,Dd.prototype.dispatchEvent=Id,Dd.prototype.focus=function(){},Dd.prototype.toString=function(){return Rd(this)},Dd.prototype.getElementsByClassName=function(t){var e=t.split(" "),i=[];return Cd(this,(function(t){if(1===t.nodeType){var n=(t.className||"").split(" ");e.every((function(t){return-1!==n.indexOf(t)}))&&i.push(t)}})),i},Dd.prototype.getElementsByTagName=function(t){t=t.toLowerCase();var e=[];return Cd(this.childNodes,(function(i){1!==i.nodeType||"*"!==t&&i.tagName.toLowerCase()!==t||e.push(i)})),e},Dd.prototype.contains=function(t){return Cd(this,(function(e){return t===e}))||!1};var Ld=Pd,Bd=Od;function Od(t){if(!(this instanceof Od))return new Od;this.childNodes=[],this.parentNode=null,this.ownerDocument=t||null}Od.prototype.type="DocumentFragment",Od.prototype.nodeType=11,Od.prototype.nodeName="#document-fragment",Od.prototype.appendChild=Ld.prototype.appendChild,Od.prototype.replaceChild=Ld.prototype.replaceChild,Od.prototype.removeChild=Ld.prototype.removeChild,Od.prototype.toString=function(){return this.childNodes.map((function(t){return String(t)})).join("")};var Fd=Nd;function Nd(t){}Nd.prototype.initEvent=function(t,e,i){this.type=t,this.bubbles=e,this.cancelable=i},Nd.prototype.preventDefault=function(){};var Ud=fd,$d=md,Vd=_d,jd=Pd,qd=Bd,Gd=Fd,Hd=vd,Wd=xd,Zd=bd,Yd=Xd;function Xd(){if(!(this instanceof Xd))return new Xd;this.head=this.createElement("head"),this.body=this.createElement("body"),this.documentElement=this.createElement("html"),this.documentElement.appendChild(this.head),this.documentElement.appendChild(this.body),this.childNodes=[this.documentElement],this.nodeType=9}var Kd=Xd.prototype;Kd.createTextNode=function(t){return new Vd(t,this)},Kd.createElementNS=function(t,e){var i=null===t?null:String(t);return new jd(e,this,i)},Kd.createElement=function(t){return new jd(t,this)},Kd.createDocumentFragment=function(){return new qd(this)},Kd.createEvent=function(t){return new Gd(t)},Kd.createComment=function(t){return new $d(t,this)},Kd.getElementById=function(t){return t=String(t),Ud(this.childNodes,(function(e){if(String(e.id)===t)return e}))||null},Kd.getElementsByClassName=jd.prototype.getElementsByClassName,Kd.getElementsByTagName=jd.prototype.getElementsByTagName,Kd.contains=jd.prototype.contains,Kd.removeEventListener=Zd,Kd.addEventListener=Wd,Kd.dispatchEvent=Hd;var Jd,Qd=new Yd,tf="undefined"!==typeof Mp?Mp:"undefined"!==typeof window?window:{},ef=Qd;"undefined"!==typeof document?Jd=document:(Jd=tf["__GLOBAL_DOCUMENT_CACHE@4"])||(Jd=tf["__GLOBAL_DOCUMENT_CACHE@4"]=ef);var nf=jp,rf=qp,af=function(t,e,i){for(var n in e){var r=e[n];void 0===r?of(t,n,r,i):rf(r)?(of(t,n,r,i),r.hook&&r.hook(t,n,i?i[n]:void 0)):nf(r)?sf(t,e,i,n,r):t[n]=r}};function of(t,e,i,n){if(n){var r=n[e];if(rf(r))r.unhook&&r.unhook(t,e,i);else if("attributes"===e)for(var a in r)t.removeAttribute(a);else if("style"===e)for(var o in r)t.style[o]="";else t[e]="string"===typeof r?"":null}}function sf(t,e,i,n,r){var a=i?i[n]:void 0;if("attributes"!==n)if(a&&nf(a)&&lf(a)!==lf(r))t[n]=r;else{nf(t[n])||(t[n]={});var o="style"===n?"":void 0;for(var s in r){var l=r[s];t[n][s]=void 0===l?o:l}}else for(var c in r){var u=r[c];void 0===u?t.removeAttribute(c):t.setAttribute(c,u)}}function lf(t){return Object.getPrototypeOf?Object.getPrototypeOf(t):t.__proto__?t.__proto__:t.constructor?t.constructor.prototype:void 0}var cf=Jd,uf=af,hf=Pp,pf=Dp,df=Lp,ff=$p,mf=function t(e,i){var n=i&&i.document||cf,r=i?i.warn:null;if(e=ff(e).a,df(e))return e.init();if(pf(e))return n.createTextNode(e.text);if(!hf(e))return r&&r("Item is not a valid virtual dom node",e),null;var a=null===e.namespace?n.createElement(e.tagName):n.createElementNS(e.namespace,e.tagName),o=e.properties;uf(a,o);for(var s=e.children,l=0;l<s.length;l++){var c=t(s[l],i);c&&a.appendChild(c)}return a};var gf={};function _f(t,e,i,n,r){if(n=n||{},t){yf(i,r,r)&&(n[r]=t);var a=e.children;if(a)for(var o=t.childNodes,s=0;s<e.children.length;s++){r+=1;var l=a[s]||gf,c=r+(l.count||0);yf(i,r,c)&&_f(o[s],l,i,n,r),r=c}}return n}function yf(t,e,i){if(0===t.length)return!1;for(var n,r,a=0,o=t.length-1;a<=o;){if(r=t[n=(o+a)/2>>0],a===o)return r>=e&&r<=i;if(r<e)a=n+1;else{if(!(r>i))return!0;o=n-1}}return!1}function vf(t,e){return t>e?1:-1}var xf=Lp;var bf=af,wf=Lp,Sf=Rp,Ef=function(t,e){if(xf(t)&&xf(e))return"name"in t&&"name"in e?t.id===e.id:t.init===e.init;return!1},Tf=function(t,e,i){var n=t.type,r=t.vNode,a=t.patch;switch(n){case Sf.REMOVE:return function(t,e){var i=t.parentNode;i&&i.removeChild(t);return Mf(t,e),null}(e,r);case Sf.INSERT:return function(t,e,i){var n=i.render(e,i);t&&t.appendChild(n);return t}(e,a,i);case Sf.VTEXT:return function(t,e,i,n){var r;if(3===t.nodeType)t.replaceData(0,t.length,i.text),r=t;else{var a=t.parentNode;r=n.render(i,n),a&&r!==t&&a.replaceChild(r,t)}return r}(e,0,a,i);case Sf.WIDGET:return function(t,e,i,n){var r,a=Ef(e,i);r=a?i.update(e,t)||t:n.render(i,n);var o=t.parentNode;o&&r!==t&&o.replaceChild(r,t);a||Mf(t,e);return r}(e,r,a,i);case Sf.VNODE:return function(t,e,i,n){var r=t.parentNode,a=n.render(i,n);r&&a!==t&&r.replaceChild(a,t);return a}(e,0,a,i);case Sf.ORDER:return function(t,e){for(var i,n,r,a=t.childNodes,o={},s=0;s<e.removes.length;s++)i=a[(n=e.removes[s]).from],n.key&&(o[n.key]=i),t.removeChild(i);for(var l=a.length,c=0;c<e.inserts.length;c++)i=o[(r=e.inserts[c]).key],t.insertBefore(i,r.to>=l++?null:a[r.to])}(e,a),e;case Sf.PROPS:return bf(e,a,r.properties),e;case Sf.THUNK:return function(t,e){t&&e&&t!==e&&t.parentNode&&t.parentNode.replaceChild(e,t);return e}(e,i.patch(e,a,i));default:return e}};function Mf(t,e){"function"===typeof e.destroy&&wf(e)&&e.destroy(t)}var Cf=Jd,If=kp,Af=mf,kf=function(t,e,i,n){return i&&0!==i.length?(i.sort(vf),_f(t,e,i,n,0)):{}},Rf=Tf,zf=function t(e,i,n){return(n=n||{}).patch=n.patch&&n.patch!==t?n.patch:Pf,n.render=n.render||Af,n.patch(e,i,n)};function Pf(t,e,i){var n=function(t){var e=[];for(var i in t)"a"!==i&&e.push(Number(i));return e}(e);if(0===n.length)return t;var r=kf(t,e.a,n),a=t.ownerDocument;i.document||a===Cf||(i.document=a);for(var o=0;o<n.length;o++){var s=n[o];t=Df(t,r[s],e[s],i)}return t}function Df(t,e,i,n){if(!e)return t;var r;if(If(i))for(var a=0;a<i.length;a++)r=Rf(i[a],e,n),e===t&&(t=r);else r=Rf(i,e,n),e===t&&(t=r);return t}var Lf=zf,Bf=Pp,Of=Lp,Ff=Bp,Nf=qp,Uf=jf,$f={},Vf=[];function jf(t,e,i,n,r){this.tagName=t,this.properties=e||$f,this.children=i||Vf,this.key=null!=n?String(n):void 0,this.namespace="string"===typeof r?r:null;var a,o=i&&i.length||0,s=0,l=!1,c=!1,u=!1;for(var h in e)if(e.hasOwnProperty(h)){var p=e[h];Nf(p)&&p.unhook&&(a||(a={}),a[h]=p)}for(var d=0;d<o;d++){var f=i[d];Bf(f)?(s+=f.count||0,!l&&f.hasWidgets&&(l=!0),!c&&f.hasThunks&&(c=!0),u||!f.hooks&&!f.descendantHooks||(u=!0)):!l&&Of(f)?"function"===typeof f.destroy&&(l=!0):!c&&Ff(f)&&(c=!0)}this.count=o+s,this.hasWidgets=l,this.hasThunks=c,this.hooks=a,this.descendantHooks=u}jf.prototype.version="2",jf.prototype.type="VirtualNode";var qf=Gf;function Gf(t){this.text=String(t)}Gf.prototype.version="2",Gf.prototype.type="VirtualText";var Hf=function(t){var e,i=String.prototype.split,n=/()??/.exec("")[1]===t;return e=function(e,r,a){if("[object RegExp]"!==Object.prototype.toString.call(r))return i.call(e,r,a);var o,s,l,c,u=[],h=(r.ignoreCase?"i":"")+(r.multiline?"m":"")+(r.extended?"x":"")+(r.sticky?"y":""),p=0;r=new RegExp(r.source,h+"g");for(e+="",n||(o=new RegExp("^"+r.source+"$(?!\\s)",h)),a=a===t?-1>>>0:a>>>0;(s=r.exec(e))&&!((l=s.index+s[0].length)>p&&(u.push(e.slice(p,s.index)),!n&&s.length>1&&s[0].replace(o,(function(){for(var e=1;e<arguments.length-2;e++)arguments[e]===t&&(s[e]=t)})),s.length>1&&s.index<e.length&&Array.prototype.push.apply(u,s.slice(1)),c=s[0].length,p=l,u.length>=a));)r.lastIndex===s.index&&r.lastIndex++;return p===e.length?!c&&r.test("")||u.push(""):u.push(e.slice(p)),u.length>a?u.slice(0,a):u},e}(),Wf=Hf,Zf=/([\.#]?[a-zA-Z0-9\u007F-\uFFFF_:-]+)/,Yf=/^\.|#/,Xf=function(t,e){if(!t)return"DIV";var i,n,r,a,o=!e.hasOwnProperty("id"),s=Wf(t,Zf),l=null;Yf.test(s[1])&&(l="DIV");for(a=0;a<s.length;a++)(n=s[a])&&(r=n.charAt(0),l?"."===r?(i=i||[]).push(n.substring(1,n.length)):"#"===r&&o&&(e.id=n.substring(1,n.length)):l=n);i&&(e.className&&i.push(e.className),e.className=i.join(" "));return e.namespace?l:l.toUpperCase()};var Kf=Jf;function Jf(t){if(!(this instanceof Jf))return new Jf(t);this.value=t}Jf.prototype.hook=function(t,e){t[e]!==this.value&&(t[e]=this.value)};var Qf="undefined"!==typeof window?window:"undefined"!==typeof Mp?Mp:{};var tm=function(t,e){if(t in Qf)return Qf[t];return Qf[t]=e,e},em=function(t,e,i){var n="__INDIVIDUAL_ONE_VERSION_"+t,r=tm(n+"_ENFORCE_SINGLETON",e);if(r!==e)throw new Error("Can only have one copy of "+t+".\nYou already have version "+r+" installed.\nThis means you cannot install version "+e);return tm(n,i)};em("ev-store","7");var im="__EV_STORE_KEY@7";var nm=function(t){var e=t[im];e||(e=t[im]={});return e},rm=am;function am(t){if(!(this instanceof am))return new am(t);this.value=t}am.prototype.hook=function(t,e){nm(t)[e.substr(3)]=this.value},am.prototype.unhook=function(t,e){nm(t)[e.substr(3)]=void 0};var om=kp,sm=Uf,lm=qf,cm=Pp,um=Dp,hm=Lp,pm=qp,dm=Bp,fm=Xf,mm=Kf,gm=rm,_m=function(t,e,i){var n,r,a,o,s=[];!i&&(l=e,"string"===typeof l||om(l)||vm(l))&&(i=e,r={});var l;n=fm(t,r=r||e||{}),r.hasOwnProperty("key")&&(a=r.key,r.key=void 0);r.hasOwnProperty("namespace")&&(o=r.namespace,r.namespace=void 0);"INPUT"!==n||o||!r.hasOwnProperty("value")||void 0===r.value||pm(r.value)||(r.value=mm(r.value));(function(t){for(var e in t)if(t.hasOwnProperty(e)){var i=t[e];if(pm(i))continue;"ev-"===e.substr(0,3)&&(t[e]=gm(i))}})(r),void 0!==i&&null!==i&&ym(i,s,n,r);return new sm(n,r,s,a,o)};function ym(t,e,i,n){if("string"===typeof t)e.push(new lm(t));else if("number"===typeof t)e.push(new lm(String(t)));else if(vm(t))e.push(t);else{if(!om(t)){if(null===t||void 0===t)return;throw function(t){var e=new Error;return e.type="virtual-hyperscript.unexpected.virtual-element",e.message="Unexpected virtual child passed to h().\nExpected a VNode / Vthunk / VWidget / string but:\ngot:\n"+xm(t.foreignObject)+".\nThe parent vnode is:\n"+xm(t.parentVnode),e.foreignObject=t.foreignObject,e.parentVnode=t.parentVnode,e}({foreignObject:t,parentVnode:{tagName:i,properties:n}})}for(var r=0;r<t.length;r++)ym(t[r],e,i,n)}}function vm(t){return cm(t)||um(t)||hm(t)||dm(t)}function xm(t){try{return JSON.stringify(t,null,"    ")}catch(e){return String(t)}}var bm,wm,Sm={diff:pd,patch:Lf,h:_m,create:mf,VNode:Uf,VText:qf};class Em{constructor(){this._events={}}fire(t,e){if(this._listens(t))for(const i of this._events[t])i(e)}off(t,e){if(t){if(this._listens(t)){const i=this._events[t].indexOf(e);i>=0&&this._events[t].splice(i,1),this._events[t].length||delete this._events[t]}}else this._events={}}on(t,e){this._events[t]=this._events[t]||[],this._events[t].push(e)}_listens(t){return t in this._events}}class Tm{constructor(){this._subscriptions=[]}push(t){this._subscriptions.push(t)}unsubscribe(){for(const t of this._subscriptions)t.unsubscribe();this._subscriptions=[]}}class Mm extends Em{constructor(t,e,i){super(),this._activated$=new dt(!1),this._configurationSubject$=new ht,this._activated=!1,this._container=e,this._name=t,this._navigator=i,this._subscriptions=new Tm,this._configuration$=this._configurationSubject$.pipe(ai(this.defaultConfiguration),ti(((t,e)=>{for(let i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t})),Je(1),lt()),this._configuration$.subscribe((()=>{}))}get activated(){return this._activated}get activated$(){return this._activated$}get defaultConfiguration(){return this._getDefaultConfiguration()}get configuration$(){return this._configuration$}get name(){return this._name}activate(t){this._activated||(void 0!==t&&this._configurationSubject$.next(t),this._activated=!0,this._activate(),this._activated$.next(!0))}configure(t){this._configurationSubject$.next(t)}deactivate(){this._activated&&(this._activated=!1,this._deactivate(),this._container.domRenderer.clear(this._name),this._container.glRenderer.clear(this._name),this._activated$.next(!1))}fire(t,e){super.fire(t,e)}off(t,e){super.off(t,e)}on(t,e){super.on(t,e)}resize(){}}!function(t){t[t.Hidden=0]="Hidden",t[t.Loading=1]="Loading",t[t.Visible=2]="Visible"}(bm||(bm={}));class Cm extends Mm{constructor(t,e,i){super(t,e,i)}_activate(){const t=this.configuration$.pipe(He((t=>!!t.id)),Ce((t=>!t.src)),oi((t=>this._getImageSrc$(t.id).pipe(Re((t=>(console.error(t),Et())))))),Je(1),lt()),e=this._subscriptions;e.push(t.pipe(ee((t=>({src:t})))).subscribe((t=>{this._configurationSubject$.next(t)}))),e.push(ue(this.configuration$,t).pipe(Ce((([t,e])=>!!t.src&&t.src!==e)),He()).subscribe((([,t])=>{window.URL.revokeObjectURL(t)}))),e.push(this._configuration$.pipe(Ue(void 0,(t=>t.state)),oi((t=>ue(Zt(t.state),this._navigator.stateService.currentImage$))),oi((([t,e])=>{const i=ue(Zt(e.id),e.image$.pipe(Ce((t=>!!t)),ee((t=>t.src))));return t===bm.Visible?i.pipe(He()):i})),Ue((([t,e],[i,n])=>t===i&&e===n)),ee((([t,e])=>({id:t,src:e})))).subscribe(this._configurationSubject$)),e.push(ue(this._configuration$,this._container.configurationService.exploreUrl$,this._container.renderService.size$).pipe(ee((([t,e,i])=>{if(!t.src)return{name:this._name,vNode:Sm.h("div",[])};const n=i.width<=640||i.height<=480?".mapillary-cover-compact":"";if(t.state===bm.Hidden){const e=Sm.h("div.mapillary-cover-container.mapillary-cover-done"+n,[this._getCoverBackgroundVNode(t)]);return{name:this._name,vNode:e}}const r=Sm.h("div.mapillary-cover-container"+n,[this._getCoverButtonVNode(t,e)]);return{name:this._name,vNode:r}}))).subscribe(this._container.domRenderer.render$))}_deactivate(){this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{state:bm.Visible}}_getCoverButtonVNode(t,e){const i=t.state===bm.Loading?"div.mapillary-cover.mapillary-cover-loading":"div.mapillary-cover",n=Sm.h("div.mapillary-cover-button",[Sm.h("div.mapillary-cover-button-icon",[])]),r=Sm.h("a.mapillary-cover-logo",{href:e,target:"_blank"},[]),a=Sm.h("div.mapillary-cover-indicator",{onclick:()=>{this.configure({state:bm.Loading})}},[]);return Sm.h(i,[this._getCoverBackgroundVNode(t),a,n,r])}_getCoverBackgroundVNode(t){const e={style:{backgroundImage:`url(${t.src})`}},i=[];return t.state===bm.Loading&&i.push(Sm.h("div.mapillary-cover-spinner",{},[])),Sm.h("div.mapillary-cover-background",e,i)}_getImageSrc$(t){return nt.create((e=>{this._navigator.api.getImages$([t]).subscribe((i=>{for(const n of i){const i="number"===typeof t?t.toString():t;if(n.node_id===i)return void this._navigator.api.data.getImageBuffer(n.node.thumb.url).then((i=>{const n=new Image;n.crossOrigin="Anonymous",n.onload=()=>{e.next(n.src),e.complete()},n.onerror=()=>{e.error(new Error(`Failed to load cover image (${t})`))};const r=new Blob([i]);n.src=window.URL.createObjectURL(r)}),(t=>{e.error(t)}))}e.error(new Yh(`Non existent cover key: ${t}`))}),(t=>{e.error(t)}))}))}}Cm.componentName="cover";class Im extends Mm{_activate(){this._subscriptions.push(ue(this._container.configurationService.exploreUrl$,this._navigator.stateService.currentImage$,this._container.renderService.size$).pipe(ee((([t,e,i])=>{const n=this._makeAttribution(e.creatorUsername,t,e.id,e.capturedAt,i.width);return{name:this._name,vNode:n}}))).subscribe(this._container.domRenderer.render$))}_deactivate(){this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{}}makeImageUrl(t,e){return`${t}/app/?pKey=${e}&focus=photo`}_makeAttribution(t,e,i,n,r){const a=r<=640,o=this._makeDate(n,a),s=this._makeBy(t,e,i,a),l=a?".mapillary-attribution-compact":"";return Sm.h("div.mapillary-attribution-container"+l,{},[...s,o])}_makeBy(t,e,i,n){const r=Sm.h("div.mapillary-attribution-logo",[]);return t?this._makeCreatorBy(r,t,e,i,n):this._makeGeneralBy(r,e,i,n)}_makeCreatorBy(t,e,i,n,r){const a=Sm.h("a.mapillary-attribution-icon-container",{href:i,rel:"noreferrer",target:"_blank"},[t]),o=r?`${e}`:`image by ${e}`,s=Sm.h("div.mapillary-attribution-username",{textContent:o},[]);return[a,Sm.h("a.mapillary-attribution-image-container",{href:this.makeImageUrl(i,n),rel:"noreferrer",target:"_blank"},[s])]}_makeGeneralBy(t,e,i,n){const r=Sm.h("div.mapillary-attribution-username",{textContent:"images by"},[]),a=[Sm.h("div.mapillary-attribution-icon-container",{},[t]),Sm.h("div.mapillary-attribution-username",{textContent:"contributors"},[])];n||a.unshift(r);return[Sm.h("a.mapillary-attribution-image-container",{href:this.makeImageUrl(e,i),rel:"noreferrer",target:"_blank"},a)]}_makeDate(t,e){const i=new Date(t).toDateString().split(" "),n=(i.length>3?e?[i[3]]:[i[1],i[2]+",",i[3]]:i).join(" ");return Sm.h("div.mapillary-attribution-date",{textContent:n},[])}}Im.componentName="attribution";class Am{constructor(){this._unprojectDepth=200}basicToCanvas(t,e,i,n,r){const a=n.unprojectBasic([t,e],this._unprojectDepth);return this.projectToCanvas(a,i,r)}basicToCanvasSafe(t,e,i,n,r){const a=this.basicToViewportSafe(t,e,n,r);if(null===a)return null;return this.viewportToCanvas(a[0],a[1],i)}basicToViewport(t,e,i,n){const r=i.unprojectBasic([t,e],this._unprojectDepth);return this.projectToViewport(r,n)}basicToViewportSafe(t,e,i,n){const r=i.unprojectBasic([t,e],this._unprojectDepth);if(this.worldToCamera(r,n)[2]>0)return null;return this.projectToViewport(r,n)}cameraToViewport(t,e){const i=(new bn).fromArray(t).applyMatrix4(e.projectionMatrix);return[i.x,i.y]}canvasPosition(t,e){const i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}canvasToBasic(t,e,i,n,r){const a=this.unprojectFromCanvas(t,e,i,r).toArray();return n.projectBasic(a)}canvasToViewport(t,e,i){const[n,r]=this.containerToCanvas(i);return[2*t/n-1,1-2*e/r]}containerToCanvas(t){return[t.offsetWidth,t.offsetHeight]}getBasicDistances(t,e){const i=this.viewportToBasic(-1,1,t,e),n=this.viewportToBasic(1,1,t,e),r=this.viewportToBasic(1,-1,t,e),a=this.viewportToBasic(-1,-1,t,e);let o=0,s=0,l=0,c=0;return i[1]<0&&n[1]<0&&(o=i[1]>n[1]?-i[1]:-n[1]),n[0]>1&&r[0]>1&&(s=n[0]<r[0]?n[0]-1:r[0]-1),r[1]>1&&a[1]>1&&(l=r[1]<a[1]?r[1]-1:a[1]-1),a[0]<0&&i[0]<0&&(c=a[0]>i[0]?-a[0]:-i[0]),[o,s,l,c]}getPixelDistances(t,e,i){const n=this.viewportToBasic(-1,1,e,i),r=this.viewportToBasic(1,1,e,i),a=this.viewportToBasic(1,-1,e,i),o=this.viewportToBasic(-1,-1,e,i);let s=0,l=0,c=0,u=0;const[h,p]=this.containerToCanvas(t);if(n[1]<0&&r[1]<0){const a=n[1]>r[1]?n[0]:r[0],o=this.basicToCanvas(a,0,t,e,i);s=o[1]>0?o[1]:0}if(r[0]>1&&a[0]>1){const n=r[0]<a[0]?r[1]:a[1],o=this.basicToCanvas(1,n,t,e,i);l=o[0]<h?h-o[0]:0}if(a[1]>1&&o[1]>1){const n=a[1]<o[1]?a[0]:o[0],r=this.basicToCanvas(n,1,t,e,i);c=r[1]<p?p-r[1]:0}if(o[0]<0&&n[0]<0){const r=o[0]>n[0]?o[1]:n[1],a=this.basicToCanvas(0,r,t,e,i);u=a[0]>0?a[0]:0}return[s,l,c,u]}insideElement(t,e){const i=e.getBoundingClientRect(),n=i.left+e.clientLeft,r=n+e.clientWidth,a=i.top+e.clientTop,o=a+e.clientHeight;return t.clientX>n&&t.clientX<r&&t.clientY>a&&t.clientY<o}projectToCanvas(t,e,i){const n=this.projectToViewport(t,i);return this.viewportToCanvas(n[0],n[1],e)}projectToCanvasSafe(t,e,i){if(this.worldToCamera(t,i)[2]>0)return null;const n=this.projectToViewport(t,i);return this.viewportToCanvas(n[0],n[1],e)}projectToViewport(t,e){const i=new bn(t[0],t[1],t[2]).project(e);return[i.x,i.y]}unprojectFromCanvas(t,e,i,n){const r=this.canvasToViewport(t,e,i);return this.unprojectFromViewport(r[0],r[1],n)}unprojectFromViewport(t,e,i){return new bn(t,e,1).unproject(i)}viewportToBasic(t,e,i,n){const r=new bn(t,e,1).unproject(n).toArray();return i.projectBasic(r)}viewportToCanvas(t,e,i){const[n,r]=this.containerToCanvas(i);return[n*(t+1)/2,-r*(e-1)/2]}worldToCamera(t,e){return new bn(t[0],t[1],t[2]).applyMatrix4(e.matrixWorldInverse).toArray()}}!function(t){t[t.Automatic=0]="Automatic",t[t.Large=1]="Large",t[t.Small=2]="Small"}(wm||(wm={}));class km extends Mm{constructor(t,e,i){super(t,e,i),this._spatial=new Kh,this._viewportCoords=new Am,this._svgNamespace="http://www.w3.org/2000/svg",this._distinctThreshold=Math.PI/360,this._animationSpeed=.075}_activate(){const t=this._subscriptions,e=this._container.renderService.renderCamera$.pipe(ee((t=>{let e=this._spatial.degToRad(t.perspective.fov),i=t.perspective.aspect===Number.POSITIVE_INFINITY?Math.PI:2*Math.atan(t.perspective.aspect*Math.tan(.5*e));return[this._spatial.azimuthalToBearing(t.rotation.phi),i]})),Ue(((t,e)=>Math.abs(e[0]-t[0])<this._distinctThreshold&&Math.abs(e[1]-t[1])<this._distinctThreshold))),i=ue(this._navigator.stateService.currentState$.pipe(Ue(void 0,(t=>t.state.currentImage.id))),this._navigator.panService.panImages$).pipe(ee((([t,e])=>{const i=t.state.currentImage,n=t.state.currentTransform;if(Qh(i.cameraType))return[Math.PI,Math.PI];const r=this._computeProjectedPoints(n),a=this._spatial.degToRad(this._computeHorizontalFov(r));let o=a/2,s=a/2;for(const[l,,c]of e){const t=this._spatial.wrap(l.compassAngle-i.compassAngle,-180,180);t<0?o=this._spatial.degToRad(Math.abs(t))+c/2:s=this._spatial.degToRad(Math.abs(t))+c/2}return[o,s]})),Ue((([t,e],[i,n])=>Math.abs(i-t)<this._distinctThreshold&&Math.abs(n-e)<this._distinctThreshold))),n=ue(this._navigator.stateService.currentState$.pipe(Ue(void 0,(t=>t.state.currentImage.id))),this._container.renderService.bearing$).pipe(ee((([t,e])=>this._spatial.degToRad(t.state.currentImage.compassAngle-e)))),r=new ht,a=r.pipe(ti(((t,e)=>e(t)),{alpha:0,curr:[0,0,0],prev:[0,0,0]}),ee((t=>{const e=on.smootherstep(t.alpha,0,1),i=t.curr,n=t.prev;return[this._interpolate(n[0],i[0],e),this._interpolate(n[1],i[1],e)]})));t.push(i.pipe(ee((t=>e=>{const i=on.smootherstep(e.alpha,0,1),n=e.curr,r=e.prev,a=[this._interpolate(r[0],n[0],i),this._interpolate(r[1],n[1],i)];return{alpha:0,curr:t.slice(),prev:a}}))).subscribe(r)),t.push(i.pipe(oi((()=>this._container.renderService.renderCameraFrame$.pipe(ni(1),ti((t=>t+this._animationSpeed),0),li((t=>t<=1+this._animationSpeed)),ee((t=>Math.min(t,1)))))),ee((t=>e=>({alpha:t,curr:e.curr.slice(),prev:e.prev.slice()})))).subscribe(r));const o=ue(n,a).pipe(ee((([t,e])=>[t,e[0],e[1]])));t.push(ue(e,o,this._configuration$,this._container.renderService.size$).pipe(ee((([[t,e],[i,n,r],a,o])=>{const s=this._createBackground(t),l=this._createFovIndicator(n,r,i),c=this._createNorth(t),u=this._createCircleSectorCompass(this._createCircleSector(Math.max(Math.PI/20,e),"#FFF")),h=a.size===wm.Small||a.size===wm.Automatic&&o.width<640?".mapillary-bearing-compact":"";return{name:this._name,vNode:Sm.h("div.mapillary-bearing-indicator-container"+h,{oncontextmenu:t=>{t.preventDefault()}},[s,l,c,u])}}))).subscribe(this._container.domRenderer.render$))}_deactivate(){this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{size:wm.Automatic}}_createFovIndicator(t,e,i){const n=this._createFovArc(t,e),r=Sm.h("g",{attributes:{transform:"translate(18,18)"},namespace:this._svgNamespace},[n]);return Sm.h("svg",{attributes:{viewBox:"0 0 36 36"},namespace:this._svgNamespace,style:{height:"36px",left:"2px",position:"absolute",top:"2px",transform:`rotateZ(${this._spatial.radToDeg(i)}deg)`,width:"36px"}},[r])}_createFovArc(t,e){const i=16.75,n=t+e;if(n>2*Math.PI-Math.PI/90)return Sm.h("circle",{attributes:{cx:"0",cy:"0","fill-opacity":"0",r:"16.75",stroke:"#FFF","stroke-width":"2.5"},namespace:this._svgNamespace},[]);let r=-Math.PI/2-t,a=r+n,o=i*Math.cos(r),s=i*Math.sin(r),l=i*Math.cos(a),c=i*Math.sin(a),u=`M ${o} ${s} A 16.75 16.75 0 ${n>=Math.PI?1:0} 1 ${l} ${c}`;return Sm.h("path",{attributes:{d:u,"fill-opacity":"0",stroke:"#FFF","stroke-width":"2.5"},namespace:this._svgNamespace},[])}_createCircleSectorCompass(t){let e=Sm.h("g",{attributes:{transform:"translate(1,1)"},namespace:this._svgNamespace},[t]);return Sm.h("svg",{attributes:{viewBox:"0 0 2 2"},namespace:this._svgNamespace,style:{height:"26px",left:"7px",position:"absolute",top:"7px",width:"26px"}},[e])}_createCircleSector(t,e){if(t>2*Math.PI-Math.PI/90)return Sm.h("circle",{attributes:{cx:"0",cy:"0",fill:e,r:"1"},namespace:this._svgNamespace},[]);let i=-Math.PI/2-t/2,n=i+t,r=Math.cos(i),a=Math.sin(i),o=Math.cos(n),s=Math.sin(n),l=`M 0 0 ${r} ${a} A 1 1 0 ${t>=Math.PI?1:0} 1 ${o} ${s}`;return Sm.h("path",{attributes:{d:l,fill:e},namespace:this._svgNamespace},[])}_createNorth(t){const e=Sm.h("div.mapillary-bearing-north",[]);return Sm.h("div.mapillary-bearing-north-container",{style:{transform:`rotateZ(${this._spatial.radToDeg(-t)}deg)`}},[e])}_createBackground(t){return Sm.h("div.mapillary-bearing-indicator-background",{style:{transform:`rotateZ(${this._spatial.radToDeg(-t)}deg)`}},[Sm.h("div.mapillary-bearing-indicator-background-circle",[]),Sm.h("div.mapillary-bearing-indicator-background-arrow-container",[Sm.h("div.mapillary-bearing-indicator-background-arrow",[])])])}_computeProjectedPoints(t){return ip(t,[[1,0]],[[0,.5]],12,this._viewportCoords)}_computeHorizontalFov(t){const e=t.map((t=>this._coordToFov(t[0])));return Math.min(...e)}_coordToFov(t){return this._spatial.radToDeg(2*Math.atan(t))}_interpolate(t,e,i){return(1-i)*t+i*e}}km.componentName="bearing";class Rm extends Mm{constructor(t,e,i){super(t,e,i)}_activate(){const t=this._subscriptions;t.push(ue(this._navigator.stateService.currentImage$.pipe(oi((t=>t.sequenceEdges$)),Ce((t=>t.cached))),this._configuration$).pipe(oi((t=>{let e=t[0],i=t[1],n=Math.max(0,Math.min(4,i.depth.sequence));return Ee(this._cache$(e.edges,Hh.Next,n),this._cache$(e.edges,Hh.Prev,n)).pipe(Re((t=>(console.error("Failed to cache sequence edges.",t),Et()))))}))).subscribe((()=>{}))),t.push(ue(this._navigator.stateService.currentImage$.pipe(oi((t=>ue(Zt(t),t.spatialEdges$.pipe(Ce((t=>t.cached))))))),this._configuration$).pipe(oi((([[t,e],i])=>{let n=e.edges,r=i.depth,a=Math.max(0,Math.min(2,r.spherical)),o=Qh(t.cameraType)?0:Math.max(0,Math.min(3,r.step)),s=Qh(t.cameraType)?0:Math.max(0,Math.min(1,r.turn)),l=this._cache$(n,Hh.Spherical,a);return Ee(this._cache$(n,Hh.StepForward,o),this._cache$(n,Hh.StepBackward,o),this._cache$(n,Hh.StepLeft,o),this._cache$(n,Hh.StepRight,o),l,this._cache$(n,Hh.TurnLeft,s),this._cache$(n,Hh.TurnRight,s),this._cache$(n,Hh.TurnU,s)).pipe(Re((t=>(console.error("Failed to cache spatial edges.",t),Et()))))}))).subscribe((()=>{})))}_deactivate(){this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{depth:{spherical:1,sequence:2,step:1,turn:0}}}_cache$(t,e,i){return Ie(Zt(t),Zt(i)).pipe(qe((t=>{let i=t[0],n=t[1],r=[];if(n>0)for(let a of i)a.data.direction===e&&r.push(Ie(this._navigator.graphService.cacheImage$(a.target).pipe(fe((t=>this._imageToEdges$(t,e)))),Zt(n-1)));return Ft(r).pipe(me())})),ni(1))}_imageToEdges$(t,e){return([Hh.Next,Hh.Prev].indexOf(e)>-1?t.sequenceEdges$:t.spatialEdges$).pipe(He((t=>t.cached)),ee((t=>t.edges)))}}Rm.componentName="cache";class zm extends Yh{constructor(t){super(null!=t?t:"The request was cancelled."),Object.setPrototypeOf(this,zm.prototype),this.name="CancelMapillaryError"}}class Pm{constructor(t,e){this._spatial=new Kh,this._minThresholdWidth=320,this._maxThresholdWidth=1480,this._minThresholdHeight=240,this._maxThresholdHeight=820,this._configure(t),this._resize(e),this._reset()}get minWidth(){return this._minWidth}get maxWidth(){return this._maxWidth}get containerWidth(){return this._containerWidth}get containerWidthCss(){return this._containerWidthCss}get containerMarginCss(){return this._containerMarginCss}get containerLeftCss(){return this._containerLeftCss}get containerHeight(){return this._containerHeight}get containerHeightCss(){return this._containerHeightCss}get containerBottomCss(){return this._containerBottomCss}get stepCircleSize(){return this._stepCircleSize}get stepCircleSizeCss(){return this._stepCircleSizeCss}get stepCircleMarginCss(){return this._stepCircleMarginCss}get turnCircleSize(){return this._turnCircleSize}get turnCircleSizeCss(){return this._turnCircleSizeCss}get outerRadius(){return this._outerRadius}get innerRadius(){return this._innerRadius}get shadowOffset(){return this._shadowOffset}configure(t){this._configure(t),this._reset()}resize(t){this._resize(t),this._reset()}angleToCoordinates(t){return[Math.cos(t),Math.sin(t)]}relativeAngleToCoordiantes(t,e){let i=this._spatial.wrapAngle(t-e);return this.angleToCoordinates(i)}_configure(t){this._minWidth=t.minWidth,this._maxWidth=this._getMaxWidth(t.minWidth,t.maxWidth)}_resize(t){this._elementWidth=t.width,this._elementHeight=t.height}_reset(){this._containerWidth=this._getContainerWidth(this._elementWidth,this._elementHeight),this._containerHeight=this._getContainerHeight(this.containerWidth),this._stepCircleSize=this._getStepCircleDiameter(this._containerHeight),this._turnCircleSize=this._getTurnCircleDiameter(this.containerHeight),this._outerRadius=this._getOuterRadius(this._containerHeight),this._innerRadius=this._getInnerRadius(this._containerHeight),this._shadowOffset=3,this._containerWidthCss=this._numberToCssPixels(this._containerWidth),this._containerMarginCss=this._numberToCssPixels(-.5*this._containerWidth),this._containerLeftCss=this._numberToCssPixels(Math.floor(.5*this._elementWidth)),this._containerHeightCss=this._numberToCssPixels(this._containerHeight),this._containerBottomCss=this._numberToCssPixels(Math.floor(-.08*this._containerHeight)),this._stepCircleSizeCss=this._numberToCssPixels(this._stepCircleSize),this._stepCircleMarginCss=this._numberToCssPixels(-.5*this._stepCircleSize),this._turnCircleSizeCss=this._numberToCssPixels(this._turnCircleSize)}_getContainerWidth(t,e){let i=(t-this._minThresholdWidth)/(this._maxThresholdWidth-this._minThresholdWidth),n=(e-this._minThresholdHeight)/(this._maxThresholdHeight-this._minThresholdHeight),r=Math.max(0,Math.min(1,Math.min(i,n)));return r=.04*Math.round(25*r),this._minWidth+r*(this._maxWidth-this._minWidth)}_getContainerHeight(t){return.77*t}_getStepCircleDiameter(t){return.34*t}_getTurnCircleDiameter(t){return.3*t}_getOuterRadius(t){return.31*t}_getInnerRadius(t){return.125*t}_numberToCssPixels(t){return t+"px"}_getMaxWidth(t,e){return t>e?t:e}}class Dm{constructor(t,e){this._isEdge=!1,this._spatial=new Kh,this._calculator=new Pm(t,e),this._image=null,this._rotation={phi:0,theta:0},this._epsilon=.5*Math.PI/180,this._highlightKey=null,this._distinguishSequence=!1,this._needsRender=!1,this._stepEdges=[],this._turnEdges=[],this._sphericalEdges=[],this._sequenceEdgeKeys=[],this._stepDirections=[Hh.StepForward,Hh.StepBackward,Hh.StepLeft,Hh.StepRight],this._turnDirections=[Hh.TurnLeft,Hh.TurnRight,Hh.TurnU],this._turnNames={},this._turnNames[Hh.TurnLeft]="mapillary-direction-turn-left",this._turnNames[Hh.TurnRight]="mapillary-direction-turn-right",this._turnNames[Hh.TurnU]="mapillary-direction-turn-around";let i=!!document.documentMode;this._isEdge=!i&&!!window.StyleMedia}get needsRender(){return this._needsRender}render(t){this._needsRender=!1;let e=this._rotation,i=[],n=[];return Qh(this._image.cameraType)?i=i.concat(this._createSphericalArrows(t,e)):(i=i.concat(this._createPerspectiveToSphericalArrows(t,e)),i=i.concat(this._createStepArrows(t,e)),n=n.concat(this._createTurnArrows(t))),this._getContainer(i,n,e)}setEdges(t,e){this._setEdges(t,e),this._setNeedsRender()}setImage(t){this._image=t,this._clearEdges(),this._setNeedsRender()}setRenderCamera(t){let e=t.rotation;Math.abs(e.phi-this._rotation.phi)<this._epsilon||(this._rotation=e,this._setNeedsRender())}setConfiguration(t){let e=!1;this._highlightKey===t.highlightId&&this._distinguishSequence===t.distinguishSequence||(this._highlightKey=t.highlightId,this._distinguishSequence=t.distinguishSequence,e=!0),this._calculator.minWidth===t.minWidth&&this._calculator.maxWidth===t.maxWidth||(this._calculator.configure(t),e=!0),e&&this._setNeedsRender()}resize(t){this._calculator.resize(t),this._setNeedsRender()}_setNeedsRender(){null!=this._image&&(this._needsRender=!0)}_clearEdges(){this._stepEdges=[],this._turnEdges=[],this._sphericalEdges=[],this._sequenceEdgeKeys=[]}_setEdges(t,e){this._stepEdges=[],this._turnEdges=[],this._sphericalEdges=[],this._sequenceEdgeKeys=[];for(let i of t.edges){let t=i.data.direction;this._stepDirections.indexOf(t)>-1?this._stepEdges.push(i):this._turnDirections.indexOf(t)>-1?this._turnEdges.push(i):i.data.direction===Hh.Spherical&&this._sphericalEdges.push(i)}if(this._distinguishSequence&&null!=e){let t=this._sphericalEdges.concat(this._stepEdges).concat(this._turnEdges);for(let i of t){let t=i.target;for(let i of e.imageIds)if(i===t){this._sequenceEdgeKeys.push(t);break}}}}_createSphericalArrows(t,e){let i=[];for(let n of this._sphericalEdges)i.push(this._createVNodeByKey(t,n.target,n.data.worldMotionAzimuth,e,this._calculator.outerRadius,"mapillary-direction-arrow-spherical"));for(let n of this._stepEdges)i.push(this._createSphericalToPerspectiveArrow(t,n.target,n.data.worldMotionAzimuth,e,n.data.direction));return i}_createSphericalToPerspectiveArrow(t,e,i,n,r){let a=Math.PI/8,o=n.phi;switch(r){case Hh.StepBackward:o=n.phi-Math.PI;break;case Hh.StepLeft:o=n.phi+Math.PI/2;break;case Hh.StepRight:o=n.phi-Math.PI/2}return Math.abs(this._spatial.wrapAngle(i-o))<a?this._createVNodeByKey(t,e,i,n,this._calculator.outerRadius,"mapillary-direction-arrow-step"):this._createVNodeInactive(e,i,n)}_createPerspectiveToSphericalArrows(t,e){let i=[];for(let n of this._sphericalEdges)i.push(this._createVNodeByKey(t,n.target,n.data.worldMotionAzimuth,e,this._calculator.innerRadius,"mapillary-direction-arrow-spherical",!0));return i}_createStepArrows(t,e){let i=[];for(let n of this._stepEdges)i.push(this._createVNodeByDirection(t,n.target,n.data.worldMotionAzimuth,e,n.data.direction));return i}_createTurnArrows(t){let e=[];for(let i of this._turnEdges){let n=i.data.direction,r=this._turnNames[n];e.push(this._createVNodeByTurn(t,i.target,r,n))}return e}_createVNodeByKey(t,e,i,n,r,a,o){return this._createVNode(e,i,n,r,a,"mapillary-direction-circle",(i=>{t.moveTo$(e).subscribe(void 0,(t=>{t instanceof zm||console.error(t)}))}),o)}_createVNodeByDirection(t,e,i,n,r){return this._createVNode(e,i,n,this._calculator.outerRadius,"mapillary-direction-arrow-step","mapillary-direction-circle",(e=>{t.moveDir$(r).subscribe(void 0,(t=>{t instanceof zm||console.error(t)}))}))}_createVNodeByTurn(t,e,i,n){let r={height:this._calculator.turnCircleSizeCss,transform:"rotate(0)",width:this._calculator.turnCircleSizeCss};switch(n){case Hh.TurnLeft:r.left="5px",r.top="5px";break;case Hh.TurnRight:r.right="5px",r.top="5px";break;case Hh.TurnU:r.left="5px",r.bottom="5px"}let a={attributes:{"data-id":e},onclick:e=>{t.moveDir$(n).subscribe(void 0,(t=>{t instanceof zm||console.error(t)}))},style:r},o="mapillary-direction-turn-circle";this._sequenceEdgeKeys.indexOf(e)>-1&&(o+="-sequence"),this._highlightKey===e&&(o+="-highlight");let s=Sm.h(`div.${i}`,{},[]);return Sm.h("div."+o,a,[s])}_createVNodeInactive(t,e,i){return this._createVNode(t,e,i,this._calculator.outerRadius,"mapillary-direction-arrow-inactive","mapillary-direction-circle-inactive")}_createVNode(t,e,i,n,r,a,o,s){let l=this._calculator.angleToCoordinates(e-i.phi),c=Math.round(-n*l[1]+.5*this._calculator.containerWidth),u=Math.round(-n*l[0]+.5*this._calculator.containerHeight),h=this._calculator.relativeAngleToCoordiantes(e,i.phi),p=this._calculator.shadowOffset,d=`drop-shadow(${-p*h[1]}px ${p*h[0]}px 1px rgba(0,0,0,0.8))`,f={style:{"-webkit-filter":d,filter:d}},m=Sm.h("div."+r,f,[]),g=-this._spatial.radToDeg(e-i.phi),_=s?`translate(${c}px, ${u}px) rotate(${g}deg) translateZ(-0.01px)`:`translate(${c}px, ${u}px) rotate(${g}deg)`,y={attributes:{"data-id":t},onclick:o,style:{height:this._calculator.stepCircleSizeCss,marginLeft:this._calculator.stepCircleMarginCss,marginTop:this._calculator.stepCircleMarginCss,transform:_,width:this._calculator.stepCircleSizeCss}};return this._sequenceEdgeKeys.indexOf(t)>-1&&(a+="-sequence"),this._highlightKey===t&&(a+="-highlight"),Sm.h("div."+a,y,[m])}_getContainer(t,e,i){let n=this._isEdge?"rotateX(60deg)":`perspective(${this._calculator.containerWidthCss}) rotateX(60deg)`,r={oncontextmenu:t=>{t.preventDefault()},style:{bottom:this._calculator.containerBottomCss,height:this._calculator.containerHeightCss,left:this._calculator.containerLeftCss,marginLeft:this._calculator.containerMarginCss,transform:n,width:this._calculator.containerWidthCss}};return Sm.h("div.mapillary-direction-perspective",r,e.concat(t))}}class Lm extends Mm{constructor(t,e,i,n){super(t,e,i),this._renderer=n||new Dm(this.defaultConfiguration,{height:e.container.offsetHeight,width:e.container.offsetWidth}),this._hoveredIdSubject$=new ht,this._hoveredId$=this._hoveredIdSubject$.pipe(ei())}fire(t,e){super.fire(t,e)}off(t,e){super.off(t,e)}on(t,e){super.on(t,e)}_activate(){const t=this._subscriptions;t.push(this._configuration$.subscribe((t=>{this._renderer.setConfiguration(t)}))),t.push(this._container.renderService.size$.subscribe((t=>{this._renderer.resize(t)}))),t.push(this._navigator.stateService.currentImage$.pipe(ci((t=>{this._container.domRenderer.render$.next({name:this._name,vNode:Sm.h("div",{},[])}),this._renderer.setImage(t)})),ui(this._configuration$),oi((([t,e])=>ue(t.spatialEdges$,e.distinguishSequence?this._navigator.graphService.cacheSequence$(t.sequenceId).pipe(Re((e=>(console.error(`Failed to cache sequence (${t.sequenceId})`,e),Zt(null))))):Zt(null))))).subscribe((([t,e])=>{this._renderer.setEdges(t,e)}))),t.push(this._container.renderService.renderCameraFrame$.pipe(ci((t=>{this._renderer.setRenderCamera(t)})),ee((()=>this._renderer)),Ce((t=>t.needsRender)),ee((t=>({name:this._name,vNode:t.render(this._navigator)})))).subscribe(this._container.domRenderer.render$)),t.push(ue(this._container.domRenderer.element$,this._container.renderService.renderCamera$,this._container.mouseService.mouseMove$.pipe(ai(null)),this._container.mouseService.mouseUp$.pipe(ai(null))).pipe(ee((([t])=>{let e=t.getElementsByClassName("mapillary-direction-perspective");for(let i=0;i<e.length;i++){let t=e.item(i).querySelector(":hover");if(null!=t&&t.hasAttribute("data-id"))return t.getAttribute("data-id")}return null})),Ue()).subscribe(this._hoveredIdSubject$)),t.push(this._hoveredId$.subscribe((t=>{const e="hover",i={id:t,target:this,type:e};this.fire(e,i)})))}_deactivate(){this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{distinguishSequence:!1,maxWidth:460,minWidth:260}}}Lm.componentName="direction";class Bm{}Bm.fisheye={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float focal;\nuniform float k1;\nuniform float k2;\nuniform float scale_x;\nuniform float scale_y;\nuniform float radial_peak;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float x = vRstq.x;\n    float y = vRstq.y;\n    float z = vRstq.z;\n\n    float r = sqrt(x * x + y * y);\n    float theta = atan(r, z);\n\n    if (radial_peak > 0. && theta > radial_peak) {\n        theta = radial_peak;\n    }\n\n    float theta2 = theta * theta;\n    float theta_d = theta * (1.0 + theta2 * (k1 + theta2 * k2));\n    float s = focal * theta_d / r;\n\n    float u = scale_x * s * x + 0.5;\n    float v = -scale_y * s * y + 0.5;\n\n    vec4 baseColor;\n    if (u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},Bm.fisheyeCurtain={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float focal;\nuniform float k1;\nuniform float k2;\nuniform float scale_x;\nuniform float scale_y;\nuniform float radial_peak;\nuniform float curtain;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float x = vRstq.x;\n    float y = vRstq.y;\n    float z = vRstq.z;\n\n    float r2 = sqrt(x * x + y * y);\n    float theta = atan(r2, z);\n\n    if (radial_peak > 0. && theta > radial_peak) {\n        theta = radial_peak;\n    }\n\n    float theta2 = theta * theta;\n    float theta_d = theta * (1.0 + theta2 * (k1 + theta2 * k2));\n    float s = focal * theta_d / r2;\n\n    float u = scale_x * s * x + 0.5;\n    float v = -scale_y * s * y + 0.5;\n\n    vec4 baseColor;\n    if ((u < curtain || curtain >= 1.0) && u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},Bm.perspective={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float focal;\nuniform float k1;\nuniform float k2;\nuniform float scale_x;\nuniform float scale_y;\nuniform float radial_peak;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float x = vRstq.x / vRstq.z;\n    float y = vRstq.y / vRstq.z;\n    float r2 = x * x + y * y;\n\n    if (radial_peak > 0. && r2 > radial_peak * sqrt(r2)) {\n        r2 = radial_peak * radial_peak;\n    }\n\n    float d = 1.0 + k1 * r2 + k2 * r2 * r2;\n    float u = scale_x * focal * d * x + 0.5;\n    float v = - scale_y * focal * d * y + 0.5;\n\n    vec4 baseColor;\n    if (u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},Bm.perspectiveCurtain={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float focal;\nuniform float k1;\nuniform float k2;\nuniform float scale_x;\nuniform float scale_y;\nuniform float radial_peak;\nuniform float curtain;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float x = vRstq.x / vRstq.z;\n    float y = vRstq.y / vRstq.z;\n    float r2 = x * x + y * y;\n\n    if (radial_peak > 0. && r2 > radial_peak * sqrt(r2)) {\n        r2 = radial_peak * radial_peak;\n    }\n\n    float d = 1.0 + k1 * r2 + k2 * r2 * r2;\n    float u = scale_x * focal * d * x + 0.5;\n    float v = - scale_y * focal * d * y + 0.5;\n\n    vec4 baseColor;\n    if ((u < curtain || curtain >= 1.0) && u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},Bm.perspectiveDistorted={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float u = vRstq.x / vRstq.w;\n    float v = vRstq.y / vRstq.w;\n\n    vec4 baseColor;\n    if (u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},Bm.perspectiveDistortedCurtain={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float curtain;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float u = vRstq.x / vRstq.w;\n    float v = vRstq.y / vRstq.w;\n\n    vec4 baseColor;\n    if ((u < curtain || curtain >= 1.0) && u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},Bm.spherical={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#define tau 6.28318530718\n\nuniform sampler2D projectorTex;\nuniform float opacity;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vec3 b = normalize(vRstq.xyz);\n    float lat = -asin(b.y);\n    float lng = atan(b.x, b.z);\n    float x = lng / tau + 0.5;\n    float y = lat / tau * 2.0 + 0.5;\n    vec4 baseColor = texture2D(projectorTex, vec2(x, y));\n    baseColor.a = opacity;\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},Bm.sphericalCurtain={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#define tau 6.28318530718\n\nuniform sampler2D projectorTex;\nuniform float curtain;\nuniform float opacity;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vec3 b = normalize(vRstq.xyz);\n    float lat = -asin(b.y);\n    float lng = atan(b.x, b.z);\n    float x = lng / tau + 0.5;\n    float y = lat / tau * 2.0 + 0.5;\n\n    bool inverted = curtain < 0.5;\n\n    float curtainMin = inverted ? curtain + 0.5 : curtain - 0.5;\n    float curtainMax = curtain;\n\n    bool insideCurtain = inverted ?\n        x > curtainMin || x < curtainMax :\n        x > curtainMin && x < curtainMax;\n\n    vec4 baseColor;\n    if (insideCurtain) {\n        baseColor = texture2D(projectorTex, vec2(x, y));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"};class Om{constructor(t,e){this._imagePlaneDepth=null!=t?t:200,this._imageSphereRadius=null!=e?e:200}createMesh(t,e){return Qh(e.cameraType)?this._createImageSphere(t,e):tp(e.cameraType)?this._createImagePlaneFisheye(t,e):this._createImagePlane(t,e)}createFlatMesh(t,e,i,n,r,a){let o=this._createTexture(t.image),s=this._createDistortedPlaneMaterialParameters(e,o),l=new Ia(s),c=this._getFlatImagePlaneGeoFromBasic(e,i,n,r,a);return new wa(c,l)}createCurtainMesh(t,e){return Qh(e.cameraType)?this._createSphereCurtainMesh(t,e):tp(e.cameraType)?this._createCurtainMeshFisheye(t,e):this._createCurtainMesh(t,e)}createDistortedCurtainMesh(t,e){return this._createDistortedCurtainMesh(t,e)}_createCurtainMesh(t,e){let i=this._createTexture(t.image),n=this._createCurtainPlaneMaterialParameters(e,i),r=new Ia(n),a=this._useMesh(e,t)?this._getImagePlaneGeo(e,t):this._getRegularFlatImagePlaneGeo(e);return new wa(a,r)}_createCurtainMeshFisheye(t,e){let i=this._createTexture(t.image),n=this._createCurtainPlaneMaterialParametersFisheye(e,i),r=new Ia(n),a=this._useMesh(e,t)?this._getImagePlaneGeoFisheye(e,t):this._getRegularFlatImagePlaneGeo(e);return new wa(a,r)}_createDistortedCurtainMesh(t,e){let i=this._createTexture(t.image),n=this._createDistortedCurtainPlaneMaterialParameters(e,i),r=new Ia(n),a=this._getRegularFlatImagePlaneGeo(e);return new wa(a,r)}_createSphereCurtainMesh(t,e){let i=this._createTexture(t.image),n=this._createCurtainSphereMaterialParameters(e,i),r=new Ia(n);return this._useMesh(e,t)?new wa(this._getImageSphereGeo(e,t),r):new wa(this._getFlatImageSphereGeo(e),r)}_createImageSphere(t,e){let i=this._createTexture(t.image),n=this._createSphereMaterialParameters(e,i),r=new Ia(n);return this._useMesh(e,t)?new wa(this._getImageSphereGeo(e,t),r):new wa(this._getFlatImageSphereGeo(e),r)}_createImagePlane(t,e){let i=this._createTexture(t.image),n=this._createPlaneMaterialParameters(e,i),r=new Ia(n),a=this._useMesh(e,t)?this._getImagePlaneGeo(e,t):this._getRegularFlatImagePlaneGeo(e);return new wa(a,r)}_createImagePlaneFisheye(t,e){let i=this._createTexture(t.image),n=this._createPlaneMaterialParametersFisheye(e,i),r=new Ia(n),a=this._useMesh(e,t)?this._getImagePlaneGeoFisheye(e,t):this._getRegularFlatImagePlaneGeoFisheye(e);return new wa(a,r)}_createSphereMaterialParameters(t,e){return{depthWrite:!1,fragmentShader:Bm.spherical.fragment,side:2,transparent:!0,uniforms:{opacity:{value:1},projectorMat:{value:t.rt},projectorTex:{value:e}},vertexShader:Bm.spherical.vertex}}_createCurtainSphereMaterialParameters(t,e){return{depthWrite:!1,fragmentShader:Bm.sphericalCurtain.fragment,side:2,transparent:!0,uniforms:{curtain:{value:1},opacity:{value:1},projectorMat:{value:t.rt},projectorTex:{value:e}},vertexShader:Bm.sphericalCurtain.vertex}}_createPlaneMaterialParameters(t,e){return{depthWrite:!1,fragmentShader:Bm.perspective.fragment,side:2,transparent:!0,uniforms:{focal:{value:t.focal},k1:{value:t.ck1},k2:{value:t.ck2},opacity:{value:1},projectorMat:{value:t.basicRt},projectorTex:{value:e},radial_peak:{value:t.radialPeak?t.radialPeak:0},scale_x:{value:Math.max(t.basicHeight,t.basicWidth)/t.basicWidth},scale_y:{value:Math.max(t.basicWidth,t.basicHeight)/t.basicHeight}},vertexShader:Bm.perspective.vertex}}_createPlaneMaterialParametersFisheye(t,e){return{depthWrite:!1,fragmentShader:Bm.fisheye.fragment,side:2,transparent:!0,uniforms:{focal:{value:t.focal},k1:{value:t.ck1},k2:{value:t.ck2},opacity:{value:1},projectorMat:{value:t.basicRt},projectorTex:{value:e},radial_peak:{value:t.radialPeak?t.radialPeak:0},scale_x:{value:Math.max(t.basicHeight,t.basicWidth)/t.basicWidth},scale_y:{value:Math.max(t.basicWidth,t.basicHeight)/t.basicHeight}},vertexShader:Bm.fisheye.vertex}}_createCurtainPlaneMaterialParametersFisheye(t,e){return{depthWrite:!1,fragmentShader:Bm.fisheyeCurtain.fragment,side:2,transparent:!0,uniforms:{curtain:{value:1},focal:{value:t.focal},k1:{value:t.ck1},k2:{value:t.ck2},opacity:{value:1},projectorMat:{value:t.basicRt},projectorTex:{value:e},radial_peak:{value:t.radialPeak?t.radialPeak:0},scale_x:{value:Math.max(t.basicHeight,t.basicWidth)/t.basicWidth},scale_y:{value:Math.max(t.basicWidth,t.basicHeight)/t.basicHeight}},vertexShader:Bm.fisheyeCurtain.vertex}}_createCurtainPlaneMaterialParameters(t,e){return{depthWrite:!1,fragmentShader:Bm.perspectiveCurtain.fragment,side:2,transparent:!0,uniforms:{curtain:{value:1},focal:{value:t.focal},k1:{value:t.ck1},k2:{value:t.ck2},opacity:{value:1},projectorMat:{value:t.basicRt},projectorTex:{value:e},radial_peak:{value:t.radialPeak?t.radialPeak:0},scale_x:{value:Math.max(t.basicHeight,t.basicWidth)/t.basicWidth},scale_y:{value:Math.max(t.basicWidth,t.basicHeight)/t.basicHeight}},vertexShader:Bm.perspectiveCurtain.vertex}}_createDistortedCurtainPlaneMaterialParameters(t,e){return{depthWrite:!1,fragmentShader:Bm.perspectiveDistortedCurtain.fragment,side:2,transparent:!0,uniforms:{curtain:{value:1},opacity:{value:1},projectorMat:{value:t.projectorMatrix()},projectorTex:{value:e}},vertexShader:Bm.perspectiveDistortedCurtain.vertex}}_createDistortedPlaneMaterialParameters(t,e){return{depthWrite:!1,fragmentShader:Bm.perspectiveDistorted.fragment,side:2,transparent:!0,uniforms:{opacity:{value:1},projectorMat:{value:t.projectorMatrix()},projectorTex:{value:e}},vertexShader:Bm.perspectiveDistorted.vertex}}_createTexture(t){let e=new mn(t);return e.minFilter=xi,e.needsUpdate=!0,e}_useMesh(t,e){return e.mesh.vertices.length&&t.hasValidScale}_getImageSphereGeo(t,e){const i=t.srtInverse;let n=5*t.scale,r=this._imageSphereRadius*t.scale,a=e.mesh.vertices,o=a.length/3,s=new Float32Array(a.length);for(let h=0;h<o;++h){let t=3*h,e=a[t+0],o=a[t+1],l=a[t+2],c=Math.sqrt(e*e+o*o+l*l),u=Math.max(n,Math.min(c,r))/c,p=new bn(e*u,o*u,l*u);p.applyMatrix4(i),s[t+0]=p.x,s[t+1]=p.y,s[t+2]=p.z}let l=e.mesh.faces,c=new Uint16Array(l.length);for(let h=0;h<l.length;++h)c[h]=l[h];let u=new ra;return u.setAttribute("position",new Wr(s,3)),u.setIndex(new Wr(c,1)),u}_getImagePlaneGeo(t,e){const i=t.srtInverse;let n=5*t.scale,r=this._imagePlaneDepth*t.scale,a=e.mesh.vertices,o=a.length/3,s=new Float32Array(a.length);for(let h=0;h<o;++h){let t=3*h,e=a[t+0],o=a[t+1],l=a[t+2];h<4&&(e*=3,o*=3);let c=Math.max(n,Math.min(l,r)),u=c/l,p=new bn(e*u,o*u,c);p.applyMatrix4(i),s[t+0]=p.x,s[t+1]=p.y,s[t+2]=p.z}let l=e.mesh.faces,c=new Uint16Array(l.length);for(let h=0;h<l.length;++h)c[h]=l[h];let u=new ra;return u.setAttribute("position",new Wr(s,3)),u.setIndex(new Wr(c,1)),u}_getImagePlaneGeoFisheye(t,e){const i=t.srtInverse;let n=5*t.scale,r=this._imagePlaneDepth*t.scale,a=e.mesh.vertices,o=a.length/3,s=new Float32Array(a.length);for(let h=0;h<o;++h){let t=3*h,e=a[t+0],o=a[t+1],l=a[t+2],c=Math.sqrt(e*e+o*o+l*l),u=Math.max(n,Math.min(c,r))/c,p=new bn(e*u,o*u,l*u);p.applyMatrix4(i),s[t+0]=p.x,s[t+1]=p.y,s[t+2]=p.z}let l=e.mesh.faces,c=new Uint16Array(l.length);for(let h=0;h<l.length;++h)c[h]=l[h];let u=new ra;return u.setAttribute("position",new Wr(s,3)),u.setIndex(new Wr(c,1)),u}_getFlatImageSphereGeo(t){const e=new Eu(this._imageSphereRadius,20,40),i=t.rt.clone().invert();return e.applyMatrix4(i),e}_getRegularFlatImagePlaneGeo(t){let e=t.width,i=t.height,n=Math.max(e,i),r=e/2/n,a=i/2/n;return this._getFlatImagePlaneGeo(t,r,a)}_getFlatImagePlaneGeo(t,e,i){let n=[];return n.push(t.unprojectSfM([-e,-i],this._imagePlaneDepth)),n.push(t.unprojectSfM([e,-i],this._imagePlaneDepth)),n.push(t.unprojectSfM([e,i],this._imagePlaneDepth)),n.push(t.unprojectSfM([-e,i],this._imagePlaneDepth)),this._createFlatGeometry(n)}_getRegularFlatImagePlaneGeoFisheye(t){let e=t.width,i=t.height,n=Math.max(e,i),r=e/2/n,a=i/2/n;return this._getFlatImagePlaneGeoFisheye(t,r,a)}_getFlatImagePlaneGeoFisheye(t,e,i){let n=[];return n.push(t.unprojectSfM([-e,-i],this._imagePlaneDepth)),n.push(t.unprojectSfM([e,-i],this._imagePlaneDepth)),n.push(t.unprojectSfM([e,i],this._imagePlaneDepth)),n.push(t.unprojectSfM([-e,i],this._imagePlaneDepth)),this._createFlatGeometry(n)}_getFlatImagePlaneGeoFromBasic(t,e,i,n,r){let a=[];return a.push(t.unprojectBasic([e,n],this._imagePlaneDepth)),a.push(t.unprojectBasic([i,n],this._imagePlaneDepth)),a.push(t.unprojectBasic([i,r],this._imagePlaneDepth)),a.push(t.unprojectBasic([e,r],this._imagePlaneDepth)),this._createFlatGeometry(a)}_createFlatGeometry(t){let e=new Float32Array(12);for(let r=0;r<t.length;r++){let i=3*r;e[i+0]=t[r][0],e[i+1]=t[r][1],e[i+2]=t[r][2]}let i=new Uint16Array(6);i[0]=0,i[1]=1,i[2]=3,i[3]=1,i[4]=2,i[5]=3;let n=new ra;return n.setAttribute("position",new Wr(e,3)),n.setIndex(new Wr(i,1)),n}}class Fm{constructor(){this._planes={},this._planesOld={},this._planesPeriphery={},this._scene=new Rl,this._sceneOld=new Rl,this._scenePeriphery=new Rl}get planes(){return this._planes}get planesOld(){return this._planesOld}get planesPeriphery(){return this._planesPeriphery}get scene(){return this._scene}get sceneOld(){return this._sceneOld}get scenePeriphery(){return this._scenePeriphery}updateImagePlanes(t){this._dispose(this._planesOld,this.sceneOld);for(const e in this._planes){if(!this._planes.hasOwnProperty(e))continue;const t=this._planes[e];this._scene.remove(t),this._sceneOld.add(t)}for(const e in t)t.hasOwnProperty(e)&&this._scene.add(t[e]);this._planesOld=this._planes,this._planes=t}addImagePlanes(t){for(const e in t){if(!t.hasOwnProperty(e))continue;const i=t[e];this._scene.add(i),this._planes[e]=i}}addImagePlanesOld(t){for(const e in t){if(!t.hasOwnProperty(e))continue;const i=t[e];this._sceneOld.add(i),this._planesOld[e]=i}}setImagePlanes(t){this._clear(),this.addImagePlanes(t)}addPeripheryPlanes(t){for(const e in t){if(!t.hasOwnProperty(e))continue;const i=t[e];this._scenePeriphery.add(i),this._planesPeriphery[e]=i}}setPeripheryPlanes(t){this._clearPeriphery(),this.addPeripheryPlanes(t)}setImagePlanesOld(t){this._clearOld(),this.addImagePlanesOld(t)}clear(){this._clear(),this._clearOld()}_clear(){this._dispose(this._planes,this._scene),this._planes={}}_clearOld(){this._dispose(this._planesOld,this._sceneOld),this._planesOld={}}_clearPeriphery(){this._dispose(this._planesPeriphery,this._scenePeriphery),this._planesPeriphery={}}_dispose(t,e){for(const i in t){if(!t.hasOwnProperty(i))continue;const n=t[i];e.remove(n),n.geometry.dispose(),n.material.dispose();let r=n.material.uniforms.projectorTex.value;null!=r&&r.dispose()}}}class Nm{constructor(){this._factory=new Om,this._scene=new Fm,this._alpha=0,this._alphaOld=0,this._fadeOutSpeed=.05,this._currentKey=null,this._previousKey=null,this._providerDisposers={},this._frameId=0,this._needsRender=!1}get frameId(){return this._frameId}get needsRender(){return this._needsRender}indicateNeedsRender(){this._needsRender=!0}addPeripheryPlane(t,e){const i=this._factory.createMesh(t,e),n={};n[t.id]=i,this._scene.addPeripheryPlanes(n),this._needsRender=!0}clearPeripheryPlanes(){this._scene.setPeripheryPlanes({}),this._needsRender=!0}updateFrame(t){this._updateFrameId(t.id),this._needsRender=this._updateAlpha(t.state.alpha)||this._needsRender,this._needsRender=this._updateAlphaOld(t.state.alpha)||this._needsRender,this._needsRender=this._updateImagePlanes(t.state)||this._needsRender}setTextureProvider(t,e){if(t!==this._currentKey)return;let i=e.textureCreated$.subscribe((t=>{this._updateTexture(t)})),n=e.textureUpdated$.subscribe((t=>{this._needsRender=!0}));if(t in this._providerDisposers){(0,this._providerDisposers[t])(),delete this._providerDisposers[t]}this._providerDisposers[t]=()=>{i.unsubscribe(),n.unsubscribe(),e.dispose()}}updateTextureImage(t,e){this._needsRender=!0;const i=this._extend({},this._scene.planes,this._scene.planesOld,this._scene.planesPeriphery);for(const n in i){if(!i.hasOwnProperty(n))continue;if(n!==e.id)continue;let r=i[n].material.uniforms.projectorTex.value;r.image=t,r.needsUpdate=!0}}render(t,e){const i=this._scene.planes,n=this._scene.planesOld,r=this._scene.planesPeriphery,a=Object.keys(n).length?1:this._alpha,o=Object.keys(n).length?1:Math.floor(this._alpha);for(const s in i){if(!i.hasOwnProperty(s))continue;i[s].material.uniforms.opacity.value=a}for(const s in n){if(!n.hasOwnProperty(s))continue;n[s].material.uniforms.opacity.value=this._alphaOld}for(const s in r){if(!r.hasOwnProperty(s))continue;r[s].material.uniforms.opacity.value=o}e.render(this._scene.scenePeriphery,t),e.render(this._scene.scene,t),e.render(this._scene.sceneOld,t);for(const s in i){if(!i.hasOwnProperty(s))continue;i[s].material.uniforms.opacity.value=this._alpha}e.render(this._scene.scene,t)}clearNeedsRender(){this._needsRender=!1}dispose(){this._scene.clear()}_updateFrameId(t){this._frameId=t}_updateAlpha(t){return t!==this._alpha&&(this._alpha=t,!0)}_updateAlphaOld(t){return!(t<1||0===this._alphaOld)&&(this._alphaOld=Math.max(0,this._alphaOld-this._fadeOutSpeed),!0)}_updateImagePlanes(t){if(null==t.currentImage||t.currentImage.id===this._currentKey)return!1;let e=null!=t.previousImage?t.previousImage.id:null,i=t.currentImage.id;if(this._previousKey!==e&&this._previousKey!==i&&this._previousKey in this._providerDisposers){(0,this._providerDisposers[this._previousKey])(),delete this._providerDisposers[this._previousKey]}if(null!=e){if(e!==this._currentKey&&e!==this._previousKey){let i=this._factory.createMesh(t.previousImage,t.previousTransform);const n={};n[e]=i,this._scene.updateImagePlanes(n)}this._previousKey=e}this._currentKey=i;let n=this._factory.createMesh(t.currentImage,t.currentTransform);const r={};return r[i]=n,this._scene.updateImagePlanes(r),this._alphaOld=1,!0}_updateTexture(t){this._needsRender=!0;const e=this._scene.planes;for(const i in e){if(!e.hasOwnProperty(i))continue;let n=e[i].material,r=n.uniforms.projectorTex.value;n.uniforms.projectorTex.value=null,r.dispose(),n.uniforms.projectorTex.value=t}}_extend(t,...e){for(const i of e)for(const e in i)i.hasOwnProperty(e)&&(t[e]=i[e]);return t}}var Um;!function(t){t[t.Background=0]="Background",t[t.Opaque=1]="Opaque"}(Um||(Um={}));class $m{constructor(t){this._api=t,this._urls$=new Map}getImage$(t){let e;const i=new Promise(((t,i)=>{e=i}));return[nt.create((n=>{this._api.data.getImageBuffer(t,i).then((t=>{e=null;const i=new Image;i.crossOrigin="Anonymous",i.onload=()=>{window.URL.revokeObjectURL(i.src),n.next(i),n.complete()},i.onerror=()=>{e=null,window.URL.revokeObjectURL(i.src),n.error(new Error("Failed to load image tile"))};const r=new Blob([t]);i.src=window.URL.createObjectURL(r)}),(t=>{e=null,n.error(t)}))})),()=>{e&&e()}]}getURLs$(t,e){const i=this._inventId(t,e);if(this._urls$.has(i))return this._urls$.get(i);const n={imageId:t,z:e},r=this._api.getImageTiles$(n).pipe(ee((t=>t.node)),Ge((()=>{this._urls$.delete(i)})),Ke(),lt());return this._urls$.set(i,r),r}_inventId(t,e){return`${t}-${e}`}}class Vm{constructor(){this._tiles=new Map,this._urlLevels=new Set,this._urls=new Map}add(t,e){if(this._tiles.has(t))throw new Error(`Image tile already stored (${t})`);this._tiles.set(t,e)}addURLs(t,e){const i=this._urls;for(const n of e){const t=this.inventId(n);if(this._urls.has(t))throw new Error(`URL already stored (${t})`);i.set(t,n.url)}this._urlLevels.add(t)}dispose(){this._tiles.forEach((t=>window.URL.revokeObjectURL(t.src))),this._tiles.clear(),this._urls.clear(),this._urlLevels.clear()}get(t){return this._tiles.get(t)}getURL(t){return this._urls.get(t)}has(t){return this._tiles.has(t)}hasURL(t){return this._urls.has(t)}hasURLLevel(t){return this._urlLevels.has(t)}inventId(t){return`${t.z}-${t.x}-${t.y}`}}class jm{constructor(){this._viewportCoords=new Am}computeRegionOfInterest(t,e,i){const n=this._viewportBoundaryPoints(4),r=this._viewportPointsBoundingBox(n,t,i);this._clipBoundingBox(r);const a=2/e.width,o=2/e.height,s=[[-.5*a,.5*o],[.5*a,.5*o],[.5*a,-.5*o],[-.5*a,-.5*o]],l=this._viewportPointsBoundingBox(s,t,i),c=l.minX<l.maxX;return{bbox:r,pixelHeight:l.maxY-l.minY,pixelWidth:l.maxX-l.minX+(c?0:1)}}_viewportBoundaryPoints(t){const e=[],i=[[-1,1],[1,1],[1,-1],[-1,-1]],n=[[2,0],[0,-2],[-2,0],[0,2]];for(let r=0;r<4;++r){const a=i[r],o=n[r];for(let i=0;i<t;++i)e.push([a[0]+o[0]*i/t,a[1]+o[1]*i/t])}return e}_viewportPointsBoundingBox(t,e,i){const n=t.map((t=>this._viewportCoords.viewportToBasic(t[0],t[1],i,e.perspective)));return Qh(i.cameraType)?this._boundingBoxSpherical(n):this._boundingBox(n)}_boundingBox(t){const e={maxX:Number.NEGATIVE_INFINITY,maxY:Number.NEGATIVE_INFINITY,minX:Number.POSITIVE_INFINITY,minY:Number.POSITIVE_INFINITY};for(let i=0;i<t.length;++i)e.minX=Math.min(e.minX,t[i][0]),e.maxX=Math.max(e.maxX,t[i][0]),e.minY=Math.min(e.minY,t[i][1]),e.maxY=Math.max(e.maxY,t[i][1]);return e}_boundingBoxSpherical(t){const e=[],i=[];for(let r=0;r<t.length;++r)e.push(t[r][0]),i.push(t[r][1]);e.sort(((t,e)=>this._sign(t-e))),i.sort(((t,e)=>this._sign(t-e)));const n=this._intervalSpherical(e);return{maxX:n[1],maxY:i[i.length-1],minX:n[0],minY:i[0]}}_intervalSpherical(t){let e=0,i=-1;for(let n=0;n<t.length-1;++n){const r=t[n+1]-t[n];r>e&&(e=r,i=n)}return t[0]+1-t[t.length-1]>e?[t[0],t[t.length-1]]:[t[i+1],t[i]]}_clipBoundingBox(t){t.minX=Math.max(0,Math.min(1,t.minX)),t.maxX=Math.max(0,Math.min(1,t.maxX)),t.minY=Math.max(0,Math.min(1,t.minY)),t.maxY=Math.max(0,Math.min(1,t.maxY))}_sign(t){return t>0?1:t<0?-1:0}}function qm(t,e,i){return Math.max(e,Math.min(i,t))}function Gm(t){return 1024/Hm(t)}function Hm(t){return Math.pow(2,t.z-t.max)}function Wm(t){return Math.ceil(function(t){const e=Math.max(t.w,t.h);return Math.log(e)/Math.log(2)}(t))}function Zm(t,e,i){const n=Gm(i),r=e.w,a=e.h,o=Math.ceil(r/n)-1,s=Math.ceil(a/n)-1;return{x:qm(Math.floor(r*t[0]/n),0,o),y:qm(Math.floor(a*t[1]/n),0,s)}}function Ym(t,e,i){const n=1024*(1/Hm(i)),r=n*t.x,a=n*t.y,o=Math.min(n,e.w-r);return{h:Math.min(n,e.h-a),x:r,y:a,w:o}}function Xm(t,e,i){return i*t<=e&&e<i*(t+1)}function Km(t,e){if(t.z===e.z)return t.x===e.x&&t.y===e.y;const i=t.z<e.z?t:e,n=t.z<e.z?e:t,r=1/Hm({max:n.z,z:i.z}),a=Xm(i.x,n.x,r),o=Xm(i.y,n.y,r);return a&&o}function Jm(t){return t.w>0&&t.h>0}class Qm{constructor(t,e,i,n,r,a,o){const s={h:i,w:e};Jm(s)||console.warn(`Original image size (${e}, ${i}) is invalid (${t}). Tiles will not be loaded.`),this._imageId=t,this._size=s,this._level={max:Wm(this._size),z:-1},this._holder=new Tm,this._updated$=new ht,this._createdSubject$=new ht,this._created$=this._createdSubject$.pipe(Je(1),lt()),this._holder.push(this._created$.subscribe((()=>{}))),this._hasSubject$=new ht,this._has$=this._hasSubject$.pipe(ai(!1),Je(1),lt()),this._holder.push(this._has$.subscribe((()=>{}))),this._renderedLevel=new Set,this._rendered=new Map,this._subscriptions=new Map,this._urlSubscriptions=new Map,this._loader=r,this._store=a,this._background=n,this._renderer=o,this._aborts=[],this._render=null,this._disposed=!1}get disposed(){return this._disposed}get hasTexture$(){return this._has$}get id(){return this._imageId}get textureUpdated$(){return this._updated$}get textureCreated$(){return this._created$}abort(){this._subscriptions.forEach((t=>t.unsubscribe())),this._subscriptions.clear();for(const t of this._aborts)t();this._aborts=[]}dispose(){this._disposed?console.warn(`Texture already disposed (${this._imageId})`):(this._urlSubscriptions.forEach((t=>t.unsubscribe())),this._urlSubscriptions.clear(),this.abort(),null!=this._render&&(this._render.target.dispose(),this._render.target=null,this._render.camera=null,this._render=null),this._store.dispose(),this._holder.unsubscribe(),this._renderedLevel.clear(),this._background=null,this._renderer=null,this._disposed=!0)}setRegionOfInterest(t){if(!Jm(this._size))return;const e=1/t.pixelWidth,i=function(t,e,i){return Math.max(e,Math.min(i,Wm(t)))}({h:1/t.pixelHeight,w:e},11,this._level.max);i!==this._level.z&&(this.abort(),this._level.z=i,this._renderedLevel.clear(),this._rendered.forEach(((t,e)=>{t.z===i&&this._renderedLevel.add(e)}))),null==this._render&&this._initRender();const n=function(t,e,i,n){const r=[];if(t.x>e.x){const a=Gm(n),o=Math.ceil(i.w/a)-1;for(let e=t.x;e<=o;e++)r.push(e);for(let t=0;t<=e.x;t++)r.push(t)}else for(let o=t.x;o<=e.x;o++)r.push(o);const a=[];for(const o of r)for(let i=t.y;i<=e.y;i++)a.push({x:o,y:i});return a}(Zm([t.bbox.minX,t.bbox.minY],this._size,this._level),Zm([t.bbox.maxX,t.bbox.maxY],this._size,this._level),this._size,this._level);this._fetchTiles(i,n)}_fetchTile(t){const e=this._loader.getImage$(t.url),i=e[0],n=e[1];this._aborts.push(n);const r=this._store.inventId(t),a=i.subscribe((e=>{const i=Ym(t,this._size,this._level);this._renderToTarget(i,e),this._subscriptions.delete(r),this._removeFromArray(n,this._aborts),this._markRendered(t),this._store.add(r,e),this._updated$.next(!0)}),(t=>{this._subscriptions.delete(r),this._removeFromArray(n,this._aborts),console.error(t)}));a.closed||this._subscriptions.set(r,a)}_fetchTiles(t,e){const i=(this._store.hasURLLevel(t)?Zt(void 0):this._loader.getURLs$(this._imageId,t).pipe(ci((e=>{this._store.hasURLLevel(t)||this._store.addURLs(t,e)})))).subscribe((()=>{if(t===this._level.z){for(const i of e){const e={x:i.x,y:i.y,z:t,url:null},n=this._store.inventId(e);if(!this._renderedLevel.has(n)&&!this._subscriptions.has(n))if(this._store.has(n)){const t=Ym(i,this._size,this._level);this._renderToTarget(t,this._store.get(n)),this._markRendered(e),this._updated$.next(!0)}else e.url=this._store.getURL(n),this._fetchTile(e)}this._urlSubscriptions.delete(t)}}),(e=>{this._urlSubscriptions.delete(t),console.error(e)}));i.closed||this._urlSubscriptions.set(t,i)}_initRender(){const t=this._size.w/2,e=this._size.h/2,i=new to(-t,t,e,-e,-1,1);i.position.z=1;const n=this._renderer.getContext(),r=n.getParameter(n.MAX_TEXTURE_SIZE),a=Math.max(this._size.w,this._size.h),o=r>a?1:r/a,s=Math.floor(o*this._size.w),l=Math.floor(o*this._size.h),c=new yn(s,l,{depthBuffer:!1,format:Ii,magFilter:xi,minFilter:xi,stencilBuffer:!1});this._render={camera:i,target:c};const u=Ym({x:0,y:0},this._size,{max:this._level.max,z:0});this._renderToTarget(u,this._background),this._createdSubject$.next(c.texture),this._hasSubject$.next(!0)}_markRendered(t){const e=Array.from(this._rendered.entries()).filter((([e,i])=>i.z!==t.z));for(const[n,r]of e)Km(t,r)&&this._rendered.delete(n);const i=this._store.inventId(t);this._rendered.set(i,t),this._renderedLevel.add(i)}_removeFromArray(t,e){const i=e.indexOf(t);-1!==i&&e.splice(i,1)}_renderToTarget(t,e){const i=new mn(e);i.minFilter=xi,i.needsUpdate=!0;const n=new qa(t.w,t.h),r=new qr({map:i,side:0}),a=new wa(n,r);a.position.x=-this._size.w/2+t.x+t.w/2,a.position.y=this._size.h/2-t.y-t.h/2;const o=new Rl;o.add(a);const s=this._renderer.getRenderTarget();this._renderer.resetState(),this._renderer.setRenderTarget(this._render.target),this._renderer.render(o,this._render.camera),this._renderer.setRenderTarget(s),o.remove(a),n.dispose(),r.dispose(),i.dispose()}}var tg,eg,ig,ng;!function(t){t[t.Custom=0]="Custom",t[t.Earth=1]="Earth",t[t.Traversing=2]="Traversing",t[t.Waiting=3]="Waiting",t[t.WaitingInteractively=4]="WaitingInteractively"}(tg||(tg={}));class rg extends Mm{constructor(t,e,i){super(t,e,i),this._imageTileLoader=new $m(i.api),this._roiCalculator=new jm,this._rendererOperation$=new ht,this._rendererCreator$=new ht,this._rendererDisposer$=new ht,this._renderer$=this._rendererOperation$.pipe(ti(((t,e)=>e(t)),null),Ce((t=>null!=t)),Ue(void 0,(t=>t.frameId))),this._rendererCreator$.pipe(ee((()=>t=>{if(null!=t)throw new Error("Multiple image plane states can not be created at the same time");return new Nm}))).subscribe(this._rendererOperation$),this._rendererDisposer$.pipe(ee((()=>t=>(t.dispose(),null)))).subscribe(this._rendererOperation$)}_activate(){const t=this._subscriptions;t.push(this._renderer$.pipe(ee((t=>{const e={name:this._name,renderer:{frameId:t.frameId,needsRender:t.needsRender,render:t.render.bind(t),pass:Um.Background}};return t.clearNeedsRender(),e}))).subscribe(this._container.glRenderer.render$)),this._rendererCreator$.next(null),t.push(this._navigator.stateService.currentState$.pipe(ee((t=>e=>(e.updateFrame(t),e)))).subscribe(this._rendererOperation$));const e=this._container.configurationService.imageTiling$.pipe(oi((t=>t?this._navigator.stateService.currentState$:new ht)),Ue(void 0,(t=>t.state.currentImage.id)),ui(this._container.glRenderer.webGLRenderer$),ee((([t,e])=>{const i=t.state,n=i.currentImage,r=i.currentTransform;return new Qm(n.id,r.basicWidth,r.basicHeight,n.image,this._imageTileLoader,new Vm,e)})),Je(1),lt());t.push(e.subscribe((()=>{}))),t.push(e.pipe(ee((t=>e=>(e.setTextureProvider(t.id,t),e)))).subscribe(this._rendererOperation$)),t.push(e.pipe(Xe()).subscribe((t=>{t[0].abort()})));const i=this._container.configurationService.imageTiling$.pipe(oi((t=>t?ue(this._navigator.stateService.state$,this._navigator.stateService.inTranslation$):new ht)),oi((([t,e])=>(t===tg.Traversing||t===tg.Waiting||t===tg.WaitingInteractively)&&!e?this._container.renderService.renderCameraFrame$:Et())),ee((t=>({camera:t,height:t.size.height.valueOf(),lookat:t.camera.lookat.clone(),width:t.size.width.valueOf(),zoom:t.zoom.valueOf()}))),Xe(),ee((([t,e])=>{const i=t.width===e.width&&t.height===e.height&&t.zoom===e.zoom&&t.lookat.equals(e.lookat);return{camera:e.camera,stalled:i}})),Ue(((t,e)=>t.stalled===e.stalled)),Ce((t=>t.stalled)),ui(this._container.renderService.size$,this._navigator.stateService.currentTransform$));t.push(e.pipe(oi((t=>i.pipe(ee((([e,i,n])=>{const r=e.camera,a=(new Am).viewportToBasic(0,0,n,r.perspective);if(!(a[0]<0||a[1]<0||a[0]>1||a[1]>1))return[this._roiCalculator.computeRegionOfInterest(r,i,n),t]})),Ce((t=>!!t))))),Ce((t=>!t[1].disposed))).subscribe((([t,e])=>{e.setRegionOfInterest(t)})));const n=e.pipe(oi((t=>t.hasTexture$)),ai(!1),Je(1),lt());t.push(n.subscribe((()=>{}))),t.push(this._navigator.panService.panImages$.pipe(Ce((t=>0===t.length)),ee((()=>t=>(t.clearPeripheryPlanes(),t)))).subscribe(this._rendererOperation$));const r=this._navigator.panService.panImages$.pipe(oi((t=>Ft(t).pipe(fe((([t,e])=>ue(this._navigator.graphService.cacheImage$(t.id).pipe(Re((e=>(console.error(`Failed to cache periphery image (${t.id})`,e),Et())))),Zt(e))))))),ei());t.push(r.pipe(ee((([t,e])=>i=>(i.addPeripheryPlane(t,e),i)))).subscribe(this._rendererOperation$)),t.push(r.pipe(fe((([t])=>t.cacheImage$().pipe(Re((()=>Et()))))),ee((t=>e=>(e.updateTextureImage(t.image,t),e)))).subscribe(this._rendererOperation$));const a=this._navigator.stateService.currentState$.pipe(ee((t=>t.state.alpha<1)),Ue()),o=ue(this._container.mouseService.active$,this._container.touchService.active$,this._navigator.stateService.inMotion$,a).pipe(ee((([t,e,i,n])=>!(t||e||i||n))),Ce((t=>t)));t.push(this._navigator.stateService.state$.pipe(oi((t=>t===tg.Traversing?this._navigator.panService.panImages$:Et())),oi((t=>o.pipe(ui(this._container.renderService.renderCamera$,this._navigator.stateService.currentImage$,this._navigator.stateService.currentTransform$),fe((([,e,i,n])=>Zt([e,i,n,t])))))),oi((([t,e,i,n])=>{const r=t.camera.lookat.clone().sub(t.camera.position),a=[(new Kh).viewingDirection(e.rotation).angleTo(r),void 0],o=(new Am).viewportToBasic(0,0,i,t.perspective);o[0]>=0&&o[0]<=1&&o[1]>=0&&o[1]<=1&&(a[0]=Number.NEGATIVE_INFINITY);for(const[s]of n){const t=(new Kh).viewingDirection(s.rotation).angleTo(r);t<a[0]&&(a[0]=t,a[1]=s.id)}return a[1]?this._navigator.moveTo$(a[1]).pipe(Re((()=>Et()))):Et()}))).subscribe())}_deactivate(){this._rendererDisposer$.next(null),this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{}}}rg.componentName="image";class ag{constructor(t,e,i){this._component=t,this._container=e,this._navigator=i,this._enabled=!1}get isEnabled(){return this._enabled}enable(){!this._enabled&&this._component.activated&&(this._enable(),this._enabled=!0,this._component.configure(this._getConfiguration(!0)))}disable(){this._enabled&&(this._disable(),this._enabled=!1,this._component.activated&&this._component.configure(this._getConfiguration(!1)))}}class og extends ag{_enable(){const t=this._navigator.stateService.currentImage$.pipe(oi((t=>t.sequenceEdges$)));this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(ui(t)).subscribe((([t,e])=>{let i=null;switch(t.keyCode){case 38:i=Hh.Next;break;case 40:i=Hh.Prev;break;default:return}if(t.preventDefault(),t.altKey&&!t.shiftKey&&e.cached)for(const n of e.edges)if(n.data.direction===i)return void this._navigator.moveTo$(n.target).subscribe(void 0,(t=>{t instanceof zm||console.error(t)}))}))}_disable(){this._keyDownSubscription.unsubscribe()}_getConfiguration(t){return{keySequenceNavigation:t}}}class sg extends ag{constructor(t,e,i,n){super(t,e,i),this._spatial=n}_enable(){const t=this._navigator.stateService.currentImage$.pipe(oi((t=>t.spatialEdges$)));this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(ui(t,this._navigator.stateService.currentState$)).subscribe((([t,e,i])=>{let n=Qh(i.state.currentImage.cameraType),r=null;switch(t.keyCode){case 37:r=t.shiftKey&&!n?Hh.TurnLeft:Hh.StepLeft;break;case 38:r=t.shiftKey&&!n?Hh.Spherical:Hh.StepForward;break;case 39:r=t.shiftKey&&!n?Hh.TurnRight:Hh.StepRight;break;case 40:r=t.shiftKey&&!n?Hh.TurnU:Hh.StepBackward;break;default:return}if(t.preventDefault(),!(t.altKey||!e.cached||t.shiftKey&&n))if(n){const t={};t[Hh.StepBackward]=Math.PI,t[Hh.StepForward]=0,t[Hh.StepLeft]=Math.PI/2,t[Hh.StepRight]=-Math.PI/2;const n=this._rotationFromCamera(i.state.camera).phi,a=this._spatial.wrapAngle(n+t[r]),o=Math.PI/4,s=e.edges.filter((t=>t.data.direction===Hh.Spherical||t.data.direction===r));let l=Number.MAX_VALUE,c=null;for(const e of s){const t=Math.abs(this._spatial.wrapAngle(e.data.worldMotionAzimuth-a));t<Math.min(l,o)&&(l=t,c=e.target)}if(null==c)return;this._moveTo(c)}else this._moveDir(r,e)}))}_disable(){this._keyDownSubscription.unsubscribe()}_getConfiguration(t){return{keySpatialNavigation:t}}_moveDir(t,e){for(const i of e.edges)if(i.data.direction===t)return void this._moveTo(i.target)}_moveTo(t){this._navigator.moveTo$(t).subscribe(void 0,(t=>{t instanceof zm||console.error(t)}))}_rotationFromCamera(t){let e=t.lookat.clone().sub(t.position),i=e.clone().dot(t.up),n=e.clone().sub(t.up.clone().multiplyScalar(i));return{phi:Math.atan2(n.y,n.x),theta:Math.PI/2-this._spatial.angleToPlane(e.toArray(),[0,0,1])}}}class lg extends ag{constructor(t,e,i,n){super(t,e,i),this._viewportCoords=n}_enable(){this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(ui(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$)).subscribe((([t,e,i])=>{if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0;switch(t.key){case"+":n=1;break;case"-":n=-1;break;default:return}t.preventDefault();const r=this._viewportCoords.unprojectFromViewport(0,0,e.perspective),a=i.projectBasic(r.toArray());this._navigator.stateService.zoomIn(n,a)}))}_disable(){this._keyDownSubscription.unsubscribe()}_getConfiguration(t){return{keyZoom:t}}}class cg extends ag{_enable(){this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(ui(this._navigator.playService.playing$,this._navigator.playService.direction$,this._navigator.playService.speed$,this._navigator.stateService.currentImage$.pipe(oi((t=>t.sequenceEdges$))),this._navigator.stateService.state$.pipe(ee((t=>t===tg.Earth)),Ue()))).subscribe((([t,e,i,n,r,a])=>{if(!(t.altKey||t.ctrlKey||t.metaKey)){switch(t.key){case"D":if(!t.shiftKey)return;const o=e?null:i===Hh.Next?Hh.Prev:i===Hh.Prev?Hh.Next:null;null!=o&&this._navigator.playService.setDirection(o);break;case" ":if(t.shiftKey)return;if(!a)if(e)this._navigator.playService.stop();else for(let t of r.edges)t.data.direction===i&&this._navigator.playService.play();break;case"<":this._navigator.playService.setSpeed(n-.05);break;case">":this._navigator.playService.setSpeed(n+.05);break;default:return}t.preventDefault()}}))}_disable(){this._keyDownSubscription.unsubscribe()}_getConfiguration(t){return{keyPlay:t}}}class ug extends Mm{constructor(t,e,i){super(t,e,i),this._keyPlayHandler=new cg(this,e,i),this._keySequenceNavigationHandler=new og(this,e,i),this._keySpatialNavigationHandler=new sg(this,e,i,new Kh),this._keyZoomHandler=new lg(this,e,i,new Am)}get keyPlay(){return this._keyPlayHandler}get keySequenceNavigation(){return this._keySequenceNavigationHandler}get keySpatialNavigation(){return this._keySpatialNavigationHandler}get keyZoom(){return this._keyZoomHandler}_activate(){this._subscriptions.push(this._configuration$.subscribe((t=>{t.keyPlay?this._keyPlayHandler.enable():this._keyPlayHandler.disable(),t.keySequenceNavigation?this._keySequenceNavigationHandler.enable():this._keySequenceNavigationHandler.disable(),t.keySpatialNavigation?this._keySpatialNavigationHandler.enable():this._keySpatialNavigationHandler.disable(),t.keyZoom?this._keyZoomHandler.enable():this._keyZoomHandler.disable()})))}_deactivate(){this._subscriptions.unsubscribe(),this._keyPlayHandler.disable(),this._keySequenceNavigationHandler.disable(),this._keySpatialNavigationHandler.disable(),this._keyZoomHandler.disable()}_getDefaultConfiguration(){return{keyPlay:!0,keySequenceNavigation:!0,keySpatialNavigation:!0,keyZoom:!0}}}ug.componentName="keyboard";class hg{constructor(t,e){this._needsRender=!1,this._interactiveObjects=[],this._markers={},this._objectMarkers={},this._raycaster=e||new Mh,this._scene=t||new Rl}get markers(){return this._markers}get needsRender(){return this._needsRender}add(t,e){t.id in this._markers&&this._dispose(t.id),t.createGeometry(e),this._scene.add(t.geometry),this._markers[t.id]=t;for(let i of t.getInteractiveObjects())this._interactiveObjects.push(i),this._objectMarkers[i.uuid]=t.id;this._needsRender=!0}clear(){for(const t in this._markers)this._markers.hasOwnProperty&&this._dispose(t);this._needsRender=!0}get(t){return this._markers[t]}getAll(){return Object.keys(this._markers).map((t=>this._markers[t]))}has(t){return t in this._markers}intersectObjects([t,e],i){this._raycaster.setFromCamera(new sn(t,e),i);const n=this._raycaster.intersectObjects(this._interactiveObjects);for(const r of n)if(r.object.uuid in this._objectMarkers)return this._objectMarkers[r.object.uuid];return null}lerpAltitude(t,e,i){t in this._markers&&(this._markers[t].lerpAltitude(e,i),this._needsRender=!0)}remove(t){t in this._markers&&(this._dispose(t),this._needsRender=!0)}render(t,e){e.render(this._scene,t),this._needsRender=!1}update(t,e,i){if(!(t in this._markers))return;this._markers[t].updatePosition(e,i),this._needsRender=!0}_dispose(t){const e=this._markers[t];this._scene.remove(e.geometry);for(let i of e.getInteractiveObjects()){const e=this._interactiveObjects.indexOf(i);-1!==e?this._interactiveObjects.splice(e,1):console.warn(`Object does not exist (${i.id}) for ${t}`),delete this._objectMarkers[i.uuid]}e.disposeGeometry(),delete this._markers[t]}}class pg extends Mm{constructor(t,e,i){super(t,e,i),this._graphCalculator=new $h,this._markerScene=new hg,this._markerSet=new op,this._viewportCoords=new Am,this._relativeGroundAltitude=-2}add(t){this._markerSet.add(t)}fire(t,e){super.fire(t,e)}get(t){return this._markerSet.get(t)}getAll(){return this._markerSet.getAll()}getMarkerIdAt(t){return new Promise(((e,i)=>{this._container.renderService.renderCamera$.pipe(He(),ee((e=>{const i=this._viewportCoords.canvasToViewport(t[0],t[1],this._container.container);return this._markerScene.intersectObjects(i,e.perspective)}))).subscribe((t=>{e(t)}),(t=>{i(t)}))}))}has(t){return this._markerSet.has(t)}off(t,e){super.off(t,e)}on(t,e){super.on(t,e)}remove(t){this._markerSet.remove(t)}removeAll(){this._markerSet.removeAll()}_activate(){const t=this._navigator.stateService.currentState$.pipe(ee((t=>t.state.camera.position.z+this._relativeGroundAltitude)),Ue(((t,e)=>Math.abs(t-e)<.01)),Je(1),lt()),e=ue(t,this._navigator.stateService.reference$).pipe(He(),ee((()=>{})),Je(1),lt()),i=this._configuration$.pipe(ee((t=>({visibleBBoxSize:Math.max(1,Math.min(200,t.visibleBBoxSize))})))),n=this._navigator.stateService.currentImage$.pipe(ee((t=>t.lngLat)),Je(1),lt()),r=ue(i,n).pipe(ee((([t,e])=>this._graphCalculator.boundingBoxCorners(e,t.visibleBBoxSize/2))),Je(1),lt()),a=ue(_e(Zt(this._markerSet),this._markerSet.changed$),r).pipe(ee((([t,e])=>t.search(e)))),o=this._subscriptions;o.push(e.pipe(oi((()=>a.pipe(ui(this._navigator.stateService.reference$,t))))).subscribe((([t,e,i])=>{const n=this._markerScene,r=n.markers,a=Object.assign({},r);for(const o of t)if(o.id in r)delete a[o.id];else{const t=Fh(o.lngLat.lng,o.lngLat.lat,e.alt+i,e.lng,e.lat,e.alt);n.add(o,t)}for(const o in a)a.hasOwnProperty(o)&&n.remove(o)}))),o.push(e.pipe(oi((()=>this._markerSet.updated$.pipe(ui(r,this._navigator.stateService.reference$,t))))).subscribe((([t,[e,i],n,r])=>{const a=this._markerScene;for(const o of t){const t=a.has(o.id),s=o.lngLat.lat>e.lat&&o.lngLat.lat<i.lat&&o.lngLat.lng>e.lng&&o.lngLat.lng<i.lng;if(s){const t=Fh(o.lngLat.lng,o.lngLat.lat,n.alt+r,n.lng,n.lat,n.alt);a.add(o,t)}else!s&&t&&a.remove(o.id)}}))),o.push(this._navigator.stateService.reference$.pipe(ni(1),ui(t)).subscribe((([t,e])=>{const i=this._markerScene;for(const n of i.getAll()){const r=Fh(n.lngLat.lng,n.lngLat.lat,t.alt+e,t.lng,t.lat,t.alt);i.update(n.id,r)}}))),o.push(t.pipe(ni(1),ui(this._navigator.stateService.reference$,n)).subscribe((([t,e,i])=>{const n=this._markerScene,r=Fh(i.lng,i.lat,e.alt+t,e.lng,e.lat,e.alt);for(const a of n.getAll()){const i=Fh(a.lngLat.lng,a.lngLat.lat,e.alt+t,e.lng,e.lat,e.alt),o=i[0]-r[0],s=i[1]-r[1],l=Math.sqrt(o*o+s*s);l>50||n.lerpAltitude(a.id,t,Math.min(1,Math.max(0,1.2-1.2*l/50)))}}))),o.push(this._navigator.stateService.currentState$.pipe(ee((t=>{const e=this._markerScene;return{name:this._name,renderer:{frameId:t.id,needsRender:e.needsRender,render:e.render.bind(e),pass:Um.Opaque}}}))).subscribe(this._container.glRenderer.render$));const s=ue(this._container.renderService.renderCamera$,this._container.mouseService.mouseMove$).pipe(ee((([t,e])=>{const i=this._container.container,[n,r]=this._viewportCoords.canvasPosition(e,i),a=this._viewportCoords.canvasToViewport(n,r,i);return this._markerScene.intersectObjects(a,t.perspective)})),Je(1),lt()),l=this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragStart$).pipe(ee((()=>!0))),c=this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragEnd$).pipe(ee((()=>!1))),u=Ee(l,c).pipe(ai(!1));o.push(Ee(l.pipe(ui(s)),ue(c,Zt(null))).pipe(ai([!1,null]),Xe()).subscribe((([t,e])=>{const i=e[0],n=i?"markerdragstart":"markerdragend",r=i?e[1]:t[1],a={marker:this._markerScene.get(r),target:this,type:n};this.fire(n,a)})));const h=Ee(this._container.mouseService.mouseDown$.pipe(ee((()=>!0))),this._container.mouseService.documentMouseUp$.pipe(ee((()=>!1)))).pipe(ai(!1));o.push(ue(this._container.mouseService.active$,s.pipe(Ue()),h,u).pipe(ee((([t,e,i,n])=>!t&&null!=e&&i||n)),Ue()).subscribe((t=>{t?(this._container.mouseService.claimMouse(this._name,1),this._container.mouseService.claimWheel(this._name,1)):(this._container.mouseService.unclaimMouse(this._name),this._container.mouseService.unclaimWheel(this._name))})));const p=this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragStart$).pipe(ui(s,this._container.renderService.renderCamera$),ee((([t,e,i])=>{const n=this._markerScene.get(e),r=this._container.container,[a,o]=this._viewportCoords.projectToCanvas(n.geometry.position.toArray(),r,i.perspective),[s,l]=this._viewportCoords.canvasPosition(t,r);return[n,[s-a,l-o],i]})),Je(1),lt());o.push(this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDrag$).pipe(ui(p,this._navigator.stateService.reference$,i)).subscribe((([t,[e,i,n],r,a])=>{if(!this._markerScene.has(e.id))return;const o=this._container.container,[s,l]=this._viewportCoords.canvasPosition(t,o),c=s-i[0],u=l-i[1],[h,p]=this._viewportCoords.canvasToViewport(c,u,o),d=new bn(h,p,1).unproject(n.perspective).sub(n.perspective.position).normalize(),f=Math.min(this._relativeGroundAltitude/d.z,a.visibleBBoxSize/2-.1);if(f<0)return;const m=d.clone().multiplyScalar(f).add(n.perspective.position);m.z=n.perspective.position.z+this._relativeGroundAltitude;const[g,_]=Nh(m.x,m.y,m.z,r.lng,r.lat,r.alt);this._markerScene.update(e.id,m.toArray(),{lat:_,lng:g}),this._markerSet.update(e);const y="markerposition",v={marker:e,target:this,type:y};this.fire(y,v)})))}_deactivate(){this._subscriptions.unsubscribe(),this._markerScene.clear()}_getDefaultConfiguration(){return{visibleBBoxSize:100}}}function dg(t,e){return t.x<=Math.max(e.p1.x,e.p2.x)&&t.x>=Math.min(e.p1.x,e.p2.x)&&t.y>=Math.max(e.p1.y,e.p2.y)&&t.y>=Math.min(e.p1.y,e.p2.y)}function fg(t,e){const i=t.p2.x-t.p1.x,n=t.p2.y-t.p1.y,r=e.p2.x-e.p1.x,a=e.p2.y-e.p1.y,o=i*a-n*r;return o*o<1e-10*(i*i+n*n)*(r*r+a*a)}function mg(t,e,i){const n=(e.y-t.y)*(i.x-e.x)-(i.y-e.y)*(e.x-t.x);return(r=n)>0?1:r<0?-1:0;var r}function gg(t,e){if(fg(t,e))return!1;const i=mg(t.p1,t.p2,e.p1),n=mg(t.p1,t.p2,e.p2),r=mg(e.p1,e.p2,t.p1),a=mg(e.p1,e.p2,t.p2);return i!==n&&r!==a||(!(0!==i||!dg(e.p1,t))||(!(0!==n||!dg(e.p2,t))||(!(0!==r||!dg(t.p1,e))||!(0!==a||!dg(t.p2,e)))))}function _g(t,e){if(fg(t,e))return;const i=t.p1.x,n=t.p2.x,r=t.p1.y,a=t.p2.y,o=e.p1.x,s=e.p2.x,l=e.p1.y,c=e.p2.y,u=(i-n)*(l-c)-(r-a)*(o-s);return{x:((i*a-r*n)*(o-s)-(i-n)*(o*c-l*s))/u,y:((i*a-r*n)*(l-c)-(r-a)*(o*c-l*s))/u}}function yg(t,e){return t>=-1&&t<=1&&e>=-1&&e<=1}function vg(t,e){return t>=0&&t<=1&&e>=0&&e<=1}function xg(t,e,i){const n=function(t){let e=[],i=[[0,0],[1,0],[1,1],[0,1]],n=[[1,0],[0,1],[-1,0],[0,-1]];for(let r=0;r<4;++r){let a=i[r],o=n[r];for(let i=0;i<t;++i)e.push([a[0]+o[0]*i/t,a[1]+o[1]*i/t])}return e}(100),r=n.map((n=>i.basicToViewportSafe(n[0],n[1],t,e))),a=[],o=[{x:-1,y:1},{x:1,y:1},{x:1,y:-1},{x:-1,y:-1}],s=[!1,!1,!1,!1];for(let v=0;v<r.length;v++){const t=r[v],e=r[(v+1)%r.length];if(null===t)continue;if(null===e){yg(t[0],t[1])&&a.push(t);continue}const[i,n]=t,[l,c]=e;if(yg(i,n))if(yg(l,c))a.push(t);else for(let r=0;r<4;r++){const e={p1:{x:i,y:n},p2:{x:l,y:c}},u={p1:o[r],p2:o[(r+1)%4]};if(gg(e,u)){const i=_g(e,u);a.push(t,[i.x,i.y]),s[r]=!0}}}const[l,c]=i.viewportToBasic(-1,1,t,e),[u,h]=i.viewportToBasic(1,1,t,e),[p,d]=i.viewportToBasic(1,-1,t,e),[f,m]=i.viewportToBasic(-1,-1,t,e);vg(l,c)&&(s[3]=s[0]=!0),vg(u,h)&&(s[0]=s[1]=!0),vg(p,d)&&(s[1]=s[2]=!0),vg(f,m)&&(s[2]=s[3]=!0);const g=[-1,-1,1,1];for(let v of a){const t=v[0],e=v[1];t>g[1]&&(g[1]=t),t<g[3]&&(g[3]=t),e>g[0]&&(g[0]=e),e<g[2]&&(g[2]=e)}const _=[1,1,-1,-1],y=[];for(let v=0;v<4;v++)s[v]?y.push(0):y.push(Math.abs(_[v]-g[v]));return y}pg.componentName="marker";class bg extends ag{constructor(t,e,i,n,r){super(t,e,i),this._spatial=r,this._viewportCoords=n}_enable(){const t=this._navigator.stateService.currentState$.pipe(ee((t=>t.state.alpha<1)),Ue());this._bounceSubscription=ue(t,this._navigator.stateService.inTranslation$,this._container.mouseService.active$,this._container.touchService.active$).pipe(ee((t=>t[0]||t[1]||t[2]||t[3])),Ue(),oi((t=>t?Et():ue(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$.pipe(He())))),ui(this._navigator.panService.panImages$)).subscribe((([[t,e],i])=>{if(!e.hasValidScale&&t.camera.focal<.1)return;if(0===t.perspective.aspect||t.perspective.aspect===Number.POSITIVE_INFINITY)return;const n=xg(e,t.perspective,this._viewportCoords),r=this._viewportCoords.viewportToBasic(0,0,e,t.perspective);(r[0]<0||r[0]>1)&&i.length>0&&(n[0]=n[2]=0);for(const[,d]of i){const e=xg(d,t.perspective,this._viewportCoords);for(let t=1;t<n.length;t+=2)e[t]<n[t]&&(n[t]=e[t])}if(Math.max(...n)<.01)return;const a=n[1]-n[3],o=n[0]-n[2],s=this._viewportCoords.unprojectFromViewport(0,0,t.perspective).sub(t.perspective.position),l=this._viewportCoords.unprojectFromViewport(a,0,t.perspective).sub(t.perspective.position),c=this._viewportCoords.unprojectFromViewport(0,o,t.perspective).sub(t.perspective.position);let u=(a>0?1:-1)*l.angleTo(s),h=(o>0?1:-1)*c.angleTo(s);const p=Math.PI/60;u=this._spatial.clamp(.1*u,-p,p),h=this._spatial.clamp(.1*h,-p,p),this._navigator.stateService.rotateUnbounded({phi:u,theta:h})}))}_disable(){this._bounceSubscription.unsubscribe()}_getConfiguration(){return{}}}class wg{static filteredPairwiseMouseDrag$(t,e){return this._filteredPairwiseMouseDrag$(t,e,e.mouseDragStart$,e.mouseDrag$,e.mouseDragEnd$)}static filteredPairwiseMouseRightDrag$(t,e){return this._filteredPairwiseMouseDrag$(t,e,e.mouseRightDragStart$,e.mouseRightDrag$,e.mouseRightDragEnd$)}static _filteredPairwiseMouseDrag$(t,e,i,n,r){return e.filtered$(t,i).pipe(oi((i=>Ee(_e(Zt(i),e.filtered$(t,n)),e.filtered$(t,r).pipe(ee((()=>null)))).pipe(li((t=>!!t)),ai(null)))),Xe(),Ce((t=>null!=t[0]&&null!=t[1])))}}class Sg extends ag{constructor(t,e,i,n,r){super(t,e,i),this._spatial=r,this._viewportCoords=n}_enable(){let t=this._container.mouseService.filtered$(this._component.name,this._container.mouseService.mouseDragStart$).pipe(ee((()=>!0)),ei()),e=this._container.mouseService.filtered$(this._component.name,this._container.mouseService.mouseDragEnd$).pipe(ee((()=>!1)),ei());this._activeMouseSubscription=Ee(t,e).subscribe(this._container.mouseService.activate$);const i=Ee(t,e).pipe(oi((t=>t?this._container.mouseService.documentMouseMove$:Et())));this._preventDefaultSubscription=Ee(i,this._container.touchService.touchMove$).subscribe((t=>{t.preventDefault()}));let n=this._container.touchService.singleTouchDragStart$.pipe(ee((()=>!0))),r=this._container.touchService.singleTouchDragEnd$.pipe(ee((()=>!1)));this._activeTouchSubscription=Ee(n,r).subscribe(this._container.touchService.activate$);const a=this._navigator.stateService.currentState$.pipe(ee((t=>Qh(t.state.currentImage.cameraType)||t.state.imagesAhead<1)),Ue(),oi((t=>{if(!t)return Et();const e=wg.filteredPairwiseMouseDrag$(this._component.name,this._container.mouseService),i=Ee(this._container.touchService.singleTouchDragStart$,this._container.touchService.singleTouchDrag$,this._container.touchService.singleTouchDragEnd$.pipe(ee((()=>null)))).pipe(ee((t=>null!=t&&t.touches.length>0?t.touches[0]:null)),Xe(),Ce((t=>null!=t[0]&&null!=t[1])));return Ee(e,i)})),ui(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$,this._navigator.panService.panImages$),ee((([t,e,i,n])=>{let r=t[0],a=t[1],o=a.clientX-r.clientX,s=a.clientY-r.clientY,l=this._container.container,[c,u]=this._viewportCoords.canvasPosition(a,l),h=this._viewportCoords.unprojectFromCanvas(c,u,l,e.perspective).sub(e.perspective.position),p=this._viewportCoords.unprojectFromCanvas(c-o,u,l,e.perspective).sub(e.perspective.position),d=this._viewportCoords.unprojectFromCanvas(c,u-s,l,e.perspective).sub(e.perspective.position),f=(o>0?1:-1)*p.angleTo(h),m=(s>0?-1:1)*d.angleTo(h);const g=xg(i,e.perspective,this._viewportCoords);for(const[,_]of n){const t=xg(_,e.perspective,this._viewportCoords);for(let e=0;e<g.length;e++)t[e]<g[e]&&(g[e]=t[e])}return g[0]>0&&m<0&&(m/=Math.max(1,200*g[0])),g[2]>0&&m>0&&(m/=Math.max(1,200*g[2])),g[1]>0&&f<0&&(f/=Math.max(1,200*g[1])),g[3]>0&&f>0&&(f/=Math.max(1,200*g[3])),{phi:f,theta:m}})),ei());var o;this._rotateWithoutInertiaSubscription=a.subscribe((t=>{this._navigator.stateService.rotateWithoutInertia(t)})),this._rotateSubscription=a.pipe(ti(((t,e)=>(this._drainBuffer(t),t.push([Date.now(),e]),t)),[]),(o=Ee(this._container.mouseService.filtered$(this._component.name,this._container.mouseService.mouseDragEnd$),this._container.touchService.singleTouchDragEnd$),ot((function(t,e){var i=!1,n=null;t.subscribe(new st(e,(function(t){i=!0,n=t}))),o.subscribe(new st(e,(function(){if(i){i=!1;var t=n;n=null,e.next(t)}}),j))}))),ee((t=>{const e=this._drainBuffer(t.slice()),i={phi:0,theta:0};for(const a of e)i.phi+=a[1].phi,i.theta+=a[1].theta;const n=e.length;n>0&&(i.phi/=n,i.theta/=n);const r=Math.PI/18;return i.phi=this._spatial.clamp(i.phi,-r,r),i.theta=this._spatial.clamp(i.theta,-r,r),i}))).subscribe((t=>{this._navigator.stateService.rotate(t)}))}_disable(){this._activeMouseSubscription.unsubscribe(),this._activeTouchSubscription.unsubscribe(),this._preventDefaultSubscription.unsubscribe(),this._rotateSubscription.unsubscribe(),this._rotateWithoutInertiaSubscription.unsubscribe(),this._activeMouseSubscription=null,this._activeTouchSubscription=null,this._preventDefaultSubscription=null,this._rotateSubscription=null}_getConfiguration(t){return{dragPan:t}}_drainBuffer(t){const e=Date.now();for(;t.length>0&&e-t[0][0]>50;)t.shift();return t}}class Eg extends ag{constructor(t,e,i,n,r){super(t,e,i),this._spatial=r,this._viewportCoords=n,this._subscriptions=new Tm}_enable(){const t=this._navigator.stateService.state$.pipe(ee((t=>t===tg.Earth)),Je(1),lt()),e=this._subscriptions;e.push(t.pipe(oi((t=>t?this._container.mouseService.mouseWheel$:Et()))).subscribe((t=>{t.preventDefault()}))),e.push(t.pipe(oi((t=>t?wg.filteredPairwiseMouseDrag$(this._component.name,this._container.mouseService).pipe(Ce((([t,e])=>!(t.ctrlKey&&e.ctrlKey)))):Et())),ui(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$),ee((([[t,e],i,n])=>{const r=[0,0,1],a=[0,0,-2],o=this._planeIntersection(e,r,a,i.perspective,this._container.container),s=this._planeIntersection(t,r,a,i.perspective,this._container.container);if(!o||!s)return null;return(new bn).subVectors(o,s).multiplyScalar(-1).toArray()})),Ce((t=>!!t))).subscribe((t=>{this._navigator.stateService.truck(t)}))),e.push(t.pipe(oi((t=>t?wg.filteredPairwiseMouseDrag$(this._component.name,this._container.mouseService).pipe(Ce((([t,e])=>t.ctrlKey&&e.ctrlKey))):Et())),ee((([t,e])=>this._mousePairToRotation(t,e)))).subscribe((t=>{this._navigator.stateService.orbit(t)}))),e.push(t.pipe(oi((t=>t?wg.filteredPairwiseMouseRightDrag$(this._component.name,this._container.mouseService).pipe(Ce((([t,e])=>!t.ctrlKey&&!e.ctrlKey))):Et())),ee((([t,e])=>this._mousePairToRotation(t,e)))).subscribe((t=>{this._navigator.stateService.orbit(t)}))),e.push(t.pipe(oi((t=>t?this._container.mouseService.filteredWheel$(this._component.name,this._container.mouseService.mouseWheel$):Et())),ee((t=>{let e=t.deltaY;1===t.deltaMode?e*=40:2===t.deltaMode&&(e*=800);return-e/this._viewportCoords.containerToCanvas(this._container.container)[1]}))).subscribe((t=>{this._navigator.stateService.dolly(t)})))}_disable(){this._subscriptions.unsubscribe()}_getConfiguration(){return{}}_eventToViewport(t,e){const i=this._viewportCoords.canvasPosition(t,e);return this._viewportCoords.canvasToViewport(i[0],i[1],e)}_mousePairToRotation(t,e){const[i,n]=this._eventToViewport(e,this._container.container),[r,a]=this._eventToViewport(t,this._container.container);return{phi:(r-i)*Math.PI,theta:(n-a)*Math.PI/2}}_planeIntersection(t,e,i,n,r){const[a,o]=this._viewportCoords.canvasPosition(t,r),s=this._viewportCoords.unprojectFromCanvas(a,o,r,n).sub(n.position).normalize();if(Math.abs(this._spatial.angleToPlane(s.toArray(),e))<Math.PI/90)return null;const l=n.position.clone(),c=(new bn).fromArray(e),u=(new bn).fromArray(i),h=(new bn).subVectors(u,l).dot(c)/s.clone().dot(c),p=(new bn).addVectors(l,s.multiplyScalar(h));return this._viewportCoords.worldToCamera(p.toArray(),n)[2]>0?null:p}}class Tg extends ag{constructor(t,e,i,n){super(t,e,i),this._viewportCoords=n}_enable(){this._container.mouseService.claimWheel(this._component.name,0),this._preventDefaultSubscription=this._container.mouseService.mouseWheel$.subscribe((t=>{t.preventDefault()})),this._zoomSubscription=this._container.mouseService.filteredWheel$(this._component.name,this._container.mouseService.mouseWheel$).pipe(ui(this._navigator.stateService.currentState$,((t,e)=>[t,e])),Ce((t=>{let e=t[1].state;return Qh(e.currentImage.cameraType)||e.imagesAhead<1})),ee((t=>t[0])),ui(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$,((t,e,i)=>[t,e,i]))).subscribe((t=>{let e=t[0],i=t[1],n=t[2],r=this._container.container,[a,o]=this._viewportCoords.canvasPosition(e,r),s=this._viewportCoords.unprojectFromCanvas(a,o,r,i.perspective),l=n.projectBasic(s.toArray()),c=e.deltaY;1===e.deltaMode?c*=40:2===e.deltaMode&&(c*=800);let u=-3*c/this._viewportCoords.containerToCanvas(r)[1];this._navigator.stateService.zoomIn(u,l)}))}_disable(){this._container.mouseService.unclaimWheel(this._component.name),this._preventDefaultSubscription.unsubscribe(),this._zoomSubscription.unsubscribe(),this._preventDefaultSubscription=null,this._zoomSubscription=null}_getConfiguration(t){return{scrollZoom:t}}}class Mg extends ag{constructor(t,e,i,n){super(t,e,i),this._viewportCoords=n}_enable(){this._preventDefaultSubscription=this._container.touchService.pinch$.subscribe((t=>{t.originalEvent.preventDefault()}));let t=this._container.touchService.pinchStart$.pipe(ee((t=>!0))),e=this._container.touchService.pinchEnd$.pipe(ee((t=>!1)));this._activeSubscription=Ee(t,e).subscribe(this._container.touchService.activate$),this._zoomSubscription=this._container.touchService.pinch$.pipe(ui(this._navigator.stateService.currentState$),Ce((t=>{let e=t[1].state;return Qh(e.currentImage.cameraType)||e.imagesAhead<1})),ee((t=>t[0])),ui(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$)).subscribe((([t,e,i])=>{let n=this._container.container,[r,a]=this._viewportCoords.canvasPosition(t,n),o=this._viewportCoords.unprojectFromCanvas(r,a,n,e.perspective),s=i.projectBasic(o.toArray());const[l,c]=this._viewportCoords.containerToCanvas(n);let u=3*t.distanceChange/Math.min(l,c);this._navigator.stateService.zoomIn(u,s)}))}_disable(){this._activeSubscription.unsubscribe(),this._preventDefaultSubscription.unsubscribe(),this._zoomSubscription.unsubscribe(),this._preventDefaultSubscription=null,this._zoomSubscription=null}_getConfiguration(t){return{touchZoom:t}}}class Cg extends Mm{constructor(t,e,i){super(t,e,i);const n=new Kh,r=new Am;this._bounceHandler=new bg(this,e,i,r,n),this._dragPanHandler=new Sg(this,e,i,r,n),this._earthControlHandler=new Eg(this,e,i,r,n),this._scrollZoomHandler=new Tg(this,e,i,r),this._touchZoomHandler=new Mg(this,e,i,r)}get dragPan(){return this._dragPanHandler}get earthControl(){return this._earthControlHandler}get scrollZoom(){return this._scrollZoomHandler}get touchZoom(){return this._touchZoomHandler}_activate(){this._bounceHandler.enable(),this._subscriptions.push(this._configuration$.subscribe((t=>{t.dragPan?this._dragPanHandler.enable():this._dragPanHandler.disable(),t.earthControl?this._earthControlHandler.enable():this._earthControlHandler.disable(),t.scrollZoom?this._scrollZoomHandler.enable():this._scrollZoomHandler.disable(),t.touchZoom?this._touchZoomHandler.enable():this._touchZoomHandler.disable()}))),this._container.mouseService.claimMouse(this._name,0)}_deactivate(){this._container.mouseService.unclaimMouse(this._name),this._subscriptions.unsubscribe(),this._bounceHandler.disable(),this._dragPanHandler.disable(),this._earthControlHandler.disable(),this._scrollZoomHandler.disable(),this._touchZoomHandler.disable()}_getDefaultConfiguration(){return{dragPan:!0,earthControl:!0,scrollZoom:!0,touchZoom:!0}}}Cg.componentName="pointer";class Ig{constructor(t){this._document=t||document}get document(){return this._document}createElement(t,e,i){const n=this._document.createElement(t);return e&&(n.className=e),i&&i.appendChild(n),n}}class Ag extends Mm{constructor(t,e,i,n){super(t,e,i),this._dom=n||new Ig,this._popups=[],this._added$=new ht,this._popups$=new ht}add(t){for(const e of t)-1===this._popups.indexOf(e)&&(this._popups.push(e),this._activated&&e.setParentContainer(this._popupContainer));this._added$.next(t),this._popups$.next(this._popups)}getAll(){return this._popups.slice()}remove(t){for(const e of t)this._remove(e);this._popups$.next(this._popups)}removeAll(){for(const t of this._popups.slice())this._remove(t);this._popups$.next(this._popups)}_activate(){this._popupContainer=this._dom.createElement("div","mapillary-popup-container",this._container.container);for(const i of this._popups)i.setParentContainer(this._popupContainer);const t=this._subscriptions;t.push(ue(this._container.renderService.renderCamera$,this._container.renderService.size$,this._navigator.stateService.currentTransform$).subscribe((([t,e,i])=>{for(const n of this._popups)n.update(t,e,i)})));const e=this._popups$.pipe(ai(this._popups),oi((t=>Ft(t).pipe(fe((t=>t.changed$))))),ee((t=>[t])));t.push(Ee(this._added$,e).pipe(ui(this._container.renderService.renderCamera$,this._container.renderService.size$,this._navigator.stateService.currentTransform$)).subscribe((([t,e,i,n])=>{for(const r of t)r.update(e,i,n)})))}_deactivate(){this._subscriptions.unsubscribe();for(const t of this._popups)t.remove();this._container.container.removeChild(this._popupContainer),delete this._popupContainer}_getDefaultConfiguration(){return{}}_remove(t){const e=this._popups.indexOf(t);if(-1===e)return;const i=this._popups.splice(e,1)[0];this._activated&&i.remove()}}Ag.componentName="popup",function(t){t[t.Sequence=0]="Sequence",t[t.Spatial=1]="Spatial"}(eg||(eg={})),function(t){t[t.Default=0]="Default",t[t.Playback=1]="Playback",t[t.Timeline=2]="Timeline"}(ig||(ig={}));class kg{constructor(t){this._container=t,this._minThresholdWidth=320,this._maxThresholdWidth=1480,this._minThresholdHeight=240,this._maxThresholdHeight=820,this._stepperDefaultWidth=108,this._controlsDefaultWidth=88,this._defaultHeight=30,this._expandControls=!1,this._mode=ig.Default,this._speed=.5,this._changingSpeed=!1,this._index=null,this._changingPosition=!1,this._mouseEnterDirection$=new ht,this._mouseLeaveDirection$=new ht,this._notifyChanged$=new ht,this._notifyChangingPositionChanged$=new ht,this._notifySpeedChanged$=new ht,this._notifyIndexChanged$=new ht}get changed$(){return this._notifyChanged$}get changingPositionChanged$(){return this._notifyChangingPositionChanged$}get speed$(){return this._notifySpeedChanged$}get index$(){return this._notifyIndexChanged$}get mouseEnterDirection$(){return this._mouseEnterDirection$}get mouseLeaveDirection$(){return this._mouseLeaveDirection$}activate(){this._changingSubscription||(this._changingSubscription=Ee(this._container.mouseService.documentMouseUp$,this._container.touchService.touchEnd$.pipe(Ce((t=>0===t.touches.length)))).subscribe((()=>{this._changingSpeed&&(this._changingSpeed=!1),this._changingPosition&&this._setChangingPosition(!1)})))}deactivate(){this._changingSubscription&&(this._changingSpeed=!1,this._changingPosition=!1,this._expandControls=!1,this._mode=ig.Default,this._changingSubscription.unsubscribe(),this._changingSubscription=null)}render(t,e,i,n,r,a,o,s,l){if(!1===e.visible)return Sm.h("div.mapillary-sequence-container",{},[]);const c=this._createStepper(t,e,o,i,s,l),u=this._createSequenceControls(i),h=this._createPlaybackControls(i,n,s,e),p=this._createTimelineControls(i,r,a);return Sm.h("div.mapillary-sequence-container",[c,u,h,p])}getContainerWidth(t,e){let i=e.minWidth,n=e.maxWidth;n<i&&(n=i);let r=(t.width-this._minThresholdWidth)/(this._maxThresholdWidth-this._minThresholdWidth),a=(t.height-this._minThresholdHeight)/(this._maxThresholdHeight-this._minThresholdHeight);return i+Math.max(0,Math.min(1,Math.min(r,a)))*(n-i)}_createPositionInput(t,e){this._index=t;const i=t=>{this._index=Number(t.target.value),this._notifyIndexChanged$.next(this._index)},n=this._container.domContainer.getBoundingClientRect(),r=t=>{t.stopPropagation(),this._setChangingPosition(!0)},a=t=>{!0===this._changingPosition&&t.stopPropagation()},o={max:null!=e?e:1,min:0,onchange:i,oninput:i,onkeydown:t=>{"ArrowDown"!==t.key&&"ArrowLeft"!==t.key&&"ArrowRight"!==t.key&&"ArrowUp"!==t.key||t.preventDefault()},onpointerdown:r,onpointermove:a,ontouchmove:a,ontouchstart:r,style:{width:`${Math.max(276,Math.min(410,5+.8*n.width))-65}px`},type:"range",value:null!=t?t:0},s=null==t||null==e||e<=1;s&&(o.disabled="true");const l=Sm.h("input.mapillary-sequence-position",o,[]),c=s?".mapillary-sequence-position-container-inactive":".mapillary-sequence-position-container";return Sm.h("div"+c,[l])}_createSpeedInput(t){this._speed=t;const e=t=>{this._speed=Number(t.target.value)/1e3,this._notifySpeedChanged$.next(this._speed)},i=this._container.domContainer.getBoundingClientRect(),n=Math.max(276,Math.min(410,5+.8*i.width))-160,r=t=>{this._changingSpeed=!0,t.stopPropagation()},a=t=>{!0===this._changingSpeed&&t.stopPropagation()},o=Sm.h("input.mapillary-sequence-speed",{max:1e3,min:0,onchange:e,oninput:e,onkeydown:t=>{"ArrowDown"!==t.key&&"ArrowLeft"!==t.key&&"ArrowRight"!==t.key&&"ArrowUp"!==t.key||t.preventDefault()},onpointerdown:r,onpointermove:a,ontouchmove:a,ontouchstart:r,style:{width:`${n}px`},type:"range",value:1e3*t},[]);return Sm.h("div.mapillary-sequence-speed-container",[o])}_createPlaybackControls(t,e,i,n){if(this._mode!==ig.Playback)return Sm.h("div.mapillary-sequence-playback",[]);const r=Sm.h("div.mapillary-sequence-switch-icon.mapillary-sequence-icon-visible",[]),a=n.direction===Hh.Next?Hh.Prev:Hh.Next,o=n.playing,s={onclick:()=>{o||i.configure({direction:a})}},l=n.playing?".mapillary-sequence-switch-button-inactive":".mapillary-sequence-switch-button",c=Sm.h("div"+l,s,[r]),u=Sm.h("div.mapillary-sequence-slow-icon.mapillary-sequence-icon-visible",[]),h=Sm.h("div.mapillary-sequence-slow-container",[u]),p=Sm.h("div.mapillary-sequence-fast-icon.mapillary-sequence-icon-visible",[]),d=Sm.h("div.mapillary-sequence-fast-container",[p]),f=Sm.h("div.mapillary-sequence-close-icon.mapillary-sequence-icon-visible",[]),m={onclick:()=>{this._mode=ig.Default,this._notifyChanged$.next(this)}},g=Sm.h("div.mapillary-sequence-close-button",m,[f]),_=[c,h,this._createSpeedInput(e),d,g],y={style:{top:`${Math.round(t/this._stepperDefaultWidth*this._defaultHeight+10)}px`}};return Sm.h("div.mapillary-sequence-playback",y,_)}_createPlayingButton(t,e,i,n,r){let a=n.direction===Hh.Next&&null!=t||n.direction===Hh.Prev&&null!=e;a=a&&i;let o={onclick:n.playing?()=>{r.stop()}:a?()=>{r.play()}:null},s={};n.direction===Hh.Prev&&(s.style={transform:"rotate(180deg) translate(50%, 50%)"});let l=Sm.h("div.mapillary-sequence-icon",s,[]),c=n.playing?"mapillary-sequence-stop":a?"mapillary-sequence-play":"mapillary-sequence-play-inactive";return Sm.h("div."+c,o,[l])}_createSequenceControls(t){const e=Math.round(8/this._stepperDefaultWidth*t),i={onclick:()=>{this._expandControls=!this._expandControls,this._mode=ig.Default,this._notifyChanged$.next(this)},style:{"border-bottom-right-radius":`${e}px`,"border-top-right-radius":`${e}px`}},n=Sm.h("div.mapillary-sequence-expander-bar",[]),r=Sm.h("div.mapillary-sequence-expander-button",i,[n]),a=this._mode===ig.Playback?".mapillary-sequence-fast-icon-gray.mapillary-sequence-icon-visible":".mapillary-sequence-fast-icon",o=Sm.h("div"+a,[]),s={onclick:()=>{this._mode=this._mode===ig.Playback?ig.Default:ig.Playback,this._notifyChanged$.next(this)}},l=Sm.h("div.mapillary-sequence-playback-button",s,[o]),c=this._mode===ig.Timeline?".mapillary-sequence-timeline-icon-gray.mapillary-sequence-icon-visible":".mapillary-sequence-timeline-icon",u=Sm.h("div"+c,[]),h={onclick:()=>{this._mode=this._mode===ig.Timeline?ig.Default:ig.Timeline,this._notifyChanged$.next(this)}},p=Sm.h("div.mapillary-sequence-timeline-button",h,[u]),d={style:{height:this._defaultHeight/this._stepperDefaultWidth*t+"px",transform:`translate(${t/2+2}px, 0)`,width:this._controlsDefaultWidth/this._stepperDefaultWidth*t+"px"}},f=".mapillary-sequence-controls"+(this._expandControls?".mapillary-sequence-controls-expanded":"");return Sm.h("div"+f,d,[l,p,r])}_createSequenceArrows(t,e,i,n,r){let a={onclick:null!=t?()=>{r.moveDir$(Hh.Next).subscribe(void 0,(t=>{t instanceof zm||console.error(t)}))}:null,onpointerenter:()=>{this._mouseEnterDirection$.next(Hh.Next)},onpointerleave:()=>{this._mouseLeaveDirection$.next(Hh.Next)}};const o=Math.round(8/this._stepperDefaultWidth*i);let s={onclick:null!=e?()=>{r.moveDir$(Hh.Prev).subscribe(void 0,(t=>{t instanceof zm||console.error(t)}))}:null,onpointerenter:()=>{this._mouseEnterDirection$.next(Hh.Prev)},onpointerleave:()=>{this._mouseLeaveDirection$.next(Hh.Prev)},style:{"border-bottom-left-radius":`${o}px`,"border-top-left-radius":`${o}px`}},l=this._getStepClassName(Hh.Next,t,n.highlightId),c=this._getStepClassName(Hh.Prev,e,n.highlightId),u=Sm.h("div.mapillary-sequence-icon",[]),h=Sm.h("div.mapillary-sequence-icon",[]);return[Sm.h("div."+c,s,[h]),Sm.h("div."+l,a,[u])]}_createStepper(t,e,i,n,r,a){let o=null,s=null;for(let h of t.edges)h.data.direction===Hh.Next&&(o=h.target),h.data.direction===Hh.Prev&&(s=h.target);const l=this._createPlayingButton(o,s,i,e,r),c=this._createSequenceArrows(o,s,n,e,a);c.splice(1,0,l);const u={oncontextmenu:t=>{t.preventDefault()},style:{height:this._defaultHeight/this._stepperDefaultWidth*n+"px",width:n+"px"}};return Sm.h("div.mapillary-sequence-stepper",u,c)}_createTimelineControls(t,e,i){if(this._mode!==ig.Timeline)return Sm.h("div.mapillary-sequence-timeline",[]);const n=this._createPositionInput(e,i),r=Sm.h("div.mapillary-sequence-close-icon.mapillary-sequence-icon-visible",[]),a={onclick:()=>{this._mode=ig.Default,this._notifyChanged$.next(this)}},o=Sm.h("div.mapillary-sequence-close-button",a,[r]),s={style:{top:`${Math.round(t/this._stepperDefaultWidth*this._defaultHeight+10)}px`}};return Sm.h("div.mapillary-sequence-timeline",s,[n,o])}_getStepClassName(t,e,i){let n=t===Hh.Next?"mapillary-sequence-step-next":"mapillary-sequence-step-prev";return null==e?n+="-inactive":i===e&&(n+="-highlight"),n}_setChangingPosition(t){this._changingPosition=t,this._notifyChangingPositionChanged$.next(t)}}class Rg extends Mm{constructor(t,e,i,n,r){super(t,e,i),this._sequenceDOMRenderer=n||new kg(e),this._scheduler=r,this._containerWidth$=new ht,this._hoveredIdSubject$=new ht,this._hoveredId$=this._hoveredIdSubject$.pipe(ei()),this._navigator.playService.playing$.pipe(ni(1),ui(this._configuration$)).subscribe((([t,e])=>{const i="playing",n={playing:t,target:this,type:i};this.fire(i,n),t!==e.playing&&(t?this.play():this.stop())})),this._navigator.playService.direction$.pipe(ni(1),ui(this._configuration$)).subscribe((([t,e])=>{t!==e.direction&&this.configure({direction:t})}))}fire(t,e){super.fire(t,e)}off(t,e){super.off(t,e)}on(t,e){super.on(t,e)}play(){this.configure({playing:!0})}stop(){this.configure({playing:!1})}_activate(){this._sequenceDOMRenderer.activate();const t=this._navigator.stateService.currentImage$.pipe(oi((t=>t.sequenceEdges$)),Je(1),lt()),e=this._navigator.stateService.currentImage$.pipe(Ue(void 0,(t=>t.sequenceId)),oi((t=>_e(Zt(null),this._navigator.graphService.cacheSequence$(t.sequenceId).pipe(Qe(3),Re((t=>(console.error("Failed to cache sequence",t),Zt(null)))))))),ai(null),Je(1),lt()),i=this._subscriptions;i.push(e.subscribe());const n=this._sequenceDOMRenderer.index$.pipe(ui(e),ee((([t,e])=>null!=e?e.imageIds[t]:null)),Ce((t=>!!t)),Ue(),Ke(),lt());i.push(Ee(n.pipe(Oe(100,this._scheduler)),n.pipe(Ae(400,this._scheduler))).pipe(Ue(),oi((t=>this._navigator.moveTo$(t).pipe(Re((()=>Et())))))).subscribe()),i.push(this._sequenceDOMRenderer.changingPositionChanged$.pipe(Ce((t=>t))).subscribe((()=>{this._navigator.graphService.setGraphMode(eg.Sequence)}))),i.push(this._sequenceDOMRenderer.changingPositionChanged$.pipe(Ce((t=>!t))).subscribe((()=>{this._navigator.graphService.setGraphMode(eg.Spatial)}))),this._navigator.graphService.graphMode$.pipe(oi((t=>t===eg.Spatial?this._navigator.stateService.currentImage$.pipe(Ne(2)):Et())),Ce((t=>!t.spatialEdges.cached)),oi((t=>this._navigator.graphService.cacheImage$(t.id).pipe(Re((()=>Et())))))).subscribe(),i.push(this._sequenceDOMRenderer.changingPositionChanged$.pipe(Ce((t=>t))).subscribe((()=>{this._navigator.playService.stop()}))),i.push(ue(this._navigator.graphService.graphMode$,this._sequenceDOMRenderer.changingPositionChanged$.pipe(ai(!1),Ue())).pipe(ui(this._navigator.stateService.currentImage$),oi((([[t,e],i])=>e&&t===eg.Sequence?this._navigator.graphService.cacheSequenceImages$(i.sequenceId,i.id).pipe(Qe(3),Re((t=>(console.error("Failed to cache sequence images.",t),Et())))):Et()))).subscribe());const r=e.pipe(oi((t=>{if(!t)return Zt({index:null,max:null});let e=!0;return this._sequenceDOMRenderer.changingPositionChanged$.pipe(ai(!1),Ue(),oi((t=>{const i=!t&&e?0:1;return e=!1,t?n:this._navigator.stateService.currentImage$.pipe(ee((t=>t.id)),Ue(),ni(i))})),ee((e=>{const i=t.imageIds.indexOf(e);return-1===i?{index:null,max:null}:{index:i,max:t.imageIds.length-1}})))}))),a=this._navigator.stateService.state$.pipe(ee((t=>t===tg.Earth)),Ue());i.push(ue(t,this._configuration$,this._containerWidth$,this._sequenceDOMRenderer.changed$.pipe(ai(this._sequenceDOMRenderer)),this._navigator.playService.speed$,r,a).pipe(ee((([t,e,i,,n,r,a])=>{const o=this._sequenceDOMRenderer.render(t,e,i,n,r.index,r.max,!a,this,this._navigator);return{name:this._name,vNode:o}}))).subscribe(this._container.domRenderer.render$)),i.push(this._sequenceDOMRenderer.speed$.subscribe((t=>{this._navigator.playService.setSpeed(t)}))),i.push(this._configuration$.pipe(ee((t=>t.direction)),Ue()).subscribe((t=>{this._navigator.playService.setDirection(t)}))),i.push(ue(this._container.renderService.size$,this._configuration$.pipe(Ue(((t,e)=>t[0]===e[0]&&t[1]===e[1]),(t=>[t.minWidth,t.maxWidth])))).pipe(ee((([t,e])=>this._sequenceDOMRenderer.getContainerWidth(t,e)))).subscribe(this._containerWidth$)),i.push(this._configuration$.pipe(ee((t=>t.playing)),Ue()).subscribe((t=>{t?this._navigator.playService.play():this._navigator.playService.stop()}))),i.push(this._sequenceDOMRenderer.mouseEnterDirection$.pipe(oi((e=>_e(t.pipe(ee((t=>{for(let i of t.edges)if(i.data.direction===e)return i.target;return null})),si(this._sequenceDOMRenderer.mouseLeaveDirection$)),Zt(null)))),Ue()).subscribe(this._hoveredIdSubject$)),i.push(this._hoveredId$.subscribe((t=>{const e="hover",i={id:t,target:this,type:e};this.fire(e,i)})))}_deactivate(){this._subscriptions.unsubscribe(),this._sequenceDOMRenderer.deactivate()}_getDefaultConfiguration(){return{direction:Hh.Next,maxWidth:108,minWidth:70,playing:!1,visible:!0}}}Rg.componentName="sequence",function(t){t[t.Motion=0]="Motion",t[t.Stationary=1]="Stationary"}(ng||(ng={}));class zg{constructor(t,e,i,n,r,a,o,s,l,c){this._orientation=this._getValue(t,1);let u=null!=o?o.width:4,h=null!=o?o.height:3,p=this._orientation<5;this._width=this._getValue(e,p?u:h),this._height=this._getValue(i,p?h:u),this._basicAspect=p?this._width/this._height:this._height/this._width,this._basicWidth=p?e:i,this._basicHeight=p?i:e;const d=this._getCameraParameters(l,c),f=d[0],m=d[1],g=d[2];this._focal=this._getValue(f,1),this._scale=this._getValue(n,0),this._worldToCamera=this.createWorldToCamera(r,a),this._worldToCameraInverse=(new Jn).copy(this._worldToCamera).invert(),this._scaledWorldToCamera=this._createScaledWorldToCamera(this._worldToCamera,this._scale),this._scaledWorldToCameraInverse=(new Jn).copy(this._scaledWorldToCamera).invert(),this._basicWorldToCamera=this._createBasicWorldToCamera(this._worldToCamera,t),this._textureScale=s||[1,1],this._ck1=m||0,this._ck2=g||0,this._cameraType=c||"perspective",this._radialPeak=this._getRadialPeak(this._ck1,this._ck2)}get ck1(){return this._ck1}get ck2(){return this._ck2}get cameraType(){return this._cameraType}get basicAspect(){return this._basicAspect}get basicHeight(){return this._basicHeight}get basicRt(){return this._basicWorldToCamera}get basicWidth(){return this._basicWidth}get focal(){return this._focal}get height(){return this._height}get orientation(){return this._orientation}get rt(){return this._worldToCamera}get srt(){return this._scaledWorldToCamera}get srtInverse(){return this._scaledWorldToCameraInverse}get scale(){return this._scale}get hasValidScale(){return this._scale>.01&&this._scale<50}get radialPeak(){return this._radialPeak}get width(){return this._width}upVector(){let t=this._worldToCamera.elements;switch(this._orientation){case 1:default:return new bn(-t[1],-t[5],-t[9]);case 3:return new bn(t[1],t[5],t[9]);case 6:return new bn(-t[0],-t[4],-t[8]);case 8:return new bn(t[0],t[4],t[8])}}projectorMatrix(){let t=this._normalizedToTextureMatrix(),e=this._focal,i=(new Jn).set(e,0,0,0,0,e,0,0,0,0,0,0,0,0,1,0);return t.multiply(i),t.multiply(this._worldToCamera),t}projectBasic(t){let e=this.projectSfM(t);return this._sfmToBasic(e)}unprojectBasic(t,e,i){let n=this._basicToSfm(t);return this.unprojectSfM(n,e,i)}projectSfM(t){let e=new _n(t[0],t[1],t[2],1);return e.applyMatrix4(this._worldToCamera),this._bearingToSfm([e.x,e.y,e.z])}unprojectSfM(t,e,i){const n=this._sfmToBearing(t),r=(i&&!Qh(this._cameraType)?new _n(e*n[0]/n[2],e*n[1]/n[2],e,1):new _n(e*n[0],e*n[1],e*n[2],1)).applyMatrix4(this._worldToCameraInverse);return[r.x/r.w,r.y/r.w,r.z/r.w]}_sfmToBearing(t){if(Qh(this._cameraType)){let e=2*t[0]*Math.PI,i=2*-t[1]*Math.PI;return[Math.cos(i)*Math.sin(e),-Math.sin(i),Math.cos(i)*Math.cos(e)]}if(tp(this._cameraType)){let[e,i]=[t[0]/this._focal,t[1]/this._focal];const n=Math.sqrt(e*e+i*i);let r=n/this._distortionFromDistortedRadius(n,this._ck1,this._ck2,this._radialPeak),a=Math.cos(r),o=Math.sin(r);const s=n>1e-8?1/n:1;return[o*e*s,o*i*s,a]}{let[e,i]=[t[0]/this._focal,t[1]/this._focal];const n=Math.sqrt(e*e+i*i);let r=this._distortionFromDistortedRadius(n,this._ck1,this._ck2,this._radialPeak);let a=new bn(e/r,i/r,1);return a.normalize(),[a.x,a.y,a.z]}}_distortionFromDistortedRadius(t,e,i,n){let r=1;for(let a=0;a<10;a++){let a=t/r;a>n&&(a=n),r=1+e*Math.pow(a,2)+i*Math.pow(a,4)}return r}_bearingToSfm(t){if(Qh(this._cameraType)){let e=t[0],i=t[1],n=t[2],r=Math.atan2(e,n),a=Math.atan2(-i,Math.sqrt(e*e+n*n));return[r/(2*Math.PI),-a/(2*Math.PI)]}if(tp(this._cameraType)){if(t[2]>0){const[e,i,n]=t,r=Math.sqrt(e*e+i*i);let a=Math.atan2(r,n);a>this._radialPeak&&(a=this._radialPeak);const o=1+Math.pow(a,2)*(this._ck1+Math.pow(a,2)*this._ck2),s=this._focal*o*a/r;return[s*e,s*i]}return[t[0]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,t[1]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY]}if(t[2]>0){let[e,i]=[t[0]/t[2],t[1]/t[2]],n=e*e+i*i;const r=Math.pow(this._radialPeak,2);n>r&&(n=r);const a=1+this._ck1*n+this._ck2*Math.pow(n,2);return[this._focal*a*e,this._focal*a*i]}return[t[0]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,t[1]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY]}_basicToSfm(t){let e,i;switch(this._orientation){case 1:default:e=t[0],i=t[1];break;case 3:e=1-t[0],i=1-t[1];break;case 6:e=t[1],i=1-t[0];break;case 8:e=1-t[1],i=t[0]}let n=this._width,r=this._height,a=Math.max(n,r);return[e*n/a-n/a/2,i*r/a-r/a/2]}_sfmToBasic(t){let e,i,n=this._width,r=this._height,a=Math.max(n,r),o=(t[0]+n/a/2)/n*a,s=(t[1]+r/a/2)/r*a;switch(this._orientation){case 1:default:e=o,i=s;break;case 3:e=1-o,i=1-s;break;case 6:e=1-s,i=o;break;case 8:e=s,i=1-o}return[e,i]}_getValue(t,e){return null!=t&&t>0?t:e}_getCameraParameters(t,e){if(Qh(e))return[];if(!t||0===t.length)return[1,0,0];const i=3-t.length;return i<=0?t:t.concat(new Array(i).fill(0))}createWorldToCamera(t,e){const i=new bn(t[0],t[1],t[2]),n=i.length();n>0&&i.normalize();const r=new Jn;return r.makeRotationAxis(i,n),r.setPosition(new bn(e[0],e[1],e[2])),r}_createScaledWorldToCamera(t,e){const i=t.clone(),n=i.elements;return n[12]=e*n[12],n[13]=e*n[13],n[14]=e*n[14],i.scale(new bn(e,e,e)),i}_createBasicWorldToCamera(t,e){const i=new bn(0,0,1);let n=0;switch(e){case 3:n=Math.PI;break;case 6:n=Math.PI/2;break;case 8:n=3*Math.PI/2}return(new Jn).makeRotationAxis(i,n).multiply(t)}_getRadialPeak(t,e){const i=5*e,n=3*t,r=Math.pow(n,2)-4*i*1;if(r<0)return;const a=(-n-Math.sqrt(r))/2/i,o=(-n+Math.sqrt(r))/2/i,s=Math.min(a,o),l=Math.max(a,o);return s>0?Math.sqrt(s):l>0?Math.sqrt(l):void 0}_normalizedToTextureMatrix(){const t=Math.max(this._width,this._height),e=this._orientation<5?this._textureScale[0]:this._textureScale[1],i=this._orientation<5?this._textureScale[1]:this._textureScale[0],n=t/this._width*e,r=t/this._height*i;switch(this._orientation){case 1:default:return(new Jn).set(n,0,0,.5,0,-r,0,.5,0,0,1,0,0,0,0,1);case 3:return(new Jn).set(-n,0,0,.5,0,r,0,.5,0,0,1,0,0,0,0,1);case 6:return(new Jn).set(0,-r,0,.5,-n,0,0,.5,0,0,1,0,0,0,0,1);case 8:return(new Jn).set(0,r,0,.5,n,0,0,.5,0,0,1,0,0,0,0,1)}}}class Pg{constructor(){this._factory=new Om,this._scene=new Fm,this._spatial=new Kh,this._currentKey=null,this._previousKey=null,this._disabled=!1,this._curtain=1,this._frameId=0,this._needsRender=!1,this._mode=null,this._currentProviderDisposers={},this._previousProviderDisposers={}}get disabled(){return this._disabled}get frameId(){return this._frameId}get needsRender(){return this._needsRender}setTextureProvider(t,e){this._setTextureProvider(t,this._currentKey,e,this._currentProviderDisposers,this._updateTexture.bind(this))}setTextureProviderPrev(t,e){this._setTextureProvider(t,this._previousKey,e,this._previousProviderDisposers,this._updateTexturePrev.bind(this))}update(t,e){this._updateFrameId(t.id),this._updateImagePlanes(t.state,e)}updateCurtain(t){this._curtain!==t&&(this._curtain=t,this._updateCurtain(),this._needsRender=!0)}updateTexture(t,e){const i=e.id===this._currentKey?this._scene.planes:e.id===this._previousKey?this._scene.planesOld:{};if(0!==Object.keys(i).length){this._needsRender=!0;for(const e in i){if(!i.hasOwnProperty(e))continue;let n=i[e].material.uniforms.projectorTex.value;n.image=t,n.needsUpdate=!0}}}updateTextureImage(t,e){if(this._currentKey!==e.id)return;this._needsRender=!0;const i=this._scene.planes;for(const n in i){if(!i.hasOwnProperty(n))continue;let e=i[n].material.uniforms.projectorTex.value;e.image=t,e.needsUpdate=!0}}render(t,e){this.disabled||e.render(this._scene.sceneOld,t),e.render(this._scene.scene,t),this._needsRender=!1}dispose(){this._scene.clear();for(const t in this._currentProviderDisposers)this._currentProviderDisposers.hasOwnProperty(t)&&this._currentProviderDisposers[t]();for(const t in this._previousProviderDisposers)this._previousProviderDisposers.hasOwnProperty(t)&&this._previousProviderDisposers[t]();this._currentProviderDisposers={},this._previousProviderDisposers={}}_getBasicCorners(t,e){let i,n;return t>e?(i=.5,n=.5*t/e):(i=.5*e/t,n=.5),[[.5-i,.5-n],[.5+i,.5+n]]}_setDisabled(t){this._disabled=null==t.currentImage||null==t.previousImage||Qh(t.currentImage.cameraType)&&!Qh(t.previousImage.cameraType)}_setTextureProvider(t,e,i,n,r){if(t!==e)return;let a=i.textureCreated$.subscribe(r),o=i.textureUpdated$.subscribe((t=>{this._needsRender=!0}));if(t in n){(0,n[t])(),delete n[t]}n[t]=()=>{a.unsubscribe(),o.unsubscribe(),i.dispose()}}_updateCurtain(){const t=this._scene.planes;for(const e in t){if(!t.hasOwnProperty(e))continue;let i=t[e].material;i.uniforms.curtain&&(i.uniforms.curtain.value=this._curtain)}}_updateFrameId(t){this._frameId=t}_updateImagePlanes(t,e){const i=null!=t.currentImage&&this._currentKey!==t.currentImage.id,n=null!=t.previousImage&&this._previousKey!==t.previousImage.id,r=this._mode!==e;if(!(i||n||r))return;this._setDisabled(t),this._needsRender=!0,this._mode=e;const a=t.motionless||e===ng.Stationary||Qh(t.currentImage.cameraType);if((this.disabled||n)&&this._previousKey in this._previousProviderDisposers&&(this._previousProviderDisposers[this._previousKey](),delete this._previousProviderDisposers[this._previousKey]),this.disabled)this._scene.setImagePlanesOld({});else if(n||r){const e=t.previousImage;this._previousKey=e.id;const i=t.currentTransform.rt.elements;let n=[i[12],i[13],i[14]];const r=t.currentTransform.basicAspect,o=t.previousTransform.basicAspect,s=r>o?[1,o/r]:[r/o,1];let l=t.currentImage.rotation,c=t.currentImage.width,u=t.currentImage.height;Qh(e.cameraType)&&(l=t.previousImage.rotation,n=this._spatial.rotate(this._spatial.opticalCenter(t.currentImage.rotation,n).toArray(),l).multiplyScalar(-1).toArray(),c=t.previousImage.width,u=t.previousImage.height);const h=new zg(t.currentImage.exifOrientation,c,u,t.currentImage.scale,l,n,e.image,s,t.currentImage.cameraParameters,t.currentImage.cameraType);let p;if(Qh(e.cameraType))p=this._factory.createMesh(e,a||Qh(t.currentImage.cameraType)?h:t.previousTransform);else if(a){const[[e,i],[n,a]]=this._getBasicCorners(r,o);p=this._factory.createFlatMesh(t.previousImage,h,e,n,i,a)}else p=this._factory.createMesh(t.previousImage,t.previousTransform);const d={};d[e.id]=p,this._scene.setImagePlanesOld(d)}if(i||r){this._currentKey in this._currentProviderDisposers&&(this._currentProviderDisposers[this._currentKey](),delete this._currentProviderDisposers[this._currentKey]),this._currentKey=t.currentImage.id;const e={};Qh(t.currentImage.cameraType)?e[t.currentImage.id]=this._factory.createCurtainMesh(t.currentImage,t.currentTransform):e[t.currentImage.id]=a?this._factory.createDistortedCurtainMesh(t.currentImage,t.currentTransform):this._factory.createCurtainMesh(t.currentImage,t.currentTransform),this._scene.setImagePlanes(e),this._updateCurtain()}}_updateTexture(t){this._needsRender=!0;const e=this._scene.planes;for(const i in e){if(!e.hasOwnProperty(i))continue;let n=e[i].material,r=n.uniforms.projectorTex.value;n.uniforms.projectorTex.value=null,r.dispose(),n.uniforms.projectorTex.value=t}}_updateTexturePrev(t){this._needsRender=!0;const e=this._scene.planesOld;for(const i in e){if(!e.hasOwnProperty(i))continue;let n=e[i].material,r=n.uniforms.projectorTex.value;n.uniforms.projectorTex.value=null,r.dispose(),n.uniforms.projectorTex.value=t}}}class Dg{constructor(t){this._container=t,this._interacting=!1,this._notifyModeChanged$=new ht,this._notifyPositionChanged$=new ht,this._stopInteractionSubscription=null}get mode$(){return this._notifyModeChanged$}get position$(){return this._notifyPositionChanged$}activate(){this._stopInteractionSubscription||(this._stopInteractionSubscription=Ee(this._container.mouseService.documentMouseUp$,this._container.touchService.touchEnd$.pipe(Ce((t=>0===t.touches.length)))).subscribe((t=>{this._interacting&&(this._interacting=!1)})))}deactivate(){this._stopInteractionSubscription&&(this._interacting=!1,this._stopInteractionSubscription.unsubscribe(),this._stopInteractionSubscription=null)}render(t,e,i,n,r){const a=[];if(r){a.push(Sm.h("div.mapillary-slider-border",[]));const r=!(i||n);r&&(a.push(this._createModeButton(e)),a.push(this._createModeButton2d(e))),a.push(this._createPositionInput(t,r))}const o=this._container.domContainer.getBoundingClientRect(),s=Math.max(215,Math.min(400,o.width-100));return Sm.h("div.mapillary-slider-container",{style:{width:`${s}px`}},a)}_createModeButton(t){const e={onclick:()=>{t!==ng.Motion&&this._notifyModeChanged$.next(ng.Motion)}},i=t===ng.Stationary?"mapillary-slider-mode-button-inactive":"mapillary-slider-mode-button";return Sm.h("div."+i,e,[Sm.h("div.mapillary-slider-mode-icon",[])])}_createModeButton2d(t){const e={onclick:()=>{t!==ng.Stationary&&this._notifyModeChanged$.next(ng.Stationary)}},i=t===ng.Motion?"mapillary-slider-mode-button-2d-inactive":"mapillary-slider-mode-button-2d";return Sm.h("div."+i,e,[Sm.h("div.mapillary-slider-mode-icon-2d",[])])}_createPositionInput(t,e){const i=t=>{this._notifyPositionChanged$.next(Number(t.target.value)/1e3)},n=t=>{this._interacting=!0,t.stopPropagation()},r=t=>{this._interacting&&t.stopPropagation()},a=this._container.domContainer.getBoundingClientRect(),o=Math.max(215,Math.min(400,a.width-105))-84+(e?0:52),s=Sm.h("input.mapillary-slider-position",{max:1e3,min:0,onchange:i,oninput:i,onkeydown:t=>{"ArrowDown"!==t.key&&"ArrowLeft"!==t.key&&"ArrowRight"!==t.key&&"ArrowUp"!==t.key||t.preventDefault()},onpointerdown:n,onpointermove:r,ontouchmove:r,ontouchstart:n,style:{width:`${o}px`},type:"range",value:1e3*t},[]);return Sm.h("div.mapillary-slider-position-container",[s])}}class Lg extends Mm{constructor(t,e,i,n){super(t,e,i),this._viewportCoords=n||new Am,this._domRenderer=new Dg(e),this._imageTileLoader=new $m(i.api),this._roiCalculator=new jm,this._spatial=new Kh,this._glRendererOperation$=new ht,this._glRendererCreator$=new ht,this._glRendererDisposer$=new ht,this._glRenderer$=this._glRendererOperation$.pipe(ti(((t,e)=>e(t)),null),Ce((t=>null!=t)),Ue(void 0,(t=>t.frameId))),this._glRendererCreator$.pipe(ee((()=>t=>{if(null!=t)throw new Error("Multiple slider states can not be created at the same time");return new Pg}))).subscribe(this._glRendererOperation$),this._glRendererDisposer$.pipe(ee((()=>t=>(t.dispose(),null)))).subscribe(this._glRendererOperation$)}_activate(){const t=this._subscriptions;t.push(this._domRenderer.mode$.subscribe((t=>{this.configure({mode:t})}))),t.push(this._glRenderer$.pipe(ee((t=>({name:this._name,renderer:{frameId:t.frameId,needsRender:t.needsRender,render:t.render.bind(t),pass:Um.Background}})))).subscribe(this._container.glRenderer.render$));const e=_e(this.configuration$.pipe(ee((t=>null!=t.initialPosition?t.initialPosition:1)),He()),this._domRenderer.position$),i=this.configuration$.pipe(ee((t=>t.mode)),Ue()),n=this._navigator.stateService.currentState$.pipe(ee((t=>t.state.motionless)),Ue()),r=this._navigator.stateService.currentState$.pipe(ee((t=>Qh(t.state.currentImage.cameraType))),Ue()),a=ue(this._configuration$.pipe(ee((t=>t.sliderVisible))),this._navigator.stateService.currentState$.pipe(ee((t=>!(null==t.state.currentImage||null==t.state.previousImage||Qh(t.state.currentImage.cameraType)&&!Qh(t.state.previousImage.cameraType)))),Ue())).pipe(ee((([t,e])=>t&&e)),Ue());this._waitSubscription=ue(i,n,r,a).pipe(ui(this._navigator.stateService.state$)).subscribe((([[t,e,i,n],r])=>{const a=n&&(e||t===ng.Stationary||i);a&&r!==tg.WaitingInteractively?this._navigator.stateService.waitInteractively():a||r===tg.Waiting||this._navigator.stateService.wait()})),t.push(ue(e,i,n,r,a).subscribe((([t,e,i,n])=>{i||e===ng.Stationary||n?this._navigator.stateService.moveTo(1):this._navigator.stateService.moveTo(t)}))),t.push(ue(e,i,n,r,a,this._container.renderService.size$).pipe(ee((([t,e,i,n,r])=>({name:this._name,vNode:this._domRenderer.render(t,e,i,n,r)})))).subscribe(this._container.domRenderer.render$)),this._glRendererCreator$.next(null),t.push(ue(e,r,a,this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$).pipe(ee((([t,e,i,n,r])=>{if(!e)return i?t:1;const a=this._viewportCoords.viewportToBasic(-1.15,0,r,n.perspective),o=this._viewportCoords.viewportToBasic(1.15,0,r,n.perspective),s=o[0]<a[0]?o[0]+1:o[0],l=a[0]+t*(s-a[0]);return l>1?l-1:l})),ee((t=>e=>(e.updateCurtain(t),e)))).subscribe(this._glRendererOperation$)),t.push(ue(this._navigator.stateService.currentState$,i).pipe(ee((([t,e])=>i=>(i.update(t,e),i)))).subscribe(this._glRendererOperation$)),t.push(this._configuration$.pipe(Ce((t=>null!=t.ids)),oi((t=>Ie(Ie(this._catchCacheImage$(t.ids.background),this._catchCacheImage$(t.ids.foreground)).pipe(ee((t=>({background:t[0],foreground:t[1]})))),this._navigator.stateService.currentState$.pipe(He())).pipe(ee((t=>({images:t[0],state:t[1].state}))))))).subscribe((t=>{null!=t.state.currentImage&&null!=t.state.previousImage&&t.state.currentImage.id===t.images.foreground.id&&t.state.previousImage.id===t.images.background.id||(t.state.currentImage.id!==t.images.background.id?t.state.currentImage.id!==t.images.foreground.id||1!==t.state.trajectory.length?(this._navigator.stateService.setImages([t.images.background]),this._navigator.stateService.setImages([t.images.foreground])):this._navigator.stateService.prependImages([t.images.background]):this._navigator.stateService.setImages([t.images.foreground]))}),(t=>{console.error(t)})));const o=this._container.configurationService.imageTiling$.pipe(oi((t=>t?this._navigator.stateService.currentState$:new ht)),Ue(void 0,(t=>t.state.currentImage.id)),ui(this._container.glRenderer.webGLRenderer$,this._container.renderService.size$),ee((([t,e,i])=>{const n=t.state;Math.max(i.width,i.height);const r=n.currentImage,a=n.currentTransform;return new Qm(r.id,a.basicWidth,a.basicHeight,r.image,this._imageTileLoader,new Vm,e)})),Je(1),lt());t.push(o.subscribe((()=>{}))),t.push(o.pipe(ee((t=>e=>(e.setTextureProvider(t.id,t),e)))).subscribe(this._glRendererOperation$)),t.push(o.pipe(Xe()).subscribe((t=>{t[0].abort()})));const s=this._container.configurationService.imageTiling$.pipe(oi((t=>t?ue(this._container.renderService.renderCameraFrame$,this._container.renderService.size$.pipe(Oe(250))):new ht)),ee((([t,e])=>[t.camera.position.clone(),t.camera.lookat.clone(),t.zoom.valueOf(),e.height.valueOf(),e.width.valueOf()])),Xe(),ri((t=>t[1][2]-t[0][2]<0||0===t[1][2])),ee((t=>{let e=t[0][0].equals(t[1][0]),i=t[0][1].equals(t[1][1]),n=t[0][2]===t[1][2],r=t[0][3]===t[1][3],a=t[0][4]===t[1][4];return e&&i&&n&&r&&a})),Ue(),Ce((t=>t)),oi((()=>this._container.renderService.renderCameraFrame$.pipe(He()))),ui(this._container.renderService.size$,this._navigator.stateService.currentTransform$));t.push(o.pipe(oi((t=>s.pipe(ee((([e,i,n])=>[this._roiCalculator.computeRegionOfInterest(e,i,n),t]))))),Ce((t=>!t[1].disposed))).subscribe((t=>{let e=t[0];t[1].setRegionOfInterest(e)})));const l=o.pipe(oi((t=>t.hasTexture$)),ai(!1),Je(1),lt());t.push(l.subscribe((()=>{})));const c=this._container.configurationService.imageTiling$.pipe(oi((t=>t?this._navigator.stateService.currentState$:new ht)),Ce((t=>!!t.state.previousImage)),Ue(void 0,(t=>t.state.previousImage.id)),ui(this._container.glRenderer.webGLRenderer$,this._container.renderService.size$),ee((([t,e,i])=>{const n=t.state,r=n.previousImage,a=n.previousTransform;return new Qm(r.id,a.basicWidth,a.basicHeight,r.image,this._imageTileLoader,new Vm,e)})),Je(1),lt());t.push(c.subscribe((()=>{}))),t.push(c.pipe(ee((t=>e=>(e.setTextureProviderPrev(t.id,t),e)))).subscribe(this._glRendererOperation$)),t.push(c.pipe(Xe()).subscribe((t=>{t[0].abort()})));const u=this._container.configurationService.imageTiling$.pipe(oi((t=>t?ue(this._container.renderService.renderCameraFrame$,this._container.renderService.size$.pipe(Oe(250))):new ht)),ee((([t,e])=>[t.camera.position.clone(),t.camera.lookat.clone(),t.zoom.valueOf(),e.height.valueOf(),e.width.valueOf()])),Xe(),ri((t=>t[1][2]-t[0][2]<0||0===t[1][2])),ee((t=>{let e=t[0][0].equals(t[1][0]),i=t[0][1].equals(t[1][1]),n=t[0][2]===t[1][2],r=t[0][3]===t[1][3],a=t[0][4]===t[1][4];return e&&i&&n&&r&&a})),Ue(),Ce((t=>t)),oi((()=>this._container.renderService.renderCameraFrame$.pipe(He()))),ui(this._container.renderService.size$,this._navigator.stateService.currentTransform$));t.push(c.pipe(oi((t=>u.pipe(ee((([e,i,n])=>[this._roiCalculator.computeRegionOfInterest(e,i,n),t]))))),Ce((t=>!t[1].disposed)),ui(this._navigator.stateService.currentState$)).subscribe((([[t,e],i])=>{let n=null;if(Qh(i.state.previousImage.cameraType))if(Qh(i.state.currentImage.cameraType)){const e=this._spatial.viewingDirection(i.state.currentImage.rotation),r=this._spatial.viewingDirection(i.state.previousImage.rotation),a=this._spatial.angleBetweenVector2(e.x,e.y,r.x,r.y)/(2*Math.PI);n={bbox:{maxX:this._spatial.wrap(t.bbox.maxX+a,0,1),maxY:t.bbox.maxY,minX:this._spatial.wrap(t.bbox.minX+a,0,1),minY:t.bbox.minY},pixelHeight:t.pixelHeight,pixelWidth:t.pixelWidth}}else{const e=this._spatial.viewingDirection(i.state.currentImage.rotation),r=this._spatial.viewingDirection(i.state.previousImage.rotation),a=this._spatial.angleBetweenVector2(e.x,e.y,r.x,r.y)/(2*Math.PI),o=this._spatial.angleToPlane(e.toArray(),[0,0,1]),s=(this._spatial.angleToPlane(r.toArray(),[0,0,1])-o)/(2*Math.PI),l=i.state.currentTransform,c=Math.max(l.basicWidth,l.basicHeight),u=c>0?2*Math.atan(.5*l.basicWidth/(c*l.focal)):Math.PI/3,h=c>0?2*Math.atan(.5*l.basicHeight/(c*l.focal)):Math.PI/3,p=u/(2*Math.PI),d=h/Math.PI,f=(t.bbox.maxX-t.bbox.minX)*p,m=(t.bbox.maxY-t.bbox.minY)*d,g=t.pixelWidth*p,_=t.pixelHeight*d,y=(t.bbox.minX+t.bbox.maxX)/2-.5,v=(t.bbox.minY+t.bbox.maxY)/2-.5,x=.5+a+p*y-f/2,b=.5+a+p*y+f/2,w=.5+s+d*v-m/2,S=.5+s+d*v+m/2;n={bbox:{maxX:this._spatial.wrap(b,0,1),maxY:S,minX:this._spatial.wrap(x,0,1),minY:w},pixelHeight:_,pixelWidth:g}}else{const e=i.state.currentTransform.basicAspect,r=i.state.previousTransform.basicAspect,[[a,o],[s,l]]=this._getBasicCorners(e,r),c=s-a,u=l-o,h=t.pixelWidth/c,p=t.pixelHeight/u,d=(c-1)/(2*c)+t.bbox.minX/c,f=(c-1)/(2*c)+t.bbox.maxX/c,m=(u-1)/(2*u)+t.bbox.minY/u,g={maxX:f,maxY:(u-1)/(2*u)+t.bbox.maxY/u,minX:d,minY:m};this._clipBoundingBox(g),n={bbox:g,pixelHeight:p,pixelWidth:h}}e.setRegionOfInterest(n)})));const h=c.pipe(oi((t=>t.hasTexture$)),ai(!1),Je(1),lt());t.push(h.subscribe((()=>{})))}_deactivate(){this._waitSubscription.unsubscribe(),this._navigator.stateService.state$.pipe(He()).subscribe((t=>{t!==tg.Traversing&&this._navigator.stateService.traverse()})),this._glRendererDisposer$.next(null),this._domRenderer.deactivate(),this._subscriptions.unsubscribe(),this.configure({ids:null})}_getDefaultConfiguration(){return{initialPosition:1,mode:ng.Motion,sliderVisible:!0}}_catchCacheImage$(t){return this._navigator.graphService.cacheImage$(t).pipe(Re((e=>(console.error(`Failed to cache slider image (${t})`,e),Et()))))}_getBasicCorners(t,e){let i,n;return t>e?(i=.5,n=.5*t/e):(i=.5*e/t,n=.5),[[.5-i,.5-n],[.5+i,.5+n]]}_clipBoundingBox(t){t.minX=Math.max(0,Math.min(1,t.minX)),t.maxX=Math.max(0,Math.min(1,t.maxX)),t.minY=Math.max(0,Math.min(1,t.minY)),t.maxY=Math.max(0,Math.min(1,t.maxY))}}Lg.componentName="slider";class Bg{constructor(t,e){this._subscriptions=new Tm,this._graphService=t,this._stateService=e;const i=this._subscriptions;this._directionSubject$=new ht,this._direction$=this._directionSubject$.pipe(ai(Hh.Next),Je(1),lt()),i.push(this._direction$.subscribe()),this._playing=!1,this._playingSubject$=new ht,this._playing$=this._playingSubject$.pipe(ai(this._playing),Je(1),lt()),i.push(this._playing$.subscribe()),this._speed=.5,this._speedSubject$=new ht,this._speed$=this._speedSubject$.pipe(ai(this._speed),Je(1),lt()),i.push(this._speed$.subscribe()),this._imagesAhead=this._mapImagesAhead(this._mapSpeed(this._speed)),this._bridging$=null}get playing(){return this._playing}get direction$(){return this._direction$}get playing$(){return this._playing$}get speed$(){return this._speed$}play(){if(this._playing)return;this._stateService.cutImages();const t=this._setSpeed(this._speed);this._stateService.setSpeed(t),this._graphModeSubscription=this._speed$.pipe(ee((t=>t>Bg.sequenceSpeed?eg.Sequence:eg.Spatial)),Ue()).subscribe((t=>{this._graphService.setGraphMode(t)})),this._cacheSubscription=ue(this._stateService.currentImage$.pipe(ee((t=>[t.sequenceId,t.id])),Ue(void 0,(([t])=>t))),this._graphService.graphMode$,this._direction$).pipe(oi((([[t,e],i,n])=>{if(n!==Hh.Next&&n!==Hh.Prev)return Zt([void 0,n]);return ue((i===eg.Sequence?this._graphService.cacheSequenceImages$(t,e):this._graphService.cacheSequence$(t)).pipe(Qe(3),Re((t=>(console.error(t),Zt(void 0))))),Zt(n))})),oi((([t,e])=>{if(void 0===t)return Et();const i=t.imageIds.slice();return e===Hh.Prev&&i.reverse(),this._stateService.currentState$.pipe(ee((t=>[t.state.trajectory[t.state.trajectory.length-1].id,t.state.imagesAhead])),ti((([t,e],[n,r])=>{void 0===t&&(t=n);const a=i.length-1;if(r>=this._imagesAhead||i[a]===t)return[t,[]];const o=i.indexOf(n),s=i.indexOf(t)+1,l=Math.min(a,o+this._imagesAhead-r)+1;return l<=s?[t,[]]:[i[l-1],i.slice(s,l)]}),[void 0,[]]),fe((([t,e])=>Ft(e))))})),fe((t=>this._graphService.cacheImage$(t).pipe(Re((()=>Et())))),6)).subscribe(),this._playingSubscription=this._stateService.currentState$.pipe(Ce((t=>t.state.imagesAhead<this._imagesAhead)),Ue(void 0,(t=>t.state.lastImage.id)),ee((t=>{const e=t.state.lastImage,i=t.state.trajectory;let n;for(let r=i.length-2;r>=0;r--){const t=i[r];if(t.sequenceId!==e.sequenceId)break;if(t.capturedAt!==e.capturedAt){n=t.capturedAt<e.capturedAt;break}}return[t.state.lastImage,n]})),ui(this._direction$),oi((([[t,e],i])=>Ie(([Hh.Next,Hh.Prev].indexOf(i)>-1?t.sequenceEdges$:t.spatialEdges$).pipe(He((t=>t.cached)),Qt(15e3)),Zt(i)).pipe(ee((([t,e])=>{for(let i of t.edges)if(i.data.direction===e)return i.target;return null})),oi((t=>null!=t?this._graphService.cacheImage$(t):Et())))))).subscribe((t=>{this._stateService.appendImagess([t])}),(t=>{console.error(t),this.stop()})),this._clearSubscription=this._stateService.currentImage$.pipe(ke(1,10)).subscribe((t=>{this._stateService.clearPriorImages()})),this._setPlaying(!0);const e=this._stateService.currentState$.pipe(ee((t=>t.state)),Ue((([t,e],[i,n])=>t===i&&e===n),(t=>[t.currentImage.id,t.lastImage.id])),Ce((t=>t.currentImage.id===t.lastImage.id&&t.currentIndex===t.trajectory.length-1)),ee((t=>t.currentImage)));this._stopSubscription=ue(e,this._direction$).pipe(oi((([t,e])=>{const i=([Hh.Next,Hh.Prev].indexOf(e)>-1?t.sequenceEdges$:t.spatialEdges$).pipe(He((t=>t.cached)),Qt(15e3),Re((t=>(console.error(t),Zt({cached:!1,edges:[]})))));return ue(Zt(e),i).pipe(ee((([t,e])=>{for(const i of e.edges)if(i.data.direction===t)return!0;return!1})))})),fe((t=>t||!this._bridging$?Zt(t):this._bridging$.pipe(ee((t=>null!=t)),Re((t=>(console.error(t),Zt(!1))))))),He((t=>!t))).subscribe(void 0,void 0,(()=>{this.stop()})),this._stopSubscription.closed&&(this._stopSubscription=null),this._earthSubscription=this._stateService.state$.pipe(ee((t=>t===tg.Earth)),Ue(),He((t=>t))).subscribe(void 0,void 0,(()=>{this.stop()})),this._earthSubscription.closed&&(this._earthSubscription=null)}dispose(){this.stop(),this._subscriptions.unsubscribe()}setDirection(t){this._directionSubject$.next(t)}setSpeed(t){if((t=Math.max(0,Math.min(1,t)))===this._speed)return;const e=this._setSpeed(t);this._playing&&this._stateService.setSpeed(e),this._speedSubject$.next(this._speed)}stop(){this._playing&&(this._stopSubscription&&(this._stopSubscription.closed||this._stopSubscription.unsubscribe(),this._stopSubscription=null),this._earthSubscription&&(this._earthSubscription.closed||this._earthSubscription.unsubscribe(),this._earthSubscription=null),this._graphModeSubscription.unsubscribe(),this._graphModeSubscription=null,this._cacheSubscription.unsubscribe(),this._cacheSubscription=null,this._playingSubscription.unsubscribe(),this._playingSubscription=null,this._clearSubscription.unsubscribe(),this._clearSubscription=null,this._stateService.setSpeed(1),this._stateService.cutImages(),this._graphService.setGraphMode(eg.Spatial),this._setPlaying(!1))}_mapSpeed(t){const e=2*t-1;return Math.pow(10,e)-.2*e}_mapImagesAhead(t){return Math.round(Math.max(10,Math.min(50,8+6*t)))}_setPlaying(t){this._playing=t,this._playingSubject$.next(t)}_setSpeed(t){this._speed=t;const e=this._mapSpeed(this._speed);return this._imagesAhead=this._mapImagesAhead(e),e}}var Og,Fg;Bg.sequenceSpeed=.54,function(t){t[t.Hidden=0]="Hidden",t[t.Homogeneous=1]="Homogeneous",t[t.Cluster=2]="Cluster",t[t.ConnectedComponent=3]="ConnectedComponent",t[t.Sequence=4]="Sequence"}(Og||(Og={})),function(t){t[t.Hidden=0]="Hidden",t[t.Altitude=1]="Altitude",t[t.Flat=2]="Flat"}(Fg||(Fg={}));class Ng extends Sc{constructor(t){super(),this._originalSize=t.originalSize;const{cluster:e,color:i,scale:n,translation:r}=t;this._makeAttributes(e),this.material.size=n*this._originalSize,this.setColor(i),this.matrixAutoUpdate=!1,this.position.fromArray(r),this.updateMatrix(),this.updateMatrixWorld(!1)}dispose(){this.geometry.dispose(),this.material.dispose()}setColor(t){this.material.vertexColors=null==t,this.material.color=new jr(t),this.material.needsUpdate=!0}resize(t){this.material.size=t*this._originalSize,this.material.needsUpdate=!0}_makeAttributes(t){const e=[],i=[],n=t.points;for(const a in n){if(!n.hasOwnProperty(a))continue;const t=n[a];e.push(...t.coordinates);const r=t.color;i.push(r[0]),i.push(r[1]),i.push(r[2])}const r=this.geometry;r.setAttribute("position",new Wr(new Float32Array(e),3)),r.setAttribute("color",new Wr(new Float32Array(i),3))}}class Ug extends fc{constructor(t){super(),this._makeAttributes(t),this.matrixAutoUpdate=!1,this.updateMatrix(),this.updateMatrixWorld(!1)}dispose(){this.geometry.dispose(),this.material.dispose()}_makeAttributes(t){const e=t.slice();e.push(t[0]);let i=0;const n=new Float32Array(3*(t.length+1));for(const r of e)n[i++]=r[0],n[i++]=r[1],n[i++]=r[2];this.geometry.setAttribute("position",new Wr(n,3))}}function $g(t,e){return t===e}function Vg(t){const e=function(t){return Math.pow(2,t)}(t),i=e/2;return{min:[-i,-i,-i],max:[i,i,i]}}class jg{constructor(t,e,i,n){this.level=t,this.leafLevel=e,this.boundingBox=i,this.parent=n,this.children=[],this.items=[],n&&n.children.push(this)}get isEmpty(){return!(this.children.length||this.items.length)}add(t){const e=this;if(!e.boundingBox.containsPoint(t.position))throw new Error("Item not contained in node");if($g(e.level,e.leafLevel))return e.items.push(t),this;for(const i of e.children)if(i.boundingBox.containsPoint(t.position))return i.add(t);for(const i of e._generateBoundingBoxes())if(i.containsPoint(t.position)){return new jg(e.level-1,e.leafLevel,i,e).add(t)}throw new Error("Item not contained in children")}intersect(t,e,i){if(t.intersectBox(this.boundingBox,e))if($g(this.level,this.leafLevel))i.push(this);else for(const n of this.children)n.intersect(t,e,i)}remove(t){const e=this.items.indexOf(t);if(e<0)throw new Error(`Item does not exist ${t.uuid}`);this.items.splice(e,1)}traverse(){const t=this;if(!t.isEmpty)return;const e=t.parent;if(!e)return;const i=e.children.indexOf(t);if(i<0)throw new Error("Corrupt octree");e.children.splice(i,1),this.parent=null,e.traverse()}_generateBoundingBoxes(){const t=this.boundingBox.min,e=(this.boundingBox.max.x-t.x)/2,i=[[t.x,t.y+e,t.z+e],[t.x+e,t.y+e,t.z+e],[t.x,t.y,t.z+e],[t.x+e,t.y,t.z+e],[t.x,t.y+e,t.z],[t.x+e,t.y+e,t.z],[t.x,t.y,t.z],[t.x+e,t.y,t.z]],n=[];for(const[r,a,o]of i)n.push(new En(new bn(r,a,o),new bn(r+e,a+e,o+e)));return n}}class qg{constructor(t,e){if(this.rootLevel=t,this.leafLevel=e,e>t)throw new Error;this._index=new Map,this._root=this._makeRoot()}get root(){return this._root}add(t){if(!this.root.boundingBox.containsPoint(t.position))return void console.warn(`Object outside bounding box ${t.uuid}`);const e=this._root.add(t);this._index.set(t.uuid,e)}has(t){return this._index.has(t.uuid)}intersect(t){const e=[],i=new bn;return this._root.intersect(t,i,e),e.map((t=>t.items)).reduce(((t,e)=>(t.push(...e),t)),[])}reset(){this._root=this._makeRoot(),this._index.clear()}remove(t){if(!this.has(t))throw new Error(`Frame does not exist ${t.uuid}`);const e=this._index.get(t.uuid);e.remove(t),e.traverse(),this._index.delete(t.uuid)}_makeRoot(){const t=this.rootLevel,e=Vg(t),i=new En((new bn).fromArray(e.min),(new bn).fromArray(e.max));return new jg(t,this.leafLevel,i)}}class Gg{constructor(t,e){this._objects=[],this._objectImageMap=new Map,this._octree=null!==t&&void 0!==t?t:new qg(14,6),this._raycaster=null!==e&&void 0!==e?e:new Mh,this._interactiveLayer=1,this._raycaster=e||new Mh(void 0,void 0,1,1e4),this._lineThreshold=.2,this._largeLineThreshold=.4,this._raycaster.params.Line.threshold=this._lineThreshold,this._raycaster.layers.set(this._interactiveLayer)}get interactiveLayer(){return this._interactiveLayer}get octree(){return this._octree}get raycaster(){return this._raycaster}add(t,e){const i=t.uuid;this._objectImageMap.set(i,e),this._objects.push(t),this._octree.add(t)}intersectObjects(t,e){this._raycaster.setFromCamera((new sn).fromArray(t),e);const i=this._octree.intersect(this.raycaster.ray),n=this._raycaster.intersectObjects(i),r=this._objectImageMap;for(const a of n){const t=a.object.uuid;if(r.has(t))return r.get(t)}return null}remove(t){const e=this._objects,i=e.indexOf(t);if(-1!==i){const n=e.splice(i,1);for(const t of n)this._objectImageMap.delete(t.uuid);this._octree.remove(t)}else console.warn("Object does not exist")}resetIntersectionThreshold(t){this._raycaster.params.Line.threshold=t?this._largeLineThreshold:this._lineThreshold}}class Hg extends fc{constructor(t){super(t.geometry,t.material);const e=t.mode,i=t.originalOrigin,n=t.transform.unprojectBasic([0,0],0);this._relativeAltitude=i[2]-n[2],this._makeAttributes(n,i,e),this.matrixAutoUpdate=!1,this.position.fromArray(n),this.updateMatrix(),this.updateMatrixWorld(!1)}dispose(){this.geometry.dispose(),this.material.dispose()}setMode(t){const e=this.geometry.attributes.position;e.array[5]=this._modeToAltitude(t),e.needsUpdate=!0,this.geometry.computeBoundingSphere()}_makeAttributes(t,e,i){const n=new Float32Array(6);n[0]=0,n[1]=0,n[2]=0,n[3]=e[0]-t[0],n[4]=e[1]-t[1],n[5]=this._modeToAltitude(i);const r=new Wr(n,3);this.geometry.setAttribute("position",r),r.needsUpdate=!0,this.geometry.computeBoundingSphere()}_modeToAltitude(t){return t===Fg.Altitude?this._relativeAltitude:0}}class Wg extends _c{constructor(t){super(t.geometry,t.material);const e=t.color,i=t.size,n=t.scale,r=t.transform,a=r.unprojectBasic([0,0],0),o=this._makePositions(i,r,a);this._makeAttributes(o,e),this.geometry.computeBoundingSphere(),this.geometry.computeBoundingBox(),this.matrixAutoUpdate=!1,this.position.fromArray(a),this.scale.set(n,n,n),this.updateMatrix(),this.updateMatrixWorld(!1)}dispose(){this.geometry.dispose(),this.material.dispose()}setColor(t){return this._updateColorAttribute(t),this}resize(t){return this.scale.set(t,t,t),this.updateMatrix(),this.updateMatrixWorld(!1),this}_makeAttributes(t,e){const i=this.geometry,n=new Wr(new Float32Array(t),3);i.setAttribute("position",n),n.needsUpdate=!0;const r=new Wr(new Float32Array(t.length),3);i.setAttribute("color",r),this._updateColorAttribute(e)}_updateColorAttribute(t){const[e,i,n]=new jr(t).toArray(),r=this.geometry.attributes.color,a=r.array,o=a.length;let s=0;for(let l=0;l<o;l++)a[s++]=e,a[s++]=i,a[s++]=n;r.needsUpdate=!0}}class Zg extends Wg{_makePositions(t,e,i){const n=[];n.push(...this._makeAxis(t,e,i)),n.push(...this._makeLat(.5,10,t,e,i));for(const r of[0,.25,.5,.75])n.push(...this._makeLng(r,10,t,e,i));return n}_makeAxis(t,e,i){const n=e.unprojectBasic([.5,1],.8*t),r=e.unprojectBasic([.5,0],1.2*t);return[n[0]-i[0],n[1]-i[1],n[2]-i[2],r[0]-i[0],r[1]-i[1],r[2]-i[2]]}_makeLat(t,e,i,n,r){const a=.8*i,[o,s,l]=r,c=[],u=n.unprojectBasic([0,t],a);u[0]-=o,u[1]-=s,u[2]-=l,c.push(...u);for(let h=1;h<=e;h++){const i=n.unprojectBasic([h/e,t],a);i[0]-=o,i[1]-=s,i[2]-=l,c.push(...i,...i)}return c.push(...u),c}_makeLng(t,e,i,n,r){const a=.8*i,[o,s,l]=r,c=[],u=n.unprojectBasic([t,0],a);u[0]-=o,u[1]-=s,u[2]-=l,c.push(...u);for(let h=0;h<=e;h++){const i=n.unprojectBasic([t,h/e],a);i[0]-=o,i[1]-=s,i[2]-=l,c.push(...i,...i)}return c.push(...u),c}}class Yg extends Wg{_makePositions(t,e,i){const n=[];return n.push(...this._makeDiags(t,e,i)),n.push(...this._makeFrame(t,8,e,i)),n}_makeDiags(t,e,i){const[n,r,a]=i,o=[0,0,0],s=[];for(const l of[[0,0],[1,0],[1,1],[0,1]]){const i=e.unprojectBasic(l,t);i[0]-=n,i[1]-=r,i[2]-=a,s.push(...o,...i)}return s}_makeFrame(t,e,i,n){const r=[];r.push(...this._subsample([0,1],[0,0],e)),r.push(...this._subsample([0,0],[1,0],e)),r.push(...this._subsample([1,0],[1,1],e));const[a,o,s]=n,l=[];for(const c of r){const e=i.unprojectBasic(c,t);e[0]-=a,e[1]-=o,e[2]-=s,l.push(...e)}return l}_interpolate(t,e,i){return t+i*(e-t)}_subsample(t,e,i){if(i<1)return[t,e];const n=[];n.push(t);for(let r=0;r<=i;r++){const a=[];for(let n=0;n<3;n++)a.push(this._interpolate(t[n],e[n],r/(i+1)));n.push(a),n.push(a)}return n.push(e),n}}function Xg(t,e,i){const[n,r,a]=e,[o,s,l]=Nh(n,r,a,i.lng,i.lat,i.alt);return Fh(o,s,l,t.lng,t.lat,t.alt)}class Kg{constructor(t,e,i){this.id=t,this._scene=e,this._intersection=i,this.cameras=new Sr,this.keys=[],this._positionLines={},this._positions=new Sr,this._cameraFrames={},this._clusters=new Map,this._connectedComponents=new Map,this._sequences=new Map,this._props={},this.clusterVisibles={},this._frameMaterial=new lc({fog:!1,vertexColors:!0}),this._positionMaterial=new lc({fog:!1,color:16711680}),this._scene.add(this.cameras,this._positions)}addImage(t){const e=t.image,i=e.id;if(this.hasImage(i))throw new Error(`Image exists ${i}`);const n=t.idMap.ccId;this._connectedComponents.has(n)||this._connectedComponents.set(n,[]);const r=t.idMap.clusterId;this._clusters.has(r)||this._clusters.set(r,[]);const a=t.idMap.sequenceId;this._sequences.has(a)||this._sequences.set(a,[]),this._props[i]={image:e,ids:{ccId:n,clusterId:r,sequenceId:a}},this.keys.push(i)}applyCameraColor(t,e){this._cameraFrames[t].setColor(e)}applyCameraSize(t){for(const e of this.cameras.children)e.resize(t)}applyFilter(t){var e;const i=this.clusterVisibles;for(const o in i)i.hasOwnProperty(o)&&(i[o]=!1);const n=this._cameraFrames,r=this._positionLines,a=this._intersection.interactiveLayer;for(const o of Object.values(this._props)){const s=o.image,l=t(s),c=s.id;r[c].visible=l;const u=n[c];this._setCameraVisibility(u,l,a),i[e=o.ids.clusterId]||(i[e]=l)}}applyPositionMode(t){this._positions.visible=t!==Fg.Hidden;for(const e of this._positions.children)e.setMode(t)}dispose(){this._disposeCameras(),this._disposePositions(),this._scene=null,this._intersection=null}getCamerasByMode(t){if(t===Og.Cluster)return this._clusters;if(t===Og.ConnectedComponent)return this._connectedComponents;if(t===Og.Sequence)return this._sequences;const e=Og[Og.Homogeneous],i=new Map;return i.set(e,this.cameras.children),i}getColorId(t,e){const i=this._props[t],n=Og;switch(e){case n.Cluster:return i.ids.clusterId;case n.ConnectedComponent:return i.ids.ccId;case n.Sequence:return i.ids.sequenceId;default:return n[n.Homogeneous]}}hasImage(t){return-1!==this.keys.indexOf(t)}resetReference(t,e){const i=this._cameraFrames;for(const r in i){if(!i.hasOwnProperty(r))continue;const n=i[r];n.position.fromArray(Xg(t,n.position.toArray(),e))}const n=this._positionLines;for(const r in n){if(!n.hasOwnProperty(r))continue;const i=n[r];i.position.fromArray(Xg(t,i.position.toArray(),e))}}visualize(t){var e,i;const n=t.id,r=t.visible,a=t.transform,o={color:t.color,material:this._frameMaterial,scale:t.scale,size:t.maxSize,transform:a},s=Qh(a.cameraType)?new Zg(o):new Yg(o),l=this._intersection.interactiveLayer;this._setCameraVisibility(s,r,l),this.cameras.add(s),this._cameraFrames[n]=s;this._intersection.add(s,n);const c=this._props[n].ids;(e=this.clusterVisibles)[i=c.clusterId]||(e[i]=r),this._connectedComponents.get(c.ccId).push(s),this._clusters.get(c.clusterId).push(s),this._sequences.get(c.sequenceId).push(s);const u={material:this._positionMaterial,mode:t.positionMode,originalOrigin:t.originalPosition,transform:a},h=new Hg(u);h.visible=r,this._positions.add(h),this._positionLines[n]=h}_disposeCameras(){const t=this._intersection,e=this.cameras;for(const i of e.children.slice())i.dispose(),t.remove(i),e.remove(i);this._scene.remove(this.cameras)}_disposePositions(){const t=this._positions;for(const e of t.children.slice())e.dispose(),t.remove(e);this._scene.remove(this._positions)}_setCameraVisibility(t,e,i){t.visible=e,e?t.layers.enable(i):t.layers.disable(i)}}class Jg{constructor(){this._colors=new Map;const t=Og;this._colors.set(t[t.Homogeneous],"#FFFFFF")}getColor(t){const e=this._colors;return e.has(t)||e.set(t,this._randomColor()),e.get(t)}_randomColor(){return`hsl(${Math.floor(360*Math.random())}, 100%, 50%)`}}function Qg(t){return t!==Og.Hidden}var t_;!function(t){t[t.Hidden=0]="Hidden",t[t.Original=1]="Original",t[t.Cluster=2]="Cluster"}(t_||(t_={}));class e_{constructor(t,e){this._rayNearScale=1.1,this._originalPointSize=2,this._originalCameraSize=2,this._imageCellMap=new Map,this._scene=e||new Rl,this._scene.autoUpdate=!1,this._intersection=new Gg,this._assets=new Jg,this._needsRender=!1,this._images={},this._cells={},this._cellClusters={},this._clusters={},this._cameraVisualizationMode=t.cameraVisualizationMode?t.cameraVisualizationMode:Og.Homogeneous,this._cameraSize=t.cameraSize,this._pointSize=t.pointSize,this._pointVisualizationMode=t.pointVisualizationMode?t.pointVisualizationMode:t_.Original,this._positionMode=t.originalPositionMode,this._cellsVisible=t.cellsVisible,this._hoveredId=null,this._selectedId=null,this._colors={hover:"#FF0000",select:"#FF8000"},this._filter=()=>!0}get needsRender(){return this._needsRender}get intersection(){return this._intersection}addCluster(t,e,i){if(this.hasCluster(t.id,i))return;const n=t.id;if(!(n in this._clusters)){this._clusters[n]={points:new Sr,cellIds:[]};const i=this._getClusterVisible(n),r=this._clusters[n],a=this._pointVisualizationMode===t_.Cluster?this._assets.getColor(n):null,o=new Ng({cluster:t,color:a,originalSize:this._originalPointSize,scale:this._pointSize,translation:e});r.points.visible=i,r.points.add(o),this._scene.add(r.points)}-1===this._clusters[n].cellIds.indexOf(i)&&this._clusters[n].cellIds.push(i),i in this._cellClusters||(this._cellClusters[i]={keys:[]}),-1===this._cellClusters[i].keys.indexOf(n)&&this._cellClusters[i].keys.push(n),this._needsRender=!0}addImage(t,e,i,n){var r,a,o;const s=t.id,l={clusterId:null!==(r=t.clusterId)&&void 0!==r?r:"NO_CLUSTER_ID",sequenceId:null!==(a=t.sequenceId)&&void 0!==a?a:"NO_SEQUENCE_ID",ccId:null!==(o=t.mergeId)&&void 0!==o?o:"NO_MERGE_ID"};if(!(n in this._images)){const t=new Kg(n,this._scene,this._intersection);t.cameras.visible=Qg(this._cameraVisualizationMode),t.applyPositionMode(this._positionMode),this._images[n]=t}const c=this._images[n];if(c.hasImage(s))return;c.addImage({idMap:l,image:t});const u=c.getColorId(s,this._cameraVisualizationMode),h=this._assets.getColor(u),p=this._filter(t);if(c.visualize({id:s,color:h,positionMode:this._positionMode,scale:this._cameraSize,transform:e,visible:p,maxSize:this._originalCameraSize,originalPosition:i}),this._imageCellMap.set(s,n),s===this._selectedId&&this._highlight(s,this._colors.select,this._cameraVisualizationMode),l.clusterId in this._clusters){const t=this._getClusterVisible(l.clusterId);this._clusters[l.clusterId].points.visible=t}this._needsRender=!0}addCell(t,e){if(this.hasCell(e))return;const i=new Ug(t);this._cells[e]=new Sr,this._cells[e].visible=this._cellsVisible,this._cells[e].add(i),this._scene.add(this._cells[e]),this._needsRender=!0}deactivate(){this._filter=()=>!0,this._selectedId=null,this._hoveredId=null,this.uncache()}hasCluster(t,e){return t in this._clusters&&-1!==this._clusters[t].cellIds.indexOf(e)}hasCell(t){return t in this._cells}hasImage(t,e){return e in this._images&&this._images[e].hasImage(t)}render(t,e){e.render(this._scene,t),this._needsRender=!1}resetReference(t,e){const i=this._clusters;for(const a in i){if(!i.hasOwnProperty(a))continue;const n=i[a];n.points.position.fromArray(Xg(t,n.points.position.toArray(),e))}const n=this._cells;for(const a in n){if(!n.hasOwnProperty(a))continue;const i=n[a];i.position.fromArray(Xg(t,i.position.toArray(),e))}const r=this._images;for(const a in r){if(!r.hasOwnProperty(a))continue;r[a].resetReference(t,e)}}setCameraSize(t){if(Math.abs(t-this._cameraSize)<.001)return;const e=this._images;for(const i of Object.keys(e))e[i].applyCameraSize(t);this._intersection.raycaster.near=this._getNear(t),this._cameraSize=t,this._needsRender=!0}setFilter(t){this._filter=t;const e={};for(const n of Object.values(this._images)){n.applyFilter(t);const i=n.clusterVisibles;for(const t in i)i.hasOwnProperty(t)&&(t in e||(e[t]=!1),e[t]||(e[t]=i[t]))}const i=this._pointVisualizationMode!==t_.Hidden;for(const n in e){if(!e.hasOwnProperty(n))continue;e[n]&&(e[n]=i);const t=e[n];n in this._clusters&&(this._clusters[n].points.visible=t)}this._needsRender=!0}setHoveredImage(t){if(null!=t&&!this._imageCellMap.has(t))throw new Yh(`Image does not exist: ${t}`);this._hoveredId!==t&&(this._needsRender=!0,null!=this._hoveredId&&(this._hoveredId===this._selectedId?this._highlight(this._hoveredId,this._colors.select,this._cameraVisualizationMode):this._resetCameraColor(this._hoveredId)),this._highlight(t,this._colors.hover,this._cameraVisualizationMode),this._hoveredId=t)}setNavigationState(t){this._intersection.resetIntersectionThreshold(t)}setPointSize(t){if(Math.abs(t-this._pointSize)<.001)return;const e=this._clusters;for(const i in e)if(e.hasOwnProperty(i))for(const n of e[i].points.children)n.resize(t);this._pointSize=t,this._needsRender=!0}setPointVisualizationMode(t){if(t!==this._pointVisualizationMode){this._pointVisualizationMode=t;for(const e in this._clusters){if(!this._clusters.hasOwnProperty(e))continue;const i=this._clusters[e];i.points.visible=this._getClusterVisible(e);for(const n of i.points.children){const i=t===t_.Cluster?this._assets.getColor(e):null;n.setColor(i)}}this._needsRender=!0}}setPositionMode(t){if(t!==this._positionMode){for(const e of Object.values(this._images))e.applyPositionMode(t);this._positionMode=t,this._needsRender=!0}}setSelectedImage(t){this._selectedId!==t&&(this._needsRender=!0,null!=this._selectedId&&this._resetCameraColor(this._selectedId),this._highlight(t,this._colors.select,this._cameraVisualizationMode),this._selectedId=t)}setCellVisibility(t){if(t!==this._cellsVisible){for(const e in this._cells)this._cells.hasOwnProperty(e)&&(this._cells[e].visible=t);this._cellsVisible=t,this._needsRender=!0}}setCameraVisualizationMode(t){if(t===this._cameraVisualizationMode)return;const e=Qg(t),i=this._assets;for(const n of Object.values(this._images)){n.cameras.visible=e;n.getCamerasByMode(t).forEach(((t,e)=>{const n=i.getColor(e);for(const i of t)i.setColor(n)}))}this._highlight(this._hoveredId,this._colors.hover,t),this._highlight(this._selectedId,this._colors.select,t),this._cameraVisualizationMode=t,this._needsRender=!0}uncache(t){for(const e of Object.keys(this._cellClusters))t&&-1!==t.indexOf(e)||this._disposeReconstruction(e);for(const e of Object.keys(this._images)){if(t&&-1!==t.indexOf(e))continue;const i=this._imageCellMap,n=this._images[e].keys;for(const t of n)i.delete(t);this._images[e].dispose(),delete this._images[e]}for(const e of Object.keys(this._cells))t&&-1!==t.indexOf(e)||this._disposeCell(e);this._needsRender=!0}_getClusterVisible(t){if(this._pointVisualizationMode===t_.Hidden)return!1;let e=!1;for(const i of Object.values(this._images)){const n=i.clusterVisibles;t in n&&(e||(e=n[t]))}return e}_disposePoints(t){for(const e of this._cellClusters[t].keys){if(!(e in this._clusters))continue;const i=this._clusters[e].cellIds.indexOf(t);if(-1!==i&&(this._clusters[e].cellIds.splice(i,1),!(this._clusters[e].cellIds.length>0))){for(const t of this._clusters[e].points.children.slice())t.dispose();this._scene.remove(this._clusters[e].points),delete this._clusters[e]}}}_disposeReconstruction(t){this._disposePoints(t),delete this._cellClusters[t]}_disposeCell(t){const e=this._cells[t];for(const i of e.children.slice())i.dispose(),e.remove(i);this._scene.remove(e),delete this._cells[t]}_getNear(t){const e=this._rayNearScale*this._originalCameraSize*t;return Math.max(1,e)}_resetCameraColor(t){const e=this._imageCellMap;if(null==t||!e.has(t))return;const i=e.get(t),n=this._images[i],r=n.getColorId(t,this._cameraVisualizationMode),a=this._assets.getColor(r);n.applyCameraColor(t,a)}_highlight(t,e,i){const n=this._imageCellMap;if(null==t||!n.has(t))return;const r=n.get(t);e=i===Og.Homogeneous?e:"#FFFFFF",this._images[r].applyCameraColor(t,e)}}class i_{constructor(t,e){this._graphService=t,this._data=e,this._cells={},this._cacheRequests={},this._clusters={},this._clusterCells={},this._cellClusters={},this._cachingCells$={},this._cachingClusters$={}}cacheClusters$(t){if(!this.hasCell(t))throw new Error("Cannot cache reconstructions of a non-existing cell.");if(this.hasClusters(t))throw new Error("Cannot cache reconstructions that already exists.");if(this.isCachingClusters(t))return this._cachingClusters$[t];const e=this.getCell(t).filter((t=>!!t.clusterId&&!!t.clusterUrl)).map((t=>({key:t.clusterId,url:t.clusterUrl}))),i=Array.from(new Map(e.map((t=>[t.key,t]))).values());let n;this._cellClusters[t]=i,this._cacheRequests[t]=[];const r=new Promise(((t,e)=>{n=e}));return this._cacheRequests[t].push(n),this._cachingClusters$[t]=this._cacheClusters$(i,t,r).pipe(Ge((()=>{t in this._cachingClusters$&&delete this._cachingClusters$[t],t in this._cacheRequests&&delete this._cacheRequests[t]})),Ke(),lt()),this._cachingClusters$[t]}cacheCell$(t){if(this.hasCell(t))throw new Error("Cannot cache cell that already exists.");return this.isCachingCell(t)||(this._cachingCells$[t]=this._graphService.cacheCell$(t).pipe(Re((t=>(console.error(t),Et()))),Ce((()=>!(t in this._cells))),ci((e=>{this._cells[t]=[],this._cells[t].push(...e),delete this._cachingCells$[t]})),Ge((()=>{t in this._cachingCells$&&delete this._cachingCells$[t]})),Ke(),lt())),this._cachingCells$[t]}isCachingClusters(t){return t in this._cachingClusters$}isCachingCell(t){return t in this._cachingCells$}hasClusters(t){if(t in this._cachingClusters$||!(t in this._cellClusters))return!1;for(const e of this._cellClusters[t])if(!(e.key in this._clusters))return!1;return!0}hasCell(t){return!(t in this._cachingCells$)&&t in this._cells}getClusters(t){return t in this._cellClusters?this._cellClusters[t].map((t=>this._clusters[t.key])).filter((t=>!!t)):[]}getCell(t){return t in this._cells?this._cells[t]:[]}uncache(t){for(let e of Object.keys(this._cacheRequests))if(!t||-1===t.indexOf(e)){for(const t of this._cacheRequests[e])t();delete this._cacheRequests[e]}for(let e of Object.keys(this._cellClusters))if(!t||-1===t.indexOf(e)){for(const t of this._cellClusters[e]){if(!(t.key in this._clusterCells))continue;const i=this._clusterCells[t.key].indexOf(e);-1!==i&&(this._clusterCells[t.key].splice(i,1),this._clusterCells[t.key].length>0||(delete this._clusterCells[t.key],delete this._clusters[t.key]))}delete this._cellClusters[e]}for(let e of Object.keys(this._cells))t&&-1!==t.indexOf(e)||delete this._cells[e]}updateCell$(t){if(!this.hasCell(t))throw new Error("Cannot update cell that does not exists.");return this._graphService.cacheCell$(t).pipe(Re((t=>(console.error(t),Et()))),Ce((()=>t in this._cells)),ci((e=>{this._cells[t]=[],this._cells[t].push(...e)})),Ke(),lt())}updateClusters$(t){if(!this.hasCell(t))throw new Error("Cannot update reconstructions of a non-existing cell.");if(!this.hasClusters(t))throw new Error("Cannot update reconstructions for cell that is not cached.");const e=this.getCell(t).filter((t=>!!t.clusterId&&!!t.clusterUrl)).map((t=>({key:t.clusterId,url:t.clusterUrl}))),i=Array.from(new Map(e.map((t=>[t.key,t]))).values()).filter((t=>!(t.key in this._clusters)));return this._cellClusters[t].push(...i),this._cacheClusters$(i,t,null)}_cacheClusters$(t,e,i){return Ft(t).pipe(fe((t=>this._hasCluster(t.key)?Zt(this._getCluster(t.key)):this._getCluster$(t.url,t.key,i).pipe(Re((t=>(t instanceof zm||console.error(t),Et()))))),6),Ce((()=>e in this._cellClusters)),ci((t=>{this._hasCluster(t.id)||(this._clusters[t.id]=t),t.id in this._clusterCells||(this._clusterCells[t.id]=[]),-1===this._clusterCells[t.id].indexOf(e)&&this._clusterCells[t.id].push(e)})))}_getCluster(t){return this._clusters[t]}_getCluster$(t,e,i){return nt.create((n=>{this._data.getCluster(t,i).then((t=>{t.id=e,n.next(t),n.complete()}),(t=>{n.error(t)}))}))}_hasCluster(t){return t in this._clusters}}function n_(t,e,i){const n=new Set;return n.add(t),r_(n,[t],0,e,i),Array.from(n)}function r_(t,e,i,n,r){if(i>=n)return;const a=[];for(const s of e){const t=r.getAdjacent(s);a.push(...t)}const o=[];for(const s of a)t.has(s)||(t.add(s),o.push(s));r_(t,o,i+1,n,r)}class a_ extends Mm{constructor(t,e,i){super(t,e,i),this._cache=new i_(i.graphService,i.api.data),this._scene=new e_(this._getDefaultConfiguration()),this._viewportCoords=new Am,this._spatial=new Kh}getFrameIdAt(t){return new Promise(((e,i)=>{this._container.renderService.renderCamera$.pipe(He(),ee((e=>{const i=this._viewportCoords.canvasToViewport(t[0],t[1],this._container.container);return this._scene.intersection.intersectObjects(i,e.perspective)}))).subscribe((t=>{e(t)}),(t=>{i(t)}))}))}_activate(){this._navigator.cacheService.configure({cellDepth:3});const t=this._subscriptions;t.push(this._navigator.stateService.reference$.pipe(Xe()).subscribe((([t,e])=>{this._scene.resetReference(e,t)}))),t.push(this._navigator.graphService.filter$.subscribe((t=>{this._scene.setFilter(t)})));const e=this._container.renderService.bearing$.pipe(ee((t=>6*Math.floor(t/6))),Ue(),Je(1),lt()),i=this._navigator.stateService.currentImage$.pipe(ee((t=>this._navigator.api.data.geometry.lngLatToCellId(t.originalLngLat))),Ue(),Je(1),lt()),n=this._configuration$.pipe(ee((t=>this._spatial.clamp(t.cellGridDepth,1,3))),Ue(),Je(1),lt()),r=ue(this._navigator.playService.playing$,this._navigator.playService.speed$).pipe(ee((([t,e])=>t&&e>Bg.sequenceSpeed)),Ue(),Je(1),lt()),a=this._navigator.stateService.state$.pipe(ee((t=>function(t){return t===tg.Custom||t===tg.Earth}(t))),Ue(),Je(1),lt());t.push(a.subscribe((t=>{this._scene.setNavigationState(t)})));const o=ue(a,r,e,n,this._navigator.stateService.currentImage$).pipe(Ue((([t,e,i,n,r],[a,o,s,l,c])=>{if(t!==a)return!1;const u=r.id===c.id&&e===o&&n===l;return t?u:u&&i===s})),De((([t,e,i,n,r])=>{if(t){const t=this._navigator.api.data.geometry,i=t.lngLatToCellId(r.originalLngLat);return Zt(e?[i]:n_(i,n,t))}const a=e?30:90;return Zt(this._cellsInFov(r,i,a))})),oi((t=>Ft(t).pipe(fe((t=>(this._cache.hasCell(t)?Zt(this._cache.getCell(t)):this._cache.cacheCell$(t)).pipe(ee((e=>({id:t,images:e}))))),6)))));t.push(o.pipe(ui(this._navigator.stateService.reference$)).subscribe((([t,e])=>{this._scene.hasCell(t.id)||this._scene.addCell(this._cellToTopocentric(t.id,e),t.id)}))),t.push(o.pipe(ui(this._navigator.stateService.reference$)).subscribe((([t,e])=>{this._addSceneImages(t,e)}))),t.push(o.pipe(De((t=>{const e=t.id;let i;return i=this._cache.hasClusters(e)?Ft(this._cache.getClusters(e)):this._cache.isCachingClusters(e)?this._cache.cacheClusters$(e).pipe(Ze(null,{}),oi((()=>Ft(this._cache.getClusters(e))))):this._cache.hasCell(e)?this._cache.cacheClusters$(e):Et(),ue(Zt(e),i)})),ui(this._navigator.stateService.reference$)).subscribe((([[t,e],i])=>{this._scene.hasCluster(e.id,t)||this._scene.addCluster(e,this._computeTranslation(e,i),t)}))),t.push(this._configuration$.pipe(ee((t=>{var e;t.cameraSize=this._spatial.clamp(t.cameraSize,.01,1),t.pointSize=this._spatial.clamp(t.pointSize,.01,1);const i=t.pointsVisible?null!==(e=t.pointVisualizationMode)&&void 0!==e?e:t_.Original:t_.Hidden;return{cameraSize:t.cameraSize,cameraVisualizationMode:t.cameraVisualizationMode,cellsVisible:t.cellsVisible,originalPositionMode:t.originalPositionMode,pointSize:t.pointSize,pointVisualizationMode:i}})),Ue(((t,e)=>t.cameraSize===e.cameraSize&&t.cameraVisualizationMode===e.cameraVisualizationMode&&t.cellsVisible===e.cellsVisible&&t.originalPositionMode===e.originalPositionMode&&t.pointSize===e.pointSize&&t.pointVisualizationMode===e.pointVisualizationMode))).subscribe((t=>{this._scene.setCameraSize(t.cameraSize);const e=t.cameraVisualizationMode;this._scene.setCameraVisualizationMode(e),this._scene.setCellVisibility(t.cellsVisible),this._scene.setPointSize(t.pointSize);const i=t.pointVisualizationMode;this._scene.setPointVisualizationMode(i);const n=t.originalPositionMode;this._scene.setPositionMode(n)}))),t.push(ue(i,n).subscribe((([t,e])=>{const i=n_(t,e,this._navigator.api.data.geometry);this._scene.uncache(i),this._cache.uncache(i)}))),t.push(this._navigator.playService.playing$.pipe(oi((t=>t?Et():this._container.mouseService.dblClick$)),ui(this._container.renderService.renderCamera$),oi((([t,e])=>{const i=this._container.container,[n,r]=this._viewportCoords.canvasPosition(t,i),a=this._viewportCoords.canvasToViewport(n,r,i),o=this._scene.intersection.intersectObjects(a,e.perspective);return o?this._navigator.moveTo$(o).pipe(Re((()=>Et()))):Et()}))).subscribe());const s=ue(this._configuration$,this._navigator.stateService.state$).pipe(ee((([t,e])=>(t.cameraSize=this._spatial.clamp(t.cameraSize,.01,1),{size:t.cameraSize,visible:Qg(t.cameraVisualizationMode),state:e}))),Ue(((t,e)=>t.size===e.size&&t.visible===e.visible&&t.state===e.state))),l=this._container.mouseService.mouseMove$.pipe(Je(1),lt());t.push(l.subscribe());const c=Ee(this._container.mouseService.mouseEnter$,this._container.mouseService.mouseLeave$,this._container.mouseService.windowBlur$);t.push(ue(this._navigator.playService.playing$,c,a,this._navigator.graphService.filter$).pipe(oi((([t,e])=>t||"pointerenter"!==e.type?ue(Zt(e),Zt(null),Zt(null)):ue(_e(l.pipe(Ne(1)),this._container.mouseService.mouseMove$),this._container.renderService.renderCamera$,s)))).subscribe((([t,e])=>{if("pointermove"!==t.type)return void this._scene.setHoveredImage(null);const i=this._container.container,[n,r]=this._viewportCoords.canvasPosition(t,i),a=this._viewportCoords.canvasToViewport(n,r,i),o=this._scene.intersection.intersectObjects(a,e.perspective);this._scene.setHoveredImage(o)}))),t.push(this._navigator.stateService.currentId$.subscribe((t=>{this._scene.setSelectedImage(t)}))),t.push(this._navigator.stateService.currentState$.pipe(ee((t=>{const e=this._scene;return{name:this._name,renderer:{frameId:t.id,needsRender:e.needsRender,render:e.render.bind(e),pass:Um.Opaque}}}))).subscribe(this._container.glRenderer.render$));const u=this._navigator.graphService.dataAdded$.pipe(Ce((t=>this._cache.hasCell(t))),fe((t=>this._cache.updateCell$(t).pipe(ee((e=>({id:t,images:e}))),ui(this._navigator.stateService.reference$)))),Ke(),lt());t.push(u.subscribe((([t,e])=>{this._addSceneImages(t,e)}))),t.push(u.pipe(De((([t])=>{const e=t.id,i=this._cache;let n;return n=i.hasClusters(e)?i.updateClusters$(e):i.isCachingClusters(e)?this._cache.cacheClusters$(e).pipe(Ze(null,{}),oi((()=>Ft(i.updateClusters$(e))))):Et(),ue(Zt(e),n)})),ui(this._navigator.stateService.reference$)).subscribe((([[t,e],i])=>{this._scene.hasCluster(e.id,t)||this._scene.addCluster(e,this._computeTranslation(e,i),t)})))}_deactivate(){this._subscriptions.unsubscribe(),this._cache.uncache(),this._scene.deactivate(),this._navigator.cacheService.configure()}_getDefaultConfiguration(){return{cameraSize:.1,cameraVisualizationMode:Og.Homogeneous,cellGridDepth:1,originalPositionMode:Fg.Hidden,pointSize:.1,pointsVisible:!0,pointVisualizationMode:t_.Original,cellsVisible:!1}}_addSceneImages(t,e){const i=t.id,n=t.images;for(const r of n)this._scene.hasImage(r.id,i)||this._scene.addImage(r,this._createTransform(r,e),this._computeOriginalPosition(r,e),i)}_cellsInFov(t,e,i){const n=this._spatial,r=this._navigator.api.data.geometry,a=r.lngLatToCellId(t.originalLngLat),o=[a],s=i/2,l=r.getAdjacent(a);for(const c of l){const i=r.getVertices(c);for(const r of i){const[i,a]=Fh(r.lng,r.lat,0,t.lngLat.lng,t.lngLat.lat,0),l=Math.atan2(a,i),u=n.radToDeg(n.azimuthalToBearing(l));Math.abs(u-e)<s&&o.push(c)}}return o}_computeOriginalPosition(t,e){return Fh(t.originalLngLat.lng,t.originalLngLat.lat,null!=t.originalAltitude?t.originalAltitude:t.computedAltitude,e.lng,e.lat,e.alt)}_cellToTopocentric(t,e){const i=this._navigator.api.data.geometry.getVertices(t).map((t=>Fh(t.lng,t.lat,-2,e.lng,e.lat,e.alt)));return i}_computeTranslation(t,e){return Fh(t.reference.lng,t.reference.lat,t.reference.alt,e.lng,e.lat,e.alt)}_createTransform(t,e){const i=ep({alt:t.computedAltitude,lat:t.lngLat.lat,lng:t.lngLat.lng},t.rotation,e);return new zg(t.exifOrientation,t.width,t.height,t.scale,t.rotation,i,void 0,void 0,t.cameraParameters,t.cameraType)}}a_.componentName="spatial";class o_{constructor(){this._notifyChanged$=new ht}get changed$(){return this._notifyChanged$}}class s_ extends Yh{constructor(t){super(null!=t?t:"The provided geometry value is incorrect"),Object.setPrototypeOf(this,s_.prototype),this.name="GeometryTagError"}}class l_ extends o_{constructor(t){super();if(t.length<2)throw new s_("A points geometry must have two or more positions.");this._points=[];for(const e of t){if(e[0]<0||e[0]>1||e[1]<0||e[1]>1)throw new s_("Basic coordinates of points must be on the interval [0, 1].");this._points.push(e.slice())}}get points(){return this._points}addPoint2d(t){const e=[Math.max(0,Math.min(1,t[0])),Math.max(0,Math.min(1,t[1]))];this._points.push(e),this._notifyChanged$.next(this)}getPoint2d(t){return this._points[t].slice()}removePoint2d(t){if(t<0||t>=this._points.length||this._points.length<3)throw new s_("Index for removed point must be valid.");this._points.splice(t,1),this._notifyChanged$.next(this)}setVertex2d(t,e,i){this.setPoint2d(t,e,i)}setPoint2d(t,e,i){const n=[Math.max(0,Math.min(1,e[0])),Math.max(0,Math.min(1,e[1]))];this._points[t]=n,this._notifyChanged$.next(this)}getPoints3d(t){return this._getPoints3d(this._points,t)}getPoint3d(t,e){return e.unprojectBasic(this._points[t],200)}getPoints2d(){return this._points.slice()}getCentroid2d(t){if(!t)throw new s_("Get centroid must be called with a transform for points geometries.");const[e,i,n,r]=this.getRect2d(t);return[e<n?(e+n)/2:(e+n+1)/2%1,(i+r)/2]}getCentroid3d(t){let e=this.getCentroid2d();return t.unprojectBasic(e,200)}getRect2d(t){let e=1,i=0,n=1,r=0;const a=this._points;for(const o of a)o[0]<e&&(e=o[0]),o[0]>i&&(i=o[0]),o[1]<n&&(n=o[1]),o[1]>r&&(r=o[1]);if(Qh(t.cameraType)){const t=[];for(let e=0;e<a.length;e++)t[e]=e;t.sort(((t,e)=>a[t][0]<a[e][0]?-1:a[t][0]>a[e][0]?1:t<e?-1:1));let n=a[t[0]][0]+1-a[t[t.length-1]][0],r=0;for(let e=0;e<t.length-1;e++){const i=t[e],o=t[e+1],s=a[o][0]-a[i][0];s>n&&(n=s,r=e+1)}r>0&&(e=a[t[r]][0],i=a[t[r-1]][0])}return[e,n,i,r]}setCentroid2d(t,e){throw new Error("Not implemented")}_getPoints3d(t,e){return t.map((t=>e.unprojectBasic(t,200)))}}class c_{constructor(t,e,i){this._geometry=t,this._transform=e,this._viewportCoords=i||new Am,this._aborted$=new ht,this._created$=new ht,this._glObjectsChanged$=new ht,this._geometryChangedSubscription=this._geometry.changed$.subscribe((()=>{this._onGeometryChanged(),this._glObjectsChanged$.next(this)}))}get geometry(){return this._geometry}get glObjects(){return this._glObjects}get aborted$(){return this._aborted$}get created$(){return this._created$}get glObjectsChanged$(){return this._glObjectsChanged$}get geometryChanged$(){return this._geometry.changed$.pipe(ee((()=>this)))}dispose(){this._geometryChangedSubscription.unsubscribe()}_canvasToTransform(t){return`translate(-50%,-50%) translate(${Math.round(t[0])}px,${Math.round(t[1])}px)`}_colorToBackground(t){return"#"+("000000"+t.toString(16)).substr(-6)}_createOutine(t,e){const i=this._getLinePositions(t),n=new ra;n.setAttribute("position",new Wr(i,3));const r=new lc({color:e,linewidth:1});return new fc(n,r)}_disposeLine(t){null!=t&&(t.geometry.dispose(),t.material.dispose())}_getLinePositions(t){const e=t.length,i=new Float32Array(3*e);for(let n=0;n<e;++n){const e=3*n,r=t[n];i[e]=r[0],i[e+1]=r[1],i[e+2]=r[2]}return i}}var u_={exports:{}};function h_(t,e,i){i=i||2;var n,r,a,o,s,l,c,u=e&&e.length,h=u?e[0]*i:t.length,p=p_(t,0,h,i,!0),d=[];if(!p||p.next===p.prev)return d;if(u&&(p=function(t,e,i,n){var r,a,o,s=[];for(r=0,a=e.length;r<a;r++)(o=p_(t,e[r]*n,r<a-1?e[r+1]*n:t.length,n,!1))===o.next&&(o.steiner=!0),s.push(S_(o));for(s.sort(v_),r=0;r<s.length;r++)i=d_(i=x_(s[r],i),i.next);return i}(t,e,p,i)),t.length>80*i){n=a=t[0],r=o=t[1];for(var f=i;f<h;f+=i)(s=t[f])<n&&(n=s),(l=t[f+1])<r&&(r=l),s>a&&(a=s),l>o&&(o=l);c=0!==(c=Math.max(a-n,o-r))?1/c:0}return f_(p,d,i,n,r,c),d}function p_(t,e,i,n,r){var a,o;if(r===B_(t,e,i,n)>0)for(a=e;a<i;a+=n)o=P_(a,t[a],t[a+1],o);else for(a=i-n;a>=e;a-=n)o=P_(a,t[a],t[a+1],o);return o&&C_(o,o.next)&&(D_(o),o=o.next),o}function d_(t,e){if(!t)return t;e||(e=t);var i,n=t;do{if(i=!1,n.steiner||!C_(n,n.next)&&0!==M_(n.prev,n,n.next))n=n.next;else{if(D_(n),(n=e=n.prev)===n.next)break;i=!0}}while(i||n!==e);return e}function f_(t,e,i,n,r,a,o){if(t){!o&&a&&function(t,e,i,n){var r=t;do{null===r.z&&(r.z=w_(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,i,n,r,a,o,s,l,c=1;do{for(i=t,t=null,a=null,o=0;i;){for(o++,n=i,s=0,e=0;e<c&&(s++,n=n.nextZ);e++);for(l=c;s>0||l>0&&n;)0!==s&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,s--):(r=n,n=n.nextZ,l--),a?a.nextZ=r:t=r,r.prevZ=a,a=r;i=n}a.nextZ=null,c*=2}while(o>1)}(r)}(t,n,r,a);for(var s,l,c=t;t.prev!==t.next;)if(s=t.prev,l=t.next,a?g_(t,n,r,a):m_(t))e.push(s.i/i),e.push(t.i/i),e.push(l.i/i),D_(t),t=l.next,c=l.next;else if((t=l)===c){o?1===o?f_(t=__(d_(t),e,i),e,i,n,r,a,2):2===o&&y_(t,e,i,n,r,a):f_(d_(t),e,i,n,r,a,1);break}}}function m_(t){var e=t.prev,i=t,n=t.next;if(M_(e,i,n)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(E_(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&M_(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function g_(t,e,i,n){var r=t.prev,a=t,o=t.next;if(M_(r,a,o)>=0)return!1;for(var s=r.x<a.x?r.x<o.x?r.x:o.x:a.x<o.x?a.x:o.x,l=r.y<a.y?r.y<o.y?r.y:o.y:a.y<o.y?a.y:o.y,c=r.x>a.x?r.x>o.x?r.x:o.x:a.x>o.x?a.x:o.x,u=r.y>a.y?r.y>o.y?r.y:o.y:a.y>o.y?a.y:o.y,h=w_(s,l,e,i,n),p=w_(c,u,e,i,n),d=t.prevZ,f=t.nextZ;d&&d.z>=h&&f&&f.z<=p;){if(d!==t.prev&&d!==t.next&&E_(r.x,r.y,a.x,a.y,o.x,o.y,d.x,d.y)&&M_(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,f!==t.prev&&f!==t.next&&E_(r.x,r.y,a.x,a.y,o.x,o.y,f.x,f.y)&&M_(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;d&&d.z>=h;){if(d!==t.prev&&d!==t.next&&E_(r.x,r.y,a.x,a.y,o.x,o.y,d.x,d.y)&&M_(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;f&&f.z<=p;){if(f!==t.prev&&f!==t.next&&E_(r.x,r.y,a.x,a.y,o.x,o.y,f.x,f.y)&&M_(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function __(t,e,i){var n=t;do{var r=n.prev,a=n.next.next;!C_(r,a)&&I_(r,n,n.next,a)&&R_(r,a)&&R_(a,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(a.i/i),D_(n),D_(n.next),n=t=a),n=n.next}while(n!==t);return d_(n)}function y_(t,e,i,n,r,a){var o=t;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&T_(o,s)){var l=z_(o,s);return o=d_(o,o.next),l=d_(l,l.next),f_(o,e,i,n,r,a),void f_(l,e,i,n,r,a)}s=s.next}o=o.next}while(o!==t)}function v_(t,e){return t.x-e.x}function x_(t,e){var i=function(t,e){var i,n=e,r=t.x,a=t.y,o=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var s=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=r&&s>o){if(o=s,s===r){if(a===n.y)return n;if(a===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!i)return null;if(r===o)return i;var l,c=i,u=i.x,h=i.y,p=1/0;n=i;do{r>=n.x&&n.x>=u&&r!==n.x&&E_(a<h?r:o,a,u,h,a<h?o:r,a,n.x,n.y)&&(l=Math.abs(a-n.y)/(r-n.x),R_(n,t)&&(l<p||l===p&&(n.x>i.x||n.x===i.x&&b_(i,n)))&&(i=n,p=l)),n=n.next}while(n!==c);return i}(t,e);if(!i)return e;var n=z_(i,t),r=d_(i,i.next);return d_(n,n.next),e===i?r:e}function b_(t,e){return M_(t.prev,t,e.prev)<0&&M_(e.next,t,t.next)<0}function w_(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function S_(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function E_(t,e,i,n,r,a,o,s){return(r-o)*(e-s)-(t-o)*(a-s)>=0&&(t-o)*(n-s)-(i-o)*(e-s)>=0&&(i-o)*(a-s)-(r-o)*(n-s)>=0}function T_(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&I_(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(R_(t,e)&&R_(e,t)&&function(t,e){var i=t,n=!1,r=(t.x+e.x)/2,a=(t.y+e.y)/2;do{i.y>a!==i.next.y>a&&i.next.y!==i.y&&r<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(M_(t.prev,t,e.prev)||M_(t,e.prev,e))||C_(t,e)&&M_(t.prev,t,t.next)>0&&M_(e.prev,e,e.next)>0)}function M_(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function C_(t,e){return t.x===e.x&&t.y===e.y}function I_(t,e,i,n){var r=k_(M_(t,e,i)),a=k_(M_(t,e,n)),o=k_(M_(i,n,t)),s=k_(M_(i,n,e));return r!==a&&o!==s||(!(0!==r||!A_(t,i,e))||(!(0!==a||!A_(t,n,e))||(!(0!==o||!A_(i,t,n))||!(0!==s||!A_(i,e,n)))))}function A_(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function k_(t){return t>0?1:t<0?-1:0}function R_(t,e){return M_(t.prev,t,t.next)<0?M_(t,e,t.next)>=0&&M_(t,t.prev,e)>=0:M_(t,e,t.prev)<0||M_(t,t.next,e)<0}function z_(t,e){var i=new L_(t.i,t.x,t.y),n=new L_(e.i,e.x,e.y),r=t.next,a=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,a.next=n,n.prev=a,n}function P_(t,e,i,n){var r=new L_(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function D_(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function L_(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function B_(t,e,i,n){for(var r=0,a=e,o=i-n;a<i;a+=n)r+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;return r}u_.exports=h_,u_.exports.default=h_,h_.deviation=function(t,e,i,n){var r=e&&e.length,a=r?e[0]*i:t.length,o=Math.abs(B_(t,0,a,i));if(r)for(var s=0,l=e.length;s<l;s++){var c=e[s]*i,u=s<l-1?e[s+1]*i:t.length;o-=Math.abs(B_(t,c,u,i))}var h=0;for(s=0;s<n.length;s+=3){var p=n[s]*i,d=n[s+1]*i,f=n[s+2]*i;h+=Math.abs((t[p]-t[f])*(t[d+1]-t[p+1])-(t[p]-t[d])*(t[f+1]-t[p+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},h_.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,r=0;r<t.length;r++){for(var a=0;a<t[r].length;a++)for(var o=0;o<e;o++)i.vertices.push(t[r][a][o]);r>0&&(n+=t[r-1].length,i.holes.push(n))}return i};var O_=u_.exports,F_={exports:{}};function N_(t,e){return t<e?-1:t>e?1:0}var U_=Object.freeze({__proto__:null,default:class{constructor(t=[],e=N_){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:i}=this,n=e[t];for(;t>0;){const r=t-1>>1,a=e[r];if(i(n,a)>=0)break;e[t]=a,t=r}e[t]=n}_down(t){const{data:e,compare:i}=this,n=this.length>>1,r=e[t];for(;t<n;){let n=1+(t<<1),a=e[n];const o=n+1;if(o<this.length&&i(e[o],a)<0&&(n=o,a=e[o]),i(a,r)>=0)break;e[t]=a,t=n}e[t]=r}}}),$_=Cp(U_);function V_(t,e,i){var n,r,a,o;e=e||1;for(var s=0;s<t[0].length;s++){var l=t[0][s];(!s||l[0]<n)&&(n=l[0]),(!s||l[1]<r)&&(r=l[1]),(!s||l[0]>a)&&(a=l[0]),(!s||l[1]>o)&&(o=l[1])}var c=a-n,u=o-r,h=Math.min(c,u),p=h/2;if(0===h){var d=[n,r];return d.distance=0,d}for(var f=new $_(void 0,j_),m=n;m<a;m+=h)for(var g=r;g<o;g+=h)f.push(new q_(m+p,g+p,p,t));var _=function(t){for(var e=0,i=0,n=0,r=t[0],a=0,o=r.length,s=o-1;a<o;s=a++){var l=r[a],c=r[s],u=l[0]*c[1]-c[0]*l[1];i+=(l[0]+c[0])*u,n+=(l[1]+c[1])*u,e+=3*u}return 0===e?new q_(r[0][0],r[0][1],0,t):new q_(i/e,n/e,0,t)}(t),y=new q_(n+c/2,r+u/2,0,t);y.d>_.d&&(_=y);for(var v=f.length;f.length;){var x=f.pop();x.d>_.d&&(_=x,i&&console.log("found best %d after %d probes",Math.round(1e4*x.d)/1e4,v)),x.max-_.d<=e||(p=x.h/2,f.push(new q_(x.x-p,x.y-p,p,t)),f.push(new q_(x.x+p,x.y-p,p,t)),f.push(new q_(x.x-p,x.y+p,p,t)),f.push(new q_(x.x+p,x.y+p,p,t)),v+=4)}i&&(console.log("num probes: "+v),console.log("best distance: "+_.d));var b=[_.x,_.y];return b.distance=_.d,b}function j_(t,e){return e.max-t.max}function q_(t,e,i,n){this.x=t,this.y=e,this.h=i,this.d=function(t,e,i){for(var n=!1,r=1/0,a=0;a<i.length;a++)for(var o=i[a],s=0,l=o.length,c=l-1;s<l;c=s++){var u=o[s],h=o[c];u[1]>e!==h[1]>e&&t<(h[0]-u[0])*(e-u[1])/(h[1]-u[1])+u[0]&&(n=!n),r=Math.min(r,G_(t,e,u,h))}return 0===r?0:(n?1:-1)*Math.sqrt(r)}(t,e,n),this.max=this.d+this.h*Math.SQRT2}function G_(t,e,i,n){var r=i[0],a=i[1],o=n[0]-r,s=n[1]-a;if(0!==o||0!==s){var l=((t-r)*o+(e-a)*s)/(o*o+s*s);l>1?(r=n[0],a=n[1]):l>0&&(r+=o*l,a+=s*l)}return(o=t-r)*o+(s=e-a)*s}$_.default&&($_=$_.default),F_.exports=V_,F_.exports.default=V_;var H_=F_.exports;function W_(t,e){return t>e?1:t<e?-1:0}class Z_{constructor(t=W_,e=!1){this._compare=t,this._root=null,this._size=0,this._noDuplicates=!!e}rotateLeft(t){var e=t.right;e&&(t.right=e.left,e.left&&(e.left.parent=t),e.parent=t.parent),t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.left=t),t.parent=e}rotateRight(t){var e=t.left;e&&(t.left=e.right,e.right&&(e.right.parent=t),e.parent=t.parent),t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.right=t),t.parent=e}_splay(t){for(;t.parent;){var e=t.parent;e.parent?e.left===t&&e.parent.left===e?(this.rotateRight(e.parent),this.rotateRight(e)):e.right===t&&e.parent.right===e?(this.rotateLeft(e.parent),this.rotateLeft(e)):e.left===t&&e.parent.right===e?(this.rotateRight(e),this.rotateLeft(e)):(this.rotateLeft(e),this.rotateRight(e)):e.left===t?this.rotateRight(e):this.rotateLeft(e)}}splay(t){for(var e,i,n,r,a;t.parent;)(i=(e=t.parent).parent)&&i.parent?((n=i.parent).left===i?n.left=t:n.right=t,t.parent=n):(t.parent=null,this._root=t),r=t.left,a=t.right,t===e.left?(i&&(i.left===e?(e.right?(i.left=e.right,i.left.parent=i):i.left=null,e.right=i,i.parent=e):(r?(i.right=r,r.parent=i):i.right=null,t.left=i,i.parent=t)),a?(e.left=a,a.parent=e):e.left=null,t.right=e,e.parent=t):(i&&(i.right===e?(e.left?(i.right=e.left,i.right.parent=i):i.right=null,e.left=i,i.parent=e):(a?(i.left=a,a.parent=i):i.left=null,t.right=i,i.parent=t)),r?(e.right=r,r.parent=e):e.right=null,t.left=e,e.parent=t)}replace(t,e){t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.parent=t.parent)}minNode(t=this._root){if(t)for(;t.left;)t=t.left;return t}maxNode(t=this._root){if(t)for(;t.right;)t=t.right;return t}insert(t,e){var i=this._root,n=null,r=this._compare;if(this._noDuplicates)for(;i;){if(n=i,0===r(i.key,t))return;i=r(i.key,t)<0?i.right:i.left}else for(;i;)n=i,i=r(i.key,t)<0?i.right:i.left;return i={key:t,data:e,left:null,right:null,parent:n},n?r(n.key,i.key)<0?n.right=i:n.left=i:this._root=i,this.splay(i),this._size++,i}find(t){for(var e=this._root,i=this._compare;e;){var n=i(e.key,t);if(n<0)e=e.right;else{if(!(n>0))return e;e=e.left}}return null}contains(t){for(var e=this._root,i=this._compare;e;){var n=i(t,e.key);if(0===n)return!0;e=n<0?e.left:e.right}return!1}remove(t){var e=this.find(t);if(!e)return!1;if(this.splay(e),e.left)if(e.right){var i=this.minNode(e.right);i.parent!==e&&(this.replace(i,i.right),i.right=e.right,i.right.parent=i),this.replace(e,i),i.left=e.left,i.left.parent=i}else this.replace(e,e.left);else this.replace(e,e.right);return this._size--,!0}removeNode(t){if(!t)return!1;if(this.splay(t),t.left)if(t.right){var e=this.minNode(t.right);e.parent!==t&&(this.replace(e,e.right),e.right=t.right,e.right.parent=e),this.replace(t,e),e.left=t.left,e.left.parent=e}else this.replace(t,t.left);else this.replace(t,t.right);return this._size--,!0}erase(t){var e=this.find(t);if(e){this.splay(e);var i=e.left,n=e.right,r=null;i&&(i.parent=null,r=this.maxNode(i),this.splay(r),this._root=r),n&&(i?r.right=n:this._root=n,n.parent=r),this._size--}}pop(){var t=this._root,e=null;if(t){for(;t.left;)t=t.left;e={key:t.key,data:t.data},this.remove(t.key)}return e}next(t){var e=t;if(e)if(e.right)for(e=e.right;e&&e.left;)e=e.left;else for(e=t.parent;e&&e.right===t;)t=e,e=e.parent;return e}prev(t){var e=t;if(e)if(e.left)for(e=e.left;e&&e.right;)e=e.right;else for(e=t.parent;e&&e.left===t;)t=e,e=e.parent;return e}forEach(t){for(var e=this._root,i=[],n=!1,r=0;!n;)e?(i.push(e),e=e.left):i.length>0?(t(e=i.pop(),r++),e=e.right):n=!0;return this}range(t,e,i,n){const r=[],a=this._compare;let o,s=this._root;for(;0!==r.length||s;)if(s)r.push(s),s=s.left;else{if(s=r.pop(),o=a(s.key,e),o>0)break;if(a(s.key,t)>=0&&i.call(n,s))return this;s=s.right}return this}keys(){for(var t=this._root,e=[],i=[],n=!1;!n;)t?(e.push(t),t=t.left):e.length>0?(t=e.pop(),i.push(t.key),t=t.right):n=!0;return i}values(){for(var t=this._root,e=[],i=[],n=!1;!n;)t?(e.push(t),t=t.left):e.length>0?(t=e.pop(),i.push(t.data),t=t.right):n=!0;return i}at(t){for(var e=this._root,i=[],n=!1,r=0;!n;)if(e)i.push(e),e=e.left;else if(i.length>0){if(e=i.pop(),r===t)return e;r++,e=e.right}else n=!0;return null}load(t=[],e=[],i=!1){if(0!==this._size)throw new Error("bulk-load: tree is not empty");const n=t.length;return i&&X_(t,e,0,n-1,this._compare),this._root=Y_(null,t,e,0,n),this._size=n,this}min(){var t=this.minNode(this._root);return t?t.key:null}max(){var t=this.maxNode(this._root);return t?t.key:null}isEmpty(){return null===this._root}get size(){return this._size}static createTree(t,e,i,n,r){return new Z_(i,r).load(t,e,n)}}function Y_(t,e,i,n,r){const a=r-n;if(a>0){const o=n+Math.floor(a/2),s={key:e[o],data:i[o],parent:t};return s.left=Y_(s,e,i,n,o),s.right=Y_(s,e,i,o+1,r),s}return null}function X_(t,e,i,n,r){if(i>=n)return;const a=t[i+n>>1];let o=i-1,s=n+1;for(;;){do{o++}while(r(t[o],a)<0);do{s--}while(r(t[s],a)>0);if(o>=s)break;let i=t[o];t[o]=t[s],t[s]=i,i=e[o],e[o]=e[s],e[s]=i}X_(t,e,i,s,r),X_(t,e,s+1,n,r)}function K_(t,e,i){null===e?(t.inOut=!1,t.otherInOut=!0):(t.isSubject===e.isSubject?(t.inOut=!e.inOut,t.otherInOut=e.otherInOut):(t.inOut=!e.otherInOut,t.otherInOut=e.isVertical()?!e.inOut:e.inOut),e&&(t.prevInResult=!J_(e,i)||e.isVertical()?e.prevInResult:e));let n=J_(t,i);t.resultTransition=n?function(t,e){let i,n=!t.inOut,r=!t.otherInOut;switch(e){case 0:i=n&&r;break;case 1:i=n||r;break;case 3:i=n^r;break;case 2:i=t.isSubject?n&&!r:r&&!n}return i?1:-1}(t,i):0}function J_(t,e){switch(t.type){case 0:switch(e){case 0:return!t.otherInOut;case 1:return t.otherInOut;case 2:return t.isSubject&&t.otherInOut||!t.isSubject&&!t.otherInOut;case 3:return!0}break;case 2:return 0===e||1===e;case 3:return 2===e;case 1:return!1}return!1}class Q_{constructor(t,e,i,n,r){this.left=e,this.point=t,this.otherEvent=i,this.isSubject=n,this.type=r||0,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0}isBelow(t){const e=this.point,i=this.otherEvent.point;return this.left?(e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1])>0:(i[0]-t[0])*(e[1]-t[1])-(e[0]-t[0])*(i[1]-t[1])>0}isAbove(t){return!this.isBelow(t)}isVertical(){return this.point[0]===this.otherEvent.point[0]}get inResult(){return 0!==this.resultTransition}clone(){const t=new Q_(this.point,this.left,this.otherEvent,this.isSubject,this.type);return t.contourId=this.contourId,t.resultTransition=this.resultTransition,t.prevInResult=this.prevInResult,t.isExteriorRing=this.isExteriorRing,t.inOut=this.inOut,t.otherInOut=this.otherInOut,t}}function ty(t,e){return t[0]===e[0]&&t[1]===e[1]}const ey=134217729;function iy(t,e,i,n,r){let a,o,s,l,c=e[0],u=n[0],h=0,p=0;u>c===u>-c?(a=c,c=e[++h]):(a=u,u=n[++p]);let d=0;if(h<t&&p<i)for(u>c===u>-c?(o=c+a,s=a-(o-c),c=e[++h]):(o=u+a,s=a-(o-u),u=n[++p]),a=o,0!==s&&(r[d++]=s);h<t&&p<i;)u>c===u>-c?(o=a+c,l=o-a,s=a-(o-l)+(c-l),c=e[++h]):(o=a+u,l=o-a,s=a-(o-l)+(u-l),u=n[++p]),a=o,0!==s&&(r[d++]=s);for(;h<t;)o=a+c,l=o-a,s=a-(o-l)+(c-l),c=e[++h],a=o,0!==s&&(r[d++]=s);for(;p<i;)o=a+u,l=o-a,s=a-(o-l)+(u-l),u=n[++p],a=o,0!==s&&(r[d++]=s);return 0===a&&0!==d||(r[d++]=a),d}function ny(t){return new Float64Array(t)}const ry=ny(4),ay=ny(8),oy=ny(12),sy=ny(16),ly=ny(4);function cy(t,e,i,n,r,a){const o=(e-a)*(i-r),s=(t-r)*(n-a),l=o-s;if(0===o||0===s||o>0!==s>0)return l;const c=Math.abs(o+s);return Math.abs(l)>=33306690738754716e-32*c?l:-function(t,e,i,n,r,a,o){let s,l,c,u,h,p,d,f,m,g,_,y,v,x,b,w,S,E;const T=t-r,M=i-r,C=e-a,I=n-a;x=T*I,p=ey*T,d=p-(p-T),f=T-d,p=ey*I,m=p-(p-I),g=I-m,b=f*g-(x-d*m-f*m-d*g),w=C*M,p=ey*C,d=p-(p-C),f=C-d,p=ey*M,m=p-(p-M),g=M-m,S=f*g-(w-d*m-f*m-d*g),_=b-S,h=b-_,ry[0]=b-(_+h)+(h-S),y=x+_,h=y-x,v=x-(y-h)+(_-h),_=v-w,h=v-_,ry[1]=v-(_+h)+(h-w),E=y+_,h=E-y,ry[2]=y-(E-h)+(_-h),ry[3]=E;let A=function(t,e){let i=e[0];for(let n=1;n<t;n++)i+=e[n];return i}(4,ry),k=22204460492503146e-32*o;if(A>=k||-A>=k)return A;if(h=t-T,s=t-(T+h)+(h-r),h=i-M,c=i-(M+h)+(h-r),h=e-C,l=e-(C+h)+(h-a),h=n-I,u=n-(I+h)+(h-a),0===s&&0===l&&0===c&&0===u)return A;if(k=11093356479670487e-47*o+33306690738754706e-32*Math.abs(A),A+=T*u+I*s-(C*c+M*l),A>=k||-A>=k)return A;x=s*I,p=ey*s,d=p-(p-s),f=s-d,p=ey*I,m=p-(p-I),g=I-m,b=f*g-(x-d*m-f*m-d*g),w=l*M,p=ey*l,d=p-(p-l),f=l-d,p=ey*M,m=p-(p-M),g=M-m,S=f*g-(w-d*m-f*m-d*g),_=b-S,h=b-_,ly[0]=b-(_+h)+(h-S),y=x+_,h=y-x,v=x-(y-h)+(_-h),_=v-w,h=v-_,ly[1]=v-(_+h)+(h-w),E=y+_,h=E-y,ly[2]=y-(E-h)+(_-h),ly[3]=E;const R=iy(4,ry,4,ly,ay);x=T*u,p=ey*T,d=p-(p-T),f=T-d,p=ey*u,m=p-(p-u),g=u-m,b=f*g-(x-d*m-f*m-d*g),w=C*c,p=ey*C,d=p-(p-C),f=C-d,p=ey*c,m=p-(p-c),g=c-m,S=f*g-(w-d*m-f*m-d*g),_=b-S,h=b-_,ly[0]=b-(_+h)+(h-S),y=x+_,h=y-x,v=x-(y-h)+(_-h),_=v-w,h=v-_,ly[1]=v-(_+h)+(h-w),E=y+_,h=E-y,ly[2]=y-(E-h)+(_-h),ly[3]=E;const z=iy(R,ay,4,ly,oy);x=s*u,p=ey*s,d=p-(p-s),f=s-d,p=ey*u,m=p-(p-u),g=u-m,b=f*g-(x-d*m-f*m-d*g),w=l*c,p=ey*l,d=p-(p-l),f=l-d,p=ey*c,m=p-(p-c),g=c-m,S=f*g-(w-d*m-f*m-d*g),_=b-S,h=b-_,ly[0]=b-(_+h)+(h-S),y=x+_,h=y-x,v=x-(y-h)+(_-h),_=v-w,h=v-_,ly[1]=v-(_+h)+(h-w),E=y+_,h=E-y,ly[2]=y-(E-h)+(_-h),ly[3]=E;const P=iy(z,oy,4,ly,sy);return sy[P-1]}(t,e,i,n,r,a,c)}function uy(t,e,i){const n=cy(t[0],t[1],e[0],e[1],i[0],i[1]);return n>0?-1:n<0?1:0}function hy(t,e){const i=t.point,n=e.point;return i[0]>n[0]?1:i[0]<n[0]?-1:i[1]!==n[1]?i[1]>n[1]?1:-1:function(t,e,i,n){if(t.left!==e.left)return t.left?1:-1;if(0!==uy(i,t.otherEvent.point,e.otherEvent.point))return t.isBelow(e.otherEvent.point)?-1:1;return!t.isSubject&&e.isSubject?1:-1}(t,e,i)}function py(t,e,i){const n=new Q_(e,!1,t,t.isSubject),r=new Q_(e,!0,t.otherEvent,t.isSubject);return ty(t.point,t.otherEvent.point)&&console.warn("what is that, a collapsed segment?",t),n.contourId=r.contourId=t.contourId,hy(r,t.otherEvent)>0&&(t.otherEvent.left=!0,r.left=!1),t.otherEvent.otherEvent=r,t.otherEvent=n,i.push(r),i.push(n),i}function dy(t,e){return t[0]*e[1]-t[1]*e[0]}function fy(t,e){return t[0]*e[0]+t[1]*e[1]}function my(t,e,i){const n=function(t,e,i,n,r){const a=[e[0]-t[0],e[1]-t[1]],o=[n[0]-i[0],n[1]-i[1]];function s(t,e,i){return[t[0]+e*i[0],t[1]+e*i[1]]}const l=[i[0]-t[0],i[1]-t[1]];let c=dy(a,o),u=c*c;const h=fy(a,a);if(u>0){const e=dy(l,o)/c;if(e<0||e>1)return null;const n=dy(l,a)/c;return n<0||n>1?null:0===e||1===e?r?null:[s(t,e,a)]:0===n||1===n?r?null:[s(i,n,o)]:[s(t,e,a)]}if(c=dy(l,a),u=c*c,u>0)return null;const p=fy(a,l)/h,d=p+fy(a,o)/h,f=Math.min(p,d),m=Math.max(p,d);return f<=1&&m>=0?1===f?r?null:[s(t,f>0?f:0,a)]:0===m?r?null:[s(t,m<1?m:1,a)]:r&&0===f&&1===m?null:[s(t,f>0?f:0,a),s(t,m<1?m:1,a)]:null}(t.point,t.otherEvent.point,e.point,e.otherEvent.point),r=n?n.length:0;if(0===r)return 0;if(1===r&&(ty(t.point,e.point)||ty(t.otherEvent.point,e.otherEvent.point)))return 0;if(2===r&&t.isSubject===e.isSubject)return 0;if(1===r)return ty(t.point,n[0])||ty(t.otherEvent.point,n[0])||py(t,n[0],i),ty(e.point,n[0])||ty(e.otherEvent.point,n[0])||py(e,n[0],i),1;const a=[];let o=!1,s=!1;return ty(t.point,e.point)?o=!0:1===hy(t,e)?a.push(e,t):a.push(t,e),ty(t.otherEvent.point,e.otherEvent.point)?s=!0:1===hy(t.otherEvent,e.otherEvent)?a.push(e.otherEvent,t.otherEvent):a.push(t.otherEvent,e.otherEvent),o&&s||o?(e.type=1,t.type=e.inOut===t.inOut?2:3,o&&!s&&py(a[1].otherEvent,a[0].point,i),2):s?(py(a[0],a[1].point,i),3):a[0]!==a[3].otherEvent?(py(a[0],a[1].point,i),py(a[1],a[2].point,i),3):(py(a[0],a[1].point,i),py(a[3].otherEvent,a[2].point,i),3)}function gy(t,e){if(t===e)return 0;if(0!==uy(t.point,t.otherEvent.point,e.point)||0!==uy(t.point,t.otherEvent.point,e.otherEvent.point))return ty(t.point,e.point)?t.isBelow(e.otherEvent.point)?-1:1:t.point[0]===e.point[0]?t.point[1]<e.point[1]?-1:1:1===hy(t,e)?e.isAbove(t.point)?-1:1:t.isBelow(e.point)?-1:1;if(t.isSubject!==e.isSubject)return t.isSubject?-1:1;{let i=t.point,n=e.point;if(i[0]===n[0]&&i[1]===n[1])return i=t.otherEvent.point,n=e.otherEvent.point,i[0]===n[0]&&i[1]===n[1]?0:t.contourId>e.contourId?1:-1}return 1===hy(t,e)?1:-1}class _y{constructor(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null}isExterior(){return null==this.holeOf}}function yy(t,e,i,n){let r,a=t+1,o=e[t].point;const s=e.length;for(a<s&&(r=e[a].point);a<s&&r[0]===o[0]&&r[1]===o[1];){if(!i[a])return a;a++,r=e[a].point}for(a=t-1;i[a]&&a>n;)a--;return a}function vy(t,e,i){const n=new _y;if(null!=t.prevInResult){const r=t.prevInResult,a=r.outputContourId;if(r.resultTransition>0){const t=e[a];if(null!=t.holeOf){const r=t.holeOf;e[r].holeIds.push(i),n.holeOf=r,n.depth=e[a].depth}else e[a].holeIds.push(i),n.holeOf=a,n.depth=e[a].depth+1}else n.holeOf=null,n.depth=e[a].depth}else n.holeOf=null,n.depth=0;return n}function xy(t){let e,i;const n=function(t){let e,i,n,r;const a=[];for(i=0,n=t.length;i<n;i++)e=t[i],(e.left&&e.inResult||!e.left&&e.otherEvent.inResult)&&a.push(e);let o=!1;for(;!o;)for(o=!0,i=0,n=a.length;i<n;i++)i+1<n&&1===hy(a[i],a[i+1])&&(r=a[i],a[i]=a[i+1],a[i+1]=r,o=!1);for(i=0,n=a.length;i<n;i++)e=a[i],e.otherPos=i;for(i=0,n=a.length;i<n;i++)e=a[i],e.left||(r=e.otherPos,e.otherPos=e.otherEvent.otherPos,e.otherEvent.otherPos=r);return a}(t),r={},a=[];for(e=0,i=n.length;e<i;e++){if(r[e])continue;const t=a.length,i=vy(n[e],a,t),o=e=>{r[e]=!0,n[e].outputContourId=t};let s=e,l=e;const c=n[e].point;for(i.points.push(c);o(s),s=n[s].otherPos,o(s),i.points.push(n[s].point),s=yy(s,n,r,l),s!=l;);a.push(i)}return a}var by={exports:{}};function wy(t,e){if(!(this instanceof wy))return new wy(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||Sy,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)}function Sy(t,e){return t<e?-1:t>e?1:0}by.exports=wy,by.exports.default=wy,wy.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,i=this.compare,n=e[t];t>0;){var r=t-1>>1,a=e[r];if(i(n,a)>=0)break;e[t]=a,t=r}e[t]=n},_down:function(t){for(var e=this.data,i=this.compare,n=this.length>>1,r=e[t];t<n;){var a=1+(t<<1),o=a+1,s=e[a];if(o<this.length&&i(e[o],s)<0&&(a=o,s=e[o]),i(s,r)>=0)break;e[t]=s,t=a}e[t]=r}};var Ey=by.exports;const Ty=Math.max,My=Math.min;let Cy=0;function Iy(t,e,i,n,r,a){let o,s,l,c,u,h;for(o=0,s=t.length-1;o<s;o++){if(l=t[o],c=t[o+1],u=new Q_(l,!1,void 0,e),h=new Q_(c,!1,u,e),u.otherEvent=h,l[0]===c[0]&&l[1]===c[1])continue;u.contourId=h.contourId=i,a||(u.isExteriorRing=!1,h.isExteriorRing=!1),hy(u,h)>0?h.left=!0:u.left=!0;const s=l[0],p=l[1];r[0]=My(r[0],s),r[1]=My(r[1],p),r[2]=Ty(r[2],s),r[3]=Ty(r[3],p),n.push(u),n.push(h)}}const Ay=[];function ky(t,e,i){"number"===typeof t[0][0][0]&&(t=[t]),"number"===typeof e[0][0][0]&&(e=[e]);let n=function(t,e,i){let n=null;return t.length*e.length===0&&(0===i?n=Ay:2===i?n=t:1!==i&&3!==i||(n=0===t.length?e:t)),n}(t,e,i);if(n)return n===Ay?null:n;const r=[1/0,1/0,-1/0,-1/0],a=[1/0,1/0,-1/0,-1/0],o=function(t,e,i,n,r){const a=new Ey(null,hy);let o,s,l,c,u,h;for(l=0,c=t.length;l<c;l++)for(o=t[l],u=0,h=o.length;u<h;u++)s=0===u,s&&Cy++,Iy(o[u],!0,Cy,a,i,s);for(l=0,c=e.length;l<c;l++)for(o=e[l],u=0,h=o.length;u<h;u++)s=0===u,2===r&&(s=!1),s&&Cy++,Iy(o[u],!1,Cy,a,n,s);return a}(t,e,r,a,i);if(n=function(t,e,i,n,r){let a=null;return(i[0]>n[2]||n[0]>i[2]||i[1]>n[3]||n[1]>i[3])&&(0===r?a=Ay:2===r?a=t:1!==r&&3!==r||(a=t.concat(e))),a}(t,e,r,a,i),n)return n===Ay?null:n;const s=function(t,e,i,n,r,a){const o=new Z_(gy),s=[],l=Math.min(n[2],r[2]);let c,u,h;for(;0!==t.length;){let e=t.pop();if(s.push(e),0===a&&e.point[0]>l||2===a&&e.point[0]>n[2])break;if(e.left){u=c=o.insert(e),h=o.minNode(),c=c!==h?o.prev(c):null,u=o.next(u);const i=c?c.key:null;let n;if(K_(e,i,a),u&&2===my(e,u.key,t)&&(K_(e,i,a),K_(e,u.key,a)),c&&2===my(c.key,e,t)){let t=c;t=t!==h?o.prev(t):null,n=t?t.key:null,K_(i,n,a),K_(e,i,a)}}else e=e.otherEvent,u=c=o.find(e),c&&u&&(c=c!==h?o.prev(c):null,u=o.next(u),o.remove(e),u&&c&&my(c.key,u.key,t))}return s}(o,0,0,r,a,i),l=xy(s),c=[];for(let u=0;u<l.length;u++){let t=l[u];if(t.isExterior()){let e=[t.points];for(let i=0;i<t.holeIds.length;i++){let n=t.holeIds[i];e.push(l[n].points)}c.push(e)}}return c}class Ry extends o_{constructor(){super(),this._subsampleThreshold=.005}_getPoleOfInaccessibility2d(t){return H_([t],.03)}_project(t,e){const i=this._createCamera(e.upVector().toArray(),e.unprojectSfM([0,0],0),e.unprojectSfM([0,0],10));return this._deunproject(t,e,i)}_subsample(t,e=this._subsampleThreshold){const i=[],n=t.length;for(let r=0;r<n;r++){const a=t[r],o=t[(r+1)%n];i.push(a);const s=Math.sqrt(Math.pow(o[0]-a[0],2)+Math.pow(o[1]-a[1],2)),l=Math.floor(s/e),c=1/(l+1);for(let t=1;t<=l;t++){const e=t*c,n=[(1-e)*a[0]+e*o[0],(1-e)*a[1]+e*o[1]];i.push(n)}}return i}_triangulate(t,e,i,n){let r=[t.slice(0,-1)];for(let c of null!=i?i:[])r.push(c.slice(0,-1));let a=e.slice(0,-1);for(let c of null!=n?n:[])a=a.concat(c.slice(0,-1));let o=O_.flatten(r),s=O_(o.vertices,o.holes,o.dimensions),l=[];for(let c=0;c<s.length;++c){let t=a[s[c]];l.push(t[0]),l.push(t[1]),l.push(t[2])}return l}_triangulateSpherical(t,e,i){const n=[],r=1e-9;for(let a=0;a<3;a++)for(let o=0;o<3;o++){const s=a/3+(0===a?-1e-9:r),l=o/3+(0===o?-1e-9:r),c=(a+1)/3+r,u=(o+1)/3+r,h=[[s,l],[s,u],[c,u],[c,l],[s,l]],p=[(2*a+1)/6,(2*o+1)/6];n.push(...this._triangulateSubarea(t,e,h,p,i))}return n}_unproject(t,e,i=200){return t.map((t=>e.unprojectBasic(t,i)))}_createCamera(t,e,i){const n=new Aa;return n.up.copy((new bn).fromArray(t)),n.position.copy((new bn).fromArray(e)),n.lookAt((new bn).fromArray(i)),n.updateMatrix(),n.updateMatrixWorld(!0),n}_deunproject(t,e,i){return t.map((t=>{const n=e.unprojectBasic(t,1e4),r=new bn(n[0],n[1],n[2]).applyMatrix4(i.matrixWorldInverse);return[r.x/r.z,r.y/r.z]}))}_triangulateSubarea(t,e,i,n,r){const a=ky([t,...e],[i],0);if(!a)return[];const o=[],s=this._subsampleThreshold,l=this._createCamera(r.upVector().toArray(),r.unprojectSfM([0,0],0),r.unprojectBasic(n,10));for(const c of a){const t=this._subsample(c[0],s),e=this._deunproject(t,r,l),i=this._unproject(t,r),n=[],a=[];for(let o=1;o<c.length;o++){let t=this._subsample(c[o],s);const e=this._deunproject(t,r,l),i=this._unproject(t,r);n.push(e),a.push(i)}o.push(...this._triangulate(e,i,n,a))}return o}}class zy extends Ry{constructor(t){if(super(),4!==t.length)throw new s_("Rectangle needs to have four values.");if(t[1]>t[3])throw new s_("Basic Y coordinates values can not be inverted.");for(let e of t)if(e<0||e>1)throw new s_("Basic coordinates must be on the interval [0, 1].");this._anchorIndex=void 0,this._rect=t.slice(0,4),this._inverted=this._rect[0]>this._rect[2]}get anchorIndex(){return this._anchorIndex}get inverted(){return this._inverted}get rect(){return this._rect}initializeAnchorIndexing(t){if(void 0!==this._anchorIndex)throw new s_("Anchor indexing is already initialized.");if(t<0||t>3)throw new s_(`Invalid anchor index: ${t}.`);this._anchorIndex=void 0===t?0:t}terminateAnchorIndexing(){this._anchorIndex=void 0}setOppositeVertex2d(t,e){if(void 0===this._anchorIndex)throw new s_("Anchor indexing needs to be initialized.");const i=[Math.max(0,Math.min(1,t[0])),Math.max(0,Math.min(1,t[1]))],n=this._rect.slice(),r=0===this._anchorIndex?[n[0],n[3]]:1===this._anchorIndex?[n[0],n[1]]:2===this._anchorIndex?[n[2],n[1]]:[n[2],n[3]];if(Qh(e.cameraType)){const t=this._anchorIndex<2?i[0]-n[2]:i[0]-n[0];!this._inverted&&this._anchorIndex<2&&i[0]<.25&&n[2]>.75&&t<-.5||!this._inverted&&this._anchorIndex>=2&&i[0]<.25&&n[2]>.75&&t<-.5?(this._inverted=!0,this._anchorIndex=r[1]>i[1]?0:1):this._inverted&&this._anchorIndex>=2&&i[0]<.25&&n[0]>.75&&t<-.5?(this._inverted=!1,this._anchorIndex=r[0]>i[0]?r[1]>i[1]?3:2:r[1]>i[1]?0:1):!this._inverted&&this._anchorIndex>=2&&i[0]>.75&&n[0]<.25&&t>.5||!this._inverted&&this._anchorIndex<2&&i[0]>.75&&n[0]<.25&&t>.5?(this._inverted=!0,this._anchorIndex=r[1]>i[1]?3:2):this._inverted&&this._anchorIndex<2&&i[0]>.75&&n[2]<.25&&t>.5?(this._inverted=!1,this._anchorIndex=r[0]>i[0]?r[1]>i[1]?3:2:r[1]>i[1]?0:1):this._inverted&&this._anchorIndex<2&&i[0]>n[0]?(this._inverted=!1,this._anchorIndex=r[1]>i[1]?0:1):this._inverted&&this._anchorIndex>=2&&i[0]<n[2]?(this._inverted=!1,this._anchorIndex=r[1]>i[1]?3:2):this._inverted?this._anchorIndex<2?this._anchorIndex=r[1]>i[1]?0:1:this._anchorIndex=r[1]>i[1]?3:2:this._anchorIndex=r[0]<=i[0]&&r[1]>i[1]?0:r[0]<=i[0]&&r[1]<=i[1]?1:r[0]>i[0]&&r[1]<=i[1]?2:3;const e=[];0===this._anchorIndex?(e[0]=r[0],e[1]=i[1],e[2]=i[0],e[3]=r[1]):1===this._anchorIndex?(e[0]=r[0],e[1]=r[1],e[2]=i[0],e[3]=i[1]):2===this._anchorIndex?(e[0]=i[0],e[1]=r[1],e[2]=r[0],e[3]=i[1]):(e[0]=i[0],e[1]=i[1],e[2]=r[0],e[3]=r[1]),(!this._inverted&&e[0]>e[2]||this._inverted&&e[0]<e[2])&&(e[0]=n[0],e[2]=n[2]),e[1]>e[3]&&(e[1]=n[1],e[3]=n[3]),this._rect[0]=e[0],this._rect[1]=e[1],this._rect[2]=e[2],this._rect[3]=e[3]}else{this._anchorIndex=r[0]<=i[0]&&r[1]>i[1]?0:r[0]<=i[0]&&r[1]<=i[1]?1:r[0]>i[0]&&r[1]<=i[1]?2:3;const t=[];0===this._anchorIndex?(t[0]=r[0],t[1]=i[1],t[2]=i[0],t[3]=r[1]):1===this._anchorIndex?(t[0]=r[0],t[1]=r[1],t[2]=i[0],t[3]=i[1]):2===this._anchorIndex?(t[0]=i[0],t[1]=r[1],t[2]=r[0],t[3]=i[1]):(t[0]=i[0],t[1]=i[1],t[2]=r[0],t[3]=r[1]),t[0]>t[2]&&(t[0]=n[0],t[2]=n[2]),t[1]>t[3]&&(t[1]=n[1],t[3]=n[3]),this._rect[0]=t[0],this._rect[1]=t[1],this._rect[2]=t[2],this._rect[3]=t[3]}this._notifyChanged$.next(this)}setVertex2d(t,e,i){let n=this._rect.slice(),r=[Math.max(0,Math.min(1,e[0])),Math.max(0,Math.min(1,e[1]))],a=[];if(0===t?(a[0]=r[0],a[1]=n[1],a[2]=n[2],a[3]=r[1]):1===t?(a[0]=r[0],a[1]=r[1],a[2]=n[2],a[3]=n[3]):2===t?(a[0]=n[0],a[1]=r[1],a[2]=r[0],a[3]=n[3]):3===t&&(a[0]=n[0],a[1]=n[1],a[2]=r[0],a[3]=r[1]),Qh(i.cameraType)){let e=t<2&&r[0]>.75&&n[0]<.25||t>=2&&this._inverted&&r[0]>.75&&n[2]<.25,i=t<2&&this._inverted&&r[0]<.25&&n[0]>.75||t>=2&&r[0]<.25&&n[2]>.75;e||i?this._inverted=!this._inverted:(a[0]-n[0]<-.25&&(a[0]=n[0]),a[2]-n[2]>.25&&(a[2]=n[2])),(!this._inverted&&a[0]>a[2]||this._inverted&&a[0]<a[2])&&(a[0]=n[0],a[2]=n[2])}else a[0]>a[2]&&(a[0]=n[0],a[2]=n[2]);a[1]>a[3]&&(a[1]=n[1],a[3]=n[3]),this._rect[0]=a[0],this._rect[1]=a[1],this._rect[2]=a[2],this._rect[3]=a[3],this._notifyChanged$.next(this)}setCentroid2d(t,e){let i=this._rect.slice(),n=i[0],r=this._inverted?i[2]+1:i[2],a=i[1],o=i[3],s=n+(r-n)/2,l=a+(o-a)/2,c=0;if(Qh(e.cameraType))c=this._inverted?t[0]+1-s:t[0]-s;else{let e=-n,i=1-r;c=Math.max(e,Math.min(i,t[0]-s))}let u=-a,h=1-o,p=Math.max(u,Math.min(h,t[1]-l));this._rect[0]=i[0]+c,this._rect[1]=i[1]+p,this._rect[2]=i[2]+c,this._rect[3]=i[3]+p,this._rect[0]<0?(this._rect[0]+=1,this._inverted=!this._inverted):this._rect[0]>1&&(this._rect[0]-=1,this._inverted=!this._inverted),this._rect[2]<0?(this._rect[2]+=1,this._inverted=!this._inverted):this._rect[2]>1&&(this._rect[2]-=1,this._inverted=!this._inverted),this._notifyChanged$.next(this)}getPoints3d(t){return this._getPoints2d().map((e=>t.unprojectBasic(e,200)))}getVertex2d(t){return this._rectToVertices2d(this._rect)[t]}getNonAdjustedVertex2d(t){return this._rectToNonAdjustedVertices2d(this._rect)[t]}getVertex3d(t,e){return e.unprojectBasic(this._rectToVertices2d(this._rect)[t],200)}getVertices2d(){return this._rectToVertices2d(this._rect)}getVertices3d(t){return this._rectToVertices2d(this._rect).map((e=>t.unprojectBasic(e,200)))}getCentroid2d(){const t=this._rect;return[(t[0]+(this._inverted?t[2]+1:t[2]))/2,(t[1]+t[3])/2]}getCentroid3d(t){const e=this.getCentroid2d();return t.unprojectBasic(e,200)}getPoleOfInaccessibility2d(){return this._getPoleOfInaccessibility2d(this._rectToVertices2d(this._rect))}getPoleOfInaccessibility3d(t){let e=this._getPoleOfInaccessibility2d(this._rectToVertices2d(this._rect));return t.unprojectBasic(e,200)}getTriangles3d(t){return Qh(t.cameraType)?[]:this._triangulate(this._project(this._getPoints2d(),t),this.getPoints3d(t))}validate(t){let e=this._rect;return!(!this._inverted&&t[0]<e[0]||t[0]-e[2]>.25||t[1]<e[1])}_getPoints2d(){let t=this._rectToVertices2d(this._rect),e=t.length-1,i=[];for(let n=0;n<e;++n){let e=t[n][0],r=t[n][1],a=(t[n+1][0]-e)/9,o=(t[n+1][1]-r)/9;for(let t=0;t<10;++t){let n=[e+t*a,r+t*o];i.push(n)}}return i}_rectToVertices2d(t){return[[t[0],t[3]],[t[0],t[1]],[this._inverted?t[2]+1:t[2],t[1]],[this._inverted?t[2]+1:t[2],t[3]],[t[0],t[3]]]}_rectToNonAdjustedVertices2d(t){return[[t[0],t[3]],[t[0],t[1]],[t[2],t[1]],[t[2],t[3]],[t[0],t[3]]]}}class Py extends c_{constructor(t,e,i,n){super(t,i,n),this._options={color:null==e.color?16777215:e.color,indicateCompleter:null==e.indicateCompleter||e.indicateCompleter},this._rectGeometry=new zy(this._geometry.getRect2d(i)),this._createGlObjects()}create(){this._geometry.points.length<3||(this._geometry.removePoint2d(this._geometry.points.length-1),this._created$.next(this))}dispose(){super.dispose(),this._disposeObjects()}getDOMObjects(t,e){const i={offsetHeight:e.height,offsetWidth:e.width},n=[],r=this._geometry.getPoints2d(),a=r.length;for(let o=0;o<a-1;o++){const e=o,[s,l]=r[o],c=this._viewportCoords.basicToCanvasSafe(s,l,i,this._transform,t);if(!c)continue;const u=t=>{t.stopPropagation(),this._aborted$.next(this)},h=t=>{t.stopPropagation(),this._geometry.removePoint2d(e)},p=this._canvasToTransform(c),d={onclick:0===o&&a<3?u:h,style:{transform:p}};n.push(Sm.h("div.mapillary-tag-interactor",d,[]));const f={style:{background:this._colorToBackground(this._options.color),transform:p}};n.push(Sm.h("div.mapillary-tag-vertex",f,[]))}if(a>2&&!0===this._options.indicateCompleter){const[e,r]=this._geometry.getCentroid2d(this._transform),a=this._viewportCoords.basicToCanvasSafe(e,r,i,this._transform,t);if(a){const t=t=>{t.stopPropagation(),this._geometry.removePoint2d(this._geometry.points.length-1),this._created$.next(this)},e=this._canvasToTransform(a),i={onclick:t,style:{transform:e}};n.push(Sm.h("div.mapillary-tag-completer.mapillary-tag-larger",i,[]));const r={style:{background:this._colorToBackground(this._options.color),transform:e}};n.push(Sm.h("div.mapillary-tag-vertex.mapillary-tag-larger",r,[]));const o={style:{transform:e}};n.push(Sm.h("div.mapillary-tag-dot",o,[]))}}return n}_onGeometryChanged(){this._disposeObjects(),this._rectGeometry=new zy(this._geometry.getRect2d(this._transform)),this._createGlObjects()}_createGlObjects(){this._glObjects=[];const t=this._rectGeometry.getPoints3d(this._transform);this._outline=this._createOutine(t,this._options.color),this._glObjects.push(this._outline)}_disposeObjects(){this._disposeLine(this._outline),this._outline=null,this._glObjects=null}}class Dy extends Ry{constructor(t,e){super();let i=t.length;if(i<3)throw new s_("A polygon must have three or more positions.");if(t[0][0]!==t[i-1][0]||t[0][1]!==t[i-1][1])throw new s_("First and last positions must be equivalent.");this._polygon=[];for(let n of t){if(n[0]<0||n[0]>1||n[1]<0||n[1]>1)throw new s_("Basic coordinates of polygon must be on the interval [0, 1].");this._polygon.push(n.slice())}if(this._holes=[],null!=e)for(let n=0;n<e.length;n++){let t=e[n],i=t.length;if(i<3)throw new s_("A polygon hole must have three or more positions.");if(t[0][0]!==t[i-1][0]||t[0][1]!==t[i-1][1])throw new s_("First and last positions of hole must be equivalent.");this._holes.push([]);for(let e of t){if(e[0]<0||e[0]>1||e[1]<0||e[1]>1)throw new s_("Basic coordinates of hole must be on the interval [0, 1].");this._holes[n].push(e.slice())}}}get polygon(){return this._polygon}get holes(){return this._holes}addVertex2d(t){let e=[Math.max(0,Math.min(1,t[0])),Math.max(0,Math.min(1,t[1]))];this._polygon.splice(this._polygon.length-1,0,e),this._notifyChanged$.next(this)}getVertex2d(t){return this._polygon[t].slice()}removeVertex2d(t){if(t<0||t>=this._polygon.length||this._polygon.length<4)throw new s_("Index for removed vertex must be valid.");if(t>0&&t<this._polygon.length-1)this._polygon.splice(t,1);else{this._polygon.splice(0,1),this._polygon.pop();let t=this._polygon[0].slice();this._polygon.push(t)}this._notifyChanged$.next(this)}setVertex2d(t,e,i){let n=[Math.max(0,Math.min(1,e[0])),Math.max(0,Math.min(1,e[1]))];0===t||t===this._polygon.length-1?(this._polygon[0]=n.slice(),this._polygon[this._polygon.length-1]=n.slice()):this._polygon[t]=n.slice(),this._notifyChanged$.next(this)}setCentroid2d(t,e){let i=this._polygon.map((t=>t[0])),n=this._polygon.map((t=>t[1])),r=Math.min.apply(Math,i),a=Math.max.apply(Math,i),o=Math.min.apply(Math,n),s=Math.max.apply(Math,n),l=this.getCentroid2d(),c=-r,u=1-a,h=-o,p=1-s,d=Math.max(c,Math.min(u,t[0]-l[0])),f=Math.max(h,Math.min(p,t[1]-l[1]));for(let m of this._polygon)m[0]+=d,m[1]+=f;this._notifyChanged$.next(this)}getPoints3d(t){return this._getPoints3d(this._subsample(this._polygon),t)}getVertex3d(t,e){return e.unprojectBasic(this._polygon[t],200)}getVertices2d(){return this._polygon.slice()}getVertices3d(t){return this._getPoints3d(this._polygon,t)}getHolePoints3d(t){return this._holes.map((e=>this._getPoints3d(this._subsample(e),t)))}getHoleVertices3d(t){return this._holes.map((e=>this._getPoints3d(e,t)))}getCentroid2d(){let t=this._polygon,e=0,i=0,n=0;for(let r=0;r<t.length-1;r++){let a=t[r][0],o=t[r][1],s=t[r+1][0],l=t[r+1][1],c=a*l-s*o;e+=c,i+=(a+s)*c,n+=(o+l)*c}return e/=2,i/=6*e,n/=6*e,[i,n]}getCentroid3d(t){let e=this.getCentroid2d();return t.unprojectBasic(e,200)}get3dDomainTriangles3d(t){return this._triangulate(this._project(this._polygon,t),this.getVertices3d(t),this._holes.map((e=>this._project(e,t))),this.getHoleVertices3d(t))}getTriangles3d(t){if(Qh(t.cameraType))return this._triangulateSpherical(this._polygon.slice(),this.holes.slice(),t);const e=this._project(this._subsample(this._polygon),t),i=this.getPoints3d(t),n=this._holes.map((e=>this._project(this._subsample(e),t))),r=this.getHolePoints3d(t);return this._triangulate(e,i,n,r)}getPoleOfInaccessibility2d(){return this._getPoleOfInaccessibility2d(this._polygon.slice())}getPoleOfInaccessibility3d(t){let e=this._getPoleOfInaccessibility2d(this._polygon.slice());return t.unprojectBasic(e,200)}_getPoints3d(t,e){return t.map((t=>e.unprojectBasic(t,200)))}}class Ly extends c_{constructor(t,e,i,n){super(t,i,n),this._options={color:null==e.color?16777215:e.color},this._createGlObjects()}create(){if(this._geometry instanceof zy)this._created$.next(this);else if(this._geometry instanceof Dy){const t=this._geometry;t.removeVertex2d(t.polygon.length-2),this._created$.next(this)}}dispose(){super.dispose(),this._disposeLine(this._outline),this._disposeObjects()}getDOMObjects(t,e){const i=[],n={offsetHeight:e.height,offsetWidth:e.width},r=t=>{t.stopPropagation(),this._aborted$.next(this)};if(this._geometry instanceof zy){const e=this._geometry.anchorIndex,a=void 0===e?1:e,[o,s]=this._geometry.getVertex2d(a),l=this._viewportCoords.basicToCanvasSafe(o,s,n,this._transform,t);if(null!=l){const t=this._colorToBackground(this._options.color),e=this._canvasToTransform(l),n={style:{background:t,transform:e}},a={onclick:r,style:{transform:e}};i.push(Sm.h("div.mapillary-tag-interactor",a,[])),i.push(Sm.h("div.mapillary-tag-vertex",n,[]))}}else if(this._geometry instanceof Dy){const e=this._geometry,[a,o]=e.getVertex2d(0),s=this._viewportCoords.basicToCanvasSafe(a,o,n,this._transform,t);if(null!=s){const t=e.polygon.length>4?t=>{t.stopPropagation(),e.removeVertex2d(e.polygon.length-2),this._created$.next(this)}:r,n={onclick:t,style:{transform:this._canvasToTransform(s)}},a=e.polygon.length>4?"mapillary-tag-completer":"mapillary-tag-interactor";i.push(Sm.h("div."+a,n,[]))}if(e.polygon.length>3){const[r,a]=e.getVertex2d(e.polygon.length-3),o=this._viewportCoords.basicToCanvasSafe(r,a,n,this._transform,t);if(null!=o){const t=t=>{t.stopPropagation(),e.removeVertex2d(e.polygon.length-3)},n={onclick:t,style:{transform:this._canvasToTransform(o)}};i.push(Sm.h("div.mapillary-tag-interactor",n,[]))}}const l=e.polygon.slice();l.splice(-2,2);for(const r of l){const e=this._viewportCoords.basicToCanvasSafe(r[0],r[1],n,this._transform,t);if(null!=e){const t={style:{background:this._colorToBackground(this._options.color),transform:this._canvasToTransform(e)}};i.push(Sm.h("div.mapillary-tag-vertex",t,[]))}}}return i}addPoint(t){if(this._geometry instanceof zy){if(!this._geometry.validate(t))return;this._created$.next(this)}else if(this._geometry instanceof Dy){this._geometry.addVertex2d(t)}}_onGeometryChanged(){this._disposeLine(this._outline),this._disposeObjects(),this._createGlObjects()}_disposeObjects(){this._outline=null,this._glObjects=[]}_createGlObjects(){const t=this._geometry instanceof zy?this._geometry.getPoints3d(this._transform):this._geometry.getVertices3d(this._transform);this._outline=this._createOutine(t,this._options.color),this._glObjects=[this._outline]}}class By{constructor(t,e){this._component=t,this._navigator=e,this._tagOperation$=new ht,this._createPoints$=new ht,this._createPolygon$=new ht,this._createRect$=new ht,this._delete$=new ht,this._tag$=this._tagOperation$.pipe(ti(((t,e)=>e(t)),null),ei()),this._replayedTag$=this._tag$.pipe(Je(1),lt()),this._replayedTag$.subscribe(),this._createPoints$.pipe(ui(this._component.configuration$,this._navigator.stateService.currentTransform$),ee((([t,e,i])=>()=>{const n=new l_([[t[0],t[1]],[t[0],t[1]]]);return new Py(n,{color:e.createColor,indicateCompleter:e.indicatePointsCompleter},i)}))).subscribe(this._tagOperation$),this._createRect$.pipe(ui(this._component.configuration$,this._navigator.stateService.currentTransform$),ee((([t,e,i])=>()=>{const n=new zy([t[0],t[1],t[0],t[1]]);return new Ly(n,{color:e.createColor},i)}))).subscribe(this._tagOperation$),this._createPolygon$.pipe(ui(this._component.configuration$,this._navigator.stateService.currentTransform$),ee((([t,e,i])=>()=>{const n=new Dy([[t[0],t[1]],[t[0],t[1]],[t[0],t[1]]]);return new Ly(n,{color:e.createColor},i)}))).subscribe(this._tagOperation$),this._delete$.pipe(ee((()=>()=>null))).subscribe(this._tagOperation$)}get createRect$(){return this._createRect$}get createPolygon$(){return this._createPolygon$}get createPoints$(){return this._createPoints$}get delete$(){return this._delete$}get tag$(){return this._tag$}get replayedTag$(){return this._replayedTag$}}class Oy{render(t,e,i,n,r){let a=[];for(const o of t)a=a.concat(o.getDOMObjects(i,n,r));return null!=e&&(a=a.concat(e.getDOMObjects(n,r))),Sm.h("div.mapillary-tag-container",{},a)}clear(){return Sm.h("div",{},[])}}class Fy{constructor(t,e){this._createTag=null,this._needsRender=!1,this._raycaster=e||new Mh,this._scene=t||new Rl,this._objectTags={},this._retrievableObjects=[],this._tags={}}get needsRender(){return this._needsRender}add(t){for(let e of t)e.tag.id in this._tags&&this._remove(e.tag.id),this._add(e);this._needsRender=!0}addCreateTag(t){for(const e of t.glObjects)this._scene.add(e);this._createTag={tag:t,objects:t.glObjects},this._needsRender=!0}clear(){for(const t of Object.keys(this._tags))this._remove(t);this._needsRender=!1}get(t){return this.has(t)?this._tags[t].tag:void 0}has(t){return t in this._tags}hasCreateTag(){return null!=this._createTag}intersectObjects([t,e],i){this._raycaster.setFromCamera(new sn(t,e),i);const n=this._raycaster.intersectObjects(this._retrievableObjects),r=[];for(const a of n)a.object.uuid in this._objectTags&&r.push(this._objectTags[a.object.uuid]);return r}remove(t){for(const e of t)this._remove(e);this._needsRender=!0}removeAll(){for(const t of Object.keys(this._tags))this._remove(t);this._needsRender=!0}removeCreateTag(){if(null!=this._createTag){for(const t of this._createTag.objects)this._scene.remove(t);this._createTag.tag.dispose(),this._createTag=null,this._needsRender=!0}}render(t,e){e.render(this._scene,t),this._needsRender=!1}update(){this._needsRender=!0}updateCreateTagObjects(t){if(this._createTag.tag!==t)throw new Error("Create tags do not have the same reference.");for(let e of this._createTag.objects)this._scene.remove(e);for(const e of t.glObjects)this._scene.add(e);this._createTag.objects=t.glObjects,this._needsRender=!0}updateObjects(t){const e=t.tag.id;if(this._tags[e].tag!==t)throw new Error("Tags do not have the same reference.");const i=this._tags[e];this._removeObjects(i),delete this._tags[e],this._add(t),this._needsRender=!0}_add(t){const e=t.tag.id,i={tag:t,objects:[],retrievableObjects:[]};this._tags[e]=i;for(const n of t.getGLObjects())i.objects.push(n),this._scene.add(n);for(const n of t.getRetrievableObjects())i.retrievableObjects.push(n),this._retrievableObjects.push(n),this._objectTags[n.uuid]=t.tag.id}_remove(t){const e=this._tags[t];this._removeObjects(e),e.tag.dispose(),delete this._tags[t]}_removeObjects(t){for(const e of t.objects)this._scene.remove(e);for(const e of t.retrievableObjects){const t=this._retrievableObjects.indexOf(e);-1!==t&&this._retrievableObjects.splice(t,1)}}}var Ny,Uy,$y,Vy;!function(t){t[t.Default=0]="Default",t[t.CreatePoint=1]="CreatePoint",t[t.CreatePoints=2]="CreatePoints",t[t.CreatePolygon=3]="CreatePolygon",t[t.CreateRect=4]="CreateRect",t[t.CreateRectDrag=5]="CreateRectDrag"}(Ny||(Ny={})),function(t){t[t.None=0]="None",t[t.Centroid=1]="Centroid",t[t.Vertex=2]="Vertex"}(Uy||(Uy={}));class jy{constructor(t,e,i){this._tag=t,this._transform=e,this._viewportCoords=i||new Am,this._glObjectsChanged$=new ht,this._interact$=new ht}get glObjectsChanged$(){return this._glObjectsChanged$}get interact$(){return this._interact$}get tag(){return this._tag}}class qy extends jy{constructor(t,e){super(t,e),this._geometryChangedSubscription=this._tag.geometry.changed$.subscribe((()=>{this._onGeometryChanged()})),this._changedSubscription=this._tag.changed$.subscribe((()=>{this._onTagChanged()&&this._glObjectsChanged$.next(this)}))}dispose(){this._changedSubscription.unsubscribe(),this._geometryChangedSubscription.unsubscribe()}_colorToCss(t){return"#"+("000000"+t.toString(16)).substr(-6)}_createFill(){let t=this._getTriangles(),e=new Float32Array(t),i=new ra;i.setAttribute("position",new Wr(e,3)),i.computeBoundingSphere();let n=new qr({side:2,transparent:!0});return this._updateFillMaterial(n),new wa(i,n)}_createLine(t){let e=this._getLinePositions(t),i=new ra;i.setAttribute("position",new Wr(e,3)),i.computeBoundingSphere();let n=new lc;this._updateLineBasicMaterial(n);const r=new fc(i,n);return r.renderOrder=1,r}_createOutline(){return this._createLine(this._getPoints3d())}_disposeFill(){null!=this._fill&&(this._fill.geometry.dispose(),this._fill.material.dispose(),this._fill=null)}_disposeOutline(){null!=this._outline&&(this._outline.geometry.dispose(),this._outline.material.dispose(),this._outline=null)}_getLinePositions(t){let e=t.length,i=new Float32Array(3*e);for(let n=0;n<e;++n){let e=3*n,r=t[n];i[e+0]=r[0],i[e+1]=r[1],i[e+2]=r[2]}return i}_interact(t,e,i){return n=>{let r=n.offsetX-n.target.offsetWidth/2,a=n.offsetY-n.target.offsetHeight/2;this._interact$.next({cursor:e,offsetX:r,offsetY:a,operation:t,tag:this._tag,vertexIndex:i})}}_updateFillGeometry(){let t=this._getTriangles(),e=new Float32Array(t),i=this._fill.geometry,n=i.getAttribute("position");n.array.length===e.length?(n.set(e),n.needsUpdate=!0):(i.deleteAttribute("position"),i.setAttribute("position",new Wr(e,3))),i.computeBoundingSphere()}_updateLine(t,e){let i=this._getLinePositions(e),n=t.geometry,r=n.getAttribute("position");r.set(i),r.needsUpdate=!0,n.computeBoundingSphere()}_updateOulineGeometry(){this._updateLine(this._outline,this._getPoints3d())}}class Gy extends qy{constructor(t,e){super(t,e),this._rectGeometry=new zy(this._tag.geometry.getRect2d(e)),this._fill=Qh(e.cameraType)?null:this._createFill(),this._outline=this._tag.lineWidth>=1?this._createOutline():null}dispose(){super.dispose(),this._disposeFill(),this._disposeOutline()}getDOMObjects(t,e,i){const n=[],r={offsetHeight:i.height,offsetWidth:i.width};if(!this._tag.editable)return n;const a=this._colorToCss(this._tag.lineColor),o=this._tag.geometry.getPoints2d();for(let s=0;s<o.length;s++){const[t,i]=o[s],l=this._viewportCoords.basicToCanvasSafe(t,i,r,this._transform,e);if(null==l)continue;const c="crosshair",u=this._interact(Uy.Vertex,c,s),h=`translate(-50%, -50%) translate(${Math.round(l[0])}px,${Math.round(l[1])}px)`,p={onpointerdown:u,style:{background:a,transform:h,cursor:c}};if(n.push(Sm.h("div.mapillary-tag-resizer",p,[])),!this._tag.indicateVertices)continue;const d={style:{background:a,transform:h}};n.push(Sm.h("div.mapillary-tag-vertex",d,[]))}return n}getGLObjects(){const t=[];return null!=this._fill&&t.push(this._fill),null!=this._outline&&t.push(this._outline),t}getRetrievableObjects(){return null!=this._fill?[this._fill]:[]}_onGeometryChanged(){this._rectGeometry=new zy(this._tag.geometry.getRect2d(this._transform)),null!=this._fill&&this._updateFillGeometry(),null!=this._outline&&this._updateOulineGeometry()}_onTagChanged(){let t=!1;return null!=this._fill&&this._updateFillMaterial(this._fill.material),null==this._outline?this._tag.lineWidth>=1&&(this._outline=this._createOutline(),t=!0):this._updateOutlineMaterial(),t}_getPoints3d(){return this._rectGeometry.getPoints3d(this._transform)}_getTriangles(){return this._rectGeometry.getTriangles3d(this._transform)}_updateFillMaterial(t){t.color=new jr(this._tag.fillColor),t.opacity=this._tag.fillOpacity,t.needsUpdate=!0}_updateLineBasicMaterial(t){t.color=new jr(this._tag.lineColor),t.linewidth=Math.max(this._tag.lineWidth,1),t.visible=this._tag.lineWidth>=1&&this._tag.lineOpacity>0,t.opacity=this._tag.lineOpacity,t.transparent=this._tag.lineOpacity<1,t.needsUpdate=!0}_updateOutlineMaterial(){let t=this._outline.material;this._updateLineBasicMaterial(t)}}class Hy extends Em{constructor(t,e){super(),this._id=t,this._geometry=e,this._notifyChanged$=new ht,this._notifyChanged$.subscribe((t=>{const e={target:this,type:"tag"};this.fire("tag",e)})),this._geometry.changed$.subscribe((t=>{const e="geometry",i={target:this,type:e};this.fire(e,i)}))}get id(){return this._id}get geometry(){return this._geometry}get changed$(){return this._notifyChanged$}get geometryChanged$(){return this._geometry.changed$.pipe(ee((()=>this)),ei())}fire(t,e){super.fire(t,e)}off(t,e){super.off(t,e)}on(t,e){super.on(t,e)}}class Wy extends Hy{constructor(t,e,i){super(t,e),i=i||{},this._editable=null!=i.editable&&i.editable,this._fillColor=null==i.fillColor?16777215:i.fillColor,this._fillOpacity=null==i.fillOpacity?0:i.fillOpacity,this._indicateVertices=null==i.indicateVertices||i.indicateVertices,this._lineColor=null==i.lineColor?16777215:i.lineColor,this._lineOpacity=null==i.lineOpacity?1:i.lineOpacity,this._lineWidth=null==i.lineWidth?1:i.lineWidth}get editable(){return this._editable}set editable(t){this._editable=t,this._notifyChanged$.next(this)}get fillColor(){return this._fillColor}set fillColor(t){this._fillColor=t,this._notifyChanged$.next(this)}get fillOpacity(){return this._fillOpacity}set fillOpacity(t){this._fillOpacity=t,this._notifyChanged$.next(this)}get geometry(){return this._geometry}get indicateVertices(){return this._indicateVertices}set indicateVertices(t){this._indicateVertices=t,this._notifyChanged$.next(this)}get lineColor(){return this._lineColor}set lineColor(t){this._lineColor=t,this._notifyChanged$.next(this)}get lineOpacity(){return this._lineOpacity}set lineOpacity(t){this._lineOpacity=t,this._notifyChanged$.next(this)}get lineWidth(){return this._lineWidth}set lineWidth(t){this._lineWidth=t,this._notifyChanged$.next(this)}setOptions(t){this._editable=null==t.editable?this._editable:t.editable,this._indicateVertices=null==t.indicateVertices?this._indicateVertices:t.indicateVertices,this._lineColor=null==t.lineColor?this._lineColor:t.lineColor,this._lineWidth=null==t.lineWidth?this._lineWidth:t.lineWidth,this._fillColor=null==t.fillColor?this._fillColor:t.fillColor,this._fillOpacity=null==t.fillOpacity?this._fillOpacity:t.fillOpacity,this._notifyChanged$.next(this)}}!function(t){t[t.TwoDimensional=0]="TwoDimensional",t[t.ThreeDimensional=1]="ThreeDimensional"}($y||($y={}));class Zy extends qy{constructor(t,e){super(t,e),this._fill=Qh(e.cameraType)?t.domain===$y.TwoDimensional&&t.geometry instanceof Dy?this._createFill():null:this._createFill(),this._holes=this._tag.lineWidth>=1?this._createHoles():[],this._outline=this._tag.lineWidth>=1?this._createOutline():null}dispose(){super.dispose(),this._disposeFill(),this._disposeHoles(),this._disposeOutline()}getDOMObjects(t,e,i){const n=[],r=this._tag.geometry instanceof zy,a=!Qh(this._transform.cameraType),o={offsetHeight:i.height,offsetWidth:i.width};if(null!=this._tag.icon&&(r||a)){const[i,r]=this._tag.geometry instanceof zy?this._tag.geometry.getVertex2d(this._tag.iconIndex):this._tag.geometry.getPoleOfInaccessibility2d(),a=this._viewportCoords.basicToCanvasSafe(i,r,o,this._transform,e);if(null!=a){const e=()=>{this._interact$.next({offsetX:0,offsetY:0,operation:Uy.None,tag:this._tag})};if(t.loaded){const i=t.getDOMSprite(this._tag.icon,this._tag.iconFloat),r=t=>{t.stopPropagation(),this._tag.click$.next(this._tag)},o={onclick:r,onpointerdown:e,style:{transform:`translate(${Math.round(a[0])}px,${Math.round(a[1])}px)`}};n.push(Sm.h("div.mapillary-tag-symbol",o,[i]))}}}else if(null!=this._tag.text&&(r||a)){const[t,i]=this._tag.geometry instanceof zy?this._tag.geometry.getVertex2d(3):this._tag.geometry.getPoleOfInaccessibility2d(),r=this._viewportCoords.basicToCanvasSafe(t,i,o,this._transform,e);if(null!=r){const t=Math.round(r[0]),e=Math.round(r[1]),i=this._tag.geometry instanceof zy?`translate(${t}px,${e}px)`:`translate(-50%, -50%) translate(${t}px,${e}px)`,a={onpointerdown:()=>{this._interact$.next({offsetX:0,offsetY:0,operation:Uy.None,tag:this._tag})},style:{color:this._colorToCss(this._tag.textColor),transform:i},textContent:this._tag.text};n.push(Sm.h("span.mapillary-tag-symbol",a,[]))}}if(!this._tag.editable)return n;const s=this._colorToCss(this._tag.lineColor);if(this._tag.geometry instanceof zy){const[t,i]=this._tag.geometry.getCentroid2d(),r=this._viewportCoords.basicToCanvasSafe(t,i,o,this._transform,e);if(null!=r){const t={onpointerdown:this._interact(Uy.Centroid,"move"),style:{background:s,transform:`translate(-50%, -50%) translate(${Math.round(r[0])}px,${Math.round(r[1])}px)`}};n.push(Sm.h("div.mapillary-tag-mover",t,[]))}}const l=this._tag.geometry.getVertices2d();for(let c=0;c<l.length-1;c++){if(r&&(null!=this._tag.icon&&c===this._tag.iconIndex||null==this._tag.icon&&null!=this._tag.text&&3===c))continue;const[t,i]=l[c],a=this._viewportCoords.basicToCanvasSafe(t,i,o,this._transform,e);if(null==a)continue;const u=r?c%2===0?"nesw-resize":"nwse-resize":"crosshair",h=this._interact(Uy.Vertex,u,c),p=`translate(-50%, -50%) translate(${Math.round(a[0])}px,${Math.round(a[1])}px)`,d={onpointerdown:h,style:{background:s,transform:p,cursor:u}};if(n.push(Sm.h("div.mapillary-tag-resizer",d,[])),!this._tag.indicateVertices)continue;const f={style:{background:s,transform:p}};n.push(Sm.h("div.mapillary-tag-vertex",f,[]))}return n}getGLObjects(){const t=[];null!=this._fill&&t.push(this._fill);for(const e of this._holes)t.push(e);return null!=this._outline&&t.push(this._outline),t}getRetrievableObjects(){return null!=this._fill?[this._fill]:[]}_onGeometryChanged(){null!=this._fill&&this._updateFillGeometry(),this._holes.length>0&&this._updateHoleGeometries(),null!=this._outline&&this._updateOulineGeometry()}_onTagChanged(){let t=!1;return null!=this._fill&&this._updateFillMaterial(this._fill.material),null==this._outline?this._tag.lineWidth>=1&&(this._holes=this._createHoles(),this._outline=this._createOutline(),t=!0):(this._updateHoleMaterials(),this._updateOutlineMaterial()),t}_getPoints3d(){return this._in3dDomain()?this._tag.geometry.getVertices3d(this._transform):this._tag.geometry.getPoints3d(this._transform)}_getTriangles(){return this._in3dDomain()?this._tag.geometry.get3dDomainTriangles3d(this._transform):this._tag.geometry.getTriangles3d(this._transform)}_updateFillMaterial(t){t.color=new jr(this._tag.fillColor),t.opacity=this._tag.fillOpacity,t.needsUpdate=!0}_updateLineBasicMaterial(t){t.color=new jr(this._tag.lineColor),t.linewidth=Math.max(this._tag.lineWidth,1),t.visible=this._tag.lineWidth>=1&&this._tag.lineOpacity>0,t.opacity=this._tag.lineOpacity,t.transparent=this._tag.lineOpacity<1,t.needsUpdate=!0}_createHoles(){let t=[];if(this._tag.geometry instanceof Dy){let e=this._getHoles3d();for(let i of e){let e=this._createLine(i);t.push(e)}}return t}_disposeHoles(){for(let t of this._holes)t.geometry.dispose(),t.material.dispose();this._holes=[]}_getHoles3d(){const t=this._tag.geometry;return this._in3dDomain()?t.getHoleVertices3d(this._transform):t.getHolePoints3d(this._transform)}_in3dDomain(){return this._tag.geometry instanceof Dy&&this._tag.domain===$y.ThreeDimensional}_updateHoleGeometries(){let t=this._getHoles3d();if(t.length!==this._holes.length)throw new Error("Changing the number of holes is not supported.");for(let e=0;e<this._holes.length;e++){let i=t[e],n=this._holes[e];this._updateLine(n,i)}}_updateHoleMaterials(){for(const t of this._holes)this._updateLineBasicMaterial(t.material)}_updateOutlineMaterial(){this._updateLineBasicMaterial(this._outline.material)}}!function(t){t[t.Bottom=0]="Bottom",t[t.BottomLeft=1]="BottomLeft",t[t.BottomRight=2]="BottomRight",t[t.Center=3]="Center",t[t.Left=4]="Left",t[t.Right=5]="Right",t[t.Top=6]="Top",t[t.TopLeft=7]="TopLeft",t[t.TopRight=8]="TopRight"}(Vy||(Vy={}));class Yy extends Hy{constructor(t,e,i){super(t,e);const n=null!=(i=i||{}).domain&&e instanceof Dy?i.domain:$y.TwoDimensional,r=this._twoDimensionalPolygon(n,e);this._domain=n,this._editable=null!=i.editable&&!r&&i.editable,this._fillColor=null==i.fillColor?16777215:i.fillColor,this._fillOpacity=null==i.fillOpacity?0:i.fillOpacity,this._icon=void 0===i.icon?null:i.icon,this._iconFloat=null==i.iconFloat?Vy.Center:i.iconFloat,this._iconIndex=null==i.iconIndex?3:i.iconIndex,this._indicateVertices=null==i.indicateVertices||i.indicateVertices,this._lineColor=null==i.lineColor?16777215:i.lineColor,this._lineOpacity=null==i.lineOpacity?1:i.lineOpacity,this._lineWidth=null==i.lineWidth?1:i.lineWidth,this._text=void 0===i.text?null:i.text,this._textColor=null==i.textColor?16777215:i.textColor,this._click$=new ht,this._click$.subscribe((()=>{const t="click",e={target:this,type:t};this.fire(t,e)}))}get click$(){return this._click$}get domain(){return this._domain}get editable(){return this._editable}set editable(t){this._twoDimensionalPolygon(this._domain,this._geometry)||(this._editable=t,this._notifyChanged$.next(this))}get fillColor(){return this._fillColor}set fillColor(t){this._fillColor=t,this._notifyChanged$.next(this)}get fillOpacity(){return this._fillOpacity}set fillOpacity(t){this._fillOpacity=t,this._notifyChanged$.next(this)}get geometry(){return this._geometry}get icon(){return this._icon}set icon(t){this._icon=t,this._notifyChanged$.next(this)}get iconFloat(){return this._iconFloat}set iconFloat(t){this._iconFloat=t,this._notifyChanged$.next(this)}get iconIndex(){return this._iconIndex}set iconIndex(t){this._iconIndex=t,this._notifyChanged$.next(this)}get indicateVertices(){return this._indicateVertices}set indicateVertices(t){this._indicateVertices=t,this._notifyChanged$.next(this)}get lineColor(){return this._lineColor}set lineColor(t){this._lineColor=t,this._notifyChanged$.next(this)}get lineOpacity(){return this._lineOpacity}set lineOpacity(t){this._lineOpacity=t,this._notifyChanged$.next(this)}get lineWidth(){return this._lineWidth}set lineWidth(t){this._lineWidth=t,this._notifyChanged$.next(this)}get text(){return this._text}set text(t){this._text=t,this._notifyChanged$.next(this)}get textColor(){return this._textColor}set textColor(t){this._textColor=t,this._notifyChanged$.next(this)}fire(t,e){super.fire(t,e)}off(t,e){super.off(t,e)}on(t,e){super.on(t,e)}setOptions(t){const e=this._twoDimensionalPolygon(this._domain,this._geometry);this._editable=e||null==t.editable?this._editable:t.editable,this._icon=void 0===t.icon?this._icon:t.icon,this._iconFloat=null==t.iconFloat?this._iconFloat:t.iconFloat,this._iconIndex=null==t.iconIndex?this._iconIndex:t.iconIndex,this._indicateVertices=null==t.indicateVertices?this._indicateVertices:t.indicateVertices,this._lineColor=null==t.lineColor?this._lineColor:t.lineColor,this._lineWidth=null==t.lineWidth?this._lineWidth:t.lineWidth,this._fillColor=null==t.fillColor?this._fillColor:t.fillColor,this._fillOpacity=null==t.fillOpacity?this._fillOpacity:t.fillOpacity,this._text=void 0===t.text?this._text:t.text,this._textColor=null==t.textColor?this._textColor:t.textColor,this._notifyChanged$.next(this)}_twoDimensionalPolygon(t,e){return t!==$y.ThreeDimensional&&e instanceof Dy}}class Xy extends jy{dispose(){}getDOMObjects(t,e,i){const n=this._tag,r={offsetHeight:i.height,offsetWidth:i.width},a=[],[o,s]=n.geometry.getCentroid2d(),l=this._viewportCoords.basicToCanvasSafe(o,s,r,this._transform,e);if(null!=l){const e=t=>{this._interact$.next({offsetX:0,offsetY:0,operation:Uy.None,tag:n})},i=Math.round(l[0]),r=Math.round(l[1]);if(null!=n.icon){if(t.loaded){const o=t.getDOMSprite(n.icon,Vy.Bottom),s={onpointerdown:e,style:{pointerEvents:"all",transform:`translate(${i}px,${r+8}px)`}};a.push(Sm.h("div",s,[o]))}}else if(null!=n.text){const t=`translate(-50%,0%) translate(${i}px,${r+8}px)`,o={onpointerdown:e,style:{color:this._colorToCss(n.textColor),transform:t},textContent:n.text};a.push(Sm.h("span.mapillary-tag-symbol",o,[]))}const o=this._interact(Uy.Centroid,n,"move"),s=this._colorToCss(n.color),c=`translate(-50%,-50%) translate(${i}px,${r}px)`;if(n.editable){let t={onpointerdown:o,style:{background:s,transform:c}};a.push(Sm.h("div.mapillary-tag-spot-interactor",t,[]))}const u={style:{background:s,transform:c}};a.push(Sm.h("div.mapillary-tag-vertex",u,[]))}return a}getGLObjects(){return[]}getRetrievableObjects(){return[]}_colorToCss(t){return"#"+("000000"+t.toString(16)).substr(-6)}_interact(t,e,i,n){return r=>{const a=r.offsetX-r.target.offsetWidth/2,o=r.offsetY-r.target.offsetHeight/2;this._interact$.next({cursor:i,offsetX:a,offsetY:o,operation:t,tag:e,vertexIndex:n})}}}class Ky extends Hy{constructor(t,e,i){super(t,e),i=i||{},this._color=null==i.color?16777215:i.color,this._editable=null!=i.editable&&i.editable,this._icon=void 0===i.icon?null:i.icon,this._text=void 0===i.text?null:i.text,this._textColor=null==i.textColor?16777215:i.textColor}get color(){return this._color}set color(t){this._color=t,this._notifyChanged$.next(this)}get editable(){return this._editable}set editable(t){this._editable=t,this._notifyChanged$.next(this)}get icon(){return this._icon}set icon(t){this._icon=t,this._notifyChanged$.next(this)}get text(){return this._text}set text(t){this._text=t,this._notifyChanged$.next(this)}get textColor(){return this._textColor}set textColor(t){this._textColor=t,this._notifyChanged$.next(this)}setOptions(t){this._color=null==t.color?this._color:t.color,this._editable=null==t.editable?this._editable:t.editable,this._icon=void 0===t.icon?this._icon:t.icon,this._text=void 0===t.text?this._text:t.text,this._textColor=null==t.textColor?this._textColor:t.textColor,this._notifyChanged$.next(this)}}class Jy{constructor(){this._active=!1,this._hash={},this._hashDeactivated={},this._notifyChanged$=new ht}get active(){return this._active}get changed$(){return this._notifyChanged$}activate(t){if(!this._active){for(const e in this._hashDeactivated){if(!this._hashDeactivated.hasOwnProperty(e))continue;const i=this._hashDeactivated[e];this._add(i,t)}this._hashDeactivated={},this._active=!0,this._notifyChanged$.next(this)}}deactivate(){if(this._active){for(const t in this._hash)this._hash.hasOwnProperty(t)&&(this._hashDeactivated[t]=this._hash[t].tag);this._hash={},this._active=!1}}add(t,e){this._assertActivationState(!0);for(const i of t)this._add(i,e);this._notifyChanged$.next(this)}addDeactivated(t){this._assertActivationState(!1);for(const e of t){if(!(e instanceof Yy||e instanceof Ky||e instanceof Wy))throw new Error("Tag type not supported");this._hashDeactivated[e.id]=e}}get(t){return this.has(t)?this._hash[t]:void 0}getAll(){const t=this._hash;return Object.keys(t).map((e=>t[e]))}getAllDeactivated(){const t=this._hashDeactivated;return Object.keys(t).map((e=>t[e]))}getDeactivated(t){return this.hasDeactivated(t)?this._hashDeactivated[t]:void 0}has(t){return t in this._hash}hasDeactivated(t){return t in this._hashDeactivated}remove(t){this._assertActivationState(!0);const e=this._hash;for(const i of t)i in e&&delete e[i];this._notifyChanged$.next(this)}removeAll(){this._assertActivationState(!0),this._hash={},this._notifyChanged$.next(this)}removeAllDeactivated(){this._assertActivationState(!1),this._hashDeactivated={}}removeDeactivated(t){this._assertActivationState(!1);const e=this._hashDeactivated;for(const i of t)i in e&&delete e[i]}_add(t,e){if(t instanceof Yy)this._hash[t.id]=new Zy(t,e);else if(t instanceof Ky)this._hash[t.id]=new Xy(t,e);else{if(!(t instanceof Wy))throw new Error("Tag type not supported");this._hash[t.id]=new Gy(t,e)}}_assertActivationState(t){if(t!==this._active)throw new Error("Tag set not in correct state for operation.")}}class Qy extends o_{constructor(t){super();let e=t[0],i=t[1];if(e<0||e>1||i<0||i>1)throw new s_("Basic coordinates must be on the interval [0, 1].");this._point=t.slice()}get point(){return this._point}getCentroid2d(){return this._point.slice()}getCentroid3d(t){return t.unprojectBasic(this._point,200)}setCentroid2d(t,e){let i=[Math.max(0,Math.min(1,t[0])),Math.max(0,Math.min(1,t[1]))];this._point[0]=i[0],this._point[1]=i[1],this._notifyChanged$.next(this)}}class tv extends ag{constructor(t,e,i,n){super(t,e,i),this._name=`${this._component.name}-${this._getNameExtension()}`,this._viewportCoords=n}_getConfiguration(t){return{}}_mouseEventToBasic(t,e,i,n,r,a){r=null!=r?r:0,a=null!=a?a:0;const[o,s]=this._viewportCoords.canvasPosition(t,e);return this._viewportCoords.canvasToBasic(o-r,s-a,e,n,i.perspective)}}class ev extends tv{constructor(t,e,i,n,r){super(t,e,i,n),this._tagCreator=r,this._geometryCreated$=new ht}get geometryCreated$(){return this._geometryCreated$}_enable(){this._enableCreate(),this._container.container.classList.add("component-tag-create")}_disable(){this._container.container.classList.remove("component-tag-create"),this._disableCreate()}_validateBasic(t){const e=t[0],i=t[1];return 0<=e&&e<=1&&0<=i&&i<=1}_mouseEventToBasic$(t){return t.pipe(ui(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$),ee((([t,e,i])=>this._mouseEventToBasic(t,this._container.container,e,i))))}}class iv extends ev{_enableCreate(){this._container.mouseService.deferPixels(this._name,4),this._geometryCreatedSubscription=this._mouseEventToBasic$(this._container.mouseService.proximateClick$).pipe(Ce(this._validateBasic),ee((t=>new Qy(t)))).subscribe(this._geometryCreated$)}_disableCreate(){this._container.mouseService.undeferPixels(this._name),this._geometryCreatedSubscription.unsubscribe()}_getNameExtension(){return"create-point"}}class nv extends ev{_enableCreate(){this._container.mouseService.deferPixels(this._name,4);const t=this._navigator.stateService.currentTransform$.pipe(ee((()=>{})),Je(1),lt());this._deleteSubscription=t.pipe(ni(1)).subscribe(this._tagCreator.delete$);const e=this._mouseEventToBasic$(this._container.mouseService.proximateClick$).pipe(ei());this._createSubscription=t.pipe(oi((()=>e.pipe(Ce(this._validateBasic),Ne(1))))).subscribe(this._create$),this._setVertexSubscription=this._tagCreator.tag$.pipe(oi((t=>t?ue(Zt(t),Ee(this._container.mouseService.mouseMove$,this._container.mouseService.domMouseMove$),this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$):Et()))).subscribe((([t,e,i,n])=>{const r=this._mouseEventToBasic(e,this._container.container,i,n);this._setVertex2d(t,r,n)})),this._addPointSubscription=this._tagCreator.tag$.pipe(oi((t=>t?ue(Zt(t),e):Et()))).subscribe((([t,e])=>{this._addPoint(t,e)})),this._geometryCreateSubscription=this._tagCreator.tag$.pipe(oi((t=>t?t.created$.pipe(ee((t=>t.geometry))):Et()))).subscribe(this._geometryCreated$)}_disableCreate(){this._container.mouseService.undeferPixels(this._name),this._tagCreator.delete$.next(null),this._addPointSubscription.unsubscribe(),this._createSubscription.unsubscribe(),this._deleteSubscription.unsubscribe(),this._geometryCreateSubscription.unsubscribe(),this._setVertexSubscription.unsubscribe()}}class rv extends nv{get _create$(){return this._tagCreator.createPoints$}_addPoint(t,e){t.geometry.addPoint2d(e)}_getNameExtension(){return"create-points"}_setVertex2d(t,e,i){t.geometry.setPoint2d(t.geometry.points.length-1,e,i)}}class av extends nv{get _create$(){return this._tagCreator.createPolygon$}_addPoint(t,e){t.addPoint(e)}_getNameExtension(){return"create-polygon"}_setVertex2d(t,e,i){t.geometry.setVertex2d(t.geometry.polygon.length-2,e,i)}}class ov extends nv{get _create$(){return this._tagCreator.createRect$}_addPoint(t,e){const i=t.geometry;i.validate(e)||(e=i.getNonAdjustedVertex2d(3)),t.addPoint(e)}_enable(){super._enable(),this._initializeAnchorIndexingSubscription=this._tagCreator.tag$.pipe(Ce((t=>!!t))).subscribe((t=>{t.geometry.initializeAnchorIndexing()}))}_disable(){super._disable(),this._initializeAnchorIndexingSubscription.unsubscribe()}_getNameExtension(){return"create-rect"}_setVertex2d(t,e,i){t.geometry.setOppositeVertex2d(e,i)}}class sv extends ev{_enableCreate(){this._container.mouseService.claimMouse(this._name,2),this._deleteSubscription=this._navigator.stateService.currentTransform$.pipe(ee((t=>null)),ni(1)).subscribe(this._tagCreator.delete$),this._createSubscription=this._mouseEventToBasic$(this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragStart$)).pipe(Ce(this._validateBasic)).subscribe(this._tagCreator.createRect$),this._initializeAnchorIndexingSubscription=this._tagCreator.tag$.pipe(Ce((t=>!!t))).subscribe((t=>{t.geometry.initializeAnchorIndexing()}));const t=ue(Ee(this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseMove$),this._container.mouseService.filtered$(this._name,this._container.mouseService.domMouseMove$)),this._container.renderService.renderCamera$).pipe(ui(this._navigator.stateService.currentTransform$),ee((([[t,e],i])=>this._mouseEventToBasic(t,this._container.container,e,i))));this._setVertexSubscription=this._tagCreator.tag$.pipe(oi((e=>e?ue(Zt(e),t,this._navigator.stateService.currentTransform$):Et()))).subscribe((([t,e,i])=>{t.geometry.setOppositeVertex2d(e,i)}));const e=this._container.mouseService.mouseDragEnd$.pipe(ui(this._mouseEventToBasic$(this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDrag$)).pipe(Ce(this._validateBasic)),((t,e)=>e)),ei());this._addPointSubscription=this._tagCreator.tag$.pipe(oi((t=>t?ue(Zt(t),e):Et()))).subscribe((([t,e])=>{const i=t.geometry;i.validate(e)||(e=i.getNonAdjustedVertex2d(3)),t.addPoint(e)})),this._geometryCreatedSubscription=this._tagCreator.tag$.pipe(oi((t=>t?t.created$.pipe(ee((t=>t.geometry))):Et()))).subscribe(this._geometryCreated$)}_disableCreate(){this._container.mouseService.unclaimMouse(this._name),this._tagCreator.delete$.next(null),this._addPointSubscription.unsubscribe(),this._createSubscription.unsubscribe(),this._deleteSubscription.unsubscribe(),this._geometryCreatedSubscription.unsubscribe(),this._initializeAnchorIndexingSubscription.unsubscribe(),this._setVertexSubscription.unsubscribe()}_getNameExtension(){return"create-rect-drag"}}class lv extends tv{constructor(t,e,i,n,r){super(t,e,i,n),this._tagSet=r}_enable(){const t=this._tagSet.changed$.pipe(ee((t=>t.getAll())),oi((t=>Ft(t).pipe(fe((t=>t.interact$))))),oi((t=>_e(Zt(t),this._container.mouseService.documentMouseUp$.pipe(ee((()=>({offsetX:0,offsetY:0,operation:Uy.None,tag:null}))),He())))),ei());Ee(this._container.mouseService.mouseMove$,this._container.mouseService.domMouseMove$).pipe(ei()),this._claimMouseSubscription=t.pipe(oi((t=>t.tag?this._container.mouseService.domMouseDragStart$:Et()))).subscribe((()=>{this._container.mouseService.claimMouse(this._name,3)})),this._cursorSubscription=t.pipe(ee((t=>t.cursor)),Ue()).subscribe((t=>{const e=["crosshair","move","nesw-resize","nwse-resize"];for(const i of e)this._container.container.classList.remove(`component-tag-edit-${i}`);t&&this._container.container.classList.add(`component-tag-edit-${t}`)})),this._unclaimMouseSubscription=this._container.mouseService.filtered$(this._name,this._container.mouseService.domMouseDragEnd$).subscribe((t=>{this._container.mouseService.unclaimMouse(this._name)})),this._preventDefaultSubscription=t.pipe(oi((t=>t.tag?this._container.mouseService.documentMouseMove$:Et()))).subscribe((t=>{t.preventDefault()})),this._updateGeometrySubscription=t.pipe(oi((t=>{if(t.operation===Uy.None||!t.tag)return Et();return ue(this._container.mouseService.filtered$(this._name,this._container.mouseService.domMouseDrag$).pipe(Ce((t=>this._viewportCoords.insideElement(t,this._container.container)))),this._container.renderService.renderCamera$).pipe(ui(Zt(t),this._navigator.stateService.currentTransform$,(([t,e],i,n)=>[t,e,i,n])))}))).subscribe((([t,e,i,n])=>{const r=this._mouseEventToBasic(t,this._container.container,e,n,i.offsetX,i.offsetY),a=i.tag.geometry;i.operation===Uy.Centroid?a.setCentroid2d(r,n):i.operation===Uy.Vertex&&a.setVertex2d(i.vertexIndex,r,n)}))}_disable(){this._claimMouseSubscription.unsubscribe(),this._cursorSubscription.unsubscribe(),this._preventDefaultSubscription.unsubscribe(),this._unclaimMouseSubscription.unsubscribe(),this._updateGeometrySubscription.unsubscribe()}_getNameExtension(){return"edit-vertex"}}class cv extends Mm{constructor(t,e,i){super(t,e,i),this._tagDomRenderer=new Oy,this._tagScene=new Fy,this._tagSet=new Jy,this._tagCreator=new By(this,i),this._viewportCoords=new Am,this._createHandlers={CreatePoint:new iv(this,e,i,this._viewportCoords,this._tagCreator),CreatePoints:new rv(this,e,i,this._viewportCoords,this._tagCreator),CreatePolygon:new av(this,e,i,this._viewportCoords,this._tagCreator),CreateRect:new ov(this,e,i,this._viewportCoords,this._tagCreator),CreateRectDrag:new sv(this,e,i,this._viewportCoords,this._tagCreator),Default:void 0},this._editVertexHandler=new lv(this,e,i,this._viewportCoords,this._tagSet),this._renderTags$=this._tagSet.changed$.pipe(ee((t=>{const e=t.getAll();return e.sort(((t,e)=>{const i=t.tag.id,n=e.tag.id;return i<n?-1:i>n?1:0})),e})),ei()),this._tagChanged$=this._renderTags$.pipe(oi((t=>Ft(t).pipe(fe((t=>Ee(t.tag.changed$,t.tag.geometryChanged$)))))),ei()),this._renderTagGLChanged$=this._renderTags$.pipe(oi((t=>Ft(t).pipe(fe((t=>t.glObjectsChanged$))))),ei()),this._createGeometryChanged$=this._tagCreator.tag$.pipe(oi((t=>null!=t?t.geometryChanged$:Et())),ei()),this._createGLObjectsChanged$=this._tagCreator.tag$.pipe(oi((t=>null!=t?t.glObjectsChanged$:Et())),ei()),this._creatingConfiguration$=this._configuration$.pipe(Ue(((t,e)=>t.mode===e.mode),(t=>({createColor:t.createColor,mode:t.mode}))),Je(1),lt()),this._creatingConfiguration$.subscribe((t=>{const e="tagmode",i={mode:t.mode,target:this,type:e};this.fire(e,i)}))}add(t){this._activated?this._navigator.stateService.currentTransform$.pipe(He()).subscribe((e=>{this._tagSet.add(t,e);const i=t.map((t=>this._tagSet.get(t.id)));this._tagScene.add(i)})):this._tagSet.addDeactivated(t)}calculateRect(t){return new Promise(((e,i)=>{this._navigator.stateService.currentTransform$.pipe(He(),ee((e=>t.getRect2d(e)))).subscribe((t=>{e(t)}),(t=>{i(t)}))}))}create(){this._tagCreator.replayedTag$.pipe(He(),Ce((t=>!!t))).subscribe((t=>{t.create()}))}changeMode(t){this.configure({mode:t})}fire(t,e){super.fire(t,e)}get(t){if(this._activated){const e=this._tagSet.get(t);return void 0!==e?e.tag:void 0}return this._tagSet.getDeactivated(t)}getAll(){return this.activated?this._tagSet.getAll().map((t=>t.tag)):this._tagSet.getAllDeactivated()}getTagIdsAt(t){return new Promise(((e,i)=>{this._container.renderService.renderCamera$.pipe(He(),ee((e=>{const i=this._viewportCoords.canvasToViewport(t[0],t[1],this._container.container);return this._tagScene.intersectObjects(i,e.perspective)}))).subscribe((t=>{e(t)}),(t=>{i(t)}))}))}has(t){return this._activated?this._tagSet.has(t):this._tagSet.hasDeactivated(t)}off(t,e){super.off(t,e)}on(t,e){super.on(t,e)}remove(t){this._activated?(this._tagSet.remove(t),this._tagScene.remove(t)):this._tagSet.removeDeactivated(t)}removeAll(){this._activated?(this._tagSet.removeAll(),this._tagScene.removeAll()):this._tagSet.removeAllDeactivated()}_activate(){this._editVertexHandler.enable();const t=Ft(Object.keys(this._createHandlers)).pipe(ee((t=>this._createHandlers[t])),Ce((t=>!!t)),fe((t=>t.geometryCreated$)),ei()),e=this._subscriptions;e.push(t.subscribe((t=>{const e="geometrycreate",i={geometry:t,target:this,type:e};this.fire(e,i)}))),e.push(this._tagCreator.tag$.pipe(ri((t=>null==t)),Ue()).subscribe((t=>{const e=null!=t?"tagcreatestart":"tagcreateend",i={target:this,type:e};this.fire(e,i)}))),e.push(t.subscribe((()=>{this.changeMode(Ny.Default)}))),e.push(this._creatingConfiguration$.subscribe((t=>{this._disableCreateHandlers();const e=Ny[t.mode],i=this._createHandlers[e];i&&i.enable()}))),e.push(this._renderTags$.subscribe((()=>{const t="tags",e={target:this,type:t};this.fire(t,e)}))),e.push(this._tagCreator.tag$.pipe(oi((t=>null!=t?t.aborted$.pipe(ee((()=>null))):Et()))).subscribe((()=>{this.changeMode(Ny.Default)}))),e.push(this._tagCreator.tag$.subscribe((t=>{this._tagScene.hasCreateTag()&&this._tagScene.removeCreateTag(),null!=t&&this._tagScene.addCreateTag(t)}))),e.push(this._createGLObjectsChanged$.subscribe((t=>{this._tagScene.updateCreateTagObjects(t)}))),e.push(this._renderTagGLChanged$.subscribe((t=>{this._tagScene.updateObjects(t)}))),e.push(this._tagChanged$.subscribe((()=>{this._tagScene.update()}))),e.push(ue(this._renderTags$.pipe(ai([]),ci((()=>{this._container.domRenderer.render$.next({name:this._name,vNode:this._tagDomRenderer.clear()})}))),this._container.renderService.renderCamera$,this._container.spriteService.spriteAtlas$,this._container.renderService.size$,this._tagChanged$.pipe(ai(null)),Ee(this._tagCreator.tag$,this._createGeometryChanged$).pipe(ai(null))).pipe(ee((([t,e,i,n,,r])=>({name:this._name,vNode:this._tagDomRenderer.render(t,r,i,e.perspective,n)})))).subscribe(this._container.domRenderer.render$)),e.push(this._navigator.stateService.currentState$.pipe(ee((t=>{const e=this._tagScene;return{name:this._name,renderer:{frameId:t.id,needsRender:e.needsRender,render:e.render.bind(e),pass:Um.Opaque}}}))).subscribe(this._container.glRenderer.render$)),this._navigator.stateService.currentTransform$.pipe(He()).subscribe((t=>{this._tagSet.activate(t),this._tagScene.add(this._tagSet.getAll())}))}_deactivate(){this._editVertexHandler.disable(),this._disableCreateHandlers(),this._tagScene.clear(),this._tagSet.deactivate(),this._tagCreator.delete$.next(null),this._subscriptions.unsubscribe(),this._container.container.classList.remove("component-tag-create")}_getDefaultConfiguration(){return{createColor:16777215,indicatePointsCompleter:!0,mode:Ny.Default}}_disableCreateHandlers(){const t=this._createHandlers;for(const e in t){if(!t.hasOwnProperty(e))continue;const i=t[e];i&&i.disable()}}}cv.componentName="tag";class uv extends Mm{constructor(t,e,i){super(t,e,i),this._viewportCoords=new Am,this._zoomDelta$=new ht}_activate(){const t=this._subscriptions;t.push(ue(this._navigator.stateService.currentState$,this._navigator.stateService.state$,this._configuration$,this._container.renderService.size$).pipe(ee((([t,e,i,n])=>{const r=t.state.zoom,a=Sm.h("div.mapillary-zoom-in-icon",[]),o=r>=3||e===tg.Waiting?Sm.h("div.mapillary-zoom-in-button-inactive",[a]):Sm.h("div.mapillary-zoom-in-button",{onclick:()=>{this._zoomDelta$.next(1)}},[a]),s=Sm.h("div.mapillary-zoom-out-icon",[]),l=r<=0||e===tg.Waiting?Sm.h("div.mapillary-zoom-out-button-inactive",[s]):Sm.h("div.mapillary-zoom-out-button",{onclick:()=>{this._zoomDelta$.next(-1)}},[s]),c=i.size===wm.Small||i.size===wm.Automatic&&n.width<640?".mapillary-zoom-compact":"";return{name:this._name,vNode:Sm.h("div.mapillary-zoom-container"+c,{oncontextmenu:t=>{t.preventDefault()}},[o,l])}}))).subscribe(this._container.domRenderer.render$)),t.push(this._zoomDelta$.pipe(ui(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$)).subscribe((([t,e,i])=>{const n=this._viewportCoords.unprojectFromViewport(0,0,e.perspective),r=i.projectBasic(n.toArray());this._navigator.stateService.zoomIn(t,r)})))}_deactivate(){this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{size:wm.Automatic}}}uv.componentName="zoom";class hv extends Mm{constructor(t,e,i,n){super(t,e,i),this._canvasId=`${e.id}-${this._name}`,this._dom=n||new Ig}_activate(){const t=this._container.domRenderer.element$.pipe(ee((()=>this._dom.document.getElementById(this._canvasId))),Ce((t=>!!t)),ee((t=>{const e=t.parentElement,i=e.offsetWidth;return[t,{height:e.offsetHeight,width:i}]})),Ue(((t,e)=>t.height===e.height&&t.width===e.width),(([,t])=>t)));this._subscriptions.push(ue(t,this._navigator.stateService.currentImage$).subscribe((([[t,e],i])=>{t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(i.image,0,0,e.width,e.height)}))),this._container.domRenderer.renderAdaptive$.next({name:this._name,vNode:Sm.h(`canvas#${this._canvasId}`,[])})}_deactivate(){this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{}}}hv.componentName="imagefallback";class pv extends Mm{constructor(t,e,i){super(t,e,i),this._seqNames={},this._seqNames[Hh[Hh.Prev]]="-prev",this._seqNames[Hh[Hh.Next]]="-next",this._spaTopNames={},this._spaTopNames[Hh[Hh.TurnLeft]]="-turn-left",this._spaTopNames[Hh[Hh.StepLeft]]="-left",this._spaTopNames[Hh[Hh.StepForward]]="-forward",this._spaTopNames[Hh[Hh.StepRight]]="-right",this._spaTopNames[Hh[Hh.TurnRight]]="-turn-right",this._spaBottomNames={},this._spaBottomNames[Hh[Hh.TurnU]]="-turn-around",this._spaBottomNames[Hh[Hh.StepBackward]]="-backward"}_activate(){this._subscriptions.push(ue(this._navigator.stateService.currentImage$,this._configuration$).pipe(oi((([t,e])=>ue(e.sequence?t.sequenceEdges$.pipe(ee((t=>t.edges.map((t=>t.data.direction))))):Zt([]),!Qh(t.cameraType)&&e.spatial?t.spatialEdges$.pipe(ee((t=>t.edges.map((t=>t.data.direction))))):Zt([])).pipe(ee((([t,e])=>t.concat(e)))))),ee((t=>{const e=this._createArrowRow(this._seqNames,t),i=this._createArrowRow(this._spaTopNames,t),n=this._createArrowRow(this._spaBottomNames,t),r=Sm.h("div.mapillary-navigation-sequence",e),a=Sm.h("div.NavigationSpatialTop",i),o=Sm.h("div.mapillary-navigation-spatial-bottom",n),s=Sm.h("div.mapillary-navigation-spatial",[a,o]);return{name:this._name,vNode:Sm.h("div.NavigationContainer",[r,s])}}))).subscribe(this._container.domRenderer.render$))}_deactivate(){this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{sequence:!0,spatial:!0}}_createArrowRow(t,e){const i=[];for(const n in t){if(!t.hasOwnProperty(n))continue;const r=Hh[n];-1!==e.indexOf(r)?i.push(this._createVNode(r,t[n],"visible")):i.push(this._createVNode(r,t[n],"hidden"))}return i}_createVNode(t,e,i){return Sm.h(`span.mapillary-navigation-button.mapillary-navigation${e}`,{onclick:()=>{this._navigator.moveDir$(t).subscribe(void 0,(t=>{t instanceof zm||console.error(t)}))},style:{visibility:i}},[])}}pv.componentName="navigationfallback";function dv(t){let e=t.length;for(;--e>=0;)t[e]=0}const fv=256,mv=286,gv=30,_v=15,yv=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),vv=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),xv=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),bv=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),wv=new Array(576);dv(wv);const Sv=new Array(60);dv(Sv);const Ev=new Array(512);dv(Ev);const Tv=new Array(256);dv(Tv);const Mv=new Array(29);dv(Mv);const Cv=new Array(gv);function Iv(t,e,i,n,r){this.static_tree=t,this.extra_bits=e,this.extra_base=i,this.elems=n,this.max_length=r,this.has_stree=t&&t.length}let Av,kv,Rv;function zv(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}dv(Cv);const Pv=t=>t<256?Ev[t]:Ev[256+(t>>>7)],Dv=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},Lv=(t,e,i)=>{t.bi_valid>16-i?(t.bi_buf|=e<<t.bi_valid&65535,Dv(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=i-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=i)},Bv=(t,e,i)=>{Lv(t,i[2*e],i[2*e+1])},Ov=(t,e)=>{let i=0;do{i|=1&t,t>>>=1,i<<=1}while(--e>0);return i>>>1},Fv=(t,e,i)=>{const n=new Array(16);let r,a,o=0;for(r=1;r<=_v;r++)n[r]=o=o+i[r-1]<<1;for(a=0;a<=e;a++){let e=t[2*a+1];0!==e&&(t[2*a]=Ov(n[e]++,e))}},Nv=t=>{let e;for(e=0;e<mv;e++)t.dyn_ltree[2*e]=0;for(e=0;e<gv;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0},Uv=t=>{t.bi_valid>8?Dv(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},$v=(t,e,i,n)=>{const r=2*e,a=2*i;return t[r]<t[a]||t[r]===t[a]&&n[e]<=n[i]},Vv=(t,e,i)=>{const n=t.heap[i];let r=i<<1;for(;r<=t.heap_len&&(r<t.heap_len&&$v(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!$v(e,n,t.heap[r],t.depth));)t.heap[i]=t.heap[r],i=r,r<<=1;t.heap[i]=n},jv=(t,e,i)=>{let n,r,a,o,s=0;if(0!==t.last_lit)do{n=t.pending_buf[t.d_buf+2*s]<<8|t.pending_buf[t.d_buf+2*s+1],r=t.pending_buf[t.l_buf+s],s++,0===n?Bv(t,r,e):(a=Tv[r],Bv(t,a+fv+1,e),o=yv[a],0!==o&&(r-=Mv[a],Lv(t,r,o)),n--,a=Pv(n),Bv(t,a,i),o=vv[a],0!==o&&(n-=Cv[a],Lv(t,n,o)))}while(s<t.last_lit);Bv(t,256,e)},qv=(t,e)=>{const i=e.dyn_tree,n=e.stat_desc.static_tree,r=e.stat_desc.has_stree,a=e.stat_desc.elems;let o,s,l,c=-1;for(t.heap_len=0,t.heap_max=573,o=0;o<a;o++)0!==i[2*o]?(t.heap[++t.heap_len]=c=o,t.depth[o]=0):i[2*o+1]=0;for(;t.heap_len<2;)l=t.heap[++t.heap_len]=c<2?++c:0,i[2*l]=1,t.depth[l]=0,t.opt_len--,r&&(t.static_len-=n[2*l+1]);for(e.max_code=c,o=t.heap_len>>1;o>=1;o--)Vv(t,i,o);l=a;do{o=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Vv(t,i,1),s=t.heap[1],t.heap[--t.heap_max]=o,t.heap[--t.heap_max]=s,i[2*l]=i[2*o]+i[2*s],t.depth[l]=(t.depth[o]>=t.depth[s]?t.depth[o]:t.depth[s])+1,i[2*o+1]=i[2*s+1]=l,t.heap[1]=l++,Vv(t,i,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((t,e)=>{const i=e.dyn_tree,n=e.max_code,r=e.stat_desc.static_tree,a=e.stat_desc.has_stree,o=e.stat_desc.extra_bits,s=e.stat_desc.extra_base,l=e.stat_desc.max_length;let c,u,h,p,d,f,m=0;for(p=0;p<=_v;p++)t.bl_count[p]=0;for(i[2*t.heap[t.heap_max]+1]=0,c=t.heap_max+1;c<573;c++)u=t.heap[c],p=i[2*i[2*u+1]+1]+1,p>l&&(p=l,m++),i[2*u+1]=p,u>n||(t.bl_count[p]++,d=0,u>=s&&(d=o[u-s]),f=i[2*u],t.opt_len+=f*(p+d),a&&(t.static_len+=f*(r[2*u+1]+d)));if(0!==m){do{for(p=l-1;0===t.bl_count[p];)p--;t.bl_count[p]--,t.bl_count[p+1]+=2,t.bl_count[l]--,m-=2}while(m>0);for(p=l;0!==p;p--)for(u=t.bl_count[p];0!==u;)h=t.heap[--c],h>n||(i[2*h+1]!==p&&(t.opt_len+=(p-i[2*h+1])*i[2*h],i[2*h+1]=p),u--)}})(t,e),Fv(i,c,t.bl_count)},Gv=(t,e,i)=>{let n,r,a=-1,o=e[1],s=0,l=7,c=4;for(0===o&&(l=138,c=3),e[2*(i+1)+1]=65535,n=0;n<=i;n++)r=o,o=e[2*(n+1)+1],++s<l&&r===o||(s<c?t.bl_tree[2*r]+=s:0!==r?(r!==a&&t.bl_tree[2*r]++,t.bl_tree[32]++):s<=10?t.bl_tree[34]++:t.bl_tree[36]++,s=0,a=r,0===o?(l=138,c=3):r===o?(l=6,c=3):(l=7,c=4))},Hv=(t,e,i)=>{let n,r,a=-1,o=e[1],s=0,l=7,c=4;for(0===o&&(l=138,c=3),n=0;n<=i;n++)if(r=o,o=e[2*(n+1)+1],!(++s<l&&r===o)){if(s<c)do{Bv(t,r,t.bl_tree)}while(0!==--s);else 0!==r?(r!==a&&(Bv(t,r,t.bl_tree),s--),Bv(t,16,t.bl_tree),Lv(t,s-3,2)):s<=10?(Bv(t,17,t.bl_tree),Lv(t,s-3,3)):(Bv(t,18,t.bl_tree),Lv(t,s-11,7));s=0,a=r,0===o?(l=138,c=3):r===o?(l=6,c=3):(l=7,c=4)}};let Wv=!1;const Zv=(t,e,i,n)=>{Lv(t,0+(n?1:0),3),((t,e,i,n)=>{Uv(t),n&&(Dv(t,i),Dv(t,~i)),t.pending_buf.set(t.window.subarray(e,e+i),t.pending),t.pending+=i})(t,e,i,!0)};var Yv=(t,e,i,n)=>{let r,a,o=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=(t=>{let e,i=4093624447;for(e=0;e<=31;e++,i>>>=1)if(1&i&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<fv;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0})(t)),qv(t,t.l_desc),qv(t,t.d_desc),o=(t=>{let e;for(Gv(t,t.dyn_ltree,t.l_desc.max_code),Gv(t,t.dyn_dtree,t.d_desc.max_code),qv(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*bv[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e})(t),r=t.opt_len+3+7>>>3,a=t.static_len+3+7>>>3,a<=r&&(r=a)):r=a=i+5,i+4<=r&&-1!==e?Zv(t,e,i,n):4===t.strategy||a===r?(Lv(t,2+(n?1:0),3),jv(t,wv,Sv)):(Lv(t,4+(n?1:0),3),((t,e,i,n)=>{let r;for(Lv(t,e-257,5),Lv(t,i-1,5),Lv(t,n-4,4),r=0;r<n;r++)Lv(t,t.bl_tree[2*bv[r]+1],3);Hv(t,t.dyn_ltree,e-1),Hv(t,t.dyn_dtree,i-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),jv(t,t.dyn_ltree,t.dyn_dtree)),Nv(t),n&&Uv(t)},Xv={_tr_init:t=>{Wv||((()=>{let t,e,i,n,r;const a=new Array(16);for(i=0,n=0;n<28;n++)for(Mv[n]=i,t=0;t<1<<yv[n];t++)Tv[i++]=n;for(Tv[i-1]=n,r=0,n=0;n<16;n++)for(Cv[n]=r,t=0;t<1<<vv[n];t++)Ev[r++]=n;for(r>>=7;n<gv;n++)for(Cv[n]=r<<7,t=0;t<1<<vv[n]-7;t++)Ev[256+r++]=n;for(e=0;e<=_v;e++)a[e]=0;for(t=0;t<=143;)wv[2*t+1]=8,t++,a[8]++;for(;t<=255;)wv[2*t+1]=9,t++,a[9]++;for(;t<=279;)wv[2*t+1]=7,t++,a[7]++;for(;t<=287;)wv[2*t+1]=8,t++,a[8]++;for(Fv(wv,287,a),t=0;t<gv;t++)Sv[2*t+1]=5,Sv[2*t]=Ov(t,5);Av=new Iv(wv,yv,257,mv,_v),kv=new Iv(Sv,vv,0,gv,_v),Rv=new Iv(new Array(0),xv,0,19,7)})(),Wv=!0),t.l_desc=new zv(t.dyn_ltree,Av),t.d_desc=new zv(t.dyn_dtree,kv),t.bl_desc=new zv(t.bl_tree,Rv),t.bi_buf=0,t.bi_valid=0,Nv(t)},_tr_stored_block:Zv,_tr_flush_block:Yv,_tr_tally:(t,e,i)=>(t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&i,t.last_lit++,0===e?t.dyn_ltree[2*i]++:(t.matches++,e--,t.dyn_ltree[2*(Tv[i]+fv+1)]++,t.dyn_dtree[2*Pv(e)]++),t.last_lit===t.lit_bufsize-1),_tr_align:t=>{Lv(t,2,3),Bv(t,256,wv),(t=>{16===t.bi_valid?(Dv(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(t)}};var Kv=(t,e,i,n)=>{let r=65535&t|0,a=t>>>16&65535|0,o=0;for(;0!==i;){o=i>2e3?2e3:i,i-=o;do{r=r+e[n++]|0,a=a+r|0}while(--o);r%=65521,a%=65521}return r|a<<16|0};const Jv=new Uint32Array((()=>{let t,e=[];for(var i=0;i<256;i++){t=i;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e})());var Qv=(t,e,i,n)=>{const r=Jv,a=n+i;t^=-1;for(let o=n;o<a;o++)t=t>>>8^r[255&(t^e[o])];return-1^t},tx={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},ex={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:ix,_tr_stored_block:nx,_tr_flush_block:rx,_tr_tally:ax,_tr_align:ox}=Xv,{Z_NO_FLUSH:sx,Z_PARTIAL_FLUSH:lx,Z_FULL_FLUSH:cx,Z_FINISH:ux,Z_BLOCK:hx,Z_OK:px,Z_STREAM_END:dx,Z_STREAM_ERROR:fx,Z_DATA_ERROR:mx,Z_BUF_ERROR:gx,Z_DEFAULT_COMPRESSION:_x,Z_FILTERED:yx,Z_HUFFMAN_ONLY:vx,Z_RLE:xx,Z_FIXED:bx,Z_DEFAULT_STRATEGY:wx,Z_UNKNOWN:Sx,Z_DEFLATED:Ex}=ex,Tx=258,Mx=262,Cx=103,Ix=113,Ax=666,kx=(t,e)=>(t.msg=tx[e],e),Rx=t=>(t<<1)-(t>4?9:0),zx=t=>{let e=t.length;for(;--e>=0;)t[e]=0};let Px=(t,e,i)=>(e<<t.hash_shift^i)&t.hash_mask;const Dx=t=>{const e=t.state;let i=e.pending;i>t.avail_out&&(i=t.avail_out),0!==i&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+i),t.next_out),t.next_out+=i,e.pending_out+=i,t.total_out+=i,t.avail_out-=i,e.pending-=i,0===e.pending&&(e.pending_out=0))},Lx=(t,e)=>{rx(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,Dx(t.strm)},Bx=(t,e)=>{t.pending_buf[t.pending++]=e},Ox=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},Fx=(t,e,i,n)=>{let r=t.avail_in;return r>n&&(r=n),0===r?0:(t.avail_in-=r,e.set(t.input.subarray(t.next_in,t.next_in+r),i),1===t.state.wrap?t.adler=Kv(t.adler,e,r,i):2===t.state.wrap&&(t.adler=Qv(t.adler,e,r,i)),t.next_in+=r,t.total_in+=r,r)},Nx=(t,e)=>{let i,n,r=t.max_chain_length,a=t.strstart,o=t.prev_length,s=t.nice_match;const l=t.strstart>t.w_size-Mx?t.strstart-(t.w_size-Mx):0,c=t.window,u=t.w_mask,h=t.prev,p=t.strstart+Tx;let d=c[a+o-1],f=c[a+o];t.prev_length>=t.good_match&&(r>>=2),s>t.lookahead&&(s=t.lookahead);do{if(i=e,c[i+o]===f&&c[i+o-1]===d&&c[i]===c[a]&&c[++i]===c[a+1]){a+=2,i++;do{}while(c[++a]===c[++i]&&c[++a]===c[++i]&&c[++a]===c[++i]&&c[++a]===c[++i]&&c[++a]===c[++i]&&c[++a]===c[++i]&&c[++a]===c[++i]&&c[++a]===c[++i]&&a<p);if(n=Tx-(p-a),a=p-Tx,n>o){if(t.match_start=e,o=n,n>=s)break;d=c[a+o-1],f=c[a+o]}}}while((e=h[e&u])>l&&0!==--r);return o<=t.lookahead?o:t.lookahead},Ux=t=>{const e=t.w_size;let i,n,r,a,o;do{if(a=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-Mx)){t.window.set(t.window.subarray(e,e+e),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,n=t.hash_size,i=n;do{r=t.head[--i],t.head[i]=r>=e?r-e:0}while(--n);n=e,i=n;do{r=t.prev[--i],t.prev[i]=r>=e?r-e:0}while(--n);a+=e}if(0===t.strm.avail_in)break;if(n=Fx(t.strm,t.window,t.strstart+t.lookahead,a),t.lookahead+=n,t.lookahead+t.insert>=3)for(o=t.strstart-t.insert,t.ins_h=t.window[o],t.ins_h=Px(t,t.ins_h,t.window[o+1]);t.insert&&(t.ins_h=Px(t,t.ins_h,t.window[o+3-1]),t.prev[o&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=o,o++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<Mx&&0!==t.strm.avail_in)},$x=(t,e)=>{let i,n;for(;;){if(t.lookahead<Mx){if(Ux(t),t.lookahead<Mx&&e===sx)return 1;if(0===t.lookahead)break}if(i=0,t.lookahead>=3&&(t.ins_h=Px(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==i&&t.strstart-i<=t.w_size-Mx&&(t.match_length=Nx(t,i)),t.match_length>=3)if(n=ax(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=Px(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!==--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=Px(t,t.ins_h,t.window[t.strstart+1]);else n=ax(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(Lx(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,e===ux?(Lx(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Lx(t,!1),0===t.strm.avail_out)?1:2},Vx=(t,e)=>{let i,n,r;for(;;){if(t.lookahead<Mx){if(Ux(t),t.lookahead<Mx&&e===sx)return 1;if(0===t.lookahead)break}if(i=0,t.lookahead>=3&&(t.ins_h=Px(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==i&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-Mx&&(t.match_length=Nx(t,i),t.match_length<=5&&(t.strategy===yx||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){r=t.strstart+t.lookahead-3,n=ax(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=r&&(t.ins_h=Px(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!==--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,n&&(Lx(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if(n=ax(t,0,t.window[t.strstart-1]),n&&Lx(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=ax(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===ux?(Lx(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Lx(t,!1),0===t.strm.avail_out)?1:2};function jx(t,e,i,n,r){this.good_length=t,this.max_lazy=e,this.nice_length=i,this.max_chain=n,this.func=r}const qx=[new jx(0,0,0,0,((t,e)=>{let i=65535;for(i>t.pending_buf_size-5&&(i=t.pending_buf_size-5);;){if(t.lookahead<=1){if(Ux(t),0===t.lookahead&&e===sx)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;const n=t.block_start+i;if((0===t.strstart||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,Lx(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-Mx&&(Lx(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===ux?(Lx(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&(Lx(t,!1),t.strm.avail_out),1)})),new jx(4,4,8,4,$x),new jx(4,5,16,8,$x),new jx(4,6,32,32,$x),new jx(4,4,16,16,Vx),new jx(8,16,32,32,Vx),new jx(8,16,128,128,Vx),new jx(8,32,128,256,Vx),new jx(32,128,258,1024,Vx),new jx(32,258,258,4096,Vx)];function Gx(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Ex,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),zx(this.dyn_ltree),zx(this.dyn_dtree),zx(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),zx(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),zx(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Hx=t=>{if(!t||!t.state)return kx(t,fx);t.total_in=t.total_out=0,t.data_type=Sx;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?42:Ix,t.adler=2===e.wrap?0:1,e.last_flush=sx,ix(e),px},Wx=t=>{const e=Hx(t);var i;return e===px&&((i=t.state).window_size=2*i.w_size,zx(i.head),i.max_lazy_match=qx[i.level].max_lazy,i.good_match=qx[i.level].good_length,i.nice_match=qx[i.level].nice_length,i.max_chain_length=qx[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0),e},Zx=(t,e,i,n,r,a)=>{if(!t)return fx;let o=1;if(e===_x&&(e=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),r<1||r>9||i!==Ex||n<8||n>15||e<0||e>9||a<0||a>bx)return kx(t,fx);8===n&&(n=9);const s=new Gx;return t.state=s,s.strm=t,s.wrap=o,s.gzhead=null,s.w_bits=n,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=r+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new Uint8Array(2*s.w_size),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<r+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Uint8Array(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=e,s.strategy=a,s.method=i,Wx(t)};var Yx=(t,e)=>{let i,n;if(!t||!t.state||e>hx||e<0)return t?kx(t,fx):fx;const r=t.state;if(!t.output||!t.input&&0!==t.avail_in||r.status===Ax&&e!==ux)return kx(t,0===t.avail_out?gx:fx);r.strm=t;const a=r.last_flush;if(r.last_flush=e,42===r.status)if(2===r.wrap)t.adler=0,Bx(r,31),Bx(r,139),Bx(r,8),r.gzhead?(Bx(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),Bx(r,255&r.gzhead.time),Bx(r,r.gzhead.time>>8&255),Bx(r,r.gzhead.time>>16&255),Bx(r,r.gzhead.time>>24&255),Bx(r,9===r.level?2:r.strategy>=vx||r.level<2?4:0),Bx(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(Bx(r,255&r.gzhead.extra.length),Bx(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=Qv(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(Bx(r,0),Bx(r,0),Bx(r,0),Bx(r,0),Bx(r,0),Bx(r,9===r.level?2:r.strategy>=vx||r.level<2?4:0),Bx(r,3),r.status=Ix);else{let e=Ex+(r.w_bits-8<<4)<<8,i=-1;i=r.strategy>=vx||r.level<2?0:r.level<6?1:6===r.level?2:3,e|=i<<6,0!==r.strstart&&(e|=32),e+=31-e%31,r.status=Ix,Ox(r,e),0!==r.strstart&&(Ox(r,t.adler>>>16),Ox(r,65535&t.adler)),t.adler=1}if(69===r.status)if(r.gzhead.extra){for(i=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>i&&(t.adler=Qv(t.adler,r.pending_buf,r.pending-i,i)),Dx(t),i=r.pending,r.pending!==r.pending_buf_size));)Bx(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>i&&(t.adler=Qv(t.adler,r.pending_buf,r.pending-i,i)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){i=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>i&&(t.adler=Qv(t.adler,r.pending_buf,r.pending-i,i)),Dx(t),i=r.pending,r.pending===r.pending_buf_size)){n=1;break}n=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,Bx(r,n)}while(0!==n);r.gzhead.hcrc&&r.pending>i&&(t.adler=Qv(t.adler,r.pending_buf,r.pending-i,i)),0===n&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){i=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>i&&(t.adler=Qv(t.adler,r.pending_buf,r.pending-i,i)),Dx(t),i=r.pending,r.pending===r.pending_buf_size)){n=1;break}n=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,Bx(r,n)}while(0!==n);r.gzhead.hcrc&&r.pending>i&&(t.adler=Qv(t.adler,r.pending_buf,r.pending-i,i)),0===n&&(r.status=Cx)}else r.status=Cx;if(r.status===Cx&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&Dx(t),r.pending+2<=r.pending_buf_size&&(Bx(r,255&t.adler),Bx(r,t.adler>>8&255),t.adler=0,r.status=Ix)):r.status=Ix),0!==r.pending){if(Dx(t),0===t.avail_out)return r.last_flush=-1,px}else if(0===t.avail_in&&Rx(e)<=Rx(a)&&e!==ux)return kx(t,gx);if(r.status===Ax&&0!==t.avail_in)return kx(t,gx);if(0!==t.avail_in||0!==r.lookahead||e!==sx&&r.status!==Ax){let i=r.strategy===vx?((t,e)=>{let i;for(;;){if(0===t.lookahead&&(Ux(t),0===t.lookahead)){if(e===sx)return 1;break}if(t.match_length=0,i=ax(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,i&&(Lx(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===ux?(Lx(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Lx(t,!1),0===t.strm.avail_out)?1:2})(r,e):r.strategy===xx?((t,e)=>{let i,n,r,a;const o=t.window;for(;;){if(t.lookahead<=Tx){if(Ux(t),t.lookahead<=Tx&&e===sx)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(r=t.strstart-1,n=o[r],n===o[++r]&&n===o[++r]&&n===o[++r])){a=t.strstart+Tx;do{}while(n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&r<a);t.match_length=Tx-(a-r),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(i=ax(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(i=ax(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),i&&(Lx(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===ux?(Lx(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Lx(t,!1),0===t.strm.avail_out)?1:2})(r,e):qx[r.level].func(r,e);if(3!==i&&4!==i||(r.status=Ax),1===i||3===i)return 0===t.avail_out&&(r.last_flush=-1),px;if(2===i&&(e===lx?ox(r):e!==hx&&(nx(r,0,0,!1),e===cx&&(zx(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),Dx(t),0===t.avail_out))return r.last_flush=-1,px}return e!==ux?px:r.wrap<=0?dx:(2===r.wrap?(Bx(r,255&t.adler),Bx(r,t.adler>>8&255),Bx(r,t.adler>>16&255),Bx(r,t.adler>>24&255),Bx(r,255&t.total_in),Bx(r,t.total_in>>8&255),Bx(r,t.total_in>>16&255),Bx(r,t.total_in>>24&255)):(Ox(r,t.adler>>>16),Ox(r,65535&t.adler)),Dx(t),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?px:dx)},Xx=(t,e)=>{let i=e.length;if(!t||!t.state)return fx;const n=t.state,r=n.wrap;if(2===r||1===r&&42!==n.status||n.lookahead)return fx;if(1===r&&(t.adler=Kv(t.adler,e,i,0)),n.wrap=0,i>=n.w_size){0===r&&(zx(n.head),n.strstart=0,n.block_start=0,n.insert=0);let t=new Uint8Array(n.w_size);t.set(e.subarray(i-n.w_size,i),0),e=t,i=n.w_size}const a=t.avail_in,o=t.next_in,s=t.input;for(t.avail_in=i,t.next_in=0,t.input=e,Ux(n);n.lookahead>=3;){let t=n.strstart,e=n.lookahead-2;do{n.ins_h=Px(n,n.ins_h,n.window[t+3-1]),n.prev[t&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=t,t++}while(--e);n.strstart=t,n.lookahead=2,Ux(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,t.next_in=o,t.input=s,t.avail_in=a,n.wrap=r,px},Kx={deflateInit:(t,e)=>Zx(t,e,Ex,15,8,wx),deflateInit2:Zx,deflateReset:Wx,deflateResetKeep:Hx,deflateSetHeader:(t,e)=>t&&t.state?2!==t.state.wrap?fx:(t.state.gzhead=e,px):fx,deflate:Yx,deflateEnd:t=>{if(!t||!t.state)return fx;const e=t.state.status;return 42!==e&&69!==e&&73!==e&&91!==e&&e!==Cx&&e!==Ix&&e!==Ax?kx(t,fx):(t.state=null,e===Ix?kx(t,mx):px)},deflateSetDictionary:Xx,deflateInfo:"pako deflate (from Nodeca project)"};const Jx=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Qx=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const i=e.shift();if(i){if("object"!==typeof i)throw new TypeError(i+"must be non-object");for(const e in i)Jx(i,e)&&(t[e]=i[e])}}return t},tb=t=>{let e=0;for(let n=0,r=t.length;n<r;n++)e+=t[n].length;const i=new Uint8Array(e);for(let n=0,r=0,a=t.length;n<a;n++){let e=t[n];i.set(e,r),r+=e.length}return i};let eb=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(QR){eb=!1}const ib=new Uint8Array(256);for(let tz=0;tz<256;tz++)ib[tz]=tz>=252?6:tz>=248?5:tz>=240?4:tz>=224?3:tz>=192?2:1;ib[254]=ib[254]=1;var nb=t=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);let e,i,n,r,a,o=t.length,s=0;for(r=0;r<o;r++)i=t.charCodeAt(r),55296===(64512&i)&&r+1<o&&(n=t.charCodeAt(r+1),56320===(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),r++)),s+=i<128?1:i<2048?2:i<65536?3:4;for(e=new Uint8Array(s),a=0,r=0;a<s;r++)i=t.charCodeAt(r),55296===(64512&i)&&r+1<o&&(n=t.charCodeAt(r+1),56320===(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),r++)),i<128?e[a++]=i:i<2048?(e[a++]=192|i>>>6,e[a++]=128|63&i):i<65536?(e[a++]=224|i>>>12,e[a++]=128|i>>>6&63,e[a++]=128|63&i):(e[a++]=240|i>>>18,e[a++]=128|i>>>12&63,e[a++]=128|i>>>6&63,e[a++]=128|63&i);return e},rb=(t,e)=>{const i=e||t.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(t.subarray(0,e));let n,r;const a=new Array(2*i);for(r=0,n=0;n<i;){let e=t[n++];if(e<128){a[r++]=e;continue}let o=ib[e];if(o>4)a[r++]=65533,n+=o-1;else{for(e&=2===o?31:3===o?15:7;o>1&&n<i;)e=e<<6|63&t[n++],o--;o>1?a[r++]=65533:e<65536?a[r++]=e:(e-=65536,a[r++]=55296|e>>10&1023,a[r++]=56320|1023&e)}}return((t,e)=>{if(e<65534&&t.subarray&&eb)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let i="";for(let n=0;n<e;n++)i+=String.fromCharCode(t[n]);return i})(a,r)},ab=(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let i=e-1;for(;i>=0&&128===(192&t[i]);)i--;return i<0||0===i?e:i+ib[t[i]]>e?i:e};var ob=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const sb=Object.prototype.toString,{Z_NO_FLUSH:lb,Z_SYNC_FLUSH:cb,Z_FULL_FLUSH:ub,Z_FINISH:hb,Z_OK:pb,Z_STREAM_END:db,Z_DEFAULT_COMPRESSION:fb,Z_DEFAULT_STRATEGY:mb,Z_DEFLATED:gb}=ex;function _b(t){this.options=Qx({level:fb,method:gb,chunkSize:16384,windowBits:15,memLevel:8,strategy:mb},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ob,this.strm.avail_out=0;let i=Kx.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(i!==pb)throw new Error(tx[i]);if(e.header&&Kx.deflateSetHeader(this.strm,e.header),e.dictionary){let t;if(t="string"===typeof e.dictionary?nb(e.dictionary):"[object ArrayBuffer]"===sb.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,i=Kx.deflateSetDictionary(this.strm,t),i!==pb)throw new Error(tx[i]);this._dict_set=!0}}_b.prototype.push=function(t,e){const i=this.strm,n=this.options.chunkSize;let r,a;if(this.ended)return!1;for(a=e===~~e?e:!0===e?hb:lb,"string"===typeof t?i.input=nb(t):"[object ArrayBuffer]"===sb.call(t)?i.input=new Uint8Array(t):i.input=t,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(n),i.next_out=0,i.avail_out=n),(a===cb||a===ub)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(r=Kx.deflate(i,a),r===db)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),r=Kx.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===pb;if(0!==i.avail_out){if(a>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},_b.prototype.onData=function(t){this.chunks.push(t)},_b.prototype.onEnd=function(t){t===pb&&(this.result=tb(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var yb=function(t,e){let i,n,r,a,o,s,l,c,u,h,p,d,f,m,g,_,y,v,x,b,w,S,E,T;const M=t.state;i=t.next_in,E=t.input,n=i+(t.avail_in-5),r=t.next_out,T=t.output,a=r-(e-t.avail_out),o=r+(t.avail_out-257),s=M.dmax,l=M.wsize,c=M.whave,u=M.wnext,h=M.window,p=M.hold,d=M.bits,f=M.lencode,m=M.distcode,g=(1<<M.lenbits)-1,_=(1<<M.distbits)-1;t:do{d<15&&(p+=E[i++]<<d,d+=8,p+=E[i++]<<d,d+=8),y=f[p&g];e:for(;;){if(v=y>>>24,p>>>=v,d-=v,v=y>>>16&255,0===v)T[r++]=65535&y;else{if(!(16&v)){if(0===(64&v)){y=f[(65535&y)+(p&(1<<v)-1)];continue e}if(32&v){M.mode=12;break t}t.msg="invalid literal/length code",M.mode=30;break t}x=65535&y,v&=15,v&&(d<v&&(p+=E[i++]<<d,d+=8),x+=p&(1<<v)-1,p>>>=v,d-=v),d<15&&(p+=E[i++]<<d,d+=8,p+=E[i++]<<d,d+=8),y=m[p&_];i:for(;;){if(v=y>>>24,p>>>=v,d-=v,v=y>>>16&255,!(16&v)){if(0===(64&v)){y=m[(65535&y)+(p&(1<<v)-1)];continue i}t.msg="invalid distance code",M.mode=30;break t}if(b=65535&y,v&=15,d<v&&(p+=E[i++]<<d,d+=8,d<v&&(p+=E[i++]<<d,d+=8)),b+=p&(1<<v)-1,b>s){t.msg="invalid distance too far back",M.mode=30;break t}if(p>>>=v,d-=v,v=r-a,b>v){if(v=b-v,v>c&&M.sane){t.msg="invalid distance too far back",M.mode=30;break t}if(w=0,S=h,0===u){if(w+=l-v,v<x){x-=v;do{T[r++]=h[w++]}while(--v);w=r-b,S=T}}else if(u<v){if(w+=l+u-v,v-=u,v<x){x-=v;do{T[r++]=h[w++]}while(--v);if(w=0,u<x){v=u,x-=v;do{T[r++]=h[w++]}while(--v);w=r-b,S=T}}}else if(w+=u-v,v<x){x-=v;do{T[r++]=h[w++]}while(--v);w=r-b,S=T}for(;x>2;)T[r++]=S[w++],T[r++]=S[w++],T[r++]=S[w++],x-=3;x&&(T[r++]=S[w++],x>1&&(T[r++]=S[w++]))}else{w=r-b;do{T[r++]=T[w++],T[r++]=T[w++],T[r++]=T[w++],x-=3}while(x>2);x&&(T[r++]=T[w++],x>1&&(T[r++]=T[w++]))}break}}break}}while(i<n&&r<o);x=d>>3,i-=x,d-=x<<3,p&=(1<<d)-1,t.next_in=i,t.next_out=r,t.avail_in=i<n?n-i+5:5-(i-n),t.avail_out=r<o?o-r+257:257-(r-o),M.hold=p,M.bits=d};const vb=15,xb=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),bb=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),wb=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Sb=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Eb=(t,e,i,n,r,a,o,s)=>{const l=s.bits;let c,u,h,p,d,f,m=0,g=0,_=0,y=0,v=0,x=0,b=0,w=0,S=0,E=0,T=null,M=0;const C=new Uint16Array(16),I=new Uint16Array(16);let A,k,R,z=null,P=0;for(m=0;m<=vb;m++)C[m]=0;for(g=0;g<n;g++)C[e[i+g]]++;for(v=l,y=vb;y>=1&&0===C[y];y--);if(v>y&&(v=y),0===y)return r[a++]=20971520,r[a++]=20971520,s.bits=1,0;for(_=1;_<y&&0===C[_];_++);for(v<_&&(v=_),w=1,m=1;m<=vb;m++)if(w<<=1,w-=C[m],w<0)return-1;if(w>0&&(0===t||1!==y))return-1;for(I[1]=0,m=1;m<vb;m++)I[m+1]=I[m]+C[m];for(g=0;g<n;g++)0!==e[i+g]&&(o[I[e[i+g]]++]=g);if(0===t?(T=z=o,f=19):1===t?(T=xb,M-=257,z=bb,P-=257,f=256):(T=wb,z=Sb,f=-1),E=0,g=0,m=_,d=a,x=v,b=0,h=-1,S=1<<v,p=S-1,1===t&&S>852||2===t&&S>592)return 1;for(;;){A=m-b,o[g]<f?(k=0,R=o[g]):o[g]>f?(k=z[P+o[g]],R=T[M+o[g]]):(k=96,R=0),c=1<<m-b,u=1<<x,_=u;do{u-=c,r[d+(E>>b)+u]=A<<24|k<<16|R|0}while(0!==u);for(c=1<<m-1;E&c;)c>>=1;if(0!==c?(E&=c-1,E+=c):E=0,g++,0===--C[m]){if(m===y)break;m=e[i+o[g]]}if(m>v&&(E&p)!==h){for(0===b&&(b=v),d+=_,x=m-b,w=1<<x;x+b<y&&(w-=C[x+b],!(w<=0));)x++,w<<=1;if(S+=1<<x,1===t&&S>852||2===t&&S>592)return 1;h=E&p,r[h]=v<<24|x<<16|d-a|0}}return 0!==E&&(r[d+E]=m-b<<24|64<<16|0),s.bits=v,0};const{Z_FINISH:Tb,Z_BLOCK:Mb,Z_TREES:Cb,Z_OK:Ib,Z_STREAM_END:Ab,Z_NEED_DICT:kb,Z_STREAM_ERROR:Rb,Z_DATA_ERROR:zb,Z_MEM_ERROR:Pb,Z_BUF_ERROR:Db,Z_DEFLATED:Lb}=ex,Bb=12,Ob=30,Fb=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function Nb(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ub=t=>{if(!t||!t.state)return Rb;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,Ib},$b=t=>{if(!t||!t.state)return Rb;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,Ub(t)},Vb=(t,e)=>{let i;if(!t||!t.state)return Rb;const n=t.state;return e<0?(i=0,e=-e):(i=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?Rb:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=i,n.wbits=e,$b(t))},jb=(t,e)=>{if(!t)return Rb;const i=new Nb;t.state=i,i.window=null;const n=Vb(t,e);return n!==Ib&&(t.state=null),n};let qb,Gb,Hb=!0;const Wb=t=>{if(Hb){qb=new Int32Array(512),Gb=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(Eb(1,t.lens,0,288,qb,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;Eb(2,t.lens,0,32,Gb,0,t.work,{bits:5}),Hb=!1}t.lencode=qb,t.lenbits=9,t.distcode=Gb,t.distbits=5},Zb=(t,e,i,n)=>{let r;const a=t.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),n>=a.wsize?(a.window.set(e.subarray(i-a.wsize,i),0),a.wnext=0,a.whave=a.wsize):(r=a.wsize-a.wnext,r>n&&(r=n),a.window.set(e.subarray(i-n,i-n+r),a.wnext),(n-=r)?(a.window.set(e.subarray(i-n,i),0),a.wnext=n,a.whave=a.wsize):(a.wnext+=r,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=r))),0};var Yb=(t,e)=>{let i,n,r,a,o,s,l,c,u,h,p,d,f,m,g,_,y,v,x,b,w,S,E=0;const T=new Uint8Array(4);let M,C;const I=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return Rb;i=t.state,i.mode===Bb&&(i.mode=13),o=t.next_out,r=t.output,l=t.avail_out,a=t.next_in,n=t.input,s=t.avail_in,c=i.hold,u=i.bits,h=s,p=l,S=Ib;t:for(;;)switch(i.mode){case 1:if(0===i.wrap){i.mode=13;break}for(;u<16;){if(0===s)break t;s--,c+=n[a++]<<u,u+=8}if(2&i.wrap&&35615===c){i.check=0,T[0]=255&c,T[1]=c>>>8&255,i.check=Qv(i.check,T,2,0),c=0,u=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&c)<<8)+(c>>8))%31){t.msg="incorrect header check",i.mode=Ob;break}if((15&c)!==Lb){t.msg="unknown compression method",i.mode=Ob;break}if(c>>>=4,u-=4,w=8+(15&c),0===i.wbits)i.wbits=w;else if(w>i.wbits){t.msg="invalid window size",i.mode=Ob;break}i.dmax=1<<i.wbits,t.adler=i.check=1,i.mode=512&c?10:Bb,c=0,u=0;break;case 2:for(;u<16;){if(0===s)break t;s--,c+=n[a++]<<u,u+=8}if(i.flags=c,(255&i.flags)!==Lb){t.msg="unknown compression method",i.mode=Ob;break}if(57344&i.flags){t.msg="unknown header flags set",i.mode=Ob;break}i.head&&(i.head.text=c>>8&1),512&i.flags&&(T[0]=255&c,T[1]=c>>>8&255,i.check=Qv(i.check,T,2,0)),c=0,u=0,i.mode=3;case 3:for(;u<32;){if(0===s)break t;s--,c+=n[a++]<<u,u+=8}i.head&&(i.head.time=c),512&i.flags&&(T[0]=255&c,T[1]=c>>>8&255,T[2]=c>>>16&255,T[3]=c>>>24&255,i.check=Qv(i.check,T,4,0)),c=0,u=0,i.mode=4;case 4:for(;u<16;){if(0===s)break t;s--,c+=n[a++]<<u,u+=8}i.head&&(i.head.xflags=255&c,i.head.os=c>>8),512&i.flags&&(T[0]=255&c,T[1]=c>>>8&255,i.check=Qv(i.check,T,2,0)),c=0,u=0,i.mode=5;case 5:if(1024&i.flags){for(;u<16;){if(0===s)break t;s--,c+=n[a++]<<u,u+=8}i.length=c,i.head&&(i.head.extra_len=c),512&i.flags&&(T[0]=255&c,T[1]=c>>>8&255,i.check=Qv(i.check,T,2,0)),c=0,u=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&(d=i.length,d>s&&(d=s),d&&(i.head&&(w=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(n.subarray(a,a+d),w)),512&i.flags&&(i.check=Qv(i.check,n,d,a)),s-=d,a+=d,i.length-=d),i.length))break t;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===s)break t;d=0;do{w=n[a+d++],i.head&&w&&i.length<65536&&(i.head.name+=String.fromCharCode(w))}while(w&&d<s);if(512&i.flags&&(i.check=Qv(i.check,n,d,a)),s-=d,a+=d,w)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===s)break t;d=0;do{w=n[a+d++],i.head&&w&&i.length<65536&&(i.head.comment+=String.fromCharCode(w))}while(w&&d<s);if(512&i.flags&&(i.check=Qv(i.check,n,d,a)),s-=d,a+=d,w)break t}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;u<16;){if(0===s)break t;s--,c+=n[a++]<<u,u+=8}if(c!==(65535&i.check)){t.msg="header crc mismatch",i.mode=Ob;break}c=0,u=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=Bb;break;case 10:for(;u<32;){if(0===s)break t;s--,c+=n[a++]<<u,u+=8}t.adler=i.check=Fb(c),c=0,u=0,i.mode=11;case 11:if(0===i.havedict)return t.next_out=o,t.avail_out=l,t.next_in=a,t.avail_in=s,i.hold=c,i.bits=u,kb;t.adler=i.check=1,i.mode=Bb;case Bb:if(e===Mb||e===Cb)break t;case 13:if(i.last){c>>>=7&u,u-=7&u,i.mode=27;break}for(;u<3;){if(0===s)break t;s--,c+=n[a++]<<u,u+=8}switch(i.last=1&c,c>>>=1,u-=1,3&c){case 0:i.mode=14;break;case 1:if(Wb(i),i.mode=20,e===Cb){c>>>=2,u-=2;break t}break;case 2:i.mode=17;break;case 3:t.msg="invalid block type",i.mode=Ob}c>>>=2,u-=2;break;case 14:for(c>>>=7&u,u-=7&u;u<32;){if(0===s)break t;s--,c+=n[a++]<<u,u+=8}if((65535&c)!==(c>>>16^65535)){t.msg="invalid stored block lengths",i.mode=Ob;break}if(i.length=65535&c,c=0,u=0,i.mode=15,e===Cb)break t;case 15:i.mode=16;case 16:if(d=i.length,d){if(d>s&&(d=s),d>l&&(d=l),0===d)break t;r.set(n.subarray(a,a+d),o),s-=d,a+=d,l-=d,o+=d,i.length-=d;break}i.mode=Bb;break;case 17:for(;u<14;){if(0===s)break t;s--,c+=n[a++]<<u,u+=8}if(i.nlen=257+(31&c),c>>>=5,u-=5,i.ndist=1+(31&c),c>>>=5,u-=5,i.ncode=4+(15&c),c>>>=4,u-=4,i.nlen>286||i.ndist>30){t.msg="too many length or distance symbols",i.mode=Ob;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;u<3;){if(0===s)break t;s--,c+=n[a++]<<u,u+=8}i.lens[I[i.have++]]=7&c,c>>>=3,u-=3}for(;i.have<19;)i.lens[I[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,M={bits:i.lenbits},S=Eb(0,i.lens,0,19,i.lencode,0,i.work,M),i.lenbits=M.bits,S){t.msg="invalid code lengths set",i.mode=Ob;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;E=i.lencode[c&(1<<i.lenbits)-1],g=E>>>24,_=E>>>16&255,y=65535&E,!(g<=u);){if(0===s)break t;s--,c+=n[a++]<<u,u+=8}if(y<16)c>>>=g,u-=g,i.lens[i.have++]=y;else{if(16===y){for(C=g+2;u<C;){if(0===s)break t;s--,c+=n[a++]<<u,u+=8}if(c>>>=g,u-=g,0===i.have){t.msg="invalid bit length repeat",i.mode=Ob;break}w=i.lens[i.have-1],d=3+(3&c),c>>>=2,u-=2}else if(17===y){for(C=g+3;u<C;){if(0===s)break t;s--,c+=n[a++]<<u,u+=8}c>>>=g,u-=g,w=0,d=3+(7&c),c>>>=3,u-=3}else{for(C=g+7;u<C;){if(0===s)break t;s--,c+=n[a++]<<u,u+=8}c>>>=g,u-=g,w=0,d=11+(127&c),c>>>=7,u-=7}if(i.have+d>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=Ob;break}for(;d--;)i.lens[i.have++]=w}}if(i.mode===Ob)break;if(0===i.lens[256]){t.msg="invalid code -- missing end-of-block",i.mode=Ob;break}if(i.lenbits=9,M={bits:i.lenbits},S=Eb(1,i.lens,0,i.nlen,i.lencode,0,i.work,M),i.lenbits=M.bits,S){t.msg="invalid literal/lengths set",i.mode=Ob;break}if(i.distbits=6,i.distcode=i.distdyn,M={bits:i.distbits},S=Eb(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,M),i.distbits=M.bits,S){t.msg="invalid distances set",i.mode=Ob;break}if(i.mode=20,e===Cb)break t;case 20:i.mode=21;case 21:if(s>=6&&l>=258){t.next_out=o,t.avail_out=l,t.next_in=a,t.avail_in=s,i.hold=c,i.bits=u,yb(t,p),o=t.next_out,r=t.output,l=t.avail_out,a=t.next_in,n=t.input,s=t.avail_in,c=i.hold,u=i.bits,i.mode===Bb&&(i.back=-1);break}for(i.back=0;E=i.lencode[c&(1<<i.lenbits)-1],g=E>>>24,_=E>>>16&255,y=65535&E,!(g<=u);){if(0===s)break t;s--,c+=n[a++]<<u,u+=8}if(_&&0===(240&_)){for(v=g,x=_,b=y;E=i.lencode[b+((c&(1<<v+x)-1)>>v)],g=E>>>24,_=E>>>16&255,y=65535&E,!(v+g<=u);){if(0===s)break t;s--,c+=n[a++]<<u,u+=8}c>>>=v,u-=v,i.back+=v}if(c>>>=g,u-=g,i.back+=g,i.length=y,0===_){i.mode=26;break}if(32&_){i.back=-1,i.mode=Bb;break}if(64&_){t.msg="invalid literal/length code",i.mode=Ob;break}i.extra=15&_,i.mode=22;case 22:if(i.extra){for(C=i.extra;u<C;){if(0===s)break t;s--,c+=n[a++]<<u,u+=8}i.length+=c&(1<<i.extra)-1,c>>>=i.extra,u-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;E=i.distcode[c&(1<<i.distbits)-1],g=E>>>24,_=E>>>16&255,y=65535&E,!(g<=u);){if(0===s)break t;s--,c+=n[a++]<<u,u+=8}if(0===(240&_)){for(v=g,x=_,b=y;E=i.distcode[b+((c&(1<<v+x)-1)>>v)],g=E>>>24,_=E>>>16&255,y=65535&E,!(v+g<=u);){if(0===s)break t;s--,c+=n[a++]<<u,u+=8}c>>>=v,u-=v,i.back+=v}if(c>>>=g,u-=g,i.back+=g,64&_){t.msg="invalid distance code",i.mode=Ob;break}i.offset=y,i.extra=15&_,i.mode=24;case 24:if(i.extra){for(C=i.extra;u<C;){if(0===s)break t;s--,c+=n[a++]<<u,u+=8}i.offset+=c&(1<<i.extra)-1,c>>>=i.extra,u-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=Ob;break}i.mode=25;case 25:if(0===l)break t;if(d=p-l,i.offset>d){if(d=i.offset-d,d>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=Ob;break}d>i.wnext?(d-=i.wnext,f=i.wsize-d):f=i.wnext-d,d>i.length&&(d=i.length),m=i.window}else m=r,f=o-i.offset,d=i.length;d>l&&(d=l),l-=d,i.length-=d;do{r[o++]=m[f++]}while(--d);0===i.length&&(i.mode=21);break;case 26:if(0===l)break t;r[o++]=i.length,l--,i.mode=21;break;case 27:if(i.wrap){for(;u<32;){if(0===s)break t;s--,c|=n[a++]<<u,u+=8}if(p-=l,t.total_out+=p,i.total+=p,p&&(t.adler=i.check=i.flags?Qv(i.check,r,p,o-p):Kv(i.check,r,p,o-p)),p=l,(i.flags?c:Fb(c))!==i.check){t.msg="incorrect data check",i.mode=Ob;break}c=0,u=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;u<32;){if(0===s)break t;s--,c+=n[a++]<<u,u+=8}if(c!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=Ob;break}c=0,u=0}i.mode=29;case 29:S=Ab;break t;case Ob:S=zb;break t;case 31:return Pb;default:return Rb}return t.next_out=o,t.avail_out=l,t.next_in=a,t.avail_in=s,i.hold=c,i.bits=u,(i.wsize||p!==t.avail_out&&i.mode<Ob&&(i.mode<27||e!==Tb))&&Zb(t,t.output,t.next_out,p-t.avail_out),h-=t.avail_in,p-=t.avail_out,t.total_in+=h,t.total_out+=p,i.total+=p,i.wrap&&p&&(t.adler=i.check=i.flags?Qv(i.check,r,p,t.next_out-p):Kv(i.check,r,p,t.next_out-p)),t.data_type=i.bits+(i.last?64:0)+(i.mode===Bb?128:0)+(20===i.mode||15===i.mode?256:0),(0===h&&0===p||e===Tb)&&S===Ib&&(S=Db),S},Xb={inflateReset:$b,inflateReset2:Vb,inflateResetKeep:Ub,inflateInit:t=>jb(t,15),inflateInit2:jb,inflate:Yb,inflateEnd:t=>{if(!t||!t.state)return Rb;let e=t.state;return e.window&&(e.window=null),t.state=null,Ib},inflateGetHeader:(t,e)=>{if(!t||!t.state)return Rb;const i=t.state;return 0===(2&i.wrap)?Rb:(i.head=e,e.done=!1,Ib)},inflateSetDictionary:(t,e)=>{const i=e.length;let n,r,a;return t&&t.state?(n=t.state,0!==n.wrap&&11!==n.mode?Rb:11===n.mode&&(r=1,r=Kv(r,e,i,0),r!==n.check)?zb:(a=Zb(t,e,i,i),a?(n.mode=31,Pb):(n.havedict=1,Ib))):Rb},inflateInfo:"pako inflate (from Nodeca project)"};var Kb=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Jb=Object.prototype.toString,{Z_NO_FLUSH:Qb,Z_FINISH:tw,Z_OK:ew,Z_STREAM_END:iw,Z_NEED_DICT:nw,Z_STREAM_ERROR:rw,Z_DATA_ERROR:aw,Z_MEM_ERROR:ow}=ex;function sw(t){this.options=Qx({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0===(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ob,this.strm.avail_out=0;let i=Xb.inflateInit2(this.strm,e.windowBits);if(i!==ew)throw new Error(tx[i]);if(this.header=new Kb,Xb.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"===typeof e.dictionary?e.dictionary=nb(e.dictionary):"[object ArrayBuffer]"===Jb.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(i=Xb.inflateSetDictionary(this.strm,e.dictionary),i!==ew)))throw new Error(tx[i])}function lw(t,e){const i=new sw(e);if(i.push(t),i.err)throw i.msg||tx[i.err];return i.result}sw.prototype.push=function(t,e){const i=this.strm,n=this.options.chunkSize,r=this.options.dictionary;let a,o,s;if(this.ended)return!1;for(o=e===~~e?e:!0===e?tw:Qb,"[object ArrayBuffer]"===Jb.call(t)?i.input=new Uint8Array(t):i.input=t,i.next_in=0,i.avail_in=i.input.length;;){for(0===i.avail_out&&(i.output=new Uint8Array(n),i.next_out=0,i.avail_out=n),a=Xb.inflate(i,o),a===nw&&r&&(a=Xb.inflateSetDictionary(i,r),a===ew?a=Xb.inflate(i,o):a===aw&&(a=nw));i.avail_in>0&&a===iw&&i.state.wrap>0&&0!==t[i.next_in];)Xb.inflateReset(i),a=Xb.inflate(i,o);switch(a){case rw:case aw:case nw:case ow:return this.onEnd(a),this.ended=!0,!1}if(s=i.avail_out,i.next_out&&(0===i.avail_out||a===iw))if("string"===this.options.to){let t=ab(i.output,i.next_out),e=i.next_out-t,r=rb(i.output,t);i.next_out=e,i.avail_out=n-e,e&&i.output.set(i.output.subarray(t,t+e),0),this.onData(r)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(a!==ew||0!==s){if(a===iw)return a=Xb.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(0===i.avail_in)break}}return!0},sw.prototype.onData=function(t){this.chunks.push(t)},sw.prototype.onEnd=function(t){t===ew&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=tb(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var cw={Inflate:sw,inflate:lw,inflateRaw:function(t,e){return(e=e||{}).raw=!0,lw(t,e)},ungzip:lw,constants:ex};const{Inflate:uw,inflate:hw,inflateRaw:pw,ungzip:dw}=cw;var fw=hw,mw={read:function(t,e,i,n,r){var a,o,s=8*r-n-1,l=(1<<s)-1,c=l>>1,u=-7,h=i?r-1:0,p=i?-1:1,d=t[e+h];for(h+=p,a=d&(1<<-u)-1,d>>=-u,u+=s;u>0;a=256*a+t[e+h],h+=p,u-=8);for(o=a&(1<<-u)-1,a>>=-u,u+=n;u>0;o=256*o+t[e+h],h+=p,u-=8);if(0===a)a=1-c;else{if(a===l)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,n),a-=c}return(d?-1:1)*o*Math.pow(2,a-n)},write:function(t,e,i,n,r,a){var o,s,l,c=8*a-r-1,u=(1<<c)-1,h=u>>1,p=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:a-1,f=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),(e+=o+h>=1?p/l:p*Math.pow(2,1-h))*l>=2&&(o++,l/=2),o+h>=u?(s=0,o=u):o+h>=1?(s=(e*l-1)*Math.pow(2,r),o+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,r),o=0));r>=8;t[i+d]=255&s,d+=f,s/=256,r-=8);for(o=o<<r|s,c+=r;c>0;t[i+d]=255&o,d+=f,o/=256,c-=8);t[i+d-f]|=128*m}},gw=yw,_w=mw;function yw(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}yw.Varint=0,yw.Fixed64=1,yw.Bytes=2,yw.Fixed32=5;var vw=4294967296,xw=1/vw,bw="undefined"===typeof TextDecoder?null:new TextDecoder("utf8");function ww(t){return t.type===yw.Bytes?t.readVarint()+t.pos:t.pos+1}function Sw(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Ew(t,e,i){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(n);for(var r=i.pos-1;r>=t;r--)i.buf[r+n]=i.buf[r]}function Tw(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function Mw(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function Cw(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function Iw(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function Aw(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function kw(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function Rw(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function zw(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function Pw(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function Dw(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Lw(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function Bw(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function Ow(t,e){return Fw(t,"GET","arraybuffer",[],null,e)}function Fw(t,e,i,n,r,a){const o=new XMLHttpRequest,s=new Promise(((a,s)=>{o.open(e,t,!0);for(const t of n)o.setRequestHeader(t.name,t.value);o.responseType=i,o.timeout=15e3,o.onload=()=>{var e;if(200!==o.status){const i=null!==(e=o.response)&&void 0!==e?e:new Yh(`Response status error: ${t}`);s(i)}o.response||s(new Yh(`Response empty: ${t}`)),a(o.response)},o.onerror=()=>{s(new Yh(`Request error: ${t}`))},o.ontimeout=()=>{s(new Yh(`Request timeout: ${t}`))},o.onabort=()=>{s(new Yh(`Request aborted: ${t}`))},o.send("POST"===e?r:null)}));return a&&a.catch((()=>{o.abort()})),s}function Nw(t,e,i){1===t?e.vertices.push(i.readFloat()):2===t?e.faces.push(i.readVarint()):console.warn(`Unsupported pbf tag (${t})`)}yw.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),r=n>>3,a=this.pos;this.type=7&n,t(r,e,this),this.pos===a&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Dw(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Bw(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Dw(this.buf,this.pos)+Dw(this.buf,this.pos+4)*vw;return this.pos+=8,t},readSFixed64:function(){var t=Dw(this.buf,this.pos)+Bw(this.buf,this.pos+4)*vw;return this.pos+=8,t},readFloat:function(){var t=_w.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=_w.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,n=this.buf;return e=127&(i=n[this.pos++]),i<128?e:(e|=(127&(i=n[this.pos++]))<<7,i<128?e:(e|=(127&(i=n[this.pos++]))<<14,i<128?e:(e|=(127&(i=n[this.pos++]))<<21,i<128?e:function(t,e,i){var n,r,a=i.buf;if(r=a[i.pos++],n=(112&r)>>4,r<128)return Sw(t,n,e);if(r=a[i.pos++],n|=(127&r)<<3,r<128)return Sw(t,n,e);if(r=a[i.pos++],n|=(127&r)<<10,r<128)return Sw(t,n,e);if(r=a[i.pos++],n|=(127&r)<<17,r<128)return Sw(t,n,e);if(r=a[i.pos++],n|=(127&r)<<24,r<128)return Sw(t,n,e);if(r=a[i.pos++],n|=(1&r)<<31,r<128)return Sw(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2===1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&bw?function(t,e,i){return bw.decode(t.subarray(e,i))}(this.buf,e,t):function(t,e,i){var n="",r=e;for(;r<i;){var a,o,s,l=t[r],c=null,u=l>239?4:l>223?3:l>191?2:1;if(r+u>i)break;1===u?l<128&&(c=l):2===u?128===(192&(a=t[r+1]))&&(c=(31&l)<<6|63&a)<=127&&(c=null):3===u?(a=t[r+1],o=t[r+2],128===(192&a)&&128===(192&o)&&((c=(15&l)<<12|(63&a)<<6|63&o)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(a=t[r+1],o=t[r+2],s=t[r+3],128===(192&a)&&128===(192&o)&&128===(192&s)&&((c=(15&l)<<18|(63&a)<<12|(63&o)<<6|63&s)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,n+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),n+=String.fromCharCode(c),r+=u}return n}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==yw.Bytes)return t.push(this.readVarint(e));var i=ww(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==yw.Bytes)return t.push(this.readSVarint());var e=ww(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==yw.Bytes)return t.push(this.readBoolean());var e=ww(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==yw.Bytes)return t.push(this.readFloat());var e=ww(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==yw.Bytes)return t.push(this.readDouble());var e=ww(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==yw.Bytes)return t.push(this.readFixed32());var e=ww(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==yw.Bytes)return t.push(this.readSFixed32());var e=ww(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==yw.Bytes)return t.push(this.readFixed64());var e=ww(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==yw.Bytes)return t.push(this.readSFixed64());var e=ww(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===yw.Varint)for(;this.buf[this.pos++]>127;);else if(e===yw.Bytes)this.pos=this.readVarint()+this.pos;else if(e===yw.Fixed32)this.pos+=4;else{if(e!==yw.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Lw(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Lw(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Lw(this.buf,-1&t,this.pos),Lw(this.buf,Math.floor(t*xw),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Lw(this.buf,-1&t,this.pos),Lw(this.buf,Math.floor(t*xw),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var i,n;t>=0?(i=t%4294967296|0,n=t/4294967296|0):(n=~(-t/4294967296),4294967295^(i=~(-t%4294967296))?i=i+1|0:(i=0,n=n+1|0));if(t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,i){i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos]=127&t}(i,0,e),function(t,e){var i=(7&t)<<4;if(e.buf[e.pos++]|=i|((t>>>=3)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;e.buf[e.pos++]=127&t}(n,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var n,r,a=0;a<e.length;a++){if((n=e.charCodeAt(a))>55295&&n<57344){if(!r){n>56319||a+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):r=n;continue}if(n<56320){t[i++]=239,t[i++]=191,t[i++]=189,r=n;continue}n=r-55296<<10|n-56320|65536,r=null}else r&&(t[i++]=239,t[i++]=191,t[i++]=189,r=null);n<128?t[i++]=n:(n<2048?t[i++]=n>>6|192:(n<65536?t[i++]=n>>12|224:(t[i++]=n>>18|240,t[i++]=n>>12&63|128),t[i++]=n>>6&63|128),t[i++]=63&n|128)}return i}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&Ew(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),_w.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),_w.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var n=this.pos-i;n>=128&&Ew(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,i){this.writeTag(t,yw.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Tw,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Mw,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Aw,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Cw,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Iw,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,kw,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,Rw,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,zw,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Pw,e)},writeBytesField:function(t,e){this.writeTag(t,yw.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,yw.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,yw.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,yw.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,yw.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,yw.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,yw.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,yw.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,yw.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,yw.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};class Uw extends Em{constructor(t){super(),this._geometry=t}get geometry(){return this._geometry}fire(t,e){super.fire(t,e)}getCoreImages(t){return Promise.reject(new Yh("Not implemented"))}getCluster(t,e){return Promise.reject(new Yh("Not implemented"))}getSpatialImages(t){return Promise.reject(new Yh("Not implemented"))}getImages(t){return Promise.reject(new Yh("Not implemented"))}getImageBuffer(t,e){return Promise.reject(new Yh("Not implemented"))}getImageTiles(t){return Promise.reject(new Yh("Not implemented"))}getMesh(t,e){return Promise.reject(new Yh("Not implemented"))}getSequence(t){return Promise.reject(new Yh("Not implemented"))}off(t,e){super.off(t,e)}on(t,e){super.on(t,e)}setAccessToken(t){throw new Yh("Not implemented")}}var $w,Vw={exports:{}},jw={exports:{}};$w=jw,function(t,e){$w&&$w.exports?$w.exports=e():(t.dcodeIO=t.dcodeIO||{}).Long=e()}(Mp,(function(){function t(t,e,i){this.low=0|t,this.high=0|e,this.unsigned=!!i}function e(t){return!0===(t&&t.__isLong__)}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),t.isLong=e;var i={},n={};function r(t,e){var r,a,s;return e?(s=0<=(t>>>=0)&&t<256)&&(a=n[t])?a:(r=o(t,(0|t)<0?-1:0,!0),s&&(n[t]=r),r):(s=-128<=(t|=0)&&t<128)&&(a=i[t])?a:(r=o(t,t<0?-1:0,!1),s&&(i[t]=r),r)}function a(t,e){if(isNaN(t)||!isFinite(t))return e?m:f;if(e){if(t<0)return m;if(t>=h)return x}else{if(t<=-p)return b;if(t+1>=p)return v}return t<0?a(-t,e).neg():o(t%u|0,t/u|0,e)}function o(e,i,n){return new t(e,i,n)}t.fromInt=r,t.fromNumber=a,t.fromBits=o;var s=Math.pow;function l(t,e,i){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return f;if("number"===typeof e?(i=e,e=!1):e=!!e,(i=i||10)<2||36<i)throw RangeError("radix");var n;if((n=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===n)return l(t.substring(1),e,i).neg();for(var r=a(s(i,8)),o=f,c=0;c<t.length;c+=8){var u=Math.min(8,t.length-c),h=parseInt(t.substring(c,c+u),i);if(u<8){var p=a(s(i,u));o=o.mul(p).add(a(h))}else o=(o=o.mul(r)).add(a(h))}return o.unsigned=e,o}function c(e){return e instanceof t?e:"number"===typeof e?a(e):"string"===typeof e?l(e):o(e.low,e.high,e.unsigned)}t.fromString=l,t.fromValue=c;var u=4294967296,h=u*u,p=h/2,d=r(1<<24),f=r(0);t.ZERO=f;var m=r(0,!0);t.UZERO=m;var g=r(1);t.ONE=g;var _=r(1,!0);t.UONE=_;var y=r(-1);t.NEG_ONE=y;var v=o(-1,2147483647,!1);t.MAX_VALUE=v;var x=o(-1,-1,!0);t.MAX_UNSIGNED_VALUE=x;var b=o(0,-2147483648,!1);t.MIN_VALUE=b;var w=t.prototype;return w.toInt=function(){return this.unsigned?this.low>>>0:this.low},w.toNumber=function(){return this.unsigned?(this.high>>>0)*u+(this.low>>>0):this.high*u+(this.low>>>0)},w.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(b)){var e=a(t),i=this.div(e),n=i.mul(e).sub(this);return i.toString(t)+n.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var r=a(s(t,6),this.unsigned),o=this,l="";;){var c=o.div(r),u=(o.sub(c.mul(r)).toInt()>>>0).toString(t);if((o=c).isZero())return u+l;for(;u.length<6;)u="0"+u;l=""+u+l}},w.getHighBits=function(){return this.high},w.getHighBitsUnsigned=function(){return this.high>>>0},w.getLowBits=function(){return this.low},w.getLowBitsUnsigned=function(){return this.low>>>0},w.getNumBitsAbs=function(){if(this.isNegative())return this.eq(b)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},w.isZero=function(){return 0===this.high&&0===this.low},w.isNegative=function(){return!this.unsigned&&this.high<0},w.isPositive=function(){return this.unsigned||this.high>=0},w.isOdd=function(){return 1===(1&this.low)},w.isEven=function(){return 0===(1&this.low)},w.equals=function(t){return e(t)||(t=c(t)),(this.unsigned===t.unsigned||this.high>>>31!==1||t.high>>>31!==1)&&this.high===t.high&&this.low===t.low},w.eq=w.equals,w.notEquals=function(t){return!this.eq(t)},w.neq=w.notEquals,w.lessThan=function(t){return this.comp(t)<0},w.lt=w.lessThan,w.lessThanOrEqual=function(t){return this.comp(t)<=0},w.lte=w.lessThanOrEqual,w.greaterThan=function(t){return this.comp(t)>0},w.gt=w.greaterThan,w.greaterThanOrEqual=function(t){return this.comp(t)>=0},w.gte=w.greaterThanOrEqual,w.compare=function(t){if(e(t)||(t=c(t)),this.eq(t))return 0;var i=this.isNegative(),n=t.isNegative();return i&&!n?-1:!i&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},w.comp=w.compare,w.negate=function(){return!this.unsigned&&this.eq(b)?b:this.not().add(g)},w.neg=w.negate,w.add=function(t){e(t)||(t=c(t));var i=this.high>>>16,n=65535&this.high,r=this.low>>>16,a=65535&this.low,s=t.high>>>16,l=65535&t.high,u=t.low>>>16,h=0,p=0,d=0,f=0;return d+=(f+=a+(65535&t.low))>>>16,p+=(d+=r+u)>>>16,h+=(p+=n+l)>>>16,h+=i+s,o((d&=65535)<<16|(f&=65535),(h&=65535)<<16|(p&=65535),this.unsigned)},w.subtract=function(t){return e(t)||(t=c(t)),this.add(t.neg())},w.sub=w.subtract,w.multiply=function(t){if(this.isZero())return f;if(e(t)||(t=c(t)),t.isZero())return f;if(this.eq(b))return t.isOdd()?b:f;if(t.eq(b))return this.isOdd()?b:f;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(d)&&t.lt(d))return a(this.toNumber()*t.toNumber(),this.unsigned);var i=this.high>>>16,n=65535&this.high,r=this.low>>>16,s=65535&this.low,l=t.high>>>16,u=65535&t.high,h=t.low>>>16,p=65535&t.low,m=0,g=0,_=0,y=0;return _+=(y+=s*p)>>>16,g+=(_+=r*p)>>>16,_&=65535,g+=(_+=s*h)>>>16,m+=(g+=n*p)>>>16,g&=65535,m+=(g+=r*h)>>>16,g&=65535,m+=(g+=s*u)>>>16,m+=i*p+n*h+r*u+s*l,o((_&=65535)<<16|(y&=65535),(m&=65535)<<16|(g&=65535),this.unsigned)},w.mul=w.multiply,w.divide=function(t){if(e(t)||(t=c(t)),t.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?m:f;var i,n,r;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return m;if(t.gt(this.shru(1)))return _;r=m}else{if(this.eq(b))return t.eq(g)||t.eq(y)?b:t.eq(b)?g:(i=this.shr(1).div(t).shl(1)).eq(f)?t.isNegative()?g:y:(n=this.sub(t.mul(i)),r=i.add(n.div(t)));if(t.eq(b))return this.unsigned?m:f;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();r=f}for(n=this;n.gte(t);){i=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));for(var o=Math.ceil(Math.log(i)/Math.LN2),l=o<=48?1:s(2,o-48),u=a(i),h=u.mul(t);h.isNegative()||h.gt(n);)h=(u=a(i-=l,this.unsigned)).mul(t);u.isZero()&&(u=g),r=r.add(u),n=n.sub(h)}return r},w.div=w.divide,w.modulo=function(t){return e(t)||(t=c(t)),this.sub(this.div(t).mul(t))},w.mod=w.modulo,w.not=function(){return o(~this.low,~this.high,this.unsigned)},w.and=function(t){return e(t)||(t=c(t)),o(this.low&t.low,this.high&t.high,this.unsigned)},w.or=function(t){return e(t)||(t=c(t)),o(this.low|t.low,this.high|t.high,this.unsigned)},w.xor=function(t){return e(t)||(t=c(t)),o(this.low^t.low,this.high^t.high,this.unsigned)},w.shiftLeft=function(t){return e(t)&&(t=t.toInt()),0===(t&=63)?this:t<32?o(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):o(0,this.low<<t-32,this.unsigned)},w.shl=w.shiftLeft,w.shiftRight=function(t){return e(t)&&(t=t.toInt()),0===(t&=63)?this:t<32?o(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):o(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},w.shr=w.shiftRight,w.shiftRightUnsigned=function(t){if(e(t)&&(t=t.toInt()),0===(t&=63))return this;var i=this.high;return t<32?o(this.low>>>t|i<<32-t,i>>>t,this.unsigned):o(32===t?i:i>>>t-32,0,this.unsigned)},w.shru=w.shiftRightUnsigned,w.toSigned=function(){return this.unsigned?o(this.low,this.high,!1):this},w.toUnsigned=function(){return this.unsigned?this:o(this.low,this.high,!0)},w.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},w.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24&255,255&t,t>>>8&255,t>>>16&255,t>>>24&255]},w.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24&255,t>>>16&255,t>>>8&255,255&t,e>>>24&255,e>>>16&255,e>>>8&255,255&e]},t})),function(t){!function(t){var e=t.S2={L:{}};e.L.LatLng=function(t,e,i){var n=parseFloat(t,10),r=parseFloat(e,10);if(isNaN(n)||isNaN(r))throw new Error("Invalid LatLng object: ("+t+", "+e+")");return!0!==i&&(n=Math.max(Math.min(n,90),-90),r=(r+180)%360+(r<-180||180===r?180:-180)),{lat:n,lng:r}},e.L.LatLng.DEG_TO_RAD=Math.PI/180,e.L.LatLng.RAD_TO_DEG=180/Math.PI,e.LatLngToXYZ=function(t){var i=e.L.LatLng.DEG_TO_RAD,n=t.lat*i,r=t.lng*i,a=Math.cos(n);return[Math.cos(r)*a,Math.sin(r)*a,Math.sin(n)]},e.XYZToLatLng=function(t){var i=e.L.LatLng.RAD_TO_DEG,n=Math.atan2(t[2],Math.sqrt(t[0]*t[0]+t[1]*t[1])),r=Math.atan2(t[1],t[0]);return e.L.LatLng(n*i,r*i)};e.XYZToFaceUV=function(t){var e=function(t){var e=[Math.abs(t[0]),Math.abs(t[1]),Math.abs(t[2])];return e[0]>e[1]?e[0]>e[2]?0:2:e[1]>e[2]?1:2}(t);t[e]<0&&(e+=3);var i=function(t,e){var i,n;switch(t){case 0:i=e[1]/e[0],n=e[2]/e[0];break;case 1:i=-e[0]/e[1],n=e[2]/e[1];break;case 2:i=-e[0]/e[2],n=-e[1]/e[2];break;case 3:i=e[2]/e[0],n=e[1]/e[0];break;case 4:i=e[2]/e[1],n=-e[0]/e[1];break;case 5:i=-e[1]/e[2],n=-e[0]/e[2];break;default:throw{error:"Invalid face"}}return[i,n]}(e,t);return[e,i]},e.FaceUVToXYZ=function(t,e){var i=e[0],n=e[1];switch(t){case 0:return[1,i,n];case 1:return[-i,1,n];case 2:return[-i,-n,1];case 3:return[-1,-n,-i];case 4:return[n,-1,-i];case 5:return[n,i,-1];default:throw{error:"Invalid face"}}};var i=function(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))};e.STToUV=function(t){return[i(t[0]),i(t[1])]};var n=function(t){return t>=0?.5*Math.sqrt(1+3*t):1-.5*Math.sqrt(1-3*t)};e.UVToST=function(t){return[n(t[0]),n(t[1])]},e.STToIJ=function(t,e){var i=1<<e,n=function(t){var e=Math.floor(t*i);return Math.max(0,Math.min(i-1,e))};return[n(t[0]),n(t[1])]},e.IJToST=function(t,e,i){var n=1<<e;return[(t[0]+i[0])/n,(t[1]+i[1])/n]};var r=function(t,e,i,n){if(0==n){1==i&&(e.x=t-1-e.x,e.y=t-1-e.y);var r=e.x;e.x=e.y,e.y=r}},a=function(t,e,i,n){var r={a:[[0,"d"],[1,"a"],[3,"b"],[2,"a"]],b:[[2,"b"],[1,"b"],[3,"a"],[0,"c"]],c:[[2,"c"],[3,"d"],[1,"c"],[0,"b"]],d:[[0,"a"],[3,"c"],[1,"d"],[2,"d"]]};"number"!==typeof n&&console.warn(new Error("called pointToHilbertQuadList without face value, defaulting to '0'").stack);for(var a=n%2?"d":"a",o=[],s=i-1;s>=0;s--){var l=1<<s,c=r[a][2*(t&l?1:0)+(e&l?1:0)];o.push(c[0]),a=c[1]}return o};e.S2Cell=function(){},e.S2Cell.FromHilbertQuadKey=function(t){var i,n,a,o,s,l,c=t.split("/"),u=parseInt(c[0]),h=c[1],p=h.length,d={x:0,y:0};for(i=p-1;i>=0;i--)n=p-i,o=0,s=0,"1"===(a=h[i])?s=1:"2"===a?(o=1,s=1):"3"===a&&(o=1),l=Math.pow(2,n-1),r(l,d,o,s),d.x+=l*o,d.y+=l*s;if(u%2===1){var f=d.x;d.x=d.y,d.y=f}return e.S2Cell.FromFaceIJ(parseInt(u),[d.x,d.y],n)},e.S2Cell.FromLatLng=function(t,i){if(!t.lat&&0!==t.lat||!t.lng&&0!==t.lng)throw new Error("Pass { lat: lat, lng: lng } to S2.S2Cell.FromLatLng");var n=e.LatLngToXYZ(t),r=e.XYZToFaceUV(n),a=e.UVToST(r[1]),o=e.STToIJ(a,i);return e.S2Cell.FromFaceIJ(r[0],o,i)},e.S2Cell.FromFaceIJ=function(t,i,n){var r=new e.S2Cell;return r.face=t,r.ij=i,r.level=n,r},e.S2Cell.prototype.toString=function(){return"F"+this.face+"ij["+this.ij[0]+","+this.ij[1]+"]@"+this.level},e.S2Cell.prototype.getLatLng=function(){var t=e.IJToST(this.ij,this.level,[.5,.5]),i=e.STToUV(t),n=e.FaceUVToXYZ(this.face,i);return e.XYZToLatLng(n)},e.S2Cell.prototype.getCornerLatLngs=function(){for(var t=[],i=[[0,0],[0,1],[1,1],[1,0]],n=0;n<4;n++){var r=e.IJToST(this.ij,this.level,i[n]),a=e.STToUV(r),o=e.FaceUVToXYZ(this.face,a);t.push(e.XYZToLatLng(o))}return t},e.S2Cell.prototype.getFaceAndQuads=function(){var t=a(this.ij[0],this.ij[1],this.level,this.face);return[this.face,t]},e.S2Cell.prototype.toHilbertQuadkey=function(){var t=a(this.ij[0],this.ij[1],this.level,this.face);return this.face.toString(10)+"/"+t.join("")},e.latLngToNeighborKeys=e.S2Cell.latLngToNeighborKeys=function(t,i,n){return e.S2Cell.FromLatLng({lat:t,lng:i},n).getNeighbors().map((function(t){return t.toHilbertQuadkey()}))},e.S2Cell.prototype.getNeighbors=function(){var t=function(t,i,n){var r=1<<n;if(i[0]>=0&&i[1]>=0&&i[0]<r&&i[1]<r)return e.S2Cell.FromFaceIJ(t,i,n);var a=e.IJToST(i,n,[.5,.5]),o=e.STToUV(a),s=e.FaceUVToXYZ(t,o),l=e.XYZToFaceUV(s);return t=l[0],o=l[1],a=e.UVToST(o),i=e.STToIJ(a,n),e.S2Cell.FromFaceIJ(t,i,n)},i=this.face,n=this.ij[0],r=this.ij[1],a=this.level;return[t(i,[n-1,r],a),t(i,[n,r-1],a),t(i,[n+1,r],a),t(i,[n,r+1],a)]},e.FACE_BITS=3,e.MAX_LEVEL=30,e.POS_BITS=2*e.MAX_LEVEL+1,e.facePosLevelToId=e.S2Cell.facePosLevelToId=e.fromFacePosLevel=function(i,n,r){var a,o,s,l=t.dcodeIO&&t.dcodeIO.Long||jw.exports;for(r||(r=n.length),n.length>r&&(n=n.substr(0,r)),a=l.fromString(i.toString(10),!0,10).toString(2);a.length<e.FACE_BITS;)a="0"+a;for(o=l.fromString(n,!0,4).toString(2);o.length<2*r;)o="0"+o;for(s=a+o,s+="1";s.length<e.FACE_BITS+e.POS_BITS;)s+="0";return l.fromString(s,!0,2).toString(10)},e.keyToId=e.S2Cell.keyToId=e.toId=e.toCellId=e.fromKey=function(t){var i=t.split("/");return e.fromFacePosLevel(i[0],i[1],i[1].length)},e.idToKey=e.S2Cell.idToKey=e.S2Cell.toKey=e.toKey=e.fromId=e.fromCellId=e.S2Cell.toHilbertQuadkey=e.toHilbertQuadkey=function(i){for(var n=t.dcodeIO&&t.dcodeIO.Long||jw.exports,r=n.fromString(i,!0,10).toString(2);r.length<e.FACE_BITS+e.POS_BITS;)r="0"+r;for(var a=r.lastIndexOf("1"),o=r.substring(0,3),s=r.substring(3,a),l=s.length/2,c=n.fromString(o,!0,2).toString(10),u=n.fromString(s,!0,2).toString(4);u.length<l;)u="0"+u;return c+"/"+u},e.keyToLatLng=e.S2Cell.keyToLatLng=function(t){return e.S2Cell.FromHilbertQuadKey(t).getLatLng()},e.idToLatLng=e.S2Cell.idToLatLng=function(t){var i=e.idToKey(t);return e.keyToLatLng(i)},e.S2Cell.latLngToKey=e.latLngToKey=e.latLngToQuadkey=function(t,i,n){if(isNaN(n)||n<1||n>30)throw new Error("'level' is not a number between 1 and 30 (but it should be)");return e.S2Cell.FromLatLng({lat:t,lng:i},n).toHilbertQuadkey()},e.stepKey=function(e,i){var n,r=t.dcodeIO&&t.dcodeIO.Long||jw.exports,a=e.split("/"),o=a[0],s=a[1],l=a[1].length,c=r.fromString(s,!0,4);i>0?n=c.add(Math.abs(i)):i<0&&(n=c.subtract(Math.abs(i)));var u=n.toString(4);for("0"===u&&console.warning(new Error("face/position wrapping is not yet supported"));u.length<l;)u="0"+u;return o+"/"+u},e.S2Cell.prevKey=e.prevKey=function(t){return e.stepKey(t,-1)},e.S2Cell.nextKey=e.nextKey=function(t){return e.stepKey(t,1)}}(t.exports)}(Vw);class qw extends class{constructor(){}bboxToCellIds(t,e){throw new Yh("Not implemented")}getAdjacent(t){throw new Yh("Not implemented")}getVertices(t){throw new Yh("Not implemented")}lngLatToCellId(t){throw new Yh("Not implemented")}_approxBboxToCellIds(t,e){if(e.lat<=t.lat||e.lng<=t.lng)throw new Yh("North east needs to be top right of south west");const i=(t.lat+e.lat)/2,n=(t.lng+e.lng)/2,r=Fh(e.lng,e.lat,0,n,i,0),a=Math.max(r[0],r[1]);return this._lngLatToCellIds({lat:i,lng:n},a)}_enuToGeodetic(t,e){const[i,n]=Nh(t[0],t[1],t[2],e.lng,e.lat,0);return{lat:n,lng:i}}_getLngLatBoundingBoxCorners(t,e){return[[-e,e,0],[e,e,0],[e,-e,0],[-e,-e,0]].map((e=>this._enuToGeodetic(e,t)))}_lngLatToCellIds(t,e){const i=this.lngLatToCellId(t),n=this._getLngLatBoundingBoxCorners(t,e);for(const r of n){if(this.lngLatToCellId(r)!==i)return[i,...this.getAdjacent(i)]}return[i]}}{constructor(t=17){super(),this._level=t}bboxToCellIds(t,e){return this._approxBboxToCellIds(t,e)}getAdjacent(t){const e=Vw.exports.S2.idToKey(t),i=e.split("/")[1].length,[n,r,a,o]=this._getNeighbors(e,i),s=[e,n,r,a,o],l=Array.from(new Set([...this._getNeighbors(n,i),...this._getNeighbors(r,i),...this._getNeighbors(a,i),...this._getNeighbors(o,i)].filter((t=>!s.includes(t))))),c=[n,r,a,o];for(const u of l){let t=0;for(const e of this._getNeighbors(u,i))s.includes(e)&&t++;2===t&&c.push(u)}return c.map((t=>Vw.exports.S2.keyToId(t)))}getVertices(t){const e=Vw.exports.S2.idToKey(t);return Vw.exports.S2.S2Cell.FromHilbertQuadKey(e).getCornerLatLngs().map((t=>({lat:t.lat,lng:t.lng})))}lngLatToCellId(t){return this._lngLatToId(t,this._level)}_getNeighbors(t,e){const i=Vw.exports.S2.keyToLatLng(t);return Vw.exports.S2.latLngToNeighborKeys(i.lat,i.lng,e)}_lngLatToId(t,e){const i=Vw.exports.S2.latLngToKey(t.lat,t.lng,e);return Vw.exports.S2.keyToId(i)}}class Gw{clusterReconstruction(t){const e=t.points,i=1/255;for(const r in e){if(!e.hasOwnProperty(r))continue;const t=e[r].color;t[0]*=i,t[1]*=i,t[2]*=i}const n=t.reference_lla;return{id:null,points:e,reference:{alt:n.altitude,lat:n.latitude,lng:n.longitude}}}coreImage(t){const e=this._geometry(t.geometry),i=this._geometry(t.computed_geometry),n={id:t.sequence};return{computed_geometry:i,geometry:e,id:t.id,sequence:n}}spatialImage(t){var e,i,n,r;t.camera_type=function(t){switch(t){case"equirectangular":case"spherical":return"spherical";case"fisheye":return"fisheye";default:return"perspective"}}(t.camera_type),t.merge_id=t.merge_cc?t.merge_cc.toString():null,t.private=null;const a="spherical"===t.camera_type?t.thumb_2048_url:t.thumb_1024_url;return t.thumb=null!==(e=t.thumb)&&void 0!==e?e:{id:null,url:a},t.cluster=null!==(i=t.sfm_cluster)&&void 0!==i?i:{id:null,url:null},t.creator={id:null,username:null},t.owner=null!==(n=t.owner)&&void 0!==n?n:{id:null},t.mesh=null!==(r=t.mesh)&&void 0!==r?r:{id:null,url:null},t}_geometry(t){const e=null===t||void 0===t?void 0:t.coordinates;return e?{lat:e[1],lng:e[0]}:null}}class Hw{constructor(){this.imagesPath="images",this.sequencePath="image_ids",this._imageTilesPath="tiles",this.coreFields=["computed_geometry","geometry","sequence"],this.idFields=["id"],this.spatialFields=["altitude","atomic_scale","camera_parameters","camera_type","captured_at","compass_angle","computed_altitude","computed_compass_angle","computed_rotation","exif_orientation","height","merge_cc","mesh","quality_score","sfm_cluster","thumb_1024_url","thumb_2048_url","width"],this.imageTileFields=["url","z","x","y"]}images(t,e){return`image_ids=${t.join(",")}&fields=${e.join(",")}`}imagesS2(t,e){return`s2=${t}&fields=${e.join(",")}`}imageTiles(t,e){return`z=${t}&fields=${e.join(",")}`}imageTilesPath(t){return`${t}/${this._imageTilesPath}`}sequence(t){return`sequence_id=${t}`}}class Ww extends Uw{constructor(t,e,i,n){var r;super(null!==e&&void 0!==e?e:new qw),this._convert=null!==i&&void 0!==i?i:new Gw,this._query=null!==n&&void 0!==n?n:new Hw,this._method="GET";const a=null!==t&&void 0!==t?t:{};this._endpoint=null!==(r=a.endpoint)&&void 0!==r?r:"https://graph.mapillary.com",this._accessToken=a.accessToken}getCluster(t,e){return Ow(t,e).then((t=>{const e=function(t){const e=fw(t,{to:"string"});return JSON.parse(e)}(t);if(e.length<1)throw new Error("Cluster reconstruction empty");return this._convert.clusterReconstruction(e[0])}))}getCoreImages(t){const e=[...this._query.idFields,...this._query.coreFields],i=this._query.imagesS2(t,e),n=new URL(this._query.imagesPath,this._endpoint).href;return this._fetchGraphContract(i,n).then((e=>{const i={cell_id:t,images:[]},n=e.data;for(const t of n){const e=this._convert.coreImage(t);i.images.push(e)}return i}))}getImageBuffer(t,e){return Ow(t,e)}getImages(t){const e=[...this._query.idFields,...this._query.coreFields,...this._query.spatialFields],i=this._query.images(t,e),n=new URL(this._query.imagesPath,this._endpoint).href;return this._fetchGraphContract(i,n).then((t=>{const e=[],i=t.data;for(const n of i){const t=this._convert.coreImage(n),i=this._convert.spatialImage(n),r={node:Object.assign({},i,t),node_id:n.id};e.push(r)}return e}))}getImageTiles(t){const e=[...this._query.imageTileFields],i=this._query.imageTiles(t.z,e),n=new URL(this._query.imageTilesPath(t.imageId),this._endpoint).href;return this._fetchGraphContract(i,n).then((e=>({node:e.data,node_id:t.imageId})))}getMesh(t,e){return Ow(t,e).then((t=>function(t){return new gw(t).readFields(Nw,{faces:[],vertices:[]})}(t)))}getSequence(t){const e=this._query.sequence(t),i=new URL(this._query.sequencePath,this._endpoint).href;return this._fetchGraphContract(e,i).then((e=>({id:t,image_ids:e.data.map((t=>t.id))})))}getSpatialImages(t){const e=[...this._query.idFields,...this._query.coreFields,...this._query.spatialFields],i=this._query.images(t,e),n=new URL(this._query.imagesPath,this._endpoint).href;return this._fetchGraphContract(i,n).then((t=>{const e=[],i=t.data;for(const n of i){const t={node:this._convert.spatialImage(n),node_id:n.id};e.push(t)}return e}))}setAccessToken(t){this._accessToken=t}_createHeaders(){const t=[{name:"Accept",value:"application/json"},{name:"Content-Type",value:"application/x-www-form-urlencoded"}];return this._accessToken&&t.push({name:"Authorization",value:`OAuth ${this._accessToken}`}),t}_fetchGraphContract(t,e){return Fw(`${e}?${t}`,this._method,"json",this._createHeaders(),null,null).catch((t=>{const e=this._makeErrorMessage(t);throw new Yh(e)}))}_makeErrorMessage(t){const e=t.error;return e?`${e.code} (${e.type}, ${e.fbtrace_id}): ${e.message}`:"Failed to fetch data"}}class Zw{constructor(t,e){this._id=t,this._lngLat=e}get id(){return this._id}get geometry(){return this._geometry}get lngLat(){return this._lngLat}createGeometry(t){this._geometry||(this._createGeometry(t),this._geometry.updateMatrixWorld(!0))}disposeGeometry(){this._geometry&&(this._disposeGeometry(),this._geometry=void 0)}getInteractiveObjects(){return this._geometry?this._getInteractiveObjects():[]}lerpAltitude(t,e){this._geometry&&(this._geometry.position.z=(1-e)*this._geometry.position.z+e*t)}updatePosition(t,e){e&&(this._lngLat.lat=e.lat,this._lngLat.lng=e.lng),this._geometry&&(this._geometry.position.fromArray(t),this._geometry.updateMatrixWorld(!0))}}class Yw extends Zw{constructor(t,e,i){super(t,e),i=i||{},this._ballColor=null!=i.ballColor?i.ballColor:16711680,this._ballOpacity=null!=i.ballOpacity?i.ballOpacity:.8,this._circleToRayAngle=2,this._color=null!=i.color?i.color:16711680,this._interactive=!!i.interactive,this._opacity=null!=i.opacity?i.opacity:.4,this._radius=null!=i.radius?i.radius:1}_createGeometry(t){const e=this._radius,i=this._markerHeight(e),n=new qr({color:this._color,opacity:this._opacity,transparent:!0,depthWrite:!1}),r=new wa(this._createMarkerGeometry(e,8,8),n),a=new wa(new Eu(e/2,8,8),new qr({color:this._ballColor,opacity:this._ballOpacity,transparent:!0}));a.position.z=i,a.renderOrder=1;const o=new Sr;o.add(a),o.add(r),o.position.fromArray(t),this._geometry=o}_disposeGeometry(){for(const t of this._geometry.children)t.geometry.dispose(),t.material.dispose()}_getInteractiveObjects(){return this._interactive?[this._geometry.children[0]]:[]}_markerHeight(t){const e=Math.tan(Math.PI-this._circleToRayAngle);return t*Math.sqrt(1+e*e)}_createMarkerGeometry(t,e,i){const n=this._markerHeight(t),r=this._circleToRayAngle,a=[],o=new Float32Array(3*(e+1)*(i+1));let s=0;for(let p=0;p<=i;++p){const l=[];for(let a=0;a<=e;++a){const c=a/e*Math.PI*2,u=p/i*Math.PI;let h=t;if(u>r){const e=Math.tan(u-r);h=t*Math.sqrt(1+e*e)}const d=3*s,f=Math.sin(u);o[d+0]=h*Math.cos(c)*f,o[d+1]=h*Math.sin(c)*f,o[d+2]=h*Math.cos(u)+n,l.push(s++)}a.push(l)}const l=new Uint16Array(6*e*i);let c=0;for(let p=0;p<i;++p)for(let t=0;t<e;++t){const e=a[p][t+1],i=a[p][t],n=a[p+1][t],r=a[p+1][t+1];l[c++]=e,l[c++]=i,l[c++]=r,l[c++]=i,l[c++]=n,l[c++]=r}const u=new ra,h=new Wr(o,3);return u.setAttribute("position",h),u.setIndex(new Wr(l,1)),u}}var Xw,Kw,Jw,Qw;!function(t){t[t.Custom=0]="Custom",t[t.Earth=1]="Earth",t[t.Street=2]="Street"}(Xw||(Xw={})),function(t){t[t.Letterbox=0]="Letterbox",t[t.Fill=1]="Fill"}(Kw||(Kw={})),function(t){t[t.Opaque=0]="Opaque"}(Jw||(Jw={})),function(t){t[t.Default=0]="Default",t[t.Instantaneous=1]="Instantaneous"}(Qw||(Qw={}));class tS{constructor(t,e,i,n,r,a){this._container=t,this._observer=i,this._navigator=e,this._options=null!=r?r:{},this._key=n,this._navigable=null==n,this._componentService=a||new Tp(this._container,this._navigator),this._coverComponent=this._componentService.getCover(),this._initializeComponents(),n?(this._initilizeCoverComponent(),this._subscribeCoverComponent()):this._navigator.movedToId$.pipe(He((t=>null!=t))).subscribe((t=>{this._key=t,this._componentService.deactivateCover(),this._coverComponent.configure({id:this._key,state:bm.Hidden}),this._subscribeCoverComponent(),this._navigator.stateService.start(),this._navigator.cacheService.start(),this._navigator.panService.start(),this._observer.startEmit()}))}get navigable(){return this._navigable}get(t){return this._componentService.get(t)}activate(t){this._componentService.activate(t)}activateCover(){this._coverComponent.configure({state:bm.Visible})}deactivate(t){this._componentService.deactivate(t)}deactivateCover(){this._coverComponent.configure({state:bm.Loading})}remove(){this._componentService.remove(),null!=this._configurationSubscription&&this._configurationSubscription.unsubscribe()}_initializeComponents(){var t,e;const i=this._options;this._uFalse(null===(t=i.fallback)||void 0===t?void 0:t.image,"imagefallback"),this._uFalse(null===(e=i.fallback)||void 0===e?void 0:e.navigation,"navigationfallback"),this._uFalse(i.marker,"marker"),this._uFalse(i.popup,"popup"),this._uFalse(i.slider,"slider"),this._uFalse(i.spatial,"spatial"),this._uFalse(i.tag,"tag"),this._uTrue(i.attribution,"attribution"),this._uTrue(i.bearing,"bearing"),this._uTrue(i.cache,"cache"),this._uTrue(i.direction,"direction"),this._uTrue(i.image,"image"),this._uTrue(i.keyboard,"keyboard"),this._uTrue(i.pointer,"pointer"),this._uTrue(i.sequence,"sequence"),this._uTrue(i.zoom,"zoom")}_initilizeCoverComponent(){let t=this._options;this._coverComponent.configure({id:this._key}),void 0===t.cover||t.cover?this.activateCover():this.deactivateCover()}_setNavigable(t){this._navigable!==t&&(this._navigable=t,this._observer.navigable$.next(t))}_subscribeCoverComponent(){this._configurationSubscription=this._coverComponent.configuration$.pipe(Ue(void 0,(t=>t.state))).subscribe((t=>{t.state===bm.Loading?this._navigator.stateService.currentId$.pipe(He(),oi((e=>{const i=null==e||e!==t.id;return i&&this._setNavigable(!1),i?this._navigator.moveTo$(t.id):this._navigator.stateService.currentImage$.pipe(He())}))).subscribe((()=>{this._navigator.stateService.start(),this._navigator.cacheService.start(),this._navigator.panService.start(),this._observer.startEmit(),this._coverComponent.configure({state:bm.Hidden}),this._componentService.deactivateCover(),this._setNavigable(!0)}),(t=>{console.error("Failed to deactivate cover.",t),this._coverComponent.configure({state:bm.Visible})})):t.state===bm.Visible&&(this._observer.stopEmit(),this._navigator.stateService.stop(),this._navigator.cacheService.stop(),this._navigator.playService.stop(),this._navigator.panService.stop(),this._componentService.activateCover(),this._setNavigable(null==t.id))}))}_uFalse(t,e){void 0!==t?"boolean"!==typeof t?(this._componentService.configure(e,t),this._componentService.activate(e)):t?this._componentService.activate(e):this._componentService.deactivate(e):this._componentService.deactivate(e)}_uTrue(t,e){void 0!==t?"boolean"!==typeof t?(this._componentService.configure(e,t),this._componentService.activate(e)):t?this._componentService.activate(e):this._componentService.deactivate(e):this._componentService.activate(e)}}class eS{constructor(t,e,i){this._adaptiveOperation$=new ht,this._render$=new ht,this._renderAdaptive$=new ht,this._subscriptions=new Tm,this._renderService=e,this._currentFrame$=i;const n=this._subscriptions,r=Sm.create(Sm.h("div.mapillary-dom-renderer",[]));t.appendChild(r),this._offset$=this._adaptiveOperation$.pipe(ti(((t,e)=>e(t)),{elementHeight:t.offsetHeight,elementWidth:t.offsetWidth,imageAspect:0,renderMode:Kw.Fill}),Ce((t=>t.imageAspect>0&&t.elementWidth>0&&t.elementHeight>0)),ee((t=>{const e=t.elementWidth/t.elementHeight,i=t.imageAspect/e;let n=0,r=0;return t.renderMode===Kw.Letterbox?t.imageAspect>e?n=t.elementHeight*(1-1/i)/2:r=t.elementWidth*(1-i)/2:t.imageAspect>e?r=-t.elementWidth*(i-1)/2:n=-t.elementHeight*(1/i-1)/2,{bottom:n,left:r,right:r,top:n}})));const a=this._currentFrame$.pipe(Ce((t=>null!=t.state.currentImage)),Ue(((t,e)=>t===e),(t=>t.state.currentImage.id)),ee((t=>t.state.currentTransform.basicAspect)),ee((t=>e=>(e.imageAspect=t,e)))).subscribe(this._adaptiveOperation$),o=ue(this._renderAdaptive$.pipe(ti(((t,e)=>(null==e.vNode?delete t[e.name]:t[e.name]=e.vNode,t)),{})),this._offset$).pipe(ee((t=>{const e=[],i=t[0];for(const a in i)i.hasOwnProperty(a)&&e.push(i[a]);const n=t[1],r={style:{bottom:n.bottom+"px",left:n.left+"px","pointer-events":"none",position:"absolute",right:n.right+"px",top:n.top+"px"}};return{name:"mapillary-dom-adaptive-renderer",vNode:Sm.h("div.mapillary-dom-adaptive-renderer",r,e)}}))).subscribe(this._render$);this._vNode$=this._render$.pipe(ti(((t,e)=>(null==e.vNode?delete t[e.name]:t[e.name]=e.vNode,t)),{}),ee((t=>{const e=[];for(const i in t)t.hasOwnProperty(i)&&e.push(t[i]);return Sm.h("div.mapillary-dom-renderer",e)}))),this._vPatch$=this._vNode$.pipe(ti(((t,e)=>(t.vpatch=Sm.diff(t.vNode,e),t.vNode=e,t)),{vNode:Sm.h("div.mapillary-dom-renderer",[]),vpatch:null}),function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t.length;if(0===i)throw new Error("list of properties cannot be empty.");return ee((function(e){for(var n=e,r=0;r<i;r++){var a=null===n||void 0===n?void 0:n[t[r]];if("undefined"===typeof a)return;n=a}return n}))}("vpatch")),this._element$=this._vPatch$.pipe(ti(((t,e)=>Sm.patch(t,e)),r),Je(1),lt()),n.push(a),n.push(o),n.push(this._element$.subscribe((()=>{}))),n.push(this._renderService.size$.pipe(ee((t=>e=>(e.elementWidth=t.width,e.elementHeight=t.height,e)))).subscribe(this._adaptiveOperation$)),n.push(this._renderService.renderMode$.pipe(ee((t=>e=>(e.renderMode=t,e)))).subscribe(this._adaptiveOperation$))}get element$(){return this._element$}get render$(){return this._render$}get renderAdaptive$(){return this._renderAdaptive$}clear(t){this._renderAdaptive$.next({name:t,vNode:null}),this._render$.next({name:t,vNode:null})}remove(){this._subscriptions.unsubscribe()}}class iS{constructor(t,e,i){this._renderFrame$=new ht,this._renderCameraOperation$=new ht,this._render$=new ht,this._clear$=new ht,this._renderOperation$=new ht,this._rendererOperation$=new ht,this._eraserOperation$=new ht,this._triggerOperation$=new ht,this._subscriptions=new Tm,this._opaqueRender$=new ht,this._renderService=i;const n=this._subscriptions;this._renderer$=this._rendererOperation$.pipe(ti(((t,e)=>e(t)),{needsRender:!1,renderer:null}),Ce((t=>!!t.renderer))),this._renderCollection$=this._renderOperation$.pipe(ti(((t,e)=>e(t)),{}),ei()),this._renderCamera$=this._renderCameraOperation$.pipe(ti(((t,e)=>e(t)),{frameId:-1,needsRender:!1,perspective:null})),this._eraser$=this._eraserOperation$.pipe(ai((t=>t)),ti(((t,e)=>e(t)),{needsRender:!1}));const r=this._triggerOperation$.pipe(ai((t=>t)),ti(((t,e)=>e(t)),{needsRender:!1})),a=new jr(986895),o=ue(this._renderer$,this._renderCollection$,this._renderCamera$,this._eraser$,r).pipe(ee((([t,e,i,n,r])=>({camera:i,eraser:n,trigger:r,renderer:t,renders:Object.keys(e).map((t=>e[t]))}))),Ce((t=>{let e=t.renderer.needsRender||t.camera.needsRender||t.eraser.needsRender||t.trigger.needsRender;const i=t.camera.frameId;for(const n of t.renders){if(n.frameId!==i)return!1;e=e||n.needsRender}return e})),Ue(((t,e)=>t===e),(t=>t.eraser.needsRender||t.trigger.needsRender?-t.camera.frameId:t.camera.frameId))).subscribe((t=>{t.renderer.needsRender=!1,t.camera.needsRender=!1,t.eraser.needsRender=!1,t.trigger.needsRender=!1;const e=t.camera.perspective,i=[],n=[];for(const a of t.renders)a.pass===Um.Background?i.push(a.render):a.pass===Um.Opaque&&n.push(a.render);const r=t.renderer.renderer;r.resetState(),r.setClearColor(a,1),r.clear();for(const a of i)a(e,r);r.clearDepth();for(const a of n)a(e,r);r.resetState(),this._opaqueRender$.next()}));n.push(o),n.push(this._renderFrame$.pipe(ee((t=>e=>(e.frameId=t.frameId,e.perspective=t.perspective,!0===t.changed&&(e.needsRender=!0),e)))).subscribe(this._renderCameraOperation$)),this._renderFrameSubscribe();const s=this._render$.pipe(ee((t=>e=>(e[t.name]=t.renderer,e)))),l=this._clear$.pipe(ee((t=>e=>(delete e[t],e))));n.push(Ee(s,l).subscribe(this._renderOperation$)),this._webGLRenderer$=this._render$.pipe(He(),ee((()=>{e.appendChild(t);const n=i.element,r=new kl({canvas:t});return r.setPixelRatio(window.devicePixelRatio),r.setSize(n.offsetWidth,n.offsetHeight),r.autoClear=!1,r})),Je(1),lt()),n.push(this._webGLRenderer$.subscribe((()=>{})));const c=this._webGLRenderer$.pipe(He(),ee((t=>e=>(e.needsRender=!0,e.renderer=t,e)))),u=this._renderService.size$.pipe(ee((t=>e=>(null==e.renderer||(e.renderer.setSize(t.width,t.height),e.needsRender=!0),e)))),h=this._clear$.pipe(ee((()=>t=>(null==t.renderer||(t.needsRender=!0),t))));n.push(Ee(c,u,h).subscribe(this._rendererOperation$));const p=this._renderCollection$.pipe(Ce((t=>0===Object.keys(t).length)),ei());n.push(p.subscribe((()=>{null!=this._renderFrameSubscription&&(this._renderFrameSubscription.unsubscribe(),this._renderFrameSubscription=null,this._renderFrameSubscribe())}))),n.push(p.pipe(ee((()=>t=>(t.needsRender=!0,t)))).subscribe(this._eraserOperation$))}get render$(){return this._render$}get opaqueRender$(){return this._opaqueRender$}get webGLRenderer$(){return this._webGLRenderer$}clear(t){this._clear$.next(t)}remove(){this._rendererOperation$.next((t=>{if(null!=t.renderer){const e=t.renderer.getContext().getExtension("WEBGL_lose_context");e&&e.loseContext(),t.renderer=null}return t})),null!=this._renderFrameSubscription&&this._renderFrameSubscription.unsubscribe(),this._subscriptions.unsubscribe()}triggerRerender(){this._renderService.renderCameraFrame$.pipe(ni(1),He()).subscribe((()=>{this._triggerOperation$.next((t=>(t.needsRender=!0,t)))}))}_renderFrameSubscribe(){this._render$.pipe(He(),ee((()=>t=>(t.needsRender=!0,t)))).subscribe((t=>{this._renderCameraOperation$.next(t)})),this._renderFrameSubscription=this._render$.pipe(He(),fe((()=>this._renderService.renderCameraFrame$))).subscribe(this._renderFrame$)}}class nS{constructor(t){null!=t?(this._position=(new bn).fromArray(t.unprojectSfM([0,0],0)),this._lookat=(new bn).fromArray(t.unprojectSfM([0,0],10)),this._up=t.upVector(),this._focal=this._getFocal(t)):(this._position=new bn(0,0,0),this._lookat=new bn(1,0,0),this._up=new bn(0,0,1),this._focal=1)}get position(){return this._position}get lookat(){return this._lookat}get up(){return this._up}get focal(){return this._focal}set focal(t){this._focal=t}lerpCameras(t,e,i){this._position.subVectors(e.position,t.position).multiplyScalar(i).add(t.position),this._lookat.subVectors(e.lookat,t.lookat).multiplyScalar(i).add(t.lookat),this._up.subVectors(e.up,t.up).multiplyScalar(i).add(t.up),this._focal=(1-i)*t.focal+i*e.focal}copy(t){this._position.copy(t.position),this._lookat.copy(t.lookat),this._up.copy(t.up),this._focal=t.focal}clone(){let t=new nS;return t.position.copy(this._position),t.lookat.copy(this._lookat),t.up.copy(this._up),t.focal=this._focal,t}diff(t){let e=this._position.distanceToSquared(t.position),i=this._lookat.distanceToSquared(t.lookat),n=this._up.distanceToSquared(t.up),r=100*Math.abs(this._focal-t.focal);return Math.max(e,i,n,r)}_getFocal(t){return Qh(t.cameraType)?.5/Math.tan(Math.PI/2):t.focal}}class rS{constructor(t,e,i){this._spatial=new Kh,this._viewportCoords=new Am,this._size={width:t,height:e},this._initialFov=60,this._alpha=-1,this._stateTransitionAlpha=-1,this._stateTransitionFov=-1,this._renderMode=i,this._zoom=0,this._frameId=-1,this._changed=!1,this._changedForFrame=-1,this._currentImageId=null,this._previousImageId=null,this._currentSpherical=!1,this._previousSpherical=!1,this._state=null,this._currentProjectedPoints=[],this._previousProjectedPoints=[],this._currentFov=this._initialFov,this._previousFov=this._initialFov,this._camera=new nS,this._perspective=new ka(this._initialFov,this._computeAspect(t,e),.1,1e4),this._perspective.position.copy(this._camera.position),this._perspective.up.copy(this._camera.up),this._perspective.lookAt(this._camera.lookat),this._perspective.updateMatrixWorld(!0),this._perspective.matrixAutoUpdate=!1,this._rotation={phi:0,theta:0}}get alpha(){return this._alpha}get camera(){return this._camera}get changed(){return this._frameId===this._changedForFrame}get frameId(){return this._frameId}get perspective(){return this._perspective}get renderMode(){return this._renderMode}get rotation(){return this._rotation}get zoom(){return this._zoom}get size(){return this._size}getTilt(){return 90-this._spatial.radToDeg(this._rotation.theta)}fovToZoom(t){t=Math.min(90,Math.max(0,t));const e=this._computeCurrentFov(0),i=1===this._alpha?e:this._interpolateFov(e,this._computePreviousFov(0),this._alpha),n=Math.tan(i/2*Math.PI/180),r=Math.tan(t/2*Math.PI/180);return Math.log(n/r)/Math.log(2)}setFrame(t){const e=t.state;if(e.state!==this._state){if(this._state=e.state,this._state!==tg.Custom&&(this.setRenderMode(this._renderMode),this.setSize(this._size)),this._state===tg.Earth){const t=this._fovToY(this._perspective.fov,this._zoom);this._stateTransitionFov=this._yToFov(t,0)}this._changed=!0}const i=e.currentImage.id,n=e.previousImage?e.previousImage.id:null;i!==this._currentImageId&&(this._currentImageId=i,this._currentSpherical=Qh(e.currentTransform.cameraType),this._currentProjectedPoints=this._computeProjectedPoints(e.currentTransform),this._changed=!0),n!==this._previousImageId&&(this._previousImageId=n,this._previousSpherical=Qh(e.previousTransform.cameraType),this._previousProjectedPoints=this._computeProjectedPoints(e.previousTransform),this._changed=!0);const r=e.zoom;r!==this._zoom&&(this._changed=!0),this._changed&&(this._currentFov=this._computeCurrentFov(r),this._previousFov=this._computePreviousFov(r));const a=e.alpha,o=e.stateTransitionAlpha;if(this._changed||a!==this._alpha||o!==this._stateTransitionAlpha){switch(this._alpha=a,this._stateTransitionAlpha=o,this._state){case tg.Earth:{const t=this._stateTransitionFov,i=this._focalToFov(e.camera.focal),n=on.lerp(t,i,o),a=this._fovToY(n,0);this._perspective.fov=this._yToFov(a,r);break}case tg.Custom:break;default:this._perspective.fov=this._interpolateFov(this._currentFov,this._previousFov,this._alpha),this._changed=!0}this._zoom=r,this._state!==tg.Custom&&this._perspective.updateProjectionMatrix()}const s=e.camera;this._camera.diff(s)>1e-9&&(this._camera.copy(s),this._rotation=this._computeRotation(s),this._perspective.up.copy(s.up),this._perspective.position.copy(s.position),this._perspective.matrixAutoUpdate=!0,this._perspective.lookAt(s.lookat),this._perspective.matrixAutoUpdate=!1,this._perspective.updateMatrix(),this._perspective.updateMatrixWorld(!1),this._changed=!0),this._setFrameId(t.id)}setProjectionMatrix(t){this._perspective.fov=this._focalToFov(t[5]/2),this._perspective.projectionMatrix.fromArray(t),this._perspective.projectionMatrixInverse.copy(this._perspective.projectionMatrix).invert(),this._changed=!0}setRenderMode(t){this._renderMode=t,this._state!==tg.Custom&&(this._perspective.fov=this._computeFov(),this._perspective.updateProjectionMatrix(),this._changed=!0)}setSize(t){this._size=t,this._state!==tg.Custom&&(this._perspective.aspect=this._computeAspect(t.width,t.height),this._perspective.fov=this._computeFov(),this._perspective.updateProjectionMatrix(),this._changed=!0)}_computeAspect(t,e){return 0===t?0:t/e}_computeCurrentFov(t){return 0===this._perspective.aspect?0:this._currentImageId?this._currentSpherical?this._yToFov(1,t):this._computeVerticalFov(this._currentProjectedPoints,this._renderMode,t,this.perspective.aspect):this._initialFov}_computeFov(){return this._currentFov=this._computeCurrentFov(this._zoom),this._previousFov=this._computePreviousFov(this._zoom),this._interpolateFov(this._currentFov,this._previousFov,this._alpha)}_computePreviousFov(t){return 0===this._perspective.aspect?0:this._currentImageId?this._previousImageId?this._previousSpherical?this._yToFov(1,t):this._computeVerticalFov(this._previousProjectedPoints,this._renderMode,t,this.perspective.aspect):this._currentFov:this._initialFov}_computeProjectedPoints(t){return ip(t,[[.5,0],[1,0]],[[.5,0],[0,.5]],100,this._viewportCoords)}_computeRequiredVerticalFov(t,e,i){const n=Math.max(t[0]/i,t[1]);return this._yToFov(n,e)}_computeRotation(t){let e=t.lookat.clone().sub(t.position),i=t.up.clone();return{phi:this._spatial.azimuthal(e.toArray(),i.toArray()),theta:Math.PI/2-this._spatial.angleToPlane(e.toArray(),[0,0,1])}}_computeVerticalFov(t,e,i,n){const r=t.map((t=>this._computeRequiredVerticalFov(t,i,n)));return e===Kw.Fill?.995*Math.min(...r):Math.max(...r)}_yToFov(t,e){return 2*Math.atan(t/Math.pow(2,e))*180/Math.PI}_focalToFov(t){return 2*Math.atan2(1,2*t)*180/Math.PI}_fovToY(t,e){return Math.pow(2,e)*Math.tan(Math.PI*t/360)}_interpolateFov(t,e,i){return i*t+(1-i)*e}_setFrameId(t){this._frameId=t,this._changed&&(this._changed=!1,this._changedForFrame=t)}}class aS{constructor(t,e,i,n){this._subscriptions=new Tm,this._element=t,this._currentFrame$=e,this._spatial=new Kh,i=null!=i?i:Kw.Fill,this._resize$=new ht,this._projectionMatrix$=new ht,this._renderCameraOperation$=new ht,this._size$=new dt({height:this._element.offsetHeight,width:this._element.offsetWidth});const r=this._subscriptions;r.push(this._resize$.pipe(ee((()=>({height:this._element.offsetHeight,width:this._element.offsetWidth})))).subscribe(this._size$)),this._renderMode$=new dt(i),this._renderCameraHolder$=this._renderCameraOperation$.pipe(ai((t=>t)),ti(((t,e)=>e(t)),null!==n&&void 0!==n?n:new rS(this._element.offsetWidth,this._element.offsetHeight,i)),Je(1),lt()),this._renderCameraFrame$=this._currentFrame$.pipe(ui(this._renderCameraHolder$),ci((([t,e])=>{e.setFrame(t)})),ee((t=>t[1])),Je(1),lt()),this._renderCamera$=this._renderCameraFrame$.pipe(Ce((t=>t.changed)),Je(1),lt()),this._bearing$=this._renderCamera$.pipe(ee((t=>{let e=this._spatial.radToDeg(this._spatial.azimuthalToBearing(t.rotation.phi));return this._spatial.wrap(e,0,360)})),Je(1),lt()),r.push(this._size$.pipe(ni(1),ee((t=>e=>(e.setSize(t),e)))).subscribe(this._renderCameraOperation$)),r.push(this._renderMode$.pipe(ni(1),ee((t=>e=>(e.setRenderMode(t),e)))).subscribe(this._renderCameraOperation$)),r.push(this._projectionMatrix$.pipe(ee((t=>e=>(e.setProjectionMatrix(t),e)))).subscribe(this._renderCameraOperation$)),r.push(this._bearing$.subscribe((()=>{}))),r.push(this._renderCameraHolder$.subscribe((()=>{}))),r.push(this._size$.subscribe((()=>{}))),r.push(this._renderMode$.subscribe((()=>{}))),r.push(this._renderCamera$.subscribe((()=>{}))),r.push(this._renderCameraFrame$.subscribe((()=>{})))}get bearing$(){return this._bearing$}get element(){return this._element}get projectionMatrix$(){return this._projectionMatrix$}get renderCamera$(){return this._renderCamera$}get renderCameraFrame$(){return this._renderCameraFrame$}get renderMode$(){return this._renderMode$}get resize$(){return this._resize$}get size$(){return this._size$}dispose(){this._subscriptions.unsubscribe()}}class oS{constructor(t){this._keyDown$=be(t,"keydown"),this._keyUp$=be(t,"keyup")}get keyDown$(){return this._keyDown$}get keyUp$(){return this._keyUp$}}const sS={0:1,2:2};class lS{constructor(t,e,i,n){this._subscriptions=new Tm;const r=this._subscriptions;this._activeSubject$=new dt(!1),this._active$=this._activeSubject$.pipe(Ue(),Je(1),lt()),this._claimMouse$=new ht,this._claimWheel$=new ht,this._deferPixelClaims$=new ht,this._deferPixels$=this._deferPixelClaims$.pipe(ti(((t,e)=>(null==e.deferPixels?delete t[e.name]:t[e.name]=e.deferPixels,t)),{}),ee((t=>{let e=-1;for(const i in t){if(!t.hasOwnProperty(i))continue;const n=t[i];n>e&&(e=n)}return e})),ai(-1),Je(1),lt()),r.push(this._deferPixels$.subscribe((()=>{}))),this._documentMouseMove$=be(n,"pointermove").pipe(Ce(this._isMousePen)),this._documentMouseUp$=be(n,"pointerup").pipe(Ce(this._isMousePen)),this._mouseDown$=be(e,"pointerdown").pipe(Ce(this._isMousePen)),this._mouseEnter$=be(e,"pointerenter").pipe(Ce(this._isMousePen)),this._mouseLeave$=be(e,"pointerleave").pipe(Ce(this._isMousePen)),this._mouseMove$=be(e,"pointermove").pipe(Ce(this._isMousePen)),this._mouseUp$=be(e,"pointerup").pipe(Ce(this._isMousePen)),this._mouseOut$=be(e,"pointerout").pipe(Ce(this._isMousePen)),this._mouseOver$=be(e,"pointerover").pipe(Ce(this._isMousePen)),this._domMouseDown$=be(i,"pointerdown").pipe(Ce(this._isMousePen)),this._domMouseMove$=be(i,"pointermove").pipe(Ce(this._isMousePen)),this._click$=be(e,"click"),this._contextMenu$=be(e,"contextmenu"),this._windowBlur$=be(window,"blur"),this._dblClick$=Ee(be(t,"click"),be(e,"dblclick")).pipe(ke(3,1),Ce((t=>{const i=t[0],n=t[1],r=t[2];return"click"===i.type&&"click"===n.type&&"dblclick"===r.type&&i.target.parentNode===e&&n.target.parentNode===e})),ee((t=>t[2])),ei()),r.push(Ee(this._domMouseDown$,this._domMouseMove$,this._dblClick$,this._contextMenu$).subscribe((t=>{t.preventDefault()}))),this._mouseWheel$=Ee(be(e,"wheel"),be(i,"wheel")).pipe(ei()),this._consistentContextMenu$=Ee(this._mouseDown$,this._mouseMove$,this._mouseOut$,this._mouseUp$,this._contextMenu$).pipe(ke(3,1),Ce((t=>"pointerdown"===t[0].type&&"contextmenu"===t[1].type&&"pointerup"===t[2].type)),ee((t=>t[1])),ei());const a=Ee(this._windowBlur$,this._documentMouseMove$.pipe(Ce((t=>this._buttonReleased(t,0)))),this._documentMouseUp$.pipe(Ce((t=>0===this._mouseButton(t))))).pipe(ei()),o=this._createMouseDragInitiate$(0,this._mouseDown$,a,!0).pipe(ei());this._mouseDragStart$=this._createMouseDragStart$(o).pipe(ei()),this._mouseDrag$=this._createMouseDrag$(o,a).pipe(ei()),this._mouseDragEnd$=this._createMouseDragEnd$(this._mouseDragStart$,a).pipe(ei());const s=this._createMouseDragInitiate$(0,this._domMouseDown$,a,!1).pipe(ei());this._domMouseDragStart$=this._createMouseDragStart$(s).pipe(ei()),this._domMouseDrag$=this._createMouseDrag$(s,a).pipe(ei()),this._domMouseDragEnd$=this._createMouseDragEnd$(this._domMouseDragStart$,a).pipe(ei());const l=Ee(this._windowBlur$,this._documentMouseMove$.pipe(Ce((t=>this._buttonReleased(t,2)))),this._documentMouseUp$.pipe(Ce((t=>2===this._mouseButton(t))))).pipe(ei()),c=this._createMouseDragInitiate$(2,this._mouseDown$,l,!0).pipe(ei());this._mouseRightDragStart$=this._createMouseDragStart$(c).pipe(ei()),this._mouseRightDrag$=this._createMouseDrag$(c,l).pipe(ei()),this._mouseRightDragEnd$=this._createMouseDragEnd$(this._mouseRightDragStart$,l).pipe(ei()),this._proximateClick$=this._mouseDown$.pipe(oi((t=>this._click$.pipe(si(this._createDeferredMouseMove$(t,this._documentMouseMove$)),Ne(1)))),ei()),this._staticClick$=this._mouseDown$.pipe(oi((()=>this._click$.pipe(si(this._documentMouseMove$),Ne(1)))),ei()),r.push(this._mouseDragStart$.subscribe()),r.push(this._mouseDrag$.subscribe()),r.push(this._mouseDragEnd$.subscribe()),r.push(this._domMouseDragStart$.subscribe()),r.push(this._domMouseDrag$.subscribe()),r.push(this._domMouseDragEnd$.subscribe()),r.push(this._mouseRightDragStart$.subscribe()),r.push(this._mouseRightDrag$.subscribe()),r.push(this._mouseRightDragEnd$.subscribe()),r.push(this._staticClick$.subscribe()),this._mouseOwner$=this._createOwner$(this._claimMouse$).pipe(Je(1),lt()),this._wheelOwner$=this._createOwner$(this._claimWheel$).pipe(Je(1),lt()),r.push(this._mouseOwner$.subscribe((()=>{}))),r.push(this._wheelOwner$.subscribe((()=>{})))}get active$(){return this._active$}get activate$(){return this._activeSubject$}get documentMouseMove$(){return this._documentMouseMove$}get documentMouseUp$(){return this._documentMouseUp$}get domMouseDragStart$(){return this._domMouseDragStart$}get domMouseDrag$(){return this._domMouseDrag$}get domMouseDragEnd$(){return this._domMouseDragEnd$}get domMouseDown$(){return this._domMouseDown$}get domMouseMove$(){return this._domMouseMove$}get mouseOwner$(){return this._mouseOwner$}get mouseDown$(){return this._mouseDown$}get mouseEnter$(){return this._mouseEnter$}get mouseMove$(){return this._mouseMove$}get mouseLeave$(){return this._mouseLeave$}get mouseOut$(){return this._mouseOut$}get mouseOver$(){return this._mouseOver$}get mouseUp$(){return this._mouseUp$}get click$(){return this._click$}get dblClick$(){return this._dblClick$}get contextMenu$(){return this._consistentContextMenu$}get mouseWheel$(){return this._mouseWheel$}get mouseDragStart$(){return this._mouseDragStart$}get mouseDrag$(){return this._mouseDrag$}get mouseDragEnd$(){return this._mouseDragEnd$}get mouseRightDragStart$(){return this._mouseRightDragStart$}get mouseRightDrag$(){return this._mouseRightDrag$}get mouseRightDragEnd$(){return this._mouseRightDragEnd$}get proximateClick$(){return this._proximateClick$}get staticClick$(){return this._staticClick$}get windowBlur$(){return this._windowBlur$}dispose(){this._subscriptions.unsubscribe()}claimMouse(t,e){this._claimMouse$.next({name:t,zindex:e})}unclaimMouse(t){this._claimMouse$.next({name:t,zindex:null})}deferPixels(t,e){this._deferPixelClaims$.next({name:t,deferPixels:e})}undeferPixels(t){this._deferPixelClaims$.next({name:t,deferPixels:null})}claimWheel(t,e){this._claimWheel$.next({name:t,zindex:e})}unclaimWheel(t){this._claimWheel$.next({name:t,zindex:null})}filtered$(t,e){return this._filtered(t,e,this._mouseOwner$)}filteredWheel$(t,e){return this._filtered(t,e,this._wheelOwner$)}_createDeferredMouseMove$(t,e){return e.pipe(ee((e=>{const i=e.clientX-t.clientX,n=e.clientY-t.clientY;return[e,Math.sqrt(i*i+n*n)]})),ui(this._deferPixels$),Ce((([[,t],e])=>t>e)),ee((([[t]])=>t)))}_createMouseDrag$(t,e){return t.pipe(ee((([,t])=>t)),oi((t=>_e(Zt(t),this._documentMouseMove$).pipe(si(e)))))}_createMouseDragEnd$(t,e){return t.pipe(oi((()=>e.pipe(He()))))}_createMouseDragStart$(t){return t.pipe(ee((([t])=>t)))}_createMouseDragInitiate$(t,e,i,n){return e.pipe(Ce((e=>this._mouseButton(e)===t)),oi((t=>ue(Zt(t),n?this._createDeferredMouseMove$(t,this._documentMouseMove$):this._documentMouseMove$).pipe(si(i),Ne(1)))))}_createOwner$(t){return t.pipe(ti(((t,e)=>(null==e.zindex?delete t[e.name]:t[e.name]=e.zindex,t)),{}),ee((t=>{let e=null,i=-1;for(const n in t)t.hasOwnProperty(n)&&t[n]>i&&(i=t[n],e=n);return e})),ai(null))}_filtered(t,e,i){return e.pipe(ui(i),Ce((([,e])=>e===t)),ee((([t])=>t)))}_mouseButton(t){const e="pointerdown"===t.type||"pointerup"===t.type,i=window.InstallTrigger;return e&&"undefined"!==typeof i&&2===t.button&&t.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button}_buttonReleased(t,e){const i=sS[e];return void 0===t.buttons||(t.buttons&i)!==i}_isMousePen(t){const e=t.pointerType;return"mouse"===e||"pen"===e}}class cS{set json(t){this._json=t}set image(t){this._image=t,this._texture=new mn(this._image),this._texture.minFilter=vi}get loaded(){return!(!this._image||!this._json)}getGLSprite(t){if(!this.loaded)throw new Error("Sprites cannot be retrieved before the atlas is loaded.");let e=this._json[t];if(!e)return console.warn("Sprite with key"+t+"does not exist in sprite definition."),new Sr;let i=this._texture.clone();i.needsUpdate=!0;let n=this._image.width,r=this._image.height;i.offset.x=e.x/n,i.offset.y=(r-e.y-e.height)/r,i.repeat.x=e.width/n,i.repeat.y=e.height/r;let a=new Ll({map:i});return new Yl(a)}getDOMSprite(t,e){if(!this.loaded)throw new Error("Sprites cannot be retrieved before the atlas is loaded.");null==e&&(e=Vy.Center);let i=this._json[t];if(!i)return console.warn("Sprite with key"+t+"does not exist in sprite definition."),Sm.h("div",{},[]);let n=i.y,r=i.x+i.width,a=i.y+i.height,o=i.x,s=-i.x,l=-i.y,c=this._image.height,u=this._image.width;switch(e){case Vy.Bottom:case Vy.Center:case Vy.Top:s-=i.width/2;break;case Vy.BottomLeft:case Vy.Left:case Vy.TopLeft:s-=i.width;case Vy.BottomRight:case Vy.Right:case Vy.TopRight:}switch(e){case Vy.Center:case Vy.Left:case Vy.Right:l-=i.height/2;break;case Vy.Top:case Vy.TopLeft:case Vy.TopRight:l-=i.height;case Vy.Bottom:case Vy.BottomLeft:case Vy.BottomRight:}let h=1/i.pixelRatio;n*=h,r*=h,a*=h,o*=h,s*=h,l*=h,c*=h,u*=h;let p={src:this._image.src,style:{clip:`rect(${n}px, ${r}px, ${a}px, ${o}px)`,height:`${c}px`,left:`${s}px`,position:"absolute",top:`${l}px`,width:`${u}px`}};return Sm.h("img",p,[])}}class uS{constructor(t){if(this._retina=window.devicePixelRatio>1,this._spriteAtlasOperation$=new ht,this._spriteAtlas$=this._spriteAtlasOperation$.pipe(ai((t=>t)),ti(((t,e)=>e(t)),new cS),Je(1),lt()),this._atlasSubscription=this._spriteAtlas$.subscribe((()=>{})),null==t)return;let e=this._retina?"@2x":"",i=new XMLHttpRequest;i.open("GET",t+e+".png",!0),i.responseType="arraybuffer",i.onload=()=>{let t=new Image;t.onload=()=>{this._spriteAtlasOperation$.next((e=>(e.image=t,e)))};let e=new Blob([i.response]);t.src=window.URL.createObjectURL(e)},i.onerror=i=>{console.error(new Error(`Failed to fetch sprite sheet (${t}${e}.png)`))},i.send();let n=new XMLHttpRequest;n.open("GET",t+e+".json",!0),n.responseType="text",n.onload=()=>{let t=JSON.parse(n.response);this._spriteAtlasOperation$.next((e=>(e.json=t,e)))},n.onerror=i=>{console.error(new Error(`Failed to fetch sheet (${t}${e}.json)`))},n.send()}get spriteAtlas$(){return this._spriteAtlas$}dispose(){this._atlasSubscription.unsubscribe()}}class hS{constructor(t,e){this._subscriptions=new Tm;const i=this._subscriptions;this._activeSubject$=new dt(!1),this._active$=this._activeSubject$.pipe(Ue(),Je(1),lt()),i.push(be(e,"touchmove").subscribe((t=>{t.preventDefault()}))),this._touchStart$=be(t,"touchstart"),this._touchMove$=be(t,"touchmove"),this._touchEnd$=be(t,"touchend"),this._touchCancel$=be(t,"touchcancel");const n=this._touchStart$.pipe(Ce((t=>1===t.touches.length&&1===t.targetTouches.length)),ei());var r;this._doubleTap$=n.pipe((r=()=>n.pipe(He(),oi((()=>Ee(Se(300),n).pipe(Ne(1))))),ot((function(t,e){var i=null,n=null,a=function(){null===n||void 0===n||n.unsubscribe();var t=i;i=[],t&&e.next(t),Nt(r()).subscribe(n=new st(e,a,j))};a(),t.subscribe(new st(e,(function(t){return null===i||void 0===i?void 0:i.push(t)}),(function(){i&&e.next(i),e.complete()}),void 0,(function(){return i=n=null})))}))),Ce((t=>2===t.length)),ee((t=>t[t.length-1])),ei()),i.push(this._doubleTap$.subscribe((t=>{t.preventDefault()}))),this._singleTouchMove$=this._touchMove$.pipe(Ce((t=>1===t.touches.length&&1===t.targetTouches.length)),ei());let a=Ee(this._touchStart$,this._touchEnd$,this._touchCancel$).pipe(Ce((t=>1===t.touches.length&&1===t.targetTouches.length))),o=Ee(this._touchStart$,this._touchEnd$,this._touchCancel$).pipe(Ce((t=>t.touches.length>=1))),s=Ee(this._touchEnd$,this._touchCancel$).pipe(Ce((t=>0===t.touches.length)));this._singleTouchDragStart$=a.pipe(fe((()=>this._singleTouchMove$.pipe(si(Ee(s,o)),Ne(1))))),this._singleTouchDragEnd$=a.pipe(fe((()=>Ee(s,o).pipe(He())))),this._singleTouchDrag$=a.pipe(oi((()=>this._singleTouchMove$.pipe(ni(1),si(Ee(o,s))))));let l=Ee(this._touchStart$,this._touchEnd$,this._touchCancel$);this._pinchStart$=l.pipe(Ce((t=>2===t.touches.length&&2===t.targetTouches.length))),this._pinchEnd$=l.pipe(Ce((t=>2!==t.touches.length||2!==t.targetTouches.length))),this._pinchOperation$=new ht,this._pinch$=this._pinchOperation$.pipe(ti(((t,e)=>e(t)),{changeX:0,changeY:0,clientX:0,clientY:0,distance:0,distanceChange:0,distanceX:0,distanceY:0,originalEvent:null,pageX:0,pageY:0,screenX:0,screenY:0,touch1:null,touch2:null}));const c=this._touchMove$.pipe(Ce((t=>2===t.touches.length&&2===t.targetTouches.length)),ee((t=>e=>{let i=t.touches[0],n=t.touches[1],r=Math.min(i.clientX,n.clientX),a=Math.max(i.clientX,n.clientX),o=Math.min(i.clientY,n.clientY),s=r+(a-r)/2,l=o+(Math.max(i.clientY,n.clientY)-o)/2,c=s+i.pageX-i.clientX,u=l+i.pageY-i.clientY,h=s+i.screenX-i.clientX,p=l+i.screenY-i.clientY,d=Math.abs(i.clientX-n.clientX),f=Math.abs(i.clientY-n.clientY),m=Math.sqrt(d*d+f*f),g=m-e.distance;return{changeX:d-e.distanceX,changeY:f-e.distanceY,clientX:s,clientY:l,distance:m,distanceChange:g,distanceX:d,distanceY:f,originalEvent:t,pageX:c,pageY:u,screenX:h,screenY:p,touch1:i,touch2:n}}))).subscribe(this._pinchOperation$);i.push(c),this._pinchChange$=this._pinchStart$.pipe(oi((()=>this._pinch$.pipe(ni(1),si(this._pinchEnd$)))))}get active$(){return this._active$}get activate$(){return this._activeSubject$}get doubleTap$(){return this._doubleTap$}get touchStart$(){return this._touchStart$}get touchMove$(){return this._touchMove$}get touchEnd$(){return this._touchEnd$}get touchCancel$(){return this._touchCancel$}get singleTouchDragStart$(){return this._singleTouchDragStart$}get singleTouchDrag$(){return this._singleTouchDrag$}get singleTouchDragEnd$(){return this._singleTouchDragEnd$}get pinch$(){return this._pinchChange$}get pinchStart$(){return this._pinchStart$}get pinchEnd$(){return this._pinchEnd$}dispose(){this._subscriptions.unsubscribe()}}class pS{constructor(t){var e,i,n,r;const a=null!==(i=null===(e=null===t||void 0===t?void 0:t.url)||void 0===e?void 0:e.exploreHost)&&void 0!==i?i:"www.mapillary.com",o=`${null!==(r=null===(n=null===t||void 0===t?void 0:t.url)||void 0===n?void 0:n.scheme)&&void 0!==r?r:"https"}://${a}`;this._exploreUrl$=Zt(o);const s=!1!==(null===t||void 0===t?void 0:t.imageTiling);this._imageTiling$=Zt(s)}get exploreUrl$(){return this._exploreUrl$}get imageTiling$(){return this._imageTiling$}}class dS{constructor(t,e,i){var n;if(this._onWindowResize=()=>{this._trackResize&&this.renderService.resize$.next()},this._dom=null!==i&&void 0!==i?i:new Ig,"string"===typeof t.container){if(this._container=this._dom.document.getElementById(t.container),!this._container)throw new Error(`Container "${t.container}" not found.`)}else{if(!(t.container instanceof HTMLElement))throw new Error('Invalid type: "container" must be a String or HTMLElement.');this._container=t.container}this._trackResize=!1!==t.trackResize,this.id=null!==(n=this._container.id)&&void 0!==n?n:"mapillary-fallback-container-id",this._container.classList.add("mapillary-viewer"),this._canvasContainer=this._dom.createElement("div","mapillary-interactive",this._container),this._canvas=this._dom.createElement("canvas","mapillary-canvas"),this._canvas.style.position="absolute",this._canvas.setAttribute("tabindex","0"),this._domContainer=this._dom.createElement("div","mapillary-dom",this._container),this.configurationService=new pS(t),this.renderService=new aS(this._container,e.currentState$,t.renderMode),this.glRenderer=new iS(this._canvas,this._canvasContainer,this.renderService),this.domRenderer=new eS(this._domContainer,this.renderService,e.currentState$),this.keyboardService=new oS(this._canvasContainer),this.mouseService=new lS(this._container,this._canvasContainer,this._domContainer,document),this.touchService=new hS(this._canvasContainer,this._domContainer),this.spriteService=new uS(t.sprite),window.addEventListener("resize",this._onWindowResize,!1)}get canvas(){return this._canvas.parentNode?this._canvas:null}get canvasContainer(){return this._canvasContainer}get container(){return this._container}get domContainer(){return this._domContainer}remove(){window.removeEventListener("resize",this._onWindowResize,!1),this.spriteService.dispose(),this.touchService.dispose(),this.mouseService.dispose(),this.glRenderer.remove(),this.domRenderer.remove(),this.renderService.dispose(),this._removeNode(this._canvasContainer),this._removeNode(this._domContainer),this._container.classList.remove("mapillary-viewer")}_removeNode(t){t.parentNode&&t.parentNode.removeChild(t)}}class fS{constructor(t,e,i){this._graphService=t,this._stateService=e,this._api=i,this._subscriptions=new Tm,this._started=!1,this._cellDepth=1}get started(){return this._started}configure(t){this._cellDepth=t?Math.max(1,Math.min(3,t.cellDepth)):1}start(){if(this._started)return;const t=this._subscriptions;t.push(this._stateService.currentState$.pipe(Ue(void 0,(t=>t.state.currentImage.id)),ee((t=>{const e=t.state,i=e.trajectory,n=i.map((t=>t.id)),r=i[i.length-1].sequenceId;return[n,e.currentImage.originalLngLat,r]})),ke(1,5),ui(this._graphService.graphMode$),oi((([t,e])=>{const i=t[0][0],n=t[0][1],r=this._api.data.geometry,a=n_(r.lngLatToCellId(n),this._cellDepth,r),o=e===eg.Sequence?t[0][2]:void 0;return this._graphService.uncache$(i,a,o)}))).subscribe((()=>{}))),t.push(this._graphService.graphMode$.pipe(ni(1),ui(this._stateService.currentState$),oi((([t,e])=>t===eg.Sequence?this._keyToEdges(e.state.currentImage.id,(t=>t.sequenceEdges$)):Ft(e.state.trajectory.map((t=>t.id)).slice(e.state.currentIndex)).pipe(fe((t=>this._keyToEdges(t,(t=>t.spatialEdges$))),6))))).subscribe((()=>{}))),t.push(this._graphService.dataAdded$.pipe(ui(this._stateService.currentId$),oi((([t,e])=>this._graphService.cacheImage$(e)))).subscribe((()=>{}))),this._started=!0}stop(){this._started&&(this._subscriptions.unsubscribe(),this._started=!1)}_keyToEdges(t,e){return this._graphService.cacheImage$(t).pipe(oi(e),He((t=>t.cached)),Qt(15e3),Re((e=>(console.error(`Failed to cache edges (${t}).`,e),Et()))))}}class mS{constructor(){this._loadersSubject$=new ht,this._loaders$=this._loadersSubject$.pipe(ti(((t,e)=>(void 0!==e.task&&(t[e.task]=e.loading),t)),{}),ai({}),Je(1),lt())}get loading$(){return this._loaders$.pipe(ee((t=>{for(const e in t)if(t.hasOwnProperty(e)&&t[e])return!0;return!1})),Oe(100),Ue())}taskLoading$(t){return this._loaders$.pipe(ee((e=>!!e[t])),Oe(100),Ue())}startLoading(t){this._loadersSubject$.next({loading:!0,task:t})}stopLoading(t){this._loadersSubject$.next({loading:!1,task:t})}}var gS;!function(t){t[t.Disabled=0]="Disabled",t[t.Enabled=1]="Enabled",t[t.Started=2]="Started"}(gS||(gS={}));class _S{constructor(t,e,i,n,r,a){this._subscriptions=new Tm,this._graphService=t,this._stateService=e,this._graphCalculator=null!==n&&void 0!==n?n:new $h,this._spatial=null!==r&&void 0!==r?r:new Kh,this._viewportCoords=null!==a&&void 0!==a?a:new Am,this._mode=!1!==i?gS.Enabled:gS.Disabled,this._panImagesSubject$=new ht,this._panImages$=this._panImagesSubject$.pipe(ai([]),Je(1),lt()),this._subscriptions.push(this._panImages$.subscribe())}get panImages$(){return this._panImages$}dispose(){this.stop(),null!=this._panImagesSubscription&&this._panImagesSubscription.unsubscribe(),this._subscriptions.unsubscribe()}enable(){this._mode===gS.Disabled&&(this._mode=gS.Enabled,this.start())}disable(){this._mode!==gS.Disabled&&(this.stop(),this._mode=gS.Disabled)}start(){if(this._mode!==gS.Enabled)return;const t=this._stateService.currentImage$.pipe(oi((t=>{if(!t.merged||Qh(t.cameraType))return Zt([]);const e=Zt(t),i=this._graphCalculator.boundingBoxCorners(t.lngLat,20);return ue(e,this._graphService.cacheBoundingBox$(i[0],i[1]).pipe(Re((e=>(console.error(`Failed to cache periphery bounding box (${t.id})`,e),Et()))),ee((e=>{if(Qh(t.cameraType))return[];const i=[];for(const n of e)n.id!==t.id&&n.mergeId===t.mergeId&&(Qh(n.cameraType)||this._distance(n,t)>4||i.push(n));return i})))).pipe(ui(this._stateService.reference$),ee((([[t,e],i])=>{const n=this._spatial.viewingDirection(t.rotation),r=ep({lat:t.lngLat.lat,lng:t.lngLat.lng,alt:t.computedAltitude},t.rotation,i),a=this._createTransform(t,r),o=this._spatial.wrap(this._spatial.azimuthal(n.toArray(),a.upVector().toArray()),0,2*Math.PI),s=this._computeProjectedPoints(a),l=this._computeHorizontalFov(s)/180*Math.PI,c=Math.PI/8;let u,h;for(const d of e){const e=ep({lat:d.lngLat.lat,lng:d.lngLat.lng,alt:d.computedAltitude},d.rotation,i),r=this._createTransform(d,e),a=this._computeProjectedPoints(r),s=this._computeHorizontalFov(a)/180*Math.PI,p=this._spatial.viewingDirection(d.rotation),f=this._spatial.wrap(this._spatial.azimuthal(p.toArray(),r.upVector().toArray()),0,2*Math.PI),m=this._spatial.angleBetweenVector2(n.x,n.y,p.x,p.y);let g=Number.NEGATIVE_INFINITY;g=m>0?o>f?o-2*Math.PI+l/2-(f-s/2):o+l/2-(f-s/2):o<f?f+s/2-(o+2*Math.PI-l/2):f+s/2-(o-l/2);const _=Math.abs(s-g),y=this._distance(d,t)+Math.min(this._timeDifference(d,t),4)+20*Math.abs(g-c)+Math.min(5,1/Math.min(s/l,1))+(g>0?-2*_:0);g>0&&g<.5*l&&g<.5*s&&_>.5*l&&(m>0?u?y<u[0]&&(u=[y,d,r,s]):u=[y,d,r,s]:h?y<h[0]&&(h=[y,d,r,s]):h=[y,d,r,s])}const p=[];return u&&p.push([u[1],u[2],u[3]]),h&&p.push([h[1],h[2],h[3]]),p})),ai([]))})));this._panImagesSubscription=this._stateService.currentState$.pipe(ee((t=>t.state.imagesAhead>0)),Ue(),oi((e=>e?Zt([]):t))).subscribe((t=>{this._panImagesSubject$.next(t)})),this._mode=gS.Started}stop(){this._mode===gS.Started&&(this._panImagesSubscription.unsubscribe(),this._panImagesSubject$.next([]),this._mode=gS.Enabled)}_distance(t,e){const[i,n,r]=Fh(t.lngLat.lng,t.lngLat.lat,t.computedAltitude,e.lngLat.lng,e.lngLat.lat,e.computedAltitude);return Math.sqrt(i*i+n*n+r*r)}_timeDifference(t,e){return Math.abs(t.capturedAt-e.capturedAt)/2592e6}_createTransform(t,e){return new zg(t.exifOrientation,t.width,t.height,t.scale,t.rotation,e,t.assetsCached?t.image:void 0,void 0,t.cameraParameters,t.cameraType)}_computeProjectedPoints(t){return ip(t,[[1,0]],[[0,.5]],20,this._viewportCoords)}_computeHorizontalFov(t){const e=t.map((t=>this._coordToFov(t[0])));return Math.min(...e)}_coordToFov(t){return 2*Math.atan(t)*180/Math.PI}}class yS{constructor(t){this._data=t}get data(){return this._data}getCoreImages$(t){return this._wrap$(this._data.getCoreImages(t))}getImages$(t){return this._wrap$(this._data.getImages(t))}getImageTiles$(t){return this._wrap$(this._data.getImageTiles(t))}getSequence$(t){return this._wrap$(this._data.getSequence(t))}getSpatialImages$(t){return this._wrap$(this._data.getSpatialImages(t))}setAccessToken(t){this._data.setAccessToken(t)}_wrap$(t){return nt.create((e=>{t.then((t=>{e.next(t),e.complete()}),(t=>{e.error(t)}))}))}}class vS{constructor(t){this._dataAdded$=new ht,this._subscriptions=new Tm,this._onDataAdded=t=>{this._graph$.pipe(He(),fe((e=>e.updateCells$(t.cellIds).pipe(ci((()=>{e.resetSpatialEdges()})))))).subscribe((t=>{this._dataAdded$.next(t)}))};const e=this._subscriptions;this._graph$=_e(Zt(t),t.changed$).pipe(Je(1),lt()),e.push(this._graph$.subscribe((()=>{}))),this._graphMode=eg.Spatial,this._graphModeSubject$=new ht,this._graphMode$=this._graphModeSubject$.pipe(ai(this._graphMode),Je(1),lt()),e.push(this._graphMode$.subscribe((()=>{}))),this._firstGraphSubjects$=[],this._initializeCacheSubscriptions=[],this._sequenceSubscriptions=[],this._spatialSubscriptions=[],t.api.data.on("datacreate",this._onDataAdded)}get dataAdded$(){return this._dataAdded$}get filter$(){return this._graph$.pipe(He(),fe((t=>t.filter$)))}get graphMode$(){return this._graphMode$}cacheBoundingBox$(t,e){return this._graph$.pipe(He(),fe((i=>i.cacheBoundingBox$(t,e))))}cacheCell$(t){return this._graph$.pipe(He(),fe((e=>e.cacheCell$(t))))}cacheImage$(t){const e=new ht;this._firstGraphSubjects$.push(e);const i=e.pipe(Je(1),lt()),n=i.pipe(ee((e=>e.getNode(t))),fe((t=>t.assetsCached?Zt(t):t.cacheAssets$())),Je(1),lt());let r;n.subscribe(void 0,(e=>{console.error(`Failed to cache image (${t}).`,e)})),r=this._graph$.pipe(He(),fe((e=>e.isCachingFull(t)||!e.hasNode(t)?e.cacheFull$(t):e.isCachingFill(t)||!e.getNode(t).complete?e.cacheFill$(t):Zt(e))),ci((e=>{if(!e.hasNode(t))throw new rp(`Failed to cache image (${t})`);e.hasInitializedCache(t)||e.initializeCache(t)})),Ge((()=>{null!=r&&(this._removeFromArray(r,this._initializeCacheSubscriptions),this._removeFromArray(e,this._firstGraphSubjects$))}))).subscribe((t=>{e.next(t),e.complete()}),(t=>{e.error(t)})),r.closed||this._initializeCacheSubscriptions.push(r);const a=i.pipe(Re((()=>Et())),fe((e=>e.isCachingNodeSequence(t)||!e.hasNodeSequence(t)?e.cacheNodeSequence$(t):Zt(e))),Je(1),lt());let o;if(o=a.pipe(ci((e=>{e.getNode(t).sequenceEdges.cached||e.cacheSequenceEdges(t)})),Ge((()=>{null!=o&&this._removeFromArray(o,this._sequenceSubscriptions)}))).subscribe((()=>{}),(e=>{console.error(`Failed to cache sequence edges (${t}).`,e)})),o.closed||this._sequenceSubscriptions.push(o),this._graphMode===eg.Spatial){let e;e=i.pipe(Re((()=>Et())),qe((e=>e.hasTiles(t)?Et():Ft(e.cacheTiles$(t)).pipe(fe((e=>e.pipe(fe((e=>e.isCachingTiles(t)?Et():Zt(e))),Re((e=>(console.error(`Failed to cache tile data (${t}).`,e),Et()))))))))),We(1),fe((e=>e.hasSpatialArea(t)?Zt(e):Ft(e.cacheSpatialArea$(t)).pipe(fe((e=>e.pipe(Re((e=>(console.error(`Failed to cache spatial images (${t}).`,e),Et()))))))))),We(1),fe((e=>e.hasNodeSequence(t)?Zt(e):e.cacheNodeSequence$(t))),ci((e=>{e.getNode(t).spatialEdges.cached||e.cacheSpatialEdges(t)})),Ge((()=>{null!=e&&this._removeFromArray(e,this._spatialSubscriptions)}))).subscribe((()=>{}),(e=>{const i=`Failed to cache spatial edges (${t}).`;console.error(i,e)})),e.closed||this._spatialSubscriptions.push(e)}return n.pipe(He((t=>t.assetsCached)))}cacheSequence$(t){return this._graph$.pipe(He(),fe((e=>e.isCachingSequence(t)||!e.hasSequence(t)?e.cacheSequence$(t):Zt(e))),ee((e=>e.getSequence(t))))}cacheSequenceImages$(t,e){return this._graph$.pipe(He(),fe((e=>e.isCachingSequence(t)||!e.hasSequence(t)?e.cacheSequence$(t):Zt(e))),fe((i=>i.isCachingSequenceNodes(t)||!i.hasSequenceNodes(t)?i.cacheSequenceNodes$(t,e):Zt(i))),ee((e=>e.getSequence(t))))}dispose(){this._graph$.pipe(He()).subscribe((t=>{t.unsubscribe()})),this._subscriptions.unsubscribe()}setFilter$(t){return this._resetSubscriptions(this._spatialSubscriptions),this._graph$.pipe(He(),ci((e=>{e.resetSpatialEdges(),e.setFilter(t)})),ee((()=>{})))}setGraphMode(t){this._graphMode!==t&&(t===eg.Sequence&&this._resetSubscriptions(this._spatialSubscriptions),this._graphMode=t,this._graphModeSubject$.next(this._graphMode))}reset$(t){return this._abortSubjects(this._firstGraphSubjects$),this._resetSubscriptions(this._initializeCacheSubscriptions),this._resetSubscriptions(this._sequenceSubscriptions),this._resetSubscriptions(this._spatialSubscriptions),this._graph$.pipe(He(),ci((e=>{e.reset(t)})),ee((()=>{})))}uncache$(t,e,i){return this._graph$.pipe(He(),ci((n=>{n.uncache(t,e,i)})),ee((()=>{})))}_abortSubjects(t){for(const e of t.slice())this._removeFromArray(e,t),e.error(new Error("Cache image request was aborted."))}_removeFromArray(t,e){const i=e.indexOf(t);-1!==i&&e.splice(i,1)}_resetSubscriptions(t){for(const e of t.slice())this._removeFromArray(e,t),e.closed||e.unsubscribe()}}class xS{constructor(t){t.requestAnimationFrame?(this._cancelAnimationFrame=t.cancelAnimationFrame.bind(t),this._requestAnimationFrame=t.requestAnimationFrame.bind(t)):t.mozRequestAnimationFrame?(this._cancelAnimationFrame=t.mozCancelAnimationFrame.bind(t),this._requestAnimationFrame=t.mozRequestAnimationFrame.bind(t)):t.webkitRequestAnimationFrame?(this._cancelAnimationFrame=t.webkitCancelAnimationFrame.bind(t),this._requestAnimationFrame=t.webkitRequestAnimationFrame.bind(t)):t.msRequestAnimationFrame?(this._cancelAnimationFrame=t.msCancelAnimationFrame.bind(t),this._requestAnimationFrame=t.msRequestAnimationFrame.bind(t)):t.oRequestAnimationFrame?(this._cancelAnimationFrame=t.oCancelAnimationFrame.bind(t),this._requestAnimationFrame=t.oRequestAnimationFrame.bind(t)):(this._cancelAnimationFrame=t.clearTimeout.bind(t),this._requestAnimationFrame=e=>t.setTimeout(e,1e3/60))}get cancelAnimationFrame(){return this._cancelAnimationFrame}get requestAnimationFrame(){return this._requestAnimationFrame}}class bS{constructor(t){this._spatial=new Kh,this._referenceThreshold=.01,this._transitionMode=t.transitionMode,this._reference=t.reference,this._alpha=t.alpha,this._stateTransitionAlpha=0,this._camera=t.camera.clone(),this._zoom=t.zoom,this._currentIndex=t.currentIndex,this._trajectory=t.trajectory.slice(),this._trajectoryTransforms=[],this._trajectoryCameras=[];for(let e of this._trajectory){let t=this._imageToTranslation(e,this._reference),i=new zg(e.exifOrientation,e.width,e.height,e.scale,e.rotation,t,e.image,void 0,e.cameraParameters,e.cameraType);this._trajectoryTransforms.push(i),this._trajectoryCameras.push(new nS(i))}this._currentImage=this._trajectory.length>0?this._trajectory[this._currentIndex]:null,this._previousImage=this._trajectory.length>1&&this.currentIndex>0?this._trajectory[this._currentIndex-1]:null,this._currentCamera=this._trajectoryCameras.length>0?this._trajectoryCameras[this._currentIndex].clone():new nS,this._previousCamera=this._trajectoryCameras.length>1&&this.currentIndex>0?this._trajectoryCameras[this._currentIndex-1].clone():this._currentCamera.clone()}get reference(){return this._reference}get alpha(){return this._getAlpha()}get stateTransitionAlpha(){return this._getStateTransitionAlpha()}get camera(){return this._camera}get zoom(){return this._zoom}get trajectory(){return this._trajectory}get currentIndex(){return this._currentIndex}get currentImage(){return this._currentImage}get previousImage(){return this._previousImage}get currentCamera(){return this._currentCamera}get currentTransform(){return this._trajectoryTransforms.length>0?this._trajectoryTransforms[this.currentIndex]:null}get previousTransform(){return this._trajectoryTransforms.length>1&&this.currentIndex>0?this._trajectoryTransforms[this.currentIndex-1]:null}get motionless(){return this._motionless}get transitionMode(){return this._transitionMode}move(t){}moveTo(t){}rotate(t){}rotateUnbounded(t){}rotateWithoutInertia(t){}rotateBasic(t){}rotateBasicUnbounded(t){}rotateBasicWithoutInertia(t){}rotateToBasic(t){}setSpeed(t){}zoomIn(t,e){}update(t){}setCenter(t){}setZoom(t){}dolly(t){}orbit(t){}setViewMatrix(t){}truck(t){}append(t){if(t.length<1)throw Error("Trajectory can not be empty");this._currentIndex<0?this.set(t):(this._trajectory=this._trajectory.concat(t),this._appendToTrajectories(t))}prepend(t){if(t.length<1)throw Error("Trajectory can not be empty");this._trajectory=t.slice().concat(this._trajectory),this._currentIndex+=t.length,this._setCurrentImage(),this._setReference(this._currentImage)?this._setTrajectories():this._prependToTrajectories(t),this._setCurrentCamera()}remove(t){if(t<0)throw Error("n must be a positive integer");if(this._currentIndex-1<t)throw Error("Current and previous images can not be removed");for(let e=0;e<t;e++)this._trajectory.shift(),this._trajectoryTransforms.shift(),this._trajectoryCameras.shift(),this._currentIndex--;this._setCurrentImage()}clearPrior(){this._currentIndex>0&&this.remove(this._currentIndex-1)}clear(){this.cut(),this._currentIndex>0&&this.remove(this._currentIndex-1)}cut(){for(;this._trajectory.length-1>this._currentIndex;)this._trajectory.pop(),this._trajectoryTransforms.pop(),this._trajectoryCameras.pop()}set(t){this._setTrajectory(t),this._setCurrentImage(),this._setReference(this._currentImage),this._setTrajectories(),this._setCurrentCamera()}getCenter(){return null!=this._currentImage?this.currentTransform.projectBasic(this._camera.lookat.toArray()):[.5,.5]}setTransitionMode(t){this._transitionMode=t}_getAlpha(){return 1}_getStateTransitionAlpha(){return 1}_setCurrent(){this._setCurrentImage(),this._setReference(this._currentImage)&&this._setTrajectories(),this._setCurrentCamera()}_setCurrentCamera(){this._currentCamera=this._trajectoryCameras[this._currentIndex].clone(),this._previousCamera=this._currentIndex>0?this._trajectoryCameras[this._currentIndex-1].clone():this._currentCamera.clone()}_motionlessTransition(){return null!=this._currentImage&&null!=this._previousImage&&(this._transitionMode===Qw.Instantaneous||!(this._currentImage.merged&&this._previousImage.merged&&this._withinOriginalDistance()&&this._sameConnectedComponent()))}_setReference(t){return!(Math.abs(t.lngLat.lat-this.reference.lat)<this._referenceThreshold&&Math.abs(t.lngLat.lng-this.reference.lng)<this._referenceThreshold)&&(!(null!=this._previousImage&&!this._motionlessTransition())&&(this._reference.lat=t.lngLat.lat,this._reference.lng=t.lngLat.lng,this._reference.alt=t.computedAltitude,!0))}_setCurrentImage(){this._currentImage=this._trajectory.length>0?this._trajectory[this._currentIndex]:null,this._previousImage=this._currentIndex>0?this._trajectory[this._currentIndex-1]:null}_setTrajectory(t){if(t.length<1)throw new Xh("Trajectory can not be empty");null!=this._currentImage?(this._trajectory=[this._currentImage].concat(t),this._currentIndex=1):(this._trajectory=t.slice(),this._currentIndex=0)}_setTrajectories(){this._trajectoryTransforms.length=0,this._trajectoryCameras.length=0,this._appendToTrajectories(this._trajectory)}_appendToTrajectories(t){for(let e of t){if(!e.assetsCached)throw new Xh("Assets must be cached when image is added to trajectory");let t=this._imageToTranslation(e,this.reference),i=new zg(e.exifOrientation,e.width,e.height,e.scale,e.rotation,t,e.image,void 0,e.cameraParameters,e.cameraType);this._trajectoryTransforms.push(i),this._trajectoryCameras.push(new nS(i))}}_prependToTrajectories(t){for(let e of t.reverse()){if(!e.assetsCached)throw new Xh("Assets must be cached when added to trajectory");let t=this._imageToTranslation(e,this.reference),i=new zg(e.exifOrientation,e.width,e.height,e.scale,e.rotation,t,e.image,void 0,e.cameraParameters,e.cameraType);this._trajectoryTransforms.unshift(i),this._trajectoryCameras.unshift(new nS(i))}}_imageToTranslation(t,e){return ep({alt:t.computedAltitude,lat:t.lngLat.lat,lng:t.lngLat.lng},t.rotation,e)}_sameConnectedComponent(){let t=this._currentImage,e=this._previousImage;return!!t&&!!e&&t.mergeId===e.mergeId}_withinOriginalDistance(){let t=this._currentImage,e=this._previousImage;return!t||!e||this._spatial.distanceFromLngLat(t.originalLngLat.lng,t.originalLngLat.lat,e.originalLngLat.lng,e.originalLngLat.lat)<25}}class wS extends bS{constructor(t){super(t)}setViewMatrix(t){const e=(new Jn).fromArray(t).invert().elements,i=new bn(e[12],e[13],e[14]),n=new bn(-e[8],-e[9],-e[10]),r=new bn(e[4],e[5],e[6]),a=this._camera;a.position.copy(i),a.lookat.copy(i.clone().add(n)),a.up.copy(r);const o=.5/Math.tan(Math.PI/3);a.focal=o}}class SS extends bS{constructor(t){super(t),this._transition=0;const e=this._camera.position.clone(),i=this._camera.lookat.clone().sub(e).normalize(),n=Math.sqrt(i.x*i.x+i.y*i.y),r=Math.atan2(i.z,n),a=new bn;if(r>-Math.PI/45)a.copy(e),e.add(new bn(i.x,i.y,0).multiplyScalar(-50)),e.z=30;else{const t=e.clone(),n=new bn(0,0,1),r=new bn(0,0,-2),o=(new bn).subVectors(r,t).dot(n)/i.dot(n),s=1e4,l=t.clone().add(i.clone().multiplyScalar(Math.min(s,o)));a.copy(l);const c=e.clone().sub(l).normalize();e.copy(l.add(c.multiplyScalar(Math.max(50,c.length()))))}const o=this._camera.position.clone(),s=o.clone().add(i.clone().normalize().multiplyScalar(10)),l=this._camera.up.clone(),c=s.clone(),u=c.clone().add(i.clone().normalize().multiplyScalar(10)),h=l.clone(),p=e.clone(),d=a.clone(),f=new bn(0,0,1),m=e.clone().add(d.clone().sub(p).normalize().multiplyScalar(-10)),g=d.clone(),_=f.clone();this._curveE=new Pc([c,o,p,m]),this._curveL=new Pc([u,s,d,g]),this._curveU=new Pc([h,l,f,_]),this._zoom0=this._zoom,this._zoom1=0,this._camera.focal=.5/Math.tan(Math.PI/4)}get _isTransitioning(){return this._transition<1}dolly(t){if(this._isTransitioning)return;const e=this._camera,i=e.position.clone().sub(e.lookat),n=i.length()*Math.pow(2,-t),r=Math.max(1,Math.min(n,4e3));i.normalize(),i.multiplyScalar(r),e.position.copy(e.lookat).add(i)}orbit(t){if(this._isTransitioning)return;const e=this._camera,i=(new xn).setFromUnitVectors(e.up,new bn(0,0,1)),n=i.clone().invert(),r=e.position.clone().sub(e.lookat);r.applyQuaternion(i);const a=r.length();let o=Math.atan2(r.y,r.x);o+=t.phi;let s=Math.atan2(Math.sqrt(r.x*r.x+r.y*r.y),r.z);s+=t.theta;const l=Math.PI/36;s=Math.max(l,Math.min(Math.PI/2-l,s)),r.x=Math.sin(s)*Math.cos(o),r.y=Math.sin(s)*Math.sin(o),r.z=Math.cos(s),r.applyQuaternion(n),e.position.copy(e.lookat).add(r.multiplyScalar(a))}truck(t){if(this._isTransitioning)return;const e=this._camera;e.position.add((new bn).fromArray(t)),e.lookat.add((new bn).fromArray(t))}update(t){if(!this._isTransitioning)return;this._transition=Math.min(this._transition+2*t/3,1);const e=on.smootherstep(this._transition,0,1),i=(e+1)/3,n=this._curveE.getPoint(i),r=this._curveL.getPoint(i),a=this._curveU.getPoint(i);this._camera.position.copy(n),this._camera.lookat.copy(r),this._camera.up.copy(a),this._zoom=on.lerp(this._zoom0,this._zoom1,e),this._stateTransitionAlpha=e}_getStateTransitionAlpha(){return this._stateTransitionAlpha}}class ES{constructor(t,e){this._phi=t,this._theta=e}get phi(){return this._phi}set phi(t){this._phi=t}get theta(){return this._theta}set theta(t){this._theta=t}get isZero(){return 0===this._phi&&0===this._theta}copy(t){this._phi=t.phi,this._theta=t.theta}lerp(t,e){this._phi=(1-e)*this._phi+e*t.phi,this._theta=(1-e)*this._theta+e*t.theta}multiply(t){this._phi*=t,this._theta*=t}threshold(t){this._phi=Math.abs(this._phi)>t?this._phi:0,this._theta=Math.abs(this._theta)>t?this._theta:0}lengthSquared(){return this._phi*this._phi+this._theta*this._theta}reset(){this._phi=0,this._theta=0}}class TS extends bS{constructor(t){super(t),this._animationSpeed=1/40,this._rotationDelta=new ES(0,0),this._requestedRotationDelta=null,this._basicRotation=[0,0],this._requestedBasicRotation=null,this._requestedBasicRotationUnbounded=null,this._rotationAcceleration=.86,this._rotationIncreaseAlpha=.97,this._rotationDecreaseAlpha=.9,this._rotationThreshold=.001,this._unboundedRotationAlpha=.8,this._desiredZoom=t.zoom,this._minZoom=0,this._maxZoom=3,this._lookatDepth=10,this._desiredLookat=null,this._desiredCenter=null}rotate(t){null!=this._currentImage&&(0===t.phi&&0===t.theta||(this._desiredZoom=this._zoom,this._desiredLookat=null,this._requestedBasicRotation=null,null!=this._requestedRotationDelta?(this._requestedRotationDelta.phi=this._requestedRotationDelta.phi+t.phi,this._requestedRotationDelta.theta=this._requestedRotationDelta.theta+t.theta):this._requestedRotationDelta=new ES(t.phi,t.theta)))}rotateUnbounded(t){if(null==this._currentImage)return;if(this._requestedBasicRotation=null,this._requestedRotationDelta=null,this._applyRotation(t,this._currentCamera),this._applyRotation(t,this._previousCamera),!this._desiredLookat)return;const e=(new xn).setFromUnitVectors(this._currentCamera.up,new bn(0,0,1)),i=e.clone().invert(),n=(new bn).copy(this._desiredLookat).sub(this._camera.position).applyQuaternion(e),r=n.length();let a=Math.atan2(n.y,n.x);a+=t.phi;let o=Math.atan2(Math.sqrt(n.x*n.x+n.y*n.y),n.z);o+=t.theta,o=Math.max(.1,Math.min(Math.PI-.1,o)),n.x=Math.sin(o)*Math.cos(a),n.y=Math.sin(o)*Math.sin(a),n.z=Math.cos(o),n.applyQuaternion(i),this._desiredLookat.copy(this._camera.position).add(n.multiplyScalar(r))}rotateWithoutInertia(t){if(null==this._currentImage)return;this._desiredZoom=this._zoom,this._desiredLookat=null,this._requestedBasicRotation=null,this._requestedRotationDelta=null;const e=Math.PI/(10*Math.pow(2,this._zoom)),i={phi:this._spatial.clamp(t.phi,-e,e),theta:this._spatial.clamp(t.theta,-e,e)};this._applyRotation(i,this._currentCamera),this._applyRotation(i,this._previousCamera)}rotateBasic(t){if(null!=this._currentImage)if(this._desiredZoom=this._zoom,this._desiredLookat=null,this._requestedRotationDelta=null,null!=this._requestedBasicRotation){this._requestedBasicRotation[0]+=t[0],this._requestedBasicRotation[1]+=t[1];let e=.05/Math.pow(2,this._zoom);this._requestedBasicRotation[0]=this._spatial.clamp(this._requestedBasicRotation[0],-e,e),this._requestedBasicRotation[1]=this._spatial.clamp(this._requestedBasicRotation[1],-e,e)}else this._requestedBasicRotation=t.slice()}rotateBasicUnbounded(t){null!=this._currentImage&&(null!=this._requestedBasicRotationUnbounded?(this._requestedBasicRotationUnbounded[0]+=t[0],this._requestedBasicRotationUnbounded[1]+=t[1]):this._requestedBasicRotationUnbounded=t.slice())}rotateBasicWithoutInertia(t){if(null==this._currentImage)return;this._desiredZoom=this._zoom,this._desiredLookat=null,this._requestedRotationDelta=null,this._requestedBasicRotation=null;const e=.05/Math.pow(2,this._zoom),i=t.slice();i[0]=this._spatial.clamp(i[0],-e,e),i[1]=this._spatial.clamp(i[1],-e,e),this._applyRotationBasic(i)}rotateToBasic(t){if(null==this._currentImage)return;this._desiredZoom=this._zoom,this._desiredLookat=null,t[0]=this._spatial.clamp(t[0],0,1),t[1]=this._spatial.clamp(t[1],0,1);let e=this.currentTransform.unprojectBasic(t,this._lookatDepth);this._currentCamera.lookat.fromArray(e)}zoomIn(t,e){if(null==this._currentImage)return;this._desiredZoom=Math.max(this._minZoom,Math.min(this._maxZoom,this._desiredZoom+t));let i=this.currentTransform.projectBasic(this._currentCamera.lookat.toArray()),n=i[0],r=i[1],a=Math.pow(2,this._zoom),o=Math.pow(2,this._desiredZoom),s=e[0],l=e[1];Qh(this.currentTransform.cameraType)&&(s-n>.5?s-=1:n-s>.5&&(s=1+s));let c=s-a/o*(s-n),u=l-a/o*(l-r);Qh(this._currentImage.cameraType)?(c=this._spatial.wrap(c+this._basicRotation[0],0,1),u=this._spatial.clamp(u+this._basicRotation[1],.05,.95)):(c=this._spatial.clamp(c,0,1),u=this._spatial.clamp(u,0,1)),this._desiredLookat=(new bn).fromArray(this.currentTransform.unprojectBasic([c,u],this._lookatDepth))}setCenter(t){this._desiredLookat=null,this._requestedRotationDelta=null,this._requestedBasicRotation=null,this._desiredZoom=this._zoom;let e=[this._spatial.clamp(t[0],0,1),this._spatial.clamp(t[1],0,1)];if(null==this._currentImage)return void(this._desiredCenter=e);this._desiredCenter=null;let i=(new bn).fromArray(this.currentTransform.unprojectBasic(e,this._lookatDepth)),n=null!=this.previousTransform?this.previousTransform:this.currentTransform,r=(new bn).fromArray(n.unprojectBasic(e,this._lookatDepth));this._currentCamera.lookat.copy(i),this._previousCamera.lookat.copy(r)}setZoom(t){this._desiredLookat=null,this._requestedRotationDelta=null,this._requestedBasicRotation=null,this._zoom=this._spatial.clamp(t,this._minZoom,this._maxZoom),this._desiredZoom=this._zoom}_applyRotation(t,e){if(null==e)return;let i=(new xn).setFromUnitVectors(e.up,new bn(0,0,1)),n=i.clone().invert(),r=new bn;r.copy(e.lookat).sub(e.position),r.applyQuaternion(i);let a=r.length(),o=Math.atan2(r.y,r.x);o+=t.phi;let s=Math.atan2(Math.sqrt(r.x*r.x+r.y*r.y),r.z);s+=t.theta,s=Math.max(.1,Math.min(Math.PI-.1,s)),r.x=Math.sin(s)*Math.cos(o),r.y=Math.sin(s)*Math.sin(o),r.z=Math.cos(s),r.applyQuaternion(n),e.lookat.copy(e.position).add(r.multiplyScalar(a))}_applyRotationBasic(t){let e=this._currentImage,i=null!=this._previousImage?this.previousImage:this.currentImage,n=this._currentCamera,r=this._previousCamera,a=this.currentTransform,o=null!=this.previousTransform?this.previousTransform:this.currentTransform,s=a.projectBasic(n.lookat.toArray()),l=o.projectBasic(r.lookat.toArray());Qh(e.cameraType)?(s[0]=this._spatial.wrap(s[0]+t[0],0,1),s[1]=this._spatial.clamp(s[1]+t[1],.05,.95)):(s[0]=this._spatial.clamp(s[0]+t[0],0,1),s[1]=this._spatial.clamp(s[1]+t[1],0,1)),Qh(i.cameraType)?(l[0]=this._spatial.wrap(l[0]+t[0],0,1),l[1]=this._spatial.clamp(l[1]+t[1],.05,.95)):(l[0]=this._spatial.clamp(l[0]+t[0],0,1),l[1]=this._spatial.clamp(s[1]+t[1],0,1));let c=a.unprojectBasic(s,this._lookatDepth);n.lookat.fromArray(c);let u=o.unprojectBasic(l,this._lookatDepth);r.lookat.fromArray(u)}_updateZoom(t){let e=this._desiredZoom-this._zoom,i=e>0?1:e<0?-1:0;0!==e&&(Math.abs(e)<.002?(this._zoom=this._desiredZoom,null!=this._desiredLookat&&(this._desiredLookat=null)):this._zoom+=i*Math.max(Math.abs(5*t*e),.002))}_updateLookat(t){if(null===this._desiredLookat)return;let e=this._desiredLookat.distanceToSquared(this._currentCamera.lookat);Math.abs(e)<1e-6?(this._currentCamera.lookat.copy(this._desiredLookat),this._desiredLookat=null):this._currentCamera.lookat.lerp(this._desiredLookat,5*t)}_updateRotation(){if(null!=this._requestedRotationDelta){let t=this._rotationDelta.lengthSquared();return this._requestedRotationDelta.lengthSquared()>t?this._rotationDelta.lerp(this._requestedRotationDelta,this._rotationIncreaseAlpha):this._rotationDelta.lerp(this._requestedRotationDelta,this._rotationDecreaseAlpha),void(this._requestedRotationDelta=null)}if(this._rotationDelta.isZero)return;const t=Qh(this.currentImage.cameraType)?1:this._alpha;this._rotationDelta.multiply(this._rotationAcceleration*t),this._rotationDelta.threshold(this._rotationThreshold)}_updateRotationBasic(){if(null!=this._requestedBasicRotation){let t=this._basicRotation[0],e=this._basicRotation[1],i=this._requestedBasicRotation[0],n=this._requestedBasicRotation[1];return Math.abs(i)>Math.abs(t)?this._basicRotation[0]=(1-this._rotationIncreaseAlpha)*t+this._rotationIncreaseAlpha*i:this._basicRotation[0]=(1-this._rotationDecreaseAlpha)*t+this._rotationDecreaseAlpha*i,Math.abs(n)>Math.abs(e)?this._basicRotation[1]=(1-this._rotationIncreaseAlpha)*e+this._rotationIncreaseAlpha*n:this._basicRotation[1]=(1-this._rotationDecreaseAlpha)*e+this._rotationDecreaseAlpha*n,void(this._requestedBasicRotation=null)}if(null!=this._requestedBasicRotationUnbounded){let t=this._requestedBasicRotationUnbounded[0],e=this._requestedBasicRotationUnbounded[1];if(Math.abs(t)>0&&(this._basicRotation[0]=(1-this._unboundedRotationAlpha)*this._basicRotation[0]+this._unboundedRotationAlpha*t),Math.abs(e)>0&&(this._basicRotation[1]=(1-this._unboundedRotationAlpha)*this._basicRotation[1]+this._unboundedRotationAlpha*e),null!=this._desiredLookat){let i=this.currentTransform.projectBasic(this._desiredLookat.toArray());i[0]+=t,i[1]+=e,this._desiredLookat=(new bn).fromArray(this.currentTransform.unprojectBasic(i,this._lookatDepth))}this._requestedBasicRotationUnbounded=null}0===this._basicRotation[0]&&0===this._basicRotation[1]||(this._basicRotation[0]=this._rotationAcceleration*this._basicRotation[0],this._basicRotation[1]=this._rotationAcceleration*this._basicRotation[1],Math.abs(this._basicRotation[0])<this._rotationThreshold/Math.pow(2,this._zoom)&&Math.abs(this._basicRotation[1])<this._rotationThreshold/Math.pow(2,this._zoom)&&(this._basicRotation=[0,0]))}_clearRotation(){Qh(this._currentImage.cameraType)||(null!=this._requestedRotationDelta&&(this._requestedRotationDelta=null),this._rotationDelta.isZero||this._rotationDelta.reset(),null!=this._requestedBasicRotation&&(this._requestedBasicRotation=null),(this._basicRotation[0]>0||this._basicRotation[1]>0)&&(this._basicRotation=[0,0]))}_setDesiredCenter(){if(null==this._desiredCenter)return;let t=(new bn).fromArray(this.currentTransform.unprojectBasic(this._desiredCenter,this._lookatDepth)).sub(this._currentCamera.position);this._currentCamera.lookat.copy(this._currentCamera.position.clone().add(t)),this._previousCamera.lookat.copy(this._previousCamera.position.clone().add(t)),this._desiredCenter=null}_setDesiredZoom(){this._desiredZoom=Qh(this._currentImage.cameraType)||null==this._previousImage?this._zoom:0}}class MS extends TS{constructor(t){super(t),this._adjustCameras(),this._motionless=this._motionlessTransition()}prepend(t){super.prepend(t),this._motionless=this._motionlessTransition()}set(t){super.set(t),this._motionless=this._motionlessTransition()}move(t){this._alpha=Math.max(0,Math.min(1,this._alpha+t))}moveTo(t){this._alpha=Math.max(0,Math.min(1,t))}update(t){this._updateRotation(),this._rotationDelta.isZero||(this._applyRotation(this._rotationDelta,this._previousCamera),this._applyRotation(this._rotationDelta,this._currentCamera)),this._updateRotationBasic(),0===this._basicRotation[0]&&0===this._basicRotation[1]||this._applyRotationBasic(this._basicRotation);let e=this._animationSpeed*t/.1*6;this._updateZoom(e),this._updateLookat(e),this._camera.lerpCameras(this._previousCamera,this._currentCamera,this.alpha)}_getAlpha(){return this._motionless?Math.round(this._alpha):this._alpha}_setCurrentCamera(){super._setCurrentCamera(),this._adjustCameras()}_adjustCameras(){if(null!=this._previousImage){if(Qh(this._currentImage.cameraType)){let t=this._camera.lookat.clone().sub(this._camera.position);this._currentCamera.lookat.copy(t.clone().add(this._currentCamera.position))}if(Qh(this._previousImage.cameraType)){let t=this._currentCamera.lookat.clone().sub(this._currentCamera.position);this._previousCamera.lookat.copy(t.clone().add(this._previousCamera.position))}}}}class CS extends TS{constructor(t){super(t),this._adjustCameras(),this._motionless=this._motionlessTransition(),this._baseAlpha=this._alpha,this._speedCoefficient=1,this._smoothing=!1}append(t){let e=0===this._trajectory.length;e&&this._resetTransition(),super.append(t),e&&(this._setDesiredCenter(),this._setDesiredZoom())}prepend(t){let e=0===this._trajectory.length;e&&this._resetTransition(),super.prepend(t),e&&(this._setDesiredCenter(),this._setDesiredZoom())}set(t){super.set(t),this._desiredLookat=null,this._resetTransition(),this._clearRotation(),this._setDesiredCenter(),this._setDesiredZoom(),this._trajectory.length<3&&(this._smoothing=!0)}setSpeed(t){this._speedCoefficient=this._spatial.clamp(t,0,10)}update(t){1===this._alpha&&this._currentIndex+this._alpha<this._trajectory.length&&(this._currentIndex+=1,this._smoothing=this._trajectory.length<3&&this._currentIndex+1===this._trajectory.length,this._setCurrent(),this._resetTransition(),this._clearRotation(),this._desiredZoom=Qh(this._currentImage.cameraType)?this._zoom:0,this._desiredLookat=null);let e=this._animationSpeed*t/.1*6;this._baseAlpha=Math.min(1,this._baseAlpha+this._speedCoefficient*e),this._smoothing?this._alpha=on.smootherstep(this._baseAlpha,0,1):this._alpha=this._baseAlpha,this._updateRotation(),this._rotationDelta.isZero||(this._applyRotation(this._rotationDelta,this._previousCamera),this._applyRotation(this._rotationDelta,this._currentCamera)),this._updateRotationBasic(),0===this._basicRotation[0]&&0===this._basicRotation[1]||this._applyRotationBasic(this._basicRotation),this._updateZoom(e),this._updateLookat(e),this._camera.lerpCameras(this._previousCamera,this._currentCamera,this.alpha)}_getAlpha(){return this._motionless?Math.ceil(this._alpha):this._alpha}_setCurrentCamera(){super._setCurrentCamera(),this._adjustCameras()}_adjustCameras(){if(null==this._previousImage)return;let t=this._camera.lookat.clone().sub(this._camera.position);this._previousCamera.lookat.copy(t.clone().add(this._previousCamera.position)),Qh(this._currentImage.cameraType)&&this._currentCamera.lookat.copy(t.clone().add(this._currentCamera.position))}_resetTransition(){this._alpha=0,this._baseAlpha=0,this._motionless=this._motionlessTransition()}}class IS extends bS{constructor(t){super(t),this._zoom=0,this._adjustCameras(),this._motionless=this._motionlessTransition()}prepend(t){super.prepend(t),this._motionless=this._motionlessTransition()}set(t){super.set(t),this._motionless=this._motionlessTransition()}move(t){this._alpha=Math.max(0,Math.min(1,this._alpha+t))}moveTo(t){this._alpha=Math.max(0,Math.min(1,t))}update(){this._camera.lerpCameras(this._previousCamera,this._currentCamera,this.alpha)}_getAlpha(){return this._motionless?Math.round(this._alpha):this._alpha}_setCurrentCamera(){super._setCurrentCamera(),this._adjustCameras()}_adjustCameras(){if(null!=this._previousImage){if(Qh(this._currentImage.cameraType)){let t=this._camera.lookat.clone().sub(this._camera.position);this._currentCamera.lookat.copy(t.clone().add(this._currentCamera.position))}if(Qh(this._previousImage.cameraType)){let t=this._currentCamera.lookat.clone().sub(this._currentCamera.position);this._previousCamera.lookat.copy(t.clone().add(this._previousCamera.position))}}}}class AS{constructor(){const t=tg[tg.Custom],e=tg[tg.Earth],i=tg[tg.Traversing],n=tg[tg.Waiting],r=tg[tg.WaitingInteractively];this._creators=new Map;const a=this._creators;a.set(t,wS),a.set(e,SS),a.set(i,CS),a.set(n,IS),a.set(r,MS),this._transitions=new Map;const o=this._transitions;o.set(t,[e,i]),o.set(e,[t,i]),o.set(i,[t,e,n,r]),o.set(n,[i,r]),o.set(r,[i,n])}getState(t){if(t instanceof wS)return tg.Custom;if(t instanceof SS)return tg.Earth;if(t instanceof CS)return tg.Traversing;if(t instanceof IS)return tg.Waiting;if(t instanceof MS)return tg.WaitingInteractively;throw new Error("Invalid state instance")}generate(t,e){return new(this._creators.get(tg[t]))(e)}transition(t,e){if(!this.validate(t,e))throw new Error("Invalid transition");return this.generate(e,t)}validate(t,e){const i=tg[this.getState(t)],n=tg[e],r=this._transitions;return r.has(i)&&r.get(i).includes(n)}}class kS{constructor(t,e){this._transitions=new AS,this._state=this._transitions.generate(t,{alpha:1,camera:new nS,currentIndex:-1,reference:{alt:0,lat:0,lng:0},trajectory:[],transitionMode:null==e?Qw.Default:e,zoom:0})}get state(){return this._transitions.getState(this._state)}get reference(){return this._state.reference}get alpha(){return this._state.alpha}get stateTransitionAlpha(){return this._state.stateTransitionAlpha}get camera(){return this._state.camera}get zoom(){return this._state.zoom}get currentImage(){return this._state.currentImage}get previousImage(){return this._state.previousImage}get currentCamera(){return this._state.currentCamera}get currentTransform(){return this._state.currentTransform}get previousTransform(){return this._state.previousTransform}get trajectory(){return this._state.trajectory}get currentIndex(){return this._state.currentIndex}get lastImage(){return this._state.trajectory[this._state.trajectory.length-1]}get imagesAhead(){return this._state.trajectory.length-1-this._state.currentIndex}get motionless(){return this._state.motionless}custom(){this._transition(tg.Custom)}earth(){this._transition(tg.Earth)}traverse(){this._transition(tg.Traversing)}wait(){this._transition(tg.Waiting)}waitInteractively(){this._transition(tg.WaitingInteractively)}getCenter(){return this._state.getCenter()}setCenter(t){this._state.setCenter(t)}setZoom(t){this._state.setZoom(t)}update(t){this._state.update(t)}append(t){this._state.append(t)}prepend(t){this._state.prepend(t)}remove(t){this._state.remove(t)}clear(){this._state.clear()}clearPrior(){this._state.clearPrior()}cut(){this._state.cut()}set(t){this._state.set(t)}setViewMatrix(t){this._state.setViewMatrix(t)}rotate(t){this._state.rotate(t)}rotateUnbounded(t){this._state.rotateUnbounded(t)}rotateWithoutInertia(t){this._state.rotateWithoutInertia(t)}rotateBasic(t){this._state.rotateBasic(t)}rotateBasicUnbounded(t){this._state.rotateBasicUnbounded(t)}rotateBasicWithoutInertia(t){this._state.rotateBasicWithoutInertia(t)}rotateToBasic(t){this._state.rotateToBasic(t)}move(t){this._state.move(t)}moveTo(t){this._state.moveTo(t)}zoomIn(t,e){this._state.zoomIn(t,e)}setSpeed(t){this._state.setSpeed(t)}setTransitionMode(t){this._state.setTransitionMode(t)}dolly(t){this._state.dolly(t)}orbit(t){this._state.orbit(t)}truck(t){this._state.truck(t)}_transition(t){if(!this._transitions.validate(this._state,t)){const e=this._transitions.getState(this._state);return void console.warn(`Transition not valid (${tg[e]} - ${tg[t]})`)}const e=this._transitions.transition(this._state,t);this._state=e}}class RS{constructor(t,e){this._appendImage$=new ht,this._clock=new hh,this._subscriptions=new Tm;const i=this._subscriptions;this._start$=new ht,this._frame$=new ht,this._contextOperation$=new dt((t=>t)),this._context$=this._contextOperation$.pipe(ti(((t,e)=>e(t)),new kS(t,e)),Je(1),lt()),this._state$=this._context$.pipe(ee((t=>t.state)),Ue(),Je(1),lt()),this._currentState$=this._frame$.pipe(ui(this._context$,((t,e)=>[t,e])),Ce((t=>null!=t[1].currentImage)),ci((t=>{t[1].update(this._clock.getDelta())})),ee((t=>({fps:60,id:t[0],state:t[1]}))),ei()),this._lastState$=this._currentState$.pipe(Je(1),lt());let n=this._currentState$.pipe(Ue(void 0,(t=>t.state.currentImage.id)),Je(1),lt()),r=new ht;i.push(n.subscribe(r)),this._currentId$=new dt(null),i.push(r.pipe(ee((t=>t.state.currentImage.id))).subscribe(this._currentId$)),this._currentImage$=r.pipe(ee((t=>t.state.currentImage)),Je(1),lt()),this._currentCamera$=r.pipe(ee((t=>t.state.currentCamera)),Je(1),lt()),this._currentTransform$=r.pipe(ee((t=>t.state.currentTransform)),Je(1),lt()),this._reference$=r.pipe(ee((t=>t.state.reference)),Ue(((t,e)=>t.lat===e.lat&&t.lng===e.lng),(t=>({lat:t.lat,lng:t.lng}))),Je(1),lt()),this._currentImageExternal$=n.pipe(ee((t=>t.state.currentImage)),Je(1),lt()),i.push(this._appendImage$.pipe(ee((t=>e=>(e.append([t]),e)))).subscribe(this._contextOperation$)),this._inMotionOperation$=new ht,i.push(n.pipe(ee((()=>!0))).subscribe(this._inMotionOperation$)),i.push(this._inMotionOperation$.pipe(Ue(),Ce((t=>t)),oi((()=>this._currentState$.pipe(Ce((t=>0===t.state.imagesAhead)),ee((t=>[t.state.camera.clone(),t.state.zoom])),Xe(),ee((t=>{let e=t[0][0],i=t[1][0],n=t[0][1],r=t[1][1];return e.diff(i)>1e-5||Math.abs(n-r)>1e-5})),He((t=>!t)))))).subscribe(this._inMotionOperation$)),this._inMotion$=this._inMotionOperation$.pipe(Ue(),Je(1),lt()),this._inTranslationOperation$=new ht,i.push(n.pipe(ee((()=>!0))).subscribe(this._inTranslationOperation$)),i.push(this._inTranslationOperation$.pipe(Ue(),Ce((t=>t)),oi((()=>this._currentState$.pipe(Ce((t=>0===t.state.imagesAhead)),ee((t=>t.state.camera.position.clone())),Xe(),ee((t=>0!==t[0].distanceToSquared(t[1]))),He((t=>!t)))))).subscribe(this._inTranslationOperation$)),this._inTranslation$=this._inTranslationOperation$.pipe(Ue(),Je(1),lt()),i.push(this._state$.subscribe((()=>{}))),i.push(this._currentImage$.subscribe((()=>{}))),i.push(this._currentCamera$.subscribe((()=>{}))),i.push(this._currentTransform$.subscribe((()=>{}))),i.push(this._reference$.subscribe((()=>{}))),i.push(this._currentImageExternal$.subscribe((()=>{}))),i.push(this._lastState$.subscribe((()=>{}))),i.push(this._inMotion$.subscribe((()=>{}))),i.push(this._inTranslation$.subscribe((()=>{}))),this._frameId=null,this._frameGenerator=new xS(window)}get currentState$(){return this._currentState$}get currentImage$(){return this._currentImage$}get currentId$(){return this._currentId$}get currentImageExternal$(){return this._currentImageExternal$}get currentCamera$(){return this._currentCamera$}get currentTransform$(){return this._currentTransform$}get state$(){return this._state$}get reference$(){return this._reference$}get inMotion$(){return this._inMotion$}get inTranslation$(){return this._inTranslation$}get appendImage$(){return this._appendImage$}dispose(){this.stop(),this._subscriptions.unsubscribe()}custom(){this._inMotionOperation$.next(!0),this._invokeContextOperation((t=>{t.custom()}))}earth(){this._inMotionOperation$.next(!0),this._invokeContextOperation((t=>{t.earth()}))}traverse(){this._inMotionOperation$.next(!0),this._invokeContextOperation((t=>{t.traverse()}))}wait(){this._invokeContextOperation((t=>{t.wait()}))}waitInteractively(){this._invokeContextOperation((t=>{t.waitInteractively()}))}appendImagess(t){this._invokeContextOperation((e=>{e.append(t)}))}prependImages(t){this._invokeContextOperation((e=>{e.prepend(t)}))}removeImages(t){this._invokeContextOperation((e=>{e.remove(t)}))}clearImages(){this._invokeContextOperation((t=>{t.clear()}))}clearPriorImages(){this._invokeContextOperation((t=>{t.clearPrior()}))}cutImages(){this._invokeContextOperation((t=>{t.cut()}))}setImages(t){this._invokeContextOperation((e=>{e.set(t)}))}setViewMatrix(t){this._inMotionOperation$.next(!0),this._invokeContextOperation((e=>{e.setViewMatrix(t)}))}rotate(t){this._inMotionOperation$.next(!0),this._invokeContextOperation((e=>{e.rotate(t)}))}rotateUnbounded(t){this._inMotionOperation$.next(!0),this._invokeContextOperation((e=>{e.rotateUnbounded(t)}))}rotateWithoutInertia(t){this._inMotionOperation$.next(!0),this._invokeContextOperation((e=>{e.rotateWithoutInertia(t)}))}rotateBasic(t){this._inMotionOperation$.next(!0),this._invokeContextOperation((e=>{e.rotateBasic(t)}))}rotateBasicUnbounded(t){this._inMotionOperation$.next(!0),this._invokeContextOperation((e=>{e.rotateBasicUnbounded(t)}))}rotateBasicWithoutInertia(t){this._inMotionOperation$.next(!0),this._invokeContextOperation((e=>{e.rotateBasicWithoutInertia(t)}))}rotateToBasic(t){this._inMotionOperation$.next(!0),this._invokeContextOperation((e=>{e.rotateToBasic(t)}))}move(t){this._inMotionOperation$.next(!0),this._invokeContextOperation((e=>{e.move(t)}))}moveTo(t){this._inMotionOperation$.next(!0),this._invokeContextOperation((e=>{e.moveTo(t)}))}dolly(t){this._inMotionOperation$.next(!0),this._invokeContextOperation((e=>{e.dolly(t)}))}orbit(t){this._inMotionOperation$.next(!0),this._invokeContextOperation((e=>{e.orbit(t)}))}truck(t){this._inMotionOperation$.next(!0),this._invokeContextOperation((e=>{e.truck(t)}))}zoomIn(t,e){this._inMotionOperation$.next(!0),this._invokeContextOperation((i=>{i.zoomIn(t,e)}))}getCenter(){return this._lastState$.pipe(He(),ee((t=>t.state.getCenter())))}getZoom(){return this._lastState$.pipe(He(),ee((t=>t.state.zoom)))}setCenter(t){this._inMotionOperation$.next(!0),this._invokeContextOperation((e=>{e.setCenter(t)}))}setSpeed(t){this._invokeContextOperation((e=>{e.setSpeed(t)}))}setTransitionMode(t){this._invokeContextOperation((e=>{e.setTransitionMode(t)}))}setZoom(t){this._inMotionOperation$.next(!0),this._invokeContextOperation((e=>{e.setZoom(t)}))}start(){this._clock.start(),null==this._frameId&&(this._start$.next(null),this._frameId=this._frameGenerator.requestAnimationFrame(this._frame.bind(this)),this._frame$.next(this._frameId))}stop(){this._clock.stop(),null!=this._frameId&&(this._frameGenerator.cancelAnimationFrame(this._frameId),this._frameId=null)}_invokeContextOperation(t){this._contextOperation$.next((e=>(t(e),e)))}_frame(){this._frameId=this._frameGenerator.requestAnimationFrame(this._frame.bind(this)),this._frame$.next(this._frameId)}}function zS(t){switch(t){case Xw.Custom:return tg.Custom;case Xw.Earth:return tg.Earth;case Xw.Street:return tg.Traversing;default:return null}}class PS{constructor(t,e,i,n,r,a,o,s){var l;e?this._api=e:t.dataProvider?this._api=new yS(t.dataProvider):this._api=new yS(new Ww({accessToken:t.accessToken})),this._graphService=null!==i&&void 0!==i?i:new vS(new ap(this.api)),this._loadingName="navigator",this._loadingService=null!==n&&void 0!==n?n:new mS;const c=null!==(l=t.cameraControls)&&void 0!==l?l:Xw.Street;this._stateService=null!==r&&void 0!==r?r:new RS(zS(c),t.transitionMode),this._cacheService=null!==a&&void 0!==a?a:new fS(this._graphService,this._stateService,this._api),this._playService=null!==o&&void 0!==o?o:new Bg(this._graphService,this._stateService),this._panService=null!==s&&void 0!==s?s:new _S(this._graphService,this._stateService,t.combinedPanning),this._idRequested$=new dt(null),this._movedToId$=new dt(null),this._request$=null,this._requestSubscription=null,this._imageRequestSubscription=null}get api(){return this._api}get cacheService(){return this._cacheService}get graphService(){return this._graphService}get loadingService(){return this._loadingService}get movedToId$(){return this._movedToId$}get panService(){return this._panService}get playService(){return this._playService}get stateService(){return this._stateService}dispose(){this._abortRequest("viewer removed"),this._cacheService.stop(),this._graphService.dispose(),this._panService.dispose(),this._playService.dispose(),this._stateService.dispose()}moveTo$(t){this._abortRequest(`to id ${t}`),this._loadingService.startLoading(this._loadingName);const e=this._moveTo$(t);return this._makeRequest$(e)}moveDir$(t){this._abortRequest(`in dir ${Hh[t]}`),this._loadingService.startLoading(this._loadingName);const e=this.stateService.currentImage$.pipe(He(),fe((e=>([Hh.Next,Hh.Prev].indexOf(t)>-1?e.sequenceEdges$:e.spatialEdges$).pipe(He(),ee((e=>{for(let i of e.edges)if(i.data.direction===t)return i.target;return null}))))),fe((e=>null==e?(this._loadingService.stopLoading(this._loadingName),Yt(new Error(`Direction (${t}) does not exist for current image.`))):this._moveTo$(e))));return this._makeRequest$(e)}setFilter$(t){return this._stateService.clearImages(),this._movedToId$.pipe(He(),fe((e=>null!=e?this._trajectoryIds$().pipe(fe((e=>this._graphService.setFilter$(t).pipe(fe((()=>this._cacheIds$(e)))))),Ze()):this._idRequested$.pipe(He(),fe((e=>null!=e?this._graphService.setFilter$(t).pipe(fe((()=>this._graphService.cacheImage$(e)))):this._graphService.setFilter$(t).pipe(ee((()=>{})))))))),ee((()=>{})))}setAccessToken$(t){return this._abortRequest("to set user token"),this._stateService.clearImages(),this._movedToId$.pipe(He(),ci((()=>{this._api.setAccessToken(t)})),fe((t=>null==t?this._graphService.reset$([]):this._trajectoryIds$().pipe(fe((t=>this._graphService.reset$(t).pipe(fe((()=>this._cacheIds$(t)))))),Ze(),ee((()=>{}))))))}_cacheIds$(t){return Ft(t.map((t=>this._graphService.cacheImage$(t)))).pipe(me())}_abortRequest(t){null!=this._requestSubscription&&(this._requestSubscription.unsubscribe(),this._requestSubscription=null),null!=this._imageRequestSubscription&&(this._imageRequestSubscription.unsubscribe(),this._imageRequestSubscription=null),null!=this._request$&&(this._request$.isStopped||this._request$.hasError||this._request$.error(new zm(`Request aborted by a subsequent request ${t}.`)),this._request$=null)}_makeRequest$(t){const e=new mt(1);return this._requestSubscription=e.subscribe(void 0,(()=>{})),this._request$=e,this._imageRequestSubscription=t.subscribe((t=>{this._request$=null,e.next(t),e.complete()}),(t=>{this._request$=null,e.error(t)})),e}_moveTo$(t){return this._idRequested$.next(t),this._graphService.cacheImage$(t).pipe(ci((t=>{this._stateService.setImages([t]),this._movedToId$.next(t.id)})),Ge((()=>{this._loadingService.stopLoading(this._loadingName)})))}_trajectoryIds$(){return this._stateService.currentState$.pipe(He(),ee((t=>t.state.trajectory.map((t=>t.id)))))}}class DS{constructor(t,e){this._spatial=null!==e&&void 0!==e?e:new Kh,this._viewportCoords=null!==t&&void 0!==t?t:new Am}basicToCanvas(t,e,i,n){return this._viewportCoords.basicToCanvasSafe(t[0],t[1],e,n,i.perspective)}canvasToBasic(t,e,i,n){let r=this._viewportCoords.canvasToBasic(t[0],t[1],e,n,i.perspective);return(r[0]<0||r[0]>1||r[1]<0||r[1]>1)&&(r=null),r}eventToUnprojection(t,e,i,n,r){const a=this._viewportCoords.canvasPosition(t,e);return this.canvasToUnprojection(a,e,i,n,r)}canvasToUnprojection(t,e,i,n,r){const a=t[0],o=t[1],[s,l]=this._viewportCoords.canvasToViewport(a,o,e),c=new bn(s,l,1).unproject(i.perspective);let u=r.projectBasic(c.toArray());(u[0]<0||u[0]>1||u[1]<0||u[1]>1)&&(u=null);const h=c.clone().sub(i.camera.position).normalize(),p=-2/h.z;let d=null;if(p>0&&p<100&&u){const t=h.clone().multiplyScalar(p).add(i.camera.position),[e,r]=Nh(t.x,t.y,t.z,n.lng,n.lat,n.alt);d={lat:r,lng:e}}return{basicPoint:u,lngLat:d,pixelPoint:[a,o]}}cameraToLngLat(t,e){const i=t.camera.position,[n,r]=Nh(i.x,i.y,i.z,e.lng,e.lat,e.alt);return{lat:r,lng:n}}lngLatToCanvas(t,e,i,n){const r=Fh(t.lng,t.lat,0,n.lng,n.lat,n.alt);return this._viewportCoords.projectToCanvasSafe(r,e,i.perspective)}distanceBetweenLngLats(t,e){return this._spatial.distanceFromLngLat(t.lng,t.lat,e.lng,e.lat)}}class LS{constructor(t,e,i){this._subscriptions=new Tm,this._emitSubscriptions=new Tm,this._container=i,this._viewer=t,this._navigator=e,this._projection=new DS,this._started=!1,this._navigable$=new ht;const n=this._subscriptions;n.push(this._navigable$.subscribe((t=>{const e="navigable",i={navigable:t,target:this._viewer,type:e};this._viewer.fire(e,i)}))),n.push(this._navigator.loadingService.loading$.subscribe((t=>{const e="dataloading",i={loading:t,target:this._viewer,type:e};this._viewer.fire(e,i)}))),n.push(this._container.glRenderer.opaqueRender$.pipe(He()).subscribe((()=>{const t="load",e={target:this._viewer,type:t};this._viewer.fire(t,e)})))}get started(){return this._started}get navigable$(){return this._navigable$}get projection(){return this._projection}dispose(){this.stopEmit(),this._subscriptions.unsubscribe()}project$(t){return ue(this._container.renderService.renderCamera$,this._navigator.stateService.currentImage$,this._navigator.stateService.reference$).pipe(He(),ee((([e,i,n])=>{if(this._projection.distanceBetweenLngLats(t,i.lngLat)>1e3)return null;const r=this._projection.lngLatToCanvas(t,this._container.container,e,n);return r?[Math.round(r[0]),Math.round(r[1])]:null})))}projectBasic$(t){return ue(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$).pipe(He(),ee((([e,i])=>{const n=this._projection.basicToCanvas(t,this._container.container,e,i);return n?[Math.round(n[0]),Math.round(n[1])]:null})))}startEmit(){if(this._started)return;this._started=!0;const t=this._emitSubscriptions;t.push(this._navigator.stateService.currentImageExternal$.subscribe((t=>{const e="image",i={image:t,target:this._viewer,type:e};this._viewer.fire(e,i)}))),t.push(this._navigator.stateService.currentImageExternal$.pipe(oi((t=>t.sequenceEdges$))).subscribe((t=>{const e="sequenceedges",i={status:t,target:this._viewer,type:e};this._viewer.fire(e,i)}))),t.push(this._navigator.stateService.currentImageExternal$.pipe(oi((t=>t.spatialEdges$))).subscribe((t=>{const e="spatialedges",i={status:t,target:this._viewer,type:e};this._viewer.fire(e,i)}))),t.push(this._navigator.stateService.reference$.subscribe((t=>{const e="reference",i={reference:t,target:this._viewer,type:e};this._viewer.fire(e,i)}))),t.push(ue(this._navigator.stateService.inMotion$,this._container.mouseService.active$,this._container.touchService.active$).pipe(ee((t=>t[0]||t[1]||t[2])),Ue()).subscribe((t=>{const e=t?"movestart":"moveend",i={target:this._viewer,type:e};this._viewer.fire(e,i)}))),t.push(this._container.renderService.bearing$.pipe(Ae(100),Ue(((t,e)=>Math.abs(e-t)<1))).subscribe((t=>{const e="bearing",i={bearing:t,target:this._viewer,type:e};this._viewer.fire(e,i)})));const e=this._container.mouseService.active$.pipe(oi((t=>t?Et():this._container.mouseService.mouseMove$)));t.push(Ee(this._mapMouseEvent$("click",this._container.mouseService.staticClick$),this._mapMouseEvent$("contextmenu",this._container.mouseService.contextMenu$),this._mapMouseEvent$("dblclick",this._container.mouseService.dblClick$),this._mapMouseEvent$("mousedown",this._container.mouseService.mouseDown$),this._mapMouseEvent$("mousemove",e),this._mapMouseEvent$("mouseout",this._container.mouseService.mouseOut$),this._mapMouseEvent$("mouseover",this._container.mouseService.mouseOver$),this._mapMouseEvent$("mouseup",this._container.mouseService.mouseUp$)).pipe(ui(this._container.renderService.renderCamera$,this._navigator.stateService.reference$,this._navigator.stateService.currentTransform$,this._navigator.stateService.state$),ee((([[t,e],i,n,r,a])=>{const o=this._projection.eventToUnprojection(e,this._container.container,i,n,r);return{basicPoint:a===tg.Traversing?o.basicPoint:null,lngLat:o.lngLat,originalEvent:e,pixelPoint:o.pixelPoint,target:this._viewer,type:t}}))).subscribe((t=>{this._viewer.fire(t.type,t)}))),t.push(this._container.renderService.renderCamera$.pipe(Ue((([t,e],[i,n])=>this._closeTo(t,i,.01)&&this._closeTo(e,n,.01)),(t=>t.camera.position.toArray()))).subscribe((()=>{const t="position",e={target:this._viewer,type:t};this._viewer.fire(t,e)}))),t.push(this._container.renderService.renderCamera$.pipe(Ue((([t,e],[i,n])=>this._closeTo(t,i,.001)&&this._closeTo(e,n,.001)),(t=>[t.rotation.phi,t.rotation.theta]))).subscribe((()=>{const t={target:this._viewer,type:"pov"};this._viewer.fire("pov",t)}))),t.push(this._container.renderService.renderCamera$.pipe(Ue(((t,e)=>this._closeTo(t,e,.01)),(t=>t.perspective.fov))).subscribe((()=>{const t={target:this._viewer,type:"fov"};this._viewer.fire("fov",t)})))}stopEmit(){this.started&&(this._emitSubscriptions.unsubscribe(),this._started=!1)}unproject$(t){return ue(this._container.renderService.renderCamera$,this._navigator.stateService.reference$,this._navigator.stateService.currentTransform$).pipe(He(),ee((([e,i,n])=>this._projection.canvasToUnprojection(t,this._container.container,e,i,n).lngLat)))}unprojectBasic$(t){return ue(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$).pipe(He(),ee((([e,i])=>this._projection.canvasToBasic(t,this._container.container,e,i))))}_closeTo(t,e,i){return Math.abs(t-e)<=i}_mapMouseEvent$(t,e){return e.pipe(ee((e=>[t,e])))}}class BS{constructor(t,e){this._container=t,this._navigator=e,this._renderers={}}add(t,e){const i=new Tm;this._renderers[t.id]={subs:i,renderer:t},i.push(ue([this._container.glRenderer.webGLRenderer$,this._navigator.stateService.reference$]).pipe(Ne(1)).subscribe((([i,n])=>{t.onAdd(e,n,i.getContext())}))),i.push(this._container.glRenderer.opaqueRender$.pipe(ui(this._container.renderService.renderCamera$,this._container.glRenderer.webGLRenderer$)).subscribe((([,e,i])=>{const n=i.getContext(),r=e.perspective.matrixWorldInverse,a=e.perspective.projectionMatrix;t.render(n,r.toArray(),a.toArray())}))),i.push(this._navigator.stateService.reference$.pipe(ni(1)).subscribe((i=>{t.onReference(e,i)})))}dispose(t){for(const e of Object.keys(this._renderers))this.remove(e,t)}has(t){return t in this._renderers}remove(t,e){this._renderers[t].subs.unsubscribe();const i=this._renderers[t].renderer;delete this._renderers[t],this._container.glRenderer.webGLRenderer$.subscribe((t=>{i.onRemove(e,t.getContext())}))}}class OS{constructor(t,e){this._container=t,this._navigator=e,this._controls=null,this._subscriptions=new Tm}attach(t,e){if(this._controls)throw new Yh("Custom camera controls already attached");this._controls=t;const i=new ht,n=i.pipe(oi((()=>this._navigator.stateService.state$)),ee((t=>t===tg.Custom)),Ue()),r=this._subscriptions;r.push(n.pipe(ai(!1),Xe(),ui(this._navigator.stateService.reference$,this._container.renderService.renderCamera$)).subscribe((([[i,n],r,a])=>{n?t.onActivate(e,a.perspective.matrixWorldInverse.toArray(),a.perspective.projectionMatrix.toArray(),r):i&&t.onDeactivate(e)}))),r.push(n.pipe(oi((t=>t?this._navigator.stateService.currentState$.pipe(ni(1)):Et()))).subscribe((i=>{t.onAnimationFrame(e,i.id)}))),r.push(n.pipe(oi((t=>t?this._navigator.stateService.reference$.pipe(ni(1)):Et()))).subscribe((i=>t.onReference(e,i)))),r.push(n.pipe(oi((t=>t?this._container.renderService.size$.pipe(ni(1)):Et()))).subscribe((()=>t.onResize(e)))),r.push(ue([this._container.glRenderer.webGLRenderer$,this._container.renderService.renderCamera$,this._navigator.stateService.reference$,this._navigator.stateService.state$]).pipe(He()).subscribe((()=>{t.onAttach(e,(e=>{this._controls&&t===this._controls&&this._updateViewMatrix(e)}),(e=>{this._controls&&t===this._controls&&this._updateProjectionMatrix(e)})),i.next(),i.complete()})))}detach(t){const e=this._controls;return this._controls=null,this._subscriptions.unsubscribe(),new Promise((i=>{this._navigator.stateService.state$.pipe(Ne(1)).subscribe((n=>{e?(n===tg.Custom&&e.onDeactivate(t),e.onDetach(t),i(e)):i(null)}))}))}dispose(t){this.detach(t)}has(t){return!!this._controls&&t===this._controls}_updateProjectionMatrix(t){this._navigator.stateService.state$.pipe(He()).subscribe((e=>{if(e===tg.Custom)this._container.renderService.projectionMatrix$.next(t);else{const t="Incorrect camera control mode for projection matrix update";console.warn(t)}}))}_updateViewMatrix(t){this._navigator.stateService.state$.pipe(He()).subscribe((e=>{if(e===tg.Custom)this._navigator.stateService.setViewMatrix(t);else{const t="Incorrect camera control mode for view matrix update";console.warn(t)}}))}}class FS extends Em{constructor(t){super(),this._navigator=new PS(t),this._container=new dS(t,this._navigator.stateService),this._observer=new LS(this,this._navigator,this._container),this._componentController=new tS(this._container,this._navigator,this._observer,t.imageId,t.component),this._customRenderer=new BS(this._container,this._navigator),this._customCameraControls=new OS(this._container,this._navigator)}get dataProvider(){return this._navigator.api.data}get isNavigable(){return this._componentController.navigable}activateCombinedPanning(){this._navigator.panService.enable()}activateComponent(t){this._componentController.activate(t)}activateCover(){this._componentController.activateCover()}addCustomRenderer(t){this._customRenderer.add(t,this)}attachCustomCameraControls(t){this._customCameraControls.attach(t,this)}deactivateCombinedPanning(){this._navigator.panService.disable()}deactivateComponent(t){this._componentController.deactivate(t)}deactivateCover(){this._componentController.deactivateCover()}detachCustomCameraControls(){return this._customCameraControls.detach(this)}fire(t,e){super.fire(t,e)}getBearing(){return new Promise(((t,e)=>{this._container.renderService.bearing$.pipe(He()).subscribe((e=>{t(e)}),(t=>{e(t)}))}))}getCameraControls(){return new Promise(((t,e)=>{this._navigator.stateService.state$.pipe(He()).subscribe((e=>{switch(e){case tg.Custom:t(Xw.Custom);break;case tg.Earth:t(Xw.Earth);break;default:t(Xw.Street)}}),(t=>{e(t)}))}))}getCanvas(){return this._container.canvas}getCanvasContainer(){return this._container.canvasContainer}getCenter(){return new Promise(((t,e)=>{this._navigator.stateService.getCenter().subscribe((e=>{t(e)}),(t=>{e(t)}))}))}getComponent(t){return this._componentController.get(t)}getContainer(){return this._container.container}getFieldOfView(){return new Promise(((t,e)=>{this._container.renderService.renderCamera$.pipe(He()).subscribe((e=>{t(e.perspective.fov)}),(t=>{e(t)}))}))}getImage(){return new Promise(((t,e)=>{this._navigator.stateService.currentImage$.pipe(He()).subscribe((e=>{t(e)}),(t=>{e(t)}))}))}getPointOfView(){return new Promise(((t,e)=>{ue(this._container.renderService.renderCamera$,this._container.renderService.bearing$).pipe(He()).subscribe((([e,i])=>{t({bearing:i,tilt:e.getTilt()})}),(t=>{e(t)}))}))}getPosition(){return new Promise(((t,e)=>{ue(this._container.renderService.renderCamera$,this._navigator.stateService.reference$).pipe(He()).subscribe((([e,i])=>{t(this._observer.projection.cameraToLngLat(e,i))}),(t=>{e(t)}))}))}getReference(){return new Promise(((t,e)=>{this._navigator.stateService.reference$.pipe(He()).subscribe((e=>{t(e)}),(t=>{e(t)}))}))}getZoom(){return new Promise(((t,e)=>{this._navigator.stateService.getZoom().subscribe((e=>{t(e)}),(t=>{e(t)}))}))}hasCustomCameraControls(t){return this._customCameraControls.has(t)}hasCustomRenderer(t){return this._customRenderer.has(t)}moveDir(t){const e=this.isNavigable?this._navigator.moveDir$(t):Yt(new Error("Calling moveDir is not supported when viewer is not navigable."));return new Promise(((t,i)=>{e.subscribe((e=>{t(e)}),(t=>{i(t)}))}))}moveTo(t){const e=this.isNavigable?this._navigator.moveTo$(t):Yt(new Error("Calling moveTo is not supported when viewer is not navigable."));return new Promise(((t,i)=>{e.subscribe((e=>{t(e)}),(t=>{i(t)}))}))}off(t,e){super.off(t,e)}on(t,e){super.on(t,e)}project(t){return new Promise(((e,i)=>{this._observer.project$(t).subscribe((t=>{e(t)}),(t=>{i(t)}))}))}projectFromBasic(t){return new Promise(((e,i)=>{this._observer.projectBasic$(t).subscribe((t=>{e(t)}),(t=>{i(t)}))}))}remove(){this._customRenderer.dispose(this),this._customCameraControls.dispose(this),this._observer.dispose(),this._componentController.remove(),this._navigator.dispose(),this._container.remove();const t="remove",e={target:this,type:t};this.fire(t,e)}removeCustomRenderer(t){this._customRenderer.remove(t,this)}resize(){this._container.renderService.resize$.next()}setCameraControls(t){const e=zS(t);e===tg.Traversing?this._navigator.stateService.traverse():e===tg.Earth?this._navigator.stateService.earth():e===tg.Custom?this._navigator.stateService.custom():console.warn(`Unsupported camera control transition (${t})`)}setCenter(t){this._navigator.stateService.setCenter(t)}setFieldOfView(t){this._container.renderService.renderCamera$.pipe(He()).subscribe((e=>{const i=e.fovToZoom(t);this._navigator.stateService.setZoom(i)}))}setFilter(t){return new Promise(((e,i)=>{this._navigator.setFilter$(t).subscribe((()=>{e(void 0)}),(t=>{i(t)}))}))}setRenderMode(t){this._container.renderService.renderMode$.next(t)}setTransitionMode(t){this._navigator.stateService.setTransitionMode(t)}setAccessToken(t){const e=this.isNavigable?this._navigator.setAccessToken$(t):Yt(new Error("Calling setAccessToken is not supported when viewer is not navigable."));return new Promise(((t,i)=>{e.subscribe((()=>{t(void 0)}),(t=>{i(t)}))}))}setZoom(t){this._navigator.stateService.setZoom(t)}triggerRerender(){this._container.glRenderer.triggerRerender()}unproject(t){return new Promise(((e,i)=>{this._observer.unproject$(t).subscribe((t=>{e(t)}),(t=>{i(t)}))}))}unprojectToBasic(t){return new Promise(((e,i)=>{this._observer.unprojectBasic$(t).subscribe((t=>{e(t)}),(t=>{i(t)}))}))}}function NS(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}ap.register(Ep),op.register(Ep),Tp.registerCover(Cm),Tp.register(Im),Tp.register(km),Tp.register(Rm),Tp.register(Lm),Tp.register(rg),Tp.register(ug),Tp.register(pg),Tp.register(Cg),Tp.register(Ag),Tp.register(Rg),Tp.register(Lg),Tp.register(a_),Tp.register(cv),Tp.register(uv),Tp.register(hv),Tp.register(pv);var US=function(t,e,i){void 0===i&&(i={});var n=NS(t),r=NS(e),a=m(r[1]-n[1]),o=m(r[0]-n[0]),s=m(n[1]),l=m(r[1]),c=Math.pow(Math.sin(a/2),2)+Math.pow(Math.sin(o/2),2)*Math.cos(s)*Math.cos(l);return d(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),i.units)},$S=i(254),VS=i.n($S);function jS(t,e,i){if(void 0===i&&(i={}),!0===i.final)return function(t,e){var i=jS(e,t);return i=(i+180)%360}(t,e);var n=NS(t),r=NS(e),a=m(n[0]),o=m(r[0]),s=m(n[1]),l=m(r[1]),c=Math.sin(o-a)*Math.cos(l),u=Math.cos(s)*Math.sin(l)-Math.sin(s)*Math.cos(l)*Math.cos(o-a);return f(Math.atan2(c,u))}var qS=function(){function t(e,i){n(this,t),this.app=i,this.dateSelect=null,this.loading=!0,this.currentCoords=null,this.defaultMarker=null,this.markerComponent=null,this.sequence=null,this.container=document.getElementById(e),this.mly=null,this.mapillaryToken="MLY|4690399437648324|de87555bb6015affa20c3df794ebab15",this.markerStyle={ballColor:"white",ballOpacity:.5,color:"#feb70d",opacity:.55,interactive:!1,radius:2},this.createStreetView(this)}return a(t,[{key:"createStreetView",value:function(t){var e=document.createElement("article"),i=document.createElement("div"),n=document.createElement("div"),r=document.createElement("label"),a=document.createElement("select"),o=document.createElement("section"),s=document.createElement("article"),l=document.createElement("article");i.innerHTML='<i class="fas fa-street-view"></i> Street View',i.className="streetview-title",a.id="streetview-date",a.addEventListener("change",(function(e){t.changingImageDate(e,t)})),t.dateSelect=a,r.innerHTML='<i class="far fa-calendar-alt"></i> Date',r.setAttribute("for","streetview-date"),e.className="streetview-header",n.appendChild(r),n.className="streetview-date",n.appendChild(a),e.appendChild(i),e.appendChild(n),l.id="mly",s.innerHTML='\n        <article>\n          <div>\n            <div class="loader">\n              <div class="loader__bar"></div>\n              <div class="loader__bar"></div>\n              <div class="loader__bar"></div>\n              <div class="loader__bar"></div>\n              <div class="loader__bar"></div>\n              <div class="loader__ball"></div>\n            </div>\n            <p>LOADING</p>\n          </div>\n        </article>\n        ',t.loading?s.className="streetview-loader active":s.className="streetview-loader",o.className="streetview-imagery",o.appendChild(s),o.appendChild(l),t.container.appendChild(e),t.container.appendChild(o),t.getImageKey(t)}},{key:"setCameraIcon",value:function(t){t.app.map.map.getSource("mapillary").setData({type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[t.app.svCoords.lng,t.app.svCoords.lat]},properties:{bearing:t.app.svBearing-90}}]})}},{key:"loadImagery",value:function(t){t.setLoading(t,!1);try{t.mly=new FS({accessToken:t.mapillaryToken,component:{marker:!0,bearing:!1,cover:!0,attribution:!1,sequence:!1,cache:!0,direction:!0},container:"mly",imageId:t.app.currentImageKey.properties.id}),t.mly.deactivateCover(),t.mly.on("nodechanged",(function(e){t.app.svCoords=e.latLon})),t.mly.on("bearingchanged",(function(e){t.app.svBearing=e})),t.defaultMarker=new Yw("default-id",{lat:t.app.coords[1],lng:t.app.coords[0]},t.markerStyle),t.markerComponent=t.mly.getComponent("marker"),t.markerComponent.add([t.defaultMarker])}catch(e){console.log(e)}t.app.map.map.getSource("mapillary").setData({type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[t.app.svCoords[0],t.app.svCoords[1]]},properties:{bearing:t.app.svBearing-90}}]})}},{key:"removeImagery",value:function(t){var e=document.getElementById("mly");e.removeChild(e.childNodes[1]),e.removeChild(e.childNodes[0]),t.setLoading(t,!0)}},{key:"getImageKey",value:function(t){var e=VS()(t.app.imageKeys,(function(e){return US(e.geometry,t.app.centroid)}));if(t.app.currentImageKey){var i=e.filter((function(e){return e.properties.sequence_id===t.app.currentImageKey.properties.sequence_id}));i.length>0?t.app.currentImageKey=i[0]:t.app.currentImageKey=e.slice(0,20).sort((function(t,e){return t.properties.captured_at<e.properties.captured_at}))[0]}else t.app.currentImageKey=e.slice(0,20).sort((function(t,e){return t.properties.captured_at<e.properties.captured_at}))[0];var n=l()(e,"properties.sequence_id").map((function(e){return{sequence_id:e.properties.sequence_id,image_id:e.properties.id,captured_at:e.properties.captured_at,readable_ts:t.getReadableDate(e.properties.captured_at)}})).sort((function(t,e){return e.captured_at>t.captured_at}));t.sequence=l()(n,"readable_ts");var r=e.sort((function(e,i){return t.buildDate(e.properties.captured_at)-t.buildDate(i.properties.captured_at)}));t.app.imageKeys=r,e.length?(t.app.svCoords=t.app.currentImageKey.geometry.coordinates,t.setCameraIcon(t),t.loadDateOptions(t),t.loadImagery(t)):t.setLoading(t,!1)}},{key:"loadDateOptions",value:function(t){t.sequence.forEach((function(e,i){var n=document.createElement("option");t.app.currentImageKey.properties.captured_at==e.captured_at&&(n.selected=!0),n.label=e.readable_ts,n.value=e.sequence_id,t.dateSelect.appendChild(n)}))}},{key:"getReadableDate",value:function(t){var e=new Date(t);return"".concat(e.toLocaleString("default",{month:"short"})," ").concat(e.getDate(),", ").concat(e.getFullYear())}},{key:"buildDate",value:function(t){return new Date(t)}},{key:"setLoading",value:function(t,e){e?(document.querySelector(".streetview-loader").className="streetview-loader active",t.loading=!0):(document.querySelector(".streetview-loader.active").className="streetview-loader",t.loading=!1)}},{key:"changingImageDate",value:function(t,e){e.setLoading(e,!0);var i=VS()(e.app.imageKeys,(function(t){return US(t.geometry,e.app.centroid)})).filter((function(e){return e.properties.sequence_id==t.target.value}));e.mly.moveTo(i[0].properties.id).then((function(t){var i=t._core.geometry.coordinates?t._core.geometry.coordinates:[t._core.geometry.lng,t._core.geometry.lat],n=e.app.centroid;e.setBearing(e,t,e.mly,i,n)})),e.app.svCoords=e.app.currentImageKey.geometry.coordinates,e.setCameraIcon(e),e.setLoading(e,!1)}},{key:"wrap",value:function(t,e,i){for(var n=i-e;t>i||t<e;)t>i?t-=n:t<e&&(t+=n);return t}},{key:"bearingToBasic",value:function(t,e,i){var n=(e-i)/360+.5;return t.wrap(n,0,1)}},{key:"setBearing",value:function(t,e,i,n,r){if(e.fullPano){var a=e.computedCA,o=jS(n,r),s=[t.bearingToBasic(t,o,a),.45];i.setCenter(s)}}}]),t}(),GS=function(){function t(e){n(this,t),this.app=e,this.calculator=null,this.filters=null,this.data=null,this.panels=[],this.dashLast="city",this.streetview=null,this.formatter=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"})}return a(t,[{key:"closePanel",value:function(t,e){var i=t.target.parentNode.parentNode.className;i=i.split(" "),t.target.parentNode.parentNode.className=i[0];try{for(;t.target.parentNode.firstChild;)t.target.parentNode.removeChild(t.target.parentNode.firstChild)}catch(n){}e.panels.pop()}},{key:"buildPropertyInfo",value:function(t){var e=null;return null!=t.app.propertyData.saledate&&(e=new Date(t.app.propertyData.saledate)),"\n        <h2>".concat(t.app.propertyData.propaddr,'</h2>\n        <section id="streetview"></section>\n        ').concat(t.checkSpecialCase(t),'\n        <section class="group">\n        <span class="header">KEY DATA<sup>*</sup></span>\n        <p><strong>Owner:</strong> ').concat(t.app.propertyData.taxpayer1,"</p>\n        <p><strong>Owner's Address:</strong> ").concat(t.app.propertyData.taxpaddr,"</p>\n        <p><strong>Zoning:</strong> ").concat(t.app.propertyData.zoning,"</p>\n        <p><strong>Council District:</strong> ").concat(t.app.propertyData.council,'</p>\n        </section>\n        <section class="group">\n        <span class="header">ADDITIONAL DATA</span>\n        ').concat(null!=e?"<p><strong>Last Sale Date:</strong> ".concat(e.getMonth()+1,"/").concat(e.getDate(),"/").concat(e.getFullYear(),"</p><p><strong>Last Sale Price:</strong> ").concat(t.formatter.format(t.app.propertyData.saleprice),"</p>"):"","\n        <p><strong>Parcel Number:</strong> ").concat(t.app.propertyData.parcelno,"</p>\n        <p><strong>Taxable Status:</strong> ").concat(t.app.propertyData.taxstatus,"</p>\n        <p><strong>Total Acreage:</strong> ").concat(t.app.propertyData.totalacreage,"</p>\n        <p><strong>Principal Residence Exemption:</strong> ").concat(t.app.propertyData.pre,"</p>\n        <p><strong>Frontage:</strong> ").concat(t.app.propertyData.frontage,"</p>\n        <p><strong>Depth:</strong> ").concat(t.app.propertyData.depth,"</p>\n        <p><strong>Ward:</strong> ").concat(t.app.propertyData.ward,"</p>\n        </section>\n        <small><sup>*</sup>City Owned Property data is sourced from the City of Detroit\u2019s Office of the Assessor. If you find any discrepancies please visit the Coleman A. Young Municipal Center at 2 Woodward Avenue - Suite 804 Detroit, Michigan 48226 or call (313) 224-3035</small>\n        ")}},{key:"createErrorMsg",value:function(t){var e=document.querySelector(".panel .panel-box"),i=document.createElement("button");i.innerText="x",i.className="close-section-btn",i.addEventListener("click",(function(e){e.preventDefault(),t.closePanel(e)})),e.innerHTML='\n        <svg xmlns="http://www.w3.org/2000/svg" width="100" height="70" viewBox="0 0 100 68">\n        <g id="large">\n            <path fill="none" stroke="#F44" d="M55.8 38.5l6.2-1.2c0-1.8-.1-3.5-.4-5.3l-6.3-.2c-.5-2-1.2-4-2.1-6l4.8-4c-.9-1.6-1.9-3-3-4.4l-5.6 3c-1.3-1.6-3-3-4.7-4.1l2-6A30 30 0 0 0 42 8l-3.3 5.4c-2-.7-4.2-1-6.2-1.2L31.3 6c-1.8 0-3.5.1-5.3.4l-.2 6.3c-2 .5-4 1.2-6 2.1l-4-4.8c-1.6.9-3 1.9-4.4 3l3 5.6c-1.6 1.3-3 3-4.1 4.7l-6-2A32.5 32.5 0 0 0 2 26l5.4 3.3c-.7 2-1 4.2-1.2 6.2L0 36.7c0 1.8.1 3.5.4 5.3l6.3.2c.5 2 1.2 4 2.1 6l-4.8 4c.9 1.6 1.9 3 3 4.4l5.6-3c1.4 1.6 3 3 4.7 4.1l-2 6A30.5 30.5 0 0 0 20 66l3.4-5.4c2 .7 4 1 6.1 1.2l1.2 6.2c1.8 0 3.5-.1 5.3-.4l.2-6.3c2-.5 4-1.2 6-2.1l4 4.8c1.6-.9 3-1.9 4.4-3l-3-5.6c1.6-1.3 3-3 4.1-4.7l6 2A32 32 0 0 0 60 48l-5.4-3.3c.7-2 1-4.2 1.2-6.2zm-13.5 4a12.5 12.5 0 1 1-22.6-11 12.5 12.5 0 0 1 22.6 11z"/>\n            <animateTransform attributeName="transform" begin="0s" dur="3s" from="0 31 37" repeatCount="indefinite" to="360 31 37" type="rotate"/>\n        </g>\n        <g id="small">\n            <path fill="none" stroke="#F44" d="M93 19.3l6-3c-.4-1.6-1-3.2-1.7-4.8L90.8 13c-.9-1.4-2-2.7-3.4-3.8l2.1-6.3A21.8 21.8 0 0 0 85 .7l-3.6 5.5c-1.7-.4-3.4-.5-5.1-.3l-3-5.9c-1.6.4-3.2 1-4.7 1.7L70 8c-1.5 1-2.8 2-3.9 3.5L60 9.4a20.6 20.6 0 0 0-2.2 4.6l5.5 3.6a15 15 0 0 0-.3 5.1l-5.9 3c.4 1.6 1 3.2 1.7 4.7L65 29c1 1.5 2.1 2.8 3.5 3.9l-2.1 6.3a21 21 0 0 0 4.5 2.2l3.6-5.6c1.7.4 3.5.5 5.2.3l2.9 5.9c1.6-.4 3.2-1 4.8-1.7L86 34c1.4-1 2.7-2.1 3.8-3.5l6.3 2.1a21.5 21.5 0 0 0 2.2-4.5l-5.6-3.6c.4-1.7.5-3.5.3-5.1zM84.5 24a7 7 0 1 1-12.8-6.2 7 7 0 0 1 12.8 6.2z"/>\n            <animateTransform attributeName="transform" begin="0s" dur="2s" from="0 78 21" repeatCount="indefinite" to="-360 78 21" type="rotate"/>\n        </g>\n        </svg>\n        <h3>No Information found.</h3>\n        ',e.prepend(i),document.querySelector("#app .panel").className="panel active"}},{key:"buildCityData",value:function(t){return console.log(t.app.cityData),'\n        <h2>City of Detroit</h2>\n        <img alt="Photo of Detroit" src="https://detroitmi.gov/sites/detroitmi.localhost/files/styles/de2e/public/2018-11/detroit1.jpg">\n        <section class="group">\n        <span class="header">DEMOGRAPHICS</span>\n        <p><strong>Population:</strong> '.concat(t.app.cityData[0].data[1][0].replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"),'</p>\n        </section>\n        <section class="group">\n        <span class="header">REAL ESTATE</span>\n        <p><strong>DLBA Properties:</strong> ').concat(t.app.cityData[2].data.count.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"),"</p>\n        <p><strong>Open BSEED Permits:</strong> ").concat(t.app.cityData[1].data.count.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"),'</p>\n        </section>\n        <section class="group">\n        <span class="header">INFRASTRUCTURE</span>\n        <p><strong>Police Stations:</strong> ').concat(t.app.cityData[3].data.count,"</p>\n        <p><strong>Fire Stations:</strong> ").concat(t.app.cityData[4].data.count,"</p>\n        <p><strong>Active Parks:</strong> ").concat(t.app.cityData[5].data.count,"</p>\n        </section>\n        ")}},{key:"buildInfo",value:function(t){return'\n        <h2>Map Information</h2>\n        <section class="group">\n        <span class="header">DATA</span>\n        <p>Opportunity Map data is sourced from the following: Detroit Open Data Portal, Detroit Land Bank Authority (DLBA), City of Detroit Assessors Office, Housing and Revitalization Department, Planning and Development Department, Buildings and Safety Engineering and Environment Department and Department of Transportation. In a few instances, DLBA data may be more up-to-date than the City of Detroit Assessors Office. For questions, please visit the <a href="https://detroitmi.gov/departments/office-chief-financial-officer/ocfo-divisions/office-assessor" target="_blank">City of Detroit Assessors Office.</a></p>\n        </section>\n        <section class="group">\n        <span class="header">GLOSSARY</span>\n        <p><strong>PUBLIC ASSETS</strong></p>\n        <p>Detroit Land Bank Authority (DLBA) and the City of Detroit (P&DD) owned properties identified as available for sale. However, please verify with the Detroit Building Authority and/or the DLBA for the most accurate information.</p>\n        <p><strong>PUBLIC LAND</strong></p>\n        <p>Detroit Land Bank Authority (DLBA) and the City of Detroit (P&DD) owned vacant parcels identified as available for sale. However, please verify with the Detroit Building Authority and/or the DLBA for the most accurate information.</p>\n        <p><strong>PUBLIC STRUCTURES</strong></p>\n        <p>Detroit Land Bank Authority (DLBA) and the City of Detroit (P&DD) owned buildings identified as available for sale. However, please verify with the Detroit Building Authority and/or the DLBA for the most accurate information.</p>\n        <p><strong>MARIJUANA LEGACY LAND</strong></p>\n        <p>The City of Detroit (P&DD) owned vacant parcels identified and specifically set aside as available for sale to certified Detroit Legacy Applicants for specific uses in the cannabis industry. Please refer to <a href="https://detroitmeansbusiness.org/homegrown/" target="_blank">Detroit Means Business</a> for more information.</p>\n        <p><strong>MARIJUANA LEGACY STRUCTURES</strong></p>\n        <p>The City of Detroit (P&DD) owned buildings identified and specifically set aside as available for sale to certified Detroit Legacy Applicants for specific uses in the cannabis industry. Please refer to <a href="https://detroitmeansbusiness.org/homegrown/" target="_blank">Detroit Means Business</a> for more information.</p>\n        <p><strong>PUBLIC SERVICE ASSETS</strong></p>\n        <ul>\n            <li>Fire Stations</li>\n            <li>Police Stations</li>\n            <li>Active Parks</li>\n        </ul>\n        <p><strong>PLANNING & HOUSING</strong></p>\n        <p>There are several planning areas for different purposes city wide, explainations are below:</p>\n        <ul>\n        <li>Targeted Multifamily Housing Areas \u2013 identify areas of the city with stronger housing markets and active commercial corridors. Developers of both market-rate and affordable housing, are encouraged to focus in these areas. To understand more, please check out the Housing & Revitalization Department <a href="https://detroitmi.gov/departments/housing-and-revitalization-department/developers-and-contractors" target="_blank">Developers Page.</a></li>\n        <li>Strategic Neighborhood Fund Investment Areas are areas that can access certain funding sources drawn from philanthropic contributions and public subsidies designed to improve Detroit neighborhoods.</li>\n        <li>Opportunity Zones are areas that can access certain federally funded incentives and economic tools to spur development.</li>\n        </ul>\n        <p><strong>ZONING</strong></p>\n        <p><strong>Residential Zoning</strong></p>\n        <ul>\n        <li>R1 Single-Family Residential District</li>\n        <li>R2 Two-Family Residential District</li>\n        <li>R3 Low Density Residential District</li>\n        <li>R4 Thoroughfare Residential District</li>\n        <li>R5 Medium Density Residential District</li>\n        <li>R6 High Density Residential District</li>\n        </ul>\n        <p><strong>Business / Commercial Zoning</strong></p>\n        <ul>\n        <li>B1 Restricted Business District</li>\n        <li>B2 Local Business and Residential District</li>\n        <li>B3 Shopping District</li>\n        <li>B4 General Business District</li>\n        <li>B5 Major Business District</li>\n        <li>B6 General Services District</li>\n        </ul>\n        <p><strong>Industrial District Zoning</strong></p>\n        <ul>\n        <li>M1 Limited Industrial District</li>\n        <li>M2 Restricted Industrial District</li>\n        <li>M3 General Industrial District</li>\n        <li>M4 Intensive Industrial District</li>\n        <li>M5 Special Industrial District</li>\n        </ul>\n        <p><strong>Special Districts</strong></p>\n        <ul>\n        <li>PD Planned Development District</li>\n        <li>P1 Open Parking District</li>\n        <li>PC Public Center District</li>\n        <li>PCA Public Center Adjacent District (Restricted Central business District)</li>\n        <li>TM Transitional-Industrial District</li>\n        <li>PR Parks and Recreation District</li>\n        <li>W1 Waterfront-Industrial District</li>\n        <li>SD1 Special Development District, Small-Scale, Mixed-Use</li>\n        <li>SD2 Special Development District, Mixed-Use</li>\n        <li>SD3 Special Development District, Technology and Research</li>\n        <li>SD4 Special Development District, Riverfront mixed use</li>\n        <li>SD5 Special Development District, Casinos</li>\n        <li>TM</li>\n        <li>W5</li>\n        </ul>\n        <p><strong>PUBLIC TRANSPORTATION</strong></p>\n        <ul>\n        <li>DDOT Buses - Detroit Department of Transportation Bus Routes</li>\n        <li>SMART Buses - Suburban Mobility Authority for Regional Transportation (SMART) is Southeast Michigan\'s only regional bus system</li>\n        <li>QLine - 3.3 mile streetcar that rides along the Woodward Corridor</li>     \n        <lip>People Mover - Elevated Train that routed throughout Downtown Detroit</li>\n        <li>MoGo Bike Sharing - Bike rentals across the greater downtown</li>\n        </ul>\n        </section>\n        '}},{key:"buildFilters",value:function(t){return'\n        <h2>Map Data Layers</h2>\n        <article id="filter-box">\n        </article>\n        '}},{key:"buildCalculator",value:function(t){return'\n        <section class="calculator">\n          <h2>Income Calculator</h2>\n          <article id="calc-box"></article>\n        </section>\n        '}},{key:"checkSpecialCase",value:function(t){var e=null;switch(t.app.specialProperty){case"city-land":e='<div class="buy-btn"><a href="https://detroitmi.gov/properties" target="_blank">Inquire to buy this land</a></div>';break;case"dlba-land":e='<div class="buy-btn"><a href="https://buildingdetroit.org/development-projects/" target="_blank">Inquire to buy this land</a></div>';break;case"city-structures":e='<div class="buy-btn"><a href="https://detroitmi.gov/properties" target="_blank">Inquire to buy this Property</a></div>';break;case"dlba-structures":e='<div class="buy-btn"><a href="https://buildingdetroit.org/development-projects/" target="_blank">Inquire to buy this Property</a></div>';break;default:e=""}return e}},{key:"createImagery",value:function(t){t.streetview=new qS("streetview",t.app)}},{key:"createPanel",value:function(t,e){var i=document.querySelector(".panel .panel-box"),n=document.createElement("button");switch(n.innerText="x",n.className="close-section-btn",n.addEventListener("click",(function(e){e.preventDefault(),t.closePanel(e,t)})),t.panels.includes(e)||t.panels.push(e),t.panels[t.panels.length-1]){case"dash":"city"==t.dashLast?i.innerHTML="".concat(t.buildCityData(t)):(i.innerHTML="".concat(t.buildPropertyInfo(t)),t.createImagery(t));break;case"filter":i.innerHTML="".concat(t.buildFilters(t)),t.filters=new b("filter-box",t.app);break;case"info":i.innerHTML="".concat(t.buildInfo(t))}i.prepend(n),document.querySelector("#app .panel").className="panel active",document.querySelector("#initial-loader-overlay").className=""}}]),t}(),HS=function(){function t(e,i){n(this,t),this.form=null,this._controller=i,this.init(document.getElementById(e),this)}return a(t,[{key:"init",value:function(t,e){var i=this,n=document.createElement("form"),r=document.createElement("label"),a=document.createElement("input"),o=(document.createElement("ul"),document.createElement("datalist")),s=document.createElement("i");n.addEventListener("submit",(function(t){i.submit(t,e)})),s.className="fas fa-map-marker-alt",r.innerText="Find Property:",r.setAttribute("for","geocoder-input"),a.type="text",a.setAttribute("list","addresses-list"),a.placeholder="Enter address",a.setAttribute("id","geocoder-input"),a.setAttribute("autocomplete","off"),a.addEventListener("keyup",(function(t){i.inputChange(t,e)})),o.setAttribute("id","addresses-list"),n.appendChild(r),n.appendChild(a),n.appendChild(s),n.appendChild(o),t.appendChild(n),this.form=n}},{key:"supplementGeocoder",value:function(t,e,i){var n=t.split(",");n=(n=n[0]).split(" ");var r="",a=n.length;n.forEach((function(t,e){r+=t,e<a&&e+1!==a&&(r+="+")}));var o="https://opengis.detroitmi.gov/opengis/rest/services/BaseUnits/BaseUnitGeocoder/GeocodeServer/findAddressCandidates?Address=&Address2=&Address3=&Neighborhood=&City=&Subregion=&Region=&Postal=&PostalExt=&CountryCode=&SingleLine=".concat(r,"&outFields=*&maxLocations=4&matchOutOfRange=true&langCode=&locationType=&sourceCountry=&category=&location=&distance=&searchExtent=&outSR=4326&magicKey=&f=json");try{fetch(o).then((function(t){return t.json()})).then((function(t){if("suggestions"===i)t.candidates.forEach((function(t){var i=document.createElement("option");""!=t.attributes.parcel_id&&(i.value=t.address,i.setAttribute("data-parsel",t.attributes.parcel_id)),i.onclick=function(t){e.selectSuggestion(t,e)},e.form.childNodes[3].appendChild(i)}));else{var n="https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/City_of_Detroit_Boundary/FeatureServer/0/query?where=&objectIds=&time=&geometry=".concat(t.candidates[0].location.x,"%2C+").concat(t.candidates[0].location.y,"&geometryType=esriGeometryPoint&inSR=4326&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=4326&returnGeometry=true&returnCentroid=false&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnDistinctValues=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=geojson&token=");try{fetch(n).then((function(t){return t.json()})).then((function(i){if(i.features.length){e._controller.panel.createErrorMsg(e._controller.panel);var n=null;t.candidates.forEach((function(t){""!=t.attributes.parcel_id&&e._controller.checkParcelValid(t.attributes.parcel_id)&&(n=t)})),null==n?t.candidates[0].location:null,e._controller.coords=[n.location.x,n.location.y],e._controller.parcel=n.attributes.parcel_id,e._controller.centroid=p([n.location.x,n.location.y]),e._controller.map.map.flyTo({center:[n.location.x,n.location.y],zoom:18,essential:!0}),e._controller.checkSpecialProperties(n.attributes.parcel_id,e._controller),e._controller.map.map.setFilter("parcels-highlight",["==","parcelno",n.attributes.parcel_id]),e.form.childNodes[1].value="",document.getElementById("initial-loader-overlay").className="active"}else e._controller.panel.createErrorMsg(e._controller.panel)}))}catch(r){e._controller.panel.createErrorMsg(e._controller.panel)}}}))}catch(s){e._controller.panel.createErrorMsg(e._controller.panel)}}},{key:"selectSuggestion",value:function(t,e){var i=null;"no-parcel"===(i="SPAN"===t.target.tagName?t.target.parentNode:t.target).attributes[0].value?(e.clearSuggestions(e),e.supplementGeocoder(i.innerText,e,"submit")):e.supplementGeocoder(i.innerText,e,"submit")}},{key:"inputChange",value:function(t,e){switch(t.key){case"Enter":""!=t.target.value&&void 0!=t.target.value&&e.supplementGeocoder(t.target.value,e,"submit");break;case"ArrowDown":case"ArrowUp":case"ArrowRight":case"ArrowLeft":break;case void 0:""!=t.target.value&&void 0!=t.target.value&&e.supplementGeocoder(t.target.value,e,"submit");break;default:e.clearSuggestions(e),e.supplementGeocoder(t.target.value,e,"suggestions")}}},{key:"clearSuggestions",value:function(t){for(;t.form.childNodes[3].firstChild;)t.form.childNodes[3].removeChild(t.form.childNodes[3].firstChild)}},{key:"submit",value:function(t,e){t.preventDefault(),e.supplementGeocoder(t.target[0].value,e,"submit")}}]),t}(),WS=function(){function t(){n(this,t),this.svCoords=null,this.svBearing=null,this.coord=null,this.imageKeys=null,this.centroid=null,this.currentImageKey=null,this.parcel=null,this.propertyData=null,this.point=null,this.map=new x("map",this),this.specialProperty=null,this.cityData=null,this.filters=[],this.zoning={r:[],b:[],m:[],s:[]},this.boundary=null,this.userControls=document.createElement("form"),this.panel=new GS(this),this.geocoder=new HS("geocoder",this),this.initialLoad(this)}return a(t,[{key:"initialLoad",value:function(t){t.getCityData(t),document.getElementById("close-welcome").addEventListener("click",(function(){document.getElementById("welcome-panel").className=""}));var e=document.createElement("button"),i=document.createElement("button"),n=document.createElement("button");e.innerHTML='<i class="fas fa-tachometer-alt"></i> <span>Dashboard</span>',e.addEventListener("click",(function(e){e.preventDefault(),t.panel.createPanel(t.panel,"dash")})),i.innerHTML='<i class="fas fa-layer-group"></i> <span>Data Layers</span>',i.addEventListener("click",(function(e){e.preventDefault(),t.panel.createPanel(t.panel,"filter")})),n.innerHTML='<i class="fas fa-info-circle"></i> <span>Info</span>',n.addEventListener("click",(function(e){e.preventDefault(),t.panel.createPanel(t.panel,"info")})),t.userControls.appendChild(e),t.userControls.appendChild(i),t.userControls.appendChild(n),document.getElementById("user-controls").appendChild(t.userControls)}},{key:"getParcelData",value:function(t){fetch("https://apis.detroitmi.gov/assessments/parcel/".concat(t.parcel)).then((function(t){return t.json()})).then((function(e){t.propertyData=e,t.panel.dashLast="parcel",t.panel.createPanel(t.panel,"dash")})).catch((function(t){}))}},{key:"getCityData",value:function(t){var e=new Promise((function(t,e){return fetch("https://api.census.gov/data/2019/pep/population?get=POP&in=state:26&for=place:22000").then((function(t){return t.json()})).then((function(e){t({id:"population",data:e})})).catch((function(t){}))})),i=new Promise((function(t,e){return fetch("https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/BuildingPermits/FeatureServer/0/query?where=1%3D1&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnGeometry=true&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=true&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=json").then((function(t){return t.json()})).then((function(e){t({id:"permits",data:e})})).catch((function(t){}))})),n=new Promise((function(t,e){return fetch("https://opengis.detroitmi.gov/opengis/rest/services/DLBA/DLBA/MapServer/10/query?where=1%3D1&text=&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&distance=&units=esriSRUnit_Foot&relationParam=&outFields=*&returnGeometry=true&returnTrueCurves=false&maxAllowableOffset=&geometryPrecision=&outSR=&havingClause=&returnIdsOnly=false&returnCountOnly=true&orderByFields=&groupByFieldsForStatistics=&outStatistics=&returnZ=false&returnM=false&gdbVersion=&historicMoment=&returnDistinctValues=false&resultOffset=&resultRecordCount=&returnExtentOnly=false&datumTransformation=&parameterValues=&rangeValues=&quantizationParameters=&featureEncoding=esriDefault&f=pjson").then((function(t){return t.json()})).then((function(e){t({id:"dlba-properties",data:e})})).catch((function(t){}))})),r=new Promise((function(t,e){return fetch("https://services2.arcgis.com/qvkbeam7Wirps6zC/ArcGIS/rest/services/Precinct_Buildings/FeatureServer/0/query?where=1%3D1&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=&returnGeometry=true&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=true&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pjson&token=").then((function(t){return t.json()})).then((function(e){t({id:"police",data:e})})).catch((function(t){}))})),a=new Promise((function(t,e){return fetch("https://services2.arcgis.com/qvkbeam7Wirps6zC/arcgis/rest/services/Firehouse_Locations/FeatureServer/0/query?where=1%3D1&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=&returnGeometry=true&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=true&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pjson&token=").then((function(t){return t.json()})).then((function(e){t({id:"fire",data:e})})).catch((function(t){}))})),o=new Promise((function(t,e){return fetch("https://services2.arcgis.com/qvkbeam7Wirps6zC/ArcGIS/rest/services/Parks_Marijuana/FeatureServer/0/query?where=1%3D1&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=&returnGeometry=true&returnCentroid=false&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=true&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pjson&token=").then((function(t){return t.json()})).then((function(e){t({id:"parks",data:e})})).catch((function(t){}))}));Promise.all([e,i,n,r,a,o]).then((function(e){t.cityData=e})).catch((function(t){}))}},{key:"checkSpecialProperties",value:function(t,e){var i=new Promise((function(e,i){var n="https://services2.arcgis.com/qvkbeam7Wirps6zC/ArcGIS/rest/services/DevelopmentMap/FeatureServer/0/query?where=parcel_id+%3D+%27".concat(t,"%27&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnGeometry=true&returnCentroid=false&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pjson&token=");return fetch(n).then((function(t){return t.json()})).then((function(t){e({id:"city-structures",data:t})})).catch((function(t){}))})),n=new Promise((function(e,i){var n="https://services2.arcgis.com/qvkbeam7Wirps6zC/ArcGIS/rest/services/DevelopmentMap/FeatureServer/1/query?where=parcel_id+%3D+%27".concat(t,"%27&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnGeometry=true&returnCentroid=false&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pjson&token=");return fetch(n).then((function(t){return t.json()})).then((function(t){e({id:"city-land",data:t})})).catch((function(t){}))})),r=new Promise((function(e,i){var n="https://services2.arcgis.com/qvkbeam7Wirps6zC/ArcGIS/rest/services/DevelopmentMap/FeatureServer/2/query?where=parcel_id+%3D+%27".concat(t,"%27&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnGeometry=true&returnCentroid=false&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pjson&token=");return fetch(n).then((function(t){return t.json()})).then((function(t){e({id:"city-structures",data:t})})).catch((function(t){}))})),a=new Promise((function(e,i){var n="https://services2.arcgis.com/qvkbeam7Wirps6zC/ArcGIS/rest/services/DevelopmentMap/FeatureServer/3/query?where=parcel_id+%3D+%27".concat(t,"%27&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnGeometry=true&returnCentroid=false&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pjson&token=");return fetch(n).then((function(t){return t.json()})).then((function(t){e({id:"city-land",data:t})})).catch((function(t){}))}));Promise.all([i,n,r,a]).then((function(t){t[0].data.features.length?e.specialProperty="city-structures":t[1].data.features.length?e.specialProperty="city-land":t[2].data.features.length?e.specialProperty="dlba-structures":t[3].data.features.length?e.specialProperty="dlba-land":e.specialProperty=null,e.getParcelData(e)})).catch((function(t){}))}},{key:"checkParcelValid",value:function(t){return/\d/.test(t)}}]),t}();const ZS=Object.prototype.toString;function YS(t){switch(ZS.call(t)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return aE(t,Error)}}function XS(t,e){return ZS.call(t)===`[object ${e}]`}function KS(t){return XS(t,"ErrorEvent")}function JS(t){return XS(t,"DOMError")}function QS(t){return XS(t,"String")}function tE(t){return null===t||"object"!==typeof t&&"function"!==typeof t}function eE(t){return XS(t,"Object")}function iE(t){return"undefined"!==typeof Event&&aE(t,Event)}function nE(t){return Boolean(t&&t.then&&"function"===typeof t.then)}function rE(t){return"number"===typeof t&&t!==t}function aE(t,e){try{return t instanceof e}catch(i){return!1}}var oE=i(235);const sE=(0,oE.Rf)();function lE(t,e={}){try{let i=t;const n=5,r=[];let a=0,o=0;const s=" > ",l=s.length;let c;const u=Array.isArray(e)?e:e.keyAttrs,h=!Array.isArray(e)&&e.maxStringLength||80;for(;i&&a++<n&&(c=cE(i,u),!("html"===c||a>1&&o+r.length*l+c.length>=h));)r.push(c),o+=c.length,i=i.parentNode;return r.reverse().join(s)}catch(i){return"<unknown>"}}function cE(t,e){const i=t,n=[];let r,a,o,s,l;if(!i||!i.tagName)return"";n.push(i.tagName.toLowerCase());const c=e&&e.length?e.filter((t=>i.getAttribute(t))).map((t=>[t,i.getAttribute(t)])):null;if(c&&c.length)c.forEach((t=>{n.push(`[${t[0]}="${t[1]}"]`)}));else if(i.id&&n.push(`#${i.id}`),r=i.className,r&&QS(r))for(a=r.split(/\s+/),l=0;l<a.length;l++)n.push(`.${a[l]}`);const u=["aria-label","type","name","title","alt"];for(l=0;l<u.length;l++)o=u[l],s=i.getAttribute(o),s&&n.push(`[${o}="${s}"]`);return n.join("")}function uE(t,e=0){return"string"!==typeof t||0===e||t.length<=e?t:`${t.slice(0,e)}...`}function hE(t,e){if(!Array.isArray(t))return"";const i=[];for(let r=0;r<t.length;r++){const e=t[r];try{i.push(String(e))}catch(n){i.push("[value cannot be serialized]")}}return i.join(e)}function pE(t,e,i=!1){return!!QS(t)&&(XS(e,"RegExp")?e.test(t):!!QS(e)&&(i?t===e:t.includes(e)))}function dE(t,e=[],i=!1){return e.some((e=>pE(t,e,i)))}function fE(t,e,i){if(!(e in t))return;const n=t[e],r=i(n);if("function"===typeof r)try{gE(r,n)}catch(a){}t[e]=r}function mE(t,e,i){Object.defineProperty(t,e,{value:i,writable:!0,configurable:!0})}function gE(t,e){const i=e.prototype||{};t.prototype=e.prototype=i,mE(t,"__sentry_original__",e)}function _E(t){return t.__sentry_original__}function yE(t){if(YS(t))return{message:t.message,name:t.name,stack:t.stack,...xE(t)};if(iE(t)){const e={type:t.type,target:vE(t.target),currentTarget:vE(t.currentTarget),...xE(t)};return"undefined"!==typeof CustomEvent&&aE(t,CustomEvent)&&(e.detail=t.detail),e}return t}function vE(t){try{return e=t,"undefined"!==typeof Element&&aE(e,Element)?lE(t):Object.prototype.toString.call(t)}catch(i){return"<unknown>"}var e}function xE(t){if("object"===typeof t&&null!==t){const e={};for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}return{}}function bE(t){return wE(t,new Map)}function wE(t,e){if(eE(t)){const i=e.get(t);if(void 0!==i)return i;const n={};e.set(t,n);for(const r of Object.keys(t))"undefined"!==typeof t[r]&&(n[r]=wE(t[r],e));return n}if(Array.isArray(t)){const i=e.get(t);if(void 0!==i)return i;const n=[];return e.set(t,n),t.forEach((t=>{n.push(wE(t,e))})),n}return t}function SE(){const t=oE.n2,e=t.crypto||t.msCrypto;if(e&&e.randomUUID)return e.randomUUID().replace(/-/g,"");const i=e&&e.getRandomValues?()=>e.getRandomValues(new Uint8Array(1))[0]:()=>16*Math.random();return([1e7]+1e3+4e3+8e3+1e11).replace(/[018]/g,(t=>(t^(15&i())>>t/4).toString(16)))}function EE(t){return t.exception&&t.exception.values?t.exception.values[0]:void 0}function TE(t){const{message:e,event_id:i}=t;if(e)return e;const n=EE(t);return n?n.type&&n.value?`${n.type}: ${n.value}`:n.type||n.value||i||"<unknown>":i||"<unknown>"}function ME(t,e,i){const n=t.exception=t.exception||{},r=n.values=n.values||[],a=r[0]=r[0]||{};a.value||(a.value=e||""),a.type||(a.type=i||"Error")}function CE(t,e){const i=EE(t);if(!i)return;const n=i.mechanism;if(i.mechanism={type:"generic",handled:!0,...n,...e},e&&"data"in e){const t={...n&&n.data,...e.data};i.mechanism.data=t}}function IE(t){if(t&&t.__sentry_captured__)return!0;try{mE(t,"__sentry_captured__",!0)}catch(kx){}return!1}function AE(t){return Array.isArray(t)?t:[t]}const kE=["debug","info","warn","error","log","assert","trace"];function RE(t){if(!("console"in oE.n2))return t();const e=oE.n2.console,i={};kE.forEach((t=>{const n=e[t]&&e[t].__sentry_original__;t in e&&n&&(i[t]=e[t],e[t]=n)}));try{return t()}finally{Object.keys(i).forEach((t=>{e[t]=i[t]}))}}function zE(){let t=!1;const e={enable:()=>{t=!0},disable:()=>{t=!1}};return"undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__?kE.forEach((i=>{e[i]=(...e)=>{t&&RE((()=>{oE.n2.console[i](`Sentry Logger [${i}]:`,...e)}))}})):kE.forEach((t=>{e[t]=()=>{}})),e}let PE;PE="undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__?(0,oE.YO)("logger",zE):zE();var DE=i(170);const LE="production";var BE;function OE(t){return new NE((e=>{e(t)}))}function FE(t){return new NE(((e,i)=>{i(t)}))}!function(t){t[t.PENDING=0]="PENDING";t[t.RESOLVED=1]="RESOLVED";t[t.REJECTED=2]="REJECTED"}(BE||(BE={}));class NE{constructor(t){NE.prototype.__init.call(this),NE.prototype.__init2.call(this),NE.prototype.__init3.call(this),NE.prototype.__init4.call(this),this._state=BE.PENDING,this._handlers=[];try{t(this._resolve,this._reject)}catch(e){this._reject(e)}}then(t,e){return new NE(((i,n)=>{this._handlers.push([!1,e=>{if(t)try{i(t(e))}catch(r){n(r)}else i(e)},t=>{if(e)try{i(e(t))}catch(r){n(r)}else n(t)}]),this._executeHandlers()}))}catch(t){return this.then((t=>t),t)}finally(t){return new NE(((e,i)=>{let n,r;return this.then((e=>{r=!1,n=e,t&&t()}),(e=>{r=!0,n=e,t&&t()})).then((()=>{r?i(n):e(n)}))}))}__init(){this._resolve=t=>{this._setResult(BE.RESOLVED,t)}}__init2(){this._reject=t=>{this._setResult(BE.REJECTED,t)}}__init3(){this._setResult=(t,e)=>{this._state===BE.PENDING&&(nE(e)?e.then(this._resolve,this._reject):(this._state=t,this._value=e,this._executeHandlers()))}}__init4(){this._executeHandlers=()=>{if(this._state===BE.PENDING)return;const t=this._handlers.slice();this._handlers=[],t.forEach((t=>{t[0]||(this._state===BE.RESOLVED&&t[1](this._value),this._state===BE.REJECTED&&t[2](this._value),t[0]=!0)}))}}}function UE(t){const e=(0,DE.ph)(),i={sid:SE(),init:!0,timestamp:e,started:e,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>function(t){return bE({sid:`${t.sid}`,init:t.init,started:new Date(1e3*t.started).toISOString(),timestamp:new Date(1e3*t.timestamp).toISOString(),status:t.status,errors:t.errors,did:"number"===typeof t.did||"string"===typeof t.did?`${t.did}`:void 0,duration:t.duration,attrs:{release:t.release,environment:t.environment,ip_address:t.ipAddress,user_agent:t.userAgent}})}(i)};return t&&$E(i,t),i}function $E(t,e={}){if(e.user&&(!t.ipAddress&&e.user.ip_address&&(t.ipAddress=e.user.ip_address),t.did||e.did||(t.did=e.user.id||e.user.email||e.user.username)),t.timestamp=e.timestamp||(0,DE.ph)(),e.ignoreDuration&&(t.ignoreDuration=e.ignoreDuration),e.sid&&(t.sid=32===e.sid.length?e.sid:SE()),void 0!==e.init&&(t.init=e.init),!t.did&&e.did&&(t.did=`${e.did}`),"number"===typeof e.started&&(t.started=e.started),t.ignoreDuration)t.duration=void 0;else if("number"===typeof e.duration)t.duration=e.duration;else{const e=t.timestamp-t.started;t.duration=e>=0?e:0}e.release&&(t.release=e.release),e.environment&&(t.environment=e.environment),!t.ipAddress&&e.ipAddress&&(t.ipAddress=e.ipAddress),!t.userAgent&&e.userAgent&&(t.userAgent=e.userAgent),"number"===typeof e.errors&&(t.errors=e.errors),e.status&&(t.status=e.status)}class VE{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext=GE()}static clone(t){const e=new VE;return t&&(e._breadcrumbs=[...t._breadcrumbs],e._tags={...t._tags},e._extra={...t._extra},e._contexts={...t._contexts},e._user=t._user,e._level=t._level,e._span=t._span,e._session=t._session,e._transactionName=t._transactionName,e._fingerprint=t._fingerprint,e._eventProcessors=[...t._eventProcessors],e._requestSession=t._requestSession,e._attachments=[...t._attachments],e._sdkProcessingMetadata={...t._sdkProcessingMetadata},e._propagationContext={...t._propagationContext}),e}addScopeListener(t){this._scopeListeners.push(t)}addEventProcessor(t){return this._eventProcessors.push(t),this}setUser(t){return this._user=t||{},this._session&&$E(this._session,{user:t}),this._notifyScopeListeners(),this}getUser(){return this._user}getRequestSession(){return this._requestSession}setRequestSession(t){return this._requestSession=t,this}setTags(t){return this._tags={...this._tags,...t},this._notifyScopeListeners(),this}setTag(t,e){return this._tags={...this._tags,[t]:e},this._notifyScopeListeners(),this}setExtras(t){return this._extra={...this._extra,...t},this._notifyScopeListeners(),this}setExtra(t,e){return this._extra={...this._extra,[t]:e},this._notifyScopeListeners(),this}setFingerprint(t){return this._fingerprint=t,this._notifyScopeListeners(),this}setLevel(t){return this._level=t,this._notifyScopeListeners(),this}setTransactionName(t){return this._transactionName=t,this._notifyScopeListeners(),this}setContext(t,e){return null===e?delete this._contexts[t]:this._contexts[t]=e,this._notifyScopeListeners(),this}setSpan(t){return this._span=t,this._notifyScopeListeners(),this}getSpan(){return this._span}getTransaction(){const t=this.getSpan();return t&&t.transaction}setSession(t){return t?this._session=t:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(t){if(!t)return this;if("function"===typeof t){const e=t(this);return e instanceof VE?e:this}return t instanceof VE?(this._tags={...this._tags,...t._tags},this._extra={...this._extra,...t._extra},this._contexts={...this._contexts,...t._contexts},t._user&&Object.keys(t._user).length&&(this._user=t._user),t._level&&(this._level=t._level),t._fingerprint&&(this._fingerprint=t._fingerprint),t._requestSession&&(this._requestSession=t._requestSession),t._propagationContext&&(this._propagationContext=t._propagationContext)):eE(t)&&(t=t,this._tags={...this._tags,...t.tags},this._extra={...this._extra,...t.extra},this._contexts={...this._contexts,...t.contexts},t.user&&(this._user=t.user),t.level&&(this._level=t.level),t.fingerprint&&(this._fingerprint=t.fingerprint),t.requestSession&&(this._requestSession=t.requestSession),t.propagationContext&&(this._propagationContext=t.propagationContext)),this}clear(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._requestSession=void 0,this._span=void 0,this._session=void 0,this._notifyScopeListeners(),this._attachments=[],this._propagationContext=GE(),this}addBreadcrumb(t,e){const i="number"===typeof e?e:100;if(i<=0)return this;const n={timestamp:(0,DE.yW)(),...t};return this._breadcrumbs=[...this._breadcrumbs,n].slice(-i),this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(t){return this._attachments.push(t),this}getAttachments(){return this._attachments}clearAttachments(){return this._attachments=[],this}applyToEvent(t,e={}){if(this._extra&&Object.keys(this._extra).length&&(t.extra={...this._extra,...t.extra}),this._tags&&Object.keys(this._tags).length&&(t.tags={...this._tags,...t.tags}),this._user&&Object.keys(this._user).length&&(t.user={...this._user,...t.user}),this._contexts&&Object.keys(this._contexts).length&&(t.contexts={...this._contexts,...t.contexts}),this._level&&(t.level=this._level),this._transactionName&&(t.transaction=this._transactionName),this._span){t.contexts={trace:this._span.getTraceContext(),...t.contexts};const e=this._span.transaction;if(e){t.sdkProcessingMetadata={dynamicSamplingContext:e.getDynamicSamplingContext(),...t.sdkProcessingMetadata};const i=e.name;i&&(t.tags={transaction:i,...t.tags})}}return this._applyFingerprint(t),t.breadcrumbs=[...t.breadcrumbs||[],...this._breadcrumbs],t.breadcrumbs=t.breadcrumbs.length>0?t.breadcrumbs:void 0,t.sdkProcessingMetadata={...t.sdkProcessingMetadata,...this._sdkProcessingMetadata,propagationContext:this._propagationContext},this._notifyEventProcessors([...jE(),...this._eventProcessors],t,e)}setSDKProcessingMetadata(t){return this._sdkProcessingMetadata={...this._sdkProcessingMetadata,...t},this}setPropagationContext(t){return this._propagationContext=t,this}getPropagationContext(){return this._propagationContext}_notifyEventProcessors(t,e,i,n=0){return new NE(((r,a)=>{const o=t[n];if(null===e||"function"!==typeof o)r(e);else{const s=o({...e},i);("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&o.id&&null===s&&PE.log(`Event processor "${o.id}" dropped event`),nE(s)?s.then((e=>this._notifyEventProcessors(t,e,i,n+1).then(r))).then(null,a):this._notifyEventProcessors(t,s,i,n+1).then(r).then(null,a)}}))}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach((t=>{t(this)})),this._notifyingListeners=!1)}_applyFingerprint(t){t.fingerprint=t.fingerprint?AE(t.fingerprint):[],this._fingerprint&&(t.fingerprint=t.fingerprint.concat(this._fingerprint)),t.fingerprint&&!t.fingerprint.length&&delete t.fingerprint}}function jE(){return(0,oE.YO)("globalEventProcessors",(()=>[]))}function qE(t){jE().push(t)}function GE(){return{traceId:SE(),spanId:SE().substring(16)}}const HE=100;class WE{constructor(t,e=new VE,i=4){this._version=i,this._stack=[{scope:e}],t&&this.bindClient(t)}isOlderThan(t){return this._version<t}bindClient(t){this.getStackTop().client=t,t&&t.setupIntegrations&&t.setupIntegrations()}pushScope(){const t=VE.clone(this.getScope());return this.getStack().push({client:this.getClient(),scope:t}),t}popScope(){return!(this.getStack().length<=1)&&!!this.getStack().pop()}withScope(t){const e=this.pushScope();try{t(e)}finally{this.popScope()}}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getStack(){return this._stack}getStackTop(){return this._stack[this._stack.length-1]}captureException(t,e){const i=this._lastEventId=e&&e.event_id?e.event_id:SE(),n=new Error("Sentry syntheticException");return this._withClient(((r,a)=>{r.captureException(t,{originalException:t,syntheticException:n,...e,event_id:i},a)})),i}captureMessage(t,e,i){const n=this._lastEventId=i&&i.event_id?i.event_id:SE(),r=new Error(t);return this._withClient(((a,o)=>{a.captureMessage(t,e,{originalException:t,syntheticException:r,...i,event_id:n},o)})),n}captureEvent(t,e){const i=e&&e.event_id?e.event_id:SE();return t.type||(this._lastEventId=i),this._withClient(((n,r)=>{n.captureEvent(t,{...e,event_id:i},r)})),i}lastEventId(){return this._lastEventId}addBreadcrumb(t,e){const{scope:i,client:n}=this.getStackTop();if(!n)return;const{beforeBreadcrumb:r=null,maxBreadcrumbs:a=HE}=n.getOptions&&n.getOptions()||{};if(a<=0)return;const o={timestamp:(0,DE.yW)(),...t},s=r?RE((()=>r(o,e))):o;null!==s&&(n.emit&&n.emit("beforeAddBreadcrumb",s,e),i.addBreadcrumb(s,a))}setUser(t){this.getScope().setUser(t)}setTags(t){this.getScope().setTags(t)}setExtras(t){this.getScope().setExtras(t)}setTag(t,e){this.getScope().setTag(t,e)}setExtra(t,e){this.getScope().setExtra(t,e)}setContext(t,e){this.getScope().setContext(t,e)}configureScope(t){const{scope:e,client:i}=this.getStackTop();i&&t(e)}run(t){const e=YE(this);try{t(this)}finally{YE(e)}}getIntegration(t){const e=this.getClient();if(!e)return null;try{return e.getIntegration(t)}catch(i){return("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.warn(`Cannot retrieve integration ${t.id} from the current Hub`),null}}startTransaction(t,e){const i=this._callExtensionMethod("startTransaction",t,e);if(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&!i){this.getClient()?console.warn("Tracing extension 'startTransaction' has not been added. Call 'addTracingExtensions' before calling 'init':\nSentry.addTracingExtensions();\nSentry.init({...});\n"):console.warn("Tracing extension 'startTransaction' is missing. You should 'init' the SDK before calling 'startTransaction'")}return i}traceHeaders(){return this._callExtensionMethod("traceHeaders")}captureSession(t=!1){if(t)return this.endSession();this._sendSessionUpdate()}endSession(){const t=this.getStackTop().scope,e=t.getSession();e&&function(t,e){let i={};e?i={status:e}:"ok"===t.status&&(i={status:"exited"}),$E(t,i)}(e),this._sendSessionUpdate(),t.setSession()}startSession(t){const{scope:e,client:i}=this.getStackTop(),{release:n,environment:r=LE}=i&&i.getOptions()||{},{userAgent:a}=oE.n2.navigator||{},o=UE({release:n,environment:r,user:e.getUser(),...a&&{userAgent:a},...t}),s=e.getSession&&e.getSession();return s&&"ok"===s.status&&$E(s,{status:"exited"}),this.endSession(),e.setSession(o),o}shouldSendDefaultPii(){const t=this.getClient(),e=t&&t.getOptions();return Boolean(e&&e.sendDefaultPii)}_sendSessionUpdate(){const{scope:t,client:e}=this.getStackTop(),i=t.getSession();i&&e&&e.captureSession&&e.captureSession(i)}_withClient(t){const{scope:e,client:i}=this.getStackTop();i&&t(i,e)}_callExtensionMethod(t,...e){const i=ZE().__SENTRY__;if(i&&i.extensions&&"function"===typeof i.extensions[t])return i.extensions[t].apply(this,e);("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.warn(`Extension method ${t} couldn't be found, doing nothing.`)}}function ZE(){return oE.n2.__SENTRY__=oE.n2.__SENTRY__||{extensions:{},hub:void 0},oE.n2}function YE(t){const e=ZE(),i=QE(e);return tT(e,t),i}function XE(){const t=ZE();if(t.__SENTRY__&&t.__SENTRY__.acs){const e=t.__SENTRY__.acs.getCurrentHub();if(e)return e}return KE(t)}function KE(t=ZE()){return JE(t)&&!QE(t).isOlderThan(4)||tT(t,new WE),QE(t)}function JE(t){return!!(t&&t.__SENTRY__&&t.__SENTRY__.hub)}function QE(t){return(0,oE.YO)("hub",(()=>new WE),t)}function tT(t,e){if(!t)return!1;return(t.__SENTRY__=t.__SENTRY__||{}).hub=e,!0}const eT=[];function iT(t){const e=t.defaultIntegrations||[],i=t.integrations;let n;e.forEach((t=>{t.isDefaultInstance=!0})),n=Array.isArray(i)?[...e,...i]:"function"===typeof i?AE(i(e)):e;const r=function(t){const e={};return t.forEach((t=>{const{name:i}=t,n=e[i];n&&!n.isDefaultInstance&&t.isDefaultInstance||(e[i]=t)})),Object.keys(e).map((t=>e[t]))}(n),a=function(t,e){for(let i=0;i<t.length;i++)if(!0===e(t[i]))return i;return-1}(r,(t=>"Debug"===t.name));if(-1!==a){const[t]=r.splice(a,1);r.push(t)}return r}function nT(t,e){e[t.name]=t,-1===eT.indexOf(t.name)&&(t.setupOnce(qE,XE),eT.push(t.name),("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log(`Integration installed: ${t.name}`))}const rT=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/],aT=[/^.*healthcheck.*$/,/^.*healthy.*$/,/^.*live.*$/,/^.*ready.*$/,/^.*heartbeat.*$/,/^.*\/health$/,/^.*\/healthz$/];class oT{static __initStatic(){this.id="InboundFilters"}constructor(t={}){this.name=oT.id,this._options=t}setupOnce(t,e){const i=t=>{const i=e();if(i){const e=i.getIntegration(oT);if(e){const n=i.getClient(),r=n?n.getOptions():{},a=function(t={},e={}){return{allowUrls:[...t.allowUrls||[],...e.allowUrls||[]],denyUrls:[...t.denyUrls||[],...e.denyUrls||[]],ignoreErrors:[...t.ignoreErrors||[],...e.ignoreErrors||[],...t.disableErrorDefaults?[]:rT],ignoreTransactions:[...t.ignoreTransactions||[],...e.ignoreTransactions||[],...t.disableTransactionDefaults?[]:aT],ignoreInternal:void 0===t.ignoreInternal||t.ignoreInternal}}(e._options,r);return function(t,e){if(e.ignoreInternal&&function(t){try{return"SentryError"===t.exception.values[0].type}catch(e){}return!1}(t))return("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.warn(`Event dropped due to being internal Sentry Error.\nEvent: ${TE(t)}`),!0;if(function(t,e){if(t.type||!e||!e.length)return!1;return function(t){if(t.message)return[t.message];if(t.exception){const{values:i}=t.exception;try{const{type:t="",value:e=""}=i&&i[i.length-1]||{};return[`${e}`,`${t}: ${e}`]}catch(e){return("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.error(`Cannot extract message for event ${TE(t)}`),[]}}return[]}(t).some((t=>dE(t,e)))}(t,e.ignoreErrors))return("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.warn(`Event dropped due to being matched by \`ignoreErrors\` option.\nEvent: ${TE(t)}`),!0;if(function(t,e){if("transaction"!==t.type||!e||!e.length)return!1;const i=t.transaction;return!!i&&dE(i,e)}(t,e.ignoreTransactions))return("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.\nEvent: ${TE(t)}`),!0;if(function(t,e){if(!e||!e.length)return!1;const i=sT(t);return!!i&&dE(i,e)}(t,e.denyUrls))return("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.warn(`Event dropped due to being matched by \`denyUrls\` option.\nEvent: ${TE(t)}.\nUrl: ${sT(t)}`),!0;if(!function(t,e){if(!e||!e.length)return!0;const i=sT(t);return!i||dE(i,e)}(t,e.allowUrls))return("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.warn(`Event dropped due to not being matched by \`allowUrls\` option.\nEvent: ${TE(t)}.\nUrl: ${sT(t)}`),!0;return!1}(t,a)?null:t}}return t};i.id=this.name,t(i)}}function sT(t){try{let i;try{i=t.exception.values[0].stacktrace.frames}catch(e){}return i?function(t=[]){for(let e=t.length-1;e>=0;e--){const i=t[e];if(i&&"<anonymous>"!==i.filename&&"[native code]"!==i.filename)return i.filename||null}return null}(i):null}catch(i){return("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.error(`Cannot extract url for event ${TE(t)}`),null}}let lT;oT.__initStatic();class cT{static __initStatic(){this.id="FunctionToString"}constructor(){this.name=cT.id}setupOnce(){lT=Function.prototype.toString;try{Function.prototype.toString=function(...t){const e=_E(this)||this;return lT.apply(e,t)}}catch(t){}}}cT.__initStatic();const uT=/\(error: (.*)\)/,hT=/captureMessage|captureException/;function pT(...t){const e=t.sort(((t,e)=>t[0]-e[0])).map((t=>t[1]));return(t,i=0)=>{const n=[],r=t.split("\n");for(let a=i;a<r.length;a++){const t=r[a];if(t.length>1024)continue;const i=uT.test(t)?t.replace(uT,"$1"):t;if(!i.match(/\S*Error: /)){for(const t of e){const e=t(i);if(e){n.push(e);break}}if(n.length>=50)break}}return function(t){if(!t.length)return[];const e=Array.from(t);/sentryWrapped/.test(e[e.length-1].function||"")&&e.pop();e.reverse(),hT.test(e[e.length-1].function||"")&&(e.pop(),hT.test(e[e.length-1].function||"")&&e.pop());return e.slice(0,50).map((t=>({...t,filename:t.filename||e[e.length-1].filename,function:t.function||"?"})))}(n)}}const dT="<anonymous>";function fT(t){try{return t&&"function"===typeof t&&t.name||dT}catch(e){return dT}}const mT=(0,oE.Rf)();function gT(){if(!("fetch"in mT))return!1;try{return new Headers,new Request("http://www.example.com"),new Response,!0}catch(t){return!1}}function _T(t){return t&&/^function fetch\(\)\s+\{\s+\[native code\]\s+\}$/.test(t.toString())}const yT=(0,oE.Rf)();const vT=(0,oE.Rf)(),xT={},bT={};function wT(t){if(!bT[t])switch(bT[t]=!0,t){case"console":!function(){if(!("console"in oE.n2))return;kE.forEach((function(t){t in oE.n2.console&&fE(oE.n2.console,t,(function(e){return TT[t]=e,function(...e){ET("console",{args:e,level:t});const i=TT[t];i&&i.apply(oE.n2.console,e)}}))}))}();break;case"dom":!function(){if(!("document"in vT))return;const t=ET.bind(null,"dom"),e=RT(t,!0);vT.document.addEventListener("click",e,!1),vT.document.addEventListener("keypress",e,!1),["EventTarget","Node"].forEach((e=>{const i=vT[e]&&vT[e].prototype;i&&i.hasOwnProperty&&i.hasOwnProperty("addEventListener")&&(fE(i,"addEventListener",(function(e){return function(i,n,r){if("click"===i||"keypress"==i)try{const n=this,a=n.__sentry_instrumentation_handlers__=n.__sentry_instrumentation_handlers__||{},o=a[i]=a[i]||{refCount:0};if(!o.handler){const n=RT(t);o.handler=n,e.call(this,i,n,r)}o.refCount++}catch(a){}return e.call(this,i,n,r)}})),fE(i,"removeEventListener",(function(t){return function(e,i,n){if("click"===e||"keypress"==e)try{const i=this,r=i.__sentry_instrumentation_handlers__||{},a=r[e];a&&(a.refCount--,a.refCount<=0&&(t.call(this,e,a.handler,n),a.handler=void 0,delete r[e]),0===Object.keys(r).length&&delete i.__sentry_instrumentation_handlers__)}catch(r){}return t.call(this,e,i,n)}})))}))}();break;case"xhr":!function(){if(!("XMLHttpRequest"in vT))return;const t=XMLHttpRequest.prototype;fE(t,"open",(function(t){return function(...e){const i=e[1],n=this.__sentry_xhr_v2__={method:QS(e[0])?e[0].toUpperCase():e[0],url:e[1],request_headers:{}};QS(i)&&"POST"===n.method&&i.match(/sentry_key/)&&(this.__sentry_own_request__=!0);const r=()=>{const t=this.__sentry_xhr_v2__;if(t&&4===this.readyState){try{t.status_code=this.status}catch(i){}ET("xhr",{args:e,endTimestamp:Date.now(),startTimestamp:Date.now(),xhr:this})}};return"onreadystatechange"in this&&"function"===typeof this.onreadystatechange?fE(this,"onreadystatechange",(function(t){return function(...e){return r(),t.apply(this,e)}})):this.addEventListener("readystatechange",r),fE(this,"setRequestHeader",(function(t){return function(...e){const[i,n]=e,r=this.__sentry_xhr_v2__;return r&&(r.request_headers[i.toLowerCase()]=n),t.apply(this,e)}})),t.apply(this,e)}})),fE(t,"send",(function(t){return function(...e){const i=this.__sentry_xhr_v2__;return i&&void 0!==e[0]&&(i.body=e[0]),ET("xhr",{args:e,startTimestamp:Date.now(),xhr:this}),t.apply(this,e)}}))}();break;case"fetch":!function(){if(!function(){if(!gT())return!1;if(_T(mT.fetch))return!0;let t=!1;const e=mT.document;if(e&&"function"===typeof e.createElement)try{const i=e.createElement("iframe");i.hidden=!0,e.head.appendChild(i),i.contentWindow&&i.contentWindow.fetch&&(t=_T(i.contentWindow.fetch)),e.head.removeChild(i)}catch(kx){("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",kx)}return t}())return;fE(oE.n2,"fetch",(function(t){return function(...e){const{method:i,url:n}=function(t){if(0===t.length)return{method:"GET",url:""};if(2===t.length){const[e,i]=t;return{url:CT(e),method:MT(i,"method")?String(i.method).toUpperCase():"GET"}}const e=t[0];return{url:CT(e),method:MT(e,"method")?String(e.method).toUpperCase():"GET"}}(e),r={args:e,fetchData:{method:i,url:n},startTimestamp:Date.now()};return ET("fetch",{...r}),t.apply(oE.n2,e).then((t=>(ET("fetch",{...r,endTimestamp:Date.now(),response:t}),t)),(t=>{throw ET("fetch",{...r,endTimestamp:Date.now(),error:t}),t}))}}))}();break;case"history":!function(){if(!function(){const t=yT.chrome,e=t&&t.app&&t.app.runtime,i="history"in yT&&!!yT.history.pushState&&!!yT.history.replaceState;return!e&&i}())return;const t=vT.onpopstate;function e(t){return function(...e){const i=e.length>2?e[2]:void 0;if(i){const t=IT,e=String(i);IT=e,ET("history",{from:t,to:e})}return t.apply(this,e)}}vT.onpopstate=function(...e){const i=vT.location.href,n=IT;if(IT=i,ET("history",{from:n,to:i}),t)try{return t.apply(this,e)}catch(r){}},fE(vT.history,"pushState",e),fE(vT.history,"replaceState",e)}();break;case"error":zT=vT.onerror,vT.onerror=function(t,e,i,n,r){return ET("error",{column:n,error:r,line:i,msg:t,url:e}),!(!zT||zT.__SENTRY_LOADER__)&&zT.apply(this,arguments)},vT.onerror.__SENTRY_INSTRUMENTED__=!0;break;case"unhandledrejection":PT=vT.onunhandledrejection,vT.onunhandledrejection=function(t){return ET("unhandledrejection",t),!(PT&&!PT.__SENTRY_LOADER__)||PT.apply(this,arguments)},vT.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0;break;default:return void(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.warn("unknown instrumentation type:",t))}}function ST(t,e){xT[t]=xT[t]||[],xT[t].push(e),wT(t)}function ET(t,e){if(t&&xT[t])for(const n of xT[t]||[])try{n(e)}catch(i){("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.error(`Error while triggering instrumentation handler.\nType: ${t}\nName: ${fT(n)}\nError:`,i)}}const TT={};function MT(t,e){return!!t&&"object"===typeof t&&!!t[e]}function CT(t){return"string"===typeof t?t:t?MT(t,"url")?t.url:t.toString?t.toString():"":""}let IT;let AT,kT;function RT(t,e=!1){return i=>{if(!i||kT===i)return;if(function(t){if("keypress"!==t.type)return!1;try{const e=t.target;if(!e||!e.tagName)return!0;if("INPUT"===e.tagName||"TEXTAREA"===e.tagName||e.isContentEditable)return!1}catch(e){}return!0}(i))return;const n="keypress"===i.type?"input":i.type;(void 0===AT||function(t,e){if(!t)return!0;if(t.type!==e.type)return!0;try{if(t.target!==e.target)return!0}catch(i){}return!1}(kT,i))&&(t({event:i,name:n,global:e}),kT=i),clearTimeout(AT),AT=vT.setTimeout((()=>{AT=void 0}),1e3)}}let zT=null;let PT=null;const DT=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function LT(t,e=!1){const{host:i,path:n,pass:r,port:a,projectId:o,protocol:s,publicKey:l}=t;return`${s}://${l}${e&&r?`:${r}`:""}@${i}${a?`:${a}`:""}/${n?`${n}/`:n}${o}`}function BT(t){return{protocol:t.protocol,publicKey:t.publicKey||"",pass:t.pass||"",host:t.host,port:t.port||"",path:t.path||"",projectId:t.projectId}}function OT(t){const e="string"===typeof t?function(t){const e=DT.exec(t);if(!e)return void console.error(`Invalid Sentry Dsn: ${t}`);const[i,n,r="",a,o="",s]=e.slice(1);let l="",c=s;const u=c.split("/");if(u.length>1&&(l=u.slice(0,-1).join("/"),c=u.pop()),c){const t=c.match(/^\d+/);t&&(c=t[0])}return BT({host:a,pass:r,path:l,projectId:c,port:o,protocol:i,publicKey:n})}(t):BT(t);if(e&&function(t){if("undefined"!==typeof __SENTRY_DEBUG__&&!__SENTRY_DEBUG__)return!0;const{port:e,projectId:i,protocol:n}=t;return!["protocol","publicKey","host","projectId"].find((e=>!t[e]&&(PE.error(`Invalid Sentry Dsn: ${e} missing`),!0)))&&(i.match(/^\d+$/)?function(t){return"http"===t||"https"===t}(n)?!e||!isNaN(parseInt(e,10))||(PE.error(`Invalid Sentry Dsn: Invalid port ${e}`),!1):(PE.error(`Invalid Sentry Dsn: Invalid protocol ${n}`),!1):(PE.error(`Invalid Sentry Dsn: Invalid projectId ${i}`),!1))}(e))return e}function FT(t,e=100,i=1/0){try{return UT("",t,e,i)}catch(kx){return{ERROR:`**non-serializable** (${kx})`}}}function NT(t,e=3,i=102400){const n=FT(t,e);return r=n,function(t){return~-encodeURI(t).split(/%..|./).length}(JSON.stringify(r))>i?NT(t,e-1,i):n;var r}function UT(t,e,n=1/0,r=1/0,a=function(){const t="function"===typeof WeakSet,e=t?new WeakSet:[];return[function(i){if(t)return!!e.has(i)||(e.add(i),!1);for(let t=0;t<e.length;t++)if(e[t]===i)return!0;return e.push(i),!1},function(i){if(t)e.delete(i);else for(let t=0;t<e.length;t++)if(e[t]===i){e.splice(t,1);break}}]}()){const[o,s]=a;if(null==e||["number","boolean","string"].includes(typeof e)&&!rE(e))return e;const l=function(t,e){try{if("domain"===t&&e&&"object"===typeof e&&e._events)return"[Domain]";if("domainEmitter"===t)return"[DomainEmitter]";if("undefined"!==typeof i.g&&e===i.g)return"[Global]";if("undefined"!==typeof window&&e===window)return"[Window]";if("undefined"!==typeof document&&e===document)return"[Document]";if(eE(n=e)&&"nativeEvent"in n&&"preventDefault"in n&&"stopPropagation"in n)return"[SyntheticEvent]";if("number"===typeof e&&e!==e)return"[NaN]";if("function"===typeof e)return`[Function: ${fT(e)}]`;if("symbol"===typeof e)return`[${String(e)}]`;if("bigint"===typeof e)return`[BigInt: ${String(e)}]`;const r=function(t){const e=Object.getPrototypeOf(t);return e?e.constructor.name:"null prototype"}(e);return/^HTML(\w*)Element$/.test(r)?`[HTMLElement: ${r}]`:`[object ${r}]`}catch(kx){return`**non-serializable** (${kx})`}var n}(t,e);if(!l.startsWith("[object "))return l;if(e.__sentry_skip_normalization__)return e;const c="number"===typeof e.__sentry_override_normalization_depth__?e.__sentry_override_normalization_depth__:n;if(0===c)return l.replace("object ","");if(o(e))return"[Circular ~]";const u=e;if(u&&"function"===typeof u.toJSON)try{return UT("",u.toJSON(),c-1,r,a)}catch(kx){}const h=Array.isArray(e)?[]:{};let p=0;const d=yE(e);for(const i in d){if(!Object.prototype.hasOwnProperty.call(d,i))continue;if(p>=r){h[i]="[MaxProperties ~]";break}const t=d[i];h[i]=UT(i,t,c-1,r,a),p++}return s(e),h}function $T(t,e=[]){return[t,e]}function VT(t,e){const[i,n]=t;return[i,[...n,e]]}function jT(t,e){const i=t[1];for(const n of i){if(e(n,n[0].type))return!0}return!1}function qT(t,e){return(e||new TextEncoder).encode(t)}function GT(t,e){const[i,n]=t;let r=JSON.stringify(i);function a(t){"string"===typeof r?r="string"===typeof t?r+t:[qT(r,e),t]:r.push("string"===typeof t?qT(t,e):t)}for(const s of n){const[t,e]=s;if(a(`\n${JSON.stringify(t)}\n`),"string"===typeof e||e instanceof Uint8Array)a(e);else{let t;try{t=JSON.stringify(e)}catch(o){t=JSON.stringify(FT(e))}a(t)}}return"string"===typeof r?r:function(t){const e=t.reduce(((t,e)=>t+e.length),0),i=new Uint8Array(e);let n=0;for(const r of t)i.set(r,n),n+=r.length;return i}(r)}function HT(t,e){const i="string"===typeof t.data?qT(t.data,e):t.data;return[bE({type:"attachment",length:i.length,filename:t.filename,content_type:t.contentType,attachment_type:t.attachmentType}),i]}const WT={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor"};function ZT(t){return WT[t]}function YT(t){if(!t||!t.sdk)return;const{name:e,version:i}=t.sdk;return{name:e,version:i}}function XT(t,e,i,n){const r=t.sdkProcessingMetadata&&t.sdkProcessingMetadata.dynamicSamplingContext;return{event_id:t.event_id,sent_at:(new Date).toISOString(),...e&&{sdk:e},...!!i&&{dsn:LT(n)},...r&&{trace:bE({...r})}}}class KT extends Error{constructor(t,e="warn"){super(t),this.message=t,this.name=new.target.prototype.constructor.name,Object.setPrototypeOf(this,new.target.prototype),this.logLevel=e}}function JT(t){const e=t.protocol?`${t.protocol}:`:"",i=t.port?`:${t.port}`:"";return`${e}//${t.host}${i}${t.path?`/${t.path}`:""}/api/`}function QT(t,e){return i={sentry_key:t.publicKey,sentry_version:"7",...e&&{sentry_client:`${e.name}/${e.version}`}},Object.keys(i).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(i[t])}`)).join("&");var i}function tM(t,e={}){const i="string"===typeof e?e:e.tunnel,n="string"!==typeof e&&e._metadata?e._metadata.sdk:void 0;return i||`${function(t){return`${JT(t)}${t.projectId}/envelope/`}(t)}?${QT(t,n)}`}function eM(t,e,i){const n=e.getOptions(),{publicKey:r}=e.getDsn()||{},{segment:a}=i&&i.getUser()||{},o=bE({environment:n.environment||LE,release:n.release,user_segment:a,public_key:r,trace_id:t});return e.emit&&e.emit("createDsc",o),o}function iM(t,e,i,n){const{normalizeDepth:r=3,normalizeMaxBreadth:a=1e3}=t,o={...e,event_id:e.event_id||i.event_id||SE(),timestamp:e.timestamp||(0,DE.yW)()},s=i.integrations||t.integrations.map((t=>t.name));!function(t,e){const{environment:i,release:n,dist:r,maxValueLength:a=250}=e;"environment"in t||(t.environment="environment"in e?i:LE);void 0===t.release&&void 0!==n&&(t.release=n);void 0===t.dist&&void 0!==r&&(t.dist=r);t.message&&(t.message=uE(t.message,a));const o=t.exception&&t.exception.values&&t.exception.values[0];o&&o.value&&(o.value=uE(o.value,a));const s=t.request;s&&s.url&&(s.url=uE(s.url,a))}(o,t),function(t,e){e.length>0&&(t.sdk=t.sdk||{},t.sdk.integrations=[...t.sdk.integrations||[],...e])}(o,s),void 0===e.type&&function(t,e){const i=oE.n2._sentryDebugIds;if(!i)return;let n;const r=nM.get(e);r?n=r:(n=new Map,nM.set(e,n));const a=Object.keys(i).reduce(((t,r)=>{let a;const o=n.get(r);o?a=o:(a=e(r),n.set(r,a));for(let e=a.length-1;e>=0;e--){const n=a[e];if(n.filename){t[n.filename]=i[r];break}}return t}),{});try{t.exception.values.forEach((t=>{t.stacktrace.frames.forEach((t=>{t.filename&&(t.debug_id=a[t.filename])}))}))}catch(o){}}(o,t.stackParser);let l=n;i.captureContext&&(l=VE.clone(l).update(i.captureContext));let c=OE(o);if(l){if(l.getAttachments){const t=[...i.attachments||[],...l.getAttachments()];t.length&&(i.attachments=t)}c=l.applyToEvent(o,i)}return c.then((t=>(t&&function(t){const e={};try{t.exception.values.forEach((t=>{t.stacktrace.frames.forEach((t=>{t.debug_id&&(t.abs_path?e[t.abs_path]=t.debug_id:t.filename&&(e[t.filename]=t.debug_id),delete t.debug_id)}))}))}catch(n){}if(0===Object.keys(e).length)return;t.debug_meta=t.debug_meta||{},t.debug_meta.images=t.debug_meta.images||[];const i=t.debug_meta.images;Object.keys(e).forEach((t=>{i.push({type:"sourcemap",code_file:t,debug_id:e[t]})}))}(t),"number"===typeof r&&r>0?function(t,e,i){if(!t)return null;const n={...t,...t.breadcrumbs&&{breadcrumbs:t.breadcrumbs.map((t=>({...t,...t.data&&{data:FT(t.data,e,i)}})))},...t.user&&{user:FT(t.user,e,i)},...t.contexts&&{contexts:FT(t.contexts,e,i)},...t.extra&&{extra:FT(t.extra,e,i)}};t.contexts&&t.contexts.trace&&n.contexts&&(n.contexts.trace=t.contexts.trace,t.contexts.trace.data&&(n.contexts.trace.data=FT(t.contexts.trace.data,e,i)));t.spans&&(n.spans=t.spans.map((t=>(t.data&&(t.data=FT(t.data,e,i)),t))));return n}(t,r,a):t)))}const nM=new WeakMap;const rM="Not capturing exception because it's already been captured.";function aM(t){return void 0===t.type}function oM(t){return"transaction"===t.type}const sM="7.66.0";var lM=i(518);function cM(t,e){const i=hM(t,e),n={type:e&&e.name,value:dM(e)};return i.length&&(n.stacktrace={frames:i}),void 0===n.type&&""===n.value&&(n.value="Unrecoverable error caught"),n}function uM(t,e){return{exception:{values:[cM(t,e)]}}}function hM(t,e){const i=e.stacktrace||e.stack||"",n=function(t){if(t){if("number"===typeof t.framesToPop)return t.framesToPop;if(pM.test(t.message))return 1}return 0}(e);try{return t(i,n)}catch(r){}return[]}const pM=/Minified React error #\d+;/i;function dM(t){const e=t&&t.message;return e?e.error&&"string"===typeof e.error.message?e.error.message:e:"No error message"}function fM(t,e,i,n,r){let a;if(KS(e)&&e.error){return uM(t,e.error)}if(JS(e)||XS(e,"DOMException")){const r=e;if("stack"in e)a=uM(t,e);else{const e=r.name||(JS(r)?"DOMError":"DOMException"),o=r.message?`${e}: ${r.message}`:e;a=mM(t,o,i,n),ME(a,o)}return"code"in r&&(a.tags={...a.tags,"DOMException.code":`${r.code}`}),a}if(YS(e))return uM(t,e);if(eE(e)||iE(e)){return a=function(t,e,i,n){const r=XE().getClient(),a=r&&r.getOptions().normalizeDepth,o={exception:{values:[{type:iE(e)?e.constructor.name:n?"UnhandledRejection":"Error",value:gM(e,{isUnhandledRejection:n})}]},extra:{__serialized__:NT(e,a)}};if(i){const e=hM(t,i);e.length&&(o.exception.values[0].stacktrace={frames:e})}return o}(t,e,i,r),CE(a,{synthetic:!0}),a}return a=mM(t,e,i,n),ME(a,`${e}`,void 0),CE(a,{synthetic:!0}),a}function mM(t,e,i,n){const r={message:e};if(n&&i){const n=hM(t,i);n.length&&(r.exception={values:[{value:e,stacktrace:{frames:n}}]})}return r}function gM(t,{isUnhandledRejection:e}){const i=function(t,e=40){const i=Object.keys(yE(t));if(i.sort(),!i.length)return"[object has no keys]";if(i[0].length>=e)return uE(i[0],e);for(let n=i.length;n>0;n--){const t=i.slice(0,n).join(", ");if(!(t.length>e))return n===i.length?t:uE(t,e)}return""}(t),n=e?"promise rejection":"exception";if(KS(t))return`Event \`ErrorEvent\` captured as ${n} with message \`${t.message}\``;if(iE(t)){return`Event \`${function(t){try{const e=Object.getPrototypeOf(t);return e?e.constructor.name:void 0}catch(e){}}(t)}\` (type=${t.type}) captured as ${n}`}return`Object captured as ${n} with keys: ${i}`}function _M(t,e){return XE().captureException(t,{captureContext:e})}function yM(t){XE().withScope(t)}const vM=oE.n2;let xM=0;function bM(){return xM>0}function wM(){xM++,setTimeout((()=>{xM--}))}function SM(t,e={},i){if("function"!==typeof t)return t;try{const e=t.__sentry_wrapped__;if(e)return e;if(_E(t))return t}catch(r){return t}const n=function(){const n=Array.prototype.slice.call(arguments);try{i&&"function"===typeof i&&i.apply(this,arguments);const r=n.map((t=>SM(t,e)));return t.apply(this,r)}catch(r){throw wM(),yM((t=>{t.addEventProcessor((t=>(e.mechanism&&(ME(t,void 0,void 0),CE(t,e.mechanism)),t.extra={...t.extra,arguments:n},t))),_M(r)})),r}};try{for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e])}catch(a){}gE(n,t),mE(t,"__sentry_wrapped__",n);try{Object.getOwnPropertyDescriptor(n,"name").configurable&&Object.defineProperty(n,"name",{get:()=>t.name})}catch(a){}return n}class EM extends class{constructor(t){if(this._options=t,this._integrations={},this._integrationsInitialized=!1,this._numProcessing=0,this._outcomes={},this._hooks={},t.dsn?this._dsn=OT(t.dsn):("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.warn("No DSN provided, client will not do anything."),this._dsn){const e=tM(this._dsn,t);this._transport=t.transport({recordDroppedEvent:this.recordDroppedEvent.bind(this),...t.transportOptions,url:e})}}captureException(t,e,i){if(IE(t))return void(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log(rM));let n=e&&e.event_id;return this._process(this.eventFromException(t,e).then((t=>this._captureEvent(t,e,i))).then((t=>{n=t}))),n}captureMessage(t,e,i,n){let r=i&&i.event_id;const a=tE(t)?this.eventFromMessage(String(t),e,i):this.eventFromException(t,i);return this._process(a.then((t=>this._captureEvent(t,i,n))).then((t=>{r=t}))),r}captureEvent(t,e,i){if(e&&e.originalException&&IE(e.originalException))return void(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log(rM));let n=e&&e.event_id;return this._process(this._captureEvent(t,e,i).then((t=>{n=t}))),n}captureSession(t){this._isEnabled()?"string"!==typeof t.release?("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.warn("Discarded session because of missing or non-string release"):(this.sendSession(t),$E(t,{init:!1})):("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.warn("SDK not enabled, will not capture session.")}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}flush(t){const e=this._transport;return e?this._isClientDoneProcessing(t).then((i=>e.flush(t).then((t=>i&&t)))):OE(!0)}close(t){return this.flush(t).then((t=>(this.getOptions().enabled=!1,t)))}setupIntegrations(){this._isEnabled()&&!this._integrationsInitialized&&(this._integrations=function(t){const e={};return t.forEach((t=>{t&&nT(t,e)})),e}(this._options.integrations),this._integrationsInitialized=!0)}getIntegrationById(t){return this._integrations[t]}getIntegration(t){try{return this._integrations[t.id]||null}catch(e){return("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.warn(`Cannot retrieve integration ${t.id} from the current Client`),null}}addIntegration(t){nT(t,this._integrations)}sendEvent(t,e={}){if(this.emit("beforeSendEvent",t,e),this._dsn){let i=function(t,e,i,n){const r=YT(i),a=t.type&&"replay_event"!==t.type?t.type:"event";!function(t,e){e&&(t.sdk=t.sdk||{},t.sdk.name=t.sdk.name||e.name,t.sdk.version=t.sdk.version||e.version,t.sdk.integrations=[...t.sdk.integrations||[],...e.integrations||[]],t.sdk.packages=[...t.sdk.packages||[],...e.packages||[]])}(t,i&&i.sdk);const o=XT(t,r,n,e);return delete t.sdkProcessingMetadata,$T(o,[[{type:a},t]])}(t,this._dsn,this._options._metadata,this._options.tunnel);for(const t of e.attachments||[])i=VT(i,HT(t,this._options.transportOptions&&this._options.transportOptions.textEncoder));const n=this._sendEnvelope(i);n&&n.then((e=>this.emit("afterSendEvent",t,e)),null)}}sendSession(t){if(this._dsn){const e=function(t,e,i,n){const r=YT(i);return $T({sent_at:(new Date).toISOString(),...r&&{sdk:r},...!!n&&{dsn:LT(e)}},["aggregates"in t?[{type:"sessions"},t]:[{type:"session"},t.toJSON()]])}(t,this._dsn,this._options._metadata,this._options.tunnel);this._sendEnvelope(e)}}recordDroppedEvent(t,e,i){if(this._options.sendClientReports){const i=`${t}:${e}`;("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log(`Adding outcome: "${i}"`),this._outcomes[i]=this._outcomes[i]+1||1}}on(t,e){this._hooks[t]||(this._hooks[t]=[]),this._hooks[t].push(e)}emit(t,...e){this._hooks[t]&&this._hooks[t].forEach((t=>t(...e)))}_updateSessionFromEvent(t,e){let i=!1,n=!1;const r=e.exception&&e.exception.values;if(r){n=!0;for(const t of r){const e=t.mechanism;if(e&&!1===e.handled){i=!0;break}}}const a="ok"===t.status;(a&&0===t.errors||a&&i)&&($E(t,{...i&&{status:"crashed"},errors:t.errors||Number(n||i)}),this.captureSession(t))}_isClientDoneProcessing(t){return new NE((e=>{let i=0;const n=setInterval((()=>{0==this._numProcessing?(clearInterval(n),e(!0)):(i+=1,t&&i>=t&&(clearInterval(n),e(!1)))}),1)}))}_isEnabled(){return!1!==this.getOptions().enabled&&void 0!==this._dsn}_prepareEvent(t,e,i){const n=this.getOptions(),r=Object.keys(this._integrations);return!e.integrations&&r.length>0&&(e.integrations=r),iM(n,t,e,i).then((t=>{if(null===t)return t;const{propagationContext:e}=t.sdkProcessingMetadata||{};if(!(t.contexts&&t.contexts.trace)&&e){const{traceId:n,spanId:r,parentSpanId:a,dsc:o}=e;t.contexts={trace:{trace_id:n,span_id:r,parent_span_id:a},...t.contexts};const s=o||eM(n,this,i);t.sdkProcessingMetadata={dynamicSamplingContext:s,...t.sdkProcessingMetadata}}return t}))}_captureEvent(t,e={},i){return this._processEvent(t,e,i).then((t=>t.event_id),(t=>{if("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__){const e=t;"log"===e.logLevel?PE.log(e.message):PE.warn(e)}}))}_processEvent(t,e,i){const n=this.getOptions(),{sampleRate:r}=n;if(!this._isEnabled())return FE(new KT("SDK not enabled, will not capture event.","log"));const a=oM(t),o=aM(t),s=t.type||"error",l=`before send for type \`${s}\``;if(o&&"number"===typeof r&&Math.random()>r)return this.recordDroppedEvent("sample_rate","error",t),FE(new KT(`Discarding event because it's not included in the random sample (sampling rate = ${r})`,"log"));const c="replay_event"===s?"replay":s;return this._prepareEvent(t,e,i).then((i=>{if(null===i)throw this.recordDroppedEvent("event_processor",c,t),new KT("An event processor returned `null`, will not send event.","log");if(e.data&&!0===e.data.__sentry__)return i;const r=function(t,e,i){const{beforeSend:n,beforeSendTransaction:r}=t;if(aM(e)&&n)return n(e,i);if(oM(e)&&r)return r(e,i);return e}(n,i,e);return function(t,e){const i=`${e} must return \`null\` or a valid event.`;if(nE(t))return t.then((t=>{if(!eE(t)&&null!==t)throw new KT(i);return t}),(t=>{throw new KT(`${e} rejected with ${t}`)}));if(!eE(t)&&null!==t)throw new KT(i);return t}(r,l)})).then((n=>{if(null===n)throw this.recordDroppedEvent("before_send",c,t),new KT(`${l} returned \`null\`, will not send event.`,"log");const r=i&&i.getSession();!a&&r&&this._updateSessionFromEvent(r,n);const o=n.transaction_info;if(a&&o&&n.transaction!==t.transaction){const t="custom";n.transaction_info={...o,source:t}}return this.sendEvent(n,e),n})).then(null,(t=>{if(t instanceof KT)throw t;throw this.captureException(t,{data:{__sentry__:!0},originalException:t}),new KT(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.\nReason: ${t}`)}))}_process(t){this._numProcessing++,t.then((t=>(this._numProcessing--,t)),(t=>(this._numProcessing--,t)))}_sendEnvelope(t){if(this._transport&&this._dsn)return this.emit("beforeEnvelope",t),this._transport.send(t).then(null,(t=>{("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.error("Error while sending event:",t)}));("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.error("Transport disabled")}_clearOutcomes(){const t=this._outcomes;return this._outcomes={},Object.keys(t).map((e=>{const[i,n]=e.split(":");return{reason:i,category:n,quantity:t[e]}}))}}{constructor(t){const e=vM.SENTRY_SDK_SOURCE||(0,lM.S)();t._metadata=t._metadata||{},t._metadata.sdk=t._metadata.sdk||{name:"sentry.javascript.browser",packages:[{name:`${e}:@sentry/browser`,version:sM}],version:sM},super(t),t.sendClientReports&&vM.document&&vM.document.addEventListener("visibilitychange",(()=>{"hidden"===vM.document.visibilityState&&this._flushOutcomes()}))}eventFromException(t,e){return function(t,e,i,n){const r=fM(t,e,i&&i.syntheticException||void 0,n);return CE(r),r.level="error",i&&i.event_id&&(r.event_id=i.event_id),OE(r)}(this._options.stackParser,t,e,this._options.attachStacktrace)}eventFromMessage(t,e="info",i){return function(t,e,i="info",n,r){const a=mM(t,e,n&&n.syntheticException||void 0,r);return a.level=i,n&&n.event_id&&(a.event_id=n.event_id),OE(a)}(this._options.stackParser,t,e,i,this._options.attachStacktrace)}captureUserFeedback(t){if(!this._isEnabled())return void(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.warn("SDK not enabled, will not capture user feedback."));const e=function(t,{metadata:e,tunnel:i,dsn:n}){const r={event_id:t.event_id,sent_at:(new Date).toISOString(),...e&&e.sdk&&{sdk:{name:e.sdk.name,version:e.sdk.version}},...!!i&&!!n&&{dsn:LT(n)}},a=function(t){return[{type:"user_report"},t]}(t);return $T(r,[a])}(t,{metadata:this.getSdkMetadata(),dsn:this.getDsn(),tunnel:this.getOptions().tunnel});this._sendEnvelope(e)}_prepareEvent(t,e,i){return t.platform=t.platform||"javascript",super._prepareEvent(t,e,i)}_flushOutcomes(){const t=this._clearOutcomes();if(0===t.length)return void(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log("No outcomes to send"));if(!this._dsn)return void(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log("No dsn provided, will not send outcomes"));("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log("Sending outcomes:",t);const e=(i=t,$T((n=this._options.tunnel&&LT(this._dsn))?{dsn:n}:{},[[{type:"client_report"},{timestamp:r||(0,DE.yW)(),discarded_events:i}]]));var i,n,r;this._sendEnvelope(e)}}class TM{static __initStatic(){this.id="GlobalHandlers"}constructor(t){this.name=TM.id,this._options={onerror:!0,onunhandledrejection:!0,...t},this._installFunc={onerror:MM,onunhandledrejection:CM}}setupOnce(){Error.stackTraceLimit=50;const t=this._options;for(const i in t){const n=this._installFunc[i];n&&t[i]&&(e=i,("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log(`Global Handler attached: ${e}`),n(),this._installFunc[i]=void 0)}var e}}function MM(){ST("error",(t=>{const[e,i,n]=kM();if(!e.getIntegration(TM))return;const{msg:r,url:a,line:o,column:s,error:l}=t;if(bM()||l&&l.__sentry_own_request__)return;const c=void 0===l&&QS(r)?function(t,e,i,n){const r=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/i;let a=KS(t)?t.message:t,o="Error";const s=a.match(r);s&&(o=s[1],a=s[2]);return IM({exception:{values:[{type:o,value:a}]}},e,i,n)}(r,a,o,s):IM(fM(i,l||r,void 0,n,!1),a,o,s);c.level="error",AM(e,l,c,"onerror")}))}function CM(){ST("unhandledrejection",(t=>{const[e,i,n]=kM();if(!e.getIntegration(TM))return;let r=t;try{"reason"in t?r=t.reason:"detail"in t&&"reason"in t.detail&&(r=t.detail.reason)}catch(o){}if(bM()||r&&r.__sentry_own_request__)return!0;const a=tE(r)?{exception:{values:[{type:"UnhandledRejection",value:`Non-Error promise rejection captured with value: ${String(r)}`}]}}:fM(i,r,void 0,n,!0);a.level="error",AM(e,r,a,"onunhandledrejection")}))}function IM(t,e,i,n){const r=t.exception=t.exception||{},a=r.values=r.values||[],o=a[0]=a[0]||{},s=o.stacktrace=o.stacktrace||{},l=s.frames=s.frames||[],c=isNaN(parseInt(n,10))?void 0:n,u=isNaN(parseInt(i,10))?void 0:i,h=QS(e)&&e.length>0?e:function(){try{return sE.document.location.href}catch(t){return""}}();return 0===l.length&&l.push({colno:c,filename:h,function:"?",in_app:!0,lineno:u}),t}function AM(t,e,i,n){CE(i,{handled:!1,type:n}),t.captureEvent(i,{originalException:e})}function kM(){const t=XE(),e=t.getClient(),i=e&&e.getOptions()||{stackParser:()=>[],attachStacktrace:!1};return[t,i.stackParser,i.attachStacktrace]}TM.__initStatic();const RM=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"];class zM{static __initStatic(){this.id="TryCatch"}constructor(t){this.name=zM.id,this._options={XMLHttpRequest:!0,eventTarget:!0,requestAnimationFrame:!0,setInterval:!0,setTimeout:!0,...t}}setupOnce(){this._options.setTimeout&&fE(vM,"setTimeout",PM),this._options.setInterval&&fE(vM,"setInterval",PM),this._options.requestAnimationFrame&&fE(vM,"requestAnimationFrame",DM),this._options.XMLHttpRequest&&"XMLHttpRequest"in vM&&fE(XMLHttpRequest.prototype,"send",LM);const t=this._options.eventTarget;if(t){(Array.isArray(t)?t:RM).forEach(BM)}}}function PM(t){return function(...e){const i=e[0];return e[0]=SM(i,{mechanism:{data:{function:fT(t)},handled:!0,type:"instrument"}}),t.apply(this,e)}}function DM(t){return function(e){return t.apply(this,[SM(e,{mechanism:{data:{function:"requestAnimationFrame",handler:fT(t)},handled:!0,type:"instrument"}})])}}function LM(t){return function(...e){const i=this;return["onload","onerror","onprogress","onreadystatechange"].forEach((t=>{t in i&&"function"===typeof i[t]&&fE(i,t,(function(e){const i={mechanism:{data:{function:t,handler:fT(e)},handled:!0,type:"instrument"}},n=_E(e);return n&&(i.mechanism.data.handler=fT(n)),SM(e,i)}))})),t.apply(this,e)}}function BM(t){const e=vM,i=e[t]&&e[t].prototype;i&&i.hasOwnProperty&&i.hasOwnProperty("addEventListener")&&(fE(i,"addEventListener",(function(e){return function(i,n,r){try{"function"===typeof n.handleEvent&&(n.handleEvent=SM(n.handleEvent,{mechanism:{data:{function:"handleEvent",handler:fT(n),target:t},handled:!0,type:"instrument"}}))}catch(kx){}return e.apply(this,[i,SM(n,{mechanism:{data:{function:"addEventListener",handler:fT(n),target:t},handled:!0,type:"instrument"}}),r])}})),fE(i,"removeEventListener",(function(t){return function(e,i,n){const r=i;try{const i=r&&r.__sentry_wrapped__;i&&t.call(this,e,i,n)}catch(a){}return t.call(this,e,r,n)}})))}zM.__initStatic();const OM=["fatal","error","warning","log","info","debug"];function FM(t){return"warn"===t?"warning":OM.includes(t)?t:"log"}function NM(t){if(!t)return{};const e=t.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!e)return{};const i=e[6]||"",n=e[8]||"";return{host:e[4],path:e[5],protocol:e[2],search:i,hash:n,relative:e[5]+i+n}}const UM=1024;class $M{static __initStatic(){this.id="Breadcrumbs"}constructor(t){this.name=$M.id,this.options={console:!0,dom:!0,fetch:!0,history:!0,sentry:!0,xhr:!0,...t}}setupOnce(){if(this.options.console&&ST("console",jM),this.options.dom&&ST("dom",function(t){function e(e){let i,n="object"===typeof t?t.serializeAttribute:void 0,r="object"===typeof t&&"number"===typeof t.maxStringLength?t.maxStringLength:void 0;r&&r>UM&&(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.warn(`\`dom.maxStringLength\` cannot exceed 1024, but a value of ${r} was configured. Sentry will use 1024 instead.`),r=UM),"string"===typeof n&&(n=[n]);try{const t=e.event;i=function(t){return!!t&&!!t.target}(t)?lE(t.target,{keyAttrs:n,maxStringLength:r}):lE(t,{keyAttrs:n,maxStringLength:r})}catch(a){i="<unknown>"}0!==i.length&&XE().addBreadcrumb({category:`ui.${e.name}`,message:i},{event:e.event,name:e.name,global:e.global})}return e}(this.options.dom)),this.options.xhr&&ST("xhr",qM),this.options.fetch&&ST("fetch",GM),this.options.history&&ST("history",HM),this.options.sentry){const t=XE().getClient();t&&t.on&&t.on("beforeSendEvent",VM)}}}function VM(t){XE().addBreadcrumb({category:"sentry."+("transaction"===t.type?"transaction":"event"),event_id:t.event_id,level:t.level,message:TE(t)},{event:t})}function jM(t){for(let i=0;i<t.args.length;i++)if("ref=Ref<"===t.args[i]){t.args[i+1]="viewRef";break}const e={category:"console",data:{arguments:t.args,logger:"console"},level:FM(t.level),message:hE(t.args," ")};if("assert"===t.level){if(!1!==t.args[0])return;e.message=`Assertion failed: ${hE(t.args.slice(1)," ")||"console.assert"}`,e.data.arguments=t.args.slice(1)}XE().addBreadcrumb(e,{input:t.args,level:t.level})}function qM(t){const{startTimestamp:e,endTimestamp:i}=t,n=t.xhr.__sentry_xhr_v2__;if(!e||!i||!n)return;const{method:r,url:a,status_code:o,body:s}=n,l={method:r,url:a,status_code:o},c={xhr:t.xhr,input:s,startTimestamp:e,endTimestamp:i};XE().addBreadcrumb({category:"xhr",data:l,type:"http"},c)}function GM(t){const{startTimestamp:e,endTimestamp:i}=t;if(i&&(!t.fetchData.url.match(/sentry_key/)||"POST"!==t.fetchData.method))if(t.error){const n=t.fetchData,r={data:t.error,input:t.args,startTimestamp:e,endTimestamp:i};XE().addBreadcrumb({category:"fetch",data:n,level:"error",type:"http"},r)}else{const n={...t.fetchData,status_code:t.response&&t.response.status},r={input:t.args,response:t.response,startTimestamp:e,endTimestamp:i};XE().addBreadcrumb({category:"fetch",data:n,type:"http"},r)}}function HM(t){let e=t.from,i=t.to;const n=NM(vM.location.href);let r=NM(e);const a=NM(i);r.path||(r=n),n.protocol===a.protocol&&n.host===a.host&&(i=a.relative),n.protocol===r.protocol&&n.host===r.host&&(e=r.relative),XE().addBreadcrumb({category:"navigation",data:{from:e,to:i}})}function WM(t,e,i=250,n,r,a,o){if(!a.exception||!a.exception.values||!o||!aE(o.originalException,Error))return;const s=a.exception.values.length>0?a.exception.values[a.exception.values.length-1]:void 0;var l,c;s&&(a.exception.values=(l=ZM(t,e,r,o.originalException,n,a.exception.values,s,0),c=i,l.map((t=>(t.value&&(t.value=uE(t.value,c)),t)))))}function ZM(t,e,i,n,r,a,o,s){if(a.length>=i+1)return a;let l=[...a];if(aE(n[r],Error)){YM(o,s);const a=t(e,n[r]),c=l.length;XM(a,r,c,s),l=ZM(t,e,i,n[r],r,[a,...l],a,c)}return Array.isArray(n.errors)&&n.errors.forEach(((n,a)=>{if(aE(n,Error)){YM(o,s);const c=t(e,n),u=l.length;XM(c,`errors[${a}]`,u,s),l=ZM(t,e,i,n,r,[c,...l],c,u)}})),l}function YM(t,e){t.mechanism=t.mechanism||{type:"generic",handled:!0},t.mechanism={...t.mechanism,is_exception_group:!0,exception_id:e}}function XM(t,e,i,n){t.mechanism=t.mechanism||{type:"generic",handled:!0},t.mechanism={...t.mechanism,type:"chained",source:e,exception_id:i,parent_id:n}}$M.__initStatic();class KM{static __initStatic(){this.id="LinkedErrors"}constructor(t={}){this.name=KM.id,this._key=t.key||"cause",this._limit=t.limit||5}setupOnce(t,e){t(((t,i)=>{const n=e(),r=n.getClient(),a=n.getIntegration(KM);if(!r||!a)return t;const o=r.getOptions();return WM(cM,o.stackParser,o.maxValueLength,a._key,a._limit,t,i),t}))}}KM.__initStatic();class JM{static __initStatic(){this.id="HttpContext"}constructor(){this.name=JM.id}setupOnce(){qE((t=>{if(XE().getIntegration(JM)){if(!vM.navigator&&!vM.location&&!vM.document)return t;const e=t.request&&t.request.url||vM.location&&vM.location.href,{referrer:i}=vM.document||{},{userAgent:n}=vM.navigator||{},r={...t.request&&t.request.headers,...i&&{Referer:i},...n&&{"User-Agent":n}},a={...t.request,...e&&{url:e},headers:r};return{...t,request:a}}return t}))}}JM.__initStatic();class QM{static __initStatic(){this.id="Dedupe"}constructor(){this.name=QM.id}setupOnce(t,e){const i=t=>{if(t.type)return t;const i=e().getIntegration(QM);if(i){try{if(function(t,e){if(!e)return!1;if(function(t,e){const i=t.message,n=e.message;if(!i&&!n)return!1;if(i&&!n||!i&&n)return!1;if(i!==n)return!1;if(!eC(t,e))return!1;if(!tC(t,e))return!1;return!0}(t,e))return!0;if(function(t,e){const i=iC(e),n=iC(t);if(!i||!n)return!1;if(i.type!==n.type||i.value!==n.value)return!1;if(!eC(t,e))return!1;if(!tC(t,e))return!1;return!0}(t,e))return!0;return!1}(t,i._previousEvent))return("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.warn("Event dropped due to being a duplicate of previously captured event."),null}catch(n){return i._previousEvent=t}return i._previousEvent=t}return t};i.id=this.name,t(i)}}function tC(t,e){let i=nC(t),n=nC(e);if(!i&&!n)return!0;if(i&&!n||!i&&n)return!1;if(i=i,n=n,n.length!==i.length)return!1;for(let r=0;r<n.length;r++){const t=n[r],e=i[r];if(t.filename!==e.filename||t.lineno!==e.lineno||t.colno!==e.colno||t.function!==e.function)return!1}return!0}function eC(t,e){let i=t.fingerprint,n=e.fingerprint;if(!i&&!n)return!0;if(i&&!n||!i&&n)return!1;i=i,n=n;try{return!(i.join("")!==n.join(""))}catch(r){return!1}}function iC(t){return t.exception&&t.exception.values&&t.exception.values[0]}function nC(t){const e=t.exception;if(e)try{return e.values[0].stacktrace.frames}catch(i){return}}QM.__initStatic();const rC="?";function aC(t,e,i,n){const r={filename:t,function:e,in_app:!0};return void 0!==i&&(r.lineno=i),void 0!==n&&(r.colno=n),r}const oC=/^\s*at (?:(.+?\)(?: \[.+\])?|.*?) ?\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,sC=/\((\S*)(?::(\d+))(?::(\d+))\)/,lC=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:[-a-z]+)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,cC=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,uC=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:[-a-z]+):.*?):(\d+)(?::(\d+))?\)?\s*$/i,hC=pT(...[[30,t=>{const e=oC.exec(t);if(e){if(e[2]&&0===e[2].indexOf("eval")){const t=sC.exec(e[2]);t&&(e[2]=t[1],e[3]=t[2],e[4]=t[3])}const[t,i]=pC(e[1]||rC,e[2]);return aC(i,t,e[3]?+e[3]:void 0,e[4]?+e[4]:void 0)}}],[50,t=>{const e=lC.exec(t);if(e){if(e[3]&&e[3].indexOf(" > eval")>-1){const t=cC.exec(e[3]);t&&(e[1]=e[1]||"eval",e[3]=t[1],e[4]=t[2],e[5]="")}let t=e[3],i=e[1]||rC;return[i,t]=pC(i,t),aC(t,i,e[4]?+e[4]:void 0,e[5]?+e[5]:void 0)}}],[40,t=>{const e=uC.exec(t);return e?aC(e[2],e[1]||rC,+e[3],e[4]?+e[4]:void 0):void 0}]]),pC=(t,e)=>{const i=-1!==t.indexOf("safari-extension"),n=-1!==t.indexOf("safari-web-extension");return i||n?[-1!==t.indexOf("@")?t.split("@")[0]:rC,i?`safari-extension:${e}`:`safari-web-extension:${e}`]:[t,e]};function dC(t){const e=[];function i(t){return e.splice(e.indexOf(t),1)[0]}return{$:e,add:function(n){if(!(void 0===t||e.length<t))return FE(new KT("Not adding Promise because buffer limit was reached."));const r=n();return-1===e.indexOf(r)&&e.push(r),r.then((()=>i(r))).then(null,(()=>i(r).then(null,(()=>{})))),r},drain:function(t){return new NE(((i,n)=>{let r=e.length;if(!r)return i(!0);const a=setTimeout((()=>{t&&t>0&&i(!1)}),t);e.forEach((t=>{OE(t).then((()=>{--r||(clearTimeout(a),i(!0))}),n)}))}))}}}function fC(t,{statusCode:e,headers:i},n=Date.now()){const r={...t},a=i&&i["x-sentry-rate-limits"],o=i&&i["retry-after"];if(a)for(const s of a.trim().split(",")){const[t,e]=s.split(":",2),i=parseInt(t,10),a=1e3*(isNaN(i)?60:i);if(e)for(const o of e.split(";"))r[o]=n+a;else r.all=n+a}else o?r.all=n+function(t,e=Date.now()){const i=parseInt(`${t}`,10);if(!isNaN(i))return 1e3*i;const n=Date.parse(`${t}`);return isNaN(n)?6e4:n-e}(o,n):429===e&&(r.all=n+6e4);return r}function mC(t,e,i=dC(t.bufferSize||30)){let n={};function r(r){const a=[];if(jT(r,((e,i)=>{const r=ZT(i);if(function(t,e,i=Date.now()){return function(t,e){return t[e]||t.all||0}(t,e)>i}(n,r)){const n=gC(e,i);t.recordDroppedEvent("ratelimit_backoff",r,n)}else a.push(e)})),0===a.length)return OE();const o=$T(r[0],a),s=e=>{jT(o,((i,n)=>{const r=gC(i,n);t.recordDroppedEvent(e,ZT(n),r)}))};return i.add((()=>e({body:GT(o,t.textEncoder)}).then((t=>(void 0!==t.statusCode&&(t.statusCode<200||t.statusCode>=300)&&("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.warn(`Sentry responded with status code ${t.statusCode} to sent event.`),n=fC(n,t),t)),(t=>{throw s("network_error"),t})))).then((t=>t),(t=>{if(t instanceof KT)return("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.error("Skipped sending event because buffer is full."),s("queue_overflow"),OE();throw t}))}return r.__sentry__baseTransport__=!0,{send:r,flush:t=>i.drain(t)}}function gC(t,e){if("event"===e||"transaction"===e)return Array.isArray(t)?t[1]:void 0}let _C;function yC(t,e=function(){if(_C)return _C;if(_T(vM.fetch))return _C=vM.fetch.bind(vM);const t=vM.document;let e=vM.fetch;if(t&&"function"===typeof t.createElement)try{const i=t.createElement("iframe");i.hidden=!0,t.head.appendChild(i);const n=i.contentWindow;n&&n.fetch&&(e=n.fetch),t.head.removeChild(i)}catch(i){("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",i)}return _C=e.bind(vM)}()){let i=0,n=0;return mC(t,(function(r){const a=r.body.length;i+=a,n++;const o={body:r.body,method:"POST",referrerPolicy:"origin",headers:t.headers,keepalive:i<=6e4&&n<15,...t.fetchOptions};try{return e(t.url,o).then((t=>(i-=a,n--,{statusCode:t.status,headers:{"x-sentry-rate-limits":t.headers.get("X-Sentry-Rate-Limits"),"retry-after":t.headers.get("Retry-After")}})))}catch(s){return _C=void 0,i-=a,n--,FE(s)}}))}function vC(t){return mC(t,(function(e){return new NE(((i,n)=>{const r=new XMLHttpRequest;r.onerror=n,r.onreadystatechange=()=>{4===r.readyState&&i({statusCode:r.status,headers:{"x-sentry-rate-limits":r.getResponseHeader("X-Sentry-Rate-Limits"),"retry-after":r.getResponseHeader("Retry-After")}})},r.open("POST",t.url);for(const e in t.headers)Object.prototype.hasOwnProperty.call(t.headers,e)&&r.setRequestHeader(e,t.headers[e]);r.send(e.body)}))}))}const xC=[new oT,new cT,new zM,new $M,new TM,new KM,new QM,new JM];function bC(t){t.startSession({ignoreDuration:!0}),t.captureSession()}const wC="baggage",SC="sentry-",EC=/^sentry-/;function TC(t){if(!t)return;return function(t){if(0===Object.keys(t).length)return;return Object.entries(t).reduce(((t,[e,i],n)=>{const r=`${encodeURIComponent(e)}=${encodeURIComponent(i)}`,a=0===n?r:`${t},${r}`;return a.length>8192?(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.warn(`Not adding key: ${e} with val: ${i} to baggage header due to exceeding baggage size limits.`),t):a}),"")}(Object.entries(t).reduce(((t,[e,i])=>(i&&(t[`sentry-${e}`]=i),t)),{}))}function MC(t){return t.split(",").map((t=>t.split("=").map((t=>decodeURIComponent(t.trim()))))).reduce(((t,[e,i])=>(t[e]=i,t)),{})}const CC=new RegExp("^[ \\t]*([0-9a-f]{32})?-?([0-9a-f]{16})?-?([01])?[ \\t]*$");function IC(t,e){const i=function(t){if(!t)return;const e=t.match(CC);if(!e)return;let i;return"1"===e[3]?i=!0:"0"===e[3]&&(i=!1),{traceId:e[1],parentSampled:i,parentSpanId:e[2]}}(t),n=function(t){if(!QS(t)&&!Array.isArray(t))return;let e={};if(Array.isArray(t))e=t.reduce(((t,e)=>({...t,...MC(e)})),{});else{if(!t)return;e=MC(t)}const i=Object.entries(e).reduce(((t,[e,i])=>(e.match(EC)&&(t[e.slice(SC.length)]=i),t)),{});return Object.keys(i).length>0?i:void 0}(e),{traceId:r,parentSpanId:a,parentSampled:o}=i||{},s={traceId:r||SE(),spanId:SE().substring(16),sampled:o};return a&&(s.parentSpanId=a),n&&(s.dsc=n),{traceparentData:i,dynamicSamplingContext:n,propagationContext:s}}function AC(t=SE(),e=SE().substring(16),i){let n="";return void 0!==i&&(n=i?"-1":"-0"),`${t}-${e}${n}`}class kC{constructor(t=1e3){this._maxlen=t,this.spans=[]}add(t){this.spans.length>this._maxlen?t.spanRecorder=void 0:this.spans.push(t)}}class RC{constructor(t={}){this.traceId=t.traceId||SE(),this.spanId=t.spanId||SE().substring(16),this.startTimestamp=t.startTimestamp||(0,DE.ph)(),this.tags=t.tags||{},this.data=t.data||{},this.instrumenter=t.instrumenter||"sentry",this.origin=t.origin||"manual",t.parentSpanId&&(this.parentSpanId=t.parentSpanId),"sampled"in t&&(this.sampled=t.sampled),t.op&&(this.op=t.op),t.description&&(this.description=t.description),t.name&&(this.description=t.name),t.status&&(this.status=t.status),t.endTimestamp&&(this.endTimestamp=t.endTimestamp)}startChild(t){const e=new RC({...t,parentSpanId:this.spanId,sampled:this.sampled,traceId:this.traceId});if(e.spanRecorder=this.spanRecorder,e.spanRecorder&&e.spanRecorder.add(e),e.transaction=this.transaction,("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&e.transaction){const i=`[Tracing] Starting '${t&&t.op||"< unknown op >"}' span on transaction '${e.transaction.name||"< unknown name >"}' (${e.transaction.spanId}).`;e.transaction.metadata.spanMetadata[e.spanId]={logMessage:i},PE.log(i)}return e}setTag(t,e){return this.tags={...this.tags,[t]:e},this}setData(t,e){return this.data={...this.data,[t]:e},this}setStatus(t){return this.status=t,this}setHttpStatus(t){this.setTag("http.status_code",String(t)),this.setData("http.response.status_code",t);const e=function(t){if(t<400&&t>=100)return"ok";if(t>=400&&t<500)switch(t){case 401:return"unauthenticated";case 403:return"permission_denied";case 404:return"not_found";case 409:return"already_exists";case 413:return"failed_precondition";case 429:return"resource_exhausted";default:return"invalid_argument"}if(t>=500&&t<600)switch(t){case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline_exceeded";default:return"internal_error"}return"unknown_error"}(t);return"unknown_error"!==e&&this.setStatus(e),this}setName(t){this.description=t}isSuccess(){return"ok"===this.status}finish(t){if(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&this.transaction&&this.transaction.spanId!==this.spanId){const{logMessage:t}=this.transaction.metadata.spanMetadata[this.spanId];t&&PE.log(t.replace("Starting","Finishing"))}this.endTimestamp="number"===typeof t?t:(0,DE.ph)()}toTraceparent(){return AC(this.traceId,this.spanId,this.sampled)}toContext(){return bE({data:this.data,description:this.description,endTimestamp:this.endTimestamp,op:this.op,parentSpanId:this.parentSpanId,sampled:this.sampled,spanId:this.spanId,startTimestamp:this.startTimestamp,status:this.status,tags:this.tags,traceId:this.traceId})}updateWithContext(t){return this.data=t.data||{},this.description=t.description,this.endTimestamp=t.endTimestamp,this.op=t.op,this.parentSpanId=t.parentSpanId,this.sampled=t.sampled,this.spanId=t.spanId||this.spanId,this.startTimestamp=t.startTimestamp||this.startTimestamp,this.status=t.status,this.tags=t.tags||{},this.traceId=t.traceId||this.traceId,this}getTraceContext(){return bE({data:Object.keys(this.data).length>0?this.data:void 0,description:this.description,op:this.op,parent_span_id:this.parentSpanId,span_id:this.spanId,status:this.status,tags:Object.keys(this.tags).length>0?this.tags:void 0,trace_id:this.traceId})}toJSON(){return bE({data:Object.keys(this.data).length>0?this.data:void 0,description:this.description,op:this.op,parent_span_id:this.parentSpanId,span_id:this.spanId,start_timestamp:this.startTimestamp,status:this.status,tags:Object.keys(this.tags).length>0?this.tags:void 0,timestamp:this.endTimestamp,trace_id:this.traceId,origin:this.origin})}}class zC extends RC{constructor(t,e){super(t),delete this.description,this._measurements={},this._contexts={},this._hub=e||XE(),this._name=t.name||"",this.metadata={source:"custom",...t.metadata,spanMetadata:{}},this._trimEnd=t.trimEnd,this.transaction=this;const i=this.metadata.dynamicSamplingContext;i&&(this._frozenDynamicSamplingContext={...i})}get name(){return this._name}set name(t){this.setName(t)}setName(t,e="custom"){this._name=t,this.metadata.source=e}initSpanRecorder(t=1e3){this.spanRecorder||(this.spanRecorder=new kC(t)),this.spanRecorder.add(this)}setContext(t,e){null===e?delete this._contexts[t]:this._contexts[t]=e}setMeasurement(t,e,i=""){this._measurements[t]={value:e,unit:i}}setMetadata(t){this.metadata={...this.metadata,...t}}finish(t){if(void 0!==this.endTimestamp)return;this.name||(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this.name="<unlabeled transaction>"),super.finish(t);const e=this._hub.getClient();if(e&&e.emit&&e.emit("finishTransaction",this),!0!==this.sampled)return("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log("[Tracing] Discarding transaction because its trace was not chosen to be sampled."),void(e&&e.recordDroppedEvent("sample_rate","transaction"));const i=this.spanRecorder?this.spanRecorder.spans.filter((t=>t!==this&&t.endTimestamp)):[];this._trimEnd&&i.length>0&&(this.endTimestamp=i.reduce(((t,e)=>t.endTimestamp&&e.endTimestamp?t.endTimestamp>e.endTimestamp?t:e:t)).endTimestamp);const n=this.metadata,r={contexts:{...this._contexts,trace:this.getTraceContext()},spans:i,start_timestamp:this.startTimestamp,tags:this.tags,timestamp:this.endTimestamp,transaction:this.name,type:"transaction",sdkProcessingMetadata:{...n,dynamicSamplingContext:this.getDynamicSamplingContext()},...n.source&&{transaction_info:{source:n.source}}};return Object.keys(this._measurements).length>0&&(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log("[Measurements] Adding measurements to transaction",JSON.stringify(this._measurements,void 0,2)),r.measurements=this._measurements),("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log(`[Tracing] Finishing ${this.op} transaction: ${this.name}.`),this._hub.captureEvent(r)}toContext(){return bE({...super.toContext(),name:this.name,trimEnd:this._trimEnd})}updateWithContext(t){return super.updateWithContext(t),this.name=t.name||"",this._trimEnd=t.trimEnd,this}getDynamicSamplingContext(){if(this._frozenDynamicSamplingContext)return this._frozenDynamicSamplingContext;const t=this._hub||XE(),e=t.getClient();if(!e)return{};const i=t.getScope(),n=eM(this.traceId,e,i),r=this.metadata.sampleRate;void 0!==r&&(n.sample_rate=`${r}`);const a=this.metadata.source;return a&&"url"!==a&&(n.transaction=this.name),void 0!==this.sampled&&(n.sampled=String(this.sampled)),n}setHub(t){this._hub=t}}const PC={idleTimeout:1e3,finalTimeout:3e4,heartbeatInterval:5e3},DC=["heartbeatFailed","idleTimeout","documentHidden","finalTimeout","externalFinish","cancelled"];class LC extends kC{constructor(t,e,i,n){super(n),this._pushActivity=t,this._popActivity=e,this.transactionSpanId=i}add(t){t.spanId!==this.transactionSpanId&&(t.finish=e=>{t.endTimestamp="number"===typeof e?e:(0,DE.ph)(),this._popActivity(t.spanId)},void 0===t.endTimestamp&&this._pushActivity(t.spanId)),super.add(t)}}class BC extends zC{constructor(t,e,i=PC.idleTimeout,n=PC.finalTimeout,r=PC.heartbeatInterval,a=!1){super(t,e),this._idleHub=e,this._idleTimeout=i,this._finalTimeout=n,this._heartbeatInterval=r,this._onScope=a,this.activities={},this._heartbeatCounter=0,this._finished=!1,this._idleTimeoutCanceledPermanently=!1,this._beforeFinishCallbacks=[],this._finishReason=DC[4],a&&(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log(`Setting idle transaction on scope. Span ID: ${this.spanId}`),e.configureScope((t=>t.setSpan(this)))),this._restartIdleTimeout(),setTimeout((()=>{this._finished||(this.setStatus("deadline_exceeded"),this._finishReason=DC[3],this.finish())}),this._finalTimeout)}finish(t=(0,DE.ph)()){if(this._finished=!0,this.activities={},"ui.action.click"===this.op&&this.setTag("finishReason",this._finishReason),this.spanRecorder){("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log("[Tracing] finishing IdleTransaction",new Date(1e3*t).toISOString(),this.op);for(const e of this._beforeFinishCallbacks)e(this,t);this.spanRecorder.spans=this.spanRecorder.spans.filter((e=>{if(e.spanId===this.spanId)return!0;e.endTimestamp||(e.endTimestamp=t,e.setStatus("cancelled"),("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log("[Tracing] cancelling span since transaction ended early",JSON.stringify(e,void 0,2)));const i=e.startTimestamp<t,n=(this._finalTimeout+this._idleTimeout)/1e3,r=e.endTimestamp-this.startTimestamp<n;if("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__){const t=JSON.stringify(e,void 0,2);i?r||PE.log("[Tracing] discarding Span since it finished after Transaction final timeout",t):PE.log("[Tracing] discarding Span since it happened after Transaction was finished",t)}return i&&r})),("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log("[Tracing] flushing IdleTransaction")}else("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log("[Tracing] No active IdleTransaction");if(this._onScope){const t=this._idleHub.getScope();t.getTransaction()===this&&t.setSpan(void 0)}return super.finish(t)}registerBeforeFinishCallback(t){this._beforeFinishCallbacks.push(t)}initSpanRecorder(t){if(!this.spanRecorder){const e=t=>{this._finished||this._pushActivity(t)},i=t=>{this._finished||this._popActivity(t)};this.spanRecorder=new LC(e,i,this.spanId,t),("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log("Starting heartbeat"),this._pingHeartbeat()}this.spanRecorder.add(this)}cancelIdleTimeout(t,{restartOnChildSpanChange:e}={restartOnChildSpanChange:!0}){this._idleTimeoutCanceledPermanently=!1===e,this._idleTimeoutID&&(clearTimeout(this._idleTimeoutID),this._idleTimeoutID=void 0,0===Object.keys(this.activities).length&&this._idleTimeoutCanceledPermanently&&(this._finishReason=DC[5],this.finish(t)))}setFinishReason(t){this._finishReason=t}_restartIdleTimeout(t){this.cancelIdleTimeout(),this._idleTimeoutID=setTimeout((()=>{this._finished||0!==Object.keys(this.activities).length||(this._finishReason=DC[1],this.finish(t))}),this._idleTimeout)}_pushActivity(t){this.cancelIdleTimeout(void 0,{restartOnChildSpanChange:!this._idleTimeoutCanceledPermanently}),("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log(`[Tracing] pushActivity: ${t}`),this.activities[t]=!0,("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log("[Tracing] new activities count",Object.keys(this.activities).length)}_popActivity(t){if(this.activities[t]&&(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log(`[Tracing] popActivity ${t}`),delete this.activities[t],("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log("[Tracing] new activities count",Object.keys(this.activities).length)),0===Object.keys(this.activities).length){const t=(0,DE.ph)();this._idleTimeoutCanceledPermanently?(this._finishReason=DC[5],this.finish(t)):this._restartIdleTimeout(t+this._idleTimeout/1e3)}}_beat(){if(this._finished)return;const t=Object.keys(this.activities).join("");t===this._prevHeartbeatString?this._heartbeatCounter++:this._heartbeatCounter=1,this._prevHeartbeatString=t,this._heartbeatCounter>=3?(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log("[Tracing] Transaction finished because of no change for 3 heart beats"),this.setStatus("deadline_exceeded"),this._finishReason=DC[0],this.finish()):this._pingHeartbeat()}_pingHeartbeat(){("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log(`pinging Heartbeat -> current counter: ${this._heartbeatCounter}`),setTimeout((()=>{this._beat()}),this._heartbeatInterval)}}function OC(t){if("boolean"===typeof __SENTRY_TRACING__&&!__SENTRY_TRACING__)return!1;const e=XE().getClient(),i=t||e&&e.getOptions();return!!i&&(i.enableTracing||"tracesSampleRate"in i||"tracesSampler"in i)}function FC(t){return(t||XE()).getScope().getTransaction()}let NC=!1;function UC(){const t=FC();if(t){const e="internal_error";("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log(`[Tracing] Transaction: ${e} -> Global error occured`),t.setStatus(e)}}function $C(){const t=this.getScope().getSpan();return t?{"sentry-trace":t.toTraceparent()}:{}}function VC(t,e,i){if(!OC(e))return t.sampled=!1,t;if(void 0!==t.sampled)return t.setMetadata({sampleRate:Number(t.sampled)}),t;let n;return"function"===typeof e.tracesSampler?(n=e.tracesSampler(i),t.setMetadata({sampleRate:Number(n)})):void 0!==i.parentSampled?n=i.parentSampled:"undefined"!==typeof e.tracesSampleRate?(n=e.tracesSampleRate,t.setMetadata({sampleRate:Number(n)})):(n=1,t.setMetadata({sampleRate:n})),function(t){if(rE(t)||"number"!==typeof t&&"boolean"!==typeof t)return("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.warn(`[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(t)} of type ${JSON.stringify(typeof t)}.`),!1;if(t<0||t>1)return("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.warn(`[Tracing] Given sample rate is invalid. Sample rate must be between 0 and 1. Got ${t}.`),!1;return!0}(n)?n?(t.sampled=Math.random()<n,t.sampled?(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log(`[Tracing] starting ${t.op} transaction - ${t.name}`),t):(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log(`[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = ${Number(n)})`),t)):(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log("[Tracing] Discarding transaction because "+("function"===typeof e.tracesSampler?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0")),t.sampled=!1,t):(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.warn("[Tracing] Discarding transaction because of invalid sample rate."),t.sampled=!1,t)}function jC(t,e){const i=this.getClient(),n=i&&i.getOptions()||{},r=n.instrumenter||"sentry",a=t.instrumenter||"sentry";r!==a&&(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.error(`A transaction was started with instrumenter=\`${a}\`, but the SDK is configured with the \`${r}\` instrumenter.\nThe transaction will not be sampled. Please use the ${r} instrumentation to start transactions.`),t.sampled=!1);let o=new zC(t,this);return o=VC(o,n,{parentSampled:t.parentSampled,transactionContext:t,...e}),o.sampled&&o.initSpanRecorder(n._experiments&&n._experiments.maxSpans),i&&i.emit&&i.emit("startTransaction",o),o}function qC(t,e,i,n,r,a,o){const s=t.getClient(),l=s&&s.getOptions()||{};let c=new BC(e,t,i,n,o,r);return c=VC(c,l,{parentSampled:e.parentSampled,transactionContext:e,...a}),c.sampled&&c.initSpanRecorder(l._experiments&&l._experiments.maxSpans),s&&s.emit&&s.emit("startTransaction",c),c}function GC(){const t=ZE();t.__SENTRY__&&(t.__SENTRY__.extensions=t.__SENTRY__.extensions||{},t.__SENTRY__.extensions.startTransaction||(t.__SENTRY__.extensions.startTransaction=jC),t.__SENTRY__.extensions.traceHeaders||(t.__SENTRY__.extensions.traceHeaders=$C),NC||(NC=!0,ST("error",UC),ST("unhandledrejection",UC)))}UC.tag="sentry_tracingErrorCallback";const HC=oE.n2;const WC=(t,e,i)=>{let n,r;return a=>{e.value>=0&&(a||i)&&(r=e.value-(n||0),(r||void 0===n)&&(n=e.value,e.delta=r,t(e)))}},ZC=()=>HC.__WEB_VITALS_POLYFILL__?HC.performance&&(performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]||(()=>{const t=HC.performance.timing,e=HC.performance.navigation.type,i={entryType:"navigation",startTime:0,type:2==e?"back_forward":1===e?"reload":"navigate"};for(const n in t)"navigationStart"!==n&&"toJSON"!==n&&(i[n]=Math.max(t[n]-t.navigationStart,0));return i})()):HC.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0],YC=()=>{const t=ZC();return t&&t.activationStart||0},XC=(t,e)=>{const i=ZC();let n="navigate";return i&&(n=HC.document.prerendering||YC()>0?"prerender":i.type.replace(/_/g,"-")),{name:t,value:"undefined"===typeof e?-1:e,rating:"good",delta:0,entries:[],id:`v3-${Date.now()}-${Math.floor(8999999999999*Math.random())+1e12}`,navigationType:n}},KC=(t,e,i)=>{try{if(PerformanceObserver.supportedEntryTypes.includes(t)){const n=new PerformanceObserver((t=>{e(t.getEntries())}));return n.observe(Object.assign({type:t,buffered:!0},i||{})),n}}catch(n){}},JC=(t,e)=>{const i=n=>{"pagehide"!==n.type&&"hidden"!==HC.document.visibilityState||(t(n),e&&(removeEventListener("visibilitychange",i,!0),removeEventListener("pagehide",i,!0)))};addEventListener("visibilitychange",i,!0),addEventListener("pagehide",i,!0)};let QC=-1;const tI=()=>(QC<0&&(QC="hidden"!==HC.document.visibilityState||HC.document.prerendering?1/0:0,JC((({timeStamp:t})=>{QC=t}),!0)),{get firstHiddenTime(){return QC}}),eI={};function iI(t){return"number"===typeof t&&isFinite(t)}function nI(t,{startTimestamp:e,...i}){return e&&t.startTimestamp>e&&(t.startTimestamp=e),t.startChild({startTimestamp:e,...i})}function rI(t){return t/1e3}function aI(){return HC&&HC.addEventListener&&HC.performance}let oI,sI,lI=0,cI={};function uI(){const t=aI();if(t&&DE.Z1){t.mark&&HC.performance.mark("sentry-tracing-init"),(t=>{const e=tI(),i=XC("FID");let n;const r=t=>{t.startTime<e.firstHiddenTime&&(i.value=t.processingStart-t.startTime,i.entries.push(t),n(!0))},a=t=>{t.forEach(r)},o=KC("first-input",a);n=WC(t,i),o&&JC((()=>{a(o.takeRecords()),o.disconnect()}),!0)})((t=>{const e=t.entries.pop();if(!e)return;const i=rI(DE.Z1),n=rI(e.startTime);("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log("[Measurements] Adding FID"),cI.fid={value:t.value,unit:"millisecond"},cI["mark.fid"]={value:i+n,unit:"second"}}));const e=(t=>{const e=XC("CLS",0);let i,n=0,r=[];const a=t=>{t.forEach((t=>{if(!t.hadRecentInput){const a=r[0],o=r[r.length-1];n&&0!==r.length&&t.startTime-o.startTime<1e3&&t.startTime-a.startTime<5e3?(n+=t.value,r.push(t)):(n=t.value,r=[t]),n>e.value&&(e.value=n,e.entries=r,i&&i())}}))},o=KC("layout-shift",a);if(o){i=WC(t,e);const n=()=>{a(o.takeRecords()),i(!0)};return JC(n),n}})((t=>{const e=t.entries.pop();e&&(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log("[Measurements] Adding CLS"),cI.cls={value:t.value,unit:""},sI=e)})),i=(t=>{const e=tI(),i=XC("LCP");let n;const r=t=>{const r=t[t.length-1];if(r){const t=Math.max(r.startTime-YC(),0);t<e.firstHiddenTime&&(i.value=t,i.entries=[r],n())}},a=KC("largest-contentful-paint",r);if(a){n=WC(t,i);const e=()=>{eI[i.id]||(r(a.takeRecords()),a.disconnect(),eI[i.id]=!0,n(!0))};return["keydown","click"].forEach((t=>{addEventListener(t,e,{once:!0,capture:!0})})),JC(e,!0),e}})((t=>{const e=t.entries.pop();e&&(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log("[Measurements] Adding LCP"),cI.lcp={value:t.value,unit:"millisecond"},oI=e)}));return()=>{e&&e(),i&&i()}}return()=>{}}function hI(t){const e=aI();if(!e||!HC.performance.getEntries||!DE.Z1)return;("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log("[Tracing] Adding & adjusting spans using Performance API");const i=rI(DE.Z1),n=e.getEntries();let r,a;if(n.slice(lI).forEach((e=>{const n=rI(e.startTime),o=rI(e.duration);if(!("navigation"===t.op&&i+n<t.startTimestamp))switch(e.entryType){case"navigation":!function(t,e,i){["unloadEvent","redirect","domContentLoadedEvent","loadEvent","connect"].forEach((n=>{pI(t,e,n,i)})),pI(t,e,"secureConnection",i,"TLS/SSL","connectEnd"),pI(t,e,"fetch",i,"cache","domainLookupStart"),pI(t,e,"domainLookup",i,"DNS"),function(t,e,i){nI(t,{op:"browser",origin:"auto.browser.browser.metrics",description:"request",startTimestamp:i+rI(e.requestStart),endTimestamp:i+rI(e.responseEnd)}),nI(t,{op:"browser",origin:"auto.browser.browser.metrics",description:"response",startTimestamp:i+rI(e.responseStart),endTimestamp:i+rI(e.responseEnd)})}(t,e,i)}(t,e,i),r=i+rI(e.responseStart),a=i+rI(e.requestStart);break;case"mark":case"paint":case"measure":{!function(t,e,i,n,r){const a=r+i,o=a+n;nI(t,{description:e.name,endTimestamp:o,op:e.entryType,origin:"auto.resource.browser.metrics",startTimestamp:a})}(t,e,n,o,i);const r=tI(),a=e.startTime<r.firstHiddenTime;"first-paint"===e.name&&a&&(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log("[Measurements] Adding FP"),cI.fp={value:e.startTime,unit:"millisecond"}),"first-contentful-paint"===e.name&&a&&(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log("[Measurements] Adding FCP"),cI.fcp={value:e.startTime,unit:"millisecond"});break}case"resource":{const r=e.name.replace(HC.location.origin,"");!function(t,e,i,n,r,a){if("xmlhttprequest"===e.initiatorType||"fetch"===e.initiatorType)return;const o={};"transferSize"in e&&(o["http.response_transfer_size"]=e.transferSize);"encodedBodySize"in e&&(o["http.response_content_length"]=e.encodedBodySize);"decodedBodySize"in e&&(o["http.decoded_response_content_length"]=e.decodedBodySize);"renderBlockingStatus"in e&&(o["resource.render_blocking_status"]=e.renderBlockingStatus);const s=a+n;nI(t,{description:i,endTimestamp:s+r,op:e.initiatorType?`resource.${e.initiatorType}`:"resource.other",origin:"auto.resource.browser.metrics",startTimestamp:s,data:o})}(t,e,r,n,o,i);break}}})),lI=Math.max(n.length-1,0),function(t){const e=HC.navigator;if(!e)return;const i=e.connection;i&&(i.effectiveType&&t.setTag("effectiveConnectionType",i.effectiveType),i.type&&t.setTag("connectionType",i.type),iI(i.rtt)&&(cI["connection.rtt"]={value:i.rtt,unit:"millisecond"}));iI(e.deviceMemory)&&t.setTag("deviceMemory",`${e.deviceMemory} GB`);iI(e.hardwareConcurrency)&&t.setTag("hardwareConcurrency",String(e.hardwareConcurrency))}(t),"pageload"===t.op){"number"===typeof r&&(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log("[Measurements] Adding TTFB"),cI.ttfb={value:1e3*(r-t.startTimestamp),unit:"millisecond"},"number"===typeof a&&a<=r&&(cI["ttfb.requestTime"]={value:1e3*(r-a),unit:"millisecond"})),["fcp","fp","lcp"].forEach((e=>{if(!cI[e]||i>=t.startTimestamp)return;const n=cI[e].value,r=i+rI(n),a=Math.abs(1e3*(r-t.startTimestamp)),o=a-n;("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log(`[Measurements] Normalized ${e} from ${n} to ${a} (${o})`),cI[e].value=a}));const e=cI["mark.fid"];e&&cI.fid&&(nI(t,{description:"first input delay",endTimestamp:e.value+rI(cI.fid.value),op:"ui.action",origin:"auto.ui.browser.metrics",startTimestamp:e.value}),delete cI["mark.fid"]),"fcp"in cI||delete cI.cls,Object.keys(cI).forEach((e=>{t.setMeasurement(e,cI[e].value,cI[e].unit)})),function(t){oI&&(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log("[Measurements] Adding LCP Data"),oI.element&&t.setTag("lcp.element",lE(oI.element)),oI.id&&t.setTag("lcp.id",oI.id),oI.url&&t.setTag("lcp.url",oI.url.trim().slice(0,200)),t.setTag("lcp.size",oI.size));sI&&sI.sources&&(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log("[Measurements] Adding CLS Data"),sI.sources.forEach(((e,i)=>t.setTag(`cls.source.${i+1}`,lE(e.node)))))}(t)}oI=void 0,sI=void 0,cI={}}function pI(t,e,i,n,r,a){const o=a?e[a]:e[`${i}End`],s=e[`${i}Start`];s&&o&&nI(t,{op:"browser",origin:"auto.browser.browser.metrics",description:r||i,startTimestamp:n+rI(s),endTimestamp:n+rI(o)})}const dI=["localhost",/^\/(?!\/)/],fI={traceFetch:!0,traceXHR:!0,enableHTTPTimings:!0,tracingOrigins:dI,tracePropagationTargets:dI};function mI(t){const{traceFetch:e,traceXHR:i,tracePropagationTargets:n,tracingOrigins:r,shouldCreateSpanForRequest:a,enableHTTPTimings:o}={traceFetch:fI.traceFetch,traceXHR:fI.traceXHR,...t},s="function"===typeof a?a:t=>!0,l=t=>function(t,e){return dE(t,e||dI)}(t,n||r),c={};e&&ST("fetch",(t=>{const e=function(t,e,i,n){if(!OC()||!t.fetchData)return;const r=e(t.fetchData.url);if(t.endTimestamp&&r){const e=t.fetchData.__span;if(!e)return;const i=n[e];if(i){if(t.response){i.setHttpStatus(t.response.status);const e=t.response&&t.response.headers&&t.response.headers.get("content-length"),n=parseInt(e);n>0&&i.setData("http.response_content_length",n)}else t.error&&i.setStatus("internal_error");i.finish(),delete n[e]}return}const a=XE(),o=a.getScope(),s=a.getClient(),l=o.getSpan(),{method:c,url:u}=t.fetchData,h=r&&l?l.startChild({data:{url:u,type:"fetch","http.method":c},description:`${c} ${u}`,op:"http.client",origin:"auto.http.browser"}):void 0;h&&(t.fetchData.__span=h.spanId,n[h.spanId]=h);if(i(t.fetchData.url)&&s){const e=t.args[0];t.args[1]=t.args[1]||{};const i=t.args[1];i.headers=function(t,e,i,n,r){const a=r||i.getSpan(),o=a&&a.transaction,{traceId:s,sampled:l,dsc:c}=i.getPropagationContext(),u=a?a.toTraceparent():AC(s,void 0,l),h=TC(o?o.getDynamicSamplingContext():c||eM(s,e,i)),p="undefined"!==typeof Request&&aE(t,Request)?t.headers:n.headers;if(p){if("undefined"!==typeof Headers&&aE(p,Headers)){const t=new Headers(p);return t.append("sentry-trace",u),h&&t.append(wC,h),t}if(Array.isArray(p)){const t=[...p,["sentry-trace",u]];return h&&t.push([wC,h]),t}{const t="baggage"in p?p.baggage:void 0,e=[];return Array.isArray(t)?e.push(...t):t&&e.push(t),h&&e.push(h),{...p,"sentry-trace":u,baggage:e.length>0?e.join(","):void 0}}}return{"sentry-trace":u,baggage:h}}(e,s,o,i,h)}return h}(t,s,l,c);o&&e&&gI(e)})),i&&ST("xhr",(t=>{const e=function(t,e,i,n){const r=t.xhr,a=r&&r.__sentry_xhr_v2__;if(!OC()||r&&r.__sentry_own_request__||!r||!a)return;const o=e(a.url);if(t.endTimestamp&&o){const t=r.__sentry_xhr_span_id__;if(!t)return;const e=n[t];return void(e&&(e.setHttpStatus(a.status_code),e.finish(),delete n[t]))}const s=XE(),l=s.getScope(),c=l.getSpan(),u=o&&c?c.startChild({data:{...a.data,type:"xhr","http.method":a.method,url:a.url},description:`${a.method} ${a.url}`,op:"http.client",origin:"auto.http.browser"}):void 0;u&&(r.__sentry_xhr_span_id__=u.spanId,n[r.__sentry_xhr_span_id__]=u);if(r.setRequestHeader&&i(a.url))if(u){const t=u&&u.transaction,e=TC(t&&t.getDynamicSamplingContext());yI(r,u.toTraceparent(),e)}else{const t=s.getClient(),{traceId:e,sampled:i,dsc:n}=l.getPropagationContext();yI(r,AC(e,void 0,i),TC(n||(t?eM(e,t,l):void 0)))}return u}(t,s,l,c);o&&e&&gI(e)}))}function gI(t){const e=t.data.url,i=new PerformanceObserver((n=>{n.getEntries().forEach((n=>{if(function(t){return"resource"===t.entryType&&"initiatorType"in t&&"string"===typeof t.nextHopProtocol&&("fetch"===t.initiatorType||"xmlhttprequest"===t.initiatorType)}(n)&&n.name.endsWith(e)){const e=function(t){const{name:e,version:i}=function(t){let e="unknown",i="unknown",n="";for(const r of t){if("/"===r){[e,i]=t.split("/");break}if(!isNaN(Number(r))){e="h"===n?"http":n,i=t.split(n)[1];break}n+=r}n===t&&(e=n);return{name:e,version:i}}(t.nextHopProtocol),n=[];if(n.push(["network.protocol.version",i],["network.protocol.name",e]),!DE.Z1)return n;return[...n,["http.request.redirect_start",_I(t.redirectStart)],["http.request.fetch_start",_I(t.fetchStart)],["http.request.domain_lookup_start",_I(t.domainLookupStart)],["http.request.domain_lookup_end",_I(t.domainLookupEnd)],["http.request.connect_start",_I(t.connectStart)],["http.request.secure_connection_start",_I(t.secureConnectionStart)],["http.request.connection_end",_I(t.connectEnd)],["http.request.request_start",_I(t.requestStart)],["http.request.response_start",_I(t.responseStart)],["http.request.response_end",_I(t.responseEnd)]]}(n);e.forEach((e=>t.setData(...e))),i.disconnect()}}))}));i.observe({entryTypes:["resource"]})}function _I(t=0){return((DE.Z1||performance.timeOrigin)+t)/1e3}function yI(t,e,i){try{t.setRequestHeader("sentry-trace",e),i&&t.setRequestHeader(wC,i)}catch(n){}}const vI={...PC,markBackgroundTransactions:!0,routingInstrumentation:function(t,e=!0,i=!0){if(!HC||!HC.location)return void(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.warn("Could not initialize routing instrumentation due to invalid location"));let n,r=HC.location.href;e&&(n=t({name:HC.location.pathname,startTimestamp:DE.Z1?DE.Z1/1e3:void 0,op:"pageload",origin:"auto.pageload.browser",metadata:{source:"url"}})),i&&ST("history",(({to:e,from:i})=>{void 0===i&&r&&-1!==r.indexOf(e)?r=void 0:i!==e&&(r=void 0,n&&(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log(`[Tracing] Finishing current transaction with op: ${n.op}`),n.finish()),n=t({name:HC.location.pathname,op:"navigation",origin:"auto.navigation.browser",metadata:{source:"url"}}))}))},startTransactionOnLocationChange:!0,startTransactionOnPageLoad:!0,enableLongTask:!0,_experiments:{},...fI};function xI(t){const e=(i=`meta[name=${t}]`,sE.document&&sE.document.querySelector?sE.document.querySelector(i):null);var i;return e?e.getAttribute("content"):void 0}var bI=i(422);const wI=oE.n2,SI="sentryReplaySession",EI="Unable to send Replay",TI=15e4,MI=5e3,CI=2e7;var II;function AI(t){const e=null===t||void 0===t?void 0:t.host;return Boolean(e&&e.shadowRoot&&e.shadowRoot===t)}function kI({maskInputOptions:t,tagName:e,type:i}){"option"===e.toLowerCase()&&(e="select");const n="string"===typeof i?i.toLowerCase():void 0;return t[e.toLowerCase()]||n&&t[n]||"password"===n||"input"===e&&!i&&t.text}function RI({input:t,maskInputSelector:e,unmaskInputSelector:i,maskInputOptions:n,tagName:r,type:a,value:o,maskInputFn:s}){let l=o||"";return i&&t.matches(i)||(t.hasAttribute("data-rr-is-password")&&(a="password"),(kI({maskInputOptions:n,tagName:r,type:a})||e&&t.matches(e))&&(l=s?s(l):"*".repeat(l.length))),l}!function(t){t[t.Document=0]="Document",t[t.DocumentType=1]="DocumentType",t[t.Element=2]="Element",t[t.Text=3]="Text",t[t.CDATA=4]="CDATA",t[t.Comment=5]="Comment"}(II||(II={}));const zI="__rrweb_original__";function PI(t){const e=t.type;return t.hasAttribute("data-rr-is-password")?"password":e?e.toLowerCase():null}function DI(t,e,i){return"string"===typeof i&&i.toLowerCase(),"INPUT"!==e||"radio"!==i&&"checkbox"!==i?t.value:t.getAttribute("value")||""}let LI=1;const BI=new RegExp("[^a-z0-9-_:]");function OI(t){return t?t.replace(/[\S]/g,"*"):""}function FI(t){try{const e=t.rules||t.cssRules;return e?Array.from(e).map(NI).join(""):null}catch(e){return null}}function NI(t){let e=t.cssText;if(function(t){return"styleSheet"in t}(t))try{e=FI(t.styleSheet)||e}catch(i){}return UI(e)}function UI(t){if(t.indexOf(":")>-1){const e=/(\[(?:[\w-]+)[^\\])(:(?:[\w-]+)\])/gm;return t.replace(e,"$1\\$2")}return t}let $I,VI;const jI=/url\((?:(')([^']*)'|(")(.*?)"|([^)]*))\)/gm,qI=/^(?!www\.|(?:http|ftp)s?:\/\/|[A-Za-z]:\\|\/\/|#).*/,GI=/^(data:)([^,]*),(.*)/i;function HI(t,e){return(t||"").replace(jI,((t,i,n,r,a,o)=>{const s=n||a||o,l=i||r||"";if(!s)return t;if(!qI.test(s))return`url(${l}${s}${l})`;if(GI.test(s))return`url(${l}${s}${l})`;if("/"===s[0])return`url(${l}${function(t){let e="";return e=t.indexOf("//")>-1?t.split("/").slice(0,3).join("/"):t.split("/")[0],e=e.split("?")[0],e}(e)+s}${l})`;const c=e.split("/"),u=s.split("/");c.pop();for(const e of u)"."!==e&&(".."===e?c.pop():c.push(e));return`url(${l}${c.join("/")}${l})`}))}const WI=/^[^ \t\n\r\u000c]+/,ZI=/^[, \t\n\r\u000c]+/;function YI(t,e){if(!e||""===e.trim())return e;const i=t.createElement("a");return i.href=e,i.href}function XI(){const t=document.createElement("a");return t.href="",t.href}function KI(t,e,i,n,r,a,o,s){if(!r)return r;const l=n.toLowerCase(),c=i.toLowerCase();return"src"===l||"href"===l||"xlink:href"===l&&"#"!==r[0]?YI(t,r):"background"!==l||"table"!==c&&"td"!==c&&"th"!==c?"srcset"===l?function(t,e){if(""===e.trim())return e;let i=0;function n(t){let n,r=t.exec(e.substring(i));return r?(n=r[0],i+=n.length,n):""}let r=[];for(;n(ZI),!(i>=e.length);){let a=n(WI);if(","===a.slice(-1))a=YI(t,a.substring(0,a.length-1)),r.push(a);else{let n="";a=YI(t,a);let o=!1;for(;;){let t=e.charAt(i);if(""===t){r.push((a+n).trim());break}if(o)")"===t&&(o=!1);else{if(","===t){i+=1,r.push((a+n).trim());break}"("===t&&(o=!0)}n+=t,i+=1}}}return r.join(", ")}(t,r):"style"===l?HI(r,XI()):"object"===c&&"data"===l?YI(t,r):a&&function(t,e,i,n){if(n&&t.matches(n))return!1;return["placeholder","title","aria-label"].indexOf(e)>-1||"input"===i&&"value"===e&&t.hasAttribute("type")&&["submit","button"].indexOf(t.getAttribute("type").toLowerCase())>-1}(e,l,c,o)?s?s(r):OI(r):r:YI(t,r)}function JI(t,e,i,n,r){if(!t)return!1;if(t.nodeType!==t.ELEMENT_NODE)return JI(t.parentNode,e,i,n,r);if(n&&(t.matches(n)||t.closest(n)))return!1;if(r)return!0;if("string"===typeof e){if(t.classList.contains(e))return!0}else for(let a=0;a<t.classList.length;a++){const i=t.classList[a];if(e.test(i))return!0}return!(!i||!t.matches(i))||JI(t.parentNode,e,i,n,r)}function QI(t,e){var i;const{doc:n,blockClass:r,blockSelector:a,unblockSelector:o,maskTextClass:s,maskTextSelector:l,unmaskTextSelector:c,inlineStylesheet:u,maskInputSelector:h,unmaskInputSelector:p,maskAllText:d,maskInputOptions:f={},maskTextFn:m,maskInputFn:g,dataURLOptions:_={},inlineImages:y,recordCanvas:v,keepIframeSrcFn:x}=e;let b;if(n.__sn){const t=n.__sn.id;b=1===t?void 0:t}switch(t.nodeType){case t.DOCUMENT_NODE:return"CSS1Compat"!==t.compatMode?{type:II.Document,childNodes:[],compatMode:t.compatMode,rootId:b}:{type:II.Document,childNodes:[],rootId:b};case t.DOCUMENT_TYPE_NODE:return{type:II.DocumentType,name:t.name,publicId:t.publicId,systemId:t.systemId,rootId:b};case t.ELEMENT_NODE:const e=function(t,e,i,n){if(n&&t.matches(n))return!1;if("string"===typeof e){if(t.classList.contains(e))return!0}else for(let r=0;r<t.classList.length;r++){const i=t.classList[r];if(e.test(i))return!0}return!!i&&t.matches(i)}(t,r,a,o),E=function(t){if(t instanceof HTMLFormElement)return"form";const e=t.tagName.toLowerCase().trim();return BI.test(e)?"div":e}(t);let T={};for(const{name:i,value:r}of Array.from(t.attributes))iA(E,i)||(T[i]=KI(n,t,E,i,r,d,c,m));if("link"===E&&u){const e=Array.from(n.styleSheets).find((e=>e.href===t.href));let i=null;e&&(i=FI(e)),i&&(delete T.rel,delete T.href,T._cssText=HI(i,e.href))}if("style"===E&&t.sheet&&!(t.innerText||t.textContent||"").trim().length){const e=FI(t.sheet);e&&(T._cssText=HI(e,XI()))}if("input"===E||"textarea"===E||"select"===E||"option"===E){const e=t,i=PI(e),n=DI(e,E.toUpperCase(),i),r=t.checked;"submit"!==i&&"button"!==i&&n&&(T.value=RI({input:e,type:i,tagName:E,value:n,maskInputSelector:h,unmaskInputSelector:p,maskInputOptions:f,maskInputFn:g})),r&&(T.checked=r)}if("option"===E&&(t.selected&&!f.select?T.selected=!0:delete T.selected),"canvas"===E&&v)if("2d"===t.__context)(function(t){const e=t.getContext("2d");if(!e)return!0;for(let i=0;i<t.width;i+=50)for(let n=0;n<t.height;n+=50){const r=e.getImageData,a=zI in r?r.__rrweb_original__:r;if(new Uint32Array(a.call(e,i,n,Math.min(50,t.width-i),Math.min(50,t.height-n)).data.buffer).some((t=>0!==t)))return!1}return!0})(t)||(T.rr_dataURL=t.toDataURL(_.type,_.quality));else if(!("__context"in t)){const e=t.toDataURL(_.type,_.quality),i=document.createElement("canvas");i.width=t.width,i.height=t.height;e!==i.toDataURL(_.type,_.quality)&&(T.rr_dataURL=e)}if("img"===E&&y){$I||($I=n.createElement("canvas"),VI=$I.getContext("2d"));const e=t,i=e.crossOrigin;e.crossOrigin="anonymous";const r=()=>{try{$I.width=e.naturalWidth,$I.height=e.naturalHeight,VI.drawImage(e,0,0),T.rr_dataURL=$I.toDataURL(_.type,_.quality)}catch(kx){console.warn(`Cannot inline img src=${e.currentSrc}! Error: ${kx}`)}i?T.crossOrigin=i:delete T.crossOrigin};e.complete&&0!==e.naturalWidth?r():e.onload=r}if("audio"!==E&&"video"!==E||(T.rr_mediaState=t.paused?"paused":"played",T.rr_mediaCurrentTime=t.currentTime),t.scrollLeft&&(T.rr_scrollLeft=t.scrollLeft),t.scrollTop&&(T.rr_scrollTop=t.scrollTop),e){const{width:e,height:i}=t.getBoundingClientRect();T={class:T.class,rr_width:`${e}px`,rr_height:`${i}px`}}return"iframe"!==E||x(T.src)||(t.contentDocument||(T.rr_src=T.src),delete T.src),{type:II.Element,tagName:E,attributes:T,childNodes:[],isSVG:(S=t,Boolean("svg"===S.tagName||S.ownerSVGElement)||void 0),needBlock:e,rootId:b};case t.TEXT_NODE:const M=t.parentNode&&t.parentNode.tagName;let C=t.textContent;const I="STYLE"===M||void 0,A="SCRIPT"===M||void 0;if(I&&C){try{t.nextSibling||t.previousSibling||(null===(i=t.parentNode.sheet)||void 0===i?void 0:i.cssRules)&&(C=(w=t.parentNode.sheet).cssRules?Array.from(w.cssRules).map((t=>t.cssText?UI(t.cssText):"")).join(""):"")}catch(kx){console.warn(`Cannot get CSS styles from text's parentNode. Error: ${kx}`,t)}C=HI(C,XI())}if(A&&(C="SCRIPT_PLACEHOLDER"),"TEXTAREA"===M&&C)C="";else if("OPTION"===M&&C){C=RI({input:t.parentNode,type:null,tagName:M,value:C,maskInputSelector:h,unmaskInputSelector:p,maskInputOptions:f,maskInputFn:g})}else!I&&!A&&JI(t,s,l,c,d)&&C&&(C=m?m(C):OI(C));return{type:II.Text,textContent:C||"",isStyle:I,rootId:b};case t.CDATA_SECTION_NODE:return{type:II.CDATA,textContent:"",rootId:b};case t.COMMENT_NODE:return{type:II.Comment,textContent:t.textContent||"",rootId:b};default:return!1}var w,S}function tA(t){return void 0===t||null===t?"":t.toLowerCase()}function eA(t,e){const{doc:i,map:n,blockClass:r,blockSelector:a,unblockSelector:o,maskTextClass:s,maskTextSelector:l,unmaskTextSelector:c,skipChild:u=!1,inlineStylesheet:h=!0,maskInputSelector:p,unmaskInputSelector:d,maskAllText:f,maskInputOptions:m={},maskTextFn:g,maskInputFn:_,slimDOMOptions:y,dataURLOptions:v={},inlineImages:x=!1,recordCanvas:b=!1,onSerialize:w,onIframeLoad:S,iframeLoadTimeout:E=5e3,keepIframeSrcFn:T=(()=>!1)}=e;let{preserveWhiteSpace:M=!0}=e;const C=QI(t,{doc:i,blockClass:r,blockSelector:a,unblockSelector:o,maskTextClass:s,maskTextSelector:l,unmaskTextSelector:c,inlineStylesheet:h,maskInputSelector:p,unmaskInputSelector:d,maskAllText:f,maskInputOptions:m,maskTextFn:g,maskInputFn:_,dataURLOptions:v,inlineImages:x,recordCanvas:b,keepIframeSrcFn:T});if(!C)return console.warn(t,"not serialized"),null;let I;I="__sn"in t?t.__sn.id:!function(t,e){if(e.comment&&t.type===II.Comment)return!0;if(t.type===II.Element){if(e.script&&("script"===t.tagName||"link"===t.tagName&&("preload"===t.attributes.rel||"modulepreload"===t.attributes.rel)&&"script"===t.attributes.as||"link"===t.tagName&&"prefetch"===t.attributes.rel&&"string"===typeof t.attributes.href&&t.attributes.href.endsWith(".js")))return!0;if(e.headFavicon&&("link"===t.tagName&&"shortcut icon"===t.attributes.rel||"meta"===t.tagName&&(tA(t.attributes.name).match(/^msapplication-tile(image|color)$/)||"application-name"===tA(t.attributes.name)||"icon"===tA(t.attributes.rel)||"apple-touch-icon"===tA(t.attributes.rel)||"shortcut icon"===tA(t.attributes.rel))))return!0;if("meta"===t.tagName){if(e.headMetaDescKeywords&&tA(t.attributes.name).match(/^description|keywords$/))return!0;if(e.headMetaSocial&&(tA(t.attributes.property).match(/^(og|twitter|fb):/)||tA(t.attributes.name).match(/^(og|twitter):/)||"pinterest"===tA(t.attributes.name)))return!0;if(e.headMetaRobots&&("robots"===tA(t.attributes.name)||"googlebot"===tA(t.attributes.name)||"bingbot"===tA(t.attributes.name)))return!0;if(e.headMetaHttpEquiv&&void 0!==t.attributes["http-equiv"])return!0;if(e.headMetaAuthorship&&("author"===tA(t.attributes.name)||"generator"===tA(t.attributes.name)||"framework"===tA(t.attributes.name)||"publisher"===tA(t.attributes.name)||"progid"===tA(t.attributes.name)||tA(t.attributes.property).match(/^article:/)||tA(t.attributes.property).match(/^product:/)))return!0;if(e.headMetaVerification&&("google-site-verification"===tA(t.attributes.name)||"yandex-verification"===tA(t.attributes.name)||"csrf-token"===tA(t.attributes.name)||"p:domain_verify"===tA(t.attributes.name)||"verify-v1"===tA(t.attributes.name)||"verification"===tA(t.attributes.name)||"shopify-checkout-api-token"===tA(t.attributes.name)))return!0}}return!1}(C,y)&&(M||C.type!==II.Text||C.isStyle||C.textContent.replace(/^\s+|\s+$/gm,"").length)?LI++:-2;const A=Object.assign(C,{id:I});if(t.__sn=A,-2===I)return null;n[I]=t,w&&w(t);let k=!u;if(A.type===II.Element&&(k=k&&!A.needBlock,delete A.needBlock,t.shadowRoot&&(A.isShadowHost=!0)),(A.type===II.Document||A.type===II.Element)&&k){y.headWhitespace&&C.type===II.Element&&"head"===C.tagName&&(M=!1);const e={doc:i,map:n,blockClass:r,blockSelector:a,unblockSelector:o,maskTextClass:s,maskTextSelector:l,unmaskTextSelector:c,skipChild:u,inlineStylesheet:h,maskInputSelector:p,unmaskInputSelector:d,maskAllText:f,maskInputOptions:m,maskTextFn:g,maskInputFn:_,slimDOMOptions:y,dataURLOptions:v,inlineImages:x,recordCanvas:b,preserveWhiteSpace:M,onSerialize:w,onIframeLoad:S,iframeLoadTimeout:E,keepIframeSrcFn:T};for(const i of Array.from(t.childNodes)){const t=eA(i,e);t&&A.childNodes.push(t)}if(function(t){return t.nodeType===t.ELEMENT_NODE}(t)&&t.shadowRoot)for(const i of Array.from(t.shadowRoot.childNodes)){const t=eA(i,e);t&&(t.isShadow=!0,A.childNodes.push(t))}}return t.parentNode&&AI(t.parentNode)&&(A.isShadow=!0),A.type===II.Element&&"iframe"===A.tagName&&function(t,e,i){const n=t.contentWindow;if(!n)return;let r,a=!1;try{r=n.document.readyState}catch(s){return}if("complete"!==r){const n=setTimeout((()=>{a||(e(),a=!0)}),i);return void t.addEventListener("load",(()=>{clearTimeout(n),a=!0,e()}))}const o="about:blank";n.location.href===o&&t.src!==o&&""!==t.src?t.addEventListener("load",e):setTimeout(e,0)}(t,(()=>{const e=t.contentDocument;if(e&&S){const i=eA(e,{doc:e,map:n,blockClass:r,blockSelector:a,unblockSelector:o,maskTextClass:s,maskTextSelector:l,unmaskTextSelector:c,skipChild:!1,inlineStylesheet:h,maskInputSelector:p,unmaskInputSelector:d,maskAllText:f,maskInputOptions:m,maskTextFn:g,maskInputFn:_,slimDOMOptions:y,dataURLOptions:v,inlineImages:x,recordCanvas:b,preserveWhiteSpace:M,onSerialize:w,onIframeLoad:S,iframeLoadTimeout:E,keepIframeSrcFn:T});i&&S(t,i)}}),E),A}function iA(t,e,i){return("video"===t||"audio"===t)&&"autoplay"===e}var nA,rA,aA,oA,sA,lA;function cA(t,e,i=document){const n={capture:!0,passive:!0};return i.addEventListener(t,e,n),()=>i.removeEventListener(t,e,n)}!function(t){t[t.DomContentLoaded=0]="DomContentLoaded",t[t.Load=1]="Load",t[t.FullSnapshot=2]="FullSnapshot",t[t.IncrementalSnapshot=3]="IncrementalSnapshot",t[t.Meta=4]="Meta",t[t.Custom=5]="Custom",t[t.Plugin=6]="Plugin"}(nA||(nA={})),function(t){t[t.Mutation=0]="Mutation",t[t.MouseMove=1]="MouseMove",t[t.MouseInteraction=2]="MouseInteraction",t[t.Scroll=3]="Scroll",t[t.ViewportResize=4]="ViewportResize",t[t.Input=5]="Input",t[t.TouchMove=6]="TouchMove",t[t.MediaInteraction=7]="MediaInteraction",t[t.StyleSheetRule=8]="StyleSheetRule",t[t.CanvasMutation=9]="CanvasMutation",t[t.Font=10]="Font",t[t.Log=11]="Log",t[t.Drag=12]="Drag",t[t.StyleDeclaration=13]="StyleDeclaration"}(rA||(rA={})),function(t){t[t.MouseUp=0]="MouseUp",t[t.MouseDown=1]="MouseDown",t[t.Click=2]="Click",t[t.ContextMenu=3]="ContextMenu",t[t.DblClick=4]="DblClick",t[t.Focus=5]="Focus",t[t.Blur=6]="Blur",t[t.TouchStart=7]="TouchStart",t[t.TouchMove_Departed=8]="TouchMove_Departed",t[t.TouchEnd=9]="TouchEnd",t[t.TouchCancel=10]="TouchCancel"}(aA||(aA={})),function(t){t[t["2D"]=0]="2D",t[t.WebGL=1]="WebGL",t[t.WebGL2=2]="WebGL2"}(oA||(oA={})),function(t){t[t.Play=0]="Play",t[t.Pause=1]="Pause",t[t.Seeked=2]="Seeked",t[t.VolumeChange=3]="VolumeChange"}(sA||(sA={})),function(t){t.Start="start",t.Pause="pause",t.Resume="resume",t.Resize="resize",t.Finish="finish",t.FullsnapshotRebuilded="fullsnapshot-rebuilded",t.LoadStylesheetStart="load-stylesheet-start",t.LoadStylesheetEnd="load-stylesheet-end",t.SkipStart="skip-start",t.SkipEnd="skip-end",t.MouseInteraction="mouse-interaction",t.EventCast="event-cast",t.CustomEvent="custom-event",t.Flush="flush",t.StateChange="state-change",t.PlayBack="play-back"}(lA||(lA={}));const uA="Please stop import mirror directly. Instead of that,\r\nnow you can use replayer.getMirror() to access the mirror instance of a replayer,\r\nor you can use record.mirror to access the mirror instance during recording.";let hA={map:{},getId:()=>(console.error(uA),-1),getNode:()=>(console.error(uA),null),removeNodeFromMap(){console.error(uA)},has:()=>(console.error(uA),!1),reset(){console.error(uA)}};function pA(t,e,i={}){let n=null,r=0;return function(a){let o=Date.now();r||!1!==i.leading||(r=o);let s=e-(o-r),l=this,c=arguments;s<=0||s>e?(n&&(clearTimeout(n),n=null),r=o,t.apply(l,c)):n||!1===i.trailing||(n=setTimeout((()=>{r=!1===i.leading?0:Date.now(),n=null,t.apply(l,c)}),s))}}function dA(t,e,i,n,r=window){const a=r.Object.getOwnPropertyDescriptor(t,e);return r.Object.defineProperty(t,e,n?i:{set(t){setTimeout((()=>{i.set.call(this,t)}),0),a&&a.set&&a.set.call(this,t)}}),()=>dA(t,e,a||{},!0)}function fA(t,e,i){try{if(!(e in t))return()=>{};const n=t[e],r=i(n);return"function"===typeof r&&(r.prototype=r.prototype||{},Object.defineProperties(r,{__rrweb_original__:{enumerable:!1,value:n}})),t[e]=r,()=>{t[e]=n}}catch(n){return()=>{}}}function mA(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight}function gA(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth}function _A(t,e,i,n){if(!t)return!1;if(t.nodeType===t.ELEMENT_NODE){let r=!1;const a=n&&t.matches(n);return"string"===typeof e?r=void 0!==t.closest?!a&&null!==t.closest("."+e):!a&&t.classList.contains(e):!a&&t.classList.forEach((t=>{e.test(t)&&(r=!0)})),!r&&i&&(r=t.matches(i)),!a&&r||_A(t.parentNode,e,i,n)}return t.nodeType,t.TEXT_NODE,_A(t.parentNode,e,i,n)}function yA(t){return"__sn"in t&&-2===t.__sn.id}function vA(t,e){if(AI(t))return!1;const i=e.getId(t);return!e.has(i)||(!t.parentNode||t.parentNode.nodeType!==t.DOCUMENT_NODE)&&(!t.parentNode||vA(t.parentNode,e))}function xA(t){return Boolean(t.changedTouches)}function bA(t){return"__sn"in t&&(t.__sn.type===II.Element&&"iframe"===t.__sn.tagName)}function wA(t){return Boolean(null===t||void 0===t?void 0:t.shadowRoot)}function SA(t){return"__ln"in t}"undefined"!==typeof window&&window.Proxy&&window.Reflect&&(hA=new Proxy(hA,{get:(t,e,i)=>("map"===e&&console.error(uA),Reflect.get(t,e,i))}));class EA{constructor(){this.length=0,this.head=null}get(t){if(t>=this.length)throw new Error("Position outside of list range");let e=this.head;for(let i=0;i<t;i++)e=(null===e||void 0===e?void 0:e.next)||null;return e}addNode(t){const e={value:t,previous:null,next:null};if(t.__ln=e,t.previousSibling&&SA(t.previousSibling)){const i=t.previousSibling.__ln.next;e.next=i,e.previous=t.previousSibling.__ln,t.previousSibling.__ln.next=e,i&&(i.previous=e)}else if(t.nextSibling&&SA(t.nextSibling)&&t.nextSibling.__ln.previous){const i=t.nextSibling.__ln.previous;e.previous=i,e.next=t.nextSibling.__ln,t.nextSibling.__ln.previous=e,i&&(i.next=e)}else this.head&&(this.head.previous=e),e.next=this.head,this.head=e;this.length++}removeNode(t){const e=t.__ln;this.head&&(e.previous?(e.previous.next=e.next,e.next&&(e.next.previous=e.previous)):(this.head=e.next,this.head&&(this.head.previous=null)),t.__ln&&delete t.__ln,this.length--)}}const TA=(t,e)=>`${t}@${e}`;function MA(t){return"__sn"in t}class CA{constructor(){this.frozen=!1,this.locked=!1,this.texts=[],this.attributes=[],this.removes=[],this.mapRemoves=[],this.movedMap={},this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.processMutations=t=>{t.forEach(this.processMutation),this.emit()},this.emit=()=>{if(this.frozen||this.locked)return;const t=[],e=new EA,i=t=>{let e=t,i=-2;for(;-2===i;)e=e&&e.nextSibling,i=e&&this.mirror.getId(e);return i},n=n=>{var r,a,o,s,l;const c=n.getRootNode?null===(r=n.getRootNode())||void 0===r?void 0:r.host:null;let u=c;for(;null===(o=null===(a=null===u||void 0===u?void 0:u.getRootNode)||void 0===a?void 0:a.call(u))||void 0===o?void 0:o.host;)u=(null===(l=null===(s=null===u||void 0===u?void 0:u.getRootNode)||void 0===s?void 0:s.call(u))||void 0===l?void 0:l.host)||null;const h=!this.doc.contains(n)&&(!u||!this.doc.contains(u));if(!n.parentNode||h)return;const p=AI(n.parentNode)?this.mirror.getId(c):this.mirror.getId(n.parentNode),d=i(n);if(-1===p||-1===d)return e.addNode(n);let f=eA(n,{doc:this.doc,map:this.mirror.map,blockClass:this.blockClass,blockSelector:this.blockSelector,unblockSelector:this.unblockSelector,maskTextClass:this.maskTextClass,maskTextSelector:this.maskTextSelector,unmaskTextSelector:this.unmaskTextSelector,maskInputSelector:this.maskInputSelector,unmaskInputSelector:this.unmaskInputSelector,skipChild:!0,inlineStylesheet:this.inlineStylesheet,maskAllText:this.maskAllText,maskInputOptions:this.maskInputOptions,maskTextFn:this.maskTextFn,maskInputFn:this.maskInputFn,slimDOMOptions:this.slimDOMOptions,recordCanvas:this.recordCanvas,inlineImages:this.inlineImages,onSerialize:t=>{bA(t)&&this.iframeManager.addIframe(t),wA(n)&&this.shadowDomManager.addShadowRoot(n.shadowRoot,document)},onIframeLoad:(t,e)=>{this.iframeManager.attachIframe(t,e),this.shadowDomManager.observeAttachShadow(t)}});f&&t.push({parentId:p,nextId:d,node:f})};for(;this.mapRemoves.length;)this.mirror.removeNodeFromMap(this.mapRemoves.shift());for(const o of this.movedSet)AA(this.removes,o,this.mirror)&&!this.movedSet.has(o.parentNode)||n(o);for(const o of this.addedSet)kA(this.droppedSet,o)||AA(this.removes,o,this.mirror)?kA(this.movedSet,o)?n(o):this.droppedSet.add(o):n(o);let r=null;for(;e.length;){let t=null;if(r){const e=this.mirror.getId(r.value.parentNode),n=i(r.value);-1!==e&&-1!==n&&(t=r)}if(!t)for(let n=e.length-1;n>=0;n--){const r=e.get(n);if(r){const e=this.mirror.getId(r.value.parentNode),n=i(r.value);if(-1!==e&&-1!==n){t=r;break}}}if(!t){for(;e.head;)e.removeNode(e.head.value);break}r=t.previous,e.removeNode(t.value),n(t.value)}const a={texts:this.texts.map((t=>({id:this.mirror.getId(t.node),value:t.value}))).filter((t=>this.mirror.has(t.id))),attributes:this.attributes.map((t=>({id:this.mirror.getId(t.node),attributes:t.attributes}))).filter((t=>this.mirror.has(t.id))),removes:this.removes,adds:t};(a.texts.length||a.attributes.length||a.removes.length||a.adds.length)&&(this.texts=[],this.attributes=[],this.removes=[],this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.movedMap={},this.mutationCb(a))},this.processMutation=t=>{if(!yA(t.target))switch(t.type){case"characterData":{const e=t.target.textContent;_A(t.target,this.blockClass,this.blockSelector,this.unblockSelector)||e===t.oldValue||this.texts.push({value:JI(t.target,this.maskTextClass,this.maskTextSelector,this.unmaskTextSelector,this.maskAllText)&&e?this.maskTextFn?this.maskTextFn(e):e.replace(/[\S]/g,"*"):e,node:t.target});break}case"attributes":{const i=t.target;let n=i.getAttribute(t.attributeName);if("value"===t.attributeName&&(n=RI({input:i,maskInputSelector:this.maskInputSelector,unmaskInputSelector:this.unmaskInputSelector,maskInputOptions:this.maskInputOptions,tagName:i.tagName,type:i.getAttribute("type"),value:n,maskInputFn:this.maskInputFn})),_A(t.target,this.blockClass,this.blockSelector,this.unblockSelector)||n===t.oldValue)return;let r=this.attributes.find((e=>e.node===t.target));if(r||(r={node:t.target,attributes:{}},this.attributes.push(r)),"type"===t.attributeName&&"INPUT"===i.tagName&&"password"===(t.oldValue||"").toLowerCase()&&i.setAttribute("data-rr-is-password","true"),"style"===t.attributeName){const n=this.doc.createElement("span");t.oldValue&&n.setAttribute("style",t.oldValue),void 0!==r.attributes.style&&null!==r.attributes.style||(r.attributes.style={});try{const t=r.attributes.style;for(const e of Array.from(i.style)){const r=i.style.getPropertyValue(e),a=i.style.getPropertyPriority(e);r===n.style.getPropertyValue(e)&&a===n.style.getPropertyPriority(e)||(t[e]=""===a?r:[r,a])}for(const e of Array.from(n.style))""===i.style.getPropertyValue(e)&&(t[e]=!1)}catch(e){console.warn("[rrweb] Error when parsing update to style attribute:",e)}}else{const e=t.target;r.attributes[t.attributeName]=KI(this.doc,e,e.tagName,t.attributeName,n,this.maskAllText,this.unmaskTextSelector,this.maskTextFn)}break}case"childList":t.addedNodes.forEach((e=>this.genAdds(e,t.target))),t.removedNodes.forEach((e=>{const i=this.mirror.getId(e),n=AI(t.target)?this.mirror.getId(t.target.host):this.mirror.getId(t.target);_A(t.target,this.blockClass,this.blockSelector,this.unblockSelector)||yA(e)||(this.addedSet.has(e)?(IA(this.addedSet,e),this.droppedSet.add(e)):this.addedSet.has(t.target)&&-1===i||vA(t.target,this.mirror)||(this.movedSet.has(e)&&this.movedMap[TA(i,n)]?IA(this.movedSet,e):this.removes.push({parentId:n,id:i,isShadow:!!AI(t.target)||void 0})),this.mapRemoves.push(e))}))}},this.genAdds=(t,e)=>{if(!e||!_A(e,this.blockClass,this.blockSelector,this.unblockSelector)){if(MA(t)){if(yA(t))return;this.movedSet.add(t);let i=null;e&&MA(e)&&(i=e.__sn.id),i&&(this.movedMap[TA(t.__sn.id,i)]=!0)}else this.addedSet.add(t),this.droppedSet.delete(t);_A(t,this.blockClass,this.blockSelector,this.unblockSelector)||t.childNodes.forEach((t=>this.genAdds(t)))}}}init(t){["mutationCb","blockClass","blockSelector","unblockSelector","maskTextClass","maskTextSelector","unmaskTextSelector","maskInputSelector","unmaskInputSelector","inlineStylesheet","maskAllText","maskInputOptions","maskTextFn","maskInputFn","recordCanvas","inlineImages","slimDOMOptions","doc","mirror","iframeManager","shadowDomManager","canvasManager"].forEach((e=>{this[e]=t[e]}))}freeze(){this.frozen=!0,this.canvasManager.freeze()}unfreeze(){this.frozen=!1,this.canvasManager.unfreeze(),this.emit()}isFrozen(){return this.frozen}lock(){this.locked=!0,this.canvasManager.lock()}unlock(){this.locked=!1,this.canvasManager.unlock(),this.emit()}reset(){this.shadowDomManager.reset(),this.canvasManager.reset()}}function IA(t,e){t.delete(e),e.childNodes.forEach((e=>IA(t,e)))}function AA(t,e,i){const{parentNode:n}=e;if(!n)return!1;const r=i.getId(n);return!!t.some((t=>t.id===r))||AA(t,n,i)}function kA(t,e){const{parentNode:i}=e;return!!i&&(!!t.has(i)||kA(t,i))}const RA=t=>(...e)=>{try{return t(...e)}catch(i){try{i.__rrweb__=!0}catch(n){}throw i}},zA=[];function PA(t){try{if("composedPath"in t){const e=t.composedPath();if(e.length)return e[0]}else if("path"in t&&t.path.length)return t.path[0]}catch(e){}return t&&t.target}function DA(t,e){var i,n;const r=new CA;zA.push(r),r.init(t);let a=window.MutationObserver||window.__rrMutationObserver;const o=null===(n=null===(i=null===window||void 0===window?void 0:window.Zone)||void 0===i?void 0:i.__symbol__)||void 0===n?void 0:n.call(i,"MutationObserver");o&&window[o]&&(a=window[o]);const s=new a(RA((e=>{t.onMutation&&!1===t.onMutation(e)||r.processMutations(e)})));return s.observe(e,{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),s}function LA({mouseInteractionCb:t,doc:e,mirror:i,blockClass:n,blockSelector:r,unblockSelector:a,sampling:o}){if(!1===o.mouseInteraction)return()=>{};const s=!0===o.mouseInteraction||void 0===o.mouseInteraction?{}:o.mouseInteraction,l=[];return Object.keys(aA).filter((t=>Number.isNaN(Number(t))&&!t.endsWith("_Departed")&&!1!==s[t])).forEach((o=>{const s=o.toLowerCase(),c=RA((e=>o=>{const s=PA(o);if(_A(s,n,r,a))return;const l=xA(o)?o.changedTouches[0]:o;if(!l)return;const c=i.getId(s),{clientX:u,clientY:h}=l;RA(t)({type:aA[e],id:c,x:u,y:h})})(o));l.push(cA(s,c,e))})),RA((()=>{l.forEach((t=>t()))}))}function BA({scrollCb:t,doc:e,mirror:i,blockClass:n,blockSelector:r,unblockSelector:a,sampling:o}){const s=pA((o=>{const s=PA(o);if(!s||_A(s,n,r,a))return;const l=i.getId(s);if(s===e){const i=e.scrollingElement||e.documentElement;RA(t)({id:l,x:i.scrollLeft,y:i.scrollTop})}else RA(t)({id:l,x:s.scrollLeft,y:s.scrollTop})}),o.scroll||100);return cA("scroll",RA(s),e)}function OA(t,e){const i=Object.assign({},t);return e||delete i.userTriggered,i}const FA=["INPUT","TEXTAREA","SELECT"],NA=new WeakMap;function UA({inputCb:t,doc:e,mirror:i,blockClass:n,blockSelector:r,unblockSelector:a,ignoreClass:o,ignoreSelector:s,maskInputSelector:l,unmaskInputSelector:c,maskInputOptions:u,maskInputFn:h,sampling:p,userTriggeredOnInput:d}){function f(t){let i=PA(t);const p=i&&i.tagName,f=t.isTrusted;if("OPTION"===p&&(i=i.parentElement),!i||!p||FA.indexOf(p)<0||_A(i,n,r,a))return;const g=i,_=PI(g);if(g.classList.contains(o)||s&&g.matches(s))return;let y=DI(g,p,_),v=!1;"radio"!==_&&"checkbox"!==_||(v=i.checked),function({tagName:t,type:e,maskInputOptions:i,maskInputSelector:n}){return n||kI({maskInputOptions:i,tagName:t,type:e})}({maskInputOptions:u,maskInputSelector:l,tagName:p,type:_})&&(y=RI({input:g,maskInputOptions:u,maskInputSelector:l,unmaskInputSelector:c,tagName:p,type:_,value:y,maskInputFn:h})),m(i,RA(OA)({text:y,isChecked:v,userTriggered:f},d));const x=i.name;"radio"===_&&x&&v&&e.querySelectorAll(`input[type="radio"][name="${x}"]`).forEach((t=>{if(t!==i){const e=RI({input:t,maskInputOptions:u,maskInputSelector:l,unmaskInputSelector:c,tagName:p,type:_,value:DI(t,p,_),maskInputFn:h});m(t,RA(OA)({text:e,isChecked:!v,userTriggered:!1},d))}}))}function m(e,n){const r=NA.get(e);if(!r||r.text!==n.text||r.isChecked!==n.isChecked){NA.set(e,n);const r=i.getId(e);t(Object.assign(Object.assign({},n),{id:r}))}}const g=("last"===p.input?["change"]:["input","change"]).map((t=>cA(t,RA(f),e))),_=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value"),y=[[HTMLInputElement.prototype,"value"],[HTMLInputElement.prototype,"checked"],[HTMLSelectElement.prototype,"value"],[HTMLTextAreaElement.prototype,"value"],[HTMLSelectElement.prototype,"selectedIndex"],[HTMLOptionElement.prototype,"selected"]];return _&&_.set&&g.push(...y.map((t=>dA(t[0],t[1],{set(){RA(f)({target:this})}})))),RA((()=>{g.forEach((t=>t()))}))}function $A(t){return function(t,e){if(jA("CSSGroupingRule")&&t.parentRule instanceof CSSGroupingRule||jA("CSSMediaRule")&&t.parentRule instanceof CSSMediaRule||jA("CSSSupportsRule")&&t.parentRule instanceof CSSSupportsRule||jA("CSSConditionRule")&&t.parentRule instanceof CSSConditionRule){const i=Array.from(t.parentRule.cssRules).indexOf(t);e.unshift(i)}else{const i=Array.from(t.parentStyleSheet.cssRules).indexOf(t);e.unshift(i)}return e}(t,[])}function VA(t,e={}){const i=t.doc.defaultView;if(!i)return()=>{};!function(t,e){const{mutationCb:i,mousemoveCb:n,mouseInteractionCb:r,scrollCb:a,viewportResizeCb:o,inputCb:s,mediaInteractionCb:l,styleSheetRuleCb:c,styleDeclarationCb:u,canvasMutationCb:h,fontCb:p}=t;t.mutationCb=(...t)=>{e.mutation&&e.mutation(...t),i(...t)},t.mousemoveCb=(...t)=>{e.mousemove&&e.mousemove(...t),n(...t)},t.mouseInteractionCb=(...t)=>{e.mouseInteraction&&e.mouseInteraction(...t),r(...t)},t.scrollCb=(...t)=>{e.scroll&&e.scroll(...t),a(...t)},t.viewportResizeCb=(...t)=>{e.viewportResize&&e.viewportResize(...t),o(...t)},t.inputCb=(...t)=>{e.input&&e.input(...t),s(...t)},t.mediaInteractionCb=(...t)=>{e.mediaInteaction&&e.mediaInteaction(...t),l(...t)},t.styleSheetRuleCb=(...t)=>{e.styleSheetRule&&e.styleSheetRule(...t),c(...t)},t.styleDeclarationCb=(...t)=>{e.styleDeclaration&&e.styleDeclaration(...t),u(...t)},t.canvasMutationCb=(...t)=>{e.canvasMutation&&e.canvasMutation(...t),h(...t)},t.fontCb=(...t)=>{e.font&&e.font(...t),p(...t)}}(t,e);const n=DA(t,t.doc),r=function({mousemoveCb:t,sampling:e,doc:i,mirror:n}){if(!1===e.mousemove)return()=>{};const r="number"===typeof e.mousemove?e.mousemove:50,a="number"===typeof e.mousemoveCallback?e.mousemoveCallback:500;let o,s=[];const l=pA((e=>{const i=Date.now()-o;RA(t)(s.map((t=>(t.timeOffset-=i,t))),e),s=[],o=null}),a),c=pA((t=>{const e=PA(t),{clientX:i,clientY:r}=xA(t)?t.changedTouches[0]:t;o||(o=Date.now()),s.push({x:i,y:r,id:n.getId(e),timeOffset:Date.now()-o}),l("undefined"!==typeof DragEvent&&t instanceof DragEvent?rA.Drag:t instanceof MouseEvent?rA.MouseMove:rA.TouchMove)}),r,{trailing:!1}),u=[cA("mousemove",RA(c),i),cA("touchmove",RA(c),i),cA("drag",RA(c),i)];return RA((()=>{u.forEach((t=>t()))}))}(t),a=LA(t),o=BA(t),s=function({viewportResizeCb:t}){let e=-1,i=-1;const n=pA((()=>{const n=mA(),r=gA();e===n&&i===r||(RA(t)({width:Number(r),height:Number(n)}),e=n,i=r)}),200);return cA("resize",RA(n),window)}(t),l=UA(t),c=function({mediaInteractionCb:t,blockClass:e,blockSelector:i,unblockSelector:n,mirror:r,sampling:a}){const o=o=>pA(RA((a=>{const s=PA(a);if(!s||_A(s,e,i,n))return;const{currentTime:l,volume:c,muted:u}=s;t({type:o,id:r.getId(s),currentTime:l,volume:c,muted:u})})),a.media||500),s=[cA("play",o(0)),cA("pause",o(1)),cA("seeked",o(2)),cA("volumechange",o(3))];return RA((()=>{s.forEach((t=>t()))}))}(t),u=function({styleSheetRuleCb:t,mirror:e},{win:i}){if(!i.CSSStyleSheet||!i.CSSStyleSheet.prototype)return()=>{};const n=i.CSSStyleSheet.prototype.insertRule;i.CSSStyleSheet.prototype.insertRule=new Proxy(n,{apply:RA(((i,n,r)=>{const[a,o]=r,s=e.getId(n.ownerNode);return-1!==s&&t({id:s,adds:[{rule:a,index:o}]}),i.apply(n,r)}))});const r=i.CSSStyleSheet.prototype.deleteRule;i.CSSStyleSheet.prototype.deleteRule=new Proxy(r,{apply:RA(((i,n,r)=>{const[a]=r,o=e.getId(n.ownerNode);return-1!==o&&t({id:o,removes:[{index:a}]}),i.apply(n,r)}))});const a={};qA("CSSGroupingRule")?a.CSSGroupingRule=i.CSSGroupingRule:(qA("CSSMediaRule")&&(a.CSSMediaRule=i.CSSMediaRule),qA("CSSConditionRule")&&(a.CSSConditionRule=i.CSSConditionRule),qA("CSSSupportsRule")&&(a.CSSSupportsRule=i.CSSSupportsRule));const o={};return Object.entries(a).forEach((([i,n])=>{o[i]={insertRule:n.prototype.insertRule,deleteRule:n.prototype.deleteRule},n.prototype.insertRule=new Proxy(o[i].insertRule,{apply:RA(((i,n,r)=>{const[a,o]=r,s=e.getId(n.parentStyleSheet.ownerNode);return-1!==s&&t({id:s,adds:[{rule:a,index:[...$A(n),o||0]}]}),i.apply(n,r)}))}),n.prototype.deleteRule=new Proxy(o[i].deleteRule,{apply:RA(((i,n,r)=>{const[a]=r,o=e.getId(n.parentStyleSheet.ownerNode);return-1!==o&&t({id:o,removes:[{index:[...$A(n),a]}]}),i.apply(n,r)}))})})),RA((()=>{i.CSSStyleSheet.prototype.insertRule=n,i.CSSStyleSheet.prototype.deleteRule=r,Object.entries(a).forEach((([t,e])=>{e.prototype.insertRule=o[t].insertRule,e.prototype.deleteRule=o[t].deleteRule}))}))}(t,{win:i}),h=function({styleDeclarationCb:t,mirror:e},{win:i}){const n=i.CSSStyleDeclaration.prototype.setProperty;i.CSSStyleDeclaration.prototype.setProperty=new Proxy(n,{apply:RA(((i,n,r)=>{var a,o;const[s,l,c]=r,u=e.getId(null===(o=null===(a=n.parentRule)||void 0===a?void 0:a.parentStyleSheet)||void 0===o?void 0:o.ownerNode);return-1!==u&&t({id:u,set:{property:s,value:l,priority:c},index:$A(n.parentRule)}),i.apply(n,r)}))});const r=i.CSSStyleDeclaration.prototype.removeProperty;return i.CSSStyleDeclaration.prototype.removeProperty=new Proxy(r,{apply:RA(((i,n,r)=>{var a,o;const[s]=r,l=e.getId(null===(o=null===(a=n.parentRule)||void 0===a?void 0:a.parentStyleSheet)||void 0===o?void 0:o.ownerNode);return-1!==l&&t({id:l,remove:{property:s},index:$A(n.parentRule)}),i.apply(n,r)}))}),RA((()=>{i.CSSStyleDeclaration.prototype.setProperty=n,i.CSSStyleDeclaration.prototype.removeProperty=r}))}(t,{win:i}),p=t.collectFonts?function({fontCb:t,doc:e}){const i=e.defaultView;if(!i)return()=>{};const n=[],r=new WeakMap,a=i.FontFace;i.FontFace=function(t,e,i){const n=new a(t,e,i);return r.set(n,{family:t,buffer:"string"!==typeof e,descriptors:i,fontSource:"string"===typeof e?e:JSON.stringify(Array.from(new Uint8Array(e)))}),n};const o=fA(e.fonts,"add",(function(e){return function(i){return setTimeout((()=>{const e=r.get(i);e&&(t(e),r.delete(i))}),0),e.apply(this,[i])}}));return n.push((()=>{i.FontFace=a})),n.push(o),RA((()=>{n.forEach((t=>t()))}))}(t):()=>{},d=[];for(const f of t.plugins)d.push(f.observer(f.callback,i,f.options));return RA((()=>{zA.forEach((t=>t.reset())),n.disconnect(),r(),a(),o(),s(),l(),c();try{u(),h()}catch(t){}p(),d.forEach((t=>t()))}))}function jA(t){return"undefined"!==typeof window[t]}function qA(t){return Boolean("undefined"!==typeof window[t]&&window[t].prototype&&"insertRule"in window[t].prototype&&"deleteRule"in window[t].prototype)}class GA{constructor(t){this.iframes=new WeakMap,this.mutationCb=t.mutationCb}addIframe(t){this.iframes.set(t,!0)}addLoadListener(t){this.loadListener=t}attachIframe(t,e){var i;this.mutationCb({adds:[{parentId:t.__sn.id,nextId:null,node:e}],removes:[],texts:[],attributes:[],isAttachIframe:!0}),null===(i=this.loadListener)||void 0===i||i.call(this,t)}}class HA{constructor(t){this.restorePatches=[],this.mutationCb=t.mutationCb,this.scrollCb=t.scrollCb,this.bypassOptions=t.bypassOptions,this.mirror=t.mirror;const e=this;this.restorePatches.push(fA(HTMLElement.prototype,"attachShadow",(function(t){return function(){const i=t.apply(this,arguments);return this.shadowRoot&&e.addShadowRoot(this.shadowRoot,this.ownerDocument),i}})))}addShadowRoot(t,e){DA(Object.assign(Object.assign({},this.bypassOptions),{doc:e,mutationCb:this.mutationCb,mirror:this.mirror,shadowDomManager:this}),t),BA(Object.assign(Object.assign({},this.bypassOptions),{scrollCb:this.scrollCb,doc:t,mirror:this.mirror}))}observeAttachShadow(t){if(t.contentWindow){const e=this;this.restorePatches.push(fA(t.contentWindow.HTMLElement.prototype,"attachShadow",(function(i){return function(){const n=i.apply(this,arguments);return this.shadowRoot&&e.addShadowRoot(this.shadowRoot,t.contentDocument),n}})))}}reset(){this.restorePatches.forEach((t=>t()))}}for(var WA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ZA="undefined"===typeof Uint8Array?[]:new Uint8Array(256),YA=0;YA<WA.length;YA++)ZA[WA.charCodeAt(YA)]=YA;const XA=new Map;const KA=(t,e,i)=>{if(!t||!tk(t,e)&&"object"!==typeof t)return;const n=function(t,e){let i=XA.get(t);return i||(i=new Map,XA.set(t,i)),i.has(e)||i.set(e,[]),i.get(e)}(i,t.constructor.name);let r=n.indexOf(t);return-1===r&&(r=n.length,n.push(t)),r};function JA(t,e,i){if(t instanceof Array)return t.map((t=>JA(t,e,i)));if(null===t)return t;if(t instanceof Float32Array||t instanceof Float64Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Int16Array||t instanceof Int8Array||t instanceof Uint8ClampedArray){return{rr_type:t.constructor.name,args:[Object.values(t)]}}if(t instanceof ArrayBuffer){const e=t.constructor.name,i=function(t){var e,i=new Uint8Array(t),n=i.length,r="";for(e=0;e<n;e+=3)r+=WA[i[e]>>2],r+=WA[(3&i[e])<<4|i[e+1]>>4],r+=WA[(15&i[e+1])<<2|i[e+2]>>6],r+=WA[63&i[e+2]];return n%3===2?r=r.substring(0,r.length-1)+"=":n%3===1&&(r=r.substring(0,r.length-2)+"=="),r}(t);return{rr_type:e,base64:i}}if(t instanceof DataView){return{rr_type:t.constructor.name,args:[JA(t.buffer,e,i),t.byteOffset,t.byteLength]}}if(t instanceof HTMLImageElement){const e=t.constructor.name,{src:i}=t;return{rr_type:e,src:i}}if(t instanceof ImageData){return{rr_type:t.constructor.name,args:[JA(t.data,e,i),t.width,t.height]}}if(tk(t,e)||"object"===typeof t){return{rr_type:t.constructor.name,index:KA(t,e,i)}}return t}const QA=(t,e,i)=>[...t].map((t=>JA(t,e,i))),tk=(t,e)=>{const i=["WebGLActiveInfo","WebGLBuffer","WebGLFramebuffer","WebGLProgram","WebGLRenderbuffer","WebGLShader","WebGLShaderPrecisionFormat","WebGLTexture","WebGLUniformLocation","WebGLVertexArrayObject","WebGLVertexArrayObjectOES"].filter((t=>"function"===typeof e[t]));return Boolean(i.find((i=>t instanceof e[i])))};function ek(t,e,i,n,r,a,o,s){const l=[],c=Object.getOwnPropertyNames(t);for(const h of c)try{if("function"!==typeof t[h])continue;const c=fA(t,h,(function(l){return function(...c){const u=l.apply(this,c);if(KA(u,s,t),!_A(this.canvas,n,a,r)){o.getId(this.canvas);const n=QA([...c],s,t),r={type:e,property:h,args:n};i(this.canvas,r)}return u}}));l.push(c)}catch(u){const n=dA(t,h,{set(t){i(this.canvas,{type:e,property:h,args:[t],setter:!0})}});l.push(n)}return l}class ik{reset(){this.pendingCanvasMutations.clear(),this.resetObservers&&this.resetObservers()}freeze(){this.frozen=!0}unfreeze(){this.frozen=!1}lock(){this.locked=!0}unlock(){this.locked=!1}constructor(t){this.pendingCanvasMutations=new Map,this.rafStamps={latestId:0,invokeId:null},this.frozen=!1,this.locked=!1,this.processMutation=function(t,e){!(this.rafStamps.invokeId&&this.rafStamps.latestId!==this.rafStamps.invokeId)&&this.rafStamps.invokeId||(this.rafStamps.invokeId=this.rafStamps.latestId),this.pendingCanvasMutations.has(t)||this.pendingCanvasMutations.set(t,[]),this.pendingCanvasMutations.get(t).push(e)},this.mutationCb=t.mutationCb,this.mirror=t.mirror,!0===t.recordCanvas&&this.initCanvasMutationObserver(t.win,t.blockClass,t.blockSelector,t.unblockSelector)}initCanvasMutationObserver(t,e,i,n){this.startRAFTimestamping(),this.startPendingCanvasMutationFlusher();const r=function(t,e,i,n){const r=[];try{const a=fA(t.HTMLCanvasElement.prototype,"getContext",(function(t){return function(r,...a){return _A(this,e,i,n)||"__context"in this||(this.__context=r),t.apply(this,[r,...a])}}));r.push(a)}catch(a){console.error("failed to patch HTMLCanvasElement.prototype.getContext")}return()=>{r.forEach((t=>t()))}}(t,e,n,i),a=function(t,e,i,n,r,a){const o=[],s=Object.getOwnPropertyNames(e.CanvasRenderingContext2D.prototype);for(const c of s)try{if("function"!==typeof e.CanvasRenderingContext2D.prototype[c])continue;const a=fA(e.CanvasRenderingContext2D.prototype,c,(function(e){return function(...a){return _A(this.canvas,i,r,n)||setTimeout((()=>{const e=[...a];if("drawImage"===c&&e[0]&&e[0]instanceof HTMLCanvasElement){const t=e[0],i=t.getContext("2d");let n=null===i||void 0===i?void 0:i.getImageData(0,0,t.width,t.height),r=null===n||void 0===n?void 0:n.data;e[0]=JSON.stringify(r)}t(this.canvas,{type:oA["2D"],property:c,args:e})}),0),e.apply(this,a)}}));o.push(a)}catch(l){const i=dA(e.CanvasRenderingContext2D.prototype,c,{set(e){t(this.canvas,{type:oA["2D"],property:c,args:[e],setter:!0})}});o.push(i)}return()=>{o.forEach((t=>t()))}}(this.processMutation.bind(this),t,e,n,i,this.mirror),o=function(t,e,i,n,r,a){const o=[];return o.push(...ek(e.WebGLRenderingContext.prototype,oA.WebGL,t,i,n,r,a,e)),"undefined"!==typeof e.WebGL2RenderingContext&&o.push(...ek(e.WebGL2RenderingContext.prototype,oA.WebGL2,t,i,n,r,a,e)),()=>{o.forEach((t=>t()))}}(this.processMutation.bind(this),t,e,n,i,this.mirror);this.resetObservers=()=>{r(),a(),o()}}startPendingCanvasMutationFlusher(){requestAnimationFrame((()=>this.flushPendingCanvasMutations()))}startRAFTimestamping(){const t=e=>{this.rafStamps.latestId=e,requestAnimationFrame(t)};requestAnimationFrame(t)}flushPendingCanvasMutations(){this.pendingCanvasMutations.forEach(((t,e)=>{const i=this.mirror.getId(e);this.flushPendingCanvasMutationFor(e,i)})),requestAnimationFrame((()=>this.flushPendingCanvasMutations()))}flushPendingCanvasMutationFor(t,e){if(this.frozen||this.locked)return;const i=this.pendingCanvasMutations.get(t);if(!i||-1===e)return;const n=i.map((t=>{const e=function(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(t,n[r])&&(i[n[r]]=t[n[r]])}return i}(t,["type"]);return e})),{type:r}=i[0];this.mutationCb({id:e,type:r,commands:n}),this.pendingCanvasMutations.delete(t)}}function nk(t){return Object.assign(Object.assign({},t),{timestamp:Date.now()})}let rk,ak;const ok={map:{},getId:t=>t&&t.__sn?t.__sn.id:-1,getNode(t){return this.map[t]||null},removeNodeFromMap(t){const e=t.__sn&&t.__sn.id;delete this.map[e],t.childNodes&&t.childNodes.forEach((t=>this.removeNodeFromMap(t)))},has(t){return this.map.hasOwnProperty(t)},reset(){this.map={}}};function sk(t={}){const{emit:e,checkoutEveryNms:i,checkoutEveryNth:n,blockClass:r="rr-block",blockSelector:a=null,unblockSelector:o=null,ignoreClass:s="rr-ignore",ignoreSelector:l=null,maskTextClass:c="rr-mask",maskTextSelector:u=null,maskInputSelector:h=null,unmaskTextSelector:p=null,unmaskInputSelector:d=null,inlineStylesheet:f=!0,maskAllText:m=!1,maskAllInputs:g,maskInputOptions:_,slimDOMOptions:y,maskInputFn:v,maskTextFn:x,hooks:b,packFn:w,sampling:S={},mousemoveWait:E,recordCanvas:T=!1,userTriggeredOnInput:M=!1,collectFonts:C=!1,inlineImages:I=!1,plugins:A,keepIframeSrcFn:k=(()=>!1),onMutation:R}=t;if(!e)throw new Error("emit function is required");void 0!==E&&void 0===S.mousemove&&(S.mousemove=E);const z=!0===g?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,radio:!0,checkbox:!0}:void 0!==_?_:{},P=!0===y||"all"===y?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaVerification:!0,headMetaAuthorship:"all"===y,headMetaDescKeywords:"all"===y}:y||{};let D;!function(t=window){"NodeList"in t&&!t.NodeList.prototype.forEach&&(t.NodeList.prototype.forEach=Array.prototype.forEach),"DOMTokenList"in t&&!t.DOMTokenList.prototype.forEach&&(t.DOMTokenList.prototype.forEach=Array.prototype.forEach),Node.prototype.contains||(Node.prototype.contains=function(t){if(!(0 in arguments))throw new TypeError("1 argument is required");do{if(this===t)return!0}while(t=t&&t.parentNode);return!1})}();let L=0;rk=(t,r)=>{var a;if(!(null===(a=zA[0])||void 0===a?void 0:a.isFrozen())||t.type===nA.FullSnapshot||t.type===nA.IncrementalSnapshot&&t.data.source===rA.Mutation||zA.forEach((t=>t.unfreeze())),e((t=>{for(const e of A||[])e.eventProcessor&&(t=e.eventProcessor(t));return w&&(t=w(t)),t})(t),r),t.type===nA.FullSnapshot)D=t,L=0;else if(t.type===nA.IncrementalSnapshot){if(t.data.source===rA.Mutation&&t.data.isAttachIframe)return;L++;const e=n&&L>=n,r=i&&t.timestamp-D.timestamp>i;(e||r)&&ak(!0)}};const B=t=>{rk(nk({type:nA.IncrementalSnapshot,data:Object.assign({source:rA.Mutation},t)}))},O=t=>rk(nk({type:nA.IncrementalSnapshot,data:Object.assign({source:rA.Scroll},t)})),F=t=>rk(nk({type:nA.IncrementalSnapshot,data:Object.assign({source:rA.CanvasMutation},t)})),N=new GA({mutationCb:B}),U=new ik({recordCanvas:T,mutationCb:F,win:window,blockClass:r,blockSelector:a,unblockSelector:o,mirror:ok}),$=new HA({mutationCb:B,scrollCb:O,bypassOptions:{onMutation:R,blockClass:r,blockSelector:a,unblockSelector:o,maskTextClass:c,maskTextSelector:u,unmaskTextSelector:p,maskInputSelector:h,unmaskInputSelector:d,inlineStylesheet:f,maskAllText:m,maskInputOptions:z,maskTextFn:x,maskInputFn:v,recordCanvas:T,inlineImages:I,sampling:S,slimDOMOptions:P,iframeManager:N,canvasManager:U},mirror:ok});ak=(t=!1)=>{var e,i,n,s;rk(nk({type:nA.Meta,data:{href:window.location.href,width:gA(),height:mA()}}),t),zA.forEach((t=>t.lock()));const[l,g]=function(t,e){const{blockClass:i="rr-block",blockSelector:n=null,unblockSelector:r=null,maskTextClass:a="rr-mask",maskTextSelector:o=null,unmaskTextSelector:s=null,inlineStylesheet:l=!0,inlineImages:c=!1,recordCanvas:u=!1,maskInputSelector:h=null,unmaskInputSelector:p=null,maskAllText:d=!1,maskAllInputs:f=!1,maskTextFn:m,maskInputFn:g,slimDOM:_=!1,dataURLOptions:y,preserveWhiteSpace:v,onSerialize:x,onIframeLoad:b,iframeLoadTimeout:w,keepIframeSrcFn:S=(()=>!1)}=e||{},E={};return[eA(t,{doc:t,map:E,blockClass:i,blockSelector:n,unblockSelector:r,maskTextClass:a,maskTextSelector:o,unmaskTextSelector:s,skipChild:!1,inlineStylesheet:l,maskInputSelector:h,unmaskInputSelector:p,maskAllText:d,maskInputOptions:!0===f?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0}:!1===f?{}:f,maskTextFn:m,maskInputFn:g,slimDOMOptions:!0===_||"all"===_?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:"all"===_,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0}:!1===_?{}:_,dataURLOptions:y,inlineImages:c,recordCanvas:u,preserveWhiteSpace:v,onSerialize:x,onIframeLoad:b,iframeLoadTimeout:w,keepIframeSrcFn:S}),E]}(document,{blockClass:r,blockSelector:a,unblockSelector:o,maskTextClass:c,maskTextSelector:u,unmaskTextSelector:p,maskInputSelector:h,unmaskInputSelector:d,inlineStylesheet:f,maskAllText:m,maskAllInputs:z,maskTextFn:x,slimDOM:P,recordCanvas:T,inlineImages:I,onSerialize:t=>{bA(t)&&N.addIframe(t),wA(t)&&$.addShadowRoot(t.shadowRoot,document)},onIframeLoad:(t,e)=>{N.attachIframe(t,e),$.observeAttachShadow(t)},keepIframeSrcFn:k});if(!l)return console.warn("Failed to snapshot the document");ok.map=g,rk(nk({type:nA.FullSnapshot,data:{node:l,initialOffset:{left:void 0!==window.pageXOffset?window.pageXOffset:(null===document||void 0===document?void 0:document.documentElement.scrollLeft)||(null===(i=null===(e=null===document||void 0===document?void 0:document.body)||void 0===e?void 0:e.parentElement)||void 0===i?void 0:i.scrollLeft)||(null===document||void 0===document?void 0:document.body.scrollLeft)||0,top:void 0!==window.pageYOffset?window.pageYOffset:(null===document||void 0===document?void 0:document.documentElement.scrollTop)||(null===(s=null===(n=null===document||void 0===document?void 0:document.body)||void 0===n?void 0:n.parentElement)||void 0===s?void 0:s.scrollTop)||(null===document||void 0===document?void 0:document.body.scrollTop)||0}}})),zA.forEach((t=>t.unlock()))};try{const t=[];t.push(cA("DOMContentLoaded",(()=>{rk(nk({type:nA.DomContentLoaded,data:{}}))})));const e=t=>{var e;return RA(VA)({onMutation:R,mutationCb:B,mousemoveCb:(t,e)=>rk(nk({type:nA.IncrementalSnapshot,data:{source:e,positions:t}})),mouseInteractionCb:t=>rk(nk({type:nA.IncrementalSnapshot,data:Object.assign({source:rA.MouseInteraction},t)})),scrollCb:O,viewportResizeCb:t=>rk(nk({type:nA.IncrementalSnapshot,data:Object.assign({source:rA.ViewportResize},t)})),inputCb:t=>rk(nk({type:nA.IncrementalSnapshot,data:Object.assign({source:rA.Input},t)})),mediaInteractionCb:t=>rk(nk({type:nA.IncrementalSnapshot,data:Object.assign({source:rA.MediaInteraction},t)})),styleSheetRuleCb:t=>rk(nk({type:nA.IncrementalSnapshot,data:Object.assign({source:rA.StyleSheetRule},t)})),styleDeclarationCb:t=>rk(nk({type:nA.IncrementalSnapshot,data:Object.assign({source:rA.StyleDeclaration},t)})),canvasMutationCb:F,fontCb:t=>rk(nk({type:nA.IncrementalSnapshot,data:Object.assign({source:rA.Font},t)})),blockClass:r,ignoreClass:s,ignoreSelector:l,maskTextClass:c,maskTextSelector:u,unmaskTextSelector:p,maskInputSelector:h,unmaskInputSelector:d,maskInputOptions:z,inlineStylesheet:f,sampling:S,recordCanvas:T,inlineImages:I,userTriggeredOnInput:M,collectFonts:C,doc:t,maskAllText:m,maskInputFn:v,maskTextFn:x,blockSelector:a,unblockSelector:o,slimDOMOptions:P,mirror:ok,iframeManager:N,shadowDomManager:$,canvasManager:U,plugins:(null===(e=null===A||void 0===A?void 0:A.filter((t=>t.observer)))||void 0===e?void 0:e.map((t=>({observer:t.observer,options:t.options,callback:e=>rk(nk({type:nA.Plugin,data:{plugin:t.name,payload:e}}))}))))||[]},b)};N.addLoadListener((i=>{try{t.push(e(i.contentDocument))}catch(n){console.warn(n)}}));const i=()=>{ak(),t.push(e(document))};return"interactive"===document.readyState||"complete"===document.readyState?i():t.push(cA("load",(()=>{rk(nk({type:nA.Load,data:{}})),i()}),window)),()=>{t.forEach((t=>t()))}}catch(V){console.warn(V)}}function lk(t){return t>9999999999?t:1e3*t}function ck(t,e){"sentry.transaction"!==e.category&&(["ui.click","ui.input"].includes(e.category)?t.triggerUserActivity():t.checkAndHandleExpiredSession(),t.addUpdate((()=>(t.throttledAddEvent({type:nA.Custom,timestamp:1e3*(e.timestamp||0),data:{tag:"breadcrumb",payload:FT(e,10,1e3)}}),"console"===e.category))))}sk.addCustomEvent=(t,e)=>{if(!rk)throw new Error("please add custom event after start recording");rk(nk({type:nA.Custom,data:{tag:t,payload:e}}))},sk.freezePage=()=>{zA.forEach((t=>t.freeze()))},sk.takeFullSnapshot=t=>{if(!ak)throw new Error("please take full snapshot after start recording");ak(t)},sk.mirror=ok;function uk(t){const e=hk(t);if(!e||!(e instanceof Element))return e;return e.closest("button,a")||e}function hk(t){return function(t){return"object"===typeof t&&!!t&&"target"in t}(t)?t.target:t}let pk;function dk(t){return pk||(pk=[],fE(wI,"open",(function(t){return function(...e){if(pk)try{pk.forEach((t=>t()))}catch(i){}return t.apply(wI,e)}}))),pk.push(t),()=>{const e=pk?pk.indexOf(t):-1;e>-1&&pk.splice(e,1)}}class fk{constructor(t,e,i=ck){this._lastMutation=0,this._lastScroll=0,this._clicks=[],this._timeout=e.timeout/1e3,this._threshold=e.threshold/1e3,this._scollTimeout=e.scrollTimeout/1e3,this._replay=t,this._ignoreSelector=e.ignoreSelector,this._addBreadcrumbEvent=i}addListeners(){const t=()=>{this._lastScroll=gk()},e=dk((()=>{this._lastMutation=gk()})),i=t=>{if(!t.target)return;const e=uk(t);e&&this._handleMultiClick(e)},n=new MutationObserver((()=>{this._lastMutation=gk()}));n.observe(wI.document.documentElement,{attributes:!0,characterData:!0,childList:!0,subtree:!0}),wI.addEventListener("scroll",t,{passive:!0}),wI.addEventListener("click",i,{passive:!0}),this._teardown=()=>{wI.removeEventListener("scroll",t),wI.removeEventListener("click",i),e(),n.disconnect(),this._clicks=[],this._lastMutation=0,this._lastScroll=0}}removeListeners(){this._teardown&&this._teardown(),this._checkClickTimeout&&clearTimeout(this._checkClickTimeout)}handleClick(t,e){if(function(t,e){if(!mk.includes(t.tagName))return!0;if("INPUT"===t.tagName&&!["submit","button"].includes(t.getAttribute("type")||""))return!0;if("A"===t.tagName&&(t.hasAttribute("download")||t.hasAttribute("target")&&"_self"!==t.getAttribute("target")))return!0;if(e&&t.matches(e))return!0;return!1}(e,this._ignoreSelector)||!function(t){return!(!t.data||"number"!==typeof t.data.nodeId||!t.timestamp)}(t))return;const i={timestamp:(n=t.timestamp,n>9999999999?n/1e3:n),clickBreadcrumb:t,clickCount:0,node:e};var n;this._clicks.some((t=>t.node===i.node&&Math.abs(t.timestamp-i.timestamp)<1))||(this._clicks.push(i),1===this._clicks.length&&this._scheduleCheckClicks())}_handleMultiClick(t){this._getClicks(t).forEach((t=>{t.clickCount++}))}_getClicks(t){return this._clicks.filter((e=>e.node===t))}_checkClicks(){const t=[],e=gk();this._clicks.forEach((i=>{!i.mutationAfter&&this._lastMutation&&(i.mutationAfter=i.timestamp<=this._lastMutation?this._lastMutation-i.timestamp:void 0),!i.scrollAfter&&this._lastScroll&&(i.scrollAfter=i.timestamp<=this._lastScroll?this._lastScroll-i.timestamp:void 0),i.timestamp+this._timeout<=e&&t.push(i)}));for(const i of t){const t=this._clicks.indexOf(i);t>-1&&(this._generateBreadcrumbs(i),this._clicks.splice(t,1))}this._clicks.length&&this._scheduleCheckClicks()}_generateBreadcrumbs(t){const e=this._replay,i=t.scrollAfter&&t.scrollAfter<=this._scollTimeout,n=t.mutationAfter&&t.mutationAfter<=this._threshold,r=!i&&!n,{clickCount:a,clickBreadcrumb:o}=t;if(r){const i=1e3*Math.min(t.mutationAfter||this._timeout,this._timeout),n=i<1e3*this._timeout?"mutation":"timeout",r={type:"default",message:o.message,timestamp:o.timestamp,category:"ui.slowClickDetected",data:{...o.data,url:wI.location.href,route:e.getCurrentRoute(),timeAfterClickMs:i,endReason:n,clickCount:a||1}};this._addBreadcrumbEvent(e,r)}else if(a>1){const t={type:"default",message:o.message,timestamp:o.timestamp,category:"ui.multiClick",data:{...o.data,url:wI.location.href,route:e.getCurrentRoute(),clickCount:a,metric:!0}};this._addBreadcrumbEvent(e,t)}}_scheduleCheckClicks(){this._checkClickTimeout&&clearTimeout(this._checkClickTimeout),this._checkClickTimeout=setTimeout((()=>this._checkClicks()),1e3)}}const mk=["A","BUTTON","INPUT"];function gk(){return Date.now()/1e3}function _k(t){return{timestamp:Date.now()/1e3,type:"default",...t}}var yk;!function(t){t[t.Document=0]="Document",t[t.DocumentType=1]="DocumentType",t[t.Element=2]="Element",t[t.Text=3]="Text",t[t.CDATA=4]="CDATA",t[t.Comment=5]="Comment"}(yk||(yk={}));const vk=new Set(["id","class","aria-label","role","name","alt","title","data-test-id","data-testid","disabled","aria-disabled"]);function xk(t){const e={};for(const i in t)if(vk.has(i)){let n=i;"data-testid"!==i&&"data-test-id"!==i||(n="testId"),e[n]=t[i]}return e}const bk=t=>e=>{if(!t.isEnabled())return;const i=function(t){const{target:e,message:i}=function(t){const e="click"===t.name;let i,n=null;try{n=e?uk(t.event):hk(t.event),i=lE(n,{maxStringLength:200})||"<unknown>"}catch(r){i="<unknown>"}return{target:n,message:i}}(t);return _k({category:`ui.${t.name}`,...wk(e,i)})}(e);if(!i)return;const n="click"===e.name,r=n&&e.event;!(n&&t.clickDetector&&r)||r.altKey||r.metaKey||r.ctrlKey||r.shiftKey||function(t,e,i){t.handleClick(e,i)}(t.clickDetector,i,uk(e.event)),ck(t,i)};function wk(t,e){const i=t&&function(t){return"__sn"in t}(t)&&t.__sn.type===yk.Element?t.__sn:null;return{message:e,data:i?{nodeId:i.id,node:{id:i.id,tagName:i.tagName,textContent:t?Array.from(t.childNodes).map((t=>"__sn"in t&&t.__sn.type===yk.Text&&t.__sn.textContent)).filter(Boolean).map((t=>t.trim())).join(""):"",attributes:xk(i.attributes)}}:{}}}function Sk(t,e){if(!t.isEnabled())return;t.updateUserActivity();const i=function(t){const{metaKey:e,shiftKey:i,ctrlKey:n,altKey:r,key:a,target:o}=t;if(!o||function(t){return"INPUT"===t.tagName||"TEXTAREA"===t.tagName||t.isContentEditable}(o)||!a)return null;const s=e||n||r,l=1===a.length;if(!s&&l)return null;const c=lE(o,{maxStringLength:200})||"<unknown>",u=wk(o,c);return _k({category:"ui.keyDown",message:c,data:{...u.data,metaKey:e,shiftKey:i,ctrlKey:n,altKey:r,key:a}})}(e);i&&ck(t,i)}const Ek=["name","type","startTime","transferSize","duration"];function Tk(t){return function(e){return Ek.every((i=>t[i]===e[i]))}}function Mk(t){const e=new PerformanceObserver((e=>{const i=function(t,e){const[i,n,r]=t.reduce(((t,e)=>("navigation"===e.entryType?t[0].push(e):"largest-contentful-paint"===e.entryType?t[1].push(e):t[2].push(e),t)),[[],[],[]]),a=[],o=[];let s=n.length?n[n.length-1]:void 0;return e.forEach((t=>{if("largest-contentful-paint"!==t.entryType)if("navigation"!==t.entryType)a.push(t);else{const e=t;t.duration>0&&!i.find(Tk(e))&&!o.find(Tk(e))&&o.push(e)}else(!s||s.startTime<t.startTime)&&(s=t)})),[...s?[s]:[],...i,...r,...a,...o].sort(((t,e)=>t.startTime-e.startTime))}(t.performanceEvents,e.getEntries());t.performanceEvents=i}));return["element","event","first-input","largest-contentful-paint","layout-shift","longtask","navigation","paint","resource"].forEach((t=>{try{e.observe({type:t,buffered:!0})}catch(i){}})),e}function Ck(t,e){("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&(PE.info(t),e&&Ak(t))}function Ik(t,e){("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&(PE.info(t),e&&setTimeout((()=>{Ak(t)}),0))}function Ak(t){XE().addBreadcrumb({category:"console",data:{logger:"replay"},level:"info",message:t},{level:"info"})}class kk extends Error{constructor(){super("Event buffer exceeded maximum size of 20000000.")}}class Rk{constructor(){this.events=[],this._totalSize=0,this.hasCheckout=!1}get hasEvents(){return this.events.length>0}get type(){return"sync"}destroy(){this.events=[]}async addEvent(t){const e=JSON.stringify(t).length;if(this._totalSize+=e,this._totalSize>CI)throw new kk;this.events.push(t)}finish(){return new Promise((t=>{const e=this.events;this.clear(),t(JSON.stringify(e))}))}clear(){this.events=[],this._totalSize=0,this.hasCheckout=!1}getEarliestTimestamp(){const t=this.events.map((t=>t.timestamp)).sort()[0];return t?lk(t):null}}class zk{constructor(t){this._worker=t,this._id=0}ensureReady(){return this._ensureReadyPromise||(this._ensureReadyPromise=new Promise(((t,e)=>{this._worker.addEventListener("message",(({data:i})=>{i.success?t():e()}),{once:!0}),this._worker.addEventListener("error",(t=>{e(t)}),{once:!0})}))),this._ensureReadyPromise}destroy(){Ck("[Replay] Destroying compression worker"),this._worker.terminate()}postMessage(t,e){const i=this._getAndIncrementId();return new Promise(((n,r)=>{const a=({data:e})=>{const o=e;if(o.method===t&&o.id===i){if(this._worker.removeEventListener("message",a),!o.success)return("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.error("[Replay]",o.response),void r(new Error("Error in compression worker"));n(o.response)}};this._worker.addEventListener("message",a),this._worker.postMessage({id:i,method:t,arg:e})}))}_getAndIncrementId(){return this._id++}}class Pk{constructor(t){this._worker=new zk(t),this._earliestTimestamp=null,this._totalSize=0,this.hasCheckout=!1}get hasEvents(){return!!this._earliestTimestamp}get type(){return"worker"}ensureReady(){return this._worker.ensureReady()}destroy(){this._worker.destroy()}addEvent(t){const e=lk(t.timestamp);(!this._earliestTimestamp||e<this._earliestTimestamp)&&(this._earliestTimestamp=e);const i=JSON.stringify(t);return this._totalSize+=i.length,this._totalSize>CI?Promise.reject(new kk):this._sendEventToWorker(i)}finish(){return this._finishRequest()}clear(){this._earliestTimestamp=null,this._totalSize=0,this.hasCheckout=!1,this._worker.postMessage("clear")}getEarliestTimestamp(){return this._earliestTimestamp}_sendEventToWorker(t){return this._worker.postMessage("addEvent",t)}async _finishRequest(){const t=await this._worker.postMessage("finish");return this._earliestTimestamp=null,this._totalSize=0,t}}class Dk{constructor(t){this._fallback=new Rk,this._compression=new Pk(t),this._used=this._fallback,this._ensureWorkerIsLoadedPromise=this._ensureWorkerIsLoaded()}get type(){return this._used.type}get hasEvents(){return this._used.hasEvents}get hasCheckout(){return this._used.hasCheckout}set hasCheckout(t){this._used.hasCheckout=t}destroy(){this._fallback.destroy(),this._compression.destroy()}clear(){return this._used.clear()}getEarliestTimestamp(){return this._used.getEarliestTimestamp()}addEvent(t){return this._used.addEvent(t)}async finish(){return await this.ensureWorkerIsLoaded(),this._used.finish()}ensureWorkerIsLoaded(){return this._ensureWorkerIsLoadedPromise}async _ensureWorkerIsLoaded(){try{await this._compression.ensureReady()}catch(t){return void Ck("[Replay] Failed to load the compression worker, falling back to simple buffer")}await this._switchToCompressionWorker()}async _switchToCompressionWorker(){const{events:t,hasCheckout:e}=this._fallback,i=[];for(const r of t)i.push(this._compression.addEvent(r));this._compression.hasCheckout=e,this._used=this._compression;try{await Promise.all(i)}catch(n){("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.warn("[Replay] Failed to add events when switching buffers.",n)}}}function Lk({useCompression:t}){if(t&&window.Worker)try{const t=function(){const t=new Blob(['/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */\nfunction t(t){let e=t.length;for(;--e>=0;)t[e]=0}const e=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),a=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),i=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),n=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),s=new Array(576);t(s);const r=new Array(60);t(r);const o=new Array(512);t(o);const l=new Array(256);t(l);const h=new Array(29);t(h);const d=new Array(30);function _(t,e,a,i,n){this.static_tree=t,this.extra_bits=e,this.extra_base=a,this.elems=i,this.max_length=n,this.has_stree=t&&t.length}let f,c,u;function w(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}t(d);const m=t=>t<256?o[t]:o[256+(t>>>7)],b=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},g=(t,e,a)=>{t.bi_valid>16-a?(t.bi_buf|=e<<t.bi_valid&65535,b(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=a-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=a)},p=(t,e,a)=>{g(t,a[2*e],a[2*e+1])},k=(t,e)=>{let a=0;do{a|=1&t,t>>>=1,a<<=1}while(--e>0);return a>>>1},v=(t,e,a)=>{const i=new Array(16);let n,s,r=0;for(n=1;n<=15;n++)r=r+a[n-1]<<1,i[n]=r;for(s=0;s<=e;s++){let e=t[2*s+1];0!==e&&(t[2*s]=k(i[e]++,e))}},y=t=>{let e;for(e=0;e<286;e++)t.dyn_ltree[2*e]=0;for(e=0;e<30;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},x=t=>{t.bi_valid>8?b(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},z=(t,e,a,i)=>{const n=2*e,s=2*a;return t[n]<t[s]||t[n]===t[s]&&i[e]<=i[a]},A=(t,e,a)=>{const i=t.heap[a];let n=a<<1;for(;n<=t.heap_len&&(n<t.heap_len&&z(e,t.heap[n+1],t.heap[n],t.depth)&&n++,!z(e,i,t.heap[n],t.depth));)t.heap[a]=t.heap[n],a=n,n<<=1;t.heap[a]=i},E=(t,i,n)=>{let s,r,o,_,f=0;if(0!==t.sym_next)do{s=255&t.pending_buf[t.sym_buf+f++],s+=(255&t.pending_buf[t.sym_buf+f++])<<8,r=t.pending_buf[t.sym_buf+f++],0===s?p(t,r,i):(o=l[r],p(t,o+256+1,i),_=e[o],0!==_&&(r-=h[o],g(t,r,_)),s--,o=m(s),p(t,o,n),_=a[o],0!==_&&(s-=d[o],g(t,s,_)))}while(f<t.sym_next);p(t,256,i)},R=(t,e)=>{const a=e.dyn_tree,i=e.stat_desc.static_tree,n=e.stat_desc.has_stree,s=e.stat_desc.elems;let r,o,l,h=-1;for(t.heap_len=0,t.heap_max=573,r=0;r<s;r++)0!==a[2*r]?(t.heap[++t.heap_len]=h=r,t.depth[r]=0):a[2*r+1]=0;for(;t.heap_len<2;)l=t.heap[++t.heap_len]=h<2?++h:0,a[2*l]=1,t.depth[l]=0,t.opt_len--,n&&(t.static_len-=i[2*l+1]);for(e.max_code=h,r=t.heap_len>>1;r>=1;r--)A(t,a,r);l=s;do{r=t.heap[1],t.heap[1]=t.heap[t.heap_len--],A(t,a,1),o=t.heap[1],t.heap[--t.heap_max]=r,t.heap[--t.heap_max]=o,a[2*l]=a[2*r]+a[2*o],t.depth[l]=(t.depth[r]>=t.depth[o]?t.depth[r]:t.depth[o])+1,a[2*r+1]=a[2*o+1]=l,t.heap[1]=l++,A(t,a,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((t,e)=>{const a=e.dyn_tree,i=e.max_code,n=e.stat_desc.static_tree,s=e.stat_desc.has_stree,r=e.stat_desc.extra_bits,o=e.stat_desc.extra_base,l=e.stat_desc.max_length;let h,d,_,f,c,u,w=0;for(f=0;f<=15;f++)t.bl_count[f]=0;for(a[2*t.heap[t.heap_max]+1]=0,h=t.heap_max+1;h<573;h++)d=t.heap[h],f=a[2*a[2*d+1]+1]+1,f>l&&(f=l,w++),a[2*d+1]=f,d>i||(t.bl_count[f]++,c=0,d>=o&&(c=r[d-o]),u=a[2*d],t.opt_len+=u*(f+c),s&&(t.static_len+=u*(n[2*d+1]+c)));if(0!==w){do{for(f=l-1;0===t.bl_count[f];)f--;t.bl_count[f]--,t.bl_count[f+1]+=2,t.bl_count[l]--,w-=2}while(w>0);for(f=l;0!==f;f--)for(d=t.bl_count[f];0!==d;)_=t.heap[--h],_>i||(a[2*_+1]!==f&&(t.opt_len+=(f-a[2*_+1])*a[2*_],a[2*_+1]=f),d--)}})(t,e),v(a,h,t.bl_count)},Z=(t,e,a)=>{let i,n,s=-1,r=e[1],o=0,l=7,h=4;for(0===r&&(l=138,h=3),e[2*(a+1)+1]=65535,i=0;i<=a;i++)n=r,r=e[2*(i+1)+1],++o<l&&n===r||(o<h?t.bl_tree[2*n]+=o:0!==n?(n!==s&&t.bl_tree[2*n]++,t.bl_tree[32]++):o<=10?t.bl_tree[34]++:t.bl_tree[36]++,o=0,s=n,0===r?(l=138,h=3):n===r?(l=6,h=3):(l=7,h=4))},U=(t,e,a)=>{let i,n,s=-1,r=e[1],o=0,l=7,h=4;for(0===r&&(l=138,h=3),i=0;i<=a;i++)if(n=r,r=e[2*(i+1)+1],!(++o<l&&n===r)){if(o<h)do{p(t,n,t.bl_tree)}while(0!=--o);else 0!==n?(n!==s&&(p(t,n,t.bl_tree),o--),p(t,16,t.bl_tree),g(t,o-3,2)):o<=10?(p(t,17,t.bl_tree),g(t,o-3,3)):(p(t,18,t.bl_tree),g(t,o-11,7));o=0,s=n,0===r?(l=138,h=3):n===r?(l=6,h=3):(l=7,h=4)}};let S=!1;const D=(t,e,a,i)=>{g(t,0+(i?1:0),3),x(t),b(t,a),b(t,~a),a&&t.pending_buf.set(t.window.subarray(e,e+a),t.pending),t.pending+=a};var T=(t,e,a,i)=>{let o,l,h=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=(t=>{let e,a=4093624447;for(e=0;e<=31;e++,a>>>=1)if(1&a&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<256;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0})(t)),R(t,t.l_desc),R(t,t.d_desc),h=(t=>{let e;for(Z(t,t.dyn_ltree,t.l_desc.max_code),Z(t,t.dyn_dtree,t.d_desc.max_code),R(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*n[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e})(t),o=t.opt_len+3+7>>>3,l=t.static_len+3+7>>>3,l<=o&&(o=l)):o=l=a+5,a+4<=o&&-1!==e?D(t,e,a,i):4===t.strategy||l===o?(g(t,2+(i?1:0),3),E(t,s,r)):(g(t,4+(i?1:0),3),((t,e,a,i)=>{let s;for(g(t,e-257,5),g(t,a-1,5),g(t,i-4,4),s=0;s<i;s++)g(t,t.bl_tree[2*n[s]+1],3);U(t,t.dyn_ltree,e-1),U(t,t.dyn_dtree,a-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,h+1),E(t,t.dyn_ltree,t.dyn_dtree)),y(t),i&&x(t)},O={_tr_init:t=>{S||((()=>{let t,n,w,m,b;const g=new Array(16);for(w=0,m=0;m<28;m++)for(h[m]=w,t=0;t<1<<e[m];t++)l[w++]=m;for(l[w-1]=m,b=0,m=0;m<16;m++)for(d[m]=b,t=0;t<1<<a[m];t++)o[b++]=m;for(b>>=7;m<30;m++)for(d[m]=b<<7,t=0;t<1<<a[m]-7;t++)o[256+b++]=m;for(n=0;n<=15;n++)g[n]=0;for(t=0;t<=143;)s[2*t+1]=8,t++,g[8]++;for(;t<=255;)s[2*t+1]=9,t++,g[9]++;for(;t<=279;)s[2*t+1]=7,t++,g[7]++;for(;t<=287;)s[2*t+1]=8,t++,g[8]++;for(v(s,287,g),t=0;t<30;t++)r[2*t+1]=5,r[2*t]=k(t,5);f=new _(s,e,257,286,15),c=new _(r,a,0,30,15),u=new _(new Array(0),i,0,19,7)})(),S=!0),t.l_desc=new w(t.dyn_ltree,f),t.d_desc=new w(t.dyn_dtree,c),t.bl_desc=new w(t.bl_tree,u),t.bi_buf=0,t.bi_valid=0,y(t)},_tr_stored_block:D,_tr_flush_block:T,_tr_tally:(t,e,a)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=a,0===e?t.dyn_ltree[2*a]++:(t.matches++,e--,t.dyn_ltree[2*(l[a]+256+1)]++,t.dyn_dtree[2*m(e)]++),t.sym_next===t.sym_end),_tr_align:t=>{g(t,2,3),p(t,256,s),(t=>{16===t.bi_valid?(b(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(t)}};var F=(t,e,a,i)=>{let n=65535&t|0,s=t>>>16&65535|0,r=0;for(;0!==a;){r=a>2e3?2e3:a,a-=r;do{n=n+e[i++]|0,s=s+n|0}while(--r);n%=65521,s%=65521}return n|s<<16|0};const L=new Uint32Array((()=>{let t,e=[];for(var a=0;a<256;a++){t=a;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[a]=t}return e})());var N=(t,e,a,i)=>{const n=L,s=i+a;t^=-1;for(let a=i;a<s;a++)t=t>>>8^n[255&(t^e[a])];return-1^t},I={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},B={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:C,_tr_stored_block:H,_tr_flush_block:M,_tr_tally:j,_tr_align:K}=O,{Z_NO_FLUSH:P,Z_PARTIAL_FLUSH:Y,Z_FULL_FLUSH:G,Z_FINISH:X,Z_BLOCK:W,Z_OK:q,Z_STREAM_END:J,Z_STREAM_ERROR:Q,Z_DATA_ERROR:V,Z_BUF_ERROR:$,Z_DEFAULT_COMPRESSION:tt,Z_FILTERED:et,Z_HUFFMAN_ONLY:at,Z_RLE:it,Z_FIXED:nt,Z_DEFAULT_STRATEGY:st,Z_UNKNOWN:rt,Z_DEFLATED:ot}=B,lt=(t,e)=>(t.msg=I[e],e),ht=t=>2*t-(t>4?9:0),dt=t=>{let e=t.length;for(;--e>=0;)t[e]=0},_t=t=>{let e,a,i,n=t.w_size;e=t.hash_size,i=e;do{a=t.head[--i],t.head[i]=a>=n?a-n:0}while(--e);e=n,i=e;do{a=t.prev[--i],t.prev[i]=a>=n?a-n:0}while(--e)};let ft=(t,e,a)=>(e<<t.hash_shift^a)&t.hash_mask;const ct=t=>{const e=t.state;let a=e.pending;a>t.avail_out&&(a=t.avail_out),0!==a&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+a),t.next_out),t.next_out+=a,e.pending_out+=a,t.total_out+=a,t.avail_out-=a,e.pending-=a,0===e.pending&&(e.pending_out=0))},ut=(t,e)=>{M(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,ct(t.strm)},wt=(t,e)=>{t.pending_buf[t.pending++]=e},mt=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},bt=(t,e,a,i)=>{let n=t.avail_in;return n>i&&(n=i),0===n?0:(t.avail_in-=n,e.set(t.input.subarray(t.next_in,t.next_in+n),a),1===t.state.wrap?t.adler=F(t.adler,e,n,a):2===t.state.wrap&&(t.adler=N(t.adler,e,n,a)),t.next_in+=n,t.total_in+=n,n)},gt=(t,e)=>{let a,i,n=t.max_chain_length,s=t.strstart,r=t.prev_length,o=t.nice_match;const l=t.strstart>t.w_size-262?t.strstart-(t.w_size-262):0,h=t.window,d=t.w_mask,_=t.prev,f=t.strstart+258;let c=h[s+r-1],u=h[s+r];t.prev_length>=t.good_match&&(n>>=2),o>t.lookahead&&(o=t.lookahead);do{if(a=e,h[a+r]===u&&h[a+r-1]===c&&h[a]===h[s]&&h[++a]===h[s+1]){s+=2,a++;do{}while(h[++s]===h[++a]&&h[++s]===h[++a]&&h[++s]===h[++a]&&h[++s]===h[++a]&&h[++s]===h[++a]&&h[++s]===h[++a]&&h[++s]===h[++a]&&h[++s]===h[++a]&&s<f);if(i=258-(f-s),s=f-258,i>r){if(t.match_start=e,r=i,i>=o)break;c=h[s+r-1],u=h[s+r]}}}while((e=_[e&d])>l&&0!=--n);return r<=t.lookahead?r:t.lookahead},pt=t=>{const e=t.w_size;let a,i,n;do{if(i=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-262)&&(t.window.set(t.window.subarray(e,e+e-i),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),_t(t),i+=e),0===t.strm.avail_in)break;if(a=bt(t.strm,t.window,t.strstart+t.lookahead,i),t.lookahead+=a,t.lookahead+t.insert>=3)for(n=t.strstart-t.insert,t.ins_h=t.window[n],t.ins_h=ft(t,t.ins_h,t.window[n+1]);t.insert&&(t.ins_h=ft(t,t.ins_h,t.window[n+3-1]),t.prev[n&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=n,n++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<262&&0!==t.strm.avail_in)},kt=(t,e)=>{let a,i,n,s=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,r=0,o=t.strm.avail_in;do{if(a=65535,n=t.bi_valid+42>>3,t.strm.avail_out<n)break;if(n=t.strm.avail_out-n,i=t.strstart-t.block_start,a>i+t.strm.avail_in&&(a=i+t.strm.avail_in),a>n&&(a=n),a<s&&(0===a&&e!==X||e===P||a!==i+t.strm.avail_in))break;r=e===X&&a===i+t.strm.avail_in?1:0,H(t,0,0,r),t.pending_buf[t.pending-4]=a,t.pending_buf[t.pending-3]=a>>8,t.pending_buf[t.pending-2]=~a,t.pending_buf[t.pending-1]=~a>>8,ct(t.strm),i&&(i>a&&(i=a),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+i),t.strm.next_out),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i,t.block_start+=i,a-=i),a&&(bt(t.strm,t.strm.output,t.strm.next_out,a),t.strm.next_out+=a,t.strm.avail_out-=a,t.strm.total_out+=a)}while(0===r);return o-=t.strm.avail_in,o&&(o>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=o&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-o,t.strm.next_in),t.strstart),t.strstart+=o,t.insert+=o>t.w_size-t.insert?t.w_size-t.insert:o),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),r?4:e!==P&&e!==X&&0===t.strm.avail_in&&t.strstart===t.block_start?2:(n=t.window_size-t.strstart,t.strm.avail_in>n&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,n+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),n>t.strm.avail_in&&(n=t.strm.avail_in),n&&(bt(t.strm,t.window,t.strstart,n),t.strstart+=n,t.insert+=n>t.w_size-t.insert?t.w_size-t.insert:n),t.high_water<t.strstart&&(t.high_water=t.strstart),n=t.bi_valid+42>>3,n=t.pending_buf_size-n>65535?65535:t.pending_buf_size-n,s=n>t.w_size?t.w_size:n,i=t.strstart-t.block_start,(i>=s||(i||e===X)&&e!==P&&0===t.strm.avail_in&&i<=n)&&(a=i>n?n:i,r=e===X&&0===t.strm.avail_in&&a===i?1:0,H(t,t.block_start,a,r),t.block_start+=a,ct(t.strm)),r?3:1)},vt=(t,e)=>{let a,i;for(;;){if(t.lookahead<262){if(pt(t),t.lookahead<262&&e===P)return 1;if(0===t.lookahead)break}if(a=0,t.lookahead>=3&&(t.ins_h=ft(t,t.ins_h,t.window[t.strstart+3-1]),a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==a&&t.strstart-a<=t.w_size-262&&(t.match_length=gt(t,a)),t.match_length>=3)if(i=j(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=ft(t,t.ins_h,t.window[t.strstart+3-1]),a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=ft(t,t.ins_h,t.window[t.strstart+1]);else i=j(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(ut(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,e===X?(ut(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(ut(t,!1),0===t.strm.avail_out)?1:2},yt=(t,e)=>{let a,i,n;for(;;){if(t.lookahead<262){if(pt(t),t.lookahead<262&&e===P)return 1;if(0===t.lookahead)break}if(a=0,t.lookahead>=3&&(t.ins_h=ft(t,t.ins_h,t.window[t.strstart+3-1]),a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==a&&t.prev_length<t.max_lazy_match&&t.strstart-a<=t.w_size-262&&(t.match_length=gt(t,a),t.match_length<=5&&(t.strategy===et||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){n=t.strstart+t.lookahead-3,i=j(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=n&&(t.ins_h=ft(t,t.ins_h,t.window[t.strstart+3-1]),a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,i&&(ut(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if(i=j(t,0,t.window[t.strstart-1]),i&&ut(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=j(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===X?(ut(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(ut(t,!1),0===t.strm.avail_out)?1:2};function xt(t,e,a,i,n){this.good_length=t,this.max_lazy=e,this.nice_length=a,this.max_chain=i,this.func=n}const zt=[new xt(0,0,0,0,kt),new xt(4,4,8,4,vt),new xt(4,5,16,8,vt),new xt(4,6,32,32,vt),new xt(4,4,16,16,yt),new xt(8,16,32,32,yt),new xt(8,16,128,128,yt),new xt(8,32,128,256,yt),new xt(32,128,258,1024,yt),new xt(32,258,258,4096,yt)];function At(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ot,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),dt(this.dyn_ltree),dt(this.dyn_dtree),dt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),dt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),dt(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Et=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||42!==e.status&&57!==e.status&&69!==e.status&&73!==e.status&&91!==e.status&&103!==e.status&&113!==e.status&&666!==e.status?1:0},Rt=t=>{if(Et(t))return lt(t,Q);t.total_in=t.total_out=0,t.data_type=rt;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=2===e.wrap?57:e.wrap?42:113,t.adler=2===e.wrap?0:1,e.last_flush=-2,C(e),q},Zt=t=>{const e=Rt(t);var a;return e===q&&((a=t.state).window_size=2*a.w_size,dt(a.head),a.max_lazy_match=zt[a.level].max_lazy,a.good_match=zt[a.level].good_length,a.nice_match=zt[a.level].nice_length,a.max_chain_length=zt[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=2,a.match_available=0,a.ins_h=0),e},Ut=(t,e,a,i,n,s)=>{if(!t)return Q;let r=1;if(e===tt&&(e=6),i<0?(r=0,i=-i):i>15&&(r=2,i-=16),n<1||n>9||a!==ot||i<8||i>15||e<0||e>9||s<0||s>nt||8===i&&1!==r)return lt(t,Q);8===i&&(i=9);const o=new At;return t.state=o,o.strm=t,o.status=42,o.wrap=r,o.gzhead=null,o.w_bits=i,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=n+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<n+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=e,o.strategy=s,o.method=a,Zt(t)};var St={deflateInit:(t,e)=>Ut(t,e,ot,15,8,st),deflateInit2:Ut,deflateReset:Zt,deflateResetKeep:Rt,deflateSetHeader:(t,e)=>Et(t)||2!==t.state.wrap?Q:(t.state.gzhead=e,q),deflate:(t,e)=>{if(Et(t)||e>W||e<0)return t?lt(t,Q):Q;const a=t.state;if(!t.output||0!==t.avail_in&&!t.input||666===a.status&&e!==X)return lt(t,0===t.avail_out?$:Q);const i=a.last_flush;if(a.last_flush=e,0!==a.pending){if(ct(t),0===t.avail_out)return a.last_flush=-1,q}else if(0===t.avail_in&&ht(e)<=ht(i)&&e!==X)return lt(t,$);if(666===a.status&&0!==t.avail_in)return lt(t,$);if(42===a.status&&0===a.wrap&&(a.status=113),42===a.status){let e=ot+(a.w_bits-8<<4)<<8,i=-1;if(i=a.strategy>=at||a.level<2?0:a.level<6?1:6===a.level?2:3,e|=i<<6,0!==a.strstart&&(e|=32),e+=31-e%31,mt(a,e),0!==a.strstart&&(mt(a,t.adler>>>16),mt(a,65535&t.adler)),t.adler=1,a.status=113,ct(t),0!==a.pending)return a.last_flush=-1,q}if(57===a.status)if(t.adler=0,wt(a,31),wt(a,139),wt(a,8),a.gzhead)wt(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),wt(a,255&a.gzhead.time),wt(a,a.gzhead.time>>8&255),wt(a,a.gzhead.time>>16&255),wt(a,a.gzhead.time>>24&255),wt(a,9===a.level?2:a.strategy>=at||a.level<2?4:0),wt(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(wt(a,255&a.gzhead.extra.length),wt(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(t.adler=N(t.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=69;else if(wt(a,0),wt(a,0),wt(a,0),wt(a,0),wt(a,0),wt(a,9===a.level?2:a.strategy>=at||a.level<2?4:0),wt(a,3),a.status=113,ct(t),0!==a.pending)return a.last_flush=-1,q;if(69===a.status){if(a.gzhead.extra){let e=a.pending,i=(65535&a.gzhead.extra.length)-a.gzindex;for(;a.pending+i>a.pending_buf_size;){let n=a.pending_buf_size-a.pending;if(a.pending_buf.set(a.gzhead.extra.subarray(a.gzindex,a.gzindex+n),a.pending),a.pending=a.pending_buf_size,a.gzhead.hcrc&&a.pending>e&&(t.adler=N(t.adler,a.pending_buf,a.pending-e,e)),a.gzindex+=n,ct(t),0!==a.pending)return a.last_flush=-1,q;e=0,i-=n}let n=new Uint8Array(a.gzhead.extra);a.pending_buf.set(n.subarray(a.gzindex,a.gzindex+i),a.pending),a.pending+=i,a.gzhead.hcrc&&a.pending>e&&(t.adler=N(t.adler,a.pending_buf,a.pending-e,e)),a.gzindex=0}a.status=73}if(73===a.status){if(a.gzhead.name){let e,i=a.pending;do{if(a.pending===a.pending_buf_size){if(a.gzhead.hcrc&&a.pending>i&&(t.adler=N(t.adler,a.pending_buf,a.pending-i,i)),ct(t),0!==a.pending)return a.last_flush=-1,q;i=0}e=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,wt(a,e)}while(0!==e);a.gzhead.hcrc&&a.pending>i&&(t.adler=N(t.adler,a.pending_buf,a.pending-i,i)),a.gzindex=0}a.status=91}if(91===a.status){if(a.gzhead.comment){let e,i=a.pending;do{if(a.pending===a.pending_buf_size){if(a.gzhead.hcrc&&a.pending>i&&(t.adler=N(t.adler,a.pending_buf,a.pending-i,i)),ct(t),0!==a.pending)return a.last_flush=-1,q;i=0}e=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,wt(a,e)}while(0!==e);a.gzhead.hcrc&&a.pending>i&&(t.adler=N(t.adler,a.pending_buf,a.pending-i,i))}a.status=103}if(103===a.status){if(a.gzhead.hcrc){if(a.pending+2>a.pending_buf_size&&(ct(t),0!==a.pending))return a.last_flush=-1,q;wt(a,255&t.adler),wt(a,t.adler>>8&255),t.adler=0}if(a.status=113,ct(t),0!==a.pending)return a.last_flush=-1,q}if(0!==t.avail_in||0!==a.lookahead||e!==P&&666!==a.status){let i=0===a.level?kt(a,e):a.strategy===at?((t,e)=>{let a;for(;;){if(0===t.lookahead&&(pt(t),0===t.lookahead)){if(e===P)return 1;break}if(t.match_length=0,a=j(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,a&&(ut(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===X?(ut(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(ut(t,!1),0===t.strm.avail_out)?1:2})(a,e):a.strategy===it?((t,e)=>{let a,i,n,s;const r=t.window;for(;;){if(t.lookahead<=258){if(pt(t),t.lookahead<=258&&e===P)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(n=t.strstart-1,i=r[n],i===r[++n]&&i===r[++n]&&i===r[++n])){s=t.strstart+258;do{}while(i===r[++n]&&i===r[++n]&&i===r[++n]&&i===r[++n]&&i===r[++n]&&i===r[++n]&&i===r[++n]&&i===r[++n]&&n<s);t.match_length=258-(s-n),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(a=j(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(a=j(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),a&&(ut(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===X?(ut(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(ut(t,!1),0===t.strm.avail_out)?1:2})(a,e):zt[a.level].func(a,e);if(3!==i&&4!==i||(a.status=666),1===i||3===i)return 0===t.avail_out&&(a.last_flush=-1),q;if(2===i&&(e===Y?K(a):e!==W&&(H(a,0,0,!1),e===G&&(dt(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),ct(t),0===t.avail_out))return a.last_flush=-1,q}return e!==X?q:a.wrap<=0?J:(2===a.wrap?(wt(a,255&t.adler),wt(a,t.adler>>8&255),wt(a,t.adler>>16&255),wt(a,t.adler>>24&255),wt(a,255&t.total_in),wt(a,t.total_in>>8&255),wt(a,t.total_in>>16&255),wt(a,t.total_in>>24&255)):(mt(a,t.adler>>>16),mt(a,65535&t.adler)),ct(t),a.wrap>0&&(a.wrap=-a.wrap),0!==a.pending?q:J)},deflateEnd:t=>{if(Et(t))return Q;const e=t.state.status;return t.state=null,113===e?lt(t,V):q},deflateSetDictionary:(t,e)=>{let a=e.length;if(Et(t))return Q;const i=t.state,n=i.wrap;if(2===n||1===n&&42!==i.status||i.lookahead)return Q;if(1===n&&(t.adler=F(t.adler,e,a,0)),i.wrap=0,a>=i.w_size){0===n&&(dt(i.head),i.strstart=0,i.block_start=0,i.insert=0);let t=new Uint8Array(i.w_size);t.set(e.subarray(a-i.w_size,a),0),e=t,a=i.w_size}const s=t.avail_in,r=t.next_in,o=t.input;for(t.avail_in=a,t.next_in=0,t.input=e,pt(i);i.lookahead>=3;){let t=i.strstart,e=i.lookahead-2;do{i.ins_h=ft(i,i.ins_h,i.window[t+3-1]),i.prev[t&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=t,t++}while(--e);i.strstart=t,i.lookahead=2,pt(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,t.next_in=r,t.input=o,t.avail_in=s,i.wrap=n,q},deflateInfo:"pako deflate (from Nodeca project)"};const Dt=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Tt=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const a=e.shift();if(a){if("object"!=typeof a)throw new TypeError(a+"must be non-object");for(const e in a)Dt(a,e)&&(t[e]=a[e])}}return t},Ot=t=>{let e=0;for(let a=0,i=t.length;a<i;a++)e+=t[a].length;const a=new Uint8Array(e);for(let e=0,i=0,n=t.length;e<n;e++){let n=t[e];a.set(n,i),i+=n.length}return a};let Ft=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){Ft=!1}const Lt=new Uint8Array(256);for(let t=0;t<256;t++)Lt[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Lt[254]=Lt[254]=1;var Nt=t=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);let e,a,i,n,s,r=t.length,o=0;for(n=0;n<r;n++)a=t.charCodeAt(n),55296==(64512&a)&&n+1<r&&(i=t.charCodeAt(n+1),56320==(64512&i)&&(a=65536+(a-55296<<10)+(i-56320),n++)),o+=a<128?1:a<2048?2:a<65536?3:4;for(e=new Uint8Array(o),s=0,n=0;s<o;n++)a=t.charCodeAt(n),55296==(64512&a)&&n+1<r&&(i=t.charCodeAt(n+1),56320==(64512&i)&&(a=65536+(a-55296<<10)+(i-56320),n++)),a<128?e[s++]=a:a<2048?(e[s++]=192|a>>>6,e[s++]=128|63&a):a<65536?(e[s++]=224|a>>>12,e[s++]=128|a>>>6&63,e[s++]=128|63&a):(e[s++]=240|a>>>18,e[s++]=128|a>>>12&63,e[s++]=128|a>>>6&63,e[s++]=128|63&a);return e},It=(t,e)=>{const a=e||t.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(t.subarray(0,e));let i,n;const s=new Array(2*a);for(n=0,i=0;i<a;){let e=t[i++];if(e<128){s[n++]=e;continue}let r=Lt[e];if(r>4)s[n++]=65533,i+=r-1;else{for(e&=2===r?31:3===r?15:7;r>1&&i<a;)e=e<<6|63&t[i++],r--;r>1?s[n++]=65533:e<65536?s[n++]=e:(e-=65536,s[n++]=55296|e>>10&1023,s[n++]=56320|1023&e)}}return((t,e)=>{if(e<65534&&t.subarray&&Ft)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let a="";for(let i=0;i<e;i++)a+=String.fromCharCode(t[i]);return a})(s,n)},Bt=(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let a=e-1;for(;a>=0&&128==(192&t[a]);)a--;return a<0||0===a?e:a+Lt[t[a]]>e?a:e};var Ct=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Ht=Object.prototype.toString,{Z_NO_FLUSH:Mt,Z_SYNC_FLUSH:jt,Z_FULL_FLUSH:Kt,Z_FINISH:Pt,Z_OK:Yt,Z_STREAM_END:Gt,Z_DEFAULT_COMPRESSION:Xt,Z_DEFAULT_STRATEGY:Wt,Z_DEFLATED:qt}=B;function Jt(t){this.options=Tt({level:Xt,method:qt,chunkSize:16384,windowBits:15,memLevel:8,strategy:Wt},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ct,this.strm.avail_out=0;let a=St.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(a!==Yt)throw new Error(I[a]);if(e.header&&St.deflateSetHeader(this.strm,e.header),e.dictionary){let t;if(t="string"==typeof e.dictionary?Nt(e.dictionary):"[object ArrayBuffer]"===Ht.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,a=St.deflateSetDictionary(this.strm,t),a!==Yt)throw new Error(I[a]);this._dict_set=!0}}function Qt(t,e){const a=new Jt(e);if(a.push(t,!0),a.err)throw a.msg||I[a.err];return a.result}Jt.prototype.push=function(t,e){const a=this.strm,i=this.options.chunkSize;let n,s;if(this.ended)return!1;for(s=e===~~e?e:!0===e?Pt:Mt,"string"==typeof t?a.input=Nt(t):"[object ArrayBuffer]"===Ht.call(t)?a.input=new Uint8Array(t):a.input=t,a.next_in=0,a.avail_in=a.input.length;;)if(0===a.avail_out&&(a.output=new Uint8Array(i),a.next_out=0,a.avail_out=i),(s===jt||s===Kt)&&a.avail_out<=6)this.onData(a.output.subarray(0,a.next_out)),a.avail_out=0;else{if(n=St.deflate(a,s),n===Gt)return a.next_out>0&&this.onData(a.output.subarray(0,a.next_out)),n=St.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Yt;if(0!==a.avail_out){if(s>0&&a.next_out>0)this.onData(a.output.subarray(0,a.next_out)),a.avail_out=0;else if(0===a.avail_in)break}else this.onData(a.output)}return!0},Jt.prototype.onData=function(t){this.chunks.push(t)},Jt.prototype.onEnd=function(t){t===Yt&&(this.result=Ot(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Vt={Deflate:Jt,deflate:Qt,deflateRaw:function(t,e){return(e=e||{}).raw=!0,Qt(t,e)},gzip:function(t,e){return(e=e||{}).gzip=!0,Qt(t,e)},constants:B};var $t=function(t,e){let a,i,n,s,r,o,l,h,d,_,f,c,u,w,m,b,g,p,k,v,y,x,z,A;const E=t.state;a=t.next_in,z=t.input,i=a+(t.avail_in-5),n=t.next_out,A=t.output,s=n-(e-t.avail_out),r=n+(t.avail_out-257),o=E.dmax,l=E.wsize,h=E.whave,d=E.wnext,_=E.window,f=E.hold,c=E.bits,u=E.lencode,w=E.distcode,m=(1<<E.lenbits)-1,b=(1<<E.distbits)-1;t:do{c<15&&(f+=z[a++]<<c,c+=8,f+=z[a++]<<c,c+=8),g=u[f&m];e:for(;;){if(p=g>>>24,f>>>=p,c-=p,p=g>>>16&255,0===p)A[n++]=65535&g;else{if(!(16&p)){if(0==(64&p)){g=u[(65535&g)+(f&(1<<p)-1)];continue e}if(32&p){E.mode=16191;break t}t.msg="invalid literal/length code",E.mode=16209;break t}k=65535&g,p&=15,p&&(c<p&&(f+=z[a++]<<c,c+=8),k+=f&(1<<p)-1,f>>>=p,c-=p),c<15&&(f+=z[a++]<<c,c+=8,f+=z[a++]<<c,c+=8),g=w[f&b];a:for(;;){if(p=g>>>24,f>>>=p,c-=p,p=g>>>16&255,!(16&p)){if(0==(64&p)){g=w[(65535&g)+(f&(1<<p)-1)];continue a}t.msg="invalid distance code",E.mode=16209;break t}if(v=65535&g,p&=15,c<p&&(f+=z[a++]<<c,c+=8,c<p&&(f+=z[a++]<<c,c+=8)),v+=f&(1<<p)-1,v>o){t.msg="invalid distance too far back",E.mode=16209;break t}if(f>>>=p,c-=p,p=n-s,v>p){if(p=v-p,p>h&&E.sane){t.msg="invalid distance too far back",E.mode=16209;break t}if(y=0,x=_,0===d){if(y+=l-p,p<k){k-=p;do{A[n++]=_[y++]}while(--p);y=n-v,x=A}}else if(d<p){if(y+=l+d-p,p-=d,p<k){k-=p;do{A[n++]=_[y++]}while(--p);if(y=0,d<k){p=d,k-=p;do{A[n++]=_[y++]}while(--p);y=n-v,x=A}}}else if(y+=d-p,p<k){k-=p;do{A[n++]=_[y++]}while(--p);y=n-v,x=A}for(;k>2;)A[n++]=x[y++],A[n++]=x[y++],A[n++]=x[y++],k-=3;k&&(A[n++]=x[y++],k>1&&(A[n++]=x[y++]))}else{y=n-v;do{A[n++]=A[y++],A[n++]=A[y++],A[n++]=A[y++],k-=3}while(k>2);k&&(A[n++]=A[y++],k>1&&(A[n++]=A[y++]))}break}}break}}while(a<i&&n<r);k=c>>3,a-=k,c-=k<<3,f&=(1<<c)-1,t.next_in=a,t.next_out=n,t.avail_in=a<i?i-a+5:5-(a-i),t.avail_out=n<r?r-n+257:257-(n-r),E.hold=f,E.bits=c};const te=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ee=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),ae=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),ie=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var ne=(t,e,a,i,n,s,r,o)=>{const l=o.bits;let h,d,_,f,c,u,w=0,m=0,b=0,g=0,p=0,k=0,v=0,y=0,x=0,z=0,A=null;const E=new Uint16Array(16),R=new Uint16Array(16);let Z,U,S,D=null;for(w=0;w<=15;w++)E[w]=0;for(m=0;m<i;m++)E[e[a+m]]++;for(p=l,g=15;g>=1&&0===E[g];g--);if(p>g&&(p=g),0===g)return n[s++]=20971520,n[s++]=20971520,o.bits=1,0;for(b=1;b<g&&0===E[b];b++);for(p<b&&(p=b),y=1,w=1;w<=15;w++)if(y<<=1,y-=E[w],y<0)return-1;if(y>0&&(0===t||1!==g))return-1;for(R[1]=0,w=1;w<15;w++)R[w+1]=R[w]+E[w];for(m=0;m<i;m++)0!==e[a+m]&&(r[R[e[a+m]]++]=m);if(0===t?(A=D=r,u=20):1===t?(A=te,D=ee,u=257):(A=ae,D=ie,u=0),z=0,m=0,w=b,c=s,k=p,v=0,_=-1,x=1<<p,f=x-1,1===t&&x>852||2===t&&x>592)return 1;for(;;){Z=w-v,r[m]+1<u?(U=0,S=r[m]):r[m]>=u?(U=D[r[m]-u],S=A[r[m]-u]):(U=96,S=0),h=1<<w-v,d=1<<k,b=d;do{d-=h,n[c+(z>>v)+d]=Z<<24|U<<16|S|0}while(0!==d);for(h=1<<w-1;z&h;)h>>=1;if(0!==h?(z&=h-1,z+=h):z=0,m++,0==--E[w]){if(w===g)break;w=e[a+r[m]]}if(w>p&&(z&f)!==_){for(0===v&&(v=p),c+=b,k=w-v,y=1<<k;k+v<g&&(y-=E[k+v],!(y<=0));)k++,y<<=1;if(x+=1<<k,1===t&&x>852||2===t&&x>592)return 1;_=z&f,n[_]=p<<24|k<<16|c-s|0}}return 0!==z&&(n[c+z]=w-v<<24|64<<16|0),o.bits=p,0};const{Z_FINISH:se,Z_BLOCK:re,Z_TREES:oe,Z_OK:le,Z_STREAM_END:he,Z_NEED_DICT:de,Z_STREAM_ERROR:_e,Z_DATA_ERROR:fe,Z_MEM_ERROR:ce,Z_BUF_ERROR:ue,Z_DEFLATED:we}=B,me=16209,be=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function ge(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const pe=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<16180||e.mode>16211?1:0},ke=t=>{if(pe(t))return _e;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=16180,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,le},ve=t=>{if(pe(t))return _e;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,ke(t)},ye=(t,e)=>{let a;if(pe(t))return _e;const i=t.state;return e<0?(a=0,e=-e):(a=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?_e:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=a,i.wbits=e,ve(t))},xe=(t,e)=>{if(!t)return _e;const a=new ge;t.state=a,a.strm=t,a.window=null,a.mode=16180;const i=ye(t,e);return i!==le&&(t.state=null),i};let ze,Ae,Ee=!0;const Re=t=>{if(Ee){ze=new Int32Array(512),Ae=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(ne(1,t.lens,0,288,ze,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;ne(2,t.lens,0,32,Ae,0,t.work,{bits:5}),Ee=!1}t.lencode=ze,t.lenbits=9,t.distcode=Ae,t.distbits=5},Ze=(t,e,a,i)=>{let n;const s=t.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),i>=s.wsize?(s.window.set(e.subarray(a-s.wsize,a),0),s.wnext=0,s.whave=s.wsize):(n=s.wsize-s.wnext,n>i&&(n=i),s.window.set(e.subarray(a-i,a-i+n),s.wnext),(i-=n)?(s.window.set(e.subarray(a-i,a),0),s.wnext=i,s.whave=s.wsize):(s.wnext+=n,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=n))),0};var Ue={inflateReset:ve,inflateReset2:ye,inflateResetKeep:ke,inflateInit:t=>xe(t,15),inflateInit2:xe,inflate:(t,e)=>{let a,i,n,s,r,o,l,h,d,_,f,c,u,w,m,b,g,p,k,v,y,x,z=0;const A=new Uint8Array(4);let E,R;const Z=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(pe(t)||!t.output||!t.input&&0!==t.avail_in)return _e;a=t.state,16191===a.mode&&(a.mode=16192),r=t.next_out,n=t.output,l=t.avail_out,s=t.next_in,i=t.input,o=t.avail_in,h=a.hold,d=a.bits,_=o,f=l,x=le;t:for(;;)switch(a.mode){case 16180:if(0===a.wrap){a.mode=16192;break}for(;d<16;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}if(2&a.wrap&&35615===h){0===a.wbits&&(a.wbits=15),a.check=0,A[0]=255&h,A[1]=h>>>8&255,a.check=N(a.check,A,2,0),h=0,d=0,a.mode=16181;break}if(a.head&&(a.head.done=!1),!(1&a.wrap)||(((255&h)<<8)+(h>>8))%31){t.msg="incorrect header check",a.mode=me;break}if((15&h)!==we){t.msg="unknown compression method",a.mode=me;break}if(h>>>=4,d-=4,y=8+(15&h),0===a.wbits&&(a.wbits=y),y>15||y>a.wbits){t.msg="invalid window size",a.mode=me;break}a.dmax=1<<a.wbits,a.flags=0,t.adler=a.check=1,a.mode=512&h?16189:16191,h=0,d=0;break;case 16181:for(;d<16;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}if(a.flags=h,(255&a.flags)!==we){t.msg="unknown compression method",a.mode=me;break}if(57344&a.flags){t.msg="unknown header flags set",a.mode=me;break}a.head&&(a.head.text=h>>8&1),512&a.flags&&4&a.wrap&&(A[0]=255&h,A[1]=h>>>8&255,a.check=N(a.check,A,2,0)),h=0,d=0,a.mode=16182;case 16182:for(;d<32;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}a.head&&(a.head.time=h),512&a.flags&&4&a.wrap&&(A[0]=255&h,A[1]=h>>>8&255,A[2]=h>>>16&255,A[3]=h>>>24&255,a.check=N(a.check,A,4,0)),h=0,d=0,a.mode=16183;case 16183:for(;d<16;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}a.head&&(a.head.xflags=255&h,a.head.os=h>>8),512&a.flags&&4&a.wrap&&(A[0]=255&h,A[1]=h>>>8&255,a.check=N(a.check,A,2,0)),h=0,d=0,a.mode=16184;case 16184:if(1024&a.flags){for(;d<16;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}a.length=h,a.head&&(a.head.extra_len=h),512&a.flags&&4&a.wrap&&(A[0]=255&h,A[1]=h>>>8&255,a.check=N(a.check,A,2,0)),h=0,d=0}else a.head&&(a.head.extra=null);a.mode=16185;case 16185:if(1024&a.flags&&(c=a.length,c>o&&(c=o),c&&(a.head&&(y=a.head.extra_len-a.length,a.head.extra||(a.head.extra=new Uint8Array(a.head.extra_len)),a.head.extra.set(i.subarray(s,s+c),y)),512&a.flags&&4&a.wrap&&(a.check=N(a.check,i,c,s)),o-=c,s+=c,a.length-=c),a.length))break t;a.length=0,a.mode=16186;case 16186:if(2048&a.flags){if(0===o)break t;c=0;do{y=i[s+c++],a.head&&y&&a.length<65536&&(a.head.name+=String.fromCharCode(y))}while(y&&c<o);if(512&a.flags&&4&a.wrap&&(a.check=N(a.check,i,c,s)),o-=c,s+=c,y)break t}else a.head&&(a.head.name=null);a.length=0,a.mode=16187;case 16187:if(4096&a.flags){if(0===o)break t;c=0;do{y=i[s+c++],a.head&&y&&a.length<65536&&(a.head.comment+=String.fromCharCode(y))}while(y&&c<o);if(512&a.flags&&4&a.wrap&&(a.check=N(a.check,i,c,s)),o-=c,s+=c,y)break t}else a.head&&(a.head.comment=null);a.mode=16188;case 16188:if(512&a.flags){for(;d<16;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}if(4&a.wrap&&h!==(65535&a.check)){t.msg="header crc mismatch",a.mode=me;break}h=0,d=0}a.head&&(a.head.hcrc=a.flags>>9&1,a.head.done=!0),t.adler=a.check=0,a.mode=16191;break;case 16189:for(;d<32;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}t.adler=a.check=be(h),h=0,d=0,a.mode=16190;case 16190:if(0===a.havedict)return t.next_out=r,t.avail_out=l,t.next_in=s,t.avail_in=o,a.hold=h,a.bits=d,de;t.adler=a.check=1,a.mode=16191;case 16191:if(e===re||e===oe)break t;case 16192:if(a.last){h>>>=7&d,d-=7&d,a.mode=16206;break}for(;d<3;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}switch(a.last=1&h,h>>>=1,d-=1,3&h){case 0:a.mode=16193;break;case 1:if(Re(a),a.mode=16199,e===oe){h>>>=2,d-=2;break t}break;case 2:a.mode=16196;break;case 3:t.msg="invalid block type",a.mode=me}h>>>=2,d-=2;break;case 16193:for(h>>>=7&d,d-=7&d;d<32;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}if((65535&h)!=(h>>>16^65535)){t.msg="invalid stored block lengths",a.mode=me;break}if(a.length=65535&h,h=0,d=0,a.mode=16194,e===oe)break t;case 16194:a.mode=16195;case 16195:if(c=a.length,c){if(c>o&&(c=o),c>l&&(c=l),0===c)break t;n.set(i.subarray(s,s+c),r),o-=c,s+=c,l-=c,r+=c,a.length-=c;break}a.mode=16191;break;case 16196:for(;d<14;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}if(a.nlen=257+(31&h),h>>>=5,d-=5,a.ndist=1+(31&h),h>>>=5,d-=5,a.ncode=4+(15&h),h>>>=4,d-=4,a.nlen>286||a.ndist>30){t.msg="too many length or distance symbols",a.mode=me;break}a.have=0,a.mode=16197;case 16197:for(;a.have<a.ncode;){for(;d<3;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}a.lens[Z[a.have++]]=7&h,h>>>=3,d-=3}for(;a.have<19;)a.lens[Z[a.have++]]=0;if(a.lencode=a.lendyn,a.lenbits=7,E={bits:a.lenbits},x=ne(0,a.lens,0,19,a.lencode,0,a.work,E),a.lenbits=E.bits,x){t.msg="invalid code lengths set",a.mode=me;break}a.have=0,a.mode=16198;case 16198:for(;a.have<a.nlen+a.ndist;){for(;z=a.lencode[h&(1<<a.lenbits)-1],m=z>>>24,b=z>>>16&255,g=65535&z,!(m<=d);){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}if(g<16)h>>>=m,d-=m,a.lens[a.have++]=g;else{if(16===g){for(R=m+2;d<R;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}if(h>>>=m,d-=m,0===a.have){t.msg="invalid bit length repeat",a.mode=me;break}y=a.lens[a.have-1],c=3+(3&h),h>>>=2,d-=2}else if(17===g){for(R=m+3;d<R;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}h>>>=m,d-=m,y=0,c=3+(7&h),h>>>=3,d-=3}else{for(R=m+7;d<R;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}h>>>=m,d-=m,y=0,c=11+(127&h),h>>>=7,d-=7}if(a.have+c>a.nlen+a.ndist){t.msg="invalid bit length repeat",a.mode=me;break}for(;c--;)a.lens[a.have++]=y}}if(a.mode===me)break;if(0===a.lens[256]){t.msg="invalid code -- missing end-of-block",a.mode=me;break}if(a.lenbits=9,E={bits:a.lenbits},x=ne(1,a.lens,0,a.nlen,a.lencode,0,a.work,E),a.lenbits=E.bits,x){t.msg="invalid literal/lengths set",a.mode=me;break}if(a.distbits=6,a.distcode=a.distdyn,E={bits:a.distbits},x=ne(2,a.lens,a.nlen,a.ndist,a.distcode,0,a.work,E),a.distbits=E.bits,x){t.msg="invalid distances set",a.mode=me;break}if(a.mode=16199,e===oe)break t;case 16199:a.mode=16200;case 16200:if(o>=6&&l>=258){t.next_out=r,t.avail_out=l,t.next_in=s,t.avail_in=o,a.hold=h,a.bits=d,$t(t,f),r=t.next_out,n=t.output,l=t.avail_out,s=t.next_in,i=t.input,o=t.avail_in,h=a.hold,d=a.bits,16191===a.mode&&(a.back=-1);break}for(a.back=0;z=a.lencode[h&(1<<a.lenbits)-1],m=z>>>24,b=z>>>16&255,g=65535&z,!(m<=d);){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}if(b&&0==(240&b)){for(p=m,k=b,v=g;z=a.lencode[v+((h&(1<<p+k)-1)>>p)],m=z>>>24,b=z>>>16&255,g=65535&z,!(p+m<=d);){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}h>>>=p,d-=p,a.back+=p}if(h>>>=m,d-=m,a.back+=m,a.length=g,0===b){a.mode=16205;break}if(32&b){a.back=-1,a.mode=16191;break}if(64&b){t.msg="invalid literal/length code",a.mode=me;break}a.extra=15&b,a.mode=16201;case 16201:if(a.extra){for(R=a.extra;d<R;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}a.length+=h&(1<<a.extra)-1,h>>>=a.extra,d-=a.extra,a.back+=a.extra}a.was=a.length,a.mode=16202;case 16202:for(;z=a.distcode[h&(1<<a.distbits)-1],m=z>>>24,b=z>>>16&255,g=65535&z,!(m<=d);){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}if(0==(240&b)){for(p=m,k=b,v=g;z=a.distcode[v+((h&(1<<p+k)-1)>>p)],m=z>>>24,b=z>>>16&255,g=65535&z,!(p+m<=d);){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}h>>>=p,d-=p,a.back+=p}if(h>>>=m,d-=m,a.back+=m,64&b){t.msg="invalid distance code",a.mode=me;break}a.offset=g,a.extra=15&b,a.mode=16203;case 16203:if(a.extra){for(R=a.extra;d<R;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}a.offset+=h&(1<<a.extra)-1,h>>>=a.extra,d-=a.extra,a.back+=a.extra}if(a.offset>a.dmax){t.msg="invalid distance too far back",a.mode=me;break}a.mode=16204;case 16204:if(0===l)break t;if(c=f-l,a.offset>c){if(c=a.offset-c,c>a.whave&&a.sane){t.msg="invalid distance too far back",a.mode=me;break}c>a.wnext?(c-=a.wnext,u=a.wsize-c):u=a.wnext-c,c>a.length&&(c=a.length),w=a.window}else w=n,u=r-a.offset,c=a.length;c>l&&(c=l),l-=c,a.length-=c;do{n[r++]=w[u++]}while(--c);0===a.length&&(a.mode=16200);break;case 16205:if(0===l)break t;n[r++]=a.length,l--,a.mode=16200;break;case 16206:if(a.wrap){for(;d<32;){if(0===o)break t;o--,h|=i[s++]<<d,d+=8}if(f-=l,t.total_out+=f,a.total+=f,4&a.wrap&&f&&(t.adler=a.check=a.flags?N(a.check,n,f,r-f):F(a.check,n,f,r-f)),f=l,4&a.wrap&&(a.flags?h:be(h))!==a.check){t.msg="incorrect data check",a.mode=me;break}h=0,d=0}a.mode=16207;case 16207:if(a.wrap&&a.flags){for(;d<32;){if(0===o)break t;o--,h+=i[s++]<<d,d+=8}if(4&a.wrap&&h!==(4294967295&a.total)){t.msg="incorrect length check",a.mode=me;break}h=0,d=0}a.mode=16208;case 16208:x=he;break t;case me:x=fe;break t;case 16210:return ce;default:return _e}return t.next_out=r,t.avail_out=l,t.next_in=s,t.avail_in=o,a.hold=h,a.bits=d,(a.wsize||f!==t.avail_out&&a.mode<me&&(a.mode<16206||e!==se))&&Ze(t,t.output,t.next_out,f-t.avail_out),_-=t.avail_in,f-=t.avail_out,t.total_in+=_,t.total_out+=f,a.total+=f,4&a.wrap&&f&&(t.adler=a.check=a.flags?N(a.check,n,f,t.next_out-f):F(a.check,n,f,t.next_out-f)),t.data_type=a.bits+(a.last?64:0)+(16191===a.mode?128:0)+(16199===a.mode||16194===a.mode?256:0),(0===_&&0===f||e===se)&&x===le&&(x=ue),x},inflateEnd:t=>{if(pe(t))return _e;let e=t.state;return e.window&&(e.window=null),t.state=null,le},inflateGetHeader:(t,e)=>{if(pe(t))return _e;const a=t.state;return 0==(2&a.wrap)?_e:(a.head=e,e.done=!1,le)},inflateSetDictionary:(t,e)=>{const a=e.length;let i,n,s;return pe(t)?_e:(i=t.state,0!==i.wrap&&16190!==i.mode?_e:16190===i.mode&&(n=1,n=F(n,e,a,0),n!==i.check)?fe:(s=Ze(t,e,a,a),s?(i.mode=16210,ce):(i.havedict=1,le)))},inflateInfo:"pako inflate (from Nodeca project)"};var Se=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const De=Object.prototype.toString,{Z_NO_FLUSH:Te,Z_FINISH:Oe,Z_OK:Fe,Z_STREAM_END:Le,Z_NEED_DICT:Ne,Z_STREAM_ERROR:Ie,Z_DATA_ERROR:Be,Z_MEM_ERROR:Ce}=B;function He(t){this.options=Tt({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ct,this.strm.avail_out=0;let a=Ue.inflateInit2(this.strm,e.windowBits);if(a!==Fe)throw new Error(I[a]);if(this.header=new Se,Ue.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=Nt(e.dictionary):"[object ArrayBuffer]"===De.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(a=Ue.inflateSetDictionary(this.strm,e.dictionary),a!==Fe)))throw new Error(I[a])}He.prototype.push=function(t,e){const a=this.strm,i=this.options.chunkSize,n=this.options.dictionary;let s,r,o;if(this.ended)return!1;for(r=e===~~e?e:!0===e?Oe:Te,"[object ArrayBuffer]"===De.call(t)?a.input=new Uint8Array(t):a.input=t,a.next_in=0,a.avail_in=a.input.length;;){for(0===a.avail_out&&(a.output=new Uint8Array(i),a.next_out=0,a.avail_out=i),s=Ue.inflate(a,r),s===Ne&&n&&(s=Ue.inflateSetDictionary(a,n),s===Fe?s=Ue.inflate(a,r):s===Be&&(s=Ne));a.avail_in>0&&s===Le&&a.state.wrap>0&&0!==t[a.next_in];)Ue.inflateReset(a),s=Ue.inflate(a,r);switch(s){case Ie:case Be:case Ne:case Ce:return this.onEnd(s),this.ended=!0,!1}if(o=a.avail_out,a.next_out&&(0===a.avail_out||s===Le))if("string"===this.options.to){let t=Bt(a.output,a.next_out),e=a.next_out-t,n=It(a.output,t);a.next_out=e,a.avail_out=i-e,e&&a.output.set(a.output.subarray(t,t+e),0),this.onData(n)}else this.onData(a.output.length===a.next_out?a.output:a.output.subarray(0,a.next_out));if(s!==Fe||0!==o){if(s===Le)return s=Ue.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(0===a.avail_in)break}}return!0},He.prototype.onData=function(t){this.chunks.push(t)},He.prototype.onEnd=function(t){t===Fe&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Ot(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};const{Deflate:Me,deflate:je,deflateRaw:Ke,gzip:Pe}=Vt;var Ye=Me,Ge=je,Xe=B;const We=new class{constructor(){this._init()}clear(){this._init()}addEvent(t){if(!t)throw new Error("Adding invalid event");const e=this._hasEvents?",":"";this.deflate.push(e+t,Xe.Z_SYNC_FLUSH),this._hasEvents=!0}finish(){if(this.deflate.push("]",Xe.Z_FINISH),this.deflate.err)throw this.deflate.err;const t=this.deflate.result;return this._init(),t}_init(){this._hasEvents=!1,this.deflate=new Ye,this.deflate.push("[",Xe.Z_NO_FLUSH)}},qe={clear:()=>{We.clear()},addEvent:t=>We.addEvent(t),finish:()=>We.finish(),compress:t=>function(t){return Ge(t)}(t)};addEventListener("message",(function(t){const e=t.data.method,a=t.data.id,i=t.data.arg;if(e in qe&&"function"==typeof qe[e])try{const t=qe[e](i);postMessage({id:a,method:e,success:!0,response:t})}catch(t){postMessage({id:a,method:e,success:!1,response:t.message}),console.error(t)}})),postMessage({id:void 0,method:"init",success:!0,response:void 0});']);return URL.createObjectURL(t)}();Ck("[Replay] Using compression worker");const e=new Worker(t);return new Dk(e)}catch(e){Ck("[Replay] Failed to create compression worker")}return Ck("[Replay] Using simple buffer"),new Rk}function Bk(){try{return"sessionStorage"in wI&&!!wI.sessionStorage}catch(t){return!1}}function Ok(t){!function(){if(!Bk())return;try{wI.sessionStorage.removeItem(SI)}catch(t){}}(),t.session=void 0}function Fk(t){return void 0!==t&&Math.random()<t}function Nk(t){if(Bk())try{wI.sessionStorage.setItem(SI,JSON.stringify(t))}catch(e){}}function Uk(t){const e=Date.now();return{id:t.id||SE(),started:t.started||e,lastActivity:t.lastActivity||e,segmentId:t.segmentId||0,sampled:t.sampled,shouldRefresh:"boolean"!==typeof t.shouldRefresh||t.shouldRefresh,previousSessionId:t.previousSessionId}}function $k({sessionSampleRate:t,allowBuffering:e,stickySession:i=!1},{previousSessionId:n}={}){const r=function(t,e){return Fk(t)?"session":!!e&&"buffer"}(t,e),a=Uk({sampled:r,previousSessionId:n});return i&&Nk(a),a}function Vk(t,e,i=+new Date){return null===t||void 0===e||e<0||0!==e&&t+e<=i}function jk(t,e,i=+new Date){return Vk(t.started,e.maxSessionLife,i)||Vk(t.lastActivity,e.sessionIdleExpire,i)}function qk(t,{timeouts:e,traceInternals:i},n){if(!jk(t,e))return t;const r="buffer"===t.sampled;if(r&&t.shouldRefresh)return t;if(r)return Ik("[Replay] Session should not be refreshed",i),Uk({sampled:!1});Ik("[Replay] Session has expired, creating new one...",i);return $k(n,{previousSessionId:t.id})}function Gk(t,{timeouts:e,traceInternals:i},n){const r=t||n.stickySession&&function(t){if(!Bk())return null;try{const e=wI.sessionStorage.getItem(SI);if(!e)return null;const i=JSON.parse(e);return Ik("[Replay] Loading existing session",t),Uk(i)}catch(e){return null}}(i);return r?qk(r,{timeouts:e,traceInternals:i},n):(Ik("[Replay] Created new session",i),$k(n))}async function Hk(t,e,i){if(!t.eventBuffer)return null;if(t.isPaused())return null;const n=lk(e.timestamp);if(n+t.timeouts.sessionIdlePause<Date.now())return null;if(n>t.getContext().initialTimestamp+t.timeouts.maxSessionLife)return Ck(`[Replay] Skipping event with timestamp ${n} because it is after maxSessionLife`,t.getOptions()._experiments.traceInternals),null;try{i&&"buffer"===t.recordingMode&&t.eventBuffer.clear(),i&&(t.eventBuffer.hasCheckout=!0);const n=function(t,e){try{if("function"===typeof e&&function(t){return t.type===nA.Custom}(t))return e(t)}catch(i){return("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.error("[Replay] An error occured in the `beforeAddRecordingEvent` callback, skipping the event...",i),null}return t}(e,t.getOptions().beforeAddRecordingEvent);if(!n)return;return await t.eventBuffer.addEvent(n)}catch(r){const e=r&&r instanceof kk?"addEventSizeExceeded":"addEvent";("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.error(r),await t.stop({reason:e});const i=XE().getClient();i&&i.recordDroppedEvent("internal_sdk_error","replay")}}function Wk(t){return!t.type}function Zk(t){return"transaction"===t.type}function Yk(t){const e=function(){const t=XE().getClient();if(!t)return!1;const e=t.getTransport();if(!e)return!1;return e.send.__sentry__baseTransport__||!1}();return(i,n)=>{if(!t.isEnabled()||!Wk(i)&&!Zk(i))return;const r=n&&n.statusCode;e&&(!r||r<200||r>=300)||(Zk(i)?function(t,e){const i=t.getContext();e.contexts&&e.contexts.trace&&e.contexts.trace.trace_id&&i.traceIds.size<100&&i.traceIds.add(e.contexts.trace.trace_id)}(t,i):function(t,e){const i=t.getContext();e.event_id&&i.errorIds.size<100&&i.errorIds.add(e.event_id);"buffer"===t.recordingMode&&e.tags&&e.tags.replayId&&setTimeout((()=>{t.sendBufferedReplayOrFlush()}))}(t,i))}}function Xk(t,e=!1){const i=e?Yk(t):void 0;return(e,n)=>{if(!t.isEnabled())return e;if(function(t){return"replay_event"===t.type}(e))return delete e.breadcrumbs,e;if(!Wk(e)&&!Zk(e))return e;if(function(t,e){return!(t.type||!t.exception||!t.exception.values||!t.exception.values.length)&&(!(!e.originalException||!e.originalException.__rrweb__)||t.exception.values.some((t=>!!(t.stacktrace&&t.stacktrace.frames&&t.stacktrace.frames.length)&&t.stacktrace.frames.some((t=>t.filename&&t.filename.includes("/rrweb/src/"))))))}(e,n)&&!t.getOptions()._experiments.captureExceptions)return("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log("[Replay] Ignoring error from rrweb internals",e),null;const r=function(t,e){return"buffer"===t.recordingMode&&e.message!==EI&&!(!e.exception||e.type)&&Fk(t.getOptions().errorSampleRate)}(t,e);return(r||"session"===t.recordingMode)&&(e.tags={...e.tags,replayId:t.getSessionId()}),i&&i(e,{statusCode:200}),e}}function Kk(t,e){return e.map((({type:e,start:i,end:n,name:r,data:a})=>{const o=t.throttledAddEvent({type:nA.Custom,timestamp:i,data:{tag:"performanceSpan",payload:{op:e,description:r,startTimestamp:i,endTimestamp:n,data:a}}});return"string"===typeof o?Promise.resolve(null):o}))}function Jk(t){return e=>{if(!t.isEnabled())return;const i=function(t){const{from:e,to:i}=t,n=Date.now()/1e3;return{type:"navigation.push",start:n,end:n,name:i,data:{previous:e}}}(e);null!==i&&(t.getContext().urls.push(i.name),t.triggerUserActivity(),t.addUpdate((()=>(Kk(t,[i]),!1))))}}function Qk(t,e){return("undefined"!==typeof __SENTRY_DEBUG__&&!__SENTRY_DEBUG__||!t.getOptions()._experiments.traceInternals)&&function(t){const e=XE().getClient(),i=e&&e.getDsn();return!!i&&t.includes(i.host)}(e)}function tR(t,e){t.isEnabled()&&null!==e&&(Qk(t,e.name)||t.addUpdate((()=>(Kk(t,[e]),!0))))}const eR=10,iR=11,nR=12,rR=13,aR=14,oR=15,sR=20,lR=21,cR=22,uR=23,hR=["true","false","null"];function pR(t,e){if(!e.length)return t;let i=t;const n=e.length-1;i=function(t,e){switch(e){case eR:return`${t}"~~":"~~"`;case 11:return`${t}:"~~"`;case 12:return`${t}~~":"~~"`;case rR:return function(t){const e=t.lastIndexOf(":"),i=t.slice(e+1);if(hR.includes(i.trim()))return`${t},"~~":"~~"`;return`${t.slice(0,e+1)}"~~"`}(t);case 14:return`${t}~~"`;case oR:return`${t},"~~":"~~"`;case sR:return`${t}"~~"`;case lR:return function(t){const e=function(t){for(let e=t.length-1;e>=0;e--){const i=t[e];if(","===i||"["===i)return e}return-1}(t);if(e>-1){const i=t.slice(e+1);return hR.includes(i.trim())?`${t},"~~"`:`${t.slice(0,e+1)}"~~"`}return t}(t);case 22:return`${t}~~"`;case uR:return`${t},"~~"`}return t}(i,e[n]);for(let r=n;r>=0;r--){switch(e[r]){case eR:i=`${i}}`;break;case sR:i=`${i}]`}}return i}function dR(t,e,i){const n=t[t.length-1],r=e[i];if(!/\s/.test(r))if('"'!==r||fR(e,i))switch(r){case"{":!function(t,e){if(!e)return void t.push(eR);if(e===rR)return void t.push(eR);e===lR&&t.push(eR);if(e===sR)t.push(eR)}(t,n);break;case"[":!function(t,e){if(!e)return t.push(sR),void t.push(lR);if(e===rR)return t.push(sR),void t.push(lR);e===lR&&(t.push(sR),t.push(lR));if(e===sR)t.push(sR),t.push(lR)}(t,n);break;case":":!function(t,e){e===iR&&(t.pop(),t.push(rR))}(t,n);break;case",":!function(t,e){if(e===rR)return void t.pop();if(e===oR)return t.pop(),void t.pop();if(e===lR)return;if(e===uR)t.pop()}(t,n);break;case"}":!function(t,e){e===eR&&t.pop();e===rR&&(t.pop(),t.pop());e===oR&&(t.pop(),t.pop(),t.pop());t[t.length-1]===rR&&t.push(oR);t[t.length-1]===lR&&t.push(uR)}(t,n);break;case"]":!function(t,e){e===sR&&t.pop();e===lR&&(t.pop(),t.pop());e===uR&&(t.pop(),t.pop(),t.pop());t[t.length-1]===rR&&t.push(oR);t[t.length-1]===lR&&t.push(uR)}(t,n)}else!function(t,e){if(e===aR)return t.pop(),void t.push(oR);if(e===cR)return t.pop(),void t.push(uR);if(e===rR)return void t.push(aR);if(e===lR)return void t.push(cR);if(e===eR)return void t.push(nR);if(e===nR)t.pop(),t.push(11)}(t,n)}function fR(t,e){return"\\"===t[e-1]&&!fR(t,e-1)}function mR(t){return pR(t,function(t){const e=[];for(let i=0;i<t.length;i++)dR(e,t,i);return e}(t))}function gR(t,e){if(t)try{if("string"===typeof t)return e.encode(t).length;if(t instanceof URLSearchParams)return e.encode(t.toString()).length;if(t instanceof FormData){const i=SR(t);return e.encode(i).length}if(t instanceof Blob)return t.size;if(t instanceof ArrayBuffer)return t.byteLength}catch(i){}}function _R(t){if(!t)return;const e=parseInt(t,10);return isNaN(e)?void 0:e}function yR(t){return"string"===typeof t?t:t instanceof URLSearchParams?t.toString():t instanceof FormData?SR(t):void 0}function vR(t,e){if(!e)return null;const{startTimestamp:i,endTimestamp:n,url:r,method:a,statusCode:o,request:s,response:l}=e;return{type:t,start:i/1e3,end:n/1e3,name:r,data:bE({method:a,statusCode:o,request:s,response:l})}}function xR(t){return{headers:{},size:t,_meta:{warnings:["URL_SKIPPED"]}}}function bR(t,e,i){if(!e&&0===Object.keys(t).length)return;if(!e)return{headers:t};if(!i)return{headers:t,size:e};const n={headers:t,size:e},{body:r,warnings:a}=function(t){if(!t||"string"!==typeof t)return{body:t,warnings:[]};const e=t.length>TI;if(function(t){const e=t[0],i=t[t.length-1];return"["===e&&"]"===i||"{"===e&&"}"===i}(t))try{const i=e?mR(t.slice(0,TI)):t;return{body:JSON.parse(i),warnings:e?["JSON_TRUNCATED"]:[]}}catch(i){return{body:e?`${t.slice(0,TI)}\u2026`:t,warnings:e?["INVALID_JSON","TEXT_TRUNCATED"]:["INVALID_JSON"]}}return{body:e?`${t.slice(0,TI)}\u2026`:t,warnings:e?["TEXT_TRUNCATED"]:[]}}(i);return n.body=r,a.length>0&&(n._meta={warnings:a}),n}function wR(t,e){return Object.keys(t).reduce(((i,n)=>{const r=n.toLowerCase();return e.includes(r)&&t[n]&&(i[r]=t[n]),i}),{})}function SR(t){return new URLSearchParams(t).toString()}function ER(t,e){const i=function(t,e=wI.document.baseURI){if(t.startsWith("http://")||t.startsWith("https://")||t.startsWith(wI.location.origin))return t;const i=new URL(t,e);if(i.origin!==new URL(e).origin)return t;const n=i.href;if(!t.endsWith("/")&&n.endsWith("/"))return n.slice(0,-1);return n}(t);return dE(i,e)}async function TR(t,e,i){try{const n=await async function(t,e,i){const{startTimestamp:n,endTimestamp:r}=e,{url:a,method:o,status_code:s=0,request_body_size:l,response_body_size:c}=t.data,u=ER(a,i.networkDetailAllowUrls)&&!ER(a,i.networkDetailDenyUrls),h=u?function({networkCaptureBodies:t,networkRequestHeaders:e},i,n){const r=function(t,e){if(1===t.length&&"string"!==typeof t[0])return IR(t[0],e);if(2===t.length)return IR(t[1],e);return{}}(i,e);if(!t)return bR(r,n,void 0);const a=yR(MR(i));return bR(r,n,a)}(i,e.input,l):xR(l),p=await async function(t,{networkCaptureBodies:e,textEncoder:i,networkResponseHeaders:n},r,a){if(!t&&void 0!==a)return xR(a);const o=CR(r.headers,n);if(!e&&void 0!==a)return bR(o,a,void 0);try{const n=r.clone(),s=await async function(t){try{return await t.text()}catch(e){return}}(n),l=s&&s.length&&void 0===a?gR(s,i):a;return t?bR(o,l,e?s:void 0):xR(l)}catch(s){return bR(o,a,void 0)}}(u,i,e.response,c);return{startTimestamp:n,endTimestamp:r,url:a,method:o,statusCode:s,request:h,response:p}}(t,e,i),r=vR("resource.fetch",n);tR(i.replay,r)}catch(n){("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.error("[Replay] Failed to capture fetch breadcrumb",n)}}function MR(t=[]){if(2===t.length&&"object"===typeof t[1])return t[1].body}function CR(t,e){const i={};return e.forEach((e=>{t.get(e)&&(i[e]=t.get(e))})),i}function IR(t,e){if(!t)return{};const i=t.headers;return i?i instanceof Headers?CR(i,e):Array.isArray(i)?{}:wR(i,e):{}}async function AR(t,e,i){try{const n=function(t,e,i){const{startTimestamp:n,endTimestamp:r,input:a,xhr:o}=e,{url:s,method:l,status_code:c=0,request_body_size:u,response_body_size:h}=t.data;if(!s)return null;if(!ER(s,i.networkDetailAllowUrls)||ER(s,i.networkDetailDenyUrls)){return{startTimestamp:n,endTimestamp:r,url:s,method:l,statusCode:c,request:xR(u),response:xR(h)}}const p=o.__sentry_xhr_v2__,d=p?wR(p.request_headers,i.networkRequestHeaders):{},f=wR(function(t){const e=t.getAllResponseHeaders();if(!e)return{};return e.split("\r\n").reduce(((t,e)=>{const[i,n]=e.split(": ");return t[i.toLowerCase()]=n,t}),{})}(o),i.networkResponseHeaders),m=bR(d,u,i.networkCaptureBodies?yR(a):void 0),g=bR(f,h,i.networkCaptureBodies?e.xhr.responseText:void 0);return{startTimestamp:n,endTimestamp:r,url:s,method:l,statusCode:c,request:m,response:g}}(t,e,i),r=vR("resource.xhr",n);tR(i.replay,r)}catch(n){("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.error("[Replay] Failed to capture fetch breadcrumb",n)}}function kR(t){const e=XE().getClient();try{const i=new TextEncoder,{networkDetailAllowUrls:n,networkDetailDenyUrls:r,networkCaptureBodies:a,networkRequestHeaders:o,networkResponseHeaders:s}=t.getOptions(),l={replay:t,textEncoder:i,networkDetailAllowUrls:n,networkDetailDenyUrls:r,networkCaptureBodies:a,networkRequestHeaders:o,networkResponseHeaders:s};e&&e.on?e.on("beforeAddBreadcrumb",((t,e)=>function(t,e,i){if(!e.data)return;try{(function(t){return"xhr"===t.category})(e)&&function(t){return t&&t.xhr}(i)&&(!function(t,e,i){const{xhr:n,input:r}=e,a=gR(r,i.textEncoder),o=n.getResponseHeader("content-length")?_R(n.getResponseHeader("content-length")):gR(n.response,i.textEncoder);void 0!==a&&(t.data.request_body_size=a),void 0!==o&&(t.data.response_body_size=o)}(e,i,t),AR(e,i,t)),function(t){return"fetch"===t.category}(e)&&function(t){return t&&t.response}(i)&&(!function(t,e,i){const{input:n,response:r}=e,a=gR(MR(n),i.textEncoder),o=r?_R(r.headers.get("content-length")):void 0;void 0!==a&&(t.data.request_body_size=a),void 0!==o&&(t.data.response_body_size=o)}(e,i,t),TR(e,i,t))}catch(n){("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.warn("Error when enriching network breadcrumb")}}(l,t,e))):(ST("fetch",function(t){return e=>{if(!t.isEnabled())return;const i=function(t){const{startTimestamp:e,endTimestamp:i,fetchData:n,response:r}=t;if(!i)return null;const{method:a,url:o}=n;return{type:"resource.fetch",start:e/1e3,end:i/1e3,name:o,data:{method:a,statusCode:r?r.status:void 0}}}(e);tR(t,i)}}(t)),ST("xhr",function(t){return e=>{if(!t.isEnabled())return;const i=function(t){const{startTimestamp:e,endTimestamp:i,xhr:n}=t,r=n.__sentry_xhr_v2__;if(!e||!i||!r)return null;const{method:a,url:o,status_code:s}=r;return void 0===o?null:{type:"resource.xhr",name:o,start:e/1e3,end:i/1e3,data:{method:a,statusCode:s}}}(e);tR(t,i)}}(t)))}catch(i){}}let RR=null;const zR=t=>e=>{if(!t.isEnabled())return;const i=function(t){const e=t.getLastBreadcrumb&&t.getLastBreadcrumb();if(RR===e||!e)return null;if(RR=e,!function(t){return!!t.category}(e)||["fetch","xhr","sentry.event","sentry.transaction"].includes(e.category)||e.category.startsWith("ui."))return null;if("console"===e.category)return function(t){const e=t.data&&t.data.arguments;if(!Array.isArray(e)||0===e.length)return _k(t);let i=!1;const n=e.map((t=>{if(!t)return t;if("string"===typeof t)return t.length>MI?(i=!0,`${t.slice(0,MI)}\u2026`):t;if("object"===typeof t)try{const e=FT(t,7),n=JSON.stringify(e);if(n.length>MI){const t=mR(n.slice(0,MI)),e=JSON.parse(t);return i=!0,e}return e}catch(e){}return t}));return _k({...t,data:{...t.data,arguments:n,...i?{_meta:{warnings:["CONSOLE_ARG_TRUNCATED"]}}:{}}})}(e);return _k(e)}(e);i&&ck(t,i)};function PR(t){return!(!t||!t.on)}function DR(t){const{jsHeapSizeLimit:e,totalJSHeapSize:i,usedJSHeapSize:n}=t,r=Date.now()/1e3;return{type:"memory",name:"memory",start:r,end:r,data:{memory:{jsHeapSizeLimit:e,totalJSHeapSize:i,usedJSHeapSize:n}}}}const LR={resource:function(t){const{entryType:e,initiatorType:i,name:n,responseEnd:r,startTime:a,decodedBodySize:o,encodedBodySize:s,responseStatus:l,transferSize:c}=t;if(["fetch","xmlhttprequest"].includes(i))return null;return{type:`${e}.${i}`,start:OR(a),end:OR(r),name:n,data:{size:c,statusCode:l,decodedBodySize:o,encodedBodySize:s}}},paint:function(t){const{duration:e,entryType:i,name:n,startTime:r}=t,a=OR(r);return{type:i,name:n,start:a,end:a+e,data:void 0}},navigation:function(t){const{entryType:e,name:i,decodedBodySize:n,duration:r,domComplete:a,encodedBodySize:o,domContentLoadedEventStart:s,domContentLoadedEventEnd:l,domInteractive:c,loadEventStart:u,loadEventEnd:h,redirectCount:p,startTime:d,transferSize:f,type:m}=t;if(0===r)return null;return{type:`${e}.${m}`,start:OR(d),end:OR(a),name:i,data:{size:f,decodedBodySize:n,encodedBodySize:o,duration:r,domInteractive:c,domContentLoadedEventStart:s,domContentLoadedEventEnd:l,loadEventStart:u,loadEventEnd:h,domComplete:a,redirectCount:p}}},"largest-contentful-paint":function(t){const{entryType:e,startTime:i,size:n}=t;let r=0;if(wI.performance){const t=wI.performance.getEntriesByType("navigation")[0];r=t&&t.activationStart||0}const a=Math.max(i-r,0),o=OR(r)+a/1e3;return{type:e,name:e,start:o,end:o,data:{value:a,size:n,nodeId:sk.mirror.getId(t.element)}}}};function BR(t){return void 0===LR[t.entryType]?null:LR[t.entryType](t)}function OR(t){return((DE.Z1||wI.performance.timeOrigin)+t)/1e3}function FR(t){let e=!1;return(i,n)=>{if(!t.checkAndHandleExpiredSession())return void(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.warn("[Replay] Received replay event after session expired."));const r=n||!e;e=!0,t.addUpdate((()=>{if("buffer"===t.recordingMode&&r&&t.setInitialState(),Hk(t,i,r),!r)return!1;if(function(t,e){if(!e||!t.session||0!==t.session.segmentId)return Promise.resolve(null);Hk(t,function(t){const e=t.getOptions();return{type:nA.Custom,timestamp:Date.now(),data:{tag:"options",payload:{sessionSampleRate:e.sessionSampleRate,errorSampleRate:e.errorSampleRate,useCompressionOption:e.useCompression,blockAllMedia:e.blockAllMedia,maskAllText:e.maskAllText,maskAllInputs:e.maskAllInputs,useCompression:!!t.eventBuffer&&"worker"===t.eventBuffer.type,networkDetailHasUrls:e.networkDetailAllowUrls.length>0,networkCaptureBodies:e.networkCaptureBodies,networkRequestHasHeaders:e.networkRequestHeaders.length>0,networkResponseHasHeaders:e.networkResponseHeaders.length>0}}}}(t),!1)}(t,r),t.session&&t.session.previousSessionId)return!0;if("buffer"===t.recordingMode&&t.session&&t.eventBuffer){const e=t.eventBuffer.getEarliestTimestamp();e&&(Ck(`[Replay] Updating session start time to earliest event in buffer to ${new Date(e)}`,t.getOptions()._experiments.traceInternals),t.session.started=e,t.getOptions().stickySession&&Nk(t.session))}return"session"===t.recordingMode&&t.flush(),!0}))}}async function NR({recordingData:t,replayId:e,segmentId:i,eventContext:n,timestamp:r,session:a}){const o=function({recordingData:t,headers:e}){let i;const n=`${JSON.stringify(e)}\n`;if("string"===typeof t)i=`${n}${t}`;else{const e=(new TextEncoder).encode(n);i=new Uint8Array(e.length+t.length),i.set(e),i.set(t,e.length)}return i}({recordingData:t,headers:{segment_id:i}}),{urls:s,errorIds:l,traceIds:c,initialTimestamp:u}=n,h=XE(),p=h.getClient(),d=h.getScope(),f=p&&p.getTransport(),m=p&&p.getDsn();if(!p||!f||!m||!a.sampled)return;const g={type:"replay_event",replay_start_timestamp:u/1e3,timestamp:r/1e3,error_ids:l,trace_ids:c,urls:s,replay_id:e,segment_id:i,replay_type:a.sampled},_=await async function({client:t,scope:e,replayId:i,event:n}){const r="object"!==typeof t._integrations||null===t._integrations||Array.isArray(t._integrations)?void 0:Object.keys(t._integrations),a=await iM(t.getOptions(),n,{event_id:i,integrations:r},e);if(!a)return null;a.platform=a.platform||"javascript";const o=t.getSdkMetadata&&t.getSdkMetadata(),{name:s,version:l}=o&&o.sdk||{};return a.sdk={...a.sdk,name:s||"sentry.javascript.unknown",version:l||"0.0.0"},a}({scope:d,client:p,replayId:e,event:g});if(!_)return p.recordDroppedEvent("event_processor","replay",g),void Ck("An event processor returned `null`, will not send event.");delete _.sdkProcessingMetadata;const y=function(t,e,i,n){return $T(XT(t,YT(t),n,i),[[{type:"replay_event"},t],[{type:"replay_recording",length:"string"===typeof e?(new TextEncoder).encode(e).length:e.length},e]])}(_,o,m,p.getOptions().tunnel);let v;try{v=await f.send(y)}catch(kx){const e=new Error(EI);try{e.cause=kx}catch(x){}throw e}if(!v)return v;if("number"===typeof v.statusCode&&(v.statusCode<200||v.statusCode>=300))throw new UR(v.statusCode);return v}class UR extends Error{constructor(t){super(`Transport returned status code ${t}`)}}async function $R(t,e={count:0,interval:5e3}){const{recordingData:i,options:n}=t;if(i.length)try{return await NR(t),!0}catch(kx){if(kx instanceof UR)throw kx;if(function(t,e){XE().setContext(t,e)}("Replays",{_retryCount:e.count}),("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&n._experiments&&n._experiments.captureExceptions&&_M(kx),e.count>=3){const t=new Error("Unable to send Replay - max retries exceeded");try{t.cause=kx}catch(r){}throw t}return e.interval*=++e.count,new Promise(((n,r)=>{setTimeout((async()=>{try{await $R(t,e),n(!0)}catch(i){r(i)}}),e.interval)}))}}const VR="__THROTTLED";function jR(t,e,i){const n=new Map;let r=!1;return(...a)=>{const o=Math.floor(Date.now()/1e3);if((t=>{const e=t-i;n.forEach(((t,i)=>{i<e&&n.delete(i)}))})(o),[...n.values()].reduce(((t,e)=>t+e),0)>=e){const t=r;return r=!0,t?"__SKIPPED":VR}r=!1;const s=n.get(o)||0;return n.set(o,s+1),t(...a)}}class qR{constructor({options:t,recordingOptions:e}){qR.prototype.__init.call(this),qR.prototype.__init2.call(this),qR.prototype.__init3.call(this),qR.prototype.__init4.call(this),qR.prototype.__init5.call(this),qR.prototype.__init6.call(this),this.eventBuffer=null,this.performanceEvents=[],this.recordingMode="session",this.timeouts={sessionIdlePause:3e5,sessionIdleExpire:9e5,maxSessionLife:36e5},this._lastActivity=Date.now(),this._isEnabled=!1,this._isPaused=!1,this._hasInitializedCoreListeners=!1,this._context={errorIds:new Set,traceIds:new Set,urls:[],initialTimestamp:Date.now(),initialUrl:""},this._recordingOptions=e,this._options=t,this._debouncedFlush=function(t,e,i){let n,r,a;const o=i&&i.maxWait?Math.max(i.maxWait,e):0;function s(){return l(),n=t(),n}function l(){void 0!==r&&clearTimeout(r),void 0!==a&&clearTimeout(a),r=a=void 0}function c(){return r&&clearTimeout(r),r=setTimeout(s,e),o&&void 0===a&&(a=setTimeout(s,o)),n}return c.cancel=l,c.flush=function(){return void 0!==r||void 0!==a?s():n},c}((()=>this._flush()),this._options.flushMinDelay,{maxWait:this._options.flushMaxDelay}),this._throttledAddEvent=jR(((t,e)=>Hk(this,t,e)),300,5);const{slowClickTimeout:i,slowClickIgnoreSelectors:n}=this.getOptions(),r=i?{threshold:Math.min(3e3,i),timeout:i,scrollTimeout:300,ignoreSelector:n?n.join(","):""}:void 0;r&&(this.clickDetector=new fk(this,r))}getContext(){return this._context}isEnabled(){return this._isEnabled}isPaused(){return this._isPaused}getOptions(){return this._options}initializeSampling(){const{errorSampleRate:t,sessionSampleRate:e}=this._options;t<=0&&e<=0||(this._initializeSessionForSampling(),this.session?!1!==this.session.sampled&&(this.recordingMode="buffer"===this.session.sampled&&0===this.session.segmentId?"buffer":"session",Ik(`[Replay] Starting replay in ${this.recordingMode} mode`,this._options._experiments.traceInternals),this._initializeRecording()):this._handleException(new Error("Unable to initialize and create session")))}start(){if(this._isEnabled&&"session"===this.recordingMode)throw new Error("Replay recording is already in progress");if(this._isEnabled&&"buffer"===this.recordingMode)throw new Error("Replay buffering is in progress, call `flush()` to save the replay");Ik("[Replay] Starting replay in session mode",this._options._experiments.traceInternals);const t=Gk(this.session,{timeouts:this.timeouts,traceInternals:this._options._experiments.traceInternals},{stickySession:this._options.stickySession,sessionSampleRate:1,allowBuffering:!1});this.session=t,this._initializeRecording()}startBuffering(){if(this._isEnabled)throw new Error("Replay recording is already in progress");Ik("[Replay] Starting replay in buffer mode",this._options._experiments.traceInternals);const t=Gk(this.session,{timeouts:this.timeouts,traceInternals:this._options._experiments.traceInternals},{stickySession:this._options.stickySession,sessionSampleRate:0,allowBuffering:!0});this.session=t,this.recordingMode="buffer",this._initializeRecording()}startRecording(){try{this._stopRecording=sk({...this._recordingOptions,..."buffer"===this.recordingMode&&{checkoutEveryNms:6e4},emit:FR(this),onMutation:this._onMutationHandler})}catch(kx){this._handleException(kx)}}stopRecording(){try{return this._stopRecording&&(this._stopRecording(),this._stopRecording=void 0),!0}catch(kx){return this._handleException(kx),!1}}async stop({forceFlush:t=!1,reason:e}={}){if(this._isEnabled)try{Ck("[Replay] Stopping Replay"+(e?` triggered by ${e}`:""),this._options._experiments.traceInternals),this._isEnabled=!1,this._removeListeners(),this.stopRecording(),this._debouncedFlush.cancel(),t&&await this._flush({force:!0}),this.eventBuffer&&this.eventBuffer.destroy(),this.eventBuffer=null,Ok(this)}catch(kx){this._handleException(kx)}}pause(){this._isPaused||(this._isPaused=!0,this.stopRecording(),Ck("[Replay] Pausing replay",this._options._experiments.traceInternals))}resume(){this._isPaused&&this._checkSession()&&(this._isPaused=!1,this.startRecording(),Ck("[Replay] Resuming replay",this._options._experiments.traceInternals))}async sendBufferedReplayOrFlush({continueRecording:t=!0}={}){if("session"===this.recordingMode)return this.flushImmediate();const e=Date.now();Ck("[Replay] Converting buffer to session",this._options._experiments.traceInternals),await this.flushImmediate();const i=this.stopRecording();t&&i&&"session"!==this.recordingMode&&(this.recordingMode="session",this.session&&(this.session.shouldRefresh=!1,this._updateUserActivity(e),this._updateSessionActivity(e),this._maybeSaveSession()),this.startRecording())}addUpdate(t){const e=t();"buffer"!==this.recordingMode&&!0!==e&&this._debouncedFlush()}triggerUserActivity(){if(this._updateUserActivity(),this._stopRecording)this.checkAndHandleExpiredSession(),this._updateSessionActivity();else{if(!this._checkSession())return;this.resume()}}updateUserActivity(){this._updateUserActivity(),this._updateSessionActivity()}conditionalFlush(){return"buffer"===this.recordingMode?Promise.resolve():this.flushImmediate()}flush(){return this._debouncedFlush()}flushImmediate(){return this._debouncedFlush(),this._debouncedFlush.flush()}cancelFlush(){this._debouncedFlush.cancel()}getSessionId(){return this.session&&this.session.id}checkAndHandleExpiredSession(){const t=this.getSessionId();if(this._lastActivity&&Vk(this._lastActivity,this.timeouts.sessionIdlePause)&&this.session&&"session"===this.session.sampled)return void this.pause();if(!this._checkSession())return;return t===this.getSessionId()||(this._triggerFullSnapshot(),!1)}setInitialState(){const t=`${wI.location.pathname}${wI.location.hash}${wI.location.search}`,e=`${wI.location.origin}${t}`;this.performanceEvents=[],this._clearContext(),this._context.initialUrl=e,this._context.initialTimestamp=Date.now(),this._context.urls.push(e)}throttledAddEvent(t,e){const i=this._throttledAddEvent(t,e);if(i===VR){const t=_k({category:"replay.throttled"});this.addUpdate((()=>{Hk(this,{type:nA.Custom,timestamp:t.timestamp||0,data:{tag:"breadcrumb",payload:t,metric:!0}})}))}return i}getCurrentRoute(){const t=this.lastTransaction||XE().getScope().getTransaction();if(t&&["route","custom"].includes(t.metadata.source))return t.name}_initializeRecording(){this.setInitialState(),this._updateSessionActivity(),this.eventBuffer=Lk({useCompression:this._options.useCompression}),this._removeListeners(),this._addListeners(),this._isEnabled=!0,this.startRecording()}_handleException(t){("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.error("[Replay]",t),("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&this._options._experiments&&this._options._experiments.captureExceptions&&_M(t)}_initializeSessionForSampling(){const t=this._options.errorSampleRate>0,e=Gk(this.session,{timeouts:this.timeouts,traceInternals:this._options._experiments.traceInternals},{stickySession:this._options.stickySession,sessionSampleRate:this._options.sessionSampleRate,allowBuffering:t});this.session=e}_checkSession(){if(!this.session)return!1;const t=this.session,e=qk(t,{timeouts:this.timeouts,traceInternals:this._options._experiments.traceInternals},{stickySession:Boolean(this._options.stickySession),sessionSampleRate:this._options.sessionSampleRate,allowBuffering:this._options.errorSampleRate>0});return e.id!==t.id&&(this.setInitialState(),this.session=e),!!this.session.sampled||(this.stop({reason:"session not refreshed"}),!1)}_addListeners(){try{wI.document.addEventListener("visibilitychange",this._handleVisibilityChange),wI.addEventListener("blur",this._handleWindowBlur),wI.addEventListener("focus",this._handleWindowFocus),wI.addEventListener("keydown",this._handleKeyboardEvent),this.clickDetector&&this.clickDetector.addListeners(),this._hasInitializedCoreListeners||(!function(t){const e=XE().getScope(),i=XE().getClient();e&&e.addScopeListener(zR(t)),ST("dom",bk(t)),ST("history",Jk(t)),kR(t),qE(Xk(t,!PR(i))),PR(i)&&(i.on("afterSendEvent",Yk(t)),i.on("createDsc",(e=>{const i=t.getSessionId();i&&t.isEnabled()&&"session"===t.recordingMode&&(e.replay_id=i)})),i.on("startTransaction",(e=>{t.lastTransaction=e})),i.on("finishTransaction",(e=>{t.lastTransaction=e})))}(this),this._hasInitializedCoreListeners=!0)}catch(kx){this._handleException(kx)}"PerformanceObserver"in wI&&(this._performanceObserver=Mk(this))}_removeListeners(){try{wI.document.removeEventListener("visibilitychange",this._handleVisibilityChange),wI.removeEventListener("blur",this._handleWindowBlur),wI.removeEventListener("focus",this._handleWindowFocus),wI.removeEventListener("keydown",this._handleKeyboardEvent),this.clickDetector&&this.clickDetector.removeListeners(),this._performanceObserver&&(this._performanceObserver.disconnect(),this._performanceObserver=void 0)}catch(kx){this._handleException(kx)}}__init(){this._handleVisibilityChange=()=>{"visible"===wI.document.visibilityState?this._doChangeToForegroundTasks():this._doChangeToBackgroundTasks()}}__init2(){this._handleWindowBlur=()=>{const t=_k({category:"ui.blur"});this._doChangeToBackgroundTasks(t)}}__init3(){this._handleWindowFocus=()=>{const t=_k({category:"ui.focus"});this._doChangeToForegroundTasks(t)}}__init4(){this._handleKeyboardEvent=t=>{Sk(this,t)}}_doChangeToBackgroundTasks(t){if(!this.session)return;const e=jk(this.session,this.timeouts);t&&!e&&this._createCustomBreadcrumb(t),this.conditionalFlush()}_doChangeToForegroundTasks(t){if(!this.session)return;this.checkAndHandleExpiredSession()?t&&this._createCustomBreadcrumb(t):Ck("[Replay] Document has become active, but session has expired")}_triggerFullSnapshot(t=!0){try{Ck("[Replay] Taking full rrweb snapshot"),sk.takeFullSnapshot(t)}catch(kx){this._handleException(kx)}}_updateUserActivity(t=Date.now()){this._lastActivity=t}_updateSessionActivity(t=Date.now()){this.session&&(this.session.lastActivity=t,this._maybeSaveSession())}_createCustomBreadcrumb(t){this.addUpdate((()=>{this.throttledAddEvent({type:nA.Custom,timestamp:t.timestamp||0,data:{tag:"breadcrumb",payload:t}})}))}_addPerformanceEntries(){const t=[...this.performanceEvents];return this.performanceEvents=[],Promise.all(Kk(this,function(t){return t.map(BR).filter(Boolean)}(t)))}_clearContext(){this._context.errorIds.clear(),this._context.traceIds.clear(),this._context.urls=[]}_updateInitialTimestampFromEventBuffer(){const{session:t,eventBuffer:e}=this;if(!t||!e)return;if(t.segmentId)return;const i=e.getEarliestTimestamp();i&&i<this._context.initialTimestamp&&(this._context.initialTimestamp=i)}_popEventContext(){const t={initialTimestamp:this._context.initialTimestamp,initialUrl:this._context.initialUrl,errorIds:Array.from(this._context.errorIds),traceIds:Array.from(this._context.traceIds),urls:this._context.urls};return this._clearContext(),t}async _runFlush(){if(this.session&&this.eventBuffer){if(await this._addPerformanceEntries(),this.eventBuffer&&this.eventBuffer.hasEvents&&(await async function(t){try{return Promise.all(Kk(t,[DR(wI.performance.memory)]))}catch(e){return[]}}(this),this.eventBuffer))try{this._updateInitialTimestampFromEventBuffer();const t=await this.eventBuffer.finish(),e=Date.now();if(e-this._context.initialTimestamp>this.timeouts.maxSessionLife+3e4)throw new Error("Session is too long, not sending replay");const i=this.session.id,n=this._popEventContext(),r=this.session.segmentId++;this._maybeSaveSession(),await $R({replayId:i,recordingData:t,segmentId:r,eventContext:n,session:this.session,options:this.getOptions(),timestamp:e})}catch(kx){this._handleException(kx),this.stop({reason:"sendReplay"});const e=XE().getClient();e&&e.recordDroppedEvent("send_error","replay")}}else("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.error("[Replay] No session or eventBuffer found to flush.")}__init5(){this._flush=async({force:t=!1}={})=>{if(!this._isEnabled&&!t)return;if(!this.checkAndHandleExpiredSession())return void(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.error("[Replay] Attempting to finish replay event after session expired."));if(!this.session)return void(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.error("[Replay] No session found to flush."));const e=this.session.started,i=Date.now()-e;this._debouncedFlush.cancel();const n=i<this._options.minReplayDuration,r=i>this.timeouts.maxSessionLife+5e3;if(n||r)return Ck(`[Replay] Session duration (${Math.floor(i/1e3)}s) is too ${n?"short":"long"}, not sending replay.`,this._options._experiments.traceInternals),void(n&&this._debouncedFlush());const a=this.eventBuffer;if(a&&0===this.session.segmentId&&!a.hasCheckout&&Ck("[Replay] Flushing initial segment without checkout.",this._options._experiments.traceInternals),!this._flushLock)return this._flushLock=this._runFlush(),await this._flushLock,void(this._flushLock=void 0);try{await this._flushLock}catch(kx){("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.error(kx)}finally{this._debouncedFlush()}}}_maybeSaveSession(){this.session&&this._options.stickySession&&Nk(this.session)}__init6(){this._onMutationHandler=t=>{const e=t.length,i=this._options.mutationLimit,n=i&&e>i;if(e>this._options.mutationBreadcrumbLimit||n){const t=_k({category:"replay.mutations",data:{count:e,limit:n}});this._createCustomBreadcrumb(t)}return!n||(this.stop({reason:"mutationLimit",forceFlush:"session"===this.recordingMode}),!1)}}}function GR(t,e,i,n){const r=[...t,..."string"===typeof n?n.split(","):[],...e];return"undefined"!==typeof i&&("string"===typeof i&&r.push(`.${i}`),console.warn("[Replay] You are using a deprecated configuration item for privacy. Read the documentation on how to use the new privacy configuration.")),r.join(",")}function HR({mask:t,unmask:e,block:i,unblock:n,ignore:r,blockClass:a,blockSelector:o,maskTextClass:s,maskTextSelector:l,ignoreClass:c}){const u=GR(t,[".sentry-mask","[data-sentry-mask]"],s,l),h=GR(e,[".sentry-unmask","[data-sentry-unmask]"]),p={maskTextSelector:u,unmaskTextSelector:h,maskInputSelector:u,unmaskInputSelector:h,blockSelector:GR(i,[".sentry-block","[data-sentry-block]",'base[href="/"]'],a,o),unblockSelector:GR(n,[".sentry-unblock","[data-sentry-unblock]"]),ignoreSelector:GR(r,[".sentry-ignore","[data-sentry-ignore]",'input[type="file"]'],c)};return a instanceof RegExp&&(p.blockClass=a),s instanceof RegExp&&(p.maskTextClass=s),p}function WR(){return"undefined"!==typeof window&&(!(0,bI.KV)()||"undefined"!==typeof process&&"renderer"===process.type)}const ZR='img,image,svg,video,object,picture,embed,map,audio,link[rel="icon"],link[rel="apple-touch-icon"]',YR=["content-length","content-type","accept"];let XR=!1;class KR{static __initStatic(){this.id="Replay"}constructor({flushMinDelay:t=5e3,flushMaxDelay:e=5500,minReplayDuration:i=4999,stickySession:n=!0,useCompression:r=!0,_experiments:a={},sessionSampleRate:o,errorSampleRate:s,maskAllText:l=!0,maskAllInputs:c=!0,blockAllMedia:u=!0,mutationBreadcrumbLimit:h=750,mutationLimit:p=1e4,slowClickTimeout:d=7e3,slowClickIgnoreSelectors:f=[],networkDetailAllowUrls:m=[],networkDetailDenyUrls:g=[],networkCaptureBodies:_=!0,networkRequestHeaders:y=[],networkResponseHeaders:v=[],mask:x=[],unmask:b=[],block:w=[],unblock:S=[],ignore:E=[],maskFn:T,beforeAddRecordingEvent:M,blockClass:C,blockSelector:I,maskInputOptions:A,maskTextClass:k,maskTextSelector:R,ignoreClass:z}={}){if(this.name=KR.id,this._recordingOptions={maskAllInputs:c,maskAllText:l,maskInputOptions:{...A||{},password:!0},maskTextFn:T,maskInputFn:T,...HR({mask:x,unmask:b,block:w,unblock:S,ignore:E,blockClass:C,blockSelector:I,maskTextClass:k,maskTextSelector:R,ignoreClass:z}),slimDOMOptions:"all",inlineStylesheet:!0,inlineImages:!1,collectFonts:!0},this._initialOptions={flushMinDelay:t,flushMaxDelay:e,minReplayDuration:Math.min(i,15e3),stickySession:n,sessionSampleRate:o,errorSampleRate:s,useCompression:r,blockAllMedia:u,maskAllInputs:c,maskAllText:l,mutationBreadcrumbLimit:h,mutationLimit:p,slowClickTimeout:d,slowClickIgnoreSelectors:f,networkDetailAllowUrls:m,networkDetailDenyUrls:g,networkCaptureBodies:_,networkRequestHeaders:JR(y),networkResponseHeaders:JR(v),beforeAddRecordingEvent:M,_experiments:a},"number"===typeof o&&(console.warn(`[Replay] You are passing \`sessionSampleRate\` to the Replay integration.\nThis option is deprecated and will be removed soon.\nInstead, configure \`replaysSessionSampleRate\` directly in the SDK init options, e.g.:\nSentry.init({ replaysSessionSampleRate: ${o} })`),this._initialOptions.sessionSampleRate=o),"number"===typeof s&&(console.warn(`[Replay] You are passing \`errorSampleRate\` to the Replay integration.\nThis option is deprecated and will be removed soon.\nInstead, configure \`replaysOnErrorSampleRate\` directly in the SDK init options, e.g.:\nSentry.init({ replaysOnErrorSampleRate: ${s} })`),this._initialOptions.errorSampleRate=s),this._initialOptions.blockAllMedia&&(this._recordingOptions.blockSelector=this._recordingOptions.blockSelector?`${this._recordingOptions.blockSelector},${ZR}`:ZR),this._isInitialized&&WR())throw new Error("Multiple Sentry Session Replay instances are not supported");this._isInitialized=!0}get _isInitialized(){return XR}set _isInitialized(t){XR=t}setupOnce(){WR()&&(this._setup(),setTimeout((()=>this._initialize())))}start(){this._replay&&this._replay.start()}startBuffering(){this._replay&&this._replay.startBuffering()}stop(){return this._replay?this._replay.stop({forceFlush:"session"===this._replay.recordingMode}):Promise.resolve()}flush(t){return this._replay&&this._replay.isEnabled()?this._replay.sendBufferedReplayOrFlush(t):Promise.resolve()}getReplayId(){if(this._replay&&this._replay.isEnabled())return this._replay.getSessionId()}_initialize(){this._replay&&this._replay.initializeSampling()}_setup(){const t=function(t){const e=XE().getClient(),i=e&&e.getOptions(),n={sessionSampleRate:0,errorSampleRate:0,...bE(t)};if(!i)return console.warn("SDK client is not available."),n;null==t.sessionSampleRate&&null==t.errorSampleRate&&null==i.replaysSessionSampleRate&&null==i.replaysOnErrorSampleRate&&console.warn("Replay is disabled because neither `replaysSessionSampleRate` nor `replaysOnErrorSampleRate` are set.");"number"===typeof i.replaysSessionSampleRate&&(n.sessionSampleRate=i.replaysSessionSampleRate);"number"===typeof i.replaysOnErrorSampleRate&&(n.errorSampleRate=i.replaysOnErrorSampleRate);return n}(this._initialOptions);this._replay=new qR({options:t,recordingOptions:this._recordingOptions})}}function JR(t){return[...YR,...t.map((t=>t.toLowerCase()))]}KR.__initStatic(),function(t={}){void 0===t.defaultIntegrations&&(t.defaultIntegrations=xC),void 0===t.release&&("string"===typeof __SENTRY_RELEASE__&&(t.release=__SENTRY_RELEASE__),vM.SENTRY_RELEASE&&vM.SENTRY_RELEASE.id&&(t.release=vM.SENTRY_RELEASE.id)),void 0===t.autoSessionTracking&&(t.autoSessionTracking=!0),void 0===t.sendClientReports&&(t.sendClientReports=!0);const e={...t,stackParser:(i=t.stackParser||hC,Array.isArray(i)?pT(...i):i),integrations:iT(t),transport:t.transport||(gT()?yC:vC)};var i;!function(t,e){!0===e.debug&&("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__?PE.enable():console.warn("[Sentry] Cannot initialize SDK with `debug` option using a non-debug bundle."));const i=XE();i.getScope().update(e.initialScope);const n=new t(e);i.bindClient(n)}(EM,e),t.autoSessionTracking&&function(){if("undefined"===typeof vM.document)return void(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.warn("Session tracking in non-browser environment with @sentry/browser is not supported."));const t=XE();if(!t.captureSession)return;bC(t),ST("history",(({from:t,to:e})=>{void 0!==t&&t!==e&&bC(XE())}))}()}({dsn:"https://244373b5703e1e7b545b5e695bb8ced9@o4505717305704448.ingest.sentry.io/4505795230629888",release:"development-opportunities@2.0.2",integrations:[new class{constructor(t){this.name="BrowserTracing",this._hasSetTracePropagationTargets=!1,GC(),("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&(this._hasSetTracePropagationTargets=!(!t||!t.tracePropagationTargets&&!t.tracingOrigins)),this.options={...vI,...t},void 0!==this.options._experiments.enableLongTask&&(this.options.enableLongTask=this.options._experiments.enableLongTask),t&&!t.tracePropagationTargets&&t.tracingOrigins&&(this.options.tracePropagationTargets=t.tracingOrigins),this._collectWebVitals=uI(),this.options.enableLongTask&&KC("longtask",(t=>{for(const e of t){const t=FC();if(!t)return;const i=rI(DE.Z1+e.startTime),n=rI(e.duration);t.startChild({description:"Main UI thread blocked",op:"ui.long-task",origin:"auto.ui.browser.metrics",startTimestamp:i,endTimestamp:i+n})}})),this.options._experiments.enableInteractions&&KC("event",(t=>{for(const e of t){const t=FC();if(!t)return;if("click"===e.name){const i=rI(DE.Z1+e.startTime),n=rI(e.duration);t.startChild({description:lE(e.target),op:`ui.interaction.${e.name}`,origin:"auto.ui.browser.metrics",startTimestamp:i,endTimestamp:i+n})}}}),{durationThreshold:0})}setupOnce(t,e){this._getCurrentHub=e;const i=e().getClient(),n=i&&i.getOptions(),{routingInstrumentation:r,startTransactionOnLocationChange:a,startTransactionOnPageLoad:o,markBackgroundTransactions:s,traceFetch:l,traceXHR:c,shouldCreateSpanForRequest:u,enableHTTPTimings:h,_experiments:p}=this.options,d=n&&n.tracePropagationTargets,f=d||this.options.tracePropagationTargets;("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&this._hasSetTracePropagationTargets&&d&&PE.warn("[Tracing] The `tracePropagationTargets` option was set in the BrowserTracing integration and top level `Sentry.init`. The top level `Sentry.init` value is being used."),r((t=>{const i=this._createRouteTransaction(t);return this.options._experiments.onStartRouteTransaction&&this.options._experiments.onStartRouteTransaction(i,t,e),i}),o,a),s&&(HC&&HC.document?HC.document.addEventListener("visibilitychange",(()=>{const t=FC();if(HC.document.hidden&&t){const e="cancelled";("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log(`[Tracing] Transaction: ${e} -> since tab moved to the background, op: ${t.op}`),t.status||t.setStatus(e),t.setTag("visibilitychange","document.hidden"),t.finish()}})):("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.warn("[Tracing] Could not set up background tab detection due to lack of global document")),p.enableInteractions&&this._registerInteractionListener(),mI({traceFetch:l,traceXHR:c,tracePropagationTargets:f,shouldCreateSpanForRequest:u,enableHTTPTimings:h})}_createRouteTransaction(t){if(!this._getCurrentHub)return void(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.warn(`[Tracing] Did not create ${t.op} transaction because _getCurrentHub is invalid.`));const e=this._getCurrentHub(),{beforeNavigate:i,idleTimeout:n,finalTimeout:r,heartbeatInterval:a}=this.options,o="pageload"===t.op,s=o?xI("sentry-trace"):"",l=o?xI("baggage"):"",{traceparentData:c,dynamicSamplingContext:u,propagationContext:h}=IC(s,l),p={...t,...c,metadata:{...t.metadata,dynamicSamplingContext:c&&!u?{}:u},trimEnd:!0},d="function"===typeof i?i(p):p,f=void 0===d?{...p,sampled:!1}:d;f.metadata=f.name!==p.name?{...f.metadata,source:"custom"}:f.metadata,this._latestRouteName=f.name,this._latestRouteSource=f.metadata&&f.metadata.source,!1===f.sampled&&("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log(`[Tracing] Will not send ${f.op} transaction because of beforeNavigate.`),("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.log(`[Tracing] Starting ${f.op} transaction on scope`);const{location:m}=HC,g=qC(e,f,n,r,!0,{location:m},a),_=e.getScope();return o&&c?_.setPropagationContext(h):_.setPropagationContext({traceId:g.traceId,spanId:g.spanId,parentSpanId:g.parentSpanId,sampled:g.sampled}),g.registerBeforeFinishCallback((t=>{this._collectWebVitals(),hI(t)})),g}_registerInteractionListener(){let t;const e=()=>{const{idleTimeout:e,finalTimeout:i,heartbeatInterval:n}=this.options,r="ui.action.click",a=FC();if(a&&a.op&&["navigation","pageload"].includes(a.op))return void(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.warn(`[Tracing] Did not create ${r} transaction because a pageload or navigation transaction is in progress.`));if(t&&(t.setFinishReason("interactionInterrupted"),t.finish(),t=void 0),!this._getCurrentHub)return void(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.warn(`[Tracing] Did not create ${r} transaction because _getCurrentHub is invalid.`));if(!this._latestRouteName)return void(("undefined"===typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&PE.warn(`[Tracing] Did not create ${r} transaction because _latestRouteName is missing.`));const o=this._getCurrentHub(),{location:s}=HC,l={name:this._latestRouteName,op:r,trimEnd:!0,metadata:{source:this._latestRouteSource||"url"}};t=qC(o,l,e,i,!0,{location:s},n)};["click"].forEach((t=>{addEventListener(t,e,{once:!1,capture:!0})}))}},new KR],tracesSampleRate:1,tracePropagationTargets:["localhost",/^https:\/\/detroitmi\.gov/],replaysSessionSampleRate:.1,replaysOnErrorSampleRate:1}),window,new WS},254:function(t,e,i){t=i.nmd(t);var n="__lodash_hash_undefined__",r=9007199254740991,a="[object Arguments]",o="[object Array]",s="[object Boolean]",l="[object Date]",c="[object Error]",u="[object Function]",h="[object Map]",p="[object Number]",d="[object Object]",f="[object Promise]",m="[object RegExp]",g="[object Set]",_="[object String]",y="[object Symbol]",v="[object WeakMap]",x="[object ArrayBuffer]",b="[object DataView]",w=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,S=/^\w*$/,E=/^\./,T=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,M=/\\(\\)?/g,C=/^\[object .+?Constructor\]$/,I=/^(?:0|[1-9]\d*)$/,A={};A["[object Float32Array]"]=A["[object Float64Array]"]=A["[object Int8Array]"]=A["[object Int16Array]"]=A["[object Int32Array]"]=A["[object Uint8Array]"]=A["[object Uint8ClampedArray]"]=A["[object Uint16Array]"]=A["[object Uint32Array]"]=!0,A[a]=A[o]=A[x]=A[s]=A[b]=A[l]=A[c]=A[u]=A[h]=A[p]=A[d]=A[m]=A[g]=A[_]=A[v]=!1;var k="object"==typeof i.g&&i.g&&i.g.Object===Object&&i.g,R="object"==typeof self&&self&&self.Object===Object&&self,z=k||R||Function("return this")(),P=e&&!e.nodeType&&e,D=P&&t&&!t.nodeType&&t,L=D&&D.exports===P&&k.process,B=function(){try{return L&&L.binding("util")}catch(t){}}(),O=B&&B.isTypedArray;function F(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}function N(t,e){for(var i=-1,n=t?t.length:0,r=Array(n);++i<n;)r[i]=e(t[i],i,t);return r}function U(t,e){for(var i=-1,n=e.length,r=t.length;++i<n;)t[r+i]=e[i];return t}function $(t,e){for(var i=-1,n=t?t.length:0;++i<n;)if(e(t[i],i,t))return!0;return!1}function V(t){return function(e){return t(e)}}function j(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(i){}return e}function q(t){var e=-1,i=Array(t.size);return t.forEach((function(t,n){i[++e]=[n,t]})),i}function G(t){var e=-1,i=Array(t.size);return t.forEach((function(t){i[++e]=t})),i}var H,W,Z,Y=Array.prototype,X=Function.prototype,K=Object.prototype,J=z["__core-js_shared__"],Q=(H=/[^.]+$/.exec(J&&J.keys&&J.keys.IE_PROTO||""))?"Symbol(src)_1."+H:"",tt=X.toString,et=K.hasOwnProperty,it=K.toString,nt=RegExp("^"+tt.call(et).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),rt=z.Symbol,at=z.Uint8Array,ot=K.propertyIsEnumerable,st=Y.splice,lt=rt?rt.isConcatSpreadable:void 0,ct=(W=Object.keys,Z=Object,function(t){return W(Z(t))}),ut=Math.max,ht=Zt(z,"DataView"),pt=Zt(z,"Map"),dt=Zt(z,"Promise"),ft=Zt(z,"Set"),mt=Zt(z,"WeakMap"),gt=Zt(Object,"create"),_t=re(ht),yt=re(pt),vt=re(dt),xt=re(ft),bt=re(mt),wt=rt?rt.prototype:void 0,St=wt?wt.valueOf:void 0,Et=wt?wt.toString:void 0;function Tt(t){var e=-1,i=t?t.length:0;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function Mt(t){var e=-1,i=t?t.length:0;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function Ct(t){var e=-1,i=t?t.length:0;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function It(t){var e=-1,i=t?t.length:0;for(this.__data__=new Ct;++e<i;)this.add(t[e])}function At(t){this.__data__=new Mt(t)}function kt(t,e){var i=ce(t)||le(t)?function(t,e){for(var i=-1,n=Array(t);++i<t;)n[i]=e(i);return n}(t.length,String):[],n=i.length,r=!!n;for(var a in t)!e&&!et.call(t,a)||r&&("length"==a||Kt(a,n))||i.push(a);return i}function Rt(t,e){for(var i=t.length;i--;)if(se(t[i][0],e))return i;return-1}Tt.prototype.clear=function(){this.__data__=gt?gt(null):{}},Tt.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},Tt.prototype.get=function(t){var e=this.__data__;if(gt){var i=e[t];return i===n?void 0:i}return et.call(e,t)?e[t]:void 0},Tt.prototype.has=function(t){var e=this.__data__;return gt?void 0!==e[t]:et.call(e,t)},Tt.prototype.set=function(t,e){return this.__data__[t]=gt&&void 0===e?n:e,this},Mt.prototype.clear=function(){this.__data__=[]},Mt.prototype.delete=function(t){var e=this.__data__,i=Rt(e,t);return!(i<0)&&(i==e.length-1?e.pop():st.call(e,i,1),!0)},Mt.prototype.get=function(t){var e=this.__data__,i=Rt(e,t);return i<0?void 0:e[i][1]},Mt.prototype.has=function(t){return Rt(this.__data__,t)>-1},Mt.prototype.set=function(t,e){var i=this.__data__,n=Rt(i,t);return n<0?i.push([t,e]):i[n][1]=e,this},Ct.prototype.clear=function(){this.__data__={hash:new Tt,map:new(pt||Mt),string:new Tt}},Ct.prototype.delete=function(t){return Wt(this,t).delete(t)},Ct.prototype.get=function(t){return Wt(this,t).get(t)},Ct.prototype.has=function(t){return Wt(this,t).has(t)},Ct.prototype.set=function(t,e){return Wt(this,t).set(t,e),this},It.prototype.add=It.prototype.push=function(t){return this.__data__.set(t,n),this},It.prototype.has=function(t){return this.__data__.has(t)},At.prototype.clear=function(){this.__data__=new Mt},At.prototype.delete=function(t){return this.__data__.delete(t)},At.prototype.get=function(t){return this.__data__.get(t)},At.prototype.has=function(t){return this.__data__.has(t)},At.prototype.set=function(t,e){var i=this.__data__;if(i instanceof Mt){var n=i.__data__;if(!pt||n.length<199)return n.push([t,e]),this;i=this.__data__=new Ct(n)}return i.set(t,e),this};var zt,Pt,Dt=(zt=function(t,e){return t&&Bt(t,e,_e)},function(t,e){if(null==t)return t;if(!ue(t))return zt(t,e);for(var i=t.length,n=Pt?i:-1,r=Object(t);(Pt?n--:++n<i)&&!1!==e(r[n],n,r););return t});function Lt(t,e,i,n,r){var a=-1,o=t.length;for(i||(i=Xt),r||(r=[]);++a<o;){var s=t[a];e>0&&i(s)?e>1?Lt(s,e-1,i,n,r):U(r,s):n||(r[r.length]=s)}return r}var Bt=function(t){return function(e,i,n){for(var r=-1,a=Object(e),o=n(e),s=o.length;s--;){var l=o[t?s:++r];if(!1===i(a[l],l,a))break}return e}}();function Ot(t,e){for(var i=0,n=(e=Qt(e,t)?[e]:qt(e)).length;null!=t&&i<n;)t=t[ne(e[i++])];return i&&i==n?t:void 0}function Ft(t,e){return null!=t&&e in Object(t)}function Nt(t,e,i,n,r){return t===e||(null==t||null==e||!de(t)&&!fe(e)?t!==t&&e!==e:function(t,e,i,n,r,u){var f=ce(t),v=ce(e),w=o,S=o;f||(w=(w=Yt(t))==a?d:w);v||(S=(S=Yt(e))==a?d:S);var E=w==d&&!j(t),T=S==d&&!j(e),M=w==S;if(M&&!E)return u||(u=new At),f||ge(t)?Ht(t,e,i,n,r,u):function(t,e,i,n,r,a,o){switch(i){case b:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case x:return!(t.byteLength!=e.byteLength||!n(new at(t),new at(e)));case s:case l:case p:return se(+t,+e);case c:return t.name==e.name&&t.message==e.message;case m:case _:return t==e+"";case h:var u=q;case g:var d=2&a;if(u||(u=G),t.size!=e.size&&!d)return!1;var f=o.get(t);if(f)return f==e;a|=1,o.set(t,e);var v=Ht(u(t),u(e),n,r,a,o);return o.delete(t),v;case y:if(St)return St.call(t)==St.call(e)}return!1}(t,e,w,i,n,r,u);if(!(2&r)){var C=E&&et.call(t,"__wrapped__"),I=T&&et.call(e,"__wrapped__");if(C||I){var A=C?t.value():t,k=I?e.value():e;return u||(u=new At),i(A,k,n,r,u)}}if(!M)return!1;return u||(u=new At),function(t,e,i,n,r,a){var o=2&r,s=_e(t),l=s.length,c=_e(e).length;if(l!=c&&!o)return!1;var u=l;for(;u--;){var h=s[u];if(!(o?h in e:et.call(e,h)))return!1}var p=a.get(t);if(p&&a.get(e))return p==e;var d=!0;a.set(t,e),a.set(e,t);var f=o;for(;++u<l;){var m=t[h=s[u]],g=e[h];if(n)var _=o?n(g,m,h,e,t,a):n(m,g,h,t,e,a);if(!(void 0===_?m===g||i(m,g,n,r,a):_)){d=!1;break}f||(f="constructor"==h)}if(d&&!f){var y=t.constructor,v=e.constructor;y==v||!("constructor"in t)||!("constructor"in e)||"function"==typeof y&&y instanceof y&&"function"==typeof v&&v instanceof v||(d=!1)}return a.delete(t),a.delete(e),d}(t,e,i,n,r,u)}(t,e,Nt,i,n,r))}function Ut(t){return!(!de(t)||function(t){return!!Q&&Q in t}(t))&&(he(t)||j(t)?nt:C).test(re(t))}function $t(t){return"function"==typeof t?t:null==t?ye:"object"==typeof t?ce(t)?function(t,e){if(Qt(t)&&te(e))return ee(ne(t),e);return function(i){var n=function(t,e,i){var n=null==t?void 0:Ot(t,e);return void 0===n?i:n}(i,t);return void 0===n&&n===e?function(t,e){return null!=t&&function(t,e,i){e=Qt(e,t)?[e]:qt(e);var n,r=-1,a=e.length;for(;++r<a;){var o=ne(e[r]);if(!(n=null!=t&&i(t,o)))break;t=t[o]}if(n)return n;return!!(a=t?t.length:0)&&pe(a)&&Kt(o,a)&&(ce(t)||le(t))}(t,e,Ft)}(i,t):Nt(e,n,void 0,3)}}(t[0],t[1]):function(t){var e=function(t){var e=_e(t),i=e.length;for(;i--;){var n=e[i],r=t[n];e[i]=[n,r,te(r)]}return e}(t);if(1==e.length&&e[0][2])return ee(e[0][0],e[0][1]);return function(i){return i===t||function(t,e,i,n){var r=i.length,a=r,o=!n;if(null==t)return!a;for(t=Object(t);r--;){var s=i[r];if(o&&s[2]?s[1]!==t[s[0]]:!(s[0]in t))return!1}for(;++r<a;){var l=(s=i[r])[0],c=t[l],u=s[1];if(o&&s[2]){if(void 0===c&&!(l in t))return!1}else{var h=new At;if(n)var p=n(c,u,l,t,e,h);if(!(void 0===p?Nt(u,c,n,3,h):p))return!1}}return!0}(i,t,e)}}(t):Qt(e=t)?(i=ne(e),function(t){return null==t?void 0:t[i]}):function(t){return function(e){return Ot(e,t)}}(e);var e,i}function Vt(t){if(i=(e=t)&&e.constructor,n="function"==typeof i&&i.prototype||K,e!==n)return ct(t);var e,i,n,r=[];for(var a in Object(t))et.call(t,a)&&"constructor"!=a&&r.push(a);return r}function jt(t,e,i){var n=-1;e=N(e.length?e:[ye],V($t));var r=function(t,e){var i=-1,n=ue(t)?Array(t.length):[];return Dt(t,(function(t,r,a){n[++i]=e(t,r,a)})),n}(t,(function(t,i,r){return{criteria:N(e,(function(e){return e(t)})),index:++n,value:t}}));return function(t,e){var i=t.length;for(t.sort(e);i--;)t[i]=t[i].value;return t}(r,(function(t,e){return function(t,e,i){var n=-1,r=t.criteria,a=e.criteria,o=r.length,s=i.length;for(;++n<o;){var l=Gt(r[n],a[n]);if(l)return n>=s?l:l*("desc"==i[n]?-1:1)}return t.index-e.index}(t,e,i)}))}function qt(t){return ce(t)?t:ie(t)}function Gt(t,e){if(t!==e){var i=void 0!==t,n=null===t,r=t===t,a=me(t),o=void 0!==e,s=null===e,l=e===e,c=me(e);if(!s&&!c&&!a&&t>e||a&&o&&l&&!s&&!c||n&&o&&l||!i&&l||!r)return 1;if(!n&&!a&&!c&&t<e||c&&i&&r&&!n&&!a||s&&i&&r||!o&&r||!l)return-1}return 0}function Ht(t,e,i,n,r,a){var o=2&r,s=t.length,l=e.length;if(s!=l&&!(o&&l>s))return!1;var c=a.get(t);if(c&&a.get(e))return c==e;var u=-1,h=!0,p=1&r?new It:void 0;for(a.set(t,e),a.set(e,t);++u<s;){var d=t[u],f=e[u];if(n)var m=o?n(f,d,u,e,t,a):n(d,f,u,t,e,a);if(void 0!==m){if(m)continue;h=!1;break}if(p){if(!$(e,(function(t,e){if(!p.has(e)&&(d===t||i(d,t,n,r,a)))return p.add(e)}))){h=!1;break}}else if(d!==f&&!i(d,f,n,r,a)){h=!1;break}}return a.delete(t),a.delete(e),h}function Wt(t,e){var i,n,r=t.__data__;return("string"==(n=typeof(i=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==i:null===i)?r["string"==typeof e?"string":"hash"]:r.map}function Zt(t,e){var i=function(t,e){return null==t?void 0:t[e]}(t,e);return Ut(i)?i:void 0}var Yt=function(t){return it.call(t)};function Xt(t){return ce(t)||le(t)||!!(lt&&t&&t[lt])}function Kt(t,e){return!!(e=null==e?r:e)&&("number"==typeof t||I.test(t))&&t>-1&&t%1==0&&t<e}function Jt(t,e,i){if(!de(i))return!1;var n=typeof e;return!!("number"==n?ue(i)&&Kt(e,i.length):"string"==n&&e in i)&&se(i[e],t)}function Qt(t,e){if(ce(t))return!1;var i=typeof t;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=t&&!me(t))||(S.test(t)||!w.test(t)||null!=e&&t in Object(e))}function te(t){return t===t&&!de(t)}function ee(t,e){return function(i){return null!=i&&(i[t]===e&&(void 0!==e||t in Object(i)))}}(ht&&Yt(new ht(new ArrayBuffer(1)))!=b||pt&&Yt(new pt)!=h||dt&&Yt(dt.resolve())!=f||ft&&Yt(new ft)!=g||mt&&Yt(new mt)!=v)&&(Yt=function(t){var e=it.call(t),i=e==d?t.constructor:void 0,n=i?re(i):void 0;if(n)switch(n){case _t:return b;case yt:return h;case vt:return f;case xt:return g;case bt:return v}return e});var ie=oe((function(t){var e;t=null==(e=t)?"":function(t){if("string"==typeof t)return t;if(me(t))return Et?Et.call(t):"";var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}(e);var i=[];return E.test(t)&&i.push(""),t.replace(T,(function(t,e,n,r){i.push(n?r.replace(M,"$1"):e||t)})),i}));function ne(t){if("string"==typeof t||me(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function re(t){if(null!=t){try{return tt.call(t)}catch(e){}try{return t+""}catch(e){}}return""}var ae=function(t,e){return e=ut(void 0===e?t.length-1:e,0),function(){for(var i=arguments,n=-1,r=ut(i.length-e,0),a=Array(r);++n<r;)a[n]=i[e+n];n=-1;for(var o=Array(e+1);++n<e;)o[n]=i[n];return o[e]=a,F(t,this,o)}}((function(t,e){if(null==t)return[];var i=e.length;return i>1&&Jt(t,e[0],e[1])?e=[]:i>2&&Jt(e[0],e[1],e[2])&&(e=[e[0]]),jt(t,Lt(e,1),[])}));function oe(t,e){if("function"!=typeof t||e&&"function"!=typeof e)throw new TypeError("Expected a function");var i=function(){var n=arguments,r=e?e.apply(this,n):n[0],a=i.cache;if(a.has(r))return a.get(r);var o=t.apply(this,n);return i.cache=a.set(r,o),o};return i.cache=new(oe.Cache||Ct),i}function se(t,e){return t===e||t!==t&&e!==e}function le(t){return function(t){return fe(t)&&ue(t)}(t)&&et.call(t,"callee")&&(!ot.call(t,"callee")||it.call(t)==a)}oe.Cache=Ct;var ce=Array.isArray;function ue(t){return null!=t&&pe(t.length)&&!he(t)}function he(t){var e=de(t)?it.call(t):"";return e==u||"[object GeneratorFunction]"==e}function pe(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=r}function de(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function fe(t){return!!t&&"object"==typeof t}function me(t){return"symbol"==typeof t||fe(t)&&it.call(t)==y}var ge=O?V(O):function(t){return fe(t)&&pe(t.length)&&!!A[it.call(t)]};function _e(t){return ue(t)?kt(t):Vt(t)}function ye(t){return t}t.exports=ae},618:function(t,e,i){t=i.nmd(t);var n="__lodash_hash_undefined__",r=1/0,a=9007199254740991,o="[object Arguments]",s="[object Array]",l="[object Boolean]",c="[object Date]",u="[object Error]",h="[object Function]",p="[object Map]",d="[object Number]",f="[object Object]",m="[object Promise]",g="[object RegExp]",_="[object Set]",y="[object String]",v="[object Symbol]",x="[object WeakMap]",b="[object ArrayBuffer]",w="[object DataView]",S=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,E=/^\w*$/,T=/^\./,M=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,C=/\\(\\)?/g,I=/^\[object .+?Constructor\]$/,A=/^(?:0|[1-9]\d*)$/,k={};k["[object Float32Array]"]=k["[object Float64Array]"]=k["[object Int8Array]"]=k["[object Int16Array]"]=k["[object Int32Array]"]=k["[object Uint8Array]"]=k["[object Uint8ClampedArray]"]=k["[object Uint16Array]"]=k["[object Uint32Array]"]=!0,k[o]=k[s]=k[b]=k[l]=k[w]=k[c]=k[u]=k[h]=k[p]=k[d]=k[f]=k[g]=k[_]=k[y]=k[x]=!1;var R="object"==typeof i.g&&i.g&&i.g.Object===Object&&i.g,z="object"==typeof self&&self&&self.Object===Object&&self,P=R||z||Function("return this")(),D=e&&!e.nodeType&&e,L=D&&t&&!t.nodeType&&t,B=L&&L.exports===D&&R.process,O=function(){try{return B&&B.binding("util")}catch(t){}}(),F=O&&O.isTypedArray;function N(t,e){return!!(t?t.length:0)&&function(t,e,i){if(e!==e)return function(t,e,i,n){var r=t.length,a=i+(n?1:-1);for(;n?a--:++a<r;)if(e(t[a],a,t))return a;return-1}(t,V,i);var n=i-1,r=t.length;for(;++n<r;)if(t[n]===e)return n;return-1}(t,e,0)>-1}function U(t,e,i){for(var n=-1,r=t?t.length:0;++n<r;)if(i(e,t[n]))return!0;return!1}function $(t,e){for(var i=-1,n=t?t.length:0;++i<n;)if(e(t[i],i,t))return!0;return!1}function V(t){return t!==t}function j(t,e){return t.has(e)}function q(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(i){}return e}function G(t){var e=-1,i=Array(t.size);return t.forEach((function(t,n){i[++e]=[n,t]})),i}function H(t){var e=-1,i=Array(t.size);return t.forEach((function(t){i[++e]=t})),i}var W,Z,Y,X=Array.prototype,K=Function.prototype,J=Object.prototype,Q=P["__core-js_shared__"],tt=(W=/[^.]+$/.exec(Q&&Q.keys&&Q.keys.IE_PROTO||""))?"Symbol(src)_1."+W:"",et=K.toString,it=J.hasOwnProperty,nt=J.toString,rt=RegExp("^"+et.call(it).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),at=P.Symbol,ot=P.Uint8Array,st=J.propertyIsEnumerable,lt=X.splice,ct=(Z=Object.keys,Y=Object,function(t){return Z(Y(t))}),ut=$t(P,"DataView"),ht=$t(P,"Map"),pt=$t(P,"Promise"),dt=$t(P,"Set"),ft=$t(P,"WeakMap"),mt=$t(Object,"create"),gt=Yt(ut),_t=Yt(ht),yt=Yt(pt),vt=Yt(dt),xt=Yt(ft),bt=at?at.prototype:void 0,wt=bt?bt.valueOf:void 0,St=bt?bt.toString:void 0;function Et(t){var e=-1,i=t?t.length:0;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function Tt(t){var e=-1,i=t?t.length:0;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function Mt(t){var e=-1,i=t?t.length:0;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function Ct(t){var e=-1,i=t?t.length:0;for(this.__data__=new Mt;++e<i;)this.add(t[e])}function It(t){this.__data__=new Tt(t)}function At(t,e){var i=Qt(t)||Jt(t)?function(t,e){for(var i=-1,n=Array(t);++i<t;)n[i]=e(i);return n}(t.length,String):[],n=i.length,r=!!n;for(var a in t)!e&&!it.call(t,a)||r&&("length"==a||jt(a,n))||i.push(a);return i}function kt(t,e){for(var i=t.length;i--;)if(Kt(t[i][0],e))return i;return-1}function Rt(t,e){for(var i=0,n=(e=qt(e,t)?[e]:Ot(e)).length;null!=t&&i<n;)t=t[Zt(e[i++])];return i&&i==n?t:void 0}function zt(t,e){return null!=t&&e in Object(t)}function Pt(t,e,i,n,r){return t===e||(null==t||null==e||!ne(t)&&!re(e)?t!==t&&e!==e:function(t,e,i,n,r,a){var h=Qt(t),m=Qt(e),x=s,S=s;h||(x=(x=Vt(t))==o?f:x);m||(S=(S=Vt(e))==o?f:S);var E=x==f&&!q(t),T=S==f&&!q(e),M=x==S;if(M&&!E)return a||(a=new It),h||oe(t)?Nt(t,e,i,n,r,a):function(t,e,i,n,r,a,o){switch(i){case w:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case b:return!(t.byteLength!=e.byteLength||!n(new ot(t),new ot(e)));case l:case c:case d:return Kt(+t,+e);case u:return t.name==e.name&&t.message==e.message;case g:case y:return t==e+"";case p:var s=G;case _:var h=2&a;if(s||(s=H),t.size!=e.size&&!h)return!1;var f=o.get(t);if(f)return f==e;a|=1,o.set(t,e);var m=Nt(s(t),s(e),n,r,a,o);return o.delete(t),m;case v:if(wt)return wt.call(t)==wt.call(e)}return!1}(t,e,x,i,n,r,a);if(!(2&r)){var C=E&&it.call(t,"__wrapped__"),I=T&&it.call(e,"__wrapped__");if(C||I){var A=C?t.value():t,k=I?e.value():e;return a||(a=new It),i(A,k,n,r,a)}}if(!M)return!1;return a||(a=new It),function(t,e,i,n,r,a){var o=2&r,s=se(t),l=s.length,c=se(e).length;if(l!=c&&!o)return!1;var u=l;for(;u--;){var h=s[u];if(!(o?h in e:it.call(e,h)))return!1}var p=a.get(t);if(p&&a.get(e))return p==e;var d=!0;a.set(t,e),a.set(e,t);var f=o;for(;++u<l;){var m=t[h=s[u]],g=e[h];if(n)var _=o?n(g,m,h,e,t,a):n(m,g,h,t,e,a);if(!(void 0===_?m===g||i(m,g,n,r,a):_)){d=!1;break}f||(f="constructor"==h)}if(d&&!f){var y=t.constructor,v=e.constructor;y==v||!("constructor"in t)||!("constructor"in e)||"function"==typeof y&&y instanceof y&&"function"==typeof v&&v instanceof v||(d=!1)}return a.delete(t),a.delete(e),d}(t,e,i,n,r,a)}(t,e,Pt,i,n,r))}function Dt(t){return!(!ne(t)||function(t){return!!tt&&tt in t}(t))&&(ee(t)||q(t)?rt:I).test(Yt(t))}function Lt(t){return"function"==typeof t?t:null==t?le:"object"==typeof t?Qt(t)?function(t,e){if(qt(t)&&Gt(e))return Ht(Zt(t),e);return function(i){var n=function(t,e,i){var n=null==t?void 0:Rt(t,e);return void 0===n?i:n}(i,t);return void 0===n&&n===e?function(t,e){return null!=t&&function(t,e,i){e=qt(e,t)?[e]:Ot(e);var n,r=-1,a=e.length;for(;++r<a;){var o=Zt(e[r]);if(!(n=null!=t&&i(t,o)))break;t=t[o]}if(n)return n;return!!(a=t?t.length:0)&&ie(a)&&jt(o,a)&&(Qt(t)||Jt(t))}(t,e,zt)}(i,t):Pt(e,n,void 0,3)}}(t[0],t[1]):function(t){var e=function(t){var e=se(t),i=e.length;for(;i--;){var n=e[i],r=t[n];e[i]=[n,r,Gt(r)]}return e}(t);if(1==e.length&&e[0][2])return Ht(e[0][0],e[0][1]);return function(i){return i===t||function(t,e,i,n){var r=i.length,a=r,o=!n;if(null==t)return!a;for(t=Object(t);r--;){var s=i[r];if(o&&s[2]?s[1]!==t[s[0]]:!(s[0]in t))return!1}for(;++r<a;){var l=(s=i[r])[0],c=t[l],u=s[1];if(o&&s[2]){if(void 0===c&&!(l in t))return!1}else{var h=new It;if(n)var p=n(c,u,l,t,e,h);if(!(void 0===p?Pt(u,c,n,3,h):p))return!1}}return!0}(i,t,e)}}(t):qt(e=t)?(i=Zt(e),function(t){return null==t?void 0:t[i]}):function(t){return function(e){return Rt(e,t)}}(e);var e,i}function Bt(t){if(i=(e=t)&&e.constructor,n="function"==typeof i&&i.prototype||J,e!==n)return ct(t);var e,i,n,r=[];for(var a in Object(t))it.call(t,a)&&"constructor"!=a&&r.push(a);return r}function Ot(t){return Qt(t)?t:Wt(t)}Et.prototype.clear=function(){this.__data__=mt?mt(null):{}},Et.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},Et.prototype.get=function(t){var e=this.__data__;if(mt){var i=e[t];return i===n?void 0:i}return it.call(e,t)?e[t]:void 0},Et.prototype.has=function(t){var e=this.__data__;return mt?void 0!==e[t]:it.call(e,t)},Et.prototype.set=function(t,e){return this.__data__[t]=mt&&void 0===e?n:e,this},Tt.prototype.clear=function(){this.__data__=[]},Tt.prototype.delete=function(t){var e=this.__data__,i=kt(e,t);return!(i<0)&&(i==e.length-1?e.pop():lt.call(e,i,1),!0)},Tt.prototype.get=function(t){var e=this.__data__,i=kt(e,t);return i<0?void 0:e[i][1]},Tt.prototype.has=function(t){return kt(this.__data__,t)>-1},Tt.prototype.set=function(t,e){var i=this.__data__,n=kt(i,t);return n<0?i.push([t,e]):i[n][1]=e,this},Mt.prototype.clear=function(){this.__data__={hash:new Et,map:new(ht||Tt),string:new Et}},Mt.prototype.delete=function(t){return Ut(this,t).delete(t)},Mt.prototype.get=function(t){return Ut(this,t).get(t)},Mt.prototype.has=function(t){return Ut(this,t).has(t)},Mt.prototype.set=function(t,e){return Ut(this,t).set(t,e),this},Ct.prototype.add=Ct.prototype.push=function(t){return this.__data__.set(t,n),this},Ct.prototype.has=function(t){return this.__data__.has(t)},It.prototype.clear=function(){this.__data__=new Tt},It.prototype.delete=function(t){return this.__data__.delete(t)},It.prototype.get=function(t){return this.__data__.get(t)},It.prototype.has=function(t){return this.__data__.has(t)},It.prototype.set=function(t,e){var i=this.__data__;if(i instanceof Tt){var n=i.__data__;if(!ht||n.length<199)return n.push([t,e]),this;i=this.__data__=new Mt(n)}return i.set(t,e),this};var Ft=dt&&1/H(new dt([,-0]))[1]==r?function(t){return new dt(t)}:function(){};function Nt(t,e,i,n,r,a){var o=2&r,s=t.length,l=e.length;if(s!=l&&!(o&&l>s))return!1;var c=a.get(t);if(c&&a.get(e))return c==e;var u=-1,h=!0,p=1&r?new Ct:void 0;for(a.set(t,e),a.set(e,t);++u<s;){var d=t[u],f=e[u];if(n)var m=o?n(f,d,u,e,t,a):n(d,f,u,t,e,a);if(void 0!==m){if(m)continue;h=!1;break}if(p){if(!$(e,(function(t,e){if(!p.has(e)&&(d===t||i(d,t,n,r,a)))return p.add(e)}))){h=!1;break}}else if(d!==f&&!i(d,f,n,r,a)){h=!1;break}}return a.delete(t),a.delete(e),h}function Ut(t,e){var i,n,r=t.__data__;return("string"==(n=typeof(i=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==i:null===i)?r["string"==typeof e?"string":"hash"]:r.map}function $t(t,e){var i=function(t,e){return null==t?void 0:t[e]}(t,e);return Dt(i)?i:void 0}var Vt=function(t){return nt.call(t)};function jt(t,e){return!!(e=null==e?a:e)&&("number"==typeof t||A.test(t))&&t>-1&&t%1==0&&t<e}function qt(t,e){if(Qt(t))return!1;var i=typeof t;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=t&&!ae(t))||(E.test(t)||!S.test(t)||null!=e&&t in Object(e))}function Gt(t){return t===t&&!ne(t)}function Ht(t,e){return function(i){return null!=i&&(i[t]===e&&(void 0!==e||t in Object(i)))}}(ut&&Vt(new ut(new ArrayBuffer(1)))!=w||ht&&Vt(new ht)!=p||pt&&Vt(pt.resolve())!=m||dt&&Vt(new dt)!=_||ft&&Vt(new ft)!=x)&&(Vt=function(t){var e=nt.call(t),i=e==f?t.constructor:void 0,n=i?Yt(i):void 0;if(n)switch(n){case gt:return w;case _t:return p;case yt:return m;case vt:return _;case xt:return x}return e});var Wt=Xt((function(t){var e;t=null==(e=t)?"":function(t){if("string"==typeof t)return t;if(ae(t))return St?St.call(t):"";var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}(e);var i=[];return T.test(t)&&i.push(""),t.replace(M,(function(t,e,n,r){i.push(n?r.replace(C,"$1"):e||t)})),i}));function Zt(t){if("string"==typeof t||ae(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function Yt(t){if(null!=t){try{return et.call(t)}catch(e){}try{return t+""}catch(e){}}return""}function Xt(t,e){if("function"!=typeof t||e&&"function"!=typeof e)throw new TypeError("Expected a function");var i=function(){var n=arguments,r=e?e.apply(this,n):n[0],a=i.cache;if(a.has(r))return a.get(r);var o=t.apply(this,n);return i.cache=a.set(r,o),o};return i.cache=new(Xt.Cache||Mt),i}function Kt(t,e){return t===e||t!==t&&e!==e}function Jt(t){return function(t){return re(t)&&te(t)}(t)&&it.call(t,"callee")&&(!st.call(t,"callee")||nt.call(t)==o)}Xt.Cache=Mt;var Qt=Array.isArray;function te(t){return null!=t&&ie(t.length)&&!ee(t)}function ee(t){var e=ne(t)?nt.call(t):"";return e==h||"[object GeneratorFunction]"==e}function ie(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=a}function ne(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function re(t){return!!t&&"object"==typeof t}function ae(t){return"symbol"==typeof t||re(t)&&nt.call(t)==v}var oe=F?function(t){return function(e){return t(e)}}(F):function(t){return re(t)&&ie(t.length)&&!!k[nt.call(t)]};function se(t){return te(t)?At(t):Bt(t)}function le(t){return t}t.exports=function(t,e){return t&&t.length?function(t,e,i){var n=-1,r=N,a=t.length,o=!0,s=[],l=s;if(i)o=!1,r=U;else if(a>=200){var c=e?null:Ft(t);if(c)return H(c);o=!1,r=j,l=new Ct}else l=e?[]:s;t:for(;++n<a;){var u=t[n],h=e?e(u):u;if(u=i||0!==u?u:0,o&&h===h){for(var p=l.length;p--;)if(l[p]===h)continue t;e&&l.push(h),s.push(u)}else r(l,h,i)||(l!==s&&l.push(h),s.push(u))}return s}(t,Lt(e)):[]}},409:function(t){t.exports=function(){"use strict";var t,e,i;function n(n,r){if(t)if(e){var a="var sharedChunk = {}; ("+t+")(sharedChunk); ("+e+")(sharedChunk);",o={};t(o),i=r(o),"undefined"!==typeof window&&(i.workerUrl=window.URL.createObjectURL(new Blob([a],{type:"text/javascript"})))}else e=r;else t=r}return n(["exports"],(function(t){function e(t,e){return t(e={exports:{}},e.exports),e.exports}var i=n;function n(t,e,i,n){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=i,this.p2y=n}n.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},n.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},n.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},n.prototype.solveCurveX=function(t,e){var i,n,r,a,o;for(void 0===e&&(e=1e-6),r=t,o=0;o<8;o++){if(a=this.sampleCurveX(r)-t,Math.abs(a)<e)return r;var s=this.sampleCurveDerivativeX(r);if(Math.abs(s)<1e-6)break;r-=a/s}if((r=t)<(i=0))return i;if(r>(n=1))return n;for(;i<n;){if(a=this.sampleCurveX(r),Math.abs(a-t)<e)return r;t>a?i=r:n=r,r=.5*(n-i)+i}return r},n.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var r=a;function a(t,e){this.x=t,this.y=e}a.prototype={clone:function(){return new a(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=n,this},_rotateAround:function(t,e){var i=Math.cos(t),n=Math.sin(t),r=e.y+n*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-n*(this.y-e.y),this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},a.convert=function(t){return t instanceof a?t:Array.isArray(t)?new a(t[0],t[1]):t};var o="undefined"!=typeof self?self:{},s=Math.pow(2,53)-1;function l(t,e,n,r){var a=new i(t,e,n,r);return function(t){return a.solve(t)}}var c=l(.25,.1,.25,1);function u(t,e,i){return Math.min(i,Math.max(e,t))}function h(t,e,i){var n=i-e,r=((t-e)%n+n)%n+e;return r===e?i:r}function p(t){for(var e=[],i=arguments.length-1;i-- >0;)e[i]=arguments[i+1];for(var n=0,r=e;n<r.length;n+=1){var a=r[n];for(var o in a)t[o]=a[o]}return t}var d=1;function f(){return d++}function m(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function g(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function _(t,e){t.forEach((function(t){e[t]&&(e[t]=e[t].bind(e))}))}function y(t,e){return-1!==t.indexOf(e,t.length-e.length)}function v(t,e,i){var n={};for(var r in t)n[r]=e.call(i||this,t[r],r,t);return n}function x(t,e,i){var n={};for(var r in t)e.call(i||this,t[r],r,t)&&(n[r]=t[r]);return n}function b(t){return Array.isArray(t)?t.map(b):"object"==typeof t&&t?v(t,b):t}var w={};function S(t){w[t]||("undefined"!=typeof console&&console.warn(t),w[t]=!0)}function E(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function T(t){for(var e=0,i=0,n=t.length,r=n-1,a=void 0,o=void 0;i<n;r=i++)e+=((o=t[r]).x-(a=t[i]).x)*(a.y+o.y);return e}function M(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function C(t){var e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(function(t,i,n,r){var a=n||r;return e[i]=!a||a.toLowerCase(),""})),e["max-age"]){var i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}var I=null;function A(t){if(null==I){var e=t.navigator?t.navigator.userAgent:null;I=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return I}function k(t){try{var e=o[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(t){return!1}}var R,z,P,D,L=o.performance&&o.performance.now?o.performance.now.bind(o.performance):Date.now.bind(Date),B=o.requestAnimationFrame||o.mozRequestAnimationFrame||o.webkitRequestAnimationFrame||o.msRequestAnimationFrame,O=o.cancelAnimationFrame||o.mozCancelAnimationFrame||o.webkitCancelAnimationFrame||o.msCancelAnimationFrame,F={now:L,frame:function(t){var e=B(t);return{cancel:function(){return O(e)}}},getImageData:function(t,e){void 0===e&&(e=0);var i=o.document.createElement("canvas"),n=i.getContext("2d");if(!n)throw new Error("failed to create canvas 2d context");return i.width=t.width,i.height=t.height,n.drawImage(t,0,0,t.width,t.height),n.getImageData(-e,-e,t.width+2*e,t.height+2*e)},resolveURL:function(t){return R||(R=o.document.createElement("a")),R.href=t,R.href},hardwareConcurrency:o.navigator&&o.navigator.hardwareConcurrency||4,get devicePixelRatio(){return o.devicePixelRatio},get prefersReducedMotion(){return!!o.matchMedia&&(null==z&&(z=o.matchMedia("(prefers-reduced-motion: reduce)")),z.matches)}},N={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},U={supported:!1,testSupport:function(t){!$&&D&&(V?j(t):P=t)}},$=!1,V=!1;function j(t){var e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,D),t.isContextLost())return;U.supported=!0}catch(t){}t.deleteTexture(e),$=!0}o.document&&((D=o.document.createElement("img")).onload=function(){P&&j(P),P=null,V=!0},D.onerror=function(){$=!0,P=null},D.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var q="01",G=function(t,e){this._transformRequestFn=t,this._customAccessToken=e,this._createSkuToken()};function H(t){return 0===t.indexOf("mapbox:")}G.prototype._createSkuToken=function(){var t=function(){for(var t="",e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",q,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},G.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},G.prototype.transformRequest=function(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}},G.prototype.normalizeStyleURL=function(t,e){if(!H(t))return t;var i=X(t);return i.path="/styles/v1"+i.path,this._makeAPIURL(i,this._customAccessToken||e)},G.prototype.normalizeGlyphsURL=function(t,e){if(!H(t))return t;var i=X(t);return i.path="/fonts/v1"+i.path,this._makeAPIURL(i,this._customAccessToken||e)},G.prototype.normalizeSourceURL=function(t,e){if(!H(t))return t;var i=X(t);return i.path="/v4/"+i.authority+".json",i.params.push("secure"),this._makeAPIURL(i,this._customAccessToken||e)},G.prototype.normalizeSpriteURL=function(t,e,i,n){var r=X(t);return H(t)?(r.path="/styles/v1"+r.path+"/sprite"+e+i,this._makeAPIURL(r,this._customAccessToken||n)):(r.path+=""+e+i,K(r))},G.prototype.normalizeTileURL=function(t,e){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!H(t))return t;var i=X(t);i.path=i.path.replace(/(\.(png|jpg)\d*)(?=$)/,(F.devicePixelRatio>=2||512===e?"@2x":"")+(U.supported?".webp":"$1")),i.path=i.path.replace(/^.+\/v4\//,"/"),i.path="/v4"+i.path;var n=this._customAccessToken||function(t){for(var e=0,i=t;e<i.length;e+=1){var n=i[e].match(/^access_token=(.*)$/);if(n)return n[1]}return null}(i.params)||N.ACCESS_TOKEN;return N.REQUIRE_ACCESS_TOKEN&&n&&this._skuToken&&i.params.push("sku="+this._skuToken),this._makeAPIURL(i,n)},G.prototype.canonicalizeTileURL=function(t,e){var i=X(t);if(!i.path.match(/(^\/v4\/)/)||!i.path.match(/\.[\w]+$/))return t;var n="mapbox://tiles/";n+=i.path.replace("/v4/","");var r=i.params;return e&&(r=r.filter((function(t){return!t.match(/^access_token=/)}))),r.length&&(n+="?"+r.join("&")),n},G.prototype.canonicalizeTileset=function(t,e){for(var i=!!e&&H(e),n=[],r=0,a=t.tiles||[];r<a.length;r+=1){var o=a[r];Z(o)?n.push(this.canonicalizeTileURL(o,i)):n.push(o)}return n},G.prototype._makeAPIURL=function(t,e){var i="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",n=X(N.API_URL);if(t.protocol=n.protocol,t.authority=n.authority,"http"===t.protocol){var r=t.params.indexOf("secure");r>=0&&t.params.splice(r,1)}if("/"!==n.path&&(t.path=""+n.path+t.path),!N.REQUIRE_ACCESS_TOKEN)return K(t);if(!(e=e||N.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+i);if("s"===e[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+i);return t.params=t.params.filter((function(t){return-1===t.indexOf("access_token")})),t.params.push("access_token="+e),K(t)};var W=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Z(t){return W.test(t)}var Y=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function X(t){var e=t.match(Y);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function K(t){var e=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+e}function J(t){if(!t)return null;var e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(o.atob(e[1]).split("").map((function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)})).join("")))}catch(t){return null}}var Q=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};Q.prototype.getStorageKey=function(t){var e,i=J(N.ACCESS_TOKEN);return e=i&&i.u?o.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(function(t,e){return String.fromCharCode(Number("0x"+e))}))):N.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+e:"mapbox.eventData:"+e},Q.prototype.fetchEventData=function(){var t=k("localStorage"),e=this.getStorageKey(),i=this.getStorageKey("uuid");if(t)try{var n=o.localStorage.getItem(e);n&&(this.eventData=JSON.parse(n));var r=o.localStorage.getItem(i);r&&(this.anonId=r)}catch(t){S("Unable to read from LocalStorage")}},Q.prototype.saveEventData=function(){var t=k("localStorage"),e=this.getStorageKey(),i=this.getStorageKey("uuid");if(t)try{o.localStorage.setItem(i,this.anonId),Object.keys(this.eventData).length>=1&&o.localStorage.setItem(e,JSON.stringify(this.eventData))}catch(t){S("Unable to write to LocalStorage")}},Q.prototype.processRequests=function(t){},Q.prototype.postEvent=function(t,e,i,n){var r=this;if(N.EVENTS_URL){var a=X(N.EVENTS_URL);a.params.push("access_token="+(n||N.ACCESS_TOKEN||""));var o={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.0-rc.4",skuId:q,userId:this.anonId},s=e?p(o,e):o,l={url:K(a),headers:{"Content-Type":"text/plain"},body:JSON.stringify([s])};this.pendingRequest=bt(l,(function(t){r.pendingRequest=null,i(t),r.saveEventData(),r.processRequests(n)}))}},Q.prototype.queueRequest=function(t,e){this.queue.push(t),this.processRequests(e)};var tt,et,it=function(t){function e(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.postMapLoadEvent=function(t,e,i,n){this.skuToken=i,(N.EVENTS_URL&&n||N.ACCESS_TOKEN&&Array.isArray(t)&&t.some((function(t){return H(t)||Z(t)})))&&this.queueRequest({id:e,timestamp:Date.now()},n)},e.prototype.processRequests=function(t){var e=this;if(!this.pendingRequest&&0!==this.queue.length){var i=this.queue.shift(),n=i.id,r=i.timestamp;n&&this.success[n]||(this.anonId||this.fetchEventData(),g(this.anonId)||(this.anonId=m()),this.postEvent(r,{skuToken:this.skuToken},(function(t){t||n&&(e.success[n]=!0)}),t))}},e}(Q),nt=new(function(t){function e(e){t.call(this,"appUserTurnstile"),this._customAccessToken=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.postTurnstileEvent=function(t,e){N.EVENTS_URL&&N.ACCESS_TOKEN&&Array.isArray(t)&&t.some((function(t){return H(t)||Z(t)}))&&this.queueRequest(Date.now(),e)},e.prototype.processRequests=function(t){var e=this;if(!this.pendingRequest&&0!==this.queue.length){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var i=J(N.ACCESS_TOKEN),n=i?i.u:N.ACCESS_TOKEN,r=n!==this.eventData.tokenU;g(this.anonId)||(this.anonId=m(),r=!0);var a=this.queue.shift();if(this.eventData.lastSuccess){var o=new Date(this.eventData.lastSuccess),s=new Date(a),l=(a-this.eventData.lastSuccess)/864e5;r=r||l>=1||l<-1||o.getDate()!==s.getDate()}else r=!0;if(!r)return this.processRequests();this.postEvent(a,{"enabled.telemetry":!1},(function(t){t||(e.eventData.lastSuccess=a,e.eventData.tokenU=n)}),t)}},e}(Q)),rt=nt.postTurnstileEvent.bind(nt),at=new it,ot=at.postMapLoadEvent.bind(at),st=500,lt=50;function ct(){o.caches&&!tt&&(tt=o.caches.open("mapbox-tiles"))}function ut(t){var e=t.indexOf("?");return e<0?t:t.slice(0,e)}var ht,pt=1/0;function dt(){return null==ht&&(ht=o.OffscreenCanvas&&new o.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof o.createImageBitmap),ht}var ft={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(ft);var mt,gt,_t=function(t){function e(e,i,n){401===i&&Z(n)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,e),this.status=i,this.url=n,this.name=this.constructor.name,this.message=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},e}(Error),yt=M()?function(){return self.worker&&self.worker.referrer}:function(){return("blob:"===o.location.protocol?o.parent:o).location.href},vt=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(yt())&&!/^\w+:/.test(i))){if(o.fetch&&o.Request&&o.AbortController&&o.Request.prototype.hasOwnProperty("signal"))return function(t,e){var i,n=new o.AbortController,r=new o.Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:yt(),signal:n.signal}),a=!1,s=!1,l=(i=r.url).indexOf("sku=")>0&&Z(i);"json"===t.type&&r.headers.set("Accept","application/json");var c=function(i,n,a){if(!s){if(i&&"SecurityError"!==i.message&&S(i),n&&a)return u(n);var c=Date.now();o.fetch(r).then((function(i){if(i.ok){var n=l?i.clone():null;return u(i,n,c)}return e(new _t(i.statusText,i.status,t.url))})).catch((function(t){20!==t.code&&e(new Error(t.message))}))}},u=function(i,n,l){("arrayBuffer"===t.type?i.arrayBuffer():"json"===t.type?i.json():i.text()).then((function(t){s||(n&&l&&function(t,e,i){if(ct(),tt){var n={status:e.status,statusText:e.statusText,headers:new o.Headers};e.headers.forEach((function(t,e){return n.headers.set(e,t)}));var r=C(e.headers.get("Cache-Control")||"");r["no-store"]||(r["max-age"]&&n.headers.set("Expires",new Date(i+1e3*r["max-age"]).toUTCString()),new Date(n.headers.get("Expires")).getTime()-i<42e4||function(t,e){if(void 0===et)try{new Response(new ReadableStream),et=!0}catch(t){et=!1}et?e(t.body):t.blob().then(e)}(e,(function(e){var i=new o.Response(e,n);ct(),tt&&tt.then((function(e){return e.put(ut(t.url),i)})).catch((function(t){return S(t.message)}))})))}}(r,n,l),a=!0,e(null,t,i.headers.get("Cache-Control"),i.headers.get("Expires")))})).catch((function(t){s||e(new Error(t.message))}))};return l?function(t,e){if(ct(),!tt)return e(null);var i=ut(t.url);tt.then((function(t){t.match(i).then((function(n){var r=function(t){if(!t)return!1;var e=new Date(t.headers.get("Expires")||0),i=C(t.headers.get("Cache-Control")||"");return e>Date.now()&&!i["no-cache"]}(n);t.delete(i),r&&t.put(i,n.clone()),e(null,n,r)})).catch(e)})).catch(e)}(r,c):c(null,null),{cancel:function(){s=!0,a||n.abort()}}}(t,e);if(M()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(t,e){var i=new o.XMLHttpRequest;for(var n in i.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(i.responseType="arraybuffer"),t.headers)i.setRequestHeader(n,t.headers[n]);return"json"===t.type&&(i.responseType="text",i.setRequestHeader("Accept","application/json")),i.withCredentials="include"===t.credentials,i.onerror=function(){e(new Error(i.statusText))},i.onload=function(){if((i.status>=200&&i.status<300||0===i.status)&&null!==i.response){var n=i.response;if("json"===t.type)try{n=JSON.parse(i.response)}catch(t){return e(t)}e(null,n,i.getResponseHeader("Cache-Control"),i.getResponseHeader("Expires"))}else e(new _t(i.statusText,i.status,t.url))},i.send(t.body),{cancel:function(){return i.abort()}}}(t,e)},xt=function(t,e){return vt(p(t,{type:"arrayBuffer"}),e)},bt=function(t,e){return vt(p(t,{method:"POST"}),e)},wt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";mt=[],gt=0;var St=function(t,e){if(U.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),gt>=N.MAX_PARALLEL_IMAGE_REQUESTS){var i={requestParameters:t,callback:e,cancelled:!1,cancel:function(){this.cancelled=!0}};return mt.push(i),i}gt++;var n=!1,r=function(){if(!n)for(n=!0,gt--;mt.length&&gt<N.MAX_PARALLEL_IMAGE_REQUESTS;){var t=mt.shift();t.cancelled||(t.cancel=St(t.requestParameters,t.callback).cancel)}},a=xt(t,(function(t,i,n,a){r(),t?e(t):i&&(dt()?function(t,e){var i=new o.Blob([new Uint8Array(t)],{type:"image/png"});o.createImageBitmap(i).then((function(t){e(null,t)})).catch((function(t){e(new Error("Could not load image because of "+t.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))}))}(i,e):function(t,e,i,n){var r=new o.Image,a=o.URL;r.onload=function(){e(null,r),a.revokeObjectURL(r.src),r.onload=null,r.src=wt},r.onerror=function(){return e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var s=new o.Blob([new Uint8Array(t)],{type:"image/png"});r.cacheControl=i,r.expires=n,r.src=t.byteLength?a.createObjectURL(s):wt}(i,e,n,a))}));return{cancel:function(){a.cancel(),r()}}};function Et(t,e,i){i[t]&&-1!==i[t].indexOf(e)||(i[t]=i[t]||[],i[t].push(e))}function Tt(t,e,i){if(i&&i[t]){var n=i[t].indexOf(e);-1!==n&&i[t].splice(n,1)}}var Mt=function(t,e){void 0===e&&(e={}),p(this,e),this.type=t},Ct=function(t){function e(e,i){void 0===i&&(i={}),t.call(this,"error",p({error:e},i))}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Mt),It=function(){};It.prototype.on=function(t,e){return this._listeners=this._listeners||{},Et(t,e,this._listeners),this},It.prototype.off=function(t,e){return Tt(t,e,this._listeners),Tt(t,e,this._oneTimeListeners),this},It.prototype.once=function(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},Et(t,e,this._oneTimeListeners),this},It.prototype.fire=function(t,e){"string"==typeof t&&(t=new Mt(t,e||{}));var i=t.type;if(this.listens(i)){t.target=this;for(var n=0,r=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];n<r.length;n+=1)r[n].call(this,t);for(var a=0,o=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];a<o.length;a+=1){var s=o[a];Tt(i,s,this._oneTimeListeners),s.call(this,t)}var l=this._eventedParent;l&&(p(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),l.fire(t))}else t instanceof Ct&&console.error(t.error);return this},It.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},It.prototype.setEventedParent=function(t,e){return this._eventedParent=t,this._eventedParentData=e,this};var At={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},kt=function(t,e,i,n){this.message=(t?t+": ":"")+i,n&&(this.identifier=n),null!=e&&e.__line__&&(this.line=e.__line__)};function Rt(t){var e=t.value;return e?[new kt(t.key,e,"constants have been deprecated as of v8")]:[]}function zt(t){for(var e=[],i=arguments.length-1;i-- >0;)e[i]=arguments[i+1];for(var n=0,r=e;n<r.length;n+=1){var a=r[n];for(var o in a)t[o]=a[o]}return t}function Pt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Dt(t){if(Array.isArray(t))return t.map(Dt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var e={};for(var i in t)e[i]=Dt(t[i]);return e}return Pt(t)}var Lt=function(t){function e(e,i){t.call(this,i),this.message=i,this.key=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Error),Bt=function(t,e){void 0===e&&(e=[]),this.parent=t,this.bindings={};for(var i=0,n=e;i<n.length;i+=1){var r=n[i];this.bindings[r[0]]=r[1]}};Bt.prototype.concat=function(t){return new Bt(this,t)},Bt.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},Bt.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var Ot={kind:"null"},Ft={kind:"number"},Nt={kind:"string"},Ut={kind:"boolean"},$t={kind:"color"},Vt={kind:"object"},jt={kind:"value"},qt={kind:"collator"},Gt={kind:"formatted"},Ht={kind:"resolvedImage"};function Wt(t,e){return{kind:"array",itemType:t,N:e}}function Zt(t){if("array"===t.kind){var e=Zt(t.itemType);return"number"==typeof t.N?"array<"+e+", "+t.N+">":"value"===t.itemType.kind?"array":"array<"+e+">"}return t.kind}var Yt=[Ot,Ft,Nt,Ut,$t,Gt,Vt,Wt(jt),Ht];function Xt(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Xt(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(var i=0,n=Yt;i<n.length;i+=1)if(!Xt(n[i],e))return null}return"Expected "+Zt(t)+" but found "+Zt(e)+" instead."}function Kt(t,e){return e.some((function(e){return e.kind===t.kind}))}function Jt(t,e){return e.some((function(e){return"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t}))}var Qt=e((function(t,e){var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(t){return(t=Math.round(t))<0?0:t>255?255:t}function r(t){return n("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function a(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function o(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{e.parseCSSColor=function(t){var e,s=t.replace(/ /g,"").toLowerCase();if(s in i)return i[s].slice();if("#"===s[0])return 4===s.length?(e=parseInt(s.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===s.length&&(e=parseInt(s.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var l=s.indexOf("("),c=s.indexOf(")");if(-1!==l&&c+1===s.length){var u=s.substr(0,l),h=s.substr(l+1,c-(l+1)).split(","),p=1;switch(u){case"rgba":if(4!==h.length)return null;p=a(h.pop());case"rgb":return 3!==h.length?null:[r(h[0]),r(h[1]),r(h[2]),p];case"hsla":if(4!==h.length)return null;p=a(h.pop());case"hsl":if(3!==h.length)return null;var d=(parseFloat(h[0])%360+360)%360/360,f=a(h[1]),m=a(h[2]),g=m<=.5?m*(f+1):m+f-m*f,_=2*m-g;return[n(255*o(_,g,d+1/3)),n(255*o(_,g,d)),n(255*o(_,g,d-1/3)),p];default:return null}}return null}}catch(t){}})).parseCSSColor,te=function(t,e,i,n){void 0===n&&(n=1),this.r=t,this.g=e,this.b=i,this.a=n};te.parse=function(t){if(t){if(t instanceof te)return t;if("string"==typeof t){var e=Qt(t);if(e)return new te(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3])}}},te.prototype.toString=function(){var t=this.toArray(),e=t[1],i=t[2],n=t[3];return"rgba("+Math.round(t[0])+","+Math.round(e)+","+Math.round(i)+","+n+")"},te.prototype.toArray=function(){var t=this.a;return 0===t?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},te.black=new te(0,0,0,1),te.white=new te(1,1,1,1),te.transparent=new te(0,0,0,0),te.red=new te(1,0,0,1);var ee=function(t,e,i){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};ee.prototype.compare=function(t,e){return this.collator.compare(t,e)},ee.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var ie=function(t,e,i,n,r){this.text=t,this.image=e,this.scale=i,this.fontStack=n,this.textColor=r},ne=function(t){this.sections=t};ne.fromString=function(t){return new ne([new ie(t,null,null,null,null)])},ne.prototype.isEmpty=function(){return 0===this.sections.length||!this.sections.some((function(t){return 0!==t.text.length||t.image&&0!==t.image.name.length}))},ne.factory=function(t){return t instanceof ne?t:ne.fromString(t)},ne.prototype.toString=function(){return 0===this.sections.length?"":this.sections.map((function(t){return t.text})).join("")},ne.prototype.serialize=function(){for(var t=["format"],e=0,i=this.sections;e<i.length;e+=1){var n=i[e];if(n.image)t.push(["image",n.image.name]);else{t.push(n.text);var r={};n.fontStack&&(r["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(r["font-scale"]=n.scale),n.textColor&&(r["text-color"]=["rgba"].concat(n.textColor.toArray())),t.push(r)}}return t};var re=function(t){this.name=t.name,this.available=t.available};function ae(t,e,i,n){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:"Invalid rgba value ["+[t,e,i,n].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+("number"==typeof n?[t,e,i,n]:[t,e,i]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function oe(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof te)return!0;if(t instanceof ee)return!0;if(t instanceof ne)return!0;if(t instanceof re)return!0;if(Array.isArray(t)){for(var e=0,i=t;e<i.length;e+=1)if(!oe(i[e]))return!1;return!0}if("object"==typeof t){for(var n in t)if(!oe(t[n]))return!1;return!0}return!1}function se(t){if(null===t)return Ot;if("string"==typeof t)return Nt;if("boolean"==typeof t)return Ut;if("number"==typeof t)return Ft;if(t instanceof te)return $t;if(t instanceof ee)return qt;if(t instanceof ne)return Gt;if(t instanceof re)return Ht;if(Array.isArray(t)){for(var e,i=t.length,n=0,r=t;n<r.length;n+=1){var a=se(r[n]);if(e){if(e===a)continue;e=jt;break}e=a}return Wt(e||jt,i)}return Vt}function le(t){var e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof te||t instanceof ne||t instanceof re?t.toString():JSON.stringify(t)}re.prototype.toString=function(){return this.name},re.fromString=function(t){return t?new re({name:t,available:!1}):null},re.prototype.serialize=function(){return["image",this.name]};var ce=function(t,e){this.type=t,this.value=e};ce.parse=function(t,e){if(2!==t.length)return e.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!oe(t[1]))return e.error("invalid value");var i=t[1],n=se(i),r=e.expectedType;return"array"!==n.kind||0!==n.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(n=r),new ce(n,i)},ce.prototype.evaluate=function(){return this.value},ce.prototype.eachChild=function(){},ce.prototype.outputDefined=function(){return!0},ce.prototype.serialize=function(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof te?["rgba"].concat(this.value.toArray()):this.value instanceof ne?this.value.serialize():this.value};var ue=function(t){this.name="ExpressionEvaluationError",this.message=t};ue.prototype.toJSON=function(){return this.message};var he={string:Nt,number:Ft,boolean:Ut,object:Vt},pe=function(t,e){this.type=t,this.args=e};pe.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var i,n=1,r=t[0];if("array"===r){var a,o;if(t.length>2){var s=t[1];if("string"!=typeof s||!(s in he)||"object"===s)return e.error('The item type argument of "array" must be one of string, number, boolean',1);a=he[s],n++}else a=jt;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);o=t[2],n++}i=Wt(a,o)}else i=he[r];for(var l=[];n<t.length;n++){var c=e.parse(t[n],n,jt);if(!c)return null;l.push(c)}return new pe(i,l)},pe.prototype.evaluate=function(t){for(var e=0;e<this.args.length;e++){var i=this.args[e].evaluate(t);if(!Xt(this.type,se(i)))return i;if(e===this.args.length-1)throw new ue("Expected value to be of type "+Zt(this.type)+", but found "+Zt(se(i))+" instead.")}return null},pe.prototype.eachChild=function(t){this.args.forEach(t)},pe.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},pe.prototype.serialize=function(){var t=this.type,e=[t.kind];if("array"===t.kind){var i=t.itemType;if("string"===i.kind||"number"===i.kind||"boolean"===i.kind){e.push(i.kind);var n=t.N;("number"==typeof n||this.args.length>1)&&e.push(n)}}return e.concat(this.args.map((function(t){return t.serialize()})))};var de=function(t){this.type=Gt,this.sections=t};de.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var i=t[1];if(!Array.isArray(i)&&"object"==typeof i)return e.error("First argument must be an image or text section.");for(var n=[],r=!1,a=1;a<=t.length-1;++a){var o=t[a];if(r&&"object"==typeof o&&!Array.isArray(o)){r=!1;var s=null;if(o["font-scale"]&&!(s=e.parse(o["font-scale"],1,Ft)))return null;var l=null;if(o["text-font"]&&!(l=e.parse(o["text-font"],1,Wt(Nt))))return null;var c=null;if(o["text-color"]&&!(c=e.parse(o["text-color"],1,$t)))return null;var u=n[n.length-1];u.scale=s,u.font=l,u.textColor=c}else{var h=e.parse(t[a],1,jt);if(!h)return null;var p=h.type.kind;if("string"!==p&&"value"!==p&&"null"!==p&&"resolvedImage"!==p)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,n.push({content:h,scale:null,font:null,textColor:null})}}return new de(n)},de.prototype.evaluate=function(t){return new ne(this.sections.map((function(e){var i=e.content.evaluate(t);return se(i)===Ht?new ie("",i,null,null,null):new ie(le(i),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)})))},de.prototype.eachChild=function(t){for(var e=0,i=this.sections;e<i.length;e+=1){var n=i[e];t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}},de.prototype.outputDefined=function(){return!1},de.prototype.serialize=function(){for(var t=["format"],e=0,i=this.sections;e<i.length;e+=1){var n=i[e];t.push(n.content.serialize());var r={};n.scale&&(r["font-scale"]=n.scale.serialize()),n.font&&(r["text-font"]=n.font.serialize()),n.textColor&&(r["text-color"]=n.textColor.serialize()),t.push(r)}return t};var fe=function(t){this.type=Ht,this.input=t};fe.parse=function(t,e){if(2!==t.length)return e.error("Expected two arguments.");var i=e.parse(t[1],1,Nt);return i?new fe(i):e.error("No image name provided.")},fe.prototype.evaluate=function(t){var e=this.input.evaluate(t),i=re.fromString(e);return i&&t.availableImages&&(i.available=t.availableImages.indexOf(e)>-1),i},fe.prototype.eachChild=function(t){t(this.input)},fe.prototype.outputDefined=function(){return!1},fe.prototype.serialize=function(){return["image",this.input.serialize()]};var me={"to-boolean":Ut,"to-color":$t,"to-number":Ft,"to-string":Nt},ge=function(t,e){this.type=t,this.args=e};ge.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var i=t[0];if(("to-boolean"===i||"to-string"===i)&&2!==t.length)return e.error("Expected one argument.");for(var n=me[i],r=[],a=1;a<t.length;a++){var o=e.parse(t[a],a,jt);if(!o)return null;r.push(o)}return new ge(n,r)},ge.prototype.evaluate=function(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){for(var e,i,n=0,r=this.args;n<r.length;n+=1){if(i=null,(e=r[n].evaluate(t))instanceof te)return e;if("string"==typeof e){var a=t.parseColor(e);if(a)return a}else if(Array.isArray(e)&&!(i=e.length<3||e.length>4?"Invalid rbga value "+JSON.stringify(e)+": expected an array containing either three or four numeric values.":ae(e[0],e[1],e[2],e[3])))return new te(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new ue(i||"Could not parse color from value '"+("string"==typeof e?e:String(JSON.stringify(e)))+"'")}if("number"===this.type.kind){for(var o=null,s=0,l=this.args;s<l.length;s+=1){if(null===(o=l[s].evaluate(t)))return 0;var c=Number(o);if(!isNaN(c))return c}throw new ue("Could not convert "+JSON.stringify(o)+" to number.")}return"formatted"===this.type.kind?ne.fromString(le(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?re.fromString(le(this.args[0].evaluate(t))):le(this.args[0].evaluate(t))},ge.prototype.eachChild=function(t){this.args.forEach(t)},ge.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},ge.prototype.serialize=function(){if("formatted"===this.type.kind)return new de([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new fe(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild((function(e){t.push(e.serialize())})),t};var _e=["Unknown","Point","LineString","Polygon"],ye=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};ye.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},ye.prototype.geometryType=function(){return this.feature?"number"==typeof this.feature.type?_e[this.feature.type]:this.feature.type:null},ye.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},ye.prototype.canonicalID=function(){return this.canonical},ye.prototype.properties=function(){return this.feature&&this.feature.properties||{}},ye.prototype.parseColor=function(t){var e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=te.parse(t)),e};var ve=function(t,e,i,n){this.name=t,this.type=e,this._evaluate=i,this.args=n};ve.prototype.evaluate=function(t){return this._evaluate(t,this.args)},ve.prototype.eachChild=function(t){this.args.forEach(t)},ve.prototype.outputDefined=function(){return!1},ve.prototype.serialize=function(){return[this.name].concat(this.args.map((function(t){return t.serialize()})))},ve.parse=function(t,e){var i,n=t[0],r=ve.definitions[n];if(!r)return e.error('Unknown expression "'+n+'". If you wanted a literal array, use ["literal", [...]].',0);for(var a=Array.isArray(r)?r[0]:r.type,o=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,s=o.filter((function(e){var i=e[0];return!Array.isArray(i)||i.length===t.length-1})),l=null,c=0,u=s;c<u.length;c+=1){var h=u[c],p=h[0],d=h[1];l=new $e(e.registry,e.path,null,e.scope);for(var f=[],m=!1,g=1;g<t.length;g++){var _=t[g],y=Array.isArray(p)?p[g-1]:p.type,v=l.parse(_,1+f.length,y);if(!v){m=!0;break}f.push(v)}if(!m)if(Array.isArray(p)&&p.length!==f.length)l.error("Expected "+p.length+" arguments, but found "+f.length+" instead.");else{for(var x=0;x<f.length;x++){var b=Array.isArray(p)?p[x]:p.type,w=f[x];l.concat(x+1).checkSubtype(b,w.type)}if(0===l.errors.length)return new ve(n,a,d,f)}}if(1===s.length)(i=e.errors).push.apply(i,l.errors);else{for(var S=(s.length?s:o).map((function(t){var e;return e=t[0],Array.isArray(e)?"("+e.map(Zt).join(", ")+")":"("+Zt(e.type)+"...)"})).join(" | "),E=[],T=1;T<t.length;T++){var M=e.parse(t[T],1+E.length);if(!M)return null;E.push(Zt(M.type))}e.error("Expected arguments of type "+S+", but found ("+E.join(", ")+") instead.")}return null},ve.register=function(t,e){for(var i in ve.definitions=e,e)t[i]=ve};var xe=function(t,e,i){this.type=qt,this.locale=i,this.caseSensitive=t,this.diacriticSensitive=e};function be(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function we(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Se(t,e){var i=(180+t[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,r=Math.pow(2,e.z);return[Math.round(i*r*8192),Math.round(n*r*8192)]}function Ee(t,e,i){return e[1]>t[1]!=i[1]>t[1]&&t[0]<(i[0]-e[0])*(t[1]-e[1])/(i[1]-e[1])+e[0]}function Te(t,e){for(var i,n,r,a,o,s,l,c=!1,u=0,h=e.length;u<h;u++)for(var p=e[u],d=0,f=p.length;d<f-1;d++){if((a=(i=t)[0]-(n=p[d])[0])*(l=i[1]-(r=p[d+1])[1])-(s=i[0]-r[0])*(o=i[1]-n[1])==0&&a*s<=0&&o*l<=0)return!1;Ee(t,p[d],p[d+1])&&(c=!c)}return c}function Me(t,e){for(var i=0;i<e.length;i++)if(Te(t,e[i]))return!0;return!1}function Ce(t,e,i,n){var r=n[0]-i[0],a=n[1]-i[1],o=(t[0]-i[0])*a-r*(t[1]-i[1]),s=(e[0]-i[0])*a-r*(e[1]-i[1]);return o>0&&s<0||o<0&&s>0}function Ie(t,e,i){for(var n=0,r=i;n<r.length;n+=1)for(var a=r[n],o=0;o<a.length-1;++o)if(0!=(h=[(u=a[o+1])[0]-(c=a[o])[0],u[1]-c[1]])[0]*(p=[(l=e)[0]-(s=t)[0],l[1]-s[1]])[1]-h[1]*p[0]&&Ce(s,l,c,u)&&Ce(c,u,s,l))return!0;var s,l,c,u,h,p;return!1}function Ae(t,e){for(var i=0;i<t.length;++i)if(!Te(t[i],e))return!1;for(var n=0;n<t.length-1;++n)if(Ie(t[n],t[n+1],e))return!1;return!0}function ke(t,e){for(var i=0;i<e.length;i++)if(Ae(t,e[i]))return!0;return!1}function Re(t,e,i){for(var n=[],r=0;r<t.length;r++){for(var a=[],o=0;o<t[r].length;o++){var s=Se(t[r][o],i);be(e,s),a.push(s)}n.push(a)}return n}function ze(t,e,i){for(var n=[],r=0;r<t.length;r++){var a=Re(t[r],e,i);n.push(a)}return n}function Pe(t,e,i,n){if(t[0]<i[0]||t[0]>i[2]){var r=.5*n,a=t[0]-i[0]>r?-n:i[0]-t[0]>r?n:0;0===a&&(a=t[0]-i[2]>r?-n:i[2]-t[0]>r?n:0),t[0]+=a}be(e,t)}function De(t,e,i,n){for(var r=8192*Math.pow(2,n.z),a=[8192*n.x,8192*n.y],o=[],s=0,l=t;s<l.length;s+=1)for(var c=0,u=l[s];c<u.length;c+=1){var h=u[c],p=[h.x+a[0],h.y+a[1]];Pe(p,e,i,r),o.push(p)}return o}function Le(t,e,i,n){for(var r,a=8192*Math.pow(2,n.z),o=[8192*n.x,8192*n.y],s=[],l=0,c=t;l<c.length;l+=1){for(var u=[],h=0,p=c[l];h<p.length;h+=1){var d=p[h],f=[d.x+o[0],d.y+o[1]];be(e,f),u.push(f)}s.push(u)}if(e[2]-e[0]<=a/2){(r=e)[0]=r[1]=1/0,r[2]=r[3]=-1/0;for(var m=0,g=s;m<g.length;m+=1)for(var _=0,y=g[m];_<y.length;_+=1)Pe(y[_],e,i,a)}return s}xe.parse=function(t,e){if(2!==t.length)return e.error("Expected one argument.");var i=t[1];if("object"!=typeof i||Array.isArray(i))return e.error("Collator options argument must be an object.");var n=e.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,Ut);if(!n)return null;var r=e.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,Ut);if(!r)return null;var a=null;return i.locale&&!(a=e.parse(i.locale,1,Nt))?null:new xe(n,r,a)},xe.prototype.evaluate=function(t){return new ee(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},xe.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},xe.prototype.outputDefined=function(){return!1},xe.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var Be=function(t,e){this.type=Ut,this.geojson=t,this.geometries=e};function Oe(t){if(t instanceof ve){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof Be)return!1;var e=!0;return t.eachChild((function(t){e&&!Oe(t)&&(e=!1)})),e}function Fe(t){if(t instanceof ve&&"feature-state"===t.name)return!1;var e=!0;return t.eachChild((function(t){e&&!Fe(t)&&(e=!1)})),e}function Ne(t,e){if(t instanceof ve&&e.indexOf(t.name)>=0)return!1;var i=!0;return t.eachChild((function(t){i&&!Ne(t,e)&&(i=!1)})),i}Be.parse=function(t,e){if(2!==t.length)return e.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(oe(t[1])){var i=t[1];if("FeatureCollection"===i.type)for(var n=0;n<i.features.length;++n){var r=i.features[n].geometry.type;if("Polygon"===r||"MultiPolygon"===r)return new Be(i,i.features[n].geometry)}else if("Feature"===i.type){var a=i.geometry.type;if("Polygon"===a||"MultiPolygon"===a)return new Be(i,i.geometry)}else if("Polygon"===i.type||"MultiPolygon"===i.type)return new Be(i,i)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Be.prototype.evaluate=function(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){var i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if("Polygon"===e.type){var a=Re(e.coordinates,n,r),o=De(t.geometry(),i,n,r);if(!we(i,n))return!1;for(var s=0,l=o;s<l.length;s+=1)if(!Te(l[s],a))return!1}if("MultiPolygon"===e.type){var c=ze(e.coordinates,n,r),u=De(t.geometry(),i,n,r);if(!we(i,n))return!1;for(var h=0,p=u;h<p.length;h+=1)if(!Me(p[h],c))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){var i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if("Polygon"===e.type){var a=Re(e.coordinates,n,r),o=Le(t.geometry(),i,n,r);if(!we(i,n))return!1;for(var s=0,l=o;s<l.length;s+=1)if(!Ae(l[s],a))return!1}if("MultiPolygon"===e.type){var c=ze(e.coordinates,n,r),u=Le(t.geometry(),i,n,r);if(!we(i,n))return!1;for(var h=0,p=u;h<p.length;h+=1)if(!ke(p[h],c))return!1}return!0}(t,this.geometries)}return!1},Be.prototype.eachChild=function(){},Be.prototype.outputDefined=function(){return!0},Be.prototype.serialize=function(){return["within",this.geojson]};var Ue=function(t,e){this.type=e.type,this.name=t,this.boundExpression=e};Ue.parse=function(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");var i=t[1];return e.scope.has(i)?new Ue(i,e.scope.get(i)):e.error('Unknown variable "'+i+'". Make sure "'+i+'" has been bound in an enclosing "let" expression before using it.',1)},Ue.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},Ue.prototype.eachChild=function(){},Ue.prototype.outputDefined=function(){return!1},Ue.prototype.serialize=function(){return["var",this.name]};var $e=function(t,e,i,n,r){void 0===e&&(e=[]),void 0===n&&(n=new Bt),void 0===r&&(r=[]),this.registry=t,this.path=e,this.key=e.map((function(t){return"["+t+"]"})).join(""),this.scope=n,this.errors=r,this.expectedType=i};function Ve(t,e){for(var i,n=t.length-1,r=0,a=n,o=0;r<=a;)if((i=t[o=Math.floor((r+a)/2)])<=e){if(o===n||e<t[o+1])return o;r=o+1}else{if(!(i>e))throw new ue("Input is not a number.");a=o-1}return 0}$e.prototype.parse=function(t,e,i,n,r){return void 0===r&&(r={}),e?this.concat(e,i,n)._parse(t,r):this._parse(t,r)},$e.prototype._parse=function(t,e){function i(t,e,i){return"assert"===i?new pe(e,[t]):"coerce"===i?new ge(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var n=t[0];if("string"!=typeof n)return this.error("Expression name must be a string, but found "+typeof n+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var r=this.registry[n];if(r){var a=r.parse(t,this);if(!a)return null;if(this.expectedType){var o=this.expectedType,s=a.type;if("string"!==o.kind&&"number"!==o.kind&&"boolean"!==o.kind&&"object"!==o.kind&&"array"!==o.kind||"value"!==s.kind)if("color"!==o.kind&&"formatted"!==o.kind&&"resolvedImage"!==o.kind||"value"!==s.kind&&"string"!==s.kind){if(this.checkSubtype(o,s))return null}else a=i(a,o,e.typeAnnotation||"coerce");else a=i(a,o,e.typeAnnotation||"assert")}if(!(a instanceof ce)&&"resolvedImage"!==a.type.kind&&function t(e){if(e instanceof Ue)return t(e.boundExpression);if(e instanceof ve&&"error"===e.name)return!1;if(e instanceof xe)return!1;if(e instanceof Be)return!1;var i=e instanceof ge||e instanceof pe,n=!0;return e.eachChild((function(e){n=i?n&&t(e):n&&e instanceof ce})),!!n&&Oe(e)&&Ne(e,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(a)){var l=new ye;try{a=new ce(a.type,a.evaluate(l))}catch(t){return this.error(t.message),null}}return a}return this.error('Unknown expression "'+n+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},$e.prototype.concat=function(t,e,i){var n="number"==typeof t?this.path.concat(t):this.path,r=i?this.scope.concat(i):this.scope;return new $e(this.registry,n,e||null,r,this.errors)},$e.prototype.error=function(t){for(var e=[],i=arguments.length-1;i-- >0;)e[i]=arguments[i+1];var n=""+this.key+e.map((function(t){return"["+t+"]"})).join("");this.errors.push(new Lt(n,t))},$e.prototype.checkSubtype=function(t,e){var i=Xt(t,e);return i&&this.error(i),i};var je=function(t,e,i){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(var n=0,r=i;n<r.length;n+=1){var a=r[n],o=a[1];this.labels.push(a[0]),this.outputs.push(o)}};function qe(t,e,i){return t*(1-i)+e*i}je.parse=function(t,e){if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");var i=e.parse(t[1],1,Ft);if(!i)return null;var n=[],r=null;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(var a=1;a<t.length;a+=2){var o=1===a?-1/0:t[a],s=t[a+1],l=a,c=a+1;if("number"!=typeof o)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',l);if(n.length&&n[n.length-1][0]>=o)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',l);var u=e.parse(s,c,r);if(!u)return null;r=r||u.type,n.push([o,u])}return new je(r,i,n)},je.prototype.evaluate=function(t){var e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);var n=this.input.evaluate(t);if(n<=e[0])return i[0].evaluate(t);var r=e.length;return n>=e[r-1]?i[r-1].evaluate(t):i[Ve(e,n)].evaluate(t)},je.prototype.eachChild=function(t){t(this.input);for(var e=0,i=this.outputs;e<i.length;e+=1)t(i[e])},je.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))},je.prototype.serialize=function(){for(var t=["step",this.input.serialize()],e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t};var Ge=Object.freeze({__proto__:null,number:qe,color:function(t,e,i){return new te(qe(t.r,e.r,i),qe(t.g,e.g,i),qe(t.b,e.b,i),qe(t.a,e.a,i))},array:function(t,e,i){return t.map((function(t,n){return qe(t,e[n],i)}))}}),He=6/29*3*(6/29),We=Math.PI/180,Ze=180/Math.PI;function Ye(t){return t>.008856451679035631?Math.pow(t,1/3):t/He+4/29}function Xe(t){return t>6/29?t*t*t:He*(t-4/29)}function Ke(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Je(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Qe(t){var e=Je(t.r),i=Je(t.g),n=Je(t.b),r=Ye((.4124564*e+.3575761*i+.1804375*n)/.95047),a=Ye((.2126729*e+.7151522*i+.072175*n)/1);return{l:116*a-16,a:500*(r-a),b:200*(a-Ye((.0193339*e+.119192*i+.9503041*n)/1.08883)),alpha:t.a}}function ti(t){var e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,n=isNaN(t.b)?e:e-t.b/200;return e=1*Xe(e),i=.95047*Xe(i),n=1.08883*Xe(n),new te(Ke(3.2404542*i-1.5371385*e-.4985314*n),Ke(-.969266*i+1.8760108*e+.041556*n),Ke(.0556434*i-.2040259*e+1.0572252*n),t.alpha)}function ei(t,e,i){var n=e-t;return t+i*(n>180||n<-180?n-360*Math.round(n/360):n)}var ii={forward:Qe,reverse:ti,interpolate:function(t,e,i){return{l:qe(t.l,e.l,i),a:qe(t.a,e.a,i),b:qe(t.b,e.b,i),alpha:qe(t.alpha,e.alpha,i)}}},ni={forward:function(t){var e=Qe(t),i=e.l,n=e.a,r=e.b,a=Math.atan2(r,n)*Ze;return{h:a<0?a+360:a,c:Math.sqrt(n*n+r*r),l:i,alpha:t.a}},reverse:function(t){var e=t.h*We,i=t.c;return ti({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:ei(t.h,e.h,i),c:qe(t.c,e.c,i),l:qe(t.l,e.l,i),alpha:qe(t.alpha,e.alpha,i)}}},ri=Object.freeze({__proto__:null,lab:ii,hcl:ni}),ai=function(t,e,i,n,r){this.type=t,this.operator=e,this.interpolation=i,this.input=n,this.labels=[],this.outputs=[];for(var a=0,o=r;a<o.length;a+=1){var s=o[a],l=s[1];this.labels.push(s[0]),this.outputs.push(l)}};function oi(t,e,i,n){var r=n-i,a=t-i;return 0===r?0:1===e?a/r:(Math.pow(e,a)-1)/(Math.pow(e,r)-1)}ai.interpolationFactor=function(t,e,n,r){var a=0;if("exponential"===t.name)a=oi(e,t.base,n,r);else if("linear"===t.name)a=oi(e,1,n,r);else if("cubic-bezier"===t.name){var o=t.controlPoints;a=new i(o[0],o[1],o[2],o[3]).solve(oi(e,1,n,r))}return a},ai.parse=function(t,e){var i=t[0],n=t[1],r=t[2],a=t.slice(3);if(!Array.isArray(n)||0===n.length)return e.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){var o=n[1];if("number"!=typeof o)return e.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:o}}else{if("cubic-bezier"!==n[0])return e.error("Unknown interpolation type "+String(n[0]),1,0);var s=n.slice(1);if(4!==s.length||s.some((function(t){return"number"!=typeof t||t<0||t>1})))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:s}}if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(r=e.parse(r,2,Ft)))return null;var l=[],c=null;"interpolate-hcl"===i||"interpolate-lab"===i?c=$t:e.expectedType&&"value"!==e.expectedType.kind&&(c=e.expectedType);for(var u=0;u<a.length;u+=2){var h=a[u],p=a[u+1],d=u+3,f=u+4;if("number"!=typeof h)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',d);if(l.length&&l[l.length-1][0]>=h)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',d);var m=e.parse(p,f,c);if(!m)return null;c=c||m.type,l.push([h,m])}return"number"===c.kind||"color"===c.kind||"array"===c.kind&&"number"===c.itemType.kind&&"number"==typeof c.N?new ai(c,i,n,r,l):e.error("Type "+Zt(c)+" is not interpolatable.")},ai.prototype.evaluate=function(t){var e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);var n=this.input.evaluate(t);if(n<=e[0])return i[0].evaluate(t);var r=e.length;if(n>=e[r-1])return i[r-1].evaluate(t);var a=Ve(e,n),o=ai.interpolationFactor(this.interpolation,n,e[a],e[a+1]),s=i[a].evaluate(t),l=i[a+1].evaluate(t);return"interpolate"===this.operator?Ge[this.type.kind.toLowerCase()](s,l,o):"interpolate-hcl"===this.operator?ni.reverse(ni.interpolate(ni.forward(s),ni.forward(l),o)):ii.reverse(ii.interpolate(ii.forward(s),ii.forward(l),o))},ai.prototype.eachChild=function(t){t(this.input);for(var e=0,i=this.outputs;e<i.length;e+=1)t(i[e])},ai.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))},ai.prototype.serialize=function(){var t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var e=[this.operator,t,this.input.serialize()],i=0;i<this.labels.length;i++)e.push(this.labels[i],this.outputs[i].serialize());return e};var si=function(t,e){this.type=t,this.args=e};si.parse=function(t,e){if(t.length<2)return e.error("Expectected at least one argument.");var i=null,n=e.expectedType;n&&"value"!==n.kind&&(i=n);for(var r=[],a=0,o=t.slice(1);a<o.length;a+=1){var s=e.parse(o[a],1+r.length,i,void 0,{typeAnnotation:"omit"});if(!s)return null;i=i||s.type,r.push(s)}var l=n&&r.some((function(t){return Xt(n,t.type)}));return new si(l?jt:i,r)},si.prototype.evaluate=function(t){for(var e,i=null,n=0,r=0,a=this.args;r<a.length&&(n++,(i=a[r].evaluate(t))&&i instanceof re&&!i.available&&(e||(e=i.name),i=null,n===this.args.length&&(i=e)),null===i);r+=1);return i},si.prototype.eachChild=function(t){this.args.forEach(t)},si.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},si.prototype.serialize=function(){var t=["coalesce"];return this.eachChild((function(e){t.push(e.serialize())})),t};var li=function(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e};li.prototype.evaluate=function(t){return this.result.evaluate(t)},li.prototype.eachChild=function(t){for(var e=0,i=this.bindings;e<i.length;e+=1)t(i[e][1]);t(this.result)},li.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var i=[],n=1;n<t.length-1;n+=2){var r=t[n];if("string"!=typeof r)return e.error("Expected string, but found "+typeof r+" instead.",n);if(/[^a-zA-Z0-9_]/.test(r))return e.error("Variable names must contain only alphanumeric characters or '_'.",n);var a=e.parse(t[n+1],n+1);if(!a)return null;i.push([r,a])}var o=e.parse(t[t.length-1],t.length-1,e.expectedType,i);return o?new li(i,o):null},li.prototype.outputDefined=function(){return this.result.outputDefined()},li.prototype.serialize=function(){for(var t=["let"],e=0,i=this.bindings;e<i.length;e+=1){var n=i[e];t.push(n[0],n[1].serialize())}return t.push(this.result.serialize()),t};var ci=function(t,e,i){this.type=t,this.index=e,this.input=i};ci.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var i=e.parse(t[1],1,Ft),n=e.parse(t[2],2,Wt(e.expectedType||jt));return i&&n?new ci(n.type.itemType,i,n):null},ci.prototype.evaluate=function(t){var e=this.index.evaluate(t),i=this.input.evaluate(t);if(e<0)throw new ue("Array index out of bounds: "+e+" < 0.");if(e>=i.length)throw new ue("Array index out of bounds: "+e+" > "+(i.length-1)+".");if(e!==Math.floor(e))throw new ue("Array index must be an integer, but found "+e+" instead.");return i[e]},ci.prototype.eachChild=function(t){t(this.index),t(this.input)},ci.prototype.outputDefined=function(){return!1},ci.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var ui=function(t,e){this.type=Ut,this.needle=t,this.haystack=e};ui.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var i=e.parse(t[1],1,jt),n=e.parse(t[2],2,jt);return i&&n?Kt(i.type,[Ut,Nt,Ft,Ot,jt])?new ui(i,n):e.error("Expected first argument to be of type boolean, string, number or null, but found "+Zt(i.type)+" instead"):null},ui.prototype.evaluate=function(t){var e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(!i)return!1;if(!Jt(e,["boolean","string","number","null"]))throw new ue("Expected first argument to be of type boolean, string, number or null, but found "+Zt(se(e))+" instead.");if(!Jt(i,["string","array"]))throw new ue("Expected second argument to be of type array or string, but found "+Zt(se(i))+" instead.");return i.indexOf(e)>=0},ui.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},ui.prototype.outputDefined=function(){return!0},ui.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var hi=function(t,e,i){this.type=Ft,this.needle=t,this.haystack=e,this.fromIndex=i};hi.parse=function(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var i=e.parse(t[1],1,jt),n=e.parse(t[2],2,jt);if(!i||!n)return null;if(!Kt(i.type,[Ut,Nt,Ft,Ot,jt]))return e.error("Expected first argument to be of type boolean, string, number or null, but found "+Zt(i.type)+" instead");if(4===t.length){var r=e.parse(t[3],3,Ft);return r?new hi(i,n,r):null}return new hi(i,n)},hi.prototype.evaluate=function(t){var e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(!Jt(e,["boolean","string","number","null"]))throw new ue("Expected first argument to be of type boolean, string, number or null, but found "+Zt(se(e))+" instead.");if(!Jt(i,["string","array"]))throw new ue("Expected second argument to be of type array or string, but found "+Zt(se(i))+" instead.");if(this.fromIndex){var n=this.fromIndex.evaluate(t);return i.indexOf(e,n)}return i.indexOf(e)},hi.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},hi.prototype.outputDefined=function(){return!1},hi.prototype.serialize=function(){if(null!=this.fromIndex&&void 0!==this.fromIndex){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var pi=function(t,e,i,n,r,a){this.inputType=t,this.type=e,this.input=i,this.cases=n,this.outputs=r,this.otherwise=a};pi.parse=function(t,e){if(t.length<5)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return e.error("Expected an even number of arguments.");var i,n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);for(var r={},a=[],o=2;o<t.length-1;o+=2){var s=t[o],l=t[o+1];Array.isArray(s)||(s=[s]);var c=e.concat(o);if(0===s.length)return c.error("Expected at least one branch label.");for(var u=0,h=s;u<h.length;u+=1){var p=h[u];if("number"!=typeof p&&"string"!=typeof p)return c.error("Branch labels must be numbers or strings.");if("number"==typeof p&&Math.abs(p)>Number.MAX_SAFE_INTEGER)return c.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if("number"==typeof p&&Math.floor(p)!==p)return c.error("Numeric branch labels must be integer values.");if(i){if(c.checkSubtype(i,se(p)))return null}else i=se(p);if(void 0!==r[String(p)])return c.error("Branch labels must be unique.");r[String(p)]=a.length}var d=e.parse(l,o,n);if(!d)return null;n=n||d.type,a.push(d)}var f=e.parse(t[1],1,jt);if(!f)return null;var m=e.parse(t[t.length-1],t.length-1,n);return m?"value"!==f.type.kind&&e.concat(1).checkSubtype(i,f.type)?null:new pi(i,n,f,r,a,m):null},pi.prototype.evaluate=function(t){var e=this.input.evaluate(t);return(se(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)},pi.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},pi.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))&&this.otherwise.outputDefined()},pi.prototype.serialize=function(){for(var t=this,e=["match",this.input.serialize()],i=[],n={},r=0,a=Object.keys(this.cases).sort();r<a.length;r+=1){var o=a[r];void 0===(h=n[this.cases[o]])?(n[this.cases[o]]=i.length,i.push([this.cases[o],[o]])):i[h][1].push(o)}for(var s=function(e){return"number"===t.inputType.kind?Number(e):e},l=0,c=i;l<c.length;l+=1){var u=c[l],h=u[0],p=u[1];e.push(1===p.length?s(p[0]):p.map(s)),e.push(this.outputs[outputIndex$1].serialize())}return e.push(this.otherwise.serialize()),e};var di=function(t,e,i){this.type=t,this.branches=e,this.otherwise=i};di.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return e.error("Expected an odd number of arguments.");var i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);for(var n=[],r=1;r<t.length-1;r+=2){var a=e.parse(t[r],r,Ut);if(!a)return null;var o=e.parse(t[r+1],r+1,i);if(!o)return null;n.push([a,o]),i=i||o.type}var s=e.parse(t[t.length-1],t.length-1,i);return s?new di(i,n,s):null},di.prototype.evaluate=function(t){for(var e=0,i=this.branches;e<i.length;e+=1){var n=i[e],r=n[1];if(n[0].evaluate(t))return r.evaluate(t)}return this.otherwise.evaluate(t)},di.prototype.eachChild=function(t){for(var e=0,i=this.branches;e<i.length;e+=1){var n=i[e],r=n[1];t(n[0]),t(r)}t(this.otherwise)},di.prototype.outputDefined=function(){return this.branches.every((function(t){return t[1].outputDefined()}))&&this.otherwise.outputDefined()},di.prototype.serialize=function(){var t=["case"];return this.eachChild((function(e){t.push(e.serialize())})),t};var fi=function(t,e,i,n){this.type=t,this.input=e,this.beginIndex=i,this.endIndex=n};function mi(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function gi(t,e,i,n){return 0===n.compare(e,i)}function _i(t,e,i){var n="=="!==t&&"!="!==t;return function(){function r(t,e,i){this.type=Ut,this.lhs=t,this.rhs=e,this.collator=i,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}return r.parse=function(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");var i=t[0],a=e.parse(t[1],1,jt);if(!a)return null;if(!mi(i,a.type))return e.concat(1).error('"'+i+"\" comparisons are not supported for type '"+Zt(a.type)+"'.");var o=e.parse(t[2],2,jt);if(!o)return null;if(!mi(i,o.type))return e.concat(2).error('"'+i+"\" comparisons are not supported for type '"+Zt(o.type)+"'.");if(a.type.kind!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return e.error("Cannot compare types '"+Zt(a.type)+"' and '"+Zt(o.type)+"'.");n&&("value"===a.type.kind&&"value"!==o.type.kind?a=new pe(o.type,[a]):"value"!==a.type.kind&&"value"===o.type.kind&&(o=new pe(a.type,[o])));var s=null;if(4===t.length){if("string"!==a.type.kind&&"string"!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return e.error("Cannot use collator to compare non-string types.");if(!(s=e.parse(t[3],3,qt)))return null}return new r(a,o,s)},r.prototype.evaluate=function(r){var a=this.lhs.evaluate(r),o=this.rhs.evaluate(r);if(n&&this.hasUntypedArgument){var s=se(a),l=se(o);if(s.kind!==l.kind||"string"!==s.kind&&"number"!==s.kind)throw new ue('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+s.kind+", "+l.kind+") instead.")}if(this.collator&&!n&&this.hasUntypedArgument){var c=se(a),u=se(o);if("string"!==c.kind||"string"!==u.kind)return e(r,a,o)}return this.collator?i(r,a,o,this.collator.evaluate(r)):e(r,a,o)},r.prototype.eachChild=function(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)},r.prototype.outputDefined=function(){return!0},r.prototype.serialize=function(){var e=[t];return this.eachChild((function(t){e.push(t.serialize())})),e},r}()}fi.parse=function(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var i=e.parse(t[1],1,jt),n=e.parse(t[2],2,Ft);if(!i||!n)return null;if(!Kt(i.type,[Wt(jt),Nt,jt]))return e.error("Expected first argument to be of type array or string, but found "+Zt(i.type)+" instead");if(4===t.length){var r=e.parse(t[3],3,Ft);return r?new fi(i.type,i,n,r):null}return new fi(i.type,i,n)},fi.prototype.evaluate=function(t){var e=this.input.evaluate(t),i=this.beginIndex.evaluate(t);if(!Jt(e,["string","array"]))throw new ue("Expected first argument to be of type array or string, but found "+Zt(se(e))+" instead.");if(this.endIndex){var n=this.endIndex.evaluate(t);return e.slice(i,n)}return e.slice(i)},fi.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},fi.prototype.outputDefined=function(){return!1},fi.prototype.serialize=function(){if(null!=this.endIndex&&void 0!==this.endIndex){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var yi=_i("==",(function(t,e,i){return e===i}),gi),vi=_i("!=",(function(t,e,i){return e!==i}),(function(t,e,i,n){return!gi(0,e,i,n)})),xi=_i("<",(function(t,e,i){return e<i}),(function(t,e,i,n){return n.compare(e,i)<0})),bi=_i(">",(function(t,e,i){return e>i}),(function(t,e,i,n){return n.compare(e,i)>0})),wi=_i("<=",(function(t,e,i){return e<=i}),(function(t,e,i,n){return n.compare(e,i)<=0})),Si=_i(">=",(function(t,e,i){return e>=i}),(function(t,e,i,n){return n.compare(e,i)>=0})),Ei=function(t,e,i,n,r){this.type=Nt,this.number=t,this.locale=e,this.currency=i,this.minFractionDigits=n,this.maxFractionDigits=r};Ei.parse=function(t,e){if(3!==t.length)return e.error("Expected two arguments.");var i=e.parse(t[1],1,Ft);if(!i)return null;var n=t[2];if("object"!=typeof n||Array.isArray(n))return e.error("NumberFormat options argument must be an object.");var r=null;if(n.locale&&!(r=e.parse(n.locale,1,Nt)))return null;var a=null;if(n.currency&&!(a=e.parse(n.currency,1,Nt)))return null;var o=null;if(n["min-fraction-digits"]&&!(o=e.parse(n["min-fraction-digits"],1,Ft)))return null;var s=null;return n["max-fraction-digits"]&&!(s=e.parse(n["max-fraction-digits"],1,Ft))?null:new Ei(i,r,a,o,s)},Ei.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Ei.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Ei.prototype.outputDefined=function(){return!1},Ei.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var Ti=function(t){this.type=Ft,this.input=t};Ti.parse=function(t,e){if(2!==t.length)return e.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var i=e.parse(t[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?e.error("Expected argument of type string or array, but found "+Zt(i.type)+" instead."):new Ti(i):null},Ti.prototype.evaluate=function(t){var e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new ue("Expected value to be of type string or array, but found "+Zt(se(e))+" instead.")},Ti.prototype.eachChild=function(t){t(this.input)},Ti.prototype.outputDefined=function(){return!1},Ti.prototype.serialize=function(){var t=["length"];return this.eachChild((function(e){t.push(e.serialize())})),t};var Mi={"==":yi,"!=":vi,">":bi,"<":xi,">=":Si,"<=":wi,array:pe,at:ci,boolean:pe,case:di,coalesce:si,collator:xe,format:de,image:fe,in:ui,"index-of":hi,interpolate:ai,"interpolate-hcl":ai,"interpolate-lab":ai,length:Ti,let:li,literal:ce,match:pi,number:pe,"number-format":Ei,object:pe,slice:fi,step:je,string:pe,"to-boolean":ge,"to-color":ge,"to-number":ge,"to-string":ge,var:Ue,within:Be};function Ci(t,e){var i=e[0],n=e[1],r=e[2],a=e[3];i=i.evaluate(t),n=n.evaluate(t),r=r.evaluate(t);var o=a?a.evaluate(t):1,s=ae(i,n,r,o);if(s)throw new ue(s);return new te(i/255*o,n/255*o,r/255*o,o)}function Ii(t,e){return t in e}function Ai(t,e){var i=e[t];return void 0===i?null:i}function ki(t){return{type:t}}function Ri(t){return{result:"success",value:t}}function zi(t){return{result:"error",value:t}}function Pi(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function Di(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Li(t){return!!t.expression&&t.expression.interpolated}function Bi(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function Oi(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function Fi(t){return t}function Ni(t,e,i){return void 0!==t?t:void 0!==e?e:void 0!==i?i:void 0}function Ui(t,e,i,n,r){return Ni(typeof i===r?n[i]:void 0,t.default,e.default)}function $i(t,e,i){if("number"!==Bi(i))return Ni(t.default,e.default);var n=t.stops.length;if(1===n)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[n-1][0])return t.stops[n-1][1];var r=Ve(t.stops.map((function(t){return t[0]})),i);return t.stops[r][1]}function Vi(t,e,i){var n=void 0!==t.base?t.base:1;if("number"!==Bi(i))return Ni(t.default,e.default);var r=t.stops.length;if(1===r)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[r-1][0])return t.stops[r-1][1];var a=Ve(t.stops.map((function(t){return t[0]})),i),o=function(t,e,i,n){var r=n-i,a=t-i;return 0===r?0:1===e?a/r:(Math.pow(e,a)-1)/(Math.pow(e,r)-1)}(i,n,t.stops[a][0],t.stops[a+1][0]),s=t.stops[a][1],l=t.stops[a+1][1],c=Ge[e.type]||Fi;if(t.colorSpace&&"rgb"!==t.colorSpace){var u=ri[t.colorSpace];c=function(t,e){return u.reverse(u.interpolate(u.forward(t),u.forward(e),o))}}return"function"==typeof s.evaluate?{evaluate:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var i=s.evaluate.apply(void 0,t),n=l.evaluate.apply(void 0,t);if(void 0!==i&&void 0!==n)return c(i,n,o)}}:c(s,l,o)}function ji(t,e,i){return"color"===e.type?i=te.parse(i):"formatted"===e.type?i=ne.fromString(i.toString()):"resolvedImage"===e.type?i=re.fromString(i.toString()):Bi(i)===e.type||"enum"===e.type&&e.values[i]||(i=void 0),Ni(i,t.default,e.default)}ve.register(Mi,{error:[{kind:"error"},[Nt],function(t,e){throw new ue(e[0].evaluate(t))}],typeof:[Nt,[jt],function(t,e){return Zt(se(e[0].evaluate(t)))}],"to-rgba":[Wt(Ft,4),[$t],function(t,e){return e[0].evaluate(t).toArray()}],rgb:[$t,[Ft,Ft,Ft],Ci],rgba:[$t,[Ft,Ft,Ft,Ft],Ci],has:{type:Ut,overloads:[[[Nt],function(t,e){return Ii(e[0].evaluate(t),t.properties())}],[[Nt,Vt],function(t,e){var i=e[1];return Ii(e[0].evaluate(t),i.evaluate(t))}]]},get:{type:jt,overloads:[[[Nt],function(t,e){return Ai(e[0].evaluate(t),t.properties())}],[[Nt,Vt],function(t,e){var i=e[1];return Ai(e[0].evaluate(t),i.evaluate(t))}]]},"feature-state":[jt,[Nt],function(t,e){return Ai(e[0].evaluate(t),t.featureState||{})}],properties:[Vt,[],function(t){return t.properties()}],"geometry-type":[Nt,[],function(t){return t.geometryType()}],id:[jt,[],function(t){return t.id()}],zoom:[Ft,[],function(t){return t.globals.zoom}],"heatmap-density":[Ft,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Ft,[],function(t){return t.globals.lineProgress||0}],accumulated:[jt,[],function(t){return void 0===t.globals.accumulated?null:t.globals.accumulated}],"+":[Ft,ki(Ft),function(t,e){for(var i=0,n=0,r=e;n<r.length;n+=1)i+=r[n].evaluate(t);return i}],"*":[Ft,ki(Ft),function(t,e){for(var i=1,n=0,r=e;n<r.length;n+=1)i*=r[n].evaluate(t);return i}],"-":{type:Ft,overloads:[[[Ft,Ft],function(t,e){var i=e[1];return e[0].evaluate(t)-i.evaluate(t)}],[[Ft],function(t,e){return-e[0].evaluate(t)}]]},"/":[Ft,[Ft,Ft],function(t,e){var i=e[1];return e[0].evaluate(t)/i.evaluate(t)}],"%":[Ft,[Ft,Ft],function(t,e){var i=e[1];return e[0].evaluate(t)%i.evaluate(t)}],ln2:[Ft,[],function(){return Math.LN2}],pi:[Ft,[],function(){return Math.PI}],e:[Ft,[],function(){return Math.E}],"^":[Ft,[Ft,Ft],function(t,e){var i=e[1];return Math.pow(e[0].evaluate(t),i.evaluate(t))}],sqrt:[Ft,[Ft],function(t,e){return Math.sqrt(e[0].evaluate(t))}],log10:[Ft,[Ft],function(t,e){return Math.log(e[0].evaluate(t))/Math.LN10}],ln:[Ft,[Ft],function(t,e){return Math.log(e[0].evaluate(t))}],log2:[Ft,[Ft],function(t,e){return Math.log(e[0].evaluate(t))/Math.LN2}],sin:[Ft,[Ft],function(t,e){return Math.sin(e[0].evaluate(t))}],cos:[Ft,[Ft],function(t,e){return Math.cos(e[0].evaluate(t))}],tan:[Ft,[Ft],function(t,e){return Math.tan(e[0].evaluate(t))}],asin:[Ft,[Ft],function(t,e){return Math.asin(e[0].evaluate(t))}],acos:[Ft,[Ft],function(t,e){return Math.acos(e[0].evaluate(t))}],atan:[Ft,[Ft],function(t,e){return Math.atan(e[0].evaluate(t))}],min:[Ft,ki(Ft),function(t,e){return Math.min.apply(Math,e.map((function(e){return e.evaluate(t)})))}],max:[Ft,ki(Ft),function(t,e){return Math.max.apply(Math,e.map((function(e){return e.evaluate(t)})))}],abs:[Ft,[Ft],function(t,e){return Math.abs(e[0].evaluate(t))}],round:[Ft,[Ft],function(t,e){var i=e[0].evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[Ft,[Ft],function(t,e){return Math.floor(e[0].evaluate(t))}],ceil:[Ft,[Ft],function(t,e){return Math.ceil(e[0].evaluate(t))}],"filter-==":[Ut,[Nt,jt],function(t,e){var i=e[0],n=e[1];return t.properties()[i.value]===n.value}],"filter-id-==":[Ut,[jt],function(t,e){var i=e[0];return t.id()===i.value}],"filter-type-==":[Ut,[Nt],function(t,e){var i=e[0];return t.geometryType()===i.value}],"filter-<":[Ut,[Nt,jt],function(t,e){var i=e[0],n=e[1],r=t.properties()[i.value],a=n.value;return typeof r==typeof a&&r<a}],"filter-id-<":[Ut,[jt],function(t,e){var i=e[0],n=t.id(),r=i.value;return typeof n==typeof r&&n<r}],"filter->":[Ut,[Nt,jt],function(t,e){var i=e[0],n=e[1],r=t.properties()[i.value],a=n.value;return typeof r==typeof a&&r>a}],"filter-id->":[Ut,[jt],function(t,e){var i=e[0],n=t.id(),r=i.value;return typeof n==typeof r&&n>r}],"filter-<=":[Ut,[Nt,jt],function(t,e){var i=e[0],n=e[1],r=t.properties()[i.value],a=n.value;return typeof r==typeof a&&r<=a}],"filter-id-<=":[Ut,[jt],function(t,e){var i=e[0],n=t.id(),r=i.value;return typeof n==typeof r&&n<=r}],"filter->=":[Ut,[Nt,jt],function(t,e){var i=e[0],n=e[1],r=t.properties()[i.value],a=n.value;return typeof r==typeof a&&r>=a}],"filter-id->=":[Ut,[jt],function(t,e){var i=e[0],n=t.id(),r=i.value;return typeof n==typeof r&&n>=r}],"filter-has":[Ut,[jt],function(t,e){return e[0].value in t.properties()}],"filter-has-id":[Ut,[],function(t){return null!==t.id()&&void 0!==t.id()}],"filter-type-in":[Ut,[Wt(Nt)],function(t,e){return e[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[Ut,[Wt(jt)],function(t,e){return e[0].value.indexOf(t.id())>=0}],"filter-in-small":[Ut,[Nt,Wt(jt)],function(t,e){var i=e[0];return e[1].value.indexOf(t.properties()[i.value])>=0}],"filter-in-large":[Ut,[Nt,Wt(jt)],function(t,e){var i=e[0],n=e[1];return function(t,e,i,n){for(;i<=n;){var r=i+n>>1;if(e[r]===t)return!0;e[r]>t?n=r-1:i=r+1}return!1}(t.properties()[i.value],n.value,0,n.value.length-1)}],all:{type:Ut,overloads:[[[Ut,Ut],function(t,e){var i=e[1];return e[0].evaluate(t)&&i.evaluate(t)}],[ki(Ut),function(t,e){for(var i=0,n=e;i<n.length;i+=1)if(!n[i].evaluate(t))return!1;return!0}]]},any:{type:Ut,overloads:[[[Ut,Ut],function(t,e){var i=e[1];return e[0].evaluate(t)||i.evaluate(t)}],[ki(Ut),function(t,e){for(var i=0,n=e;i<n.length;i+=1)if(n[i].evaluate(t))return!0;return!1}]]},"!":[Ut,[Ut],function(t,e){return!e[0].evaluate(t)}],"is-supported-script":[Ut,[Nt],function(t,e){var i=t.globals&&t.globals.isSupportedScript;return!i||i(e[0].evaluate(t))}],upcase:[Nt,[Nt],function(t,e){return e[0].evaluate(t).toUpperCase()}],downcase:[Nt,[Nt],function(t,e){return e[0].evaluate(t).toLowerCase()}],concat:[Nt,ki(jt),function(t,e){return e.map((function(e){return le(e.evaluate(t))})).join("")}],"resolved-locale":[Nt,[qt],function(t,e){return e[0].evaluate(t).resolvedLocale()}]});var qi=function(t,e){this.expression=t,this._warningHistory={},this._evaluator=new ye,this._defaultValue=e?function(t){return"color"===t.type&&Oi(t.default)?new te(0,0,0,0):"color"===t.type?te.parse(t.default)||null:void 0===t.default?null:t.default}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null};function Gi(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Mi}function Hi(t,e){var i=new $e(Mi,[],e?function(t){var e={color:$t,string:Nt,number:Ft,enum:Nt,boolean:Ut,formatted:Gt,resolvedImage:Ht};return"array"===t.type?Wt(e[t.value]||jt,t.length):e[t.type]}(e):void 0),n=i.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return n?Ri(new qi(n,e)):zi(i.errors)}qi.prototype.evaluateWithoutErrorHandling=function(t,e,i,n,r,a){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=i,this._evaluator.canonical=n,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=a,this.expression.evaluate(this._evaluator)},qi.prototype.evaluate=function(t,e,i,n,r,a){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=i||null,this._evaluator.canonical=n,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=a||null;try{var o=this.expression.evaluate(this._evaluator);if(null==o||"number"==typeof o&&o!=o)return this._defaultValue;if(this._enumValues&&!(o in this._enumValues))throw new ue("Expected value to be one of "+Object.keys(this._enumValues).map((function(t){return JSON.stringify(t)})).join(", ")+", but found "+JSON.stringify(o)+" instead.");return o}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}};var Wi=function(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!Fe(e.expression)};Wi.prototype.evaluateWithoutErrorHandling=function(t,e,i,n,r,a){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i,n,r,a)},Wi.prototype.evaluate=function(t,e,i,n,r,a){return this._styleExpression.evaluate(t,e,i,n,r,a)};var Zi=function(t,e,i,n){this.kind=t,this.zoomStops=i,this._styleExpression=e,this.isStateDependent="camera"!==t&&!Fe(e.expression),this.interpolationType=n};function Yi(t,e){if("error"===(t=Hi(t,e)).result)return t;var i=t.value.expression,n=Oe(i);if(!n&&!Pi(e))return zi([new Lt("","data expressions not supported")]);var r=Ne(i,["zoom"]);if(!r&&!Di(e))return zi([new Lt("","zoom expressions not supported")]);var a=function t(e){var i=null;if(e instanceof li)i=t(e.result);else if(e instanceof si)for(var n=0,r=e.args;n<r.length&&!(i=t(r[n]));n+=1);else(e instanceof je||e instanceof ai)&&e.input instanceof ve&&"zoom"===e.input.name&&(i=e);return i instanceof Lt||e.eachChild((function(e){var n=t(e);n instanceof Lt?i=n:!i&&n?i=new Lt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&n&&i!==n&&(i=new Lt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),i}(i);return a||r?a instanceof Lt?zi([a]):a instanceof ai&&!Li(e)?zi([new Lt("",'"interpolate" expressions cannot be used with this property')]):Ri(a?new Zi(n?"camera":"composite",t.value,a.labels,a instanceof ai?a.interpolation:void 0):new Wi(n?"constant":"source",t.value)):zi([new Lt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Zi.prototype.evaluateWithoutErrorHandling=function(t,e,i,n,r,a){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i,n,r,a)},Zi.prototype.evaluate=function(t,e,i,n,r,a){return this._styleExpression.evaluate(t,e,i,n,r,a)},Zi.prototype.interpolationFactor=function(t,e,i){return this.interpolationType?ai.interpolationFactor(this.interpolationType,t,e,i):0};var Xi=function(t,e){this._parameters=t,this._specification=e,zt(this,function t(e,i){var n,r,a,o="color"===i.type,s=e.stops&&"object"==typeof e.stops[0][0],l=s||!(s||void 0!==e.property),c=e.type||(Li(i)?"exponential":"interval");if(o&&((e=zt({},e)).stops&&(e.stops=e.stops.map((function(t){return[t[0],te.parse(t[1])]}))),e.default=te.parse(e.default?e.default:i.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!ri[e.colorSpace])throw new Error("Unknown color space: "+e.colorSpace);if("exponential"===c)n=Vi;else if("interval"===c)n=$i;else if("categorical"===c){n=Ui,r=Object.create(null);for(var u=0,h=e.stops;u<h.length;u+=1){var p=h[u];r[p[0]]=p[1]}a=typeof e.stops[0][0]}else{if("identity"!==c)throw new Error('Unknown function type "'+c+'"');n=ji}if(s){for(var d={},f=[],m=0;m<e.stops.length;m++){var g=e.stops[m],_=g[0].zoom;void 0===d[_]&&(d[_]={zoom:_,type:e.type,property:e.property,default:e.default,stops:[]},f.push(_)),d[_].stops.push([g[0].value,g[1]])}for(var y=[],v=0,x=f;v<x.length;v+=1){var b=x[v];y.push([d[b].zoom,t(d[b],i)])}var w={name:"linear"};return{kind:"composite",interpolationType:w,interpolationFactor:ai.interpolationFactor.bind(void 0,w),zoomStops:y.map((function(t){return t[0]})),evaluate:function(t,n){var r=t.zoom;return Vi({stops:y,base:e.base},i,r).evaluate(r,n)}}}if(l){var S="exponential"===c?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:ai.interpolationFactor.bind(void 0,S),zoomStops:e.stops.map((function(t){return t[0]})),evaluate:function(t){return n(e,i,t.zoom,r,a)}}}return{kind:"source",evaluate:function(t,o){var s=o&&o.properties?o.properties[e.property]:void 0;return void 0===s?Ni(e.default,i.default):n(e,i,s,r,a)}}}(this._parameters,this._specification))};function Ki(t){var e=t.key,i=t.value,n=t.valueSpec||{},r=t.objectElementValidators||{},a=t.style,o=t.styleSpec,s=[],l=Bi(i);if("object"!==l)return[new kt(e,i,"object expected, "+l+" found")];for(var c in i){var u=c.split(".")[0],h=n[u]||n["*"],p=void 0;if(r[u])p=r[u];else if(n[u])p=Sn;else if(r["*"])p=r["*"];else{if(!n["*"]){s.push(new kt(e,i[c],'unknown property "'+c+'"'));continue}p=Sn}s=s.concat(p({key:(e?e+".":e)+c,value:i[c],valueSpec:h,style:a,styleSpec:o,object:i,objectKey:c},i))}for(var d in n)r[d]||n[d].required&&void 0===n[d].default&&void 0===i[d]&&s.push(new kt(e,i,'missing required property "'+d+'"'));return s}function Ji(t){var e=t.value,i=t.valueSpec,n=t.style,r=t.styleSpec,a=t.key,o=t.arrayElementValidator||Sn;if("array"!==Bi(e))return[new kt(a,e,"array expected, "+Bi(e)+" found")];if(i.length&&e.length!==i.length)return[new kt(a,e,"array length "+i.length+" expected, length "+e.length+" found")];if(i["min-length"]&&e.length<i["min-length"])return[new kt(a,e,"array length at least "+i["min-length"]+" expected, length "+e.length+" found")];var s={type:i.value,values:i.values};r.$version<7&&(s.function=i.function),"object"===Bi(i.value)&&(s=i.value);for(var l=[],c=0;c<e.length;c++)l=l.concat(o({array:e,arrayIndex:c,value:e[c],valueSpec:s,style:n,styleSpec:r,key:a+"["+c+"]"}));return l}function Qi(t){var e=t.key,i=t.value,n=t.valueSpec,r=Bi(i);return"number"===r&&i!=i&&(r="NaN"),"number"!==r?[new kt(e,i,"number expected, "+r+" found")]:"minimum"in n&&i<n.minimum?[new kt(e,i,i+" is less than the minimum value "+n.minimum)]:"maximum"in n&&i>n.maximum?[new kt(e,i,i+" is greater than the maximum value "+n.maximum)]:[]}function tn(t){var e,i,n,r=t.valueSpec,a=Pt(t.value.type),o={},s="categorical"!==a&&void 0===t.value.property,l=!s,c="array"===Bi(t.value.stops)&&"array"===Bi(t.value.stops[0])&&"object"===Bi(t.value.stops[0][0]),u=Ki({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===a)return[new kt(t.key,t.value,'identity function may not have a "stops" property')];var e=[],i=t.value;return e=e.concat(Ji({key:t.key,value:i,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===Bi(i)&&0===i.length&&e.push(new kt(t.key,i,"array must have at least one stop")),e},default:function(t){return Sn({key:t.key,value:t.value,valueSpec:r,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===a&&s&&u.push(new kt(t.key,t.value,'missing required property "property"')),"identity"===a||t.value.stops||u.push(new kt(t.key,t.value,'missing required property "stops"')),"exponential"===a&&t.valueSpec.expression&&!Li(t.valueSpec)&&u.push(new kt(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(l&&!Pi(t.valueSpec)?u.push(new kt(t.key,t.value,"property functions not supported")):s&&!Di(t.valueSpec)&&u.push(new kt(t.key,t.value,"zoom functions not supported"))),"categorical"!==a&&!c||void 0!==t.value.property||u.push(new kt(t.key,t.value,'"property" property is required')),u;function h(t){var e=[],a=t.value,s=t.key;if("array"!==Bi(a))return[new kt(s,a,"array expected, "+Bi(a)+" found")];if(2!==a.length)return[new kt(s,a,"array length 2 expected, length "+a.length+" found")];if(c){if("object"!==Bi(a[0]))return[new kt(s,a,"object expected, "+Bi(a[0])+" found")];if(void 0===a[0].zoom)return[new kt(s,a,"object stop key must have zoom")];if(void 0===a[0].value)return[new kt(s,a,"object stop key must have value")];if(n&&n>Pt(a[0].zoom))return[new kt(s,a[0].zoom,"stop zoom values must appear in ascending order")];Pt(a[0].zoom)!==n&&(n=Pt(a[0].zoom),i=void 0,o={}),e=e.concat(Ki({key:s+"[0]",value:a[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:Qi,value:p}}))}else e=e.concat(p({key:s+"[0]",value:a[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},a));return Gi(Dt(a[1]))?e.concat([new kt(s+"[1]",a[1],"expressions are not allowed in function stops.")]):e.concat(Sn({key:s+"[1]",value:a[1],valueSpec:r,style:t.style,styleSpec:t.styleSpec}))}function p(t,n){var s=Bi(t.value),l=Pt(t.value),c=null!==t.value?t.value:n;if(e){if(s!==e)return[new kt(t.key,c,s+" stop domain type must match previous stop domain type "+e)]}else e=s;if("number"!==s&&"string"!==s&&"boolean"!==s)return[new kt(t.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==a){var u="number expected, "+s+" found";return Pi(r)&&void 0===a&&(u+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new kt(t.key,c,u)]}return"categorical"!==a||"number"!==s||isFinite(l)&&Math.floor(l)===l?"categorical"!==a&&"number"===s&&void 0!==i&&l<i?[new kt(t.key,c,"stop domain values must appear in ascending order")]:(i=l,"categorical"===a&&l in o?[new kt(t.key,c,"stop domain values must be unique")]:(o[l]=!0,[])):[new kt(t.key,c,"integer expected, found "+l)]}}function en(t){var e=("property"===t.expressionContext?Yi:Hi)(Dt(t.value),t.valueSpec);if("error"===e.result)return e.value.map((function(e){return new kt(""+t.key+e.key,t.value,e.message)}));var i=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!i.outputDefined())return[new kt(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Fe(i))return[new kt(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!Fe(i))return[new kt(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!Ne(i,["zoom","feature-state"]))return[new kt(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!Oe(i))return[new kt(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function nn(t){var e=t.key,i=t.value,n=t.valueSpec,r=[];return Array.isArray(n.values)?-1===n.values.indexOf(Pt(i))&&r.push(new kt(e,i,"expected one of ["+n.values.join(", ")+"], "+JSON.stringify(i)+" found")):-1===Object.keys(n.values).indexOf(Pt(i))&&r.push(new kt(e,i,"expected one of ["+Object.keys(n.values).join(", ")+"], "+JSON.stringify(i)+" found")),r}function rn(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var e=0,i=t.slice(1);e<i.length;e+=1){var n=i[e];if(!rn(n)&&"boolean"!=typeof n)return!1}return!0;default:return!0}}Xi.deserialize=function(t){return new Xi(t._parameters,t._specification)},Xi.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var an={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function on(t){if(null==t)return{filter:function(){return!0},needGeometry:!1};rn(t)||(t=ln(t));var e=Hi(t,an);if("error"===e.result)throw new Error(e.value.map((function(t){return t.key+": "+t.message})).join(", "));return{filter:function(t,i,n){return e.value.evaluate(t,i,{},n)},needGeometry:function t(e){if(!Array.isArray(e))return!1;if("within"===e[0])return!0;for(var i=1;i<e.length;i++)if(t(e[i]))return!0;return!1}(t)}}function sn(t,e){return t<e?-1:t>e?1:0}function ln(t){if(!t)return!0;var e,i=t[0];return t.length<=1?"any"!==i:"=="===i?cn(t[1],t[2],"=="):"!="===i?pn(cn(t[1],t[2],"==")):"<"===i||">"===i||"<="===i||">="===i?cn(t[1],t[2],i):"any"===i?(e=t.slice(1),["any"].concat(e.map(ln))):"all"===i?["all"].concat(t.slice(1).map(ln)):"none"===i?["all"].concat(t.slice(1).map(ln).map(pn)):"in"===i?un(t[1],t.slice(2)):"!in"===i?pn(un(t[1],t.slice(2))):"has"===i?hn(t[1]):"!has"===i?pn(hn(t[1])):"within"!==i||t}function cn(t,e,i){switch(t){case"$type":return["filter-type-"+i,e];case"$id":return["filter-id-"+i,e];default:return["filter-"+i,t,e]}}function un(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((function(t){return typeof t!=typeof e[0]}))?["filter-in-large",t,["literal",e.sort(sn)]]:["filter-in-small",t,["literal",e]]}}function hn(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function pn(t){return["!",t]}function dn(t){return rn(Dt(t.value))?en(zt({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(e){var i=e.value,n=e.key;if("array"!==Bi(i))return[new kt(n,i,"array expected, "+Bi(i)+" found")];var r,a=e.styleSpec,o=[];if(i.length<1)return[new kt(n,i,"filter array must have at least 1 element")];switch(o=o.concat(nn({key:n+"[0]",value:i[0],valueSpec:a.filter_operator,style:e.style,styleSpec:e.styleSpec})),Pt(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&"$type"===Pt(i[1])&&o.push(new kt(n,i,'"$type" cannot be use with operator "'+i[0]+'"'));case"==":case"!=":3!==i.length&&o.push(new kt(n,i,'filter array for operator "'+i[0]+'" must have 3 elements'));case"in":case"!in":i.length>=2&&"string"!==(r=Bi(i[1]))&&o.push(new kt(n+"[1]",i[1],"string expected, "+r+" found"));for(var s=2;s<i.length;s++)r=Bi(i[s]),"$type"===Pt(i[1])?o=o.concat(nn({key:n+"["+s+"]",value:i[s],valueSpec:a.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&o.push(new kt(n+"["+s+"]",i[s],"string, number, or boolean expected, "+r+" found"));break;case"any":case"all":case"none":for(var l=1;l<i.length;l++)o=o.concat(t({key:n+"["+l+"]",value:i[l],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":r=Bi(i[1]),2!==i.length?o.push(new kt(n,i,'filter array for "'+i[0]+'" operator must have 2 elements')):"string"!==r&&o.push(new kt(n+"[1]",i[1],"string expected, "+r+" found"));break;case"within":r=Bi(i[1]),2!==i.length?o.push(new kt(n,i,'filter array for "'+i[0]+'" operator must have 2 elements')):"object"!==r&&o.push(new kt(n+"[1]",i[1],"object expected, "+r+" found"))}return o}(t)}function fn(t,e){var i=t.key,n=t.style,r=t.styleSpec,a=t.value,o=t.objectKey,s=r[e+"_"+t.layerType];if(!s)return[];var l=o.match(/^(.*)-transition$/);if("paint"===e&&l&&s[l[1]]&&s[l[1]].transition)return Sn({key:i,value:a,valueSpec:r.transition,style:n,styleSpec:r});var c,u=t.valueSpec||s[o];if(!u)return[new kt(i,a,'unknown property "'+o+'"')];if("string"===Bi(a)&&Pi(u)&&!u.tokens&&(c=/^{([^}]+)}$/.exec(a)))return[new kt(i,a,'"'+o+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(c[1])+" }`.")];var h=[];return"symbol"===t.layerType&&("text-field"===o&&n&&!n.glyphs&&h.push(new kt(i,a,'use of "text-field" requires a style "glyphs" property')),"text-font"===o&&Oi(Dt(a))&&"identity"===Pt(a.type)&&h.push(new kt(i,a,'"text-font" does not support identity functions'))),h.concat(Sn({key:t.key,value:a,valueSpec:u,style:n,styleSpec:r,expressionContext:"property",propertyType:e,propertyKey:o}))}function mn(t){return fn(t,"paint")}function gn(t){return fn(t,"layout")}function _n(t){var e=[],i=t.value,n=t.key,r=t.style,a=t.styleSpec;i.type||i.ref||e.push(new kt(n,i,'either "type" or "ref" is required'));var o,s=Pt(i.type),l=Pt(i.ref);if(i.id)for(var c=Pt(i.id),u=0;u<t.arrayIndex;u++){var h=r.layers[u];Pt(h.id)===c&&e.push(new kt(n,i.id,'duplicate layer id "'+i.id+'", previously used at line '+h.id.__line__))}if("ref"in i)["type","source","source-layer","filter","layout"].forEach((function(t){t in i&&e.push(new kt(n,i[t],'"'+t+'" is prohibited for ref layers'))})),r.layers.forEach((function(t){Pt(t.id)===l&&(o=t)})),o?o.ref?e.push(new kt(n,i.ref,"ref cannot reference another ref layer")):s=Pt(o.type):e.push(new kt(n,i.ref,'ref layer "'+l+'" not found'));else if("background"!==s)if(i.source){var p=r.sources&&r.sources[i.source],d=p&&Pt(p.type);p?"vector"===d&&"raster"===s?e.push(new kt(n,i.source,'layer "'+i.id+'" requires a raster source')):"raster"===d&&"raster"!==s?e.push(new kt(n,i.source,'layer "'+i.id+'" requires a vector source')):"vector"!==d||i["source-layer"]?"raster-dem"===d&&"hillshade"!==s?e.push(new kt(n,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!i.paint||!i.paint["line-gradient"]||"geojson"===d&&p.lineMetrics||e.push(new kt(n,i,'layer "'+i.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):e.push(new kt(n,i,'layer "'+i.id+'" must specify a "source-layer"')):e.push(new kt(n,i.source,'source "'+i.source+'" not found'))}else e.push(new kt(n,i,'missing required property "source"'));return e=e.concat(Ki({key:n,value:i,valueSpec:a.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Sn({key:n+".type",value:i.type,valueSpec:a.layer.type,style:t.style,styleSpec:t.styleSpec,object:i,objectKey:"type"})},filter:dn,layout:function(t){return Ki({layer:i,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return gn(zt({layerType:s},t))}}})},paint:function(t){return Ki({layer:i,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return mn(zt({layerType:s},t))}}})}}}))}function yn(t){var e=t.value,i=t.key,n=Bi(e);return"string"!==n?[new kt(i,e,"string expected, "+n+" found")]:[]}var vn={promoteId:function(t){var e=t.key,i=t.value;if("string"===Bi(i))return yn({key:e,value:i});var n=[];for(var r in i)n.push.apply(n,yn({key:e+"."+r,value:i[r]}));return n}};function xn(t){var e=t.value,i=t.key,n=t.styleSpec,r=t.style;if(!e.type)return[new kt(i,e,'"type" is required')];var a,o=Pt(e.type);switch(o){case"vector":case"raster":case"raster-dem":return Ki({key:i,value:e,valueSpec:n["source_"+o.replace("-","_")],style:t.style,styleSpec:n,objectElementValidators:vn});case"geojson":if(a=Ki({key:i,value:e,valueSpec:n.source_geojson,style:r,styleSpec:n,objectElementValidators:vn}),e.cluster)for(var s in e.clusterProperties){var l=e.clusterProperties[s],c=l[0],u="string"==typeof c?[c,["accumulated"],["get",s]]:c;a.push.apply(a,en({key:i+"."+s+".map",value:l[1],expressionContext:"cluster-map"})),a.push.apply(a,en({key:i+"."+s+".reduce",value:u,expressionContext:"cluster-reduce"}))}return a;case"video":return Ki({key:i,value:e,valueSpec:n.source_video,style:r,styleSpec:n});case"image":return Ki({key:i,value:e,valueSpec:n.source_image,style:r,styleSpec:n});case"canvas":return[new kt(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return nn({key:i+".type",value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:r,styleSpec:n})}}function bn(t){var e=t.value,i=t.styleSpec,n=i.light,r=t.style,a=[],o=Bi(e);if(void 0===e)return a;if("object"!==o)return a.concat([new kt("light",e,"object expected, "+o+" found")]);for(var s in e){var l=s.match(/^(.*)-transition$/);a=a.concat(l&&n[l[1]]&&n[l[1]].transition?Sn({key:s,value:e[s],valueSpec:i.transition,style:r,styleSpec:i}):n[s]?Sn({key:s,value:e[s],valueSpec:n[s],style:r,styleSpec:i}):[new kt(s,e[s],'unknown property "'+s+'"')])}return a}var wn={"*":function(){return[]},array:Ji,boolean:function(t){var e=t.value,i=t.key,n=Bi(e);return"boolean"!==n?[new kt(i,e,"boolean expected, "+n+" found")]:[]},number:Qi,color:function(t){var e=t.key,i=t.value,n=Bi(i);return"string"!==n?[new kt(e,i,"color expected, "+n+" found")]:null===Qt(i)?[new kt(e,i,'color expected, "'+i+'" found')]:[]},constants:Rt,enum:nn,filter:dn,function:tn,layer:_n,object:Ki,source:xn,light:bn,string:yn,formatted:function(t){return 0===yn(t).length?[]:en(t)},resolvedImage:function(t){return 0===yn(t).length?[]:en(t)}};function Sn(t){var e=t.value,i=t.valueSpec,n=t.styleSpec;return i.expression&&Oi(Pt(e))?tn(t):i.expression&&Gi(Dt(e))?en(t):i.type&&wn[i.type]?wn[i.type](t):Ki(zt({},t,{valueSpec:i.type?n[i.type]:i}))}function En(t){var e=t.value,i=t.key,n=yn(t);return n.length||(-1===e.indexOf("{fontstack}")&&n.push(new kt(i,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&n.push(new kt(i,e,'"glyphs" url must include a "{range}" token'))),n}function Tn(t,e){void 0===e&&(e=At);var i=[];return i=i.concat(Sn({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:En,"*":function(){return[]}}})),t.constants&&(i=i.concat(Rt({key:"constants",value:t.constants,style:t,styleSpec:e}))),Mn(i)}function Mn(t){return[].concat(t).sort((function(t,e){return t.line-e.line}))}function Cn(t){return function(){for(var e=[],i=arguments.length;i--;)e[i]=arguments[i];return Mn(t.apply(this,e))}}Tn.source=Cn(xn),Tn.light=Cn(bn),Tn.layer=Cn(_n),Tn.filter=Cn(dn),Tn.paintProperty=Cn(mn),Tn.layoutProperty=Cn(gn);var In=Tn,An=In.light,kn=In.paintProperty,Rn=In.layoutProperty;function zn(t,e){var i=!1;if(e&&e.length)for(var n=0,r=e;n<r.length;n+=1)t.fire(new Ct(new Error(r[n].message))),i=!0;return i}var Pn=Dn;function Dn(t,e,i){var n=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var r=new Int32Array(this.arrayBuffer);t=r[0],this.d=(e=r[1])+2*(i=r[2]);for(var a=0;a<this.d*this.d;a++){var o=r[3+a],s=r[3+a+1];n.push(o===s?null:r.subarray(o,s))}var l=r[3+n.length+1];this.keys=r.subarray(r[3+n.length],l),this.bboxes=r.subarray(l),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var c=0;c<this.d*this.d;c++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var u=i/e*t;this.min=-u,this.max=t+u}Dn.prototype.insert=function(t,e,i,n,r){this._forEachCell(e,i,n,r,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(r)},Dn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Dn.prototype._insertCell=function(t,e,i,n,r,a){this.cells[r].push(a)},Dn.prototype.query=function(t,e,i,n,r){var a=this.min,o=this.max;if(t<=a&&e<=a&&o<=i&&o<=n&&!r)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(t,e,i,n,this._queryCell,s,{},r),s},Dn.prototype._queryCell=function(t,e,i,n,r,a,o,s){var l=this.cells[r];if(null!==l)for(var c=this.keys,u=this.bboxes,h=0;h<l.length;h++){var p=l[h];if(void 0===o[p]){var d=4*p;(s?s(u[d+0],u[d+1],u[d+2],u[d+3]):t<=u[d+2]&&e<=u[d+3]&&i>=u[d+0]&&n>=u[d+1])?(o[p]=!0,a.push(c[p])):o[p]=!1}}},Dn.prototype._forEachCell=function(t,e,i,n,r,a,o,s){for(var l=this._convertToCellCoord(t),c=this._convertToCellCoord(e),u=this._convertToCellCoord(i),h=this._convertToCellCoord(n),p=l;p<=u;p++)for(var d=c;d<=h;d++){var f=this.d*d+p;if((!s||s(this._convertFromCellCoord(p),this._convertFromCellCoord(d),this._convertFromCellCoord(p+1),this._convertFromCellCoord(d+1)))&&r.call(this,t,e,i,n,f,a,o,s))return}},Dn.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Dn.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Dn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,i=0,n=0;n<this.cells.length;n++)i+=this.cells[n].length;var r=new Int32Array(e+i+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;for(var a=e,o=0;o<t.length;o++){var s=t[o];r[3+o]=a,r.set(s,a),a+=s.length}return r[3+t.length]=a,r.set(this.keys,a),r[3+t.length+1]=a+=this.keys.length,r.set(this.bboxes,a),a+=this.bboxes.length,r.buffer};var Ln=o.ImageData,Bn=o.ImageBitmap,On={};function Fn(t,e,i){void 0===i&&(i={}),Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),On[t]={klass:e,omit:i.omit||[],shallow:i.shallow||[]}}for(var Nn in Fn("Object",Object),Pn.serialize=function(t,e){var i=t.toArrayBuffer();return e&&e.push(i),{buffer:i}},Pn.deserialize=function(t){return new Pn(t.buffer)},Fn("Grid",Pn),Fn("Color",te),Fn("Error",Error),Fn("ResolvedImage",re),Fn("StylePropertyFunction",Xi),Fn("StyleExpression",qi,{omit:["_evaluator"]}),Fn("ZoomDependentExpression",Zi),Fn("ZoomConstantExpression",Wi),Fn("CompoundExpression",ve,{omit:["_evaluate"]}),Mi)Mi[Nn]._classRegistryKey||Fn("Expression_"+Nn,Mi[Nn]);function Un(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function $n(t){return Bn&&t instanceof Bn}function Vn(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Un(t)||$n(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){var i=t;return e&&e.push(i.buffer),i}if(t instanceof Ln)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){for(var n=[],r=0,a=t;r<a.length;r+=1)n.push(Vn(a[r],e));return n}if("object"==typeof t){var o=t.constructor,s=o._classRegistryKey;if(!s)throw new Error("can't serialize object of unregistered class");var l=o.serialize?o.serialize(t,e):{};if(!o.serialize){for(var c in t)if(t.hasOwnProperty(c)&&!(On[s].omit.indexOf(c)>=0)){var u=t[c];l[c]=On[s].shallow.indexOf(c)>=0?u:Vn(u,e)}t instanceof Error&&(l.message=t.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(l.$name=s),l}throw new Error("can't serialize object of type "+typeof t)}function jn(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Un(t)||$n(t)||ArrayBuffer.isView(t)||t instanceof Ln)return t;if(Array.isArray(t))return t.map(jn);if("object"==typeof t){var e=t.$name||"Object",i=On[e].klass;if(!i)throw new Error("can't deserialize unregistered class "+e);if(i.deserialize)return i.deserialize(t);for(var n=Object.create(i.prototype),r=0,a=Object.keys(t);r<a.length;r+=1){var o=a[r];if("$name"!==o){var s=t[o];n[o]=On[e].shallow.indexOf(o)>=0?s:jn(s)}}return n}throw new Error("can't deserialize object of type "+typeof t)}var qn=function(){this.first=!0};qn.prototype.update=function(t,e){var i=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=i,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=i,!0):(this.lastFloorZoom>i?(this.lastIntegerZoom=i+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<i&&(this.lastIntegerZoom=i,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=i,!0))};var Gn={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function Hn(t){for(var e=0,i=t;e<i.length;e+=1)if(Wn(i[e].charCodeAt(0)))return!0;return!1}function Wn(t){return!(746!==t&&747!==t&&(t<4352||!(Gn["Bopomofo Extended"](t)||Gn.Bopomofo(t)||Gn["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Gn["CJK Compatibility Ideographs"](t)||Gn["CJK Compatibility"](t)||Gn["CJK Radicals Supplement"](t)||Gn["CJK Strokes"](t)||!(!Gn["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||Gn["CJK Unified Ideographs Extension A"](t)||Gn["CJK Unified Ideographs"](t)||Gn["Enclosed CJK Letters and Months"](t)||Gn["Hangul Compatibility Jamo"](t)||Gn["Hangul Jamo Extended-A"](t)||Gn["Hangul Jamo Extended-B"](t)||Gn["Hangul Jamo"](t)||Gn["Hangul Syllables"](t)||Gn.Hiragana(t)||Gn["Ideographic Description Characters"](t)||Gn.Kanbun(t)||Gn["Kangxi Radicals"](t)||Gn["Katakana Phonetic Extensions"](t)||Gn.Katakana(t)&&12540!==t||!(!Gn["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!Gn["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Gn["Unified Canadian Aboriginal Syllabics"](t)||Gn["Unified Canadian Aboriginal Syllabics Extended"](t)||Gn["Vertical Forms"](t)||Gn["Yijing Hexagram Symbols"](t)||Gn["Yi Syllables"](t)||Gn["Yi Radicals"](t))))}function Zn(t){return!(Wn(t)||function(t){return!!(Gn["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||Gn["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||Gn["Letterlike Symbols"](t)||Gn["Number Forms"](t)||Gn["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||Gn["Control Pictures"](t)&&9251!==t||Gn["Optical Character Recognition"](t)||Gn["Enclosed Alphanumerics"](t)||Gn["Geometric Shapes"](t)||Gn["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Gn["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Gn["CJK Symbols and Punctuation"](t)||Gn.Katakana(t)||Gn["Private Use Area"](t)||Gn["CJK Compatibility Forms"](t)||Gn["Small Form Variants"](t)||Gn["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function Yn(t){return t>=1424&&t<=2303||Gn["Arabic Presentation Forms-A"](t)||Gn["Arabic Presentation Forms-B"](t)}function Xn(t,e){return!(!e&&Yn(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Gn.Khmer(t))}function Kn(t){for(var e=0,i=t;e<i.length;e+=1)if(Yn(i[e].charCodeAt(0)))return!0;return!1}var Jn=null,Qn="unavailable",tr=null,er=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(Qn="error"),Jn&&Jn(t)};function ir(){nr.fire(new Mt("pluginStateChange",{pluginStatus:Qn,pluginURL:tr}))}var nr=new It,rr=function(){return Qn},ar=function(){if("deferred"!==Qn||!tr)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Qn="loading",ir(),tr&&xt({url:tr},(function(t){t?er(t):(Qn="loaded",ir())}))},or={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return"loaded"===Qn||null!=or.applyArabicShaping},isLoading:function(){return"loading"===Qn},setState:function(t){Qn=t.pluginStatus,tr=t.pluginURL},isParsed:function(){return null!=or.applyArabicShaping&&null!=or.processBidirectionalText&&null!=or.processStyledBidirectionalText},getPluginURL:function(){return tr}},sr=function(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new qn,this.transition={})};sr.prototype.isSupportedScript=function(t){return function(t,e){for(var i=0,n=t;i<n.length;i+=1)if(!Xn(n[i].charCodeAt(0),e))return!1;return!0}(t,or.isLoaded())},sr.prototype.crossFadingFactor=function(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},sr.prototype.getCrossfadeParameters=function(){var t=this.zoom,e=t-Math.floor(t),i=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*i}:{fromScale:.5,toScale:1,t:1-(1-i)*e}};var lr=function(t,e){this.property=t,this.value=e,this.expression=function(t,e){if(Oi(t))return new Xi(t,e);if(Gi(t)){var i=Yi(t,e);if("error"===i.result)throw new Error(i.value.map((function(t){return t.key+": "+t.message})).join(", "));return i.value}var n=t;return"string"==typeof t&&"color"===e.type&&(n=te.parse(t)),{kind:"constant",evaluate:function(){return n}}}(void 0===e?t.specification.default:e,t.specification)};lr.prototype.isDataDriven=function(){return"source"===this.expression.kind||"composite"===this.expression.kind},lr.prototype.possiblyEvaluate=function(t,e,i){return this.property.possiblyEvaluate(this,t,e,i)};var cr=function(t){this.property=t,this.value=new lr(t,void 0)};cr.prototype.transitioned=function(t,e){return new hr(this.property,this.value,e,p({},t.transition,this.transition),t.now)},cr.prototype.untransitioned=function(){return new hr(this.property,this.value,null,{},0)};var ur=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};ur.prototype.getValue=function(t){return b(this._values[t].value.value)},ur.prototype.setValue=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new cr(this._values[t].property)),this._values[t].value=new lr(this._values[t].property,null===e?void 0:b(e))},ur.prototype.getTransition=function(t){return b(this._values[t].transition)},ur.prototype.setTransition=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new cr(this._values[t].property)),this._values[t].transition=b(e)||void 0},ur.prototype.serialize=function(){for(var t={},e=0,i=Object.keys(this._values);e<i.length;e+=1){var n=i[e],r=this.getValue(n);void 0!==r&&(t[n]=r);var a=this.getTransition(n);void 0!==a&&(t[n+"-transition"]=a)}return t},ur.prototype.transitioned=function(t,e){for(var i=new pr(this._properties),n=0,r=Object.keys(this._values);n<r.length;n+=1){var a=r[n];i._values[a]=this._values[a].transitioned(t,e._values[a])}return i},ur.prototype.untransitioned=function(){for(var t=new pr(this._properties),e=0,i=Object.keys(this._values);e<i.length;e+=1){var n=i[e];t._values[n]=this._values[n].untransitioned()}return t};var hr=function(t,e,i,n,r){this.property=t,this.value=e,this.begin=r+n.delay||0,this.end=this.begin+n.duration||0,t.specification.transition&&(n.delay||n.duration)&&(this.prior=i)};hr.prototype.possiblyEvaluate=function(t,e,i){var n=t.now||0,r=this.value.possiblyEvaluate(t,e,i),a=this.prior;if(a){if(n>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(n<this.begin)return a.possiblyEvaluate(t,e,i);var o=(n-this.begin)/(this.end-this.begin);return this.property.interpolate(a.possiblyEvaluate(t,e,i),r,function(t){if(t<=0)return 0;if(t>=1)return 1;var e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}(o))}return r};var pr=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};pr.prototype.possiblyEvaluate=function(t,e,i){for(var n=new mr(this._properties),r=0,a=Object.keys(this._values);r<a.length;r+=1){var o=a[r];n._values[o]=this._values[o].possiblyEvaluate(t,e,i)}return n},pr.prototype.hasTransition=function(){for(var t=0,e=Object.keys(this._values);t<e.length;t+=1)if(this._values[e[t]].prior)return!0;return!1};var dr=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};dr.prototype.getValue=function(t){return b(this._values[t].value)},dr.prototype.setValue=function(t,e){this._values[t]=new lr(this._values[t].property,null===e?void 0:b(e))},dr.prototype.serialize=function(){for(var t={},e=0,i=Object.keys(this._values);e<i.length;e+=1){var n=i[e],r=this.getValue(n);void 0!==r&&(t[n]=r)}return t},dr.prototype.possiblyEvaluate=function(t,e,i){for(var n=new mr(this._properties),r=0,a=Object.keys(this._values);r<a.length;r+=1){var o=a[r];n._values[o]=this._values[o].possiblyEvaluate(t,e,i)}return n};var fr=function(t,e,i){this.property=t,this.value=e,this.parameters=i};fr.prototype.isConstant=function(){return"constant"===this.value.kind},fr.prototype.constantOr=function(t){return"constant"===this.value.kind?this.value.value:t},fr.prototype.evaluate=function(t,e,i,n){return this.property.evaluate(this.value,this.parameters,t,e,i,n)};var mr=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};mr.prototype.get=function(t){return this._values[t]};var gr=function(t){this.specification=t};gr.prototype.possiblyEvaluate=function(t,e){return t.expression.evaluate(e)},gr.prototype.interpolate=function(t,e,i){var n=Ge[this.specification.type];return n?n(t,e,i):t};var _r=function(t,e){this.specification=t,this.overrides=e};_r.prototype.possiblyEvaluate=function(t,e,i,n){return new fr(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},i,n)}:t.expression,e)},_r.prototype.interpolate=function(t,e,i){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new fr(this,{kind:"constant",value:void 0},t.parameters);var n=Ge[this.specification.type];return n?new fr(this,{kind:"constant",value:n(t.value.value,e.value.value,i)},t.parameters):t},_r.prototype.evaluate=function(t,e,i,n,r,a){return"constant"===t.kind?t.value:t.evaluate(e,i,n,r,a)};var yr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.possiblyEvaluate=function(t,e,i,n){if(void 0===t.value)return new fr(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){var r=t.expression.evaluate(e,null,{},i,n),a="resolvedImage"===t.property.specification.type&&"string"!=typeof r?r.name:r,o=this._calculate(a,a,a,e);return new fr(this,{kind:"constant",value:o},e)}if("camera"===t.expression.kind){var s=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new fr(this,{kind:"constant",value:s},e)}return new fr(this,t.expression,e)},e.prototype.evaluate=function(t,e,i,n,r,a){if("source"===t.kind){var o=t.evaluate(e,i,n,r,a);return this._calculate(o,o,o,e)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},i,n),t.evaluate({zoom:Math.floor(e.zoom)},i,n),t.evaluate({zoom:Math.floor(e.zoom)+1},i,n),e):t.value},e.prototype._calculate=function(t,e,i,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:i,to:e}},e.prototype.interpolate=function(t){return t},e}(_r),vr=function(t){this.specification=t};vr.prototype.possiblyEvaluate=function(t,e,i,n){if(void 0!==t.value){if("constant"===t.expression.kind){var r=t.expression.evaluate(e,null,{},i,n);return this._calculate(r,r,r,e)}return this._calculate(t.expression.evaluate(new sr(Math.floor(e.zoom-1),e)),t.expression.evaluate(new sr(Math.floor(e.zoom),e)),t.expression.evaluate(new sr(Math.floor(e.zoom+1),e)),e)}},vr.prototype._calculate=function(t,e,i,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:i,to:e}},vr.prototype.interpolate=function(t){return t};var xr=function(t){this.specification=t};xr.prototype.possiblyEvaluate=function(t,e,i,n){return!!t.expression.evaluate(e,null,{},i,n)},xr.prototype.interpolate=function(){return!1};var br=function(t){for(var e in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var i=t[e];i.specification.overridable&&this.overridableProperties.push(e);var n=this.defaultPropertyValues[e]=new lr(i,void 0),r=this.defaultTransitionablePropertyValues[e]=new cr(i);this.defaultTransitioningPropertyValues[e]=r.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=n.possiblyEvaluate({})}};Fn("DataDrivenProperty",_r),Fn("DataConstantProperty",gr),Fn("CrossFadedDataDrivenProperty",yr),Fn("CrossFadedProperty",vr),Fn("ColorRampProperty",xr);var wr=function(t){function e(e,i){if(t.call(this),this.id=e.id,this.type=e.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},"custom"!==e.type&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new dr(i.layout)),i.paint)){for(var n in this._transitionablePaint=new ur(i.paint),e.paint)this.setPaintProperty(n,e.paint[n],{validate:!1});for(var r in e.layout)this.setLayoutProperty(r,e.layout[r],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new mr(i.paint)}}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},e.prototype.getLayoutProperty=function(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)},e.prototype.setLayoutProperty=function(t,e,i){void 0===i&&(i={}),null!=e&&this._validate(Rn,"layers."+this.id+".layout."+t,t,e,i)||("visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e)},e.prototype.getPaintProperty=function(t){return y(t,"-transition")?this._transitionablePaint.getTransition(t.slice(0,-"-transition".length)):this._transitionablePaint.getValue(t)},e.prototype.setPaintProperty=function(t,e,i){if(void 0===i&&(i={}),null!=e&&this._validate(kn,"layers."+this.id+".paint."+t,t,e,i))return!1;if(y(t,"-transition"))return this._transitionablePaint.setTransition(t.slice(0,-"-transition".length),e||void 0),!1;var n=this._transitionablePaint._values[t],r="cross-faded-data-driven"===n.property.specification["property-type"],a=n.value.isDataDriven(),o=n.value;this._transitionablePaint.setValue(t,e),this._handleSpecialPaintPropertyUpdate(t);var s=this._transitionablePaint._values[t].value;return s.isDataDriven()||a||r||this._handleOverridablePaintPropertyUpdate(t,o,s)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){},e.prototype._handleOverridablePaintPropertyUpdate=function(t,e,i){return!1},e.prototype.isHidden=function(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility},e.prototype.updateTransitions=function(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)},e.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},e.prototype.recalculate=function(t,e){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e)},e.prototype.serialize=function(){var t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),x(t,(function(t,e){return!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)}))},e.prototype._validate=function(t,e,i,n,r){return void 0===r&&(r={}),(!r||!1!==r.validate)&&zn(this,t.call(In,{key:e,layerType:this.type,objectKey:i,value:n,styleSpec:At,style:{glyphs:!0,sprite:!0}}))},e.prototype.is3D=function(){return!1},e.prototype.isTileClipped=function(){return!1},e.prototype.hasOffscreenPass=function(){return!1},e.prototype.resize=function(){},e.prototype.isStateDependent=function(){for(var t in this.paint._values){var e=this.paint.get(t);if(e instanceof fr&&Pi(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1},e}(It),Sr={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Er=function(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Tr=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Mr(t,e){void 0===e&&(e=1);var i=0,n=0;return{members:t.map((function(t){var r=Sr[t.type].BYTES_PER_ELEMENT,a=i=Cr(i,Math.max(e,r)),o=t.components||1;return n=Math.max(n,r),i+=r*o,{name:t.name,type:t.type,components:o,offset:a}})),size:Cr(i,Math.max(n,e)),alignment:e}}function Cr(t,e){return Math.ceil(t/e)*e}Tr.serialize=function(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},Tr.deserialize=function(t){var e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e},Tr.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Tr.prototype.clear=function(){this.length=0},Tr.prototype.resize=function(t){this.reserve(t),this.length=t},Tr.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}},Tr.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Ir=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var i=this.length;return this.resize(i+1),this.emplace(i,t,e)},e.prototype.emplace=function(t,e,i){var n=2*t;return this.int16[n+0]=e,this.int16[n+1]=i,t},e}(Tr);Ir.prototype.bytesPerElement=4,Fn("StructArrayLayout2i4",Ir);var Ar=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,n){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,i,n)},e.prototype.emplace=function(t,e,i,n,r){var a=4*t;return this.int16[a+0]=e,this.int16[a+1]=i,this.int16[a+2]=n,this.int16[a+3]=r,t},e}(Tr);Ar.prototype.bytesPerElement=8,Fn("StructArrayLayout4i8",Ar);var kr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,n,r,a){var o=this.length;return this.resize(o+1),this.emplace(o,t,e,i,n,r,a)},e.prototype.emplace=function(t,e,i,n,r,a,o){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=i,this.int16[s+2]=n,this.int16[s+3]=r,this.int16[s+4]=a,this.int16[s+5]=o,t},e}(Tr);kr.prototype.bytesPerElement=12,Fn("StructArrayLayout2i4i12",kr);var Rr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,n,r,a){var o=this.length;return this.resize(o+1),this.emplace(o,t,e,i,n,r,a)},e.prototype.emplace=function(t,e,i,n,r,a,o){var s=4*t,l=8*t;return this.int16[s+0]=e,this.int16[s+1]=i,this.uint8[l+4]=n,this.uint8[l+5]=r,this.uint8[l+6]=a,this.uint8[l+7]=o,t},e}(Tr);Rr.prototype.bytesPerElement=8,Fn("StructArrayLayout2i4ub8",Rr);var zr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var i=this.length;return this.resize(i+1),this.emplace(i,t,e)},e.prototype.emplace=function(t,e,i){var n=2*t;return this.float32[n+0]=e,this.float32[n+1]=i,t},e}(Tr);zr.prototype.bytesPerElement=8,Fn("StructArrayLayout2f8",zr);var Pr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,n,r,a,o,s,l,c){var u=this.length;return this.resize(u+1),this.emplace(u,t,e,i,n,r,a,o,s,l,c)},e.prototype.emplace=function(t,e,i,n,r,a,o,s,l,c,u){var h=10*t;return this.uint16[h+0]=e,this.uint16[h+1]=i,this.uint16[h+2]=n,this.uint16[h+3]=r,this.uint16[h+4]=a,this.uint16[h+5]=o,this.uint16[h+6]=s,this.uint16[h+7]=l,this.uint16[h+8]=c,this.uint16[h+9]=u,t},e}(Tr);Pr.prototype.bytesPerElement=20,Fn("StructArrayLayout10ui20",Pr);var Dr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,n,r,a,o,s,l,c,u,h){var p=this.length;return this.resize(p+1),this.emplace(p,t,e,i,n,r,a,o,s,l,c,u,h)},e.prototype.emplace=function(t,e,i,n,r,a,o,s,l,c,u,h,p){var d=12*t;return this.int16[d+0]=e,this.int16[d+1]=i,this.int16[d+2]=n,this.int16[d+3]=r,this.uint16[d+4]=a,this.uint16[d+5]=o,this.uint16[d+6]=s,this.uint16[d+7]=l,this.int16[d+8]=c,this.int16[d+9]=u,this.int16[d+10]=h,this.int16[d+11]=p,t},e}(Tr);Dr.prototype.bytesPerElement=24,Fn("StructArrayLayout4i4ui4i24",Dr);var Lr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,i)},e.prototype.emplace=function(t,e,i,n){var r=3*t;return this.float32[r+0]=e,this.float32[r+1]=i,this.float32[r+2]=n,t},e}(Tr);Lr.prototype.bytesPerElement=12,Fn("StructArrayLayout3f12",Lr);var Br=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.uint32[1*t+0]=e,t},e}(Tr);Br.prototype.bytesPerElement=4,Fn("StructArrayLayout1ul4",Br);var Or=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,n,r,a,o,s,l){var c=this.length;return this.resize(c+1),this.emplace(c,t,e,i,n,r,a,o,s,l)},e.prototype.emplace=function(t,e,i,n,r,a,o,s,l,c){var u=10*t,h=5*t;return this.int16[u+0]=e,this.int16[u+1]=i,this.int16[u+2]=n,this.int16[u+3]=r,this.int16[u+4]=a,this.int16[u+5]=o,this.uint32[h+3]=s,this.uint16[u+8]=l,this.uint16[u+9]=c,t},e}(Tr);Or.prototype.bytesPerElement=20,Fn("StructArrayLayout6i1ul2ui20",Or);var Fr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,n,r,a){var o=this.length;return this.resize(o+1),this.emplace(o,t,e,i,n,r,a)},e.prototype.emplace=function(t,e,i,n,r,a,o){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=i,this.int16[s+2]=n,this.int16[s+3]=r,this.int16[s+4]=a,this.int16[s+5]=o,t},e}(Tr);Fr.prototype.bytesPerElement=12,Fn("StructArrayLayout2i2i2i12",Fr);var Nr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,n,r){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,i,n,r)},e.prototype.emplace=function(t,e,i,n,r,a){var o=4*t,s=8*t;return this.float32[o+0]=e,this.float32[o+1]=i,this.float32[o+2]=n,this.int16[s+6]=r,this.int16[s+7]=a,t},e}(Tr);Nr.prototype.bytesPerElement=16,Fn("StructArrayLayout2f1f2i16",Nr);var Ur=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,n){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,i,n)},e.prototype.emplace=function(t,e,i,n,r){var a=12*t,o=3*t;return this.uint8[a+0]=e,this.uint8[a+1]=i,this.float32[o+1]=n,this.float32[o+2]=r,t},e}(Tr);Ur.prototype.bytesPerElement=12,Fn("StructArrayLayout2ub2f12",Ur);var $r=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,i)},e.prototype.emplace=function(t,e,i,n){var r=3*t;return this.uint16[r+0]=e,this.uint16[r+1]=i,this.uint16[r+2]=n,t},e}(Tr);$r.prototype.bytesPerElement=6,Fn("StructArrayLayout3ui6",$r);var Vr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,n,r,a,o,s,l,c,u,h,p,d,f,m,g){var _=this.length;return this.resize(_+1),this.emplace(_,t,e,i,n,r,a,o,s,l,c,u,h,p,d,f,m,g)},e.prototype.emplace=function(t,e,i,n,r,a,o,s,l,c,u,h,p,d,f,m,g,_){var y=24*t,v=12*t,x=48*t;return this.int16[y+0]=e,this.int16[y+1]=i,this.uint16[y+2]=n,this.uint16[y+3]=r,this.uint32[v+2]=a,this.uint32[v+3]=o,this.uint32[v+4]=s,this.uint16[y+10]=l,this.uint16[y+11]=c,this.uint16[y+12]=u,this.float32[v+7]=h,this.float32[v+8]=p,this.uint8[x+36]=d,this.uint8[x+37]=f,this.uint8[x+38]=m,this.uint32[v+10]=g,this.int16[y+22]=_,t},e}(Tr);Vr.prototype.bytesPerElement=48,Fn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Vr);var jr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,n,r,a,o,s,l,c,u,h,p,d,f,m,g,_,y,v,x,b,w,S,E,T,M,C){var I=this.length;return this.resize(I+1),this.emplace(I,t,e,i,n,r,a,o,s,l,c,u,h,p,d,f,m,g,_,y,v,x,b,w,S,E,T,M,C)},e.prototype.emplace=function(t,e,i,n,r,a,o,s,l,c,u,h,p,d,f,m,g,_,y,v,x,b,w,S,E,T,M,C,I){var A=34*t,k=17*t;return this.int16[A+0]=e,this.int16[A+1]=i,this.int16[A+2]=n,this.int16[A+3]=r,this.int16[A+4]=a,this.int16[A+5]=o,this.int16[A+6]=s,this.int16[A+7]=l,this.uint16[A+8]=c,this.uint16[A+9]=u,this.uint16[A+10]=h,this.uint16[A+11]=p,this.uint16[A+12]=d,this.uint16[A+13]=f,this.uint16[A+14]=m,this.uint16[A+15]=g,this.uint16[A+16]=_,this.uint16[A+17]=y,this.uint16[A+18]=v,this.uint16[A+19]=x,this.uint16[A+20]=b,this.uint16[A+21]=w,this.uint16[A+22]=S,this.uint32[k+12]=E,this.float32[k+13]=T,this.float32[k+14]=M,this.float32[k+15]=C,this.float32[k+16]=I,t},e}(Tr);jr.prototype.bytesPerElement=68,Fn("StructArrayLayout8i15ui1ul4f68",jr);var qr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.float32[1*t+0]=e,t},e}(Tr);qr.prototype.bytesPerElement=4,Fn("StructArrayLayout1f4",qr);var Gr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,i)},e.prototype.emplace=function(t,e,i,n){var r=3*t;return this.int16[r+0]=e,this.int16[r+1]=i,this.int16[r+2]=n,t},e}(Tr);Gr.prototype.bytesPerElement=6,Fn("StructArrayLayout3i6",Gr);var Hr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,i)},e.prototype.emplace=function(t,e,i,n){var r=4*t;return this.uint32[2*t+0]=e,this.uint16[r+2]=i,this.uint16[r+3]=n,t},e}(Tr);Hr.prototype.bytesPerElement=8,Fn("StructArrayLayout1ul2ui8",Hr);var Wr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var i=this.length;return this.resize(i+1),this.emplace(i,t,e)},e.prototype.emplace=function(t,e,i){var n=2*t;return this.uint16[n+0]=e,this.uint16[n+1]=i,t},e}(Tr);Wr.prototype.bytesPerElement=4,Fn("StructArrayLayout2ui4",Wr);var Zr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.uint16[1*t+0]=e,t},e}(Tr);Zr.prototype.bytesPerElement=2,Fn("StructArrayLayout1ui2",Zr);var Yr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,n){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,i,n)},e.prototype.emplace=function(t,e,i,n,r){var a=4*t;return this.float32[a+0]=e,this.float32[a+1]=i,this.float32[a+2]=n,this.float32[a+3]=r,t},e}(Tr);Yr.prototype.bytesPerElement=16,Fn("StructArrayLayout4f16",Yr);var Xr=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return i.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},i.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},i.x1.get=function(){return this._structArray.int16[this._pos2+2]},i.y1.get=function(){return this._structArray.int16[this._pos2+3]},i.x2.get=function(){return this._structArray.int16[this._pos2+4]},i.y2.get=function(){return this._structArray.int16[this._pos2+5]},i.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},i.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},i.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},i.anchorPoint.get=function(){return new r(this.anchorPointX,this.anchorPointY)},Object.defineProperties(e.prototype,i),e}(Er);Xr.prototype.size=20;var Kr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new Xr(this,t)},e}(Or);Fn("CollisionBoxArray",Kr);var Jr=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return i.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},i.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},i.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},i.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},i.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},i.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},i.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},i.segment.get=function(){return this._structArray.uint16[this._pos2+10]},i.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},i.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},i.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},i.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},i.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},i.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},i.placedOrientation.set=function(t){this._structArray.uint8[this._pos1+37]=t},i.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},i.hidden.set=function(t){this._structArray.uint8[this._pos1+38]=t},i.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},i.crossTileID.set=function(t){this._structArray.uint32[this._pos4+10]=t},i.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(e.prototype,i),e}(Er);Jr.prototype.size=48;var Qr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new Jr(this,t)},e}(Vr);Fn("PlacedSymbolArray",Qr);var ta=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return i.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},i.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},i.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},i.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},i.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},i.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},i.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},i.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},i.key.get=function(){return this._structArray.uint16[this._pos2+8]},i.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},i.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},i.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},i.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},i.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},i.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},i.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},i.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},i.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},i.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},i.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},i.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},i.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},i.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},i.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},i.crossTileID.set=function(t){this._structArray.uint32[this._pos4+12]=t},i.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},i.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},i.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},i.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(e.prototype,i),e}(Er);ta.prototype.size=68;var ea=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new ta(this,t)},e}(jr);Fn("SymbolInstanceArray",ea);var ia=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getoffsetX=function(t){return this.float32[1*t+0]},e}(qr);Fn("GlyphOffsetArray",ia);var na=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getx=function(t){return this.int16[3*t+0]},e.prototype.gety=function(t){return this.int16[3*t+1]},e.prototype.gettileUnitDistanceFromAnchor=function(t){return this.int16[3*t+2]},e}(Gr);Fn("SymbolLineVertexArray",na);var ra=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return i.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},i.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},i.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(e.prototype,i),e}(Er);ra.prototype.size=8;var aa=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new ra(this,t)},e}(Hr);Fn("FeatureIndexArray",aa);var oa=Mr([{name:"a_pos",components:2,type:"Int16"}],4).members,sa=function(t){void 0===t&&(t=[]),this.segments=t};function la(t,e){return 256*(t=u(Math.floor(t),0,255))+u(Math.floor(e),0,255)}sa.prototype.prepareSegment=function(t,e,i,n){var r=this.segments[this.segments.length-1];return t>sa.MAX_VERTEX_ARRAY_LENGTH&&S("Max vertices per segment is "+sa.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!r||r.vertexLength+t>sa.MAX_VERTEX_ARRAY_LENGTH||r.sortKey!==n)&&(r={vertexOffset:e.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0},void 0!==n&&(r.sortKey=n),this.segments.push(r)),r},sa.prototype.get=function(){return this.segments},sa.prototype.destroy=function(){for(var t=0,e=this.segments;t<e.length;t+=1){var i=e[t];for(var n in i.vaos)i.vaos[n].destroy()}},sa.simpleSegment=function(t,e,i,n){return new sa([{vertexOffset:t,primitiveOffset:e,vertexLength:i,primitiveLength:n,vaos:{},sortKey:0}])},sa.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Fn("SegmentVector",sa);var ca=Mr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),ua=e((function(t){t.exports=function(t,e){var i,n,r,a,o,s,l,c;for(n=t.length-(i=3&t.length),r=e,o=3432918353,s=461845907,c=0;c<n;)l=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24,++c,r=27492+(65535&(a=5*(65535&(r=(r^=l=(65535&(l=(l=(65535&l)*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(a>>>16)&65535)<<16);switch(l=0,i){case 3:l^=(255&t.charCodeAt(c+2))<<16;case 2:l^=(255&t.charCodeAt(c+1))<<8;case 1:r^=l=(65535&(l=(l=(65535&(l^=255&t.charCodeAt(c)))*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295}return r^=t.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0}})),ha=e((function(t){t.exports=function(t,e){for(var i,n=t.length,r=e^n,a=0;n>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(a)|(255&t.charCodeAt(++a))<<8|(255&t.charCodeAt(++a))<<16|(255&t.charCodeAt(++a))<<24))+((1540483477*(i>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),n-=4,++a;switch(n){case 3:r^=(255&t.charCodeAt(a+2))<<16;case 2:r^=(255&t.charCodeAt(a+1))<<8;case 1:r=1540483477*(65535&(r^=255&t.charCodeAt(a)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0}})),pa=ua,da=ha;pa.murmur3=ua,pa.murmur2=da;var fa=function(){this.ids=[],this.positions=[],this.indexed=!1};fa.prototype.add=function(t,e,i,n){this.ids.push(ga(t)),this.positions.push(e,i,n)},fa.prototype.getPositions=function(t){for(var e=ga(t),i=0,n=this.ids.length-1;i<n;){var r=i+n>>1;this.ids[r]>=e?n=r:i=r+1}for(var a=[];this.ids[i]===e;)a.push({index:this.positions[3*i],start:this.positions[3*i+1],end:this.positions[3*i+2]}),i++;return a},fa.serialize=function(t,e){var i=new Float64Array(t.ids),n=new Uint32Array(t.positions);return function t(e,i,n,r){for(;n<r;){for(var a=e[n+r>>1],o=n-1,s=r+1;;){do{o++}while(e[o]<a);do{s--}while(e[s]>a);if(o>=s)break;_a(e,o,s),_a(i,3*o,3*s),_a(i,3*o+1,3*s+1),_a(i,3*o+2,3*s+2)}s-n<r-s?(t(e,i,n,s),n=s+1):(t(e,i,s+1,r),r=s)}}(i,n,0,i.length-1),e&&e.push(i.buffer,n.buffer),{ids:i,positions:n}},fa.deserialize=function(t){var e=new fa;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e};var ma=Math.pow(2,53)-1;function ga(t){var e=+t;return!isNaN(e)&&e<=ma?e:pa(String(t))}function _a(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}Fn("FeaturePositionMap",fa);var ya=function(t,e){this.gl=t.gl,this.location=e},va=function(t){function e(e,i){t.call(this,e,i),this.current=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))},e}(ya),xa=function(t){function e(e,i){t.call(this,e,i),this.current=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))},e}(ya),ba=function(t){function e(e,i){t.call(this,e,i),this.current=[0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))},e}(ya),wa=function(t){function e(e,i){t.call(this,e,i),this.current=[0,0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))},e}(ya),Sa=function(t){function e(e,i){t.call(this,e,i),this.current=[0,0,0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))},e}(ya),Ea=function(t){function e(e,i){t.call(this,e,i),this.current=te.transparent}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))},e}(ya),Ta=new Float32Array(16),Ma=function(t){function e(e,i){t.call(this,e,i),this.current=Ta}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(var e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}},e}(ya);function Ca(t){return[la(255*t.r,255*t.g),la(255*t.b,255*t.a)]}var Ia=function(t,e,i){this.value=t,this.uniformNames=e.map((function(t){return"u_"+t})),this.type=i};Ia.prototype.setUniform=function(t,e,i){t.set(i.constantOr(this.value))},Ia.prototype.getBinding=function(t,e,i){return"color"===this.type?new Ea(t,e):new xa(t,e)};var Aa=function(t,e){this.uniformNames=e.map((function(t){return"u_"+t})),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Aa.prototype.setConstantPatternPositions=function(t,e){this.pixelRatioFrom=e.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=e.tlbr,this.patternTo=t.tlbr},Aa.prototype.setUniform=function(t,e,i,n){var r="u_pattern_to"===n?this.patternTo:"u_pattern_from"===n?this.patternFrom:"u_pixel_ratio_to"===n?this.pixelRatioTo:"u_pixel_ratio_from"===n?this.pixelRatioFrom:null;r&&t.set(r)},Aa.prototype.getBinding=function(t,e,i){return"u_pattern"===i.substr(0,9)?new Sa(t,e):new xa(t,e)};var ka=function(t,e,i,n){this.expression=t,this.type=i,this.maxValue=0,this.paintVertexAttributes=e.map((function(t){return{name:"a_"+t,type:"Float32",components:"color"===i?2:1,offset:0}})),this.paintVertexArray=new n};ka.prototype.populatePaintArray=function(t,e,i,n,r){var a=this.paintVertexArray.length,o=this.expression.evaluate(new sr(0),e,{},n,[],r);this.paintVertexArray.resize(t),this._setPaintValue(a,t,o)},ka.prototype.updatePaintArray=function(t,e,i,n){var r=this.expression.evaluate({zoom:0},i,n);this._setPaintValue(t,e,r)},ka.prototype._setPaintValue=function(t,e,i){if("color"===this.type)for(var n=Ca(i),r=t;r<e;r++)this.paintVertexArray.emplace(r,n[0],n[1]);else{for(var a=t;a<e;a++)this.paintVertexArray.emplace(a,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}},ka.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ka.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Ra=function(t,e,i,n,r,a){this.expression=t,this.uniformNames=e.map((function(t){return"u_"+t+"_t"})),this.type=i,this.useIntegerZoom=n,this.zoom=r,this.maxValue=0,this.paintVertexAttributes=e.map((function(t){return{name:"a_"+t,type:"Float32",components:"color"===i?4:2,offset:0}})),this.paintVertexArray=new a};Ra.prototype.populatePaintArray=function(t,e,i,n,r){var a=this.expression.evaluate(new sr(this.zoom),e,{},n,[],r),o=this.expression.evaluate(new sr(this.zoom+1),e,{},n,[],r),s=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(s,t,a,o)},Ra.prototype.updatePaintArray=function(t,e,i,n){var r=this.expression.evaluate({zoom:this.zoom},i,n),a=this.expression.evaluate({zoom:this.zoom+1},i,n);this._setPaintValue(t,e,r,a)},Ra.prototype._setPaintValue=function(t,e,i,n){if("color"===this.type)for(var r=Ca(i),a=Ca(n),o=t;o<e;o++)this.paintVertexArray.emplace(o,r[0],r[1],a[0],a[1]);else{for(var s=t;s<e;s++)this.paintVertexArray.emplace(s,i,n);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(n))}},Ra.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Ra.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Ra.prototype.setUniform=function(t,e){var i=this.useIntegerZoom?Math.floor(e.zoom):e.zoom,n=u(this.expression.interpolationFactor(i,this.zoom,this.zoom+1),0,1);t.set(n)},Ra.prototype.getBinding=function(t,e,i){return new xa(t,e)};var za=function(t,e,i,n,r,a){this.expression=t,this.type=e,this.useIntegerZoom=i,this.zoom=n,this.layerId=a,this.zoomInPaintVertexArray=new r,this.zoomOutPaintVertexArray=new r};za.prototype.populatePaintArray=function(t,e,i){var n=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(n,t,e.patterns&&e.patterns[this.layerId],i)},za.prototype.updatePaintArray=function(t,e,i,n,r){this._setPaintValues(t,e,i.patterns&&i.patterns[this.layerId],r)},za.prototype._setPaintValues=function(t,e,i,n){if(n&&i){var r=n[i.min],a=n[i.mid],o=n[i.max];if(r&&a&&o)for(var s=t;s<e;s++)this.zoomInPaintVertexArray.emplace(s,a.tl[0],a.tl[1],a.br[0],a.br[1],r.tl[0],r.tl[1],r.br[0],r.br[1],a.pixelRatio,r.pixelRatio),this.zoomOutPaintVertexArray.emplace(s,a.tl[0],a.tl[1],a.br[0],a.br[1],o.tl[0],o.tl[1],o.br[0],o.br[1],a.pixelRatio,o.pixelRatio)}},za.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,ca.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,ca.members,this.expression.isStateDependent))},za.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Pa=function(t,e,i){this.binders={},this._buffers=[];var n=[];for(var r in t.paint._values)if(i(r)){var a=t.paint.get(r);if(a instanceof fr&&Pi(a.property.specification)){var o=La(r,t.type),s=a.value,l=a.property.specification.type,c=a.property.useIntegerZoom,u=a.property.specification["property-type"],h="cross-faded"===u||"cross-faded-data-driven"===u;if("constant"===s.kind)this.binders[r]=h?new Aa(s.value,o):new Ia(s.value,o,l),n.push("/u_"+r);else if("source"===s.kind||h){var p=Ba(r,l,"source");this.binders[r]=h?new za(s,l,c,e,p,t.id):new ka(s,o,l,p),n.push("/a_"+r)}else{var d=Ba(r,l,"composite");this.binders[r]=new Ra(s,o,l,c,e,d),n.push("/z_"+r)}}}this.cacheKey=n.sort().join("")};Pa.prototype.getMaxValue=function(t){var e=this.binders[t];return e instanceof ka||e instanceof Ra?e.maxValue:0},Pa.prototype.populatePaintArrays=function(t,e,i,n,r){for(var a in this.binders){var o=this.binders[a];(o instanceof ka||o instanceof Ra||o instanceof za)&&o.populatePaintArray(t,e,i,n,r)}},Pa.prototype.setConstantPatternPositions=function(t,e){for(var i in this.binders){var n=this.binders[i];n instanceof Aa&&n.setConstantPatternPositions(t,e)}},Pa.prototype.updatePaintArrays=function(t,e,i,n,r){var a=!1;for(var o in t)for(var s=0,l=e.getPositions(o);s<l.length;s+=1){var c=l[s],u=i.feature(c.index);for(var h in this.binders){var p=this.binders[h];if((p instanceof ka||p instanceof Ra||p instanceof za)&&!0===p.expression.isStateDependent){var d=n.paint.get(h);p.expression=d.value,p.updatePaintArray(c.start,c.end,u,t[o],r),a=!0}}}return a},Pa.prototype.defines=function(){var t=[];for(var e in this.binders){var i=this.binders[e];(i instanceof Ia||i instanceof Aa)&&t.push.apply(t,i.uniformNames.map((function(t){return"#define HAS_UNIFORM_"+t})))}return t},Pa.prototype.getBinderAttributes=function(){var t=[];for(var e in this.binders){var i=this.binders[e];if(i instanceof ka||i instanceof Ra)for(var n=0;n<i.paintVertexAttributes.length;n++)t.push(i.paintVertexAttributes[n].name);else if(i instanceof za)for(var r=0;r<ca.members.length;r++)t.push(ca.members[r].name)}return t},Pa.prototype.getBinderUniforms=function(){var t=[];for(var e in this.binders){var i=this.binders[e];if(i instanceof Ia||i instanceof Aa||i instanceof Ra)for(var n=0,r=i.uniformNames;n<r.length;n+=1)t.push(r[n])}return t},Pa.prototype.getPaintVertexBuffers=function(){return this._buffers},Pa.prototype.getUniforms=function(t,e){var i=[];for(var n in this.binders){var r=this.binders[n];if(r instanceof Ia||r instanceof Aa||r instanceof Ra)for(var a=0,o=r.uniformNames;a<o.length;a+=1){var s=o[a];if(e[s]){var l=r.getBinding(t,e[s],s);i.push({name:s,property:n,binding:l})}}}return i},Pa.prototype.setUniforms=function(t,e,i,n){for(var r=0,a=e;r<a.length;r+=1){var o=a[r],s=o.name,l=o.property;this.binders[l].setUniform(o.binding,n,i.get(l),s)}},Pa.prototype.updatePaintBuffers=function(t){for(var e in this._buffers=[],this.binders){var i=this.binders[e];if(t&&i instanceof za){var n=2===t.fromScale?i.zoomInPaintVertexBuffer:i.zoomOutPaintVertexBuffer;n&&this._buffers.push(n)}else(i instanceof ka||i instanceof Ra)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}},Pa.prototype.upload=function(t){for(var e in this.binders){var i=this.binders[e];(i instanceof ka||i instanceof Ra||i instanceof za)&&i.upload(t)}this.updatePaintBuffers()},Pa.prototype.destroy=function(){for(var t in this.binders){var e=this.binders[t];(e instanceof ka||e instanceof Ra||e instanceof za)&&e.destroy()}};var Da=function(t,e,i){void 0===i&&(i=function(){return!0}),this.programConfigurations={};for(var n=0,r=t;n<r.length;n+=1){var a=r[n];this.programConfigurations[a.id]=new Pa(a,e,i)}this.needsUpload=!1,this._featureMap=new fa,this._bufferOffset=0};function La(t,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(e+"-","").replace(/-/g,"_")]}function Ba(t,e,i){var n={color:{source:zr,composite:Yr},number:{source:qr,composite:zr}},r=function(t){return{"line-pattern":{source:Pr,composite:Pr},"fill-pattern":{source:Pr,composite:Pr},"fill-extrusion-pattern":{source:Pr,composite:Pr}}[t]}(t);return r&&r[i]||n[e][i]}Da.prototype.populatePaintArrays=function(t,e,i,n,r,a){for(var o in this.programConfigurations)this.programConfigurations[o].populatePaintArrays(t,e,n,r,a);void 0!==e.id&&this._featureMap.add(e.id,i,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},Da.prototype.updatePaintArrays=function(t,e,i,n){for(var r=0,a=i;r<a.length;r+=1){var o=a[r];this.needsUpload=this.programConfigurations[o.id].updatePaintArrays(t,this._featureMap,e,o,n)||this.needsUpload}},Da.prototype.get=function(t){return this.programConfigurations[t]},Da.prototype.upload=function(t){if(this.needsUpload){for(var e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}},Da.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},Fn("ConstantBinder",Ia),Fn("CrossFadedConstantBinder",Aa),Fn("SourceExpressionBinder",ka),Fn("CrossFadedCompositeBinder",za),Fn("CompositeExpressionBinder",Ra),Fn("ProgramConfiguration",Pa,{omit:["_buffers"]}),Fn("ProgramConfigurationSet",Da);var Oa=Math.pow(2,14)-1,Fa=-Oa-1;function Na(t){for(var e=8192/t.extent,i=t.loadGeometry(),n=0;n<i.length;n++)for(var r=i[n],a=0;a<r.length;a++){var o=r[a],s=Math.round(o.x*e),l=Math.round(o.y*e);o.x=u(s,Fa,Oa),o.y=u(l,Fa,Oa),(s<o.x||s>o.x+1||l<o.y||l>o.y+1)&&S("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return i}function Ua(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Na(t):[]}}function $a(t,e,i,n,r){t.emplaceBack(2*e+(n+1)/2,2*i+(r+1)/2)}var Va=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ir,this.indexArray=new $r,this.segments=new sa,this.programConfigurations=new Da(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};function ja(t,e){for(var i=0;i<t.length;i++)if(Ja(e,t[i]))return!0;for(var n=0;n<e.length;n++)if(Ja(t,e[n]))return!0;return!!Wa(t,e)}function qa(t,e,i){return!!Ja(t,e)||!!Ya(e,t,i)}function Ga(t,e){if(1===t.length)return Ka(e,t[0]);for(var i=0;i<e.length;i++)for(var n=e[i],r=0;r<n.length;r++)if(Ja(t,n[r]))return!0;for(var a=0;a<t.length;a++)if(Ka(e,t[a]))return!0;for(var o=0;o<e.length;o++)if(Wa(t,e[o]))return!0;return!1}function Ha(t,e,i){if(t.length>1){if(Wa(t,e))return!0;for(var n=0;n<e.length;n++)if(Ya(e[n],t,i))return!0}for(var r=0;r<t.length;r++)if(Ya(t[r],e,i))return!0;return!1}function Wa(t,e){if(0===t.length||0===e.length)return!1;for(var i=0;i<t.length-1;i++)for(var n=t[i],r=t[i+1],a=0;a<e.length-1;a++)if(Za(n,r,e[a],e[a+1]))return!0;return!1}function Za(t,e,i,n){return E(t,i,n)!==E(e,i,n)&&E(t,e,i)!==E(t,e,n)}function Ya(t,e,i){var n=i*i;if(1===e.length)return t.distSqr(e[0])<n;for(var r=1;r<e.length;r++)if(Xa(t,e[r-1],e[r])<n)return!0;return!1}function Xa(t,e,i){var n=e.distSqr(i);if(0===n)return t.distSqr(e);var r=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/n;return t.distSqr(r<0?e:r>1?i:i.sub(e)._mult(r)._add(e))}function Ka(t,e){for(var i,n,r,a=!1,o=0;o<t.length;o++)for(var s=0,l=(i=t[o]).length-1;s<i.length;l=s++)(n=i[s]).y>e.y!=(r=i[l]).y>e.y&&e.x<(r.x-n.x)*(e.y-n.y)/(r.y-n.y)+n.x&&(a=!a);return a}function Ja(t,e){for(var i=!1,n=0,r=t.length-1;n<t.length;r=n++){var a=t[n],o=t[r];a.y>e.y!=o.y>e.y&&e.x<(o.x-a.x)*(e.y-a.y)/(o.y-a.y)+a.x&&(i=!i)}return i}function Qa(t,e,i){var n=i[0],r=i[2];if(t.x<n.x&&e.x<n.x||t.x>r.x&&e.x>r.x||t.y<n.y&&e.y<n.y||t.y>r.y&&e.y>r.y)return!1;var a=E(t,e,i[0]);return a!==E(t,e,i[1])||a!==E(t,e,i[2])||a!==E(t,e,i[3])}function to(t,e,i){var n=e.paint.get(t).value;return"constant"===n.kind?n.value:i.programConfigurations.get(e.id).getMaxValue(t)}function eo(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function io(t,e,i,n,a){if(!e[0]&&!e[1])return t;var o=r.convert(e)._mult(a);"viewport"===i&&o._rotate(-n);for(var s=[],l=0;l<t.length;l++)s.push(t[l].sub(o));return s}Va.prototype.populate=function(t,e,i){var n=this.layers[0],r=[],a=null;"circle"===n.type&&(a=n.layout.get("circle-sort-key"));for(var o=0,s=t;o<s.length;o+=1){var l=s[o],c=l.feature,u=l.id,h=l.index,p=l.sourceLayerIndex,d=this.layers[0]._featureFilter.needGeometry,f=Ua(c,d);if(this.layers[0]._featureFilter.filter(new sr(this.zoom),f,i)){var m=a?a.evaluate(f,{},i):void 0,g={id:u,properties:c.properties,type:c.type,sourceLayerIndex:p,index:h,geometry:d?f.geometry:Na(c),patterns:{},sortKey:m};r.push(g)}}a&&r.sort((function(t,e){return t.sortKey-e.sortKey}));for(var _=0,y=r;_<y.length;_+=1){var v=y[_],x=v.geometry,b=v.index,w=v.sourceLayerIndex,S=t[b].feature;this.addFeature(v,x,b,i),e.featureIndex.insert(S,x,b,w,this.index)}},Va.prototype.update=function(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)},Va.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Va.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Va.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,oa),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Va.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Va.prototype.addFeature=function(t,e,i,n){for(var r=0,a=e;r<a.length;r+=1)for(var o=0,s=a[r];o<s.length;o+=1){var l=s[o],c=l.x,u=l.y;if(!(c<0||c>=8192||u<0||u>=8192)){var h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),p=h.vertexLength;$a(this.layoutVertexArray,c,u,-1,-1),$a(this.layoutVertexArray,c,u,1,-1),$a(this.layoutVertexArray,c,u,1,1),$a(this.layoutVertexArray,c,u,-1,1),this.indexArray.emplaceBack(p,p+1,p+2),this.indexArray.emplaceBack(p,p+3,p+2),h.vertexLength+=4,h.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,{},n)},Fn("CircleBucket",Va,{omit:["layers"]});var no=new br({"circle-sort-key":new _r(At.layout_circle["circle-sort-key"])}),ro={paint:new br({"circle-radius":new _r(At.paint_circle["circle-radius"]),"circle-color":new _r(At.paint_circle["circle-color"]),"circle-blur":new _r(At.paint_circle["circle-blur"]),"circle-opacity":new _r(At.paint_circle["circle-opacity"]),"circle-translate":new gr(At.paint_circle["circle-translate"]),"circle-translate-anchor":new gr(At.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new gr(At.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new gr(At.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new _r(At.paint_circle["circle-stroke-width"]),"circle-stroke-color":new _r(At.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new _r(At.paint_circle["circle-stroke-opacity"])}),layout:no},ao="undefined"!=typeof Float32Array?Float32Array:Array;function oo(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function so(t,e,i){var n=e[0],r=e[1],a=e[2],o=e[3],s=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=e[9],d=e[10],f=e[11],m=e[12],g=e[13],_=e[14],y=e[15],v=i[0],x=i[1],b=i[2],w=i[3];return t[0]=v*n+x*s+b*h+w*m,t[1]=v*r+x*l+b*p+w*g,t[2]=v*a+x*c+b*d+w*_,t[3]=v*o+x*u+b*f+w*y,t[4]=(v=i[4])*n+(x=i[5])*s+(b=i[6])*h+(w=i[7])*m,t[5]=v*r+x*l+b*p+w*g,t[6]=v*a+x*c+b*d+w*_,t[7]=v*o+x*u+b*f+w*y,t[8]=(v=i[8])*n+(x=i[9])*s+(b=i[10])*h+(w=i[11])*m,t[9]=v*r+x*l+b*p+w*g,t[10]=v*a+x*c+b*d+w*_,t[11]=v*o+x*u+b*f+w*y,t[12]=(v=i[12])*n+(x=i[13])*s+(b=i[14])*h+(w=i[15])*m,t[13]=v*r+x*l+b*p+w*g,t[14]=v*a+x*c+b*d+w*_,t[15]=v*o+x*u+b*f+w*y,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,e=0,i=arguments.length;i--;)e+=t[i]*t[i];return Math.sqrt(e)});var lo,co=so;function uo(t,e,i){var n=e[0],r=e[1],a=e[2],o=e[3];return t[0]=i[0]*n+i[4]*r+i[8]*a+i[12]*o,t[1]=i[1]*n+i[5]*r+i[9]*a+i[13]*o,t[2]=i[2]*n+i[6]*r+i[10]*a+i[14]*o,t[3]=i[3]*n+i[7]*r+i[11]*a+i[15]*o,t}lo=new ao(3),ao!=Float32Array&&(lo[0]=0,lo[1]=0,lo[2]=0),function(){var t=new ao(4);ao!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var ho=(function(){var t=new ao(2);ao!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function e(e){t.call(this,e,ro)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new Va(t)},e.prototype.queryRadius=function(t){var e=t;return to("circle-radius",this,e)+to("circle-stroke-width",this,e)+eo(this.paint.get("circle-translate"))},e.prototype.queryIntersectsFeature=function(t,e,i,n,r,a,o,s){for(var l=io(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),a.angle,o),c=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i),u="map"===this.paint.get("circle-pitch-alignment"),h=u?l:function(t,e){return t.map((function(t){return po(t,e)}))}(l,s),p=u?c*o:c,d=0,f=n;d<f.length;d+=1)for(var m=0,g=f[d];m<g.length;m+=1){var _=g[m],y=u?_:po(_,s),v=p,x=uo([],[_.x,_.y,0,1],s);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?v*=x[3]/a.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(v*=a.cameraToCenterDistance/x[3]),qa(h,y,v))return!0}return!1},e}(wr));function po(t,e){var i=uo([],[t.x,t.y,0,1],e);return new r(i[0]/i[3],i[1]/i[3])}var fo=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Va);function mo(t,e,i,n){var r=e.width,a=e.height;if(n){if(n instanceof Uint8ClampedArray)n=new Uint8Array(n.buffer);else if(n.length!==r*a*i)throw new RangeError("mismatched image size")}else n=new Uint8Array(r*a*i);return t.width=r,t.height=a,t.data=n,t}function go(t,e,i){var n=e.width,r=e.height;if(n!==t.width||r!==t.height){var a=mo({},{width:n,height:r},i);_o(t,a,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,n),height:Math.min(t.height,r)},i),t.width=n,t.height=r,t.data=a.data}}function _o(t,e,i,n,r,a){if(0===r.width||0===r.height)return e;if(r.width>t.width||r.height>t.height||i.x>t.width-r.width||i.y>t.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>e.width||r.height>e.height||n.x>e.width-r.width||n.y>e.height-r.height)throw new RangeError("out of range destination coordinates for image copy");for(var o=t.data,s=e.data,l=0;l<r.height;l++)for(var c=((i.y+l)*t.width+i.x)*a,u=((n.y+l)*e.width+n.x)*a,h=0;h<r.width*a;h++)s[u+h]=o[c+h];return e}Fn("HeatmapBucket",fo,{omit:["layers"]});var yo=function(t,e){mo(this,t,1,e)};yo.prototype.resize=function(t){go(this,t,1)},yo.prototype.clone=function(){return new yo({width:this.width,height:this.height},new Uint8Array(this.data))},yo.copy=function(t,e,i,n,r){_o(t,e,i,n,r,1)};var vo=function(t,e){mo(this,t,4,e)};vo.prototype.resize=function(t){go(this,t,4)},vo.prototype.replace=function(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},vo.prototype.clone=function(){return new vo({width:this.width,height:this.height},new Uint8Array(this.data))},vo.copy=function(t,e,i,n,r){_o(t,e,i,n,r,4)},Fn("AlphaImage",yo),Fn("RGBAImage",vo);var xo={paint:new br({"heatmap-radius":new _r(At.paint_heatmap["heatmap-radius"]),"heatmap-weight":new _r(At.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new gr(At.paint_heatmap["heatmap-intensity"]),"heatmap-color":new xr(At.paint_heatmap["heatmap-color"]),"heatmap-opacity":new gr(At.paint_heatmap["heatmap-opacity"])})};function bo(t){var e={},i=t.resolution||256,n=t.clips?t.clips.length:1,r=t.image||new vo({width:i,height:n}),a=function(i,n,a){e[t.evaluationKey]=a;var o=t.expression.evaluate(e);r.data[i+n+0]=Math.floor(255*o.r/o.a),r.data[i+n+1]=Math.floor(255*o.g/o.a),r.data[i+n+2]=Math.floor(255*o.b/o.a),r.data[i+n+3]=Math.floor(255*o.a)};if(t.clips)for(var o=0,s=0;o<n;++o,s+=4*i)for(var l=0,c=0;l<i;l++,c+=4){var u=l/(i-1),h=t.clips[o];a(s,c,h.start*(1-u)+h.end*u)}else for(var p=0,d=0;p<i;p++,d+=4)a(0,d,p/(i-1));return r}var wo=function(t){function e(e){t.call(this,e,xo),this._updateColorRamp()}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new fo(t)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){"heatmap-color"===t&&this._updateColorRamp()},e.prototype._updateColorRamp=function(){this.colorRamp=bo({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},e.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility},e}(wr),So={paint:new br({"hillshade-illumination-direction":new gr(At.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new gr(At.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new gr(At.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new gr(At.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new gr(At.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new gr(At.paint_hillshade["hillshade-accent-color"])})},Eo=function(t){function e(e){t.call(this,e,So)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility},e}(wr),To=Mr([{name:"a_pos",components:2,type:"Int16"}],4).members,Mo=Io,Co=Io;function Io(t,e,i){i=i||2;var n,r,a,o,s,l,c,u=e&&e.length,h=u?e[0]*i:t.length,p=Ao(t,0,h,i,!0),d=[];if(!p||p.next===p.prev)return d;if(u&&(p=function(t,e,i,n){var r,a,o,s=[];for(r=0,a=e.length;r<a;r++)(o=Ao(t,e[r]*n,r<a-1?e[r+1]*n:t.length,n,!1))===o.next&&(o.steiner=!0),s.push(Uo(o));for(s.sort(Bo),r=0;r<s.length;r++)Oo(s[r],i),i=ko(i,i.next);return i}(t,e,p,i)),t.length>80*i){n=a=t[0],r=o=t[1];for(var f=i;f<h;f+=i)(s=t[f])<n&&(n=s),(l=t[f+1])<r&&(r=l),s>a&&(a=s),l>o&&(o=l);c=0!==(c=Math.max(a-n,o-r))?1/c:0}return Ro(p,d,i,n,r,c),d}function Ao(t,e,i,n,r){var a,o;if(r===Qo(t,e,i,n)>0)for(a=e;a<i;a+=n)o=Xo(a,t[a],t[a+1],o);else for(a=i-n;a>=e;a-=n)o=Xo(a,t[a],t[a+1],o);return o&&qo(o,o.next)&&(Ko(o),o=o.next),o}function ko(t,e){if(!t)return t;e||(e=t);var i,n=t;do{if(i=!1,n.steiner||!qo(n,n.next)&&0!==jo(n.prev,n,n.next))n=n.next;else{if(Ko(n),(n=e=n.prev)===n.next)break;i=!0}}while(i||n!==e);return e}function Ro(t,e,i,n,r,a,o){if(t){!o&&a&&function(t,e,i,n){var r=t;do{null===r.z&&(r.z=No(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,i,n,r,a,o,s,l,c=1;do{for(i=t,t=null,a=null,o=0;i;){for(o++,n=i,s=0,e=0;e<c&&(s++,n=n.nextZ);e++);for(l=c;s>0||l>0&&n;)0!==s&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,s--):(r=n,n=n.nextZ,l--),a?a.nextZ=r:t=r,r.prevZ=a,a=r;i=n}a.nextZ=null,c*=2}while(o>1)}(r)}(t,n,r,a);for(var s,l,c=t;t.prev!==t.next;)if(s=t.prev,l=t.next,a?Po(t,n,r,a):zo(t))e.push(s.i/i),e.push(t.i/i),e.push(l.i/i),Ko(t),t=l.next,c=l.next;else if((t=l)===c){o?1===o?Ro(t=Do(ko(t),e,i),e,i,n,r,a,2):2===o&&Lo(t,e,i,n,r,a):Ro(ko(t),e,i,n,r,a,1);break}}}function zo(t){var e=t.prev,i=t,n=t.next;if(jo(e,i,n)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if($o(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&jo(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function Po(t,e,i,n){var r=t.prev,a=t,o=t.next;if(jo(r,a,o)>=0)return!1;for(var s=r.x>a.x?r.x>o.x?r.x:o.x:a.x>o.x?a.x:o.x,l=r.y>a.y?r.y>o.y?r.y:o.y:a.y>o.y?a.y:o.y,c=No(r.x<a.x?r.x<o.x?r.x:o.x:a.x<o.x?a.x:o.x,r.y<a.y?r.y<o.y?r.y:o.y:a.y<o.y?a.y:o.y,e,i,n),u=No(s,l,e,i,n),h=t.prevZ,p=t.nextZ;h&&h.z>=c&&p&&p.z<=u;){if(h!==t.prev&&h!==t.next&&$o(r.x,r.y,a.x,a.y,o.x,o.y,h.x,h.y)&&jo(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,p!==t.prev&&p!==t.next&&$o(r.x,r.y,a.x,a.y,o.x,o.y,p.x,p.y)&&jo(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;h&&h.z>=c;){if(h!==t.prev&&h!==t.next&&$o(r.x,r.y,a.x,a.y,o.x,o.y,h.x,h.y)&&jo(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;p&&p.z<=u;){if(p!==t.prev&&p!==t.next&&$o(r.x,r.y,a.x,a.y,o.x,o.y,p.x,p.y)&&jo(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function Do(t,e,i){var n=t;do{var r=n.prev,a=n.next.next;!qo(r,a)&&Go(r,n,n.next,a)&&Zo(r,a)&&Zo(a,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(a.i/i),Ko(n),Ko(n.next),n=t=a),n=n.next}while(n!==t);return ko(n)}function Lo(t,e,i,n,r,a){var o=t;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&Vo(o,s)){var l=Yo(o,s);return o=ko(o,o.next),l=ko(l,l.next),Ro(o,e,i,n,r,a),void Ro(l,e,i,n,r,a)}s=s.next}o=o.next}while(o!==t)}function Bo(t,e){return t.x-e.x}function Oo(t,e){if(e=function(t,e){var i,n=e,r=t.x,a=t.y,o=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var s=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=r&&s>o){if(o=s,s===r){if(a===n.y)return n;if(a===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!i)return null;if(r===o)return i;var l,c=i,u=i.x,h=i.y,p=1/0;n=i;do{r>=n.x&&n.x>=u&&r!==n.x&&$o(a<h?r:o,a,u,h,a<h?o:r,a,n.x,n.y)&&(l=Math.abs(a-n.y)/(r-n.x),Zo(n,t)&&(l<p||l===p&&(n.x>i.x||n.x===i.x&&Fo(i,n)))&&(i=n,p=l)),n=n.next}while(n!==c);return i}(t,e)){var i=Yo(e,t);ko(e,e.next),ko(i,i.next)}}function Fo(t,e){return jo(t.prev,t,e.prev)<0&&jo(e.next,t,t.next)<0}function No(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Uo(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function $o(t,e,i,n,r,a,o,s){return(r-o)*(e-s)-(t-o)*(a-s)>=0&&(t-o)*(n-s)-(i-o)*(e-s)>=0&&(i-o)*(a-s)-(r-o)*(n-s)>=0}function Vo(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&Go(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(Zo(t,e)&&Zo(e,t)&&function(t,e){var i=t,n=!1,r=(t.x+e.x)/2,a=(t.y+e.y)/2;do{i.y>a!=i.next.y>a&&i.next.y!==i.y&&r<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(jo(t.prev,t,e.prev)||jo(t,e.prev,e))||qo(t,e)&&jo(t.prev,t,t.next)>0&&jo(e.prev,e,e.next)>0)}function jo(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function qo(t,e){return t.x===e.x&&t.y===e.y}function Go(t,e,i,n){var r=Wo(jo(t,e,i)),a=Wo(jo(t,e,n)),o=Wo(jo(i,n,t)),s=Wo(jo(i,n,e));return r!==a&&o!==s||!(0!==r||!Ho(t,i,e))||!(0!==a||!Ho(t,n,e))||!(0!==o||!Ho(i,t,n))||!(0!==s||!Ho(i,e,n))}function Ho(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function Wo(t){return t>0?1:t<0?-1:0}function Zo(t,e){return jo(t.prev,t,t.next)<0?jo(t,e,t.next)>=0&&jo(t,t.prev,e)>=0:jo(t,e,t.prev)<0||jo(t,t.next,e)<0}function Yo(t,e){var i=new Jo(t.i,t.x,t.y),n=new Jo(e.i,e.x,e.y),r=t.next,a=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,a.next=n,n.prev=a,n}function Xo(t,e,i,n){var r=new Jo(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function Ko(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Jo(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Qo(t,e,i,n){for(var r=0,a=e,o=i-n;a<i;a+=n)r+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;return r}function ts(t,e,i,n,r){!function t(e,i,n,r,a){for(;r>n;){if(r-n>600){var o=r-n+1,s=i-n+1,l=Math.log(o),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(o-c)/o)*(s-o/2<0?-1:1);t(e,i,Math.max(n,Math.floor(i-s*c/o+u)),Math.min(r,Math.floor(i+(o-s)*c/o+u)),a)}var h=e[i],p=n,d=r;for(es(e,n,i),a(e[r],h)>0&&es(e,n,r);p<d;){for(es(e,p,d),p++,d--;a(e[p],h)<0;)p++;for(;a(e[d],h)>0;)d--}0===a(e[n],h)?es(e,n,d):es(e,++d,r),d<=i&&(n=d+1),i<=d&&(r=d-1)}}(t,e,i||0,n||t.length-1,r||is)}function es(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function is(t,e){return t<e?-1:t>e?1:0}function ns(t,e){var i=t.length;if(i<=1)return[t];for(var n,r,a=[],o=0;o<i;o++){var s=T(t[o]);0!==s&&(t[o].area=Math.abs(s),void 0===r&&(r=s<0),r===s<0?(n&&a.push(n),n=[t[o]]):n.push(t[o]))}if(n&&a.push(n),e>1)for(var l=0;l<a.length;l++)a[l].length<=e||(ts(a[l],e,1,a[l].length-1,rs),a[l]=a[l].slice(0,e));return a}function rs(t,e){return e.area-t.area}function as(t,e,i){for(var n=i.patternDependencies,r=!1,a=0,o=e;a<o.length;a+=1){var s=o[a].paint.get(t+"-pattern");s.isConstant()||(r=!0);var l=s.constantOr(null);l&&(r=!0,n[l.to]=!0,n[l.from]=!0)}return r}function os(t,e,i,n,r){for(var a=r.patternDependencies,o=0,s=e;o<s.length;o+=1){var l=s[o],c=l.paint.get(t+"-pattern").value;if("constant"!==c.kind){var u=c.evaluate({zoom:n-1},i,{},r.availableImages),h=c.evaluate({zoom:n},i,{},r.availableImages),p=c.evaluate({zoom:n+1},i,{},r.availableImages);h=h&&h.name?h.name:h,p=p&&p.name?p.name:p,a[u=u&&u.name?u.name:u]=!0,a[h]=!0,a[p]=!0,i.patterns[l.id]={min:u,mid:h,max:p}}}return i}Io.deviation=function(t,e,i,n){var r=e&&e.length,a=Math.abs(Qo(t,0,r?e[0]*i:t.length,i));if(r)for(var o=0,s=e.length;o<s;o++)a-=Math.abs(Qo(t,e[o]*i,o<s-1?e[o+1]*i:t.length,i));var l=0;for(o=0;o<n.length;o+=3){var c=n[o]*i,u=n[o+1]*i,h=n[o+2]*i;l+=Math.abs((t[c]-t[h])*(t[u+1]-t[c+1])-(t[c]-t[u])*(t[h+1]-t[c+1]))}return 0===a&&0===l?0:Math.abs((l-a)/a)},Io.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,r=0;r<t.length;r++){for(var a=0;a<t[r].length;a++)for(var o=0;o<e;o++)i.vertices.push(t[r][a][o]);r>0&&i.holes.push(n+=t[r-1].length)}return i},Mo.default=Co;var ss=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ir,this.indexArray=new $r,this.indexArray2=new Wr,this.programConfigurations=new Da(t.layers,t.zoom),this.segments=new sa,this.segments2=new sa,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};ss.prototype.populate=function(t,e,i){this.hasPattern=as("fill",this.layers,e);for(var n=this.layers[0].layout.get("fill-sort-key"),r=[],a=0,o=t;a<o.length;a+=1){var s=o[a],l=s.feature,c=s.id,u=s.index,h=s.sourceLayerIndex,p=this.layers[0]._featureFilter.needGeometry,d=Ua(l,p);if(this.layers[0]._featureFilter.filter(new sr(this.zoom),d,i)){var f=n?n.evaluate(d,{},i,e.availableImages):void 0,m={id:c,properties:l.properties,type:l.type,sourceLayerIndex:h,index:u,geometry:p?d.geometry:Na(l),patterns:{},sortKey:f};r.push(m)}}n&&r.sort((function(t,e){return t.sortKey-e.sortKey}));for(var g=0,_=r;g<_.length;g+=1){var y=_[g],v=y.geometry,x=y.index,b=y.sourceLayerIndex;if(this.hasPattern){var w=os("fill",this.layers,y,this.zoom,e);this.patternFeatures.push(w)}else this.addFeature(y,v,x,i,{});e.featureIndex.insert(t[x].feature,v,x,b,this.index)}},ss.prototype.update=function(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)},ss.prototype.addFeatures=function(t,e,i){for(var n=0,r=this.patternFeatures;n<r.length;n+=1){var a=r[n];this.addFeature(a,a.geometry,a.index,e,i)}},ss.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},ss.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ss.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,To),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},ss.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},ss.prototype.addFeature=function(t,e,i,n,r){for(var a=0,o=ns(e,500);a<o.length;a+=1){for(var s=o[a],l=0,c=0,u=s;c<u.length;c+=1)l+=u[c].length;for(var h=this.segments.prepareSegment(l,this.layoutVertexArray,this.indexArray),p=h.vertexLength,d=[],f=[],m=0,g=s;m<g.length;m+=1){var _=g[m];if(0!==_.length){_!==s[0]&&f.push(d.length/2);var y=this.segments2.prepareSegment(_.length,this.layoutVertexArray,this.indexArray2),v=y.vertexLength;this.layoutVertexArray.emplaceBack(_[0].x,_[0].y),this.indexArray2.emplaceBack(v+_.length-1,v),d.push(_[0].x),d.push(_[0].y);for(var x=1;x<_.length;x++)this.layoutVertexArray.emplaceBack(_[x].x,_[x].y),this.indexArray2.emplaceBack(v+x-1,v+x),d.push(_[x].x),d.push(_[x].y);y.vertexLength+=_.length,y.primitiveLength+=_.length}}for(var b=Mo(d,f),w=0;w<b.length;w+=3)this.indexArray.emplaceBack(p+b[w],p+b[w+1],p+b[w+2]);h.vertexLength+=l,h.primitiveLength+=b.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,r,n)},Fn("FillBucket",ss,{omit:["layers","patternFeatures"]});var ls=new br({"fill-sort-key":new _r(At.layout_fill["fill-sort-key"])}),cs={paint:new br({"fill-antialias":new gr(At.paint_fill["fill-antialias"]),"fill-opacity":new _r(At.paint_fill["fill-opacity"]),"fill-color":new _r(At.paint_fill["fill-color"]),"fill-outline-color":new _r(At.paint_fill["fill-outline-color"]),"fill-translate":new gr(At.paint_fill["fill-translate"]),"fill-translate-anchor":new gr(At.paint_fill["fill-translate-anchor"]),"fill-pattern":new yr(At.paint_fill["fill-pattern"])}),layout:ls},us=function(t){function e(e){t.call(this,e,cs)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.recalculate=function(e,i){t.prototype.recalculate.call(this,e,i);var n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},e.prototype.createBucket=function(t){return new ss(t)},e.prototype.queryRadius=function(){return eo(this.paint.get("fill-translate"))},e.prototype.queryIntersectsFeature=function(t,e,i,n,r,a,o){return Ga(io(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),a.angle,o),n)},e.prototype.isTileClipped=function(){return!0},e}(wr),hs=Mr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,ps=ds;function ds(t,e,i,n,r){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=r,t.readFields(fs,this,e)}function fs(t,e,i){1==t?e.id=i.readVarint():2==t?function(t,e){for(var i=t.readVarint()+t.pos;t.pos<i;){var n=e._keys[t.readVarint()],r=e._values[t.readVarint()];e.properties[n]=r}}(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}function ms(t){for(var e,i,n=0,r=0,a=t.length,o=a-1;r<a;o=r++)n+=((i=t[o]).x-(e=t[r]).x)*(e.y+i.y);return n}ds.types=["Unknown","Point","LineString","Polygon"],ds.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,n=1,a=0,o=0,s=0,l=[];t.pos<i;){if(a<=0){var c=t.readVarint();n=7&c,a=c>>3}if(a--,1===n||2===n)o+=t.readSVarint(),s+=t.readSVarint(),1===n&&(e&&l.push(e),e=[]),e.push(new r(o,s));else{if(7!==n)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&l.push(e),l},ds.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,n=0,r=0,a=0,o=1/0,s=-1/0,l=1/0,c=-1/0;t.pos<e;){if(n<=0){var u=t.readVarint();i=7&u,n=u>>3}if(n--,1===i||2===i)(r+=t.readSVarint())<o&&(o=r),r>s&&(s=r),(a+=t.readSVarint())<l&&(l=a),a>c&&(c=a);else if(7!==i)throw new Error("unknown command "+i)}return[o,l,s,c]},ds.prototype.toGeoJSON=function(t,e,i){var n,r,a=this.extent*Math.pow(2,i),o=this.extent*t,s=this.extent*e,l=this.loadGeometry(),c=ds.types[this.type];function u(t){for(var e=0;e<t.length;e++){var i=t[e];t[e]=[360*(i.x+o)/a-180,360/Math.PI*Math.atan(Math.exp((180-360*(i.y+s)/a)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(n=0;n<l.length;n++)h[n]=l[n][0];u(l=h);break;case 2:for(n=0;n<l.length;n++)u(l[n]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return[t];for(var i,n,r=[],a=0;a<e;a++){var o=ms(t[a]);0!==o&&(void 0===n&&(n=o<0),n===o<0?(i&&r.push(i),i=[t[a]]):i.push(t[a]))}return i&&r.push(i),r}(l),n=0;n<l.length;n++)for(r=0;r<l[n].length;r++)u(l[n][r])}1===l.length?l=l[0]:c="Multi"+c;var p={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(p.id=this.id),p};var gs=_s;function _s(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(ys,this,e),this.length=this._features.length}function ys(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(function(t){for(var e=null,i=t.readVarint()+t.pos;t.pos<i;){var n=t.readVarint()>>3;e=1===n?t.readString():2===n?t.readFloat():3===n?t.readDouble():4===n?t.readVarint64():5===n?t.readVarint():6===n?t.readSVarint():7===n?t.readBoolean():null}return e}(i))}function vs(t,e,i){if(3===t){var n=new gs(i,i.readVarint()+i.pos);n.length&&(e[n.name]=n)}}_s.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new ps(this._pbf,e,this.extent,this._keys,this._values)};var xs={VectorTile:function(t,e){this.layers=t.readFields(vs,{},e)},VectorTileFeature:ps,VectorTileLayer:gs},bs=xs.VectorTileFeature.types,ws=Math.pow(2,13);function Ss(t,e,i,n,r,a,o,s){t.emplaceBack(e,i,2*Math.floor(n*ws)+o,r*ws*2,a*ws*2,Math.round(s))}var Es=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new kr,this.indexArray=new $r,this.programConfigurations=new Da(t.layers,t.zoom),this.segments=new sa,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};function Ts(t,e){return t.x===e.x&&(t.x<0||t.x>8192)||t.y===e.y&&(t.y<0||t.y>8192)}Es.prototype.populate=function(t,e,i){this.features=[],this.hasPattern=as("fill-extrusion",this.layers,e);for(var n=0,r=t;n<r.length;n+=1){var a=r[n],o=a.feature,s=a.id,l=a.index,c=a.sourceLayerIndex,u=this.layers[0]._featureFilter.needGeometry,h=Ua(o,u);if(this.layers[0]._featureFilter.filter(new sr(this.zoom),h,i)){var p={id:s,sourceLayerIndex:c,index:l,geometry:u?h.geometry:Na(o),properties:o.properties,type:o.type,patterns:{}};this.hasPattern?this.features.push(os("fill-extrusion",this.layers,p,this.zoom,e)):this.addFeature(p,p.geometry,l,i,{}),e.featureIndex.insert(o,p.geometry,l,c,this.index,!0)}}},Es.prototype.addFeatures=function(t,e,i){for(var n=0,r=this.features;n<r.length;n+=1){var a=r[n];this.addFeature(a,a.geometry,a.index,e,i)}},Es.prototype.update=function(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)},Es.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Es.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Es.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,hs),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Es.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Es.prototype.addFeature=function(t,e,i,n,r){for(var a=0,o=ns(e,500);a<o.length;a+=1){for(var s=o[a],l=0,c=0,u=s;c<u.length;c+=1)l+=u[c].length;for(var h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),p=0,d=s;p<d.length;p+=1){var f=d[p];if(0!==f.length&&!((z=f).every((function(t){return t.x<0}))||z.every((function(t){return t.x>8192}))||z.every((function(t){return t.y<0}))||z.every((function(t){return t.y>8192}))))for(var m=0,g=0;g<f.length;g++){var _=f[g];if(g>=1){var y=f[g-1];if(!Ts(_,y)){h.vertexLength+4>sa.MAX_VERTEX_ARRAY_LENGTH&&(h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var v=_.sub(y)._perp()._unit(),x=y.dist(_);m+x>32768&&(m=0),Ss(this.layoutVertexArray,_.x,_.y,v.x,v.y,0,0,m),Ss(this.layoutVertexArray,_.x,_.y,v.x,v.y,0,1,m),Ss(this.layoutVertexArray,y.x,y.y,v.x,v.y,0,0,m+=x),Ss(this.layoutVertexArray,y.x,y.y,v.x,v.y,0,1,m);var b=h.vertexLength;this.indexArray.emplaceBack(b,b+2,b+1),this.indexArray.emplaceBack(b+1,b+2,b+3),h.vertexLength+=4,h.primitiveLength+=2}}}}if(h.vertexLength+l>sa.MAX_VERTEX_ARRAY_LENGTH&&(h=this.segments.prepareSegment(l,this.layoutVertexArray,this.indexArray)),"Polygon"===bs[t.type]){for(var w=[],S=[],E=h.vertexLength,T=0,M=s;T<M.length;T+=1){var C=M[T];if(0!==C.length){C!==s[0]&&S.push(w.length/2);for(var I=0;I<C.length;I++){var A=C[I];Ss(this.layoutVertexArray,A.x,A.y,0,0,1,1,0),w.push(A.x),w.push(A.y)}}}for(var k=Mo(w,S),R=0;R<k.length;R+=3)this.indexArray.emplaceBack(E+k[R],E+k[R+2],E+k[R+1]);h.primitiveLength+=k.length/3,h.vertexLength+=l}}var z;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,r,n)},Fn("FillExtrusionBucket",Es,{omit:["layers","features"]});var Ms={paint:new br({"fill-extrusion-opacity":new gr(At["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new _r(At["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new gr(At["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new gr(At["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new yr(At["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new _r(At["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new _r(At["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new gr(At["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Cs=function(t){function e(e){t.call(this,e,Ms)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new Es(t)},e.prototype.queryRadius=function(){return eo(this.paint.get("fill-extrusion-translate"))},e.prototype.is3D=function(){return!0},e.prototype.queryIntersectsFeature=function(t,e,i,n,a,o,s,l){var c=io(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),o.angle,s),u=this.paint.get("fill-extrusion-height").evaluate(e,i),h=this.paint.get("fill-extrusion-base").evaluate(e,i),p=function(t,e,i,n){for(var a=[],o=0,s=t;o<s.length;o+=1){var l=s[o],c=[l.x,l.y,0,1];uo(c,c,e),a.push(new r(c[0]/c[3],c[1]/c[3]))}return a}(c,l),d=function(t,e,i,n){for(var a=[],o=[],s=n[8]*e,l=n[9]*e,c=n[10]*e,u=n[11]*e,h=n[8]*i,p=n[9]*i,d=n[10]*i,f=n[11]*i,m=0,g=t;m<g.length;m+=1){for(var _=[],y=[],v=0,x=g[m];v<x.length;v+=1){var b=x[v],w=b.x,S=b.y,E=n[0]*w+n[4]*S+n[12],T=n[1]*w+n[5]*S+n[13],M=n[2]*w+n[6]*S+n[14],C=n[3]*w+n[7]*S+n[15],I=M+c,A=C+u,k=E+h,R=T+p,z=M+d,P=C+f,D=new r((E+s)/A,(T+l)/A);D.z=I/A,_.push(D);var L=new r(k/P,R/P);L.z=z/P,y.push(L)}a.push(_),o.push(y)}return[a,o]}(n,h,u,l);return function(t,e,i){var n=1/0;Ga(i,e)&&(n=As(i,e[0]));for(var r=0;r<e.length;r++)for(var a=e[r],o=t[r],s=0;s<a.length-1;s++){var l=a[s],c=[l,a[s+1],o[s+1],o[s],l];ja(i,c)&&(n=Math.min(n,As(i,c)))}return n!==1/0&&n}(d[0],d[1],p)},e}(wr);function Is(t,e){return t.x*e.x+t.y*e.y}function As(t,e){if(1===t.length){for(var i,n=0,r=e[n++];!i||r.equals(i);)if(!(i=e[n++]))return 1/0;for(;n<e.length;n++){var a=e[n],o=t[0],s=i.sub(r),l=a.sub(r),c=o.sub(r),u=Is(s,s),h=Is(s,l),p=Is(l,l),d=Is(c,s),f=Is(c,l),m=u*p-h*h,g=(p*d-h*f)/m,_=(u*f-h*d)/m,y=r.z*(1-g-_)+i.z*g+a.z*_;if(isFinite(y))return y}return 1/0}for(var v=1/0,x=0,b=e;x<b.length;x+=1)v=Math.min(v,b[x].z);return v}var ks=Mr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Rs=Mr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,zs=xs.VectorTileFeature.types,Ps=Math.cos(Math.PI/180*37.5),Ds=Math.pow(2,14)/.5,Ls=function(t){var e=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((function(t){e.gradients[t.id]={}})),this.layoutVertexArray=new Rr,this.layoutVertexArray2=new zr,this.indexArray=new $r,this.programConfigurations=new Da(t.layers,t.zoom),this.segments=new sa,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};Ls.prototype.populate=function(t,e,i){this.hasPattern=as("line",this.layers,e);for(var n=this.layers[0].layout.get("line-sort-key"),r=[],a=0,o=t;a<o.length;a+=1){var s=o[a],l=s.feature,c=s.id,u=s.index,h=s.sourceLayerIndex,p=this.layers[0]._featureFilter.needGeometry,d=Ua(l,p);if(this.layers[0]._featureFilter.filter(new sr(this.zoom),d,i)){var f=n?n.evaluate(d,{},i):void 0,m={id:c,properties:l.properties,type:l.type,sourceLayerIndex:h,index:u,geometry:p?d.geometry:Na(l),patterns:{},sortKey:f};r.push(m)}}n&&r.sort((function(t,e){return t.sortKey-e.sortKey}));for(var g=0,_=r;g<_.length;g+=1){var y=_[g],v=y.geometry,x=y.index,b=y.sourceLayerIndex;if(this.hasPattern){var w=os("line",this.layers,y,this.zoom,e);this.patternFeatures.push(w)}else this.addFeature(y,v,x,i,{});e.featureIndex.insert(t[x].feature,v,x,b,this.index)}},Ls.prototype.update=function(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)},Ls.prototype.addFeatures=function(t,e,i){for(var n=0,r=this.patternFeatures;n<r.length;n+=1){var a=r[n];this.addFeature(a,a.geometry,a.index,e,i)}},Ls.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Ls.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ls.prototype.upload=function(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Rs)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ks),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Ls.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ls.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},Ls.prototype.addFeature=function(t,e,i,n,r){var a=this.layers[0].layout,o=a.get("line-join").evaluate(t,{}),s=a.get("line-cap"),l=a.get("line-miter-limit"),c=a.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var u=0,h=e;u<h.length;u+=1)this.addLine(h[u],t,o,s,l,c);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,r,n)},Ls.prototype.addLine=function(t,e,i,n,r,a){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var o=0;o<t.length-1;o++)this.totalDistance+=t[o].dist(t[o+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var s="Polygon"===zs[e.type],l=t.length;l>=2&&t[l-1].equals(t[l-2]);)l--;for(var c=0;c<l-1&&t[c].equals(t[c+1]);)c++;if(!(l<(s?3:2))){"bevel"===i&&(r=1.05);var u,h=this.overscaling<=16?122880/(512*this.overscaling):0,p=this.segments.prepareSegment(10*l,this.layoutVertexArray,this.indexArray),d=void 0,f=void 0,m=void 0,g=void 0;this.e1=this.e2=-1,s&&(g=t[c].sub(u=t[l-2])._unit()._perp());for(var _=c;_<l;_++)if(!(f=_===l-1?s?t[c+1]:void 0:t[_+1])||!t[_].equals(f)){g&&(m=g),u&&(d=u),u=t[_],g=f?f.sub(u)._unit()._perp():m;var y=(m=m||g).add(g);0===y.x&&0===y.y||y._unit();var v=m.x*g.x+m.y*g.y,x=y.x*g.x+y.y*g.y,b=0!==x?1/x:1/0,w=2*Math.sqrt(2-2*x),S=x<Ps&&d&&f,E=m.x*g.y-m.y*g.x>0;if(S&&_>c){var T=u.dist(d);if(T>2*h){var M=u.sub(u.sub(d)._mult(h/T)._round());this.updateDistance(d,M),this.addCurrentVertex(M,m,0,0,p),d=M}}var C=d&&f,I=C?i:s?"butt":n;if(C&&"round"===I&&(b<a?I="miter":b<=2&&(I="fakeround")),"miter"===I&&b>r&&(I="bevel"),"bevel"===I&&(b>2&&(I="flipbevel"),b<r&&(I="miter")),d&&this.updateDistance(d,u),"miter"===I)y._mult(b),this.addCurrentVertex(u,y,0,0,p);else if("flipbevel"===I){if(b>100)y=g.mult(-1);else{var A=b*m.add(g).mag()/m.sub(g).mag();y._perp()._mult(A*(E?-1:1))}this.addCurrentVertex(u,y,0,0,p),this.addCurrentVertex(u,y.mult(-1),0,0,p)}else if("bevel"===I||"fakeround"===I){var k=-Math.sqrt(b*b-1),R=E?k:0,z=E?0:k;if(d&&this.addCurrentVertex(u,m,R,z,p),"fakeround"===I)for(var P=Math.round(180*w/Math.PI/20),D=1;D<P;D++){var L=D/P;if(.5!==L){var B=L-.5;L+=L*B*(L-1)*((1.0904+v*(v*(3.55645-1.43519*v)-3.2452))*B*B+(.848013+v*(.215638*v-1.06021)))}var O=g.sub(m)._mult(L)._add(m)._unit()._mult(E?-1:1);this.addHalfVertex(u,O.x,O.y,!1,E,0,p)}f&&this.addCurrentVertex(u,g,-R,-z,p)}else if("butt"===I)this.addCurrentVertex(u,y,0,0,p);else if("square"===I){var F=d?1:-1;this.addCurrentVertex(u,y,F,F,p)}else"round"===I&&(d&&(this.addCurrentVertex(u,m,0,0,p),this.addCurrentVertex(u,m,1,1,p,!0)),f&&(this.addCurrentVertex(u,g,-1,-1,p,!0),this.addCurrentVertex(u,g,0,0,p)));if(S&&_<l-1){var N=u.dist(f);if(N>2*h){var U=u.add(f.sub(u)._mult(h/N)._round());this.updateDistance(u,U),this.addCurrentVertex(U,g,0,0,p),u=U}}}}},Ls.prototype.addCurrentVertex=function(t,e,i,n,r,a){void 0===a&&(a=!1);var o=e.y*n-e.x,s=-e.y-e.x*n;this.addHalfVertex(t,e.x+e.y*i,e.y-e.x*i,a,!1,i,r),this.addHalfVertex(t,o,s,a,!0,-n,r),this.distance>Ds/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(t,e,i,n,r,a))},Ls.prototype.addHalfVertex=function(t,e,i,n,r,a,o){var s=.5*(this.lineClips?this.scaledDistance*(Ds-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(n?1:0),(t.y<<1)+(r?1:0),Math.round(63*e)+128,Math.round(63*i)+128,1+(0===a?0:a<0?-1:1)|(63&s)<<2,s>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var l=o.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,l),o.primitiveLength++),r?this.e2=l:this.e1=l},Ls.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Ls.prototype.updateDistance=function(t,e){this.distance+=t.dist(e),this.updateScaledDistance()},Fn("LineBucket",Ls,{omit:["layers","patternFeatures"]});var Bs=new br({"line-cap":new gr(At.layout_line["line-cap"]),"line-join":new _r(At.layout_line["line-join"]),"line-miter-limit":new gr(At.layout_line["line-miter-limit"]),"line-round-limit":new gr(At.layout_line["line-round-limit"]),"line-sort-key":new _r(At.layout_line["line-sort-key"])}),Os={paint:new br({"line-opacity":new _r(At.paint_line["line-opacity"]),"line-color":new _r(At.paint_line["line-color"]),"line-translate":new gr(At.paint_line["line-translate"]),"line-translate-anchor":new gr(At.paint_line["line-translate-anchor"]),"line-width":new _r(At.paint_line["line-width"]),"line-gap-width":new _r(At.paint_line["line-gap-width"]),"line-offset":new _r(At.paint_line["line-offset"]),"line-blur":new _r(At.paint_line["line-blur"]),"line-dasharray":new vr(At.paint_line["line-dasharray"]),"line-pattern":new yr(At.paint_line["line-pattern"]),"line-gradient":new xr(At.paint_line["line-gradient"])}),layout:Bs},Fs=new(function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.possiblyEvaluate=function(e,i){return i=new sr(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),t.prototype.possiblyEvaluate.call(this,e,i)},e.prototype.evaluate=function(e,i,n,r){return i=p({},i,{zoom:Math.floor(i.zoom)}),t.prototype.evaluate.call(this,e,i,n,r)},e}(_r))(Os.paint.properties["line-width"].specification);Fs.useIntegerZoom=!0;var Ns=function(t){function e(e){t.call(this,e,Os),this.gradientVersion=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._handleSpecialPaintPropertyUpdate=function(t){"line-gradient"===t&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof je,this.gradientVersion=(this.gradientVersion+1)%s)},e.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},e.prototype.recalculate=function(e,i){t.prototype.recalculate.call(this,e,i),this.paint._values["line-floorwidth"]=Fs.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)},e.prototype.createBucket=function(t){return new Ls(t)},e.prototype.queryRadius=function(t){var e=t,i=Us(to("line-width",this,e),to("line-gap-width",this,e)),n=to("line-offset",this,e);return i/2+Math.abs(n)+eo(this.paint.get("line-translate"))},e.prototype.queryIntersectsFeature=function(t,e,i,n,a,o,s){var l=io(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,s),c=s/2*Us(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),u=this.paint.get("line-offset").evaluate(e,i);return u&&(n=function(t,e){for(var i=[],n=new r(0,0),a=0;a<t.length;a++){for(var o=t[a],s=[],l=0;l<o.length;l++){var c=o[l],u=o[l+1],h=0===l?n:c.sub(o[l-1])._unit()._perp(),p=l===o.length-1?n:u.sub(c)._unit()._perp(),d=h._add(p)._unit();d._mult(1/(d.x*p.x+d.y*p.y)),s.push(d._mult(e)._add(c))}i.push(s)}return i}(n,u*s)),function(t,e,i){for(var n=0;n<e.length;n++){var r=e[n];if(t.length>=3)for(var a=0;a<r.length;a++)if(Ja(t,r[a]))return!0;if(Ha(t,r,i))return!0}return!1}(l,n,c)},e.prototype.isTileClipped=function(){return!0},e}(wr);function Us(t,e){return e>0?e+2*t:t}var $s=Mr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Vs=Mr([{name:"a_projected_pos",components:3,type:"Float32"}],4),js=(Mr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Mr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),qs=(Mr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Mr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Gs=Mr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Hs(t,e,i){return t.sections.forEach((function(t){t.text=function(t,e,i){var n=e.layout.get("text-transform").evaluate(i,{});return"uppercase"===n?t=t.toLocaleUpperCase():"lowercase"===n&&(t=t.toLocaleLowerCase()),or.applyArabicShaping&&(t=or.applyArabicShaping(t)),t}(t.text,e,i)})),t}Mr([{name:"triangle",components:3,type:"Uint16"}]),Mr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Mr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Mr([{type:"Float32",name:"offsetX"}]),Mr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Ws={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"},Zs=function(t,e,i,n,r){var a,o,s=8*r-n-1,l=(1<<s)-1,c=l>>1,u=-7,h=i?r-1:0,p=i?-1:1,d=t[e+h];for(h+=p,a=d&(1<<-u)-1,d>>=-u,u+=s;u>0;a=256*a+t[e+h],h+=p,u-=8);for(o=a&(1<<-u)-1,a>>=-u,u+=n;u>0;o=256*o+t[e+h],h+=p,u-=8);if(0===a)a=1-c;else{if(a===l)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,n),a-=c}return(d?-1:1)*o*Math.pow(2,a-n)},Ys=function(t,e,i,n,r,a){var o,s,l,c=8*a-r-1,u=(1<<c)-1,h=u>>1,p=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:a-1,f=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),(e+=o+h>=1?p/l:p*Math.pow(2,1-h))*l>=2&&(o++,l/=2),o+h>=u?(s=0,o=u):o+h>=1?(s=(e*l-1)*Math.pow(2,r),o+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,r),o=0));r>=8;t[i+d]=255&s,d+=f,s/=256,r-=8);for(o=o<<r|s,c+=r;c>0;t[i+d]=255&o,d+=f,o/=256,c-=8);t[i+d-f]|=128*m},Xs=Ks;function Ks(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Ks.Varint=0,Ks.Fixed64=1,Ks.Bytes=2,Ks.Fixed32=5;var Js="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Qs(t){return t.type===Ks.Bytes?t.readVarint()+t.pos:t.pos+1}function tl(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function el(t,e,i){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(n);for(var r=i.pos-1;r>=t;r--)i.buf[r+n]=i.buf[r]}function il(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function nl(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function rl(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function al(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function ol(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function sl(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function ll(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function cl(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function ul(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function hl(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function pl(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function dl(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function fl(t,e,i){1===t&&i.readMessage(ml,e)}function ml(t,e,i){if(3===t){var n=i.readMessage(gl,{}),r=n.width,a=n.height,o=n.left,s=n.top,l=n.advance;e.push({id:n.id,bitmap:new yo({width:r+6,height:a+6},n.bitmap),metrics:{width:r,height:a,left:o,top:s,advance:l}})}}function gl(t,e,i){1===t?e.id=i.readVarint():2===t?e.bitmap=i.readBytes():3===t?e.width=i.readVarint():4===t?e.height=i.readVarint():5===t?e.left=i.readSVarint():6===t?e.top=i.readSVarint():7===t&&(e.advance=i.readVarint())}function _l(t){for(var e=0,i=0,n=0,r=t;n<r.length;n+=1){var a=r[n];e+=a.w*a.h,i=Math.max(i,a.w)}t.sort((function(t,e){return e.h-t.h}));for(var o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}],s=0,l=0,c=0,u=t;c<u.length;c+=1)for(var h=u[c],p=o.length-1;p>=0;p--){var d=o[p];if(!(h.w>d.w||h.h>d.h)){if(h.x=d.x,h.y=d.y,l=Math.max(l,h.y+h.h),s=Math.max(s,h.x+h.w),h.w===d.w&&h.h===d.h){var f=o.pop();p<o.length&&(o[p]=f)}else h.h===d.h?(d.x+=h.w,d.w-=h.w):h.w===d.w?(d.y+=h.h,d.h-=h.h):(o.push({x:d.x+h.w,y:d.y,w:d.w-h.w,h:h.h}),d.y+=h.h,d.h-=h.h);break}}return{w:s,h:l,fill:e/(s*l)||0}}Ks.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),r=n>>3,a=this.pos;this.type=7&n,t(r,e,this),this.pos===a&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=hl(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=dl(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=hl(this.buf,this.pos)+4294967296*hl(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=hl(this.buf,this.pos)+4294967296*dl(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=Zs(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Zs(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,n=this.buf;return e=127&(i=n[this.pos++]),i<128?e:(e|=(127&(i=n[this.pos++]))<<7,i<128?e:(e|=(127&(i=n[this.pos++]))<<14,i<128?e:(e|=(127&(i=n[this.pos++]))<<21,i<128?e:function(t,e,i){var n,r,a=i.buf;if(n=(112&(r=a[i.pos++]))>>4,r<128)return tl(t,n,e);if(n|=(127&(r=a[i.pos++]))<<3,r<128)return tl(t,n,e);if(n|=(127&(r=a[i.pos++]))<<10,r<128)return tl(t,n,e);if(n|=(127&(r=a[i.pos++]))<<17,r<128)return tl(t,n,e);if(n|=(127&(r=a[i.pos++]))<<24,r<128)return tl(t,n,e);if(n|=(1&(r=a[i.pos++]))<<31,r<128)return tl(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Js?function(t,e,i){return Js.decode(t.subarray(e,i))}(this.buf,e,t):function(t,e,i){for(var n="",r=e;r<i;){var a,o,s,l=t[r],c=null,u=l>239?4:l>223?3:l>191?2:1;if(r+u>i)break;1===u?l<128&&(c=l):2===u?128==(192&(a=t[r+1]))&&(c=(31&l)<<6|63&a)<=127&&(c=null):3===u?(o=t[r+2],128==(192&(a=t[r+1]))&&128==(192&o)&&((c=(15&l)<<12|(63&a)<<6|63&o)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(o=t[r+2],s=t[r+3],128==(192&(a=t[r+1]))&&128==(192&o)&&128==(192&s)&&((c=(15&l)<<18|(63&a)<<12|(63&o)<<6|63&s)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,n+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),n+=String.fromCharCode(c),r+=u}return n}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Ks.Bytes)return t.push(this.readVarint(e));var i=Qs(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Ks.Bytes)return t.push(this.readSVarint());var e=Qs(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Ks.Bytes)return t.push(this.readBoolean());var e=Qs(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Ks.Bytes)return t.push(this.readFloat());var e=Qs(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Ks.Bytes)return t.push(this.readDouble());var e=Qs(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Ks.Bytes)return t.push(this.readFixed32());var e=Qs(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Ks.Bytes)return t.push(this.readSFixed32());var e=Qs(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Ks.Bytes)return t.push(this.readFixed64());var e=Qs(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Ks.Bytes)return t.push(this.readSFixed64());var e=Qs(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Ks.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ks.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ks.Fixed32)this.pos+=4;else{if(e!==Ks.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),pl(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),pl(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),pl(this.buf,-1&t,this.pos),pl(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),pl(this.buf,-1&t,this.pos),pl(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var i,n;if(t>=0?(i=t%4294967296|0,n=t/4294967296|0):(n=~(-t/4294967296),4294967295^(i=~(-t%4294967296))?i=i+1|0:(i=0,n=n+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,i){i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,i.buf[i.pos]=127&(t>>>=7)}(i,0,e),function(t,e){var i=(7&t)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(n,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var n,r,a=0;a<e.length;a++){if((n=e.charCodeAt(a))>55295&&n<57344){if(!r){n>56319||a+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):r=n;continue}if(n<56320){t[i++]=239,t[i++]=191,t[i++]=189,r=n;continue}n=r-55296<<10|n-56320|65536,r=null}else r&&(t[i++]=239,t[i++]=191,t[i++]=189,r=null);n<128?t[i++]=n:(n<2048?t[i++]=n>>6|192:(n<65536?t[i++]=n>>12|224:(t[i++]=n>>18|240,t[i++]=n>>12&63|128),t[i++]=n>>6&63|128),t[i++]=63&n|128)}return i}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&el(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),Ys(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Ys(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var n=this.pos-i;n>=128&&el(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,i){this.writeTag(t,Ks.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,il,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,nl,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,ol,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,rl,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,al,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,sl,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,ll,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,cl,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,ul,e)},writeBytesField:function(t,e){this.writeTag(t,Ks.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Ks.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Ks.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Ks.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Ks.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Ks.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Ks.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Ks.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Ks.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Ks.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var yl=function(t,e){var i=e.pixelRatio,n=e.version,r=e.stretchX,a=e.stretchY,o=e.content;this.paddedRect=t,this.pixelRatio=i,this.stretchX=r,this.stretchY=a,this.content=o,this.version=n},vl={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};vl.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},vl.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},vl.tlbr.get=function(){return this.tl.concat(this.br)},vl.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(yl.prototype,vl);var xl=function(t,e){var i={},n={};this.haveRenderCallbacks=[];var r=[];this.addImages(t,i,r),this.addImages(e,n,r);var a=_l(r),o=new vo({width:a.w||1,height:a.h||1});for(var s in t){var l=t[s],c=i[s].paddedRect;vo.copy(l.data,o,{x:0,y:0},{x:c.x+1,y:c.y+1},l.data)}for(var u in e){var h=e[u],p=n[u].paddedRect,d=p.x+1,f=p.y+1,m=h.data.width,g=h.data.height;vo.copy(h.data,o,{x:0,y:0},{x:d,y:f},h.data),vo.copy(h.data,o,{x:0,y:g-1},{x:d,y:f-1},{width:m,height:1}),vo.copy(h.data,o,{x:0,y:0},{x:d,y:f+g},{width:m,height:1}),vo.copy(h.data,o,{x:m-1,y:0},{x:d-1,y:f},{width:1,height:g}),vo.copy(h.data,o,{x:0,y:0},{x:d+m,y:f},{width:1,height:g})}this.image=o,this.iconPositions=i,this.patternPositions=n};xl.prototype.addImages=function(t,e,i){for(var n in t){var r=t[n],a={x:0,y:0,w:r.data.width+2,h:r.data.height+2};i.push(a),e[n]=new yl(a,r),r.hasRenderCallback&&this.haveRenderCallbacks.push(n)}},xl.prototype.patchUpdatedImages=function(t,e){for(var i in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[i],t.getImage(i),e),this.patchUpdatedImage(this.patternPositions[i],t.getImage(i),e)},xl.prototype.patchUpdatedImage=function(t,e,i){if(t&&e&&t.version!==e.version){t.version=e.version;var n=t.tl;i.update(e.data,void 0,{x:n[0],y:n[1]})}},Fn("ImagePosition",yl),Fn("ImageAtlas",xl);var bl={horizontal:1,vertical:2,horizontalOnly:3},wl=function(){this.scale=1,this.fontStack="",this.imageName=null};wl.forText=function(t,e){var i=new wl;return i.scale=t||1,i.fontStack=e,i},wl.forImage=function(t){var e=new wl;return e.imageName=t,e};var Sl=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function El(t,e,i,n,r,a,o,s,l,c,u,h,p,d,f,m){var g,_=Sl.fromFeature(t,r);h===bl.vertical&&_.verticalizePunctuation();var y=or.processBidirectionalText,v=or.processStyledBidirectionalText;if(y&&1===_.sections.length){g=[];for(var x=0,b=y(_.toString(),Rl(_,c,a,e,n,d,f));x<b.length;x+=1){var w=b[x],S=new Sl;S.text=w,S.sections=_.sections;for(var E=0;E<w.length;E++)S.sectionIndex.push(0);g.push(S)}}else if(v){g=[];for(var T=0,M=v(_.text,_.sectionIndex,Rl(_,c,a,e,n,d,f));T<M.length;T+=1){var C=M[T],I=new Sl;I.text=C[0],I.sectionIndex=C[1],I.sections=_.sections,g.push(I)}}else g=function(t,e){for(var i=[],n=t.text,r=0,a=0,o=e;a<o.length;a+=1){var s=o[a];i.push(t.substring(r,s)),r=s}return r<n.length&&i.push(t.substring(r,n.length)),i}(_,Rl(_,c,a,e,n,d,f));var A=[],k={positionedLines:A,text:_.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:h,iconsInText:!1,verticalizable:!1};return function(t,e,i,n,r,a,o,s,l,c,u,h){for(var p=0,d=-17,f=0,m=0,g="right"===s?1:"left"===s?0:.5,_=0,y=0,v=r;y<v.length;y+=1){var x=v[y];x.trim();var b=x.getMaxScale(),w=24*(b-1),S={positionedGlyphs:[],lineOffset:0};t.positionedLines[_]=S;var E=S.positionedGlyphs,T=0;if(x.length()){for(var M=0;M<x.length();M++){var C=x.getSection(M),I=x.getSectionIndex(M),A=x.getCharCode(M),k=0,R=null,z=null,P=null,D=24,L=!(l===bl.horizontal||!u&&!Wn(A)||u&&(Tl[A]||(q=A,Gn.Arabic(q)||Gn["Arabic Supplement"](q)||Gn["Arabic Extended-A"](q)||Gn["Arabic Presentation Forms-A"](q)||Gn["Arabic Presentation Forms-B"](q))));if(C.imageName){var B=n[C.imageName];if(!B)continue;P=C.imageName,t.iconsInText=t.iconsInText||!0,z=B.paddedRect;var O=B.displaySize;C.scale=24*C.scale/h,k=w+(24-O[1]*C.scale),D=(R={width:O[0],height:O[1],left:1,top:-3,advance:L?O[1]:O[0]}).advance;var F=L?O[0]*C.scale-24*b:O[1]*C.scale-24*b;F>0&&F>T&&(T=F)}else{var N=i[C.fontStack],U=N&&N[A];if(U&&U.rect)z=U.rect,R=U.metrics;else{var $=e[C.fontStack],V=$&&$[A];if(!V)continue;R=V.metrics}k=24*(b-C.scale)}L?(t.verticalizable=!0,E.push({glyph:A,imageName:P,x:p,y:d+k,vertical:L,scale:C.scale,fontStack:C.fontStack,sectionIndex:I,metrics:R,rect:z}),p+=D*C.scale+c):(E.push({glyph:A,imageName:P,x:p,y:d+k,vertical:L,scale:C.scale,fontStack:C.fontStack,sectionIndex:I,metrics:R,rect:z}),p+=R.advance*C.scale+c)}0!==E.length&&(f=Math.max(p-c,f),Pl(E,0,E.length-1,g,T)),p=0;var j=a*b+T;S.lineOffset=Math.max(T,w),d+=j,m=Math.max(j,m),++_}else d+=a,++_}var q,G=d- -17,H=zl(o),W=H.horizontalAlign,Z=H.verticalAlign;(function(t,e,i,n,r,a,o,s,l){var c,u=(e-i)*r;c=a!==o?-s*n- -17:(-n*l+.5)*o;for(var h=0,p=t;h<p.length;h+=1)for(var d=0,f=p[h].positionedGlyphs;d<f.length;d+=1){var m=f[d];m.x+=u,m.y+=c}})(t.positionedLines,g,W,Z,f,m,a,G,r.length),t.top+=-Z*G,t.bottom=t.top+G,t.left+=-W*f,t.right=t.left+f}(k,e,i,n,g,o,s,l,h,c,p,m),!function(t){for(var e=0,i=t;e<i.length;e+=1)if(0!==i[e].positionedGlyphs.length)return!1;return!0}(A)&&k}Sl.fromFeature=function(t,e){for(var i=new Sl,n=0;n<t.sections.length;n++){var r=t.sections[n];r.image?i.addImageSection(r):i.addTextSection(r,e)}return i},Sl.prototype.length=function(){return this.text.length},Sl.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Sl.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},Sl.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Sl.prototype.verticalizePunctuation=function(){this.text=function(t){for(var e="",i=0;i<t.length;i++){var n=t.charCodeAt(i+1)||null,r=t.charCodeAt(i-1)||null;e+=n&&Zn(n)&&!Ws[t[i+1]]||r&&Zn(r)&&!Ws[t[i-1]]||!Ws[t[i]]?t[i]:Ws[t[i]]}return e}(this.text)},Sl.prototype.trim=function(){for(var t=0,e=0;e<this.text.length&&Tl[this.text.charCodeAt(e)];e++)t++;for(var i=this.text.length,n=this.text.length-1;n>=0&&n>=t&&Tl[this.text.charCodeAt(n)];n--)i--;this.text=this.text.substring(t,i),this.sectionIndex=this.sectionIndex.slice(t,i)},Sl.prototype.substring=function(t,e){var i=new Sl;return i.text=this.text.substring(t,e),i.sectionIndex=this.sectionIndex.slice(t,e),i.sections=this.sections,i},Sl.prototype.toString=function(){return this.text},Sl.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce((function(e,i){return Math.max(e,t.sections[i].scale)}),0)},Sl.prototype.addTextSection=function(t,e){this.text+=t.text,this.sections.push(wl.forText(t.scale,t.fontStack||e));for(var i=this.sections.length-1,n=0;n<t.text.length;++n)this.sectionIndex.push(i)},Sl.prototype.addImageSection=function(t){var e=t.image?t.image.name:"";if(0!==e.length){var i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCharCode(i),this.sections.push(wl.forImage(e)),this.sectionIndex.push(this.sections.length-1)):S("Reached maximum number of images 6401")}else S("Can't add FormattedSection with an empty image.")},Sl.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Tl={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ml={};function Cl(t,e,i,n,r,a){if(e.imageName){var o=n[e.imageName];return o?o.displaySize[0]*e.scale*24/a+r:0}var s=i[e.fontStack],l=s&&s[t];return l?l.metrics.advance*e.scale+r:0}function Il(t,e,i,n){var r=Math.pow(t-e,2);return n?t<e?r/2:2*r:r+Math.abs(i)*i}function Al(t,e,i){var n=0;return 10===t&&(n-=1e4),i&&(n+=150),40!==t&&65288!==t||(n+=50),41!==e&&65289!==e||(n+=50),n}function kl(t,e,i,n,r,a){for(var o=null,s=Il(e,i,r,a),l=0,c=n;l<c.length;l+=1){var u=c[l],h=Il(e-u.x,i,r,a)+u.badness;h<=s&&(o=u,s=h)}return{index:t,x:e,priorBreak:o,badness:s}}function Rl(t,e,i,n,r,a,o){if("point"!==a)return[];if(!t)return[];for(var s,l=[],c=function(t,e,i,n,r,a){for(var o=0,s=0;s<t.length();s++){var l=t.getSection(s);o+=Cl(t.getCharCode(s),l,n,r,e,a)}return o/Math.max(1,Math.ceil(o/i))}(t,e,i,n,r,o),u=t.text.indexOf("\u200b")>=0,h=0,p=0;p<t.length();p++){var d=t.getSection(p),f=t.getCharCode(p);if(Tl[f]||(h+=Cl(f,d,n,r,e,o)),p<t.length()-1){var m=!((s=f)<11904||!(Gn["Bopomofo Extended"](s)||Gn.Bopomofo(s)||Gn["CJK Compatibility Forms"](s)||Gn["CJK Compatibility Ideographs"](s)||Gn["CJK Compatibility"](s)||Gn["CJK Radicals Supplement"](s)||Gn["CJK Strokes"](s)||Gn["CJK Symbols and Punctuation"](s)||Gn["CJK Unified Ideographs Extension A"](s)||Gn["CJK Unified Ideographs"](s)||Gn["Enclosed CJK Letters and Months"](s)||Gn["Halfwidth and Fullwidth Forms"](s)||Gn.Hiragana(s)||Gn["Ideographic Description Characters"](s)||Gn["Kangxi Radicals"](s)||Gn["Katakana Phonetic Extensions"](s)||Gn.Katakana(s)||Gn["Vertical Forms"](s)||Gn["Yi Radicals"](s)||Gn["Yi Syllables"](s)));(Ml[f]||m||d.imageName)&&l.push(kl(p+1,h,c,l,Al(f,t.getCharCode(p+1),m&&u),!1))}}return function t(e){return e?t(e.priorBreak).concat(e.index):[]}(kl(t.length(),h,c,l,0,!0))}function zl(t){var e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Pl(t,e,i,n,r){if(n||r)for(var a=t[i],o=(t[i].x+a.metrics.advance*a.scale)*n,s=e;s<=i;s++)t[s].x-=o,t[s].y+=r}function Dl(t,e,i,n,r,a){var o,s=t.image;if(s.content){var l=s.content,c=s.pixelRatio||1;o=[l[0]/c,l[1]/c,s.displaySize[0]-l[2]/c,s.displaySize[1]-l[3]/c]}var u,h,p,d,f=e.left*a,m=e.right*a;"width"===i||"both"===i?(d=r[0]+f-n[3],h=r[0]+m+n[1]):h=(d=r[0]+(f+m-s.displaySize[0])/2)+s.displaySize[0];var g=e.top*a,_=e.bottom*a;return"height"===i||"both"===i?(u=r[1]+g-n[0],p=r[1]+_+n[2]):p=(u=r[1]+(g+_-s.displaySize[1])/2)+s.displaySize[1],{image:s,top:u,right:h,bottom:p,left:d,collisionPadding:o}}Ml[10]=!0,Ml[32]=!0,Ml[38]=!0,Ml[40]=!0,Ml[41]=!0,Ml[43]=!0,Ml[45]=!0,Ml[47]=!0,Ml[173]=!0,Ml[183]=!0,Ml[8203]=!0,Ml[8208]=!0,Ml[8211]=!0,Ml[8231]=!0;var Ll=function(t){function e(e,i,n,r){t.call(this,e,i),this.angle=n,void 0!==r&&(this.segment=r)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.clone=function(){return new e(this.x,this.y,this.angle,this.segment)},e}(r);function Bl(t,e){var i=e.expression;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new sr(t+1))};if("source"===i.kind)return{kind:"source"};for(var n=i.zoomStops,r=i.interpolationType,a=0;a<n.length&&n[a]<=t;)a++;for(var o=a=Math.max(0,a-1);o<n.length&&n[o]<t+1;)o++;o=Math.min(n.length-1,o);var s=n[a],l=n[o];return"composite"===i.kind?{kind:"composite",minZoom:s,maxZoom:l,interpolationType:r}:{kind:"camera",minZoom:s,maxZoom:l,minSize:i.evaluate(new sr(s)),maxSize:i.evaluate(new sr(l)),interpolationType:r}}function Ol(t,e,i){var n=e.uSize,r=i.lowerSize;return"source"===t.kind?r/128:"composite"===t.kind?qe(r/128,i.upperSize/128,e.uSizeT):n}function Fl(t,e){var i=0,n=0;if("constant"===t.kind)n=t.layoutSize;else if("source"!==t.kind){var r=t.interpolationType,a=r?u(ai.interpolationFactor(r,e,t.minZoom,t.maxZoom),0,1):0;"camera"===t.kind?n=qe(t.minSize,t.maxSize,a):i=a}return{uSizeT:i,uSize:n}}Fn("Anchor",Ll);var Nl=Object.freeze({__proto__:null,getSizeData:Bl,evaluateSizeForFeature:Ol,evaluateSizeForZoom:Fl,SIZE_PACK_FACTOR:128});function Ul(t,e,i,n,r){if(void 0===e.segment)return!0;for(var a=e,o=e.segment+1,s=0;s>-i/2;){if(--o<0)return!1;s-=t[o].dist(a),a=t[o]}s+=t[o].dist(t[o+1]),o++;for(var l=[],c=0;s<i/2;){var u=t[o],h=t[o+1];if(!h)return!1;var p=t[o-1].angleTo(u)-u.angleTo(h);for(p=Math.abs((p+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:s,angleDelta:p}),c+=p;s-l[0].distance>n;)c-=l.shift().angleDelta;if(c>r)return!1;o++,s+=u.dist(h)}return!0}function $l(t){for(var e=0,i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function Vl(t,e,i){return t?.6*e*i:0}function jl(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function ql(t,e,i,n,r,a){for(var o=Vl(i,r,a),s=jl(i,n)*a,l=0,c=$l(t)/2,u=0;u<t.length-1;u++){var h=t[u],p=t[u+1],d=h.dist(p);if(l+d>c){var f=(c-l)/d,m=qe(h.x,p.x,f),g=qe(h.y,p.y,f),_=new Ll(m,g,p.angleTo(h),u);return _._round(),!o||Ul(t,_,s,o,e)?_:void 0}l+=d}}function Gl(t,e,i,n,r,a,o,s,l){var c=Vl(n,a,o),u=jl(n,r),h=u*o,p=0===t[0].x||t[0].x===l||0===t[0].y||t[0].y===l;return e-h<e/4&&(e=h+e/4),function t(e,i,n,r,a,o,s,l,c){for(var u=o/2,h=$l(e),p=0,d=i-n,f=[],m=0;m<e.length-1;m++){for(var g=e[m],_=e[m+1],y=g.dist(_),v=_.angleTo(g);d+n<p+y;){var x=((d+=n)-p)/y,b=qe(g.x,_.x,x),w=qe(g.y,_.y,x);if(b>=0&&b<c&&w>=0&&w<c&&d-u>=0&&d+u<=h){var S=new Ll(b,w,v,m);S._round(),r&&!Ul(e,S,o,r,a)||f.push(S)}}p+=y}return l||f.length||s||(f=t(e,p/2,n,r,a,o,s,!0,c)),f}(t,p?e/2*s%e:(u/2+2*a)*o*s%e,e,c,i,h,p,!1,l)}function Hl(t,e,i,n,a){for(var o=[],s=0;s<t.length;s++)for(var l=t[s],c=void 0,u=0;u<l.length-1;u++){var h=l[u],p=l[u+1];h.x<e&&p.x<e||(h.x<e?h=new r(e,h.y+(e-h.x)/(p.x-h.x)*(p.y-h.y))._round():p.x<e&&(p=new r(e,h.y+(e-h.x)/(p.x-h.x)*(p.y-h.y))._round()),h.y<i&&p.y<i||(h.y<i?h=new r(h.x+(i-h.y)/(p.y-h.y)*(p.x-h.x),i)._round():p.y<i&&(p=new r(h.x+(i-h.y)/(p.y-h.y)*(p.x-h.x),i)._round()),h.x>=n&&p.x>=n||(h.x>=n?h=new r(n,h.y+(n-h.x)/(p.x-h.x)*(p.y-h.y))._round():p.x>=n&&(p=new r(n,h.y+(n-h.x)/(p.x-h.x)*(p.y-h.y))._round()),h.y>=a&&p.y>=a||(h.y>=a?h=new r(h.x+(a-h.y)/(p.y-h.y)*(p.x-h.x),a)._round():p.y>=a&&(p=new r(h.x+(a-h.y)/(p.y-h.y)*(p.x-h.x),a)._round()),c&&h.equals(c[c.length-1])||o.push(c=[h]),c.push(p)))))}return o}function Wl(t,e,i,n){var a=[],o=t.image,s=o.pixelRatio,l=o.paddedRect.w-2,c=o.paddedRect.h-2,u=t.right-t.left,h=t.bottom-t.top,p=o.stretchX||[[0,l]],d=o.stretchY||[[0,c]],f=function(t,e){return t+e[1]-e[0]},m=p.reduce(f,0),g=d.reduce(f,0),_=l-m,y=c-g,v=0,x=m,b=0,w=g,S=0,E=_,T=0,M=y;if(o.content&&n){var C=o.content;v=Zl(p,0,C[0]),b=Zl(d,0,C[1]),x=Zl(p,C[0],C[2]),w=Zl(d,C[1],C[3]),S=C[0]-v,T=C[1]-b,E=C[2]-C[0]-x,M=C[3]-C[1]-w}var I=function(n,a,l,c){var p=Xl(n.stretch-v,x,u,t.left),d=Kl(n.fixed-S,E,n.stretch,m),f=Xl(a.stretch-b,w,h,t.top),_=Kl(a.fixed-T,M,a.stretch,g),y=Xl(l.stretch-v,x,u,t.left),C=Kl(l.fixed-S,E,l.stretch,m),I=Xl(c.stretch-b,w,h,t.top),A=Kl(c.fixed-T,M,c.stretch,g),k=new r(p,f),R=new r(y,f),z=new r(y,I),P=new r(p,I),D=new r(d/s,_/s),L=new r(C/s,A/s),B=e*Math.PI/180;if(B){var O=Math.sin(B),F=Math.cos(B),N=[F,-O,O,F];k._matMult(N),R._matMult(N),P._matMult(N),z._matMult(N)}var U=n.stretch+n.fixed,$=a.stretch+a.fixed;return{tl:k,tr:R,bl:P,br:z,tex:{x:o.paddedRect.x+1+U,y:o.paddedRect.y+1+$,w:l.stretch+l.fixed-U,h:c.stretch+c.fixed-$},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:D,pixelOffsetBR:L,minFontScaleX:E/s/u,minFontScaleY:M/s/h,isSDF:i}};if(n&&(o.stretchX||o.stretchY))for(var A=Yl(p,_,m),k=Yl(d,y,g),R=0;R<A.length-1;R++)for(var z=A[R],P=A[R+1],D=0;D<k.length-1;D++)a.push(I(z,k[D],P,k[D+1]));else a.push(I({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:c+1}));return a}function Zl(t,e,i){for(var n=0,r=0,a=t;r<a.length;r+=1){var o=a[r];n+=Math.max(e,Math.min(i,o[1]))-Math.max(e,Math.min(i,o[0]))}return n}function Yl(t,e,i){for(var n=[{fixed:-1,stretch:0}],r=0,a=t;r<a.length;r+=1){var o=a[r],s=o[0],l=o[1],c=n[n.length-1];n.push({fixed:s-c.stretch,stretch:c.stretch}),n.push({fixed:s-c.stretch,stretch:c.stretch+(l-s)})}return n.push({fixed:e+1,stretch:i}),n}function Xl(t,e,i,n){return t/e*i+n}function Kl(t,e,i,n){return t-e*i/n}var Jl=function(t,e,i,n,a,o,s,l,c,u){if(this.boxStartIndex=t.length,c){var h=o.top,p=o.bottom,d=o.collisionPadding;d&&(h-=d[1],p+=d[3]);var f=p-h;f>0&&(f=Math.max(10,f),this.circleDiameter=f)}else{var m=o.top*s-l,g=o.bottom*s+l,_=o.left*s-l,y=o.right*s+l,v=o.collisionPadding;if(v&&(_-=v[0]*s,m-=v[1]*s,y+=v[2]*s,g+=v[3]*s),u){var x=new r(_,m),b=new r(y,m),w=new r(_,g),S=new r(y,g),E=u*Math.PI/180;x._rotate(E),b._rotate(E),w._rotate(E),S._rotate(E),_=Math.min(x.x,b.x,w.x,S.x),y=Math.max(x.x,b.x,w.x,S.x),m=Math.min(x.y,b.y,w.y,S.y),g=Math.max(x.y,b.y,w.y,S.y)}t.emplaceBack(e.x,e.y,_,m,y,g,i,n,a)}this.boxEndIndex=t.length},Ql=function(t,e){if(void 0===t&&(t=[]),void 0===e&&(e=tc),this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)};function tc(t,e){return t<e?-1:t>e?1:0}function ec(t,e,i){void 0===e&&(e=1),void 0===i&&(i=!1);for(var n=1/0,a=1/0,o=-1/0,s=-1/0,l=t[0],c=0;c<l.length;c++){var u=l[c];(!c||u.x<n)&&(n=u.x),(!c||u.y<a)&&(a=u.y),(!c||u.x>o)&&(o=u.x),(!c||u.y>s)&&(s=u.y)}var h=Math.min(o-n,s-a),p=h/2,d=new Ql([],ic);if(0===h)return new r(n,a);for(var f=n;f<o;f+=h)for(var m=a;m<s;m+=h)d.push(new nc(f+p,m+p,p,t));for(var g=function(t){for(var e=0,i=0,n=0,r=t[0],a=0,o=r.length,s=o-1;a<o;s=a++){var l=r[a],c=r[s],u=l.x*c.y-c.x*l.y;i+=(l.x+c.x)*u,n+=(l.y+c.y)*u,e+=3*u}return new nc(i/e,n/e,0,t)}(t),_=d.length;d.length;){var y=d.pop();(y.d>g.d||!g.d)&&(g=y,i&&console.log("found best %d after %d probes",Math.round(1e4*y.d)/1e4,_)),y.max-g.d<=e||(d.push(new nc(y.p.x-(p=y.h/2),y.p.y-p,p,t)),d.push(new nc(y.p.x+p,y.p.y-p,p,t)),d.push(new nc(y.p.x-p,y.p.y+p,p,t)),d.push(new nc(y.p.x+p,y.p.y+p,p,t)),_+=4)}return i&&(console.log("num probes: "+_),console.log("best distance: "+g.d)),g.p}function ic(t,e){return e.max-t.max}function nc(t,e,i,n){this.p=new r(t,e),this.h=i,this.d=function(t,e){for(var i=!1,n=1/0,r=0;r<e.length;r++)for(var a=e[r],o=0,s=a.length,l=s-1;o<s;l=o++){var c=a[o],u=a[l];c.y>t.y!=u.y>t.y&&t.x<(u.x-c.x)*(t.y-c.y)/(u.y-c.y)+c.x&&(i=!i),n=Math.min(n,Xa(t,c,u))}return(i?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}Ql.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},Ql.prototype.pop=function(){if(0!==this.length){var t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}},Ql.prototype.peek=function(){return this.data[0]},Ql.prototype._up=function(t){for(var e=this.data,i=this.compare,n=e[t];t>0;){var r=t-1>>1,a=e[r];if(i(n,a)>=0)break;e[t]=a,t=r}e[t]=n},Ql.prototype._down=function(t){for(var e=this.data,i=this.compare,n=this.length>>1,r=e[t];t<n;){var a=1+(t<<1),o=e[a],s=a+1;if(s<this.length&&i(e[s],o)<0&&(a=s,o=e[s]),i(o,r)>=0)break;e[t]=o,t=a}e[t]=r};var rc=Number.POSITIVE_INFINITY;function ac(t,e){return e[1]!==rc?function(t,e,i){var n=0,r=0;switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":r=i-7;break;case"bottom-right":case"bottom-left":case"bottom":r=7-i}switch(t){case"top-right":case"bottom-right":case"right":n=-e;break;case"top-left":case"bottom-left":case"left":n=e}return[n,r]}(t,e[0],e[1]):function(t,e){var i=0,n=0;e<0&&(e=0);var r=e/Math.sqrt(2);switch(t){case"top-right":case"top-left":n=r-7;break;case"bottom-right":case"bottom-left":n=7-r;break;case"bottom":n=7-e;break;case"top":n=e-7}switch(t){case"top-right":case"bottom-right":i=-r;break;case"top-left":case"bottom-left":i=r;break;case"left":i=e;break;case"right":i=-e}return[i,n]}(t,e[0])}function oc(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function sc(t,e,i,n,a,o,s,l,c,u,h,p,d,f,m){var g=function(t,e,i,n,a,o,s,l){for(var c=n.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,u=[],h=0,p=e.positionedLines;h<p.length;h+=1)for(var d=p[h],f=0,m=d.positionedGlyphs;f<m.length;f+=1){var g=m[f];if(g.rect){var _=g.rect||{},y=4,v=!0,x=1,b=0,w=(a||l)&&g.vertical,S=g.metrics.advance*g.scale/2;if(l&&e.verticalizable&&(b=d.lineOffset/2-(g.imageName?-(24-g.metrics.width*g.scale)/2:24*(g.scale-1))),g.imageName){var E=s[g.imageName];v=E.sdf,y=1/(x=E.pixelRatio)}var T=a?[g.x+S,g.y]:[0,0],M=a?[0,0]:[g.x+S+i[0],g.y+i[1]-b],C=[0,0];w&&(C=M,M=[0,0]);var I=(g.metrics.left-y)*g.scale-S+M[0],A=(-g.metrics.top-y)*g.scale+M[1],k=I+_.w*g.scale/x,R=A+_.h*g.scale/x,z=new r(I,A),P=new r(k,A),D=new r(I,R),L=new r(k,R);if(w){var B=new r(-S,S- -17),O=-Math.PI/2,F=12-S,N=new r(22-F,-(g.imageName?F:0)),U=new(Function.prototype.bind.apply(r,[null].concat(C)));z._rotateAround(O,B)._add(N)._add(U),P._rotateAround(O,B)._add(N)._add(U),D._rotateAround(O,B)._add(N)._add(U),L._rotateAround(O,B)._add(N)._add(U)}if(c){var $=Math.sin(c),V=Math.cos(c),j=[V,-$,$,V];z._matMult(j),P._matMult(j),D._matMult(j),L._matMult(j)}var q=new r(0,0),G=new r(0,0);u.push({tl:z,tr:P,bl:D,br:L,tex:_,writingMode:e.writingMode,glyphOffset:T,sectionIndex:g.sectionIndex,isSDF:v,pixelOffsetTL:q,pixelOffsetBR:G,minFontScaleX:0,minFontScaleY:0})}}return u}(0,i,l,a,o,s,n,t.allowVerticalPlacement),_=t.textSizeData,y=null;"source"===_.kind?(y=[128*a.layout.get("text-size").evaluate(s,{})])[0]>32640&&S(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):"composite"===_.kind&&((y=[128*f.compositeTextSizes[0].evaluate(s,{},m),128*f.compositeTextSizes[1].evaluate(s,{},m)])[0]>32640||y[1]>32640)&&S(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,g,y,l,o,s,u,e,c.lineStartIndex,c.lineLength,d,m);for(var v=0,x=h;v<x.length;v+=1)p[x[v]]=t.text.placedSymbolArray.length-1;return 4*g.length}function lc(t){for(var e in t)return t[e];return null}function cc(t,e,i,n){var r=t.compareText;if(e in r){for(var a=r[e],o=a.length-1;o>=0;o--)if(n.dist(a[o])<i)return!0}else r[e]=[];return r[e].push(n),!1}var uc=xs.VectorTileFeature.types,hc=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function pc(t,e,i,n,r,a,o,s,l,c,u,h,p){var d=s?Math.min(32640,Math.round(s[0])):0,f=s?Math.min(32640,Math.round(s[1])):0;t.emplaceBack(e,i,Math.round(32*n),Math.round(32*r),a,o,(d<<1)+(l?1:0),f,16*c,16*u,256*h,256*p)}function dc(t,e,i){t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i)}function fc(t){for(var e=0,i=t.sections;e<i.length;e+=1)if(Kn(i[e].text))return!0;return!1}var mc=function(t){this.layoutVertexArray=new Dr,this.indexArray=new $r,this.programConfigurations=t,this.segments=new sa,this.dynamicLayoutVertexArray=new Lr,this.opacityVertexArray=new Br,this.placedSymbolArray=new Qr};mc.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length},mc.prototype.upload=function(t,e,i,n){this.isEmpty()||(i&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,$s.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Vs.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,hc,!0),this.opacityVertexBuffer.itemSize=1),(i||n)&&this.programConfigurations.upload(t))},mc.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Fn("SymbolBuffers",mc);var gc=function(t,e,i){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new i,this.segments=new sa,this.collisionVertexArray=new Ur};gc.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,js.members,!0)},gc.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Fn("CollisionBuffers",gc);var _c=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=oo([]),this.placementViewportMatrix=oo([]);var e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Bl(this.zoom,e["text-size"]),this.iconSizeData=Bl(this.zoom,e["icon-size"]);var i=this.layers[0].layout,n=i.get("symbol-sort-key"),r=i.get("symbol-z-order");this.canOverlap=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==r&&void 0!==n.constantOr(1),this.sortFeaturesByY=("viewport-y"===r||"auto"===r&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===i.get("symbol-placement")&&(this.writingModes=i.get("text-writing-mode").map((function(t){return bl[t]}))),this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id})),this.sourceID=t.sourceID};_c.prototype.createArrays=function(){this.text=new mc(new Da(this.layers,this.zoom,(function(t){return/^text/.test(t)}))),this.icon=new mc(new Da(this.layers,this.zoom,(function(t){return/^icon/.test(t)}))),this.glyphOffsetArray=new ia,this.lineVertexArray=new na,this.symbolInstances=new ea},_c.prototype.calculateGlyphDependencies=function(t,e,i,n,r){for(var a=0;a<t.length;a++)if(e[t.charCodeAt(a)]=!0,(i||n)&&r){var o=Ws[t.charAt(a)];o&&(e[o.charCodeAt(0)]=!0)}},_c.prototype.populate=function(t,e,i){var n=this.layers[0],r=n.layout,a=r.get("text-font"),o=r.get("text-field"),s=r.get("icon-image"),l=("constant"!==o.value.kind||o.value.value instanceof ne&&!o.value.value.isEmpty()||o.value.value.toString().length>0)&&("constant"!==a.value.kind||a.value.value.length>0),c="constant"!==s.value.kind||!!s.value.value||Object.keys(s.parameters).length>0,u=r.get("symbol-sort-key");if(this.features=[],l||c){for(var h=e.iconDependencies,p=e.glyphDependencies,d=e.availableImages,f=new sr(this.zoom),m=0,g=t;m<g.length;m+=1){var _=g[m],y=_.feature,v=_.id,x=_.index,b=_.sourceLayerIndex,w=n._featureFilter.needGeometry,S=Ua(y,w);if(n._featureFilter.filter(f,S,i)){w||(S.geometry=Na(y));var E=void 0;if(l){var T=n.getValueAndResolveTokens("text-field",S,i,d),M=ne.factory(T);fc(M)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===rr()||this.hasRTLText&&or.isParsed())&&(E=Hs(M,n,S))}var C=void 0;if(c){var I=n.getValueAndResolveTokens("icon-image",S,i,d);C=I instanceof re?I:re.fromString(I)}if(E||C){var A=this.sortFeaturesByKey?u.evaluate(S,{},i):void 0;if(this.features.push({id:v,text:E,icon:C,index:x,sourceLayerIndex:b,geometry:S.geometry,properties:y.properties,type:uc[y.type],sortKey:A}),C&&(h[C.name]=!0),E){var k=a.evaluate(S,{},i).join(","),R="map"===r.get("text-rotation-alignment")&&"point"!==r.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(bl.vertical)>=0;for(var z=0,P=E.sections;z<P.length;z+=1){var D=P[z];if(D.image)h[D.image.name]=!0;else{var L=Hn(E.toString()),B=D.fontStack||k,O=p[B]=p[B]||{};this.calculateGlyphDependencies(D.text,O,R,this.allowVerticalPlacement,L)}}}}}}"line"===r.get("symbol-placement")&&(this.features=function(t){var e={},i={},n=[],r=0;function a(e){n.push(t[e]),r++}function o(t,e,r){var a=i[t];return delete i[t],i[e]=a,n[a].geometry[0].pop(),n[a].geometry[0]=n[a].geometry[0].concat(r[0]),a}function s(t,i,r){var a=e[i];return delete e[i],e[t]=a,n[a].geometry[0].shift(),n[a].geometry[0]=r[0].concat(n[a].geometry[0]),a}function l(t,e,i){var n=i?e[0][e[0].length-1]:e[0][0];return t+":"+n.x+":"+n.y}for(var c=0;c<t.length;c++){var u=t[c],h=u.geometry,p=u.text?u.text.toString():null;if(p){var d=l(p,h),f=l(p,h,!0);if(d in i&&f in e&&i[d]!==e[f]){var m=s(d,f,h),g=o(d,f,n[m].geometry);delete e[d],delete i[f],i[l(p,n[g].geometry,!0)]=g,n[m].geometry=null}else d in i?o(d,f,h):f in e?s(d,f,h):(a(c),e[d]=r-1,i[f]=r-1)}else a(c)}return n.filter((function(t){return t.geometry}))}(this.features)),this.sortFeaturesByKey&&this.features.sort((function(t,e){return t.sortKey-e.sortKey}))}},_c.prototype.update=function(t,e,i){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,i),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,i))},_c.prototype.isEmpty=function(){return 0===this.symbolInstances.length&&!this.hasRTLText},_c.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},_c.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},_c.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},_c.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},_c.prototype.addToLineVertexArray=function(t,e){var i=this.lineVertexArray.length;if(void 0!==t.segment){for(var n=t.dist(e[t.segment+1]),r=t.dist(e[t.segment]),a={},o=t.segment+1;o<e.length;o++)a[o]={x:e[o].x,y:e[o].y,tileUnitDistanceFromAnchor:n},o<e.length-1&&(n+=e[o+1].dist(e[o]));for(var s=t.segment||0;s>=0;s--)a[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:r},s>0&&(r+=e[s-1].dist(e[s]));for(var l=0;l<e.length;l++){var c=a[l];this.lineVertexArray.emplaceBack(c.x,c.y,c.tileUnitDistanceFromAnchor)}}return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}},_c.prototype.addSymbols=function(t,e,i,n,r,a,o,s,l,c,u,h){for(var p=t.indexArray,d=t.layoutVertexArray,f=t.segments.prepareSegment(4*e.length,d,p,this.canOverlap?a.sortKey:void 0),m=this.glyphOffsetArray.length,g=f.vertexLength,_=this.allowVerticalPlacement&&o===bl.vertical?Math.PI/2:0,y=a.text&&a.text.sections,v=0;v<e.length;v++){var x=e[v],b=x.tl,w=x.tr,S=x.bl,E=x.br,T=x.tex,M=x.pixelOffsetTL,C=x.pixelOffsetBR,I=x.minFontScaleX,A=x.minFontScaleY,k=x.glyphOffset,R=x.isSDF,z=x.sectionIndex,P=f.vertexLength,D=k[1];pc(d,s.x,s.y,b.x,D+b.y,T.x,T.y,i,R,M.x,M.y,I,A),pc(d,s.x,s.y,w.x,D+w.y,T.x+T.w,T.y,i,R,C.x,M.y,I,A),pc(d,s.x,s.y,S.x,D+S.y,T.x,T.y+T.h,i,R,M.x,C.y,I,A),pc(d,s.x,s.y,E.x,D+E.y,T.x+T.w,T.y+T.h,i,R,C.x,C.y,I,A),dc(t.dynamicLayoutVertexArray,s,_),p.emplaceBack(P,P+1,P+2),p.emplaceBack(P+1,P+2,P+3),f.vertexLength+=4,f.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(k[0]),v!==e.length-1&&z===e[v+1].sectionIndex||t.programConfigurations.populatePaintArrays(d.length,a,a.index,{},h,y&&y[z])}t.placedSymbolArray.emplaceBack(s.x,s.y,m,this.glyphOffsetArray.length-m,g,l,c,s.segment,i?i[0]:0,i?i[1]:0,n[0],n[1],o,0,!1,0,u)},_c.prototype._addCollisionDebugVertex=function(t,e,i,n,r,a){return e.emplaceBack(0,0),t.emplaceBack(i.x,i.y,n,r,Math.round(a.x),Math.round(a.y))},_c.prototype.addCollisionDebugVertices=function(t,e,i,n,a,o,s){var l=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),c=l.vertexLength,u=a.layoutVertexArray,h=a.collisionVertexArray,p=s.anchorX,d=s.anchorY;this._addCollisionDebugVertex(u,h,o,p,d,new r(t,e)),this._addCollisionDebugVertex(u,h,o,p,d,new r(i,e)),this._addCollisionDebugVertex(u,h,o,p,d,new r(i,n)),this._addCollisionDebugVertex(u,h,o,p,d,new r(t,n)),l.vertexLength+=4;var f=a.indexArray;f.emplaceBack(c,c+1),f.emplaceBack(c+1,c+2),f.emplaceBack(c+2,c+3),f.emplaceBack(c+3,c),l.primitiveLength+=4},_c.prototype.addDebugCollisionBoxes=function(t,e,i,n){for(var r=t;r<e;r++){var a=this.collisionBoxArray.get(r);this.addCollisionDebugVertices(a.x1,a.y1,a.x2,a.y2,n?this.textCollisionBox:this.iconCollisionBox,a.anchorPoint,i)}},_c.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new gc(Fr,qs.members,Wr),this.iconCollisionBox=new gc(Fr,qs.members,Wr);for(var t=0;t<this.symbolInstances.length;t++){var e=this.symbolInstances.get(t);this.addDebugCollisionBoxes(e.textBoxStartIndex,e.textBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.verticalTextBoxStartIndex,e.verticalTextBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.iconBoxStartIndex,e.iconBoxEndIndex,e,!1),this.addDebugCollisionBoxes(e.verticalIconBoxStartIndex,e.verticalIconBoxEndIndex,e,!1)}},_c.prototype._deserializeCollisionBoxesForSymbol=function(t,e,i,n,r,a,o,s,l){for(var c={},u=e;u<i;u++){var h=t.get(u);c.textBox={x1:h.x1,y1:h.y1,x2:h.x2,y2:h.y2,anchorPointX:h.anchorPointX,anchorPointY:h.anchorPointY},c.textFeatureIndex=h.featureIndex;break}for(var p=n;p<r;p++){var d=t.get(p);c.verticalTextBox={x1:d.x1,y1:d.y1,x2:d.x2,y2:d.y2,anchorPointX:d.anchorPointX,anchorPointY:d.anchorPointY},c.verticalTextFeatureIndex=d.featureIndex;break}for(var f=a;f<o;f++){var m=t.get(f);c.iconBox={x1:m.x1,y1:m.y1,x2:m.x2,y2:m.y2,anchorPointX:m.anchorPointX,anchorPointY:m.anchorPointY},c.iconFeatureIndex=m.featureIndex;break}for(var g=s;g<l;g++){var _=t.get(g);c.verticalIconBox={x1:_.x1,y1:_.y1,x2:_.x2,y2:_.y2,anchorPointX:_.anchorPointX,anchorPointY:_.anchorPointY},c.verticalIconFeatureIndex=_.featureIndex;break}return c},_c.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var e=0;e<this.symbolInstances.length;e++){var i=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}},_c.prototype.hasTextData=function(){return this.text.segments.get().length>0},_c.prototype.hasIconData=function(){return this.icon.segments.get().length>0},_c.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},_c.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},_c.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},_c.prototype.addIndicesForPlacedSymbol=function(t,e){for(var i=t.placedSymbolArray.get(e),n=i.vertexStartIndex+4*i.numGlyphs,r=i.vertexStartIndex;r<n;r+=4)t.indexArray.emplaceBack(r,r+1,r+2),t.indexArray.emplaceBack(r+1,r+2,r+3)},_c.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;for(var e=Math.sin(t),i=Math.cos(t),n=[],r=[],a=[],o=0;o<this.symbolInstances.length;++o){a.push(o);var s=this.symbolInstances.get(o);n.push(0|Math.round(e*s.anchorX+i*s.anchorY)),r.push(s.featureIndex)}return a.sort((function(t,e){return n[t]-n[e]||r[e]-r[t]})),a},_c.prototype.addToSortKeyRanges=function(t,e){var i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===e?i.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})},_c.prototype.sortFeatures=function(t){var e=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var i=0,n=this.symbolInstanceIndexes;i<n.length;i+=1){var r=this.symbolInstances.get(n[i]);this.featureSortOrder.push(r.featureIndex),[r.rightJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.leftJustifiedTextSymbolIndex].forEach((function(t,i,n){t>=0&&n.indexOf(t)===i&&e.addIndicesForPlacedSymbol(e.text,t)})),r.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,r.verticalPlacedTextSymbolIndex),r.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,r.placedIconSymbolIndex),r.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,r.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Fn("SymbolBucket",_c,{omit:["layers","collisionBoxArray","features","compareText"]}),_c.MAX_GLYPHS=65535,_c.addDynamicAttributes=dc;var yc=new br({"symbol-placement":new gr(At.layout_symbol["symbol-placement"]),"symbol-spacing":new gr(At.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new gr(At.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new _r(At.layout_symbol["symbol-sort-key"]),"symbol-z-order":new gr(At.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new gr(At.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new gr(At.layout_symbol["icon-ignore-placement"]),"icon-optional":new gr(At.layout_symbol["icon-optional"]),"icon-rotation-alignment":new gr(At.layout_symbol["icon-rotation-alignment"]),"icon-size":new _r(At.layout_symbol["icon-size"]),"icon-text-fit":new gr(At.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new gr(At.layout_symbol["icon-text-fit-padding"]),"icon-image":new _r(At.layout_symbol["icon-image"]),"icon-rotate":new _r(At.layout_symbol["icon-rotate"]),"icon-padding":new gr(At.layout_symbol["icon-padding"]),"icon-keep-upright":new gr(At.layout_symbol["icon-keep-upright"]),"icon-offset":new _r(At.layout_symbol["icon-offset"]),"icon-anchor":new _r(At.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new gr(At.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new gr(At.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new gr(At.layout_symbol["text-rotation-alignment"]),"text-field":new _r(At.layout_symbol["text-field"]),"text-font":new _r(At.layout_symbol["text-font"]),"text-size":new _r(At.layout_symbol["text-size"]),"text-max-width":new _r(At.layout_symbol["text-max-width"]),"text-line-height":new gr(At.layout_symbol["text-line-height"]),"text-letter-spacing":new _r(At.layout_symbol["text-letter-spacing"]),"text-justify":new _r(At.layout_symbol["text-justify"]),"text-radial-offset":new _r(At.layout_symbol["text-radial-offset"]),"text-variable-anchor":new gr(At.layout_symbol["text-variable-anchor"]),"text-anchor":new _r(At.layout_symbol["text-anchor"]),"text-max-angle":new gr(At.layout_symbol["text-max-angle"]),"text-writing-mode":new gr(At.layout_symbol["text-writing-mode"]),"text-rotate":new _r(At.layout_symbol["text-rotate"]),"text-padding":new gr(At.layout_symbol["text-padding"]),"text-keep-upright":new gr(At.layout_symbol["text-keep-upright"]),"text-transform":new _r(At.layout_symbol["text-transform"]),"text-offset":new _r(At.layout_symbol["text-offset"]),"text-allow-overlap":new gr(At.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new gr(At.layout_symbol["text-ignore-placement"]),"text-optional":new gr(At.layout_symbol["text-optional"])}),vc={paint:new br({"icon-opacity":new _r(At.paint_symbol["icon-opacity"]),"icon-color":new _r(At.paint_symbol["icon-color"]),"icon-halo-color":new _r(At.paint_symbol["icon-halo-color"]),"icon-halo-width":new _r(At.paint_symbol["icon-halo-width"]),"icon-halo-blur":new _r(At.paint_symbol["icon-halo-blur"]),"icon-translate":new gr(At.paint_symbol["icon-translate"]),"icon-translate-anchor":new gr(At.paint_symbol["icon-translate-anchor"]),"text-opacity":new _r(At.paint_symbol["text-opacity"]),"text-color":new _r(At.paint_symbol["text-color"],{runtimeType:$t,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new _r(At.paint_symbol["text-halo-color"]),"text-halo-width":new _r(At.paint_symbol["text-halo-width"]),"text-halo-blur":new _r(At.paint_symbol["text-halo-blur"]),"text-translate":new gr(At.paint_symbol["text-translate"]),"text-translate-anchor":new gr(At.paint_symbol["text-translate-anchor"])}),layout:yc},xc=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Ot,this.defaultValue=t};xc.prototype.evaluate=function(t){if(t.formattedSection){var e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},xc.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},xc.prototype.outputDefined=function(){return!1},xc.prototype.serialize=function(){return null},Fn("FormatSectionOverride",xc,{omit:["defaultValue"]});var bc=function(t){function e(e){t.call(this,e,vc)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.recalculate=function(e,i){if(t.prototype.recalculate.call(this,e,i),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){var n=this.layout.get("text-writing-mode");if(n){for(var r=[],a=0,o=n;a<o.length;a+=1){var s=o[a];r.indexOf(s)<0&&r.push(s)}this.layout._values["text-writing-mode"]=r}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},e.prototype.getValueAndResolveTokens=function(t,e,i,n){var r=this.layout.get(t).evaluate(e,{},i,n),a=this._unevaluatedLayout._values[t];return a.isDataDriven()||Gi(a.value)||!r?r:function(t,e){return e.replace(/{([^{}]+)}/g,(function(e,i){return i in t?String(t[i]):""}))}(e.properties,r)},e.prototype.createBucket=function(t){return new _c(t)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype._setPaintOverrides=function(){for(var t=0,i=vc.paint.overridableProperties;t<i.length;t+=1){var n=i[t];if(e.hasPaintOverride(this.layout,n)){var r,a=this.paint.get(n),o=new xc(a),s=new qi(o,a.property.specification);r="constant"===a.value.kind||"source"===a.value.kind?new Wi("source",s):new Zi("composite",s,a.value.zoomStops,a.value._interpolationType),this.paint._values[n]=new fr(a.property,r,a.parameters)}}},e.prototype._handleOverridablePaintPropertyUpdate=function(t,i,n){return!(!this.layout||i.isDataDriven()||n.isDataDriven())&&e.hasPaintOverride(this.layout,t)},e.hasPaintOverride=function(t,e){var i=t.get("text-field"),n=vc.paint.properties[e],r=!1,a=function(t){for(var e=0,i=t;e<i.length;e+=1)if(n.overrides&&n.overrides.hasOverride(i[e]))return void(r=!0)};if("constant"===i.value.kind&&i.value.value instanceof ne)a(i.value.value.sections);else if("source"===i.value.kind){var o=function(t){r||(t instanceof ce&&se(t.value)===Gt?a(t.value.sections):t instanceof de?a(t.sections):t.eachChild(o))},s=i.value;s._styleExpression&&o(s._styleExpression.expression)}return r},e}(wr),wc={paint:new br({"background-color":new gr(At.paint_background["background-color"]),"background-pattern":new vr(At.paint_background["background-pattern"]),"background-opacity":new gr(At.paint_background["background-opacity"])})},Sc=function(t){function e(e){t.call(this,e,wc)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(wr),Ec={paint:new br({"raster-opacity":new gr(At.paint_raster["raster-opacity"]),"raster-hue-rotate":new gr(At.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new gr(At.paint_raster["raster-brightness-min"]),"raster-brightness-max":new gr(At.paint_raster["raster-brightness-max"]),"raster-saturation":new gr(At.paint_raster["raster-saturation"]),"raster-contrast":new gr(At.paint_raster["raster-contrast"]),"raster-resampling":new gr(At.paint_raster["raster-resampling"]),"raster-fade-duration":new gr(At.paint_raster["raster-fade-duration"])})},Tc=function(t){function e(e){t.call(this,e,Ec)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(wr),Mc=function(t){function e(e){t.call(this,e,{}),this.implementation=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.is3D=function(){return"3d"===this.implementation.renderingMode},e.prototype.hasOffscreenPass=function(){return void 0!==this.implementation.prerender},e.prototype.recalculate=function(){},e.prototype.updateTransitions=function(){},e.prototype.hasTransition=function(){},e.prototype.serialize=function(){},e.prototype.onAdd=function(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)},e.prototype.onRemove=function(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)},e}(wr),Cc={circle:ho,heatmap:wo,hillshade:Eo,fill:us,"fill-extrusion":Cs,line:Ns,symbol:bc,background:Sc,raster:Tc},Ic=o.HTMLImageElement,Ac=o.HTMLCanvasElement,kc=o.HTMLVideoElement,Rc=o.ImageData,zc=o.ImageBitmap,Pc=function(t,e,i,n){this.context=t,this.format=i,this.texture=t.gl.createTexture(),this.update(e,n)};Pc.prototype.update=function(t,e,i){var n=t.width,r=t.height,a=!(this.size&&this.size[0]===n&&this.size[1]===r||i),o=this.context,s=o.gl;if(this.useMipmap=Boolean(e&&e.useMipmap),s.bindTexture(s.TEXTURE_2D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!e||!1!==e.premultiply)),a)this.size=[n,r],t instanceof Ic||t instanceof Ac||t instanceof kc||t instanceof Rc||zc&&t instanceof zc?s.texImage2D(s.TEXTURE_2D,0,this.format,this.format,s.UNSIGNED_BYTE,t):s.texImage2D(s.TEXTURE_2D,0,this.format,n,r,0,this.format,s.UNSIGNED_BYTE,t.data);else{var l=i||{x:0,y:0},c=l.x,u=l.y;t instanceof Ic||t instanceof Ac||t instanceof kc||t instanceof Rc||zc&&t instanceof zc?s.texSubImage2D(s.TEXTURE_2D,0,c,u,s.RGBA,s.UNSIGNED_BYTE,t):s.texSubImage2D(s.TEXTURE_2D,0,c,u,n,r,s.RGBA,s.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&s.generateMipmap(s.TEXTURE_2D)},Pc.prototype.bind=function(t,e,i){var n=this.context.gl;n.bindTexture(n.TEXTURE_2D,this.texture),i!==n.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(i=n.LINEAR),t!==this.filter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,i||t),this.filter=t),e!==this.wrap&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,e),this.wrap=e)},Pc.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Pc.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Dc=function(t){var e=this;this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){e._triggered=!1,e._callback()})};Dc.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((function(){t._triggered=!1,t._callback()}),0))},Dc.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Lc=function(t,e,i){this.target=t,this.parent=e,this.mapId=i,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},_(["receive","process"],this),this.invoker=new Dc(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=M()?t:o};function Bc(t,e,i){var n=2*Math.PI*6378137/256/Math.pow(2,i);return[t*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}Lc.prototype.send=function(t,e,i,n,r){var a=this;void 0===r&&(r=!1);var o=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(this.callbacks[o]=i);var s=A(this.globalScope)?void 0:[];return this.target.postMessage({id:o,type:t,hasCallback:!!i,targetMapId:n,mustQueue:r,sourceMapId:this.mapId,data:Vn(e,s)},s),{cancel:function(){i&&delete a.callbacks[o],a.target.postMessage({id:o,type:"<cancel>",targetMapId:n,sourceMapId:a.mapId})}}},Lc.prototype.receive=function(t){var e=t.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){delete this.tasks[i];var n=this.cancelCallbacks[i];delete this.cancelCallbacks[i],n&&n()}else M()||e.mustQueue?(this.tasks[i]=e,this.taskQueue.push(i),this.invoker.trigger()):this.processTask(i,e)},Lc.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),e=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(t,e)}},Lc.prototype.processTask=function(t,e){var i=this;if("<response>"===e.type){var n=this.callbacks[t];delete this.callbacks[t],n&&(e.error?n(jn(e.error)):n(null,jn(e.data)))}else{var r=!1,a=A(this.globalScope)?void 0:[],o=e.hasCallback?function(e,n){r=!0,delete i.cancelCallbacks[t],i.target.postMessage({id:t,type:"<response>",sourceMapId:i.mapId,error:e?Vn(e):null,data:Vn(n,a)},a)}:function(t){r=!0},s=null,l=jn(e.data);if(this.parent[e.type])s=this.parent[e.type](e.sourceMapId,l,o);else if(this.parent.getWorkerSource){var c=e.type.split(".");s=this.parent.getWorkerSource(e.sourceMapId,c[0],l.source)[c[1]](l,o)}else o(new Error("Could not find function "+e.type));!r&&s&&s.cancel&&(this.cancelCallbacks[t]=s.cancel)}},Lc.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Oc=function(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};Oc.prototype.setNorthEast=function(t){return this._ne=t instanceof Fc?new Fc(t.lng,t.lat):Fc.convert(t),this},Oc.prototype.setSouthWest=function(t){return this._sw=t instanceof Fc?new Fc(t.lng,t.lat):Fc.convert(t),this},Oc.prototype.extend=function(t){var e,i,n=this._sw,r=this._ne;if(t instanceof Fc)e=t,i=t;else{if(!(t instanceof Oc))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(Oc.convert(t)):this.extend(Fc.convert(t)):this;if(i=t._ne,!(e=t._sw)||!i)return this}return n||r?(n.lng=Math.min(e.lng,n.lng),n.lat=Math.min(e.lat,n.lat),r.lng=Math.max(i.lng,r.lng),r.lat=Math.max(i.lat,r.lat)):(this._sw=new Fc(e.lng,e.lat),this._ne=new Fc(i.lng,i.lat)),this},Oc.prototype.getCenter=function(){return new Fc((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Oc.prototype.getSouthWest=function(){return this._sw},Oc.prototype.getNorthEast=function(){return this._ne},Oc.prototype.getNorthWest=function(){return new Fc(this.getWest(),this.getNorth())},Oc.prototype.getSouthEast=function(){return new Fc(this.getEast(),this.getSouth())},Oc.prototype.getWest=function(){return this._sw.lng},Oc.prototype.getSouth=function(){return this._sw.lat},Oc.prototype.getEast=function(){return this._ne.lng},Oc.prototype.getNorth=function(){return this._ne.lat},Oc.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Oc.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Oc.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Oc.prototype.contains=function(t){var e=Fc.convert(t),i=e.lng,n=e.lat,r=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(r=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&r},Oc.convert=function(t){return!t||t instanceof Oc?t:new Oc(t)};var Fc=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: ("+t+", "+e+")");if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Fc.prototype.wrap=function(){return new Fc(h(this.lng,-180,180),this.lat)},Fc.prototype.toArray=function(){return[this.lng,this.lat]},Fc.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Fc.prototype.distanceTo=function(t){var e=Math.PI/180,i=this.lat*e,n=t.lat*e,r=Math.sin(i)*Math.sin(n)+Math.cos(i)*Math.cos(n)*Math.cos((t.lng-this.lng)*e);return 6371008.8*Math.acos(Math.min(r,1))},Fc.prototype.toBounds=function(t){void 0===t&&(t=0);var e=360*t/40075017,i=e/Math.cos(Math.PI/180*this.lat);return new Oc(new Fc(this.lng-i,this.lat-e),new Fc(this.lng+i,this.lat+e))},Fc.convert=function(t){if(t instanceof Fc)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new Fc(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new Fc(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Nc=2*Math.PI*6371008.8;function Uc(t){return Nc*Math.cos(t*Math.PI/180)}function $c(t){return(180+t)/360}function Vc(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function jc(t,e){return t/Uc(e)}function qc(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var Gc=function(t,e,i){void 0===i&&(i=0),this.x=+t,this.y=+e,this.z=+i};Gc.fromLngLat=function(t,e){void 0===e&&(e=0);var i=Fc.convert(t);return new Gc($c(i.lng),Vc(i.lat),jc(e,i.lat))},Gc.prototype.toLngLat=function(){return new Fc(360*this.x-180,qc(this.y))},Gc.prototype.toAltitude=function(){return this.z*Uc(qc(this.y))},Gc.prototype.meterInMercatorCoordinateUnits=function(){return 1/Nc*(t=qc(this.y),1/Math.cos(t*Math.PI/180));var t};var Hc=function(t,e,i){this.z=t,this.x=e,this.y=i,this.key=Yc(0,t,t,e,i)};Hc.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},Hc.prototype.url=function(t,e){var i,n,r,a,o,s=(n=this.y,r=this.z,a=Bc(256*(i=this.x),256*(n=Math.pow(2,r)-n-1),r),o=Bc(256*(i+1),256*(n+1),r),a[0]+","+a[1]+","+o[0]+","+o[1]),l=function(t,e,i){for(var n,r="",a=t;a>0;a--)r+=(e&(n=1<<a-1)?1:0)+(i&n?2:0);return r}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",s)},Hc.prototype.getTilePoint=function(t){var e=Math.pow(2,this.z);return new r(8192*(t.x*e-this.x),8192*(t.y*e-this.y))},Hc.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Wc=function(t,e){this.wrap=t,this.canonical=e,this.key=Yc(t,e.z,e.z,e.x,e.y)},Zc=function(t,e,i,n,r){this.overscaledZ=t,this.wrap=e,this.canonical=new Hc(i,+n,+r),this.key=Yc(e,t,i,n,r)};function Yc(t,e,i,n,r){(t*=2)<0&&(t=-1*t-1);var a=1<<i;return(a*a*t+a*r+n).toString(36)+i.toString(36)+e.toString(36)}Zc.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},Zc.prototype.scaledTo=function(t){var e=this.canonical.z-t;return t>this.canonical.z?new Zc(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Zc(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)},Zc.prototype.calculateScaledKey=function(t,e){var i=this.canonical.z-t;return t>this.canonical.z?Yc(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y):Yc(this.wrap*+e,t,t,this.canonical.x>>i,this.canonical.y>>i)},Zc.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e},Zc.prototype.children=function(t){if(this.overscaledZ>=t)return[new Zc(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var e=this.canonical.z+1,i=2*this.canonical.x,n=2*this.canonical.y;return[new Zc(e,this.wrap,e,i,n),new Zc(e,this.wrap,e,i+1,n),new Zc(e,this.wrap,e,i,n+1),new Zc(e,this.wrap,e,i+1,n+1)]},Zc.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},Zc.prototype.wrapped=function(){return new Zc(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Zc.prototype.unwrapTo=function(t){return new Zc(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},Zc.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Zc.prototype.toUnwrapped=function(){return new Wc(this.wrap,this.canonical)},Zc.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Zc.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new Gc(t.x-this.wrap,t.y))},Fn("CanonicalTileID",Hc),Fn("OverscaledTileID",Zc,{omit:["posMatrix"]});var Xc=function(t,e,i){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(i&&"mapbox"!==i&&"terrarium"!==i)return S('"'+i+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=e.height;var n=this.dim=e.height-2;this.data=new Uint32Array(e.data.buffer),this.encoding=i||"mapbox";for(var r=0;r<n;r++)this.data[this._idx(-1,r)]=this.data[this._idx(0,r)],this.data[this._idx(n,r)]=this.data[this._idx(n-1,r)],this.data[this._idx(r,-1)]=this.data[this._idx(r,0)],this.data[this._idx(r,n)]=this.data[this._idx(r,n-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(n,-1)]=this.data[this._idx(n-1,0)],this.data[this._idx(-1,n)]=this.data[this._idx(0,n-1)],this.data[this._idx(n,n)]=this.data[this._idx(n-1,n-1)]};Xc.prototype.get=function(t,e){var i=new Uint8Array(this.data.buffer),n=4*this._idx(t,e);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(i[n],i[n+1],i[n+2])},Xc.prototype.getUnpackVector=function(){return"terrarium"===this.encoding?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Xc.prototype._idx=function(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)},Xc.prototype._unpackMapbox=function(t,e,i){return(256*t*256+256*e+i)/10-1e4},Xc.prototype._unpackTerrarium=function(t,e,i){return 256*t+e+i/256-32768},Xc.prototype.getPixels=function(){return new vo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Xc.prototype.backfillBorder=function(t,e,i){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var n=e*this.dim,r=e*this.dim+this.dim,a=i*this.dim,o=i*this.dim+this.dim;switch(e){case-1:n=r-1;break;case 1:r=n+1}switch(i){case-1:a=o-1;break;case 1:o=a+1}for(var s=-e*this.dim,l=-i*this.dim,c=a;c<o;c++)for(var u=n;u<r;u++)this.data[this._idx(u,c)]=t.data[this._idx(u+s,c+l)]},Fn("DEMData",Xc);var Kc=function(t){this._stringToNumber={},this._numberToString=[];for(var e=0;e<t.length;e++){var i=t[e];this._stringToNumber[i]=e,this._numberToString[e]=i}};Kc.prototype.encode=function(t){return this._stringToNumber[t]},Kc.prototype.decode=function(t){return this._numberToString[t]};var Jc=function(t,e,i,n,r){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=i,t._y=n,this.properties=t.properties,this.id=r},Qc={geometry:{configurable:!0}};Qc.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Qc.geometry.set=function(t){this._geometry=t},Jc.prototype.toJSON=function(){var t={geometry:this.geometry};for(var e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t},Object.defineProperties(Jc.prototype,Qc);var tu=function(){this.state={},this.stateChanges={},this.deletedStates={}};tu.prototype.updateState=function(t,e,i){var n=String(e);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][n]=this.stateChanges[t][n]||{},p(this.stateChanges[t][n],i),null===this.deletedStates[t])for(var r in this.deletedStates[t]={},this.state[t])r!==n&&(this.deletedStates[t][r]=null);else if(this.deletedStates[t]&&null===this.deletedStates[t][n])for(var a in this.deletedStates[t][n]={},this.state[t][n])i[a]||(this.deletedStates[t][n][a]=null);else for(var o in i)this.deletedStates[t]&&this.deletedStates[t][n]&&null===this.deletedStates[t][n][o]&&delete this.deletedStates[t][n][o]},tu.prototype.removeFeatureState=function(t,e,i){if(null!==this.deletedStates[t]){var n=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},i&&void 0!==e)null!==this.deletedStates[t][n]&&(this.deletedStates[t][n]=this.deletedStates[t][n]||{},this.deletedStates[t][n][i]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][n])for(i in this.deletedStates[t][n]={},this.stateChanges[t][n])this.deletedStates[t][n][i]=null;else this.deletedStates[t][n]=null;else this.deletedStates[t]=null}},tu.prototype.getState=function(t,e){var i=String(e),n=p({},(this.state[t]||{})[i],(this.stateChanges[t]||{})[i]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){var r=this.deletedStates[t][e];if(null===r)return{};for(var a in r)delete n[a]}return n},tu.prototype.initializeTileState=function(t,e){t.setFeatureState(this.state,e)},tu.prototype.coalesceChanges=function(t,e){var i={};for(var n in this.stateChanges){this.state[n]=this.state[n]||{};var r={};for(var a in this.stateChanges[n])this.state[n][a]||(this.state[n][a]={}),p(this.state[n][a],this.stateChanges[n][a]),r[a]=this.state[n][a];i[n]=r}for(var o in this.deletedStates){this.state[o]=this.state[o]||{};var s={};if(null===this.deletedStates[o])for(var l in this.state[o])s[l]={},this.state[o][l]={};else for(var c in this.deletedStates[o]){if(null===this.deletedStates[o][c])this.state[o][c]={};else for(var u=0,h=Object.keys(this.deletedStates[o][c]);u<h.length;u+=1)delete this.state[o][c][h[u]];s[c]=this.state[o][c]}i[o]=i[o]||{},p(i[o],s)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(i).length)for(var d in t)t[d].setFeatureState(i,e)};var eu=function(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Pn(8192,16,0),this.grid3D=new Pn(8192,16,0),this.featureIndexArray=new aa,this.promoteId=e};function iu(t,e,i,n,r){return v(t,(function(t,a){var o=e instanceof mr?e.get(a):null;return o&&o.evaluate?o.evaluate(i,n,r):o}))}function nu(t){for(var e=1/0,i=1/0,n=-1/0,r=-1/0,a=0,o=t;a<o.length;a+=1){var s=o[a];e=Math.min(e,s.x),i=Math.min(i,s.y),n=Math.max(n,s.x),r=Math.max(r,s.y)}return{minX:e,minY:i,maxX:n,maxY:r}}function ru(t,e){return e-t}eu.prototype.insert=function(t,e,i,n,r,a){var o=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,n,r);for(var s=a?this.grid3D:this.grid,l=0;l<e.length;l++){for(var c=e[l],u=[1/0,1/0,-1/0,-1/0],h=0;h<c.length;h++){var p=c[h];u[0]=Math.min(u[0],p.x),u[1]=Math.min(u[1],p.y),u[2]=Math.max(u[2],p.x),u[3]=Math.max(u[3],p.y)}u[0]<8192&&u[1]<8192&&u[2]>=0&&u[3]>=0&&s.insert(o,u[0],u[1],u[2],u[3])}},eu.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new xs.VectorTile(new Xs(this.rawTileData)).layers,this.sourceLayerCoder=new Kc(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},eu.prototype.query=function(t,e,i,n){var a=this;this.loadVTLayers();for(var o=t.params||{},s=8192/t.tileSize/t.scale,l=on(o.filter),c=t.queryGeometry,u=t.queryPadding*s,h=nu(c),p=this.grid.query(h.minX-u,h.minY-u,h.maxX+u,h.maxY+u),d=nu(t.cameraQueryGeometry),f=this.grid3D.query(d.minX-u,d.minY-u,d.maxX+u,d.maxY+u,(function(e,i,n,a){return function(t,e,i,n,a){for(var o=0,s=t;o<s.length;o+=1){var l=s[o];if(e<=l.x&&i<=l.y&&n>=l.x&&a>=l.y)return!0}var c=[new r(e,i),new r(e,a),new r(n,a),new r(n,i)];if(t.length>2)for(var u=0,h=c;u<h.length;u+=1)if(Ja(t,h[u]))return!0;for(var p=0;p<t.length-1;p++)if(Qa(t[p],t[p+1],c))return!0;return!1}(t.cameraQueryGeometry,e-u,i-u,n+u,a+u)})),m=0,g=f;m<g.length;m+=1)p.push(g[m]);p.sort(ru);for(var _,y={},v=function(r){var u=p[r];if(u!==_){_=u;var h=a.featureIndexArray.get(u),d=null;a.loadMatchingFeature(y,h.bucketIndex,h.sourceLayerIndex,h.featureIndex,l,o.layers,o.availableImages,e,i,n,(function(e,i,n){return d||(d=Na(e)),i.queryIntersectsFeature(c,e,n,d,a.z,t.transform,s,t.pixelPosMatrix)}))}},x=0;x<p.length;x++)v(x);return y},eu.prototype.loadMatchingFeature=function(t,e,i,n,r,a,o,s,l,c,u){var h=this.bucketLayerIDs[e];if(!a||function(t,e){for(var i=0;i<t.length;i++)if(e.indexOf(t[i])>=0)return!0;return!1}(a,h)){var d=this.sourceLayerCoder.decode(i),f=this.vtLayers[d].feature(n);if(r.needGeometry){var m=Ua(f,!0);if(!r.filter(new sr(this.tileID.overscaledZ),m,this.tileID.canonical))return}else if(!r.filter(new sr(this.tileID.overscaledZ),f))return;for(var g=this.getId(f,d),_=0;_<h.length;_++){var y=h[_];if(!(a&&a.indexOf(y)<0)){var v=s[y];if(v){var x={};void 0!==g&&c&&(x=c.getState(v.sourceLayer||"_geojsonTileLayer",g));var b=p({},l[y]);b.paint=iu(b.paint,v.paint,f,x,o),b.layout=iu(b.layout,v.layout,f,x,o);var w=!u||u(f,v,x);if(w){var S=new Jc(f,this.z,this.x,this.y,g);S.layer=b;var E=t[y];void 0===E&&(E=t[y]=[]),E.push({featureIndex:n,feature:S,intersectionZ:w})}}}}}},eu.prototype.lookupSymbolFeatures=function(t,e,i,n,r,a,o,s){var l={};this.loadVTLayers();for(var c=on(r),u=0,h=t;u<h.length;u+=1)this.loadMatchingFeature(l,i,n,h[u],c,a,o,s,e);return l},eu.prototype.hasLayer=function(t){for(var e=0,i=this.bucketLayerIDs;e<i.length;e+=1)for(var n=0,r=i[e];n<r.length;n+=1)if(t===r[n])return!0;return!1},eu.prototype.getId=function(t,e){var i=t.id;return this.promoteId&&"boolean"==typeof(i=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[e]])&&(i=Number(i)),i},Fn("FeatureIndex",eu,{omit:["rawTileData","sourceLayerCoder"]});var au=function(t,e){this.tileID=t,this.uid=f(),this.uses=0,this.tileSize=e,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};au.prototype.registerFadeDuration=function(t){var e=t+this.timeAdded;e<F.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)},au.prototype.wasRequested=function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state},au.prototype.loadVectorData=function(t,e,i){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var n in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){var i={};if(!e)return i;for(var n=function(){var t=a[r],n=t.layerIds.map((function(t){return e.getLayer(t)})).filter(Boolean);if(0!==n.length){t.layers=n,t.stateDependentLayerIds&&(t.stateDependentLayers=t.stateDependentLayerIds.map((function(t){return n.filter((function(e){return e.id===t}))[0]})));for(var o=0,s=n;o<s.length;o+=1)i[s[o].id]=t}},r=0,a=t;r<a.length;r+=1)n();return i}(t.buckets,e.style),this.hasSymbolBuckets=!1,this.buckets){var r=this.buckets[n];if(r instanceof _c){if(this.hasSymbolBuckets=!0,!i)break;r.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var a in this.buckets){var o=this.buckets[a];if(o instanceof _c&&o.hasRTLText){this.hasRTLText=!0,or.isLoading()||or.isLoaded()||"deferred"!==rr()||ar();break}}for(var s in this.queryPadding=0,this.buckets){var l=this.buckets[s];this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(s).queryRadius(l))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new Kr},au.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},au.prototype.getBucket=function(t){return this.buckets[t.id]},au.prototype.upload=function(t){for(var e in this.buckets){var i=this.buckets[e];i.uploadPending()&&i.upload(t)}var n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Pc(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Pc(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)},au.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},au.prototype.queryRenderedFeatures=function(t,e,i,n,r,a,o,s,l,c){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:n,cameraQueryGeometry:r,scale:a,tileSize:this.tileSize,pixelPosMatrix:c,transform:s,params:o,queryPadding:this.queryPadding*l},t,e,i):{}},au.prototype.querySourceFeatures=function(t,e){var i=this.latestFeatureIndex;if(i&&i.rawTileData){var n=i.loadVTLayers(),r=e?e.sourceLayer:"",a=n._geojsonTileLayer||n[r];if(a)for(var o=on(e&&e.filter),s=this.tileID.canonical,l=s.z,c=s.x,u=s.y,h={z:l,x:c,y:u},p=0;p<a.length;p++){var d=a.feature(p);if(o.needGeometry){var f=Ua(d,!0);if(!o.filter(new sr(this.tileID.overscaledZ),f,this.tileID.canonical))continue}else if(!o.filter(new sr(this.tileID.overscaledZ),d))continue;var m=i.getId(d,r),g=new Jc(d,l,c,u,m);g.tile=h,t.push(g)}}},au.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},au.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},au.prototype.setExpiryData=function(t){var e=this.expirationTime;if(t.cacheControl){var i=C(t.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var n=Date.now(),r=!1;if(this.expirationTime>n)r=!1;else if(e)if(this.expirationTime<e)r=!0;else{var a=this.expirationTime-e;a?this.expirationTime=n+Math.max(a,3e4):r=!0}else r=!0;r?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},au.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)},au.prototype.setFeatureState=function(t,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(t).length){var i=this.latestFeatureIndex.loadVTLayers();for(var n in this.buckets)if(e.style.hasLayer(n)){var r=this.buckets[n],a=r.layers[0].sourceLayer||"_geojsonTileLayer",o=i[a],s=t[a];if(o&&s&&0!==Object.keys(s).length){r.update(s,o,this.imageAtlas&&this.imageAtlas.patternPositions||{});var l=e&&e.style&&e.style.getLayer(n);l&&(this.queryPadding=Math.max(this.queryPadding,l.queryRadius(r)))}}}},au.prototype.holdingForFade=function(){return void 0!==this.symbolFadeHoldUntil},au.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<F.now()},au.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},au.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=F.now()+t},au.prototype.setDependencies=function(t,e){for(var i={},n=0,r=e;n<r.length;n+=1)i[r[n]]=!0;this.dependencies[t]=i},au.prototype.hasDependency=function(t,e){for(var i=0,n=t;i<n.length;i+=1){var r=this.dependencies[n[i]];if(r)for(var a=0,o=e;a<o.length;a+=1)if(r[o[a]])return!0}return!1};var ou=o.performance,su=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},ou.mark(this._marks.start)};su.prototype.finish=function(){ou.mark(this._marks.end);var t=ou.getEntriesByName(this._marks.measure);return 0===t.length&&(ou.measure(this._marks.measure,this._marks.start,this._marks.end),t=ou.getEntriesByName(this._marks.measure),ou.clearMarks(this._marks.start),ou.clearMarks(this._marks.end),ou.clearMeasures(this._marks.measure)),t},t.Actor=Lc,t.AlphaImage=yo,t.CanonicalTileID=Hc,t.CollisionBoxArray=Kr,t.Color=te,t.DEMData=Xc,t.DataConstantProperty=gr,t.DictionaryCoder=Kc,t.EXTENT=8192,t.ErrorEvent=Ct,t.EvaluationParameters=sr,t.Event=Mt,t.Evented=It,t.FeatureIndex=eu,t.FillBucket=ss,t.FillExtrusionBucket=Es,t.ImageAtlas=xl,t.ImagePosition=yl,t.LineBucket=Ls,t.LngLat=Fc,t.LngLatBounds=Oc,t.MercatorCoordinate=Gc,t.ONE_EM=24,t.OverscaledTileID=Zc,t.Point=r,t.Point$1=r,t.Properties=br,t.Protobuf=Xs,t.RGBAImage=vo,t.RequestManager=G,t.RequestPerformance=su,t.ResourceType=ft,t.SegmentVector=sa,t.SourceFeatureState=tu,t.StructArrayLayout1ui2=Zr,t.StructArrayLayout2f1f2i16=Nr,t.StructArrayLayout2i4=Ir,t.StructArrayLayout3ui6=$r,t.StructArrayLayout4i8=Ar,t.SymbolBucket=_c,t.Texture=Pc,t.Tile=au,t.Transitionable=ur,t.Uniform1f=xa,t.Uniform1i=va,t.Uniform2f=ba,t.Uniform3f=wa,t.Uniform4f=Sa,t.UniformColor=Ea,t.UniformMatrix4f=Ma,t.UnwrappedTileID=Wc,t.ValidationError=kt,t.WritingMode=bl,t.ZoomHistory=qn,t.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},t.addDynamicAttributes=dc,t.asyncAll=function(t,e,i){if(!t.length)return i(null,[]);var n=t.length,r=new Array(t.length),a=null;t.forEach((function(t,o){e(t,(function(t,e){t&&(a=t),r[o]=e,0==--n&&i(a,r)}))}))},t.bezier=l,t.bindAll=_,t.browser=F,t.cacheEntryPossiblyAdded=function(t){++pt>lt&&(t.getActor().send("enforceCacheSizeLimit",st),pt=0)},t.clamp=u,t.clearTileCache=function(t){var e=o.caches.delete("mapbox-tiles");t&&e.catch(t).then((function(){return t()}))},t.clipLine=Hl,t.clone=function(t){var e=new ao(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.clone$1=b,t.clone$2=function(t){var e=new ao(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},t.collisionCircleLayout=Gs,t.config=N,t.create=function(){var t=new ao(16);return ao!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},t.create$1=function(){var t=new ao(9);return ao!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},t.create$2=function(){var t=new ao(4);return ao!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},t.createCommonjsModule=e,t.createExpression=Hi,t.createLayout=Mr,t.createStyleLayer=function(t){return"custom"===t.type?new Mc(t):new Cc[t.type](t)},t.cross=function(t,e,i){var n=e[0],r=e[1],a=e[2],o=i[0],s=i[1],l=i[2];return t[0]=r*l-a*s,t[1]=a*o-n*l,t[2]=n*s-r*o,t},t.deepEqual=function t(e,i){if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return!1;for(var n=0;n<e.length;n++)if(!t(e[n],i[n]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==i){if("object"!=typeof i)return!1;if(Object.keys(e).length!==Object.keys(i).length)return!1;for(var r in e)if(!t(e[r],i[r]))return!1;return!0}return e===i},t.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},t.dot$1=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},t.ease=c,t.emitValidationErrors=zn,t.endsWith=y,t.enforceCacheSizeLimit=function(t){ct(),tt&&tt.then((function(e){e.keys().then((function(i){for(var n=0;n<i.length-t;n++)e.delete(i[n])}))}))},t.evaluateSizeForFeature=Ol,t.evaluateSizeForZoom=Fl,t.evaluateVariableOffset=ac,t.evented=nr,t.extend=p,t.featureFilter=on,t.filterObject=x,t.fromRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=0,t[3]=-i,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.getAnchorAlignment=zl,t.getAnchorJustification=oc,t.getArrayBuffer=xt,t.getImage=St,t.getJSON=function(t,e){return vt(p(t,{type:"json"}),e)},t.getRTLTextPluginStatus=rr,t.getReferrer=yt,t.getVideo=function(t,e){var i,n,r=o.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(var a=0;a<t.length;a++){var s=o.document.createElement("source");i=t[a],n=void 0,(n=o.document.createElement("a")).href=i,(n.protocol!==o.document.location.protocol||n.host!==o.document.location.host)&&(r.crossOrigin="Anonymous"),s.src=t[a],r.appendChild(s)}return{cancel:function(){}}},t.identity=oo,t.invert=function(t,e){var i=e[0],n=e[1],r=e[2],a=e[3],o=e[4],s=e[5],l=e[6],c=e[7],u=e[8],h=e[9],p=e[10],d=e[11],f=e[12],m=e[13],g=e[14],_=e[15],y=i*s-n*o,v=i*l-r*o,x=i*c-a*o,b=n*l-r*s,w=n*c-a*s,S=r*c-a*l,E=u*m-h*f,T=u*g-p*f,M=u*_-d*f,C=h*g-p*m,I=h*_-d*m,A=p*_-d*g,k=y*A-v*I+x*C+b*M-w*T+S*E;return k?(t[0]=(s*A-l*I+c*C)*(k=1/k),t[1]=(r*I-n*A-a*C)*k,t[2]=(m*S-g*w+_*b)*k,t[3]=(p*w-h*S-d*b)*k,t[4]=(l*M-o*A-c*T)*k,t[5]=(i*A-r*M+a*T)*k,t[6]=(g*x-f*S-_*v)*k,t[7]=(u*S-p*x+d*v)*k,t[8]=(o*I-s*M+c*E)*k,t[9]=(n*M-i*I-a*E)*k,t[10]=(f*w-m*x+_*y)*k,t[11]=(h*x-u*w-d*y)*k,t[12]=(s*T-o*C-l*E)*k,t[13]=(i*C-n*T+r*E)*k,t[14]=(m*v-f*b-g*y)*k,t[15]=(u*b-h*v+p*y)*k,t):null},t.isChar=Gn,t.isMapboxURL=H,t.keysDifference=function(t,e){var i=[];for(var n in t)n in e||i.push(n);return i},t.makeRequest=vt,t.mapObject=v,t.mercatorXfromLng=$c,t.mercatorYfromLat=Vc,t.mercatorZfromAltitude=jc,t.mul=co,t.multiply=so,t.mvt=xs,t.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},t.normalize=function(t,e){var i=e[0],n=e[1],r=e[2],a=i*i+n*n+r*r;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t},t.number=qe,t.offscreenCanvasSupported=dt,t.ortho=function(t,e,i,n,r,a,o){var s=1/(e-i),l=1/(n-r),c=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*s,t[13]=(r+n)*l,t[14]=(o+a)*c,t[15]=1,t},t.parseGlyphPBF=function(t){return new Xs(t).readFields(fl,[])},t.pbf=Xs,t.performSymbolLayout=function(t,e,i,n,r,a,o){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var s=t.layers[0].layout,l=t.layers[0]._unevaluatedLayout._values,c={};if("composite"===t.textSizeData.kind){var u=t.textSizeData,h=u.maxZoom;c.compositeTextSizes=[l["text-size"].possiblyEvaluate(new sr(u.minZoom),o),l["text-size"].possiblyEvaluate(new sr(h),o)]}if("composite"===t.iconSizeData.kind){var p=t.iconSizeData,d=p.maxZoom;c.compositeIconSizes=[l["icon-size"].possiblyEvaluate(new sr(p.minZoom),o),l["icon-size"].possiblyEvaluate(new sr(d),o)]}c.layoutTextSize=l["text-size"].possiblyEvaluate(new sr(t.zoom+1),o),c.layoutIconSize=l["icon-size"].possiblyEvaluate(new sr(t.zoom+1),o),c.textMaxSize=l["text-size"].possiblyEvaluate(new sr(18));for(var f=24*s.get("text-line-height"),m="map"===s.get("text-rotation-alignment")&&"point"!==s.get("symbol-placement"),g=s.get("text-keep-upright"),_=s.get("text-size"),y=function(){var a=x[v],l=s.get("text-font").evaluate(a,{},o).join(","),u=_.evaluate(a,{},o),h=c.layoutTextSize.evaluate(a,{},o),p=c.layoutIconSize.evaluate(a,{},o),d={horizontal:{},vertical:void 0},y=a.text,b=[0,0];if(y){var w=y.toString(),E=24*s.get("text-letter-spacing").evaluate(a,{},o),T=function(t){for(var e=0,i=t;e<i.length;e+=1)if(n=i[e].charCodeAt(0),Gn.Arabic(n)||Gn["Arabic Supplement"](n)||Gn["Arabic Extended-A"](n)||Gn["Arabic Presentation Forms-A"](n)||Gn["Arabic Presentation Forms-B"](n))return!1;var n;return!0}(w)?E:0,M=s.get("text-anchor").evaluate(a,{},o),C=s.get("text-variable-anchor");if(!C){var I=s.get("text-radial-offset").evaluate(a,{},o);b=I?ac(M,[24*I,rc]):s.get("text-offset").evaluate(a,{},o).map((function(t){return 24*t}))}var A=m?"center":s.get("text-justify").evaluate(a,{},o),k=s.get("symbol-placement"),R="point"===k?24*s.get("text-max-width").evaluate(a,{},o):0,z=function(){t.allowVerticalPlacement&&Hn(w)&&(d.vertical=El(y,e,i,r,l,R,f,M,"left",T,b,bl.vertical,!0,k,h,u))};if(!m&&C){for(var P="auto"===A?C.map((function(t){return oc(t)})):[A],D=!1,L=0;L<P.length;L++){var B=P[L];if(!d.horizontal[B])if(D)d.horizontal[B]=d.horizontal[0];else{var O=El(y,e,i,r,l,R,f,"center",B,T,b,bl.horizontal,!1,k,h,u);O&&(d.horizontal[B]=O,D=1===O.positionedLines.length)}}z()}else{"auto"===A&&(A=oc(M));var F=El(y,e,i,r,l,R,f,M,A,T,b,bl.horizontal,!1,k,h,u);F&&(d.horizontal[A]=F),z(),Hn(w)&&m&&g&&(d.vertical=El(y,e,i,r,l,R,f,M,A,T,b,bl.vertical,!1,k,h,u))}}var N=void 0,U=!1;if(a.icon&&a.icon.name){var $=n[a.icon.name];$&&(N=function(t,e,i){var n=zl(i),r=e[0]-t.displaySize[0]*n.horizontalAlign,a=e[1]-t.displaySize[1]*n.verticalAlign;return{image:t,top:a,bottom:a+t.displaySize[1],left:r,right:r+t.displaySize[0]}}(r[a.icon.name],s.get("icon-offset").evaluate(a,{},o),s.get("icon-anchor").evaluate(a,{},o)),U=$.sdf,void 0===t.sdfIcons?t.sdfIcons=$.sdf:t.sdfIcons!==$.sdf&&S("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),($.pixelRatio!==t.pixelRatio||0!==s.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}var V=lc(d.horizontal)||d.vertical;t.iconsInText=!!V&&V.iconsInText,(V||N)&&function(t,e,i,n,r,a,o,s,l,c,u){var h=a.textMaxSize.evaluate(e,{});void 0===h&&(h=o);var p,d=t.layers[0].layout,f=d.get("icon-offset").evaluate(e,{},u),m=lc(i.horizontal),g=o/24,_=t.tilePixelRatio*g,y=t.tilePixelRatio*h/24,v=t.tilePixelRatio*s,x=t.tilePixelRatio*d.get("symbol-spacing"),b=d.get("text-padding")*t.tilePixelRatio,w=d.get("icon-padding")*t.tilePixelRatio,E=d.get("text-max-angle")/180*Math.PI,T="map"===d.get("text-rotation-alignment")&&"point"!==d.get("symbol-placement"),M="map"===d.get("icon-rotation-alignment")&&"point"!==d.get("symbol-placement"),C=d.get("symbol-placement"),I=x/2,A=d.get("icon-text-fit");n&&"none"!==A&&(t.allowVerticalPlacement&&i.vertical&&(p=Dl(n,i.vertical,A,d.get("icon-text-fit-padding"),f,g)),m&&(n=Dl(n,m,A,d.get("icon-text-fit-padding"),f,g)));var k=function(s,h){h.x<0||h.x>=8192||h.y<0||h.y>=8192||function(t,e,i,n,r,a,o,s,l,c,u,h,p,d,f,m,g,_,y,v,x,b,w,E,T){var M,C,I,A,k,R=t.addToLineVertexArray(e,i),z=0,P=0,D=0,L=0,B=-1,O=-1,F={},N=pa(""),U=0,$=0;if(void 0===s._unevaluatedLayout.getValue("text-radial-offset")?(U=(M=s.layout.get("text-offset").evaluate(x,{},E).map((function(t){return 24*t})))[0],$=M[1]):(U=24*s.layout.get("text-radial-offset").evaluate(x,{},E),$=rc),t.allowVerticalPlacement&&n.vertical){var V=s.layout.get("text-rotate").evaluate(x,{},E)+90;A=new Jl(l,e,c,u,h,n.vertical,p,d,f,V),o&&(k=new Jl(l,e,c,u,h,o,g,_,f,V))}if(r){var j=s.layout.get("icon-rotate").evaluate(x,{}),q="none"!==s.layout.get("icon-text-fit"),G=Wl(r,j,w,q),H=o?Wl(o,j,w,q):void 0;I=new Jl(l,e,c,u,h,r,g,_,!1,j),z=4*G.length;var W=t.iconSizeData,Z=null;"source"===W.kind?(Z=[128*s.layout.get("icon-size").evaluate(x,{})])[0]>32640&&S(t.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):"composite"===W.kind&&((Z=[128*b.compositeIconSizes[0].evaluate(x,{},E),128*b.compositeIconSizes[1].evaluate(x,{},E)])[0]>32640||Z[1]>32640)&&S(t.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),t.addSymbols(t.icon,G,Z,v,y,x,!1,e,R.lineStartIndex,R.lineLength,-1,E),B=t.icon.placedSymbolArray.length-1,H&&(P=4*H.length,t.addSymbols(t.icon,H,Z,v,y,x,bl.vertical,e,R.lineStartIndex,R.lineLength,-1,E),O=t.icon.placedSymbolArray.length-1)}for(var Y in n.horizontal){var X=n.horizontal[Y];if(!C){N=pa(X.text);var K=s.layout.get("text-rotate").evaluate(x,{},E);C=new Jl(l,e,c,u,h,X,p,d,f,K)}var J=1===X.positionedLines.length;if(D+=sc(t,e,X,a,s,f,x,m,R,n.vertical?bl.horizontal:bl.horizontalOnly,J?Object.keys(n.horizontal):[Y],F,B,b,E),J)break}n.vertical&&(L+=sc(t,e,n.vertical,a,s,f,x,m,R,bl.vertical,["vertical"],F,O,b,E));var Q=C?C.boxStartIndex:t.collisionBoxArray.length,tt=C?C.boxEndIndex:t.collisionBoxArray.length,et=A?A.boxStartIndex:t.collisionBoxArray.length,it=A?A.boxEndIndex:t.collisionBoxArray.length,nt=I?I.boxStartIndex:t.collisionBoxArray.length,rt=I?I.boxEndIndex:t.collisionBoxArray.length,at=k?k.boxStartIndex:t.collisionBoxArray.length,ot=k?k.boxEndIndex:t.collisionBoxArray.length,st=-1,lt=function(t,e){return t&&t.circleDiameter?Math.max(t.circleDiameter,e):e};st=lt(C,st),st=lt(A,st),st=lt(I,st);var ct=(st=lt(k,st))>-1?1:0;ct&&(st*=T/24),t.glyphOffsetArray.length>=_c.MAX_GLYPHS&&S("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,x.sortKey),t.symbolInstances.emplaceBack(e.x,e.y,F.right>=0?F.right:-1,F.center>=0?F.center:-1,F.left>=0?F.left:-1,F.vertical||-1,B,O,N,Q,tt,et,it,nt,rt,at,ot,c,D,L,z,P,ct,0,p,U,$,st)}(t,h,s,i,n,r,p,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,_,b,T,l,v,w,M,f,e,a,c,u,o)};if("line"===C)for(var R=0,z=Hl(e.geometry,0,0,8192,8192);R<z.length;R+=1)for(var P=z[R],D=0,L=Gl(P,x,E,i.vertical||m,n,24,y,t.overscaling,8192);D<L.length;D+=1){var B=L[D];m&&cc(t,m.text,I,B)||k(P,B)}else if("line-center"===C)for(var O=0,F=e.geometry;O<F.length;O+=1){var N=F[O];if(N.length>1){var U=ql(N,E,i.vertical||m,n,24,y);U&&k(N,U)}}else if("Polygon"===e.type)for(var $=0,V=ns(e.geometry,0);$<V.length;$+=1){var j=V[$],q=ec(j,16);k(j[0],new Ll(q.x,q.y,0))}else if("LineString"===e.type)for(var G=0,H=e.geometry;G<H.length;G+=1){var W=H[G];k(W,new Ll(W[0].x,W[0].y,0))}else if("Point"===e.type)for(var Z=0,Y=e.geometry;Z<Y.length;Z+=1)for(var X=0,K=Y[Z];X<K.length;X+=1){var J=K[X];k([J],new Ll(J.x,J.y,0))}}(t,a,d,N,n,c,h,p,b,U,o)},v=0,x=t.features;v<x.length;v+=1)y();a&&t.generateCollisionDebugBuffers()},t.perspective=function(t,e,i,n,r){var a,o=1/Math.tan(e/2);return t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(t[10]=(r+n)*(a=1/(n-r)),t[14]=2*r*n*a):(t[10]=-1,t[14]=-2*n),t},t.pick=function(t,e){for(var i={},n=0;n<e.length;n++){var r=e[n];r in t&&(i[r]=t[r])}return i},t.plugin=or,t.polygonIntersectsPolygon=ja,t.postMapLoadEvent=ot,t.postTurnstileEvent=rt,t.potpack=_l,t.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.register=Fn,t.registerForPluginStateChange=function(t){return t({pluginStatus:Qn,pluginURL:tr}),nr.on("pluginStateChange",t),t},t.renderColorRamp=bo,t.rotate=function(t,e,i){var n=e[0],r=e[1],a=e[2],o=e[3],s=Math.sin(i),l=Math.cos(i);return t[0]=n*l+a*s,t[1]=r*l+o*s,t[2]=n*-s+a*l,t[3]=r*-s+o*l,t},t.rotateX=function(t,e,i){var n=Math.sin(i),r=Math.cos(i),a=e[4],o=e[5],s=e[6],l=e[7],c=e[8],u=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*r+c*n,t[5]=o*r+u*n,t[6]=s*r+h*n,t[7]=l*r+p*n,t[8]=c*r-a*n,t[9]=u*r-o*n,t[10]=h*r-s*n,t[11]=p*r-l*n,t},t.rotateZ=function(t,e,i){var n=Math.sin(i),r=Math.cos(i),a=e[0],o=e[1],s=e[2],l=e[3],c=e[4],u=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*r+c*n,t[1]=o*r+u*n,t[2]=s*r+h*n,t[3]=l*r+p*n,t[4]=c*r-a*n,t[5]=u*r-o*n,t[6]=h*r-s*n,t[7]=p*r-l*n,t},t.scale=function(t,e,i){var n=i[0],r=i[1],a=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.scale$1=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},t.scale$2=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},t.setCacheLimits=function(t,e){st=t,lt=e},t.setRTLTextPlugin=function(t,e,i){if(void 0===i&&(i=!1),"deferred"===Qn||"loading"===Qn||"loaded"===Qn)throw new Error("setRTLTextPlugin cannot be called multiple times.");tr=F.resolveURL(t),Qn="deferred",Jn=e,ir(),i||ar()},t.sphericalToCartesian=function(t){var e=t[0],i=t[1],n=t[2];return i+=90,i*=Math.PI/180,n*=Math.PI/180,{x:e*Math.cos(i)*Math.sin(n),y:e*Math.sin(i)*Math.sin(n),z:e*Math.cos(n)}},t.sqrLen=function(t){var e=t[0],i=t[1];return e*e+i*i},t.styleSpec=At,t.sub=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t},t.symbolSize=Nl,t.transformMat3=function(t,e,i){var n=e[0],r=e[1],a=e[2];return t[0]=n*i[0]+r*i[3]+a*i[6],t[1]=n*i[1]+r*i[4]+a*i[7],t[2]=n*i[2]+r*i[5]+a*i[8],t},t.transformMat4=uo,t.translate=function(t,e,i){var n,r,a,o,s,l,c,u,h,p,d,f,m=i[0],g=i[1],_=i[2];return e===t?(t[12]=e[0]*m+e[4]*g+e[8]*_+e[12],t[13]=e[1]*m+e[5]*g+e[9]*_+e[13],t[14]=e[2]*m+e[6]*g+e[10]*_+e[14],t[15]=e[3]*m+e[7]*g+e[11]*_+e[15]):(r=e[1],a=e[2],o=e[3],s=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=e[9],d=e[10],f=e[11],t[0]=n=e[0],t[1]=r,t[2]=a,t[3]=o,t[4]=s,t[5]=l,t[6]=c,t[7]=u,t[8]=h,t[9]=p,t[10]=d,t[11]=f,t[12]=n*m+s*g+h*_+e[12],t[13]=r*m+l*g+p*_+e[13],t[14]=a*m+c*g+d*_+e[14],t[15]=o*m+u*g+f*_+e[15]),t},t.triggerPluginCompletionEvent=er,t.uniqueId=f,t.validateCustomStyleLayer=function(t){var e=[],i=t.id;return void 0===i&&e.push({message:"layers."+i+': missing required property "id"'}),void 0===t.render&&e.push({message:"layers."+i+': missing required method "render"'}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:"layers."+i+': property "renderingMode" must be either "2d" or "3d"'}),e},t.validateLight=An,t.validateStyle=In,t.values=function(t){var e=[];for(var i in t)e.push(t[i]);return e},t.vectorTile=xs,t.version="1.13.0-rc.4",t.warnOnce=S,t.webpSupported=U,t.window=o,t.wrap=h})),n(["./shared"],(function(t){function e(t){var i=typeof t;if("number"===i||"boolean"===i||"string"===i||null==t)return JSON.stringify(t);if(Array.isArray(t)){for(var n="[",r=0,a=t;r<a.length;r+=1)n+=e(a[r])+",";return n+"]"}for(var o=Object.keys(t).sort(),s="{",l=0;l<o.length;l++)s+=JSON.stringify(o[l])+":"+e(t[o[l]])+",";return s+"}"}function i(i){for(var n="",r=0,a=t.refProperties;r<a.length;r+=1)n+="/"+e(i[a[r]]);return n}var n=function(t){this.keyCache={},t&&this.replace(t)};n.prototype.replace=function(t){this._layerConfigs={},this._layers={},this.update(t,[])},n.prototype.update=function(e,n){for(var r=this,a=0,o=e;a<o.length;a+=1){var s=o[a];this._layerConfigs[s.id]=s;var l=this._layers[s.id]=t.createStyleLayer(s);l._featureFilter=t.featureFilter(l.filter),this.keyCache[s.id]&&delete this.keyCache[s.id]}for(var c=0,u=n;c<u.length;c+=1){var h=u[c];delete this.keyCache[h],delete this._layerConfigs[h],delete this._layers[h]}this.familiesBySource={};for(var p=0,d=function(t,e){for(var n={},r=0;r<t.length;r++){var a=e&&e[t[r].id]||i(t[r]);e&&(e[t[r].id]=a);var o=n[a];o||(o=n[a]=[]),o.push(t[r])}var s=[];for(var l in n)s.push(n[l]);return s}(t.values(this._layerConfigs),this.keyCache);p<d.length;p+=1){var f=d[p].map((function(t){return r._layers[t.id]})),m=f[0];if("none"!==m.visibility){var g=m.source||"",_=this.familiesBySource[g];_||(_=this.familiesBySource[g]={});var y=m.sourceLayer||"_geojsonTileLayer",v=_[y];v||(v=_[y]=[]),v.push(f)}}};var r=function(e){var i={},n=[];for(var r in e){var a=e[r],o=i[r]={};for(var s in a){var l=a[+s];if(l&&0!==l.bitmap.width&&0!==l.bitmap.height){var c={x:0,y:0,w:l.bitmap.width+2,h:l.bitmap.height+2};n.push(c),o[s]={rect:c,metrics:l.metrics}}}}var u=t.potpack(n),h=new t.AlphaImage({width:u.w||1,height:u.h||1});for(var p in e){var d=e[p];for(var f in d){var m=d[+f];if(m&&0!==m.bitmap.width&&0!==m.bitmap.height){var g=i[p][f].rect;t.AlphaImage.copy(m.bitmap,h,{x:0,y:0},{x:g.x+1,y:g.y+1},m.bitmap)}}}this.image=h,this.positions=i};t.register("GlyphAtlas",r);var a=function(e){this.tileID=new t.OverscaledTileID(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId};function o(e,i,n){for(var r=new t.EvaluationParameters(i),a=0,o=e;a<o.length;a+=1)o[a].recalculate(r,n)}function s(e,i){var n=t.getArrayBuffer(e.request,(function(e,n,r,a){e?i(e):n&&i(null,{vectorTile:new t.vectorTile.VectorTile(new t.pbf(n)),rawData:n,cacheControl:r,expires:a})}));return function(){n.cancel(),i()}}a.prototype.parse=function(e,i,n,a,s){var l=this;this.status="parsing",this.data=e,this.collisionBoxArray=new t.CollisionBoxArray;var c=new t.DictionaryCoder(Object.keys(e.layers).sort()),u=new t.FeatureIndex(this.tileID,this.promoteId);u.bucketLayerIDs=[];var h,p,d,f,m={},g={featureIndex:u,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:n},_=i.familiesBySource[this.source];for(var y in _){var v=e.layers[y];if(v){1===v.version&&t.warnOnce('Vector tile source "'+this.source+'" layer "'+y+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var x=c.encode(y),b=[],w=0;w<v.length;w++){var S=v.feature(w),E=u.getId(S,y);b.push({feature:S,id:E,index:w,sourceLayerIndex:x})}for(var T=0,M=_[y];T<M.length;T+=1){var C=M[T],I=C[0];I.minzoom&&this.zoom<Math.floor(I.minzoom)||I.maxzoom&&this.zoom>=I.maxzoom||"none"!==I.visibility&&(o(C,this.zoom,n),(m[I.id]=I.createBucket({index:u.bucketLayerIDs.length,layers:C,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:x,sourceID:this.source})).populate(b,g,this.tileID.canonical),u.bucketLayerIDs.push(C.map((function(t){return t.id}))))}}}var A=t.mapObject(g.glyphDependencies,(function(t){return Object.keys(t).map(Number)}));Object.keys(A).length?a.send("getGlyphs",{uid:this.uid,stacks:A},(function(t,e){h||(h=t,p=e,z.call(l))})):p={};var k=Object.keys(g.iconDependencies);k.length?a.send("getImages",{icons:k,source:this.source,tileID:this.tileID,type:"icons"},(function(t,e){h||(h=t,d=e,z.call(l))})):d={};var R=Object.keys(g.patternDependencies);function z(){if(h)return s(h);if(p&&d&&f){var e=new r(p),i=new t.ImageAtlas(d,f);for(var a in m){var l=m[a];l instanceof t.SymbolBucket?(o(l.layers,this.zoom,n),t.performSymbolLayout(l,p,e.positions,d,i.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):l.hasPattern&&(l instanceof t.LineBucket||l instanceof t.FillBucket||l instanceof t.FillExtrusionBucket)&&(o(l.layers,this.zoom,n),l.addFeatures(g,this.tileID.canonical,i.patternPositions))}this.status="done",s(null,{buckets:t.values(m).filter((function(t){return!t.isEmpty()})),featureIndex:u,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,imageAtlas:i,glyphMap:this.returnDependencies?p:null,iconMap:this.returnDependencies?d:null,glyphPositions:this.returnDependencies?e.positions:null})}}R.length?a.send("getImages",{icons:R,source:this.source,tileID:this.tileID,type:"patterns"},(function(t,e){h||(h=t,f=e,z.call(l))})):f={},z.call(this)};var l=function(t,e,i,n){this.actor=t,this.layerIndex=e,this.availableImages=i,this.loadVectorData=n||s,this.loading={},this.loaded={}};l.prototype.loadTile=function(e,i){var n=this,r=e.uid;this.loading||(this.loading={});var o=!!(e&&e.request&&e.request.collectResourceTiming)&&new t.RequestPerformance(e.request),s=this.loading[r]=new a(e);s.abort=this.loadVectorData(e,(function(e,a){if(delete n.loading[r],e||!a)return s.status="done",n.loaded[r]=s,i(e);var l=a.rawData,c={};a.expires&&(c.expires=a.expires),a.cacheControl&&(c.cacheControl=a.cacheControl);var u={};if(o){var h=o.finish();h&&(u.resourceTiming=JSON.parse(JSON.stringify(h)))}s.vectorTile=a.vectorTile,s.parse(a.vectorTile,n.layerIndex,n.availableImages,n.actor,(function(e,n){if(e||!n)return i(e);i(null,t.extend({rawTileData:l.slice(0)},n,c,u))})),n.loaded=n.loaded||{},n.loaded[r]=s}))},l.prototype.reloadTile=function(t,e){var i=this,n=this.loaded,r=t.uid,a=this;if(n&&n[r]){var o=n[r];o.showCollisionBoxes=t.showCollisionBoxes;var s=function(t,n){var r=o.reloadCallback;r&&(delete o.reloadCallback,o.parse(o.vectorTile,a.layerIndex,i.availableImages,a.actor,r)),e(t,n)};"parsing"===o.status?o.reloadCallback=s:"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}},l.prototype.abortTile=function(t,e){var i=this.loading,n=t.uid;i&&i[n]&&i[n].abort&&(i[n].abort(),delete i[n]),e()},l.prototype.removeTile=function(t,e){var i=this.loaded,n=t.uid;i&&i[n]&&delete i[n],e()};var c=t.window.ImageBitmap,u=function(){this.loaded={}};function h(t,e){if(0!==t.length){p(t[0],e);for(var i=1;i<t.length;i++)p(t[i],!e)}}function p(t,e){for(var i=0,n=0,r=t.length,a=r-1;n<r;a=n++)i+=(t[n][0]-t[a][0])*(t[a][1]+t[n][1]);i>=0!=!!e&&t.reverse()}u.prototype.loadTile=function(e,i){var n=e.uid,r=e.encoding,a=e.rawImageData,o=c&&a instanceof c?this.getImageData(a):a,s=new t.DEMData(n,o,r);this.loaded=this.loaded||{},this.loaded[n]=s,i(null,s)},u.prototype.getImageData=function(e){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);var i=this.offscreenCanvasContext.getImageData(-1,-1,e.width+2,e.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new t.RGBAImage({width:i.width,height:i.height},i.data)},u.prototype.removeTile=function(t){var e=this.loaded,i=t.uid;e&&e[i]&&delete e[i]};var d=t.vectorTile.VectorTileFeature.prototype.toGeoJSON,f=function(e){this._feature=e,this.extent=t.EXTENT,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))};f.prototype.loadGeometry=function(){if(1===this._feature.type){for(var e=[],i=0,n=this._feature.geometry;i<n.length;i+=1){var r=n[i];e.push([new t.Point$1(r[0],r[1])])}return e}for(var a=[],o=0,s=this._feature.geometry;o<s.length;o+=1){for(var l=[],c=0,u=s[o];c<u.length;c+=1){var h=u[c];l.push(new t.Point$1(h[0],h[1]))}a.push(l)}return a},f.prototype.toGeoJSON=function(t,e,i){return d.call(this,t,e,i)};var m=function(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.EXTENT,this.length=e.length,this._features=e};m.prototype.feature=function(t){return new f(this._features[t])};var g=t.vectorTile.VectorTileFeature,_=y;function y(t,e){this.options=e||{},this.features=t,this.length=t.length}function v(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}y.prototype.feature=function(t){return new v(this.features[t],this.options.extent)},v.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var i=0;i<e.length;i++){for(var n=e[i],r=[],a=0;a<n.length;a++)r.push(new t.Point$1(n[a][0],n[a][1]));this.geometry.push(r)}return this.geometry},v.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,i=-1/0,n=1/0,r=-1/0,a=0;a<t.length;a++)for(var o=t[a],s=0;s<o.length;s++){var l=o[s];e=Math.min(e,l.x),i=Math.max(i,l.x),n=Math.min(n,l.y),r=Math.max(r,l.y)}return[e,n,i,r]},v.prototype.toGeoJSON=g.prototype.toGeoJSON;var x=w,b=_;function w(e){var i=new t.pbf;return function(t,e){for(var i in t.layers)e.writeMessage(3,S,t.layers[i])}(e,i),i.finish()}function S(t,e){var i;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var n={keys:[],values:[],keycache:{},valuecache:{}};for(i=0;i<t.length;i++)n.feature=t.feature(i),e.writeMessage(2,E,n);var r=n.keys;for(i=0;i<r.length;i++)e.writeStringField(3,r[i]);var a=n.values;for(i=0;i<a.length;i++)e.writeMessage(4,A,a[i])}function E(t,e){var i=t.feature;void 0!==i.id&&e.writeVarintField(1,i.id),e.writeMessage(2,T,t),e.writeVarintField(3,i.type),e.writeMessage(4,I,i)}function T(t,e){var i=t.feature,n=t.keys,r=t.values,a=t.keycache,o=t.valuecache;for(var s in i.properties){var l=a[s];void 0===l&&(n.push(s),a[s]=l=n.length-1),e.writeVarint(l);var c=i.properties[s],u=typeof c;"string"!==u&&"boolean"!==u&&"number"!==u&&(c=JSON.stringify(c));var h=u+":"+c,p=o[h];void 0===p&&(r.push(c),o[h]=p=r.length-1),e.writeVarint(p)}}function M(t,e){return(e<<3)+(7&t)}function C(t){return t<<1^t>>31}function I(t,e){for(var i=t.loadGeometry(),n=t.type,r=0,a=0,o=i.length,s=0;s<o;s++){var l=i[s],c=1;1===n&&(c=l.length),e.writeVarint(M(1,c));for(var u=3===n?l.length-1:l.length,h=0;h<u;h++){1===h&&1!==n&&e.writeVarint(M(2,u-1));var p=l[h].x-r,d=l[h].y-a;e.writeVarint(C(p)),e.writeVarint(C(d)),r+=p,a+=d}3===n&&e.writeVarint(M(7,1))}}function A(t,e){var i=typeof t;"string"===i?e.writeStringField(1,t):"boolean"===i?e.writeBooleanField(7,t):"number"===i&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}function k(t,e,i,n){R(t,i,n),R(e,2*i,2*n),R(e,2*i+1,2*n+1)}function R(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function z(t,e,i,n){var r=t-i,a=e-n;return r*r+a*a}x.fromVectorTileJs=w,x.fromGeojsonVt=function(t,e){e=e||{};var i={};for(var n in t)i[n]=new _(t[n].features,e),i[n].name=n,i[n].version=e.version,i[n].extent=e.extent;return w({layers:i})},x.GeoJSONWrapper=b;var P=function(t){return t[0]},D=function(t){return t[1]},L=function(t,e,i,n,r){void 0===e&&(e=P),void 0===i&&(i=D),void 0===n&&(n=64),void 0===r&&(r=Float64Array),this.nodeSize=n,this.points=t;for(var a=t.length<65536?Uint16Array:Uint32Array,o=this.ids=new a(t.length),s=this.coords=new r(2*t.length),l=0;l<t.length;l++)o[l]=l,s[2*l]=e(t[l]),s[2*l+1]=i(t[l]);!function t(e,i,n,r,a,o){if(!(a-r<=n)){var s=r+a>>1;!function t(e,i,n,r,a,o){for(;a>r;){if(a-r>600){var s=a-r+1,l=n-r+1,c=Math.log(s),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(s-u)/s)*(l-s/2<0?-1:1);t(e,i,n,Math.max(r,Math.floor(n-l*u/s+h)),Math.min(a,Math.floor(n+(s-l)*u/s+h)),o)}var p=i[2*n+o],d=r,f=a;for(k(e,i,r,n),i[2*a+o]>p&&k(e,i,r,a);d<f;){for(k(e,i,d,f),d++,f--;i[2*d+o]<p;)d++;for(;i[2*f+o]>p;)f--}i[2*r+o]===p?k(e,i,r,f):k(e,i,++f,a),f<=n&&(r=f+1),n<=f&&(a=f-1)}}(e,i,s,r,a,o%2),t(e,i,n,r,s-1,o+1),t(e,i,n,s+1,a,o+1)}}(o,s,n,0,o.length-1,0)};L.prototype.range=function(t,e,i,n){return function(t,e,i,n,r,a,o){for(var s,l,c=[0,t.length-1,0],u=[];c.length;){var h=c.pop(),p=c.pop(),d=c.pop();if(p-d<=o)for(var f=d;f<=p;f++)l=e[2*f+1],(s=e[2*f])>=i&&s<=r&&l>=n&&l<=a&&u.push(t[f]);else{var m=Math.floor((d+p)/2);l=e[2*m+1],(s=e[2*m])>=i&&s<=r&&l>=n&&l<=a&&u.push(t[m]);var g=(h+1)%2;(0===h?i<=s:n<=l)&&(c.push(d),c.push(m-1),c.push(g)),(0===h?r>=s:a>=l)&&(c.push(m+1),c.push(p),c.push(g))}}return u}(this.ids,this.coords,t,e,i,n,this.nodeSize)},L.prototype.within=function(t,e,i){return function(t,e,i,n,r,a){for(var o=[0,t.length-1,0],s=[],l=r*r;o.length;){var c=o.pop(),u=o.pop(),h=o.pop();if(u-h<=a)for(var p=h;p<=u;p++)z(e[2*p],e[2*p+1],i,n)<=l&&s.push(t[p]);else{var d=Math.floor((h+u)/2),f=e[2*d],m=e[2*d+1];z(f,m,i,n)<=l&&s.push(t[d]);var g=(c+1)%2;(0===c?i-r<=f:n-r<=m)&&(o.push(h),o.push(d-1),o.push(g)),(0===c?i+r>=f:n+r>=m)&&(o.push(d+1),o.push(u),o.push(g))}}return s}(this.ids,this.coords,t,e,i,this.nodeSize)};var B={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(t){return t}},O=function(t){this.options=q(Object.create(B),t),this.trees=new Array(this.options.maxZoom+1)};function F(t,e,i,n,r){return{x:t,y:e,zoom:1/0,id:i,parentId:-1,numPoints:n,properties:r}}function N(t,e){var i=t.geometry.coordinates,n=i[1];return{x:V(i[0]),y:j(n),zoom:1/0,index:e,parentId:-1}}function U(t){return{type:"Feature",id:t.id,properties:$(t),geometry:{type:"Point",coordinates:[(n=t.x,360*(n-.5)),(e=t.y,i=(180-360*e)*Math.PI/180,360*Math.atan(Math.exp(i))/Math.PI-90)]}};var e,i,n}function $(t){var e=t.numPoints,i=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return q(q({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:i})}function V(t){return t/360+.5}function j(t){var e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function q(t,e){for(var i in e)t[i]=e[i];return t}function G(t){return t.x}function H(t){return t.y}function W(t,e,i,n,r,a){var o=r-i,s=a-n;if(0!==o||0!==s){var l=((t-i)*o+(e-n)*s)/(o*o+s*s);l>1?(i=r,n=a):l>0&&(i+=o*l,n+=s*l)}return(o=t-i)*o+(s=e-n)*s}function Z(t,e,i,n){var r={id:void 0===t?null:t,type:e,geometry:i,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,i=t.type;if("Point"===i||"MultiPoint"===i||"LineString"===i)Y(t,e);else if("Polygon"===i||"MultiLineString"===i)for(var n=0;n<e.length;n++)Y(t,e[n]);else if("MultiPolygon"===i)for(n=0;n<e.length;n++)for(var r=0;r<e[n].length;r++)Y(t,e[n][r])}(r),r}function Y(t,e){for(var i=0;i<e.length;i+=3)t.minX=Math.min(t.minX,e[i]),t.minY=Math.min(t.minY,e[i+1]),t.maxX=Math.max(t.maxX,e[i]),t.maxY=Math.max(t.maxY,e[i+1])}function X(t,e,i,n){if(e.geometry){var r=e.geometry.coordinates,a=e.geometry.type,o=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2),s=[],l=e.id;if(i.promoteId?l=e.properties[i.promoteId]:i.generateId&&(l=n||0),"Point"===a)K(r,s);else if("MultiPoint"===a)for(var c=0;c<r.length;c++)K(r[c],s);else if("LineString"===a)J(r,s,o,!1);else if("MultiLineString"===a){if(i.lineMetrics){for(c=0;c<r.length;c++)J(r[c],s=[],o,!1),t.push(Z(l,"LineString",s,e.properties));return}Q(r,s,o,!1)}else if("Polygon"===a)Q(r,s,o,!0);else{if("MultiPolygon"!==a){if("GeometryCollection"===a){for(c=0;c<e.geometry.geometries.length;c++)X(t,{id:l,geometry:e.geometry.geometries[c],properties:e.properties},i,n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(c=0;c<r.length;c++){var u=[];Q(r[c],u,o,!0),s.push(u)}}t.push(Z(l,a,s,e.properties))}}function K(t,e){e.push(tt(t[0])),e.push(et(t[1])),e.push(0)}function J(t,e,i,n){for(var r,a,o=0,s=0;s<t.length;s++){var l=tt(t[s][0]),c=et(t[s][1]);e.push(l),e.push(c),e.push(0),s>0&&(o+=n?(r*c-l*a)/2:Math.sqrt(Math.pow(l-r,2)+Math.pow(c-a,2))),r=l,a=c}var u=e.length-3;e[2]=1,function t(e,i,n,r){for(var a,o=r,s=n-i>>1,l=n-i,c=e[i],u=e[i+1],h=e[n],p=e[n+1],d=i+3;d<n;d+=3){var f=W(e[d],e[d+1],c,u,h,p);if(f>o)a=d,o=f;else if(f===o){var m=Math.abs(d-s);m<l&&(a=d,l=m)}}o>r&&(a-i>3&&t(e,i,a,r),e[a+2]=o,n-a>3&&t(e,a,n,r))}(e,0,u,i),e[u+2]=1,e.size=Math.abs(o),e.start=0,e.end=e.size}function Q(t,e,i,n){for(var r=0;r<t.length;r++){var a=[];J(t[r],a,i,n),e.push(a)}}function tt(t){return t/360+.5}function et(t){var e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function it(t,e,i,n,r,a,o,s){if(n/=e,a>=(i/=e)&&o<n)return t;if(o<i||a>=n)return null;for(var l=[],c=0;c<t.length;c++){var u=t[c],h=u.geometry,p=u.type,d=0===r?u.minX:u.minY,f=0===r?u.maxX:u.maxY;if(d>=i&&f<n)l.push(u);else if(!(f<i||d>=n)){var m=[];if("Point"===p||"MultiPoint"===p)nt(h,m,i,n,r);else if("LineString"===p)rt(h,m,i,n,r,!1,s.lineMetrics);else if("MultiLineString"===p)ot(h,m,i,n,r,!1);else if("Polygon"===p)ot(h,m,i,n,r,!0);else if("MultiPolygon"===p)for(var g=0;g<h.length;g++){var _=[];ot(h[g],_,i,n,r,!0),_.length&&m.push(_)}if(m.length){if(s.lineMetrics&&"LineString"===p){for(g=0;g<m.length;g++)l.push(Z(u.id,p,m[g],u.tags));continue}"LineString"!==p&&"MultiLineString"!==p||(1===m.length?(p="LineString",m=m[0]):p="MultiLineString"),"Point"!==p&&"MultiPoint"!==p||(p=3===m.length?"Point":"MultiPoint"),l.push(Z(u.id,p,m,u.tags))}}}return l.length?l:null}function nt(t,e,i,n,r){for(var a=0;a<t.length;a+=3){var o=t[a+r];o>=i&&o<=n&&(e.push(t[a]),e.push(t[a+1]),e.push(t[a+2]))}}function rt(t,e,i,n,r,a,o){for(var s,l,c=at(t),u=0===r?lt:ct,h=t.start,p=0;p<t.length-3;p+=3){var d=t[p],f=t[p+1],m=t[p+2],g=t[p+3],_=t[p+4],y=0===r?d:f,v=0===r?g:_,x=!1;o&&(s=Math.sqrt(Math.pow(d-g,2)+Math.pow(f-_,2))),y<i?v>i&&(l=u(c,d,f,g,_,i),o&&(c.start=h+s*l)):y>n?v<n&&(l=u(c,d,f,g,_,n),o&&(c.start=h+s*l)):st(c,d,f,m),v<i&&y>=i&&(l=u(c,d,f,g,_,i),x=!0),v>n&&y<=n&&(l=u(c,d,f,g,_,n),x=!0),!a&&x&&(o&&(c.end=h+s*l),e.push(c),c=at(t)),o&&(h+=s)}var b=t.length-3;d=t[b],f=t[b+1],m=t[b+2],(y=0===r?d:f)>=i&&y<=n&&st(c,d,f,m),b=c.length-3,a&&b>=3&&(c[b]!==c[0]||c[b+1]!==c[1])&&st(c,c[0],c[1],c[2]),c.length&&e.push(c)}function at(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function ot(t,e,i,n,r,a){for(var o=0;o<t.length;o++)rt(t[o],e,i,n,r,a,!1)}function st(t,e,i,n){t.push(e),t.push(i),t.push(n)}function lt(t,e,i,n,r,a){var o=(a-e)/(n-e);return t.push(a),t.push(i+(r-i)*o),t.push(1),o}function ct(t,e,i,n,r,a){var o=(a-i)/(r-i);return t.push(e+(n-e)*o),t.push(a),t.push(1),o}function ut(t,e){for(var i=[],n=0;n<t.length;n++){var r,a=t[n],o=a.type;if("Point"===o||"MultiPoint"===o||"LineString"===o)r=ht(a.geometry,e);else if("MultiLineString"===o||"Polygon"===o){r=[];for(var s=0;s<a.geometry.length;s++)r.push(ht(a.geometry[s],e))}else if("MultiPolygon"===o)for(r=[],s=0;s<a.geometry.length;s++){for(var l=[],c=0;c<a.geometry[s].length;c++)l.push(ht(a.geometry[s][c],e));r.push(l)}i.push(Z(a.id,o,r,a.tags))}return i}function ht(t,e){var i=[];i.size=t.size,void 0!==t.start&&(i.start=t.start,i.end=t.end);for(var n=0;n<t.length;n+=3)i.push(t[n]+e,t[n+1],t[n+2]);return i}function pt(t,e){if(t.transformed)return t;var i,n,r,a=1<<t.z,o=t.x,s=t.y;for(i=0;i<t.features.length;i++){var l=t.features[i],c=l.geometry,u=l.type;if(l.geometry=[],1===u)for(n=0;n<c.length;n+=2)l.geometry.push(dt(c[n],c[n+1],e,a,o,s));else for(n=0;n<c.length;n++){var h=[];for(r=0;r<c[n].length;r+=2)h.push(dt(c[n][r],c[n][r+1],e,a,o,s));l.geometry.push(h)}}return t.transformed=!0,t}function dt(t,e,i,n,r,a){return[Math.round(i*(t*n-r)),Math.round(i*(e*n-a))]}function ft(t,e,i,n,r){for(var a=e===r.maxZoom?0:r.tolerance/((1<<e)*r.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:i,y:n,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<t.length;s++){o.numFeatures++,mt(o,t[s],a,r);var l=t[s].minX,c=t[s].minY,u=t[s].maxX,h=t[s].maxY;l<o.minX&&(o.minX=l),c<o.minY&&(o.minY=c),u>o.maxX&&(o.maxX=u),h>o.maxY&&(o.maxY=h)}return o}function mt(t,e,i,n){var r=e.geometry,a=e.type,o=[];if("Point"===a||"MultiPoint"===a)for(var s=0;s<r.length;s+=3)o.push(r[s]),o.push(r[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===a)gt(o,r,t,i,!1,!1);else if("MultiLineString"===a||"Polygon"===a)for(s=0;s<r.length;s++)gt(o,r[s],t,i,"Polygon"===a,0===s);else if("MultiPolygon"===a)for(var l=0;l<r.length;l++){var c=r[l];for(s=0;s<c.length;s++)gt(o,c[s],t,i,!0,0===s)}if(o.length){var u=e.tags||null;if("LineString"===a&&n.lineMetrics){for(var h in u={},e.tags)u[h]=e.tags[h];u.mapbox_clip_start=r.start/r.size,u.mapbox_clip_end=r.end/r.size}var p={geometry:o,type:"Polygon"===a||"MultiPolygon"===a?3:"LineString"===a||"MultiLineString"===a?2:1,tags:u};null!==e.id&&(p.id=e.id),t.features.push(p)}}function gt(t,e,i,n,r,a){var o=n*n;if(n>0&&e.size<(r?o:n))i.numPoints+=e.length/3;else{for(var s=[],l=0;l<e.length;l+=3)(0===n||e[l+2]>o)&&(i.numSimplified++,s.push(e[l]),s.push(e[l+1])),i.numPoints++;r&&function(t,e){for(var i=0,n=0,r=t.length,a=r-2;n<r;a=n,n+=2)i+=(t[n]-t[a])*(t[n+1]+t[a+1]);if(i>0===e)for(n=0,r=t.length;n<r/2;n+=2){var o=t[n],s=t[n+1];t[n]=t[r-2-n],t[n+1]=t[r-1-n],t[r-2-n]=o,t[r-1-n]=s}}(s,a),t.push(s)}}function _t(t,e){var i=(e=this.options=function(t,e){for(var i in e)t[i]=e[i];return t}(Object.create(this.options),e)).debug;if(i&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=function(t,e){var i=[];if("FeatureCollection"===t.type)for(var n=0;n<t.features.length;n++)X(i,t.features[n],e,n);else X(i,"Feature"===t.type?t:{geometry:t},e);return i}(t,e);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(n=function(t,e){var i=e.buffer/e.extent,n=t,r=it(t,1,-1-i,i,0,-1,2,e),a=it(t,1,1-i,2+i,0,-1,2,e);return(r||a)&&(n=it(t,1,-i,1+i,0,-1,2,e)||[],r&&(n=ut(r,1).concat(n)),a&&(n=n.concat(ut(a,-1)))),n}(n,e)).length&&this.splitTile(n,0,0,0),i&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function yt(t,e,i){return 32*((1<<t)*i+e)+t}function vt(t,e){var i=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);var n=this._geoJSONIndex.getTile(i.z,i.x,i.y);if(!n)return e(null,null);var r=new m(n.features),a=x(r);0===a.byteOffset&&a.byteLength===a.buffer.byteLength||(a=new Uint8Array(a)),e(null,{vectorTile:r,rawData:a.buffer})}O.prototype.load=function(t){var e=this.options,i=e.log,n=e.minZoom,r=e.maxZoom,a=e.nodeSize;i&&console.time("total time");var o="prepare "+t.length+" points";i&&console.time(o),this.points=t;for(var s=[],l=0;l<t.length;l++)t[l].geometry&&s.push(N(t[l],l));this.trees[r+1]=new L(s,G,H,a,Float32Array),i&&console.timeEnd(o);for(var c=r;c>=n;c--){var u=+Date.now();s=this._cluster(s,c),this.trees[c]=new L(s,G,H,a,Float32Array),i&&console.log("z%d: %d clusters in %dms",c,s.length,+Date.now()-u)}return i&&console.timeEnd("total time"),this},O.prototype.getClusters=function(t,e){var i=((t[0]+180)%360+360)%360-180,n=Math.max(-90,Math.min(90,t[1])),r=180===t[2]?180:((t[2]+180)%360+360)%360-180,a=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)i=-180,r=180;else if(i>r){var o=this.getClusters([i,n,180,a],e),s=this.getClusters([-180,n,r,a],e);return o.concat(s)}for(var l=this.trees[this._limitZoom(e)],c=[],u=0,h=l.range(V(i),j(a),V(r),j(n));u<h.length;u+=1){var p=l.points[h[u]];c.push(p.numPoints?U(p):this.points[p.index])}return c},O.prototype.getChildren=function(t){var e=this._getOriginId(t),i=this._getOriginZoom(t),n="No cluster with the specified id.",r=this.trees[i];if(!r)throw new Error(n);var a=r.points[e];if(!a)throw new Error(n);for(var o=this.options.radius/(this.options.extent*Math.pow(2,i-1)),s=[],l=0,c=r.within(a.x,a.y,o);l<c.length;l+=1){var u=r.points[c[l]];u.parentId===t&&s.push(u.numPoints?U(u):this.points[u.index])}if(0===s.length)throw new Error(n);return s},O.prototype.getLeaves=function(t,e,i){var n=[];return this._appendLeaves(n,t,e=e||10,i=i||0,0),n},O.prototype.getTile=function(t,e,i){var n=this.trees[this._limitZoom(t)],r=Math.pow(2,t),a=this.options,o=a.radius/a.extent,s=(i-o)/r,l=(i+1+o)/r,c={features:[]};return this._addTileFeatures(n.range((e-o)/r,s,(e+1+o)/r,l),n.points,e,i,r,c),0===e&&this._addTileFeatures(n.range(1-o/r,s,1,l),n.points,r,i,r,c),e===r-1&&this._addTileFeatures(n.range(0,s,o/r,l),n.points,-1,i,r,c),c.features.length?c:null},O.prototype.getClusterExpansionZoom=function(t){for(var e=this._getOriginZoom(t)-1;e<=this.options.maxZoom;){var i=this.getChildren(t);if(e++,1!==i.length)break;t=i[0].properties.cluster_id}return e},O.prototype._appendLeaves=function(t,e,i,n,r){for(var a=0,o=this.getChildren(e);a<o.length;a+=1){var s=o[a],l=s.properties;if(l&&l.cluster?r+l.point_count<=n?r+=l.point_count:r=this._appendLeaves(t,l.cluster_id,i,n,r):r<n?r++:t.push(s),t.length===i)break}return r},O.prototype._addTileFeatures=function(t,e,i,n,r,a){for(var o=0,s=t;o<s.length;o+=1){var l=e[s[o]],c=l.numPoints,u={type:1,geometry:[[Math.round(this.options.extent*(l.x*r-i)),Math.round(this.options.extent*(l.y*r-n))]],tags:c?$(l):this.points[l.index].properties},h=void 0;c?h=l.id:this.options.generateId?h=l.index:this.points[l.index].id&&(h=this.points[l.index].id),void 0!==h&&(u.id=h),a.features.push(u)}},O.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(+t,this.options.maxZoom+1))},O.prototype._cluster=function(t,e){for(var i=[],n=this.options,r=n.reduce,a=n.minPoints,o=n.radius/(n.extent*Math.pow(2,e)),s=0;s<t.length;s++){var l=t[s];if(!(l.zoom<=e)){l.zoom=e;for(var c=this.trees[e+1],u=c.within(l.x,l.y,o),h=l.numPoints||1,p=h,d=0,f=u;d<f.length;d+=1){var m=c.points[f[d]];m.zoom>e&&(p+=m.numPoints||1)}if(p>=a){for(var g=l.x*h,_=l.y*h,y=r&&h>1?this._map(l,!0):null,v=(s<<5)+(e+1)+this.points.length,x=0,b=u;x<b.length;x+=1){var w=c.points[b[x]];if(!(w.zoom<=e)){w.zoom=e;var S=w.numPoints||1;g+=w.x*S,_+=w.y*S,w.parentId=v,r&&(y||(y=this._map(l,!0)),r(y,this._map(w)))}}l.parentId=v,i.push(F(g/p,_/p,v,p,y))}else if(i.push(l),p>1)for(var E=0,T=u;E<T.length;E+=1){var M=c.points[T[E]];M.zoom<=e||(M.zoom=e,i.push(M))}}}return i},O.prototype._getOriginId=function(t){return t-this.points.length>>5},O.prototype._getOriginZoom=function(t){return(t-this.points.length)%32},O.prototype._map=function(t,e){if(t.numPoints)return e?q({},t.properties):t.properties;var i=this.points[t.index].properties,n=this.options.map(i);return e&&n===i?q({},n):n},_t.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},_t.prototype.splitTile=function(t,e,i,n,r,a,o){for(var s=[t,e,i,n],l=this.options,c=l.debug;s.length;){n=s.pop(),i=s.pop(),e=s.pop(),t=s.pop();var u=1<<e,h=yt(e,i,n),p=this.tiles[h];if(!p&&(c>1&&console.time("creation"),p=this.tiles[h]=ft(t,e,i,n,l),this.tileCoords.push({z:e,x:i,y:n}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,i,n,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var d="z"+e;this.stats[d]=(this.stats[d]||0)+1,this.total++}if(p.source=t,r){if(e===l.maxZoom||e===r)continue;var f=1<<r-e;if(i!==Math.floor(a/f)||n!==Math.floor(o/f))continue}else if(e===l.indexMaxZoom||p.numPoints<=l.indexMaxPoints)continue;if(p.source=null,0!==t.length){c>1&&console.time("clipping");var m,g,_,y,v,x,b=.5*l.buffer/l.extent,w=.5-b,S=.5+b,E=1+b;m=g=_=y=null,v=it(t,u,i-b,i+S,0,p.minX,p.maxX,l),x=it(t,u,i+w,i+E,0,p.minX,p.maxX,l),t=null,v&&(m=it(v,u,n-b,n+S,1,p.minY,p.maxY,l),g=it(v,u,n+w,n+E,1,p.minY,p.maxY,l),v=null),x&&(_=it(x,u,n-b,n+S,1,p.minY,p.maxY,l),y=it(x,u,n+w,n+E,1,p.minY,p.maxY,l),x=null),c>1&&console.timeEnd("clipping"),s.push(m||[],e+1,2*i,2*n),s.push(g||[],e+1,2*i,2*n+1),s.push(_||[],e+1,2*i+1,2*n),s.push(y||[],e+1,2*i+1,2*n+1)}}},_t.prototype.getTile=function(t,e,i){var n=this.options,r=n.extent,a=n.debug;if(t<0||t>24)return null;var o=1<<t,s=yt(t,e=(e%o+o)%o,i);if(this.tiles[s])return pt(this.tiles[s],r);a>1&&console.log("drilling down to z%d-%d-%d",t,e,i);for(var l,c=t,u=e,h=i;!l&&c>0;)c--,u=Math.floor(u/2),h=Math.floor(h/2),l=this.tiles[yt(c,u,h)];return l&&l.source?(a>1&&console.log("found parent tile z%d-%d-%d",c,u,h),a>1&&console.time("drilling down"),this.splitTile(l.source,c,u,h,t,e,i),a>1&&console.timeEnd("drilling down"),this.tiles[s]?pt(this.tiles[s],r):null):null};var xt=function(e){function i(t,i,n,r){e.call(this,t,i,n,vt),r&&(this.loadGeoJSON=r)}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.loadData=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=e,this._pendingLoadDataParams=t,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},i.prototype._loadData=function(){var e=this;if(this._pendingCallback&&this._pendingLoadDataParams){var i=this._pendingCallback,n=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var r=!!(n&&n.request&&n.request.collectResourceTiming)&&new t.RequestPerformance(n.request);this.loadGeoJSON(n,(function(a,o){if(a||!o)return i(a);if("object"!=typeof o)return i(new Error("Input data given to '"+n.source+"' is not a valid GeoJSON object."));!function t(e,i){var n,r=e&&e.type;if("FeatureCollection"===r)for(n=0;n<e.features.length;n++)t(e.features[n],i);else if("GeometryCollection"===r)for(n=0;n<e.geometries.length;n++)t(e.geometries[n],i);else if("Feature"===r)t(e.geometry,i);else if("Polygon"===r)h(e.coordinates,i);else if("MultiPolygon"===r)for(n=0;n<e.coordinates.length;n++)h(e.coordinates[n],i);return e}(o,!0);try{if(n.filter){var s=t.createExpression(n.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===s.result)throw new Error(s.value.map((function(t){return t.key+": "+t.message})).join(", "));var l=o.features.filter((function(t){return s.value.evaluate({zoom:0},t)}));o={type:"FeatureCollection",features:l}}e._geoJSONIndex=n.cluster?new O(function(e){var i=e.superclusterOptions,n=e.clusterProperties;if(!n||!i)return i;for(var r={},a={},o={accumulated:null,zoom:0},s={properties:null},l=Object.keys(n),c=0,u=l;c<u.length;c+=1){var h=u[c],p=n[h],d=p[0],f=t.createExpression(p[1]),m=t.createExpression("string"==typeof d?[d,["accumulated"],["get",h]]:d);r[h]=f.value,a[h]=m.value}return i.map=function(t){s.properties=t;for(var e={},i=0,n=l;i<n.length;i+=1){var a=n[i];e[a]=r[a].evaluate(o,s)}return e},i.reduce=function(t,e){s.properties=e;for(var i=0,n=l;i<n.length;i+=1){var r=n[i];o.accumulated=t[r],t[r]=a[r].evaluate(o,s)}},i}(n)).load(o.features):function(t,e){return new _t(t,e)}(o,n.geojsonVtOptions)}catch(a){return i(a)}e.loaded={};var c={};if(r){var u=r.finish();u&&(c.resourceTiming={},c.resourceTiming[n.source]=JSON.parse(JSON.stringify(u)))}i(null,c)}))}},i.prototype.coalesce=function(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())},i.prototype.reloadTile=function(t,i){var n=this.loaded;return n&&n[t.uid]?e.prototype.reloadTile.call(this,t,i):this.loadTile(t,i)},i.prototype.loadGeoJSON=function(e,i){if(e.request)t.getJSON(e.request,i);else{if("string"!=typeof e.data)return i(new Error("Input data given to '"+e.source+"' is not a valid GeoJSON object."));try{return i(null,JSON.parse(e.data))}catch(t){return i(new Error("Input data given to '"+e.source+"' is not a valid GeoJSON object."))}}},i.prototype.removeSource=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),e()},i.prototype.getClusterExpansionZoom=function(t,e){try{e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))}catch(t){e(t)}},i.prototype.getClusterChildren=function(t,e){try{e(null,this._geoJSONIndex.getChildren(t.clusterId))}catch(t){e(t)}},i.prototype.getClusterLeaves=function(t,e){try{e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))}catch(t){e(t)}},i}(l),bt=function(e){var i=this;this.self=e,this.actor=new t.Actor(e,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:l,geojson:xt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(t,e){if(i.workerSourceTypes[t])throw new Error('Worker source with name "'+t+'" already registered.');i.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=function(e){if(t.plugin.isParsed())throw new Error("RTL text plugin already registered.");t.plugin.applyArabicShaping=e.applyArabicShaping,t.plugin.processBidirectionalText=e.processBidirectionalText,t.plugin.processStyledBidirectionalText=e.processStyledBidirectionalText}};return bt.prototype.setReferrer=function(t,e){this.referrer=e},bt.prototype.setImages=function(t,e,i){for(var n in this.availableImages[t]=e,this.workerSources[t]){var r=this.workerSources[t][n];for(var a in r)r[a].availableImages=e}i()},bt.prototype.setLayers=function(t,e,i){this.getLayerIndex(t).replace(e),i()},bt.prototype.updateLayers=function(t,e,i){this.getLayerIndex(t).update(e.layers,e.removedIds),i()},bt.prototype.loadTile=function(t,e,i){this.getWorkerSource(t,e.type,e.source).loadTile(e,i)},bt.prototype.loadDEMTile=function(t,e,i){this.getDEMWorkerSource(t,e.source).loadTile(e,i)},bt.prototype.reloadTile=function(t,e,i){this.getWorkerSource(t,e.type,e.source).reloadTile(e,i)},bt.prototype.abortTile=function(t,e,i){this.getWorkerSource(t,e.type,e.source).abortTile(e,i)},bt.prototype.removeTile=function(t,e,i){this.getWorkerSource(t,e.type,e.source).removeTile(e,i)},bt.prototype.removeDEMTile=function(t,e){this.getDEMWorkerSource(t,e.source).removeTile(e)},bt.prototype.removeSource=function(t,e,i){if(this.workerSources[t]&&this.workerSources[t][e.type]&&this.workerSources[t][e.type][e.source]){var n=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==n.removeSource?n.removeSource(e,i):i()}},bt.prototype.loadWorkerSource=function(t,e,i){try{this.self.importScripts(e.url),i()}catch(t){i(t.toString())}},bt.prototype.syncRTLPluginState=function(e,i,n){try{t.plugin.setState(i);var r=t.plugin.getPluginURL();if(t.plugin.isLoaded()&&!t.plugin.isParsed()&&null!=r){this.self.importScripts(r);var a=t.plugin.isParsed();n(a?void 0:new Error("RTL Text Plugin failed to import scripts from "+r),a)}}catch(t){n(t.toString())}},bt.prototype.getAvailableImages=function(t){var e=this.availableImages[t];return e||(e=[]),e},bt.prototype.getLayerIndex=function(t){var e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new n),e},bt.prototype.getWorkerSource=function(t,e,i){var n=this;return this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][e]||(this.workerSources[t][e]={}),this.workerSources[t][e][i]||(this.workerSources[t][e][i]=new this.workerSourceTypes[e]({send:function(e,i,r){n.actor.send(e,i,r,t)}},this.getLayerIndex(t),this.getAvailableImages(t))),this.workerSources[t][e][i]},bt.prototype.getDEMWorkerSource=function(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new u),this.demWorkerSources[t][e]},bt.prototype.enforceCacheSizeLimit=function(e,i){t.enforceCacheSizeLimit(i)},"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new bt(self)),bt})),n(["./shared"],(function(t){var e=t.createCommonjsModule((function(t){function e(t){return!i(t)}function i(t){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,i=new Blob([""],{type:"text/javascript"}),n=URL.createObjectURL(i);try{e=new Worker(n),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(n),t}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var t=document.createElement("canvas");t.width=t.height=1;var e=t.getContext("2d");if(!e)return!1;var i=e.getImageData(0,0,1,1);return i&&i.width===t.width}()?(void 0===n[i=t&&t.failIfMajorPerformanceCaveat]&&(n[i]=function(t){var i=function(t){var i=document.createElement("canvas"),n=Object.create(e.webGLContextAttributes);return n.failIfMajorPerformanceCaveat=t,i.probablySupportsContext?i.probablySupportsContext("webgl",n)||i.probablySupportsContext("experimental-webgl",n):i.supportsContext?i.supportsContext("webgl",n)||i.supportsContext("experimental-webgl",n):i.getContext("webgl",n)||i.getContext("experimental-webgl",n)}(t);if(!i)return!1;var n=i.createShader(i.VERTEX_SHADER);return!(!n||i.isContextLost())&&(i.shaderSource(n,"void main() {}"),i.compileShader(n),!0===i.getShaderParameter(n,i.COMPILE_STATUS))}(i)),n[i]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var i}t.exports?t.exports=e:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=e,window.mapboxgl.notSupportedReason=i);var n={};e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}})),i={create:function(e,i,n){var r=t.window.document.createElement(e);return void 0!==i&&(r.className=i),n&&n.appendChild(r),r},createNS:function(e,i){return t.window.document.createElementNS(e,i)}},n=t.window.document&&t.window.document.documentElement.style;function r(t){if(!n)return t[0];for(var e=0;e<t.length;e++)if(t[e]in n)return t[e];return t[0]}var a,o=r(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);i.disableDrag=function(){n&&o&&(a=n[o],n[o]="none")},i.enableDrag=function(){n&&o&&(n[o]=a)};var s=r(["transform","WebkitTransform"]);i.setTransform=function(t,e){t.style[s]=e};var l=!1;try{var c=Object.defineProperty({},"passive",{get:function(){l=!0}});t.window.addEventListener("test",c,c),t.window.removeEventListener("test",c,c)}catch(t){l=!1}i.addEventListener=function(t,e,i,n){void 0===n&&(n={}),t.addEventListener(e,i,"passive"in n&&l?n:n.capture)},i.removeEventListener=function(t,e,i,n){void 0===n&&(n={}),t.removeEventListener(e,i,"passive"in n&&l?n:n.capture)};var u=function(e){e.preventDefault(),e.stopPropagation(),t.window.removeEventListener("click",u,!0)};function h(t){var e=t.userImage;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}i.suppressClick=function(){t.window.addEventListener("click",u,!0),t.window.setTimeout((function(){t.window.removeEventListener("click",u,!0)}),0)},i.mousePos=function(e,i){var n=e.getBoundingClientRect();return new t.Point(i.clientX-n.left-e.clientLeft,i.clientY-n.top-e.clientTop)},i.touchPos=function(e,i){for(var n=e.getBoundingClientRect(),r=[],a=0;a<i.length;a++)r.push(new t.Point(i[a].clientX-n.left-e.clientLeft,i[a].clientY-n.top-e.clientTop));return r},i.mouseButton=function(e){return void 0!==t.window.InstallTrigger&&2===e.button&&e.ctrlKey&&t.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button},i.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)};var p=function(e){function i(){e.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.RGBAImage({width:1,height:1}),this.dirty=!0}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.isLoaded=function(){return this.loaded},i.prototype.setLoaded=function(t){if(this.loaded!==t&&(this.loaded=t,t)){for(var e=0,i=this.requestors;e<i.length;e+=1){var n=i[e];this._notify(n.ids,n.callback)}this.requestors=[]}},i.prototype.getImage=function(t){return this.images[t]},i.prototype.addImage=function(t,e){this._validate(t,e)&&(this.images[t]=e)},i.prototype._validate=function(e,i){var n=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "stretchX" value'))),n=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "stretchY" value'))),n=!1),this._validateContent(i.content,i)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "content" value'))),n=!1),n},i.prototype._validateStretch=function(t,e){if(!t)return!0;for(var i=0,n=0,r=t;n<r.length;n+=1){var a=r[n];if(a[0]<i||a[1]<a[0]||e<a[1])return!1;i=a[1]}return!0},i.prototype._validateContent=function(t,e){return!(t&&(4!==t.length||t[0]<0||e.data.width<t[0]||t[1]<0||e.data.height<t[1]||t[2]<0||e.data.width<t[2]||t[3]<0||e.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))},i.prototype.updateImage=function(t,e){e.version=this.images[t].version+1,this.images[t]=e,this.updatedImages[t]=!0},i.prototype.removeImage=function(t){var e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove()},i.prototype.listImages=function(){return Object.keys(this.images)},i.prototype.getImages=function(t,e){var i=!0;if(!this.isLoaded())for(var n=0,r=t;n<r.length;n+=1)this.images[r[n]]||(i=!1);this.isLoaded()||i?this._notify(t,e):this.requestors.push({ids:t,callback:e})},i.prototype._notify=function(e,i){for(var n={},r=0,a=e;r<a.length;r+=1){var o=a[r];this.images[o]||this.fire(new t.Event("styleimagemissing",{id:o}));var s=this.images[o];s?n[o]={data:s.data.clone(),pixelRatio:s.pixelRatio,sdf:s.sdf,version:s.version,stretchX:s.stretchX,stretchY:s.stretchY,content:s.content,hasRenderCallback:Boolean(s.userImage&&s.userImage.render)}:t.warnOnce('Image "'+o+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}i(null,n)},i.prototype.getPixelSize=function(){var t=this.atlasImage;return{width:t.width,height:t.height}},i.prototype.getPattern=function(e){var i=this.patterns[e],n=this.getImage(e);if(!n)return null;if(i&&i.position.version===n.version)return i.position;if(i)i.position.version=n.version;else{var r={w:n.data.width+2,h:n.data.height+2,x:0,y:0},a=new t.ImagePosition(r,n);this.patterns[e]={bin:r,position:a}}return this._updatePatternAtlas(),this.patterns[e].position},i.prototype.bind=function(e){var i=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new t.Texture(e,this.atlasImage,i.RGBA),this.atlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)},i.prototype._updatePatternAtlas=function(){var e=[];for(var i in this.patterns)e.push(this.patterns[i].bin);var n=t.potpack(e),r=n.w,a=n.h,o=this.atlasImage;for(var s in o.resize({width:r||1,height:a||1}),this.patterns){var l=this.patterns[s].bin,c=l.x+1,u=l.y+1,h=this.images[s].data,p=h.width,d=h.height;t.RGBAImage.copy(h,o,{x:0,y:0},{x:c,y:u},{width:p,height:d}),t.RGBAImage.copy(h,o,{x:0,y:d-1},{x:c,y:u-1},{width:p,height:1}),t.RGBAImage.copy(h,o,{x:0,y:0},{x:c,y:u+d},{width:p,height:1}),t.RGBAImage.copy(h,o,{x:p-1,y:0},{x:c-1,y:u},{width:1,height:d}),t.RGBAImage.copy(h,o,{x:0,y:0},{x:c+p,y:u},{width:1,height:d})}this.dirty=!0},i.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},i.prototype.dispatchRenderCallbacks=function(t){for(var e=0,i=t;e<i.length;e+=1){var n=i[e];if(!this.callbackDispatchedThisFrame[n]){this.callbackDispatchedThisFrame[n]=!0;var r=this.images[n];h(r)&&this.updateImage(n,r)}}},i}(t.Evented),d=g,f=g,m=1e20;function g(t,e,i,n,r,a){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=n||.25,this.fontFamily=r||"sans-serif",this.fontWeight=a||"normal",this.radius=i||8;var o=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=o,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(o*o),this.gridInner=new Float64Array(o*o),this.f=new Float64Array(o),this.d=new Float64Array(o),this.z=new Float64Array(o+1),this.v=new Int16Array(o),this.middle=Math.round(o/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function _(t,e,i,n,r,a,o){for(var s=0;s<e;s++){for(var l=0;l<i;l++)n[l]=t[l*e+s];for(y(n,r,a,o,i),l=0;l<i;l++)t[l*e+s]=r[l]}for(l=0;l<i;l++){for(s=0;s<e;s++)n[s]=t[l*e+s];for(y(n,r,a,o,e),s=0;s<e;s++)t[l*e+s]=Math.sqrt(r[s])}}function y(t,e,i,n,r){i[0]=0,n[0]=-m,n[1]=+m;for(var a=1,o=0;a<r;a++){for(var s=(t[a]+a*a-(t[i[o]]+i[o]*i[o]))/(2*a-2*i[o]);s<=n[o];)o--,s=(t[a]+a*a-(t[i[o]]+i[o]*i[o]))/(2*a-2*i[o]);i[++o]=a,n[o]=s,n[o+1]=+m}for(a=0,o=0;a<r;a++){for(;n[o+1]<a;)o++;e[a]=(a-i[o])*(a-i[o])+t[i[o]]}}g.prototype.draw=function(t){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(t,this.buffer,this.middle);for(var e=this.ctx.getImageData(0,0,this.size,this.size),i=new Uint8ClampedArray(this.size*this.size),n=0;n<this.size*this.size;n++){var r=e.data[4*n+3]/255;this.gridOuter[n]=1===r?0:0===r?m:Math.pow(Math.max(0,.5-r),2),this.gridInner[n]=1===r?m:0===r?0:Math.pow(Math.max(0,r-.5),2)}for(_(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),_(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),n=0;n<this.size*this.size;n++)i[n]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[n]-this.gridInner[n])/this.radius+this.cutoff))));return i},d.default=f;var v=function(t,e){this.requestManager=t,this.localIdeographFontFamily=e,this.entries={}};v.prototype.setURL=function(t){this.url=t},v.prototype.getGlyphs=function(e,i){var n=this,r=[];for(var a in e)for(var o=0,s=e[a];o<s.length;o+=1)r.push({stack:a,id:s[o]});t.asyncAll(r,(function(t,e){var i=t.stack,r=t.id,a=n.entries[i];a||(a=n.entries[i]={glyphs:{},requests:{},ranges:{}});var o=a.glyphs[r];if(void 0===o){if(o=n._tinySDF(a,i,r))return a.glyphs[r]=o,void e(null,{stack:i,id:r,glyph:o});var s=Math.floor(r/256);if(256*s>65535)e(new Error("glyphs > 65535 not supported"));else if(a.ranges[s])e(null,{stack:i,id:r,glyph:o});else{var l=a.requests[s];l||(l=a.requests[s]=[],v.loadGlyphRange(i,s,n.url,n.requestManager,(function(t,e){if(e){for(var i in e)n._doesCharSupportLocalGlyph(+i)||(a.glyphs[+i]=e[+i]);a.ranges[s]=!0}for(var r=0,o=l;r<o.length;r+=1)(0,o[r])(t,e);delete a.requests[s]}))),l.push((function(t,n){t?e(t):n&&e(null,{stack:i,id:r,glyph:n[r]||null})}))}}else e(null,{stack:i,id:r,glyph:o})}),(function(t,e){if(t)i(t);else if(e){for(var n={},r=0,a=e;r<a.length;r+=1){var o=a[r],s=o.stack,l=o.id,c=o.glyph;(n[s]||(n[s]={}))[l]=c&&{id:c.id,bitmap:c.bitmap.clone(),metrics:c.metrics}}i(null,n)}}))},v.prototype._doesCharSupportLocalGlyph=function(e){return!!this.localIdeographFontFamily&&(t.isChar["CJK Unified Ideographs"](e)||t.isChar["Hangul Syllables"](e)||t.isChar.Hiragana(e)||t.isChar.Katakana(e))},v.prototype._tinySDF=function(e,i,n){var r=this.localIdeographFontFamily;if(r&&this._doesCharSupportLocalGlyph(n)){var a=e.tinySDF;if(!a){var o="400";/bold/i.test(i)?o="900":/medium/i.test(i)?o="500":/light/i.test(i)&&(o="200"),a=e.tinySDF=new v.TinySDF(24,3,8,.25,r,o)}return{id:n,bitmap:new t.AlphaImage({width:30,height:30},a.draw(String.fromCharCode(n))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},v.loadGlyphRange=function(e,i,n,r,a){var o=256*i,s=o+255,l=r.transformRequest(r.normalizeGlyphsURL(n).replace("{fontstack}",e).replace("{range}",o+"-"+s),t.ResourceType.Glyphs);t.getArrayBuffer(l,(function(e,i){if(e)a(e);else if(i){for(var n={},r=0,o=t.parseGlyphPBF(i);r<o.length;r+=1){var s=o[r];n[s.id]=s}a(null,n)}}))},v.TinySDF=d;var x=function(){this.specification=t.styleSpec.light.position};x.prototype.possiblyEvaluate=function(e,i){return t.sphericalToCartesian(e.expression.evaluate(i))},x.prototype.interpolate=function(e,i,n){return{x:t.number(e.x,i.x,n),y:t.number(e.y,i.y,n),z:t.number(e.z,i.z,n)}};var b=new t.Properties({anchor:new t.DataConstantProperty(t.styleSpec.light.anchor),position:new x,color:new t.DataConstantProperty(t.styleSpec.light.color),intensity:new t.DataConstantProperty(t.styleSpec.light.intensity)}),w=function(e){function i(i){e.call(this),this._transitionable=new t.Transitionable(b),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.getLight=function(){return this._transitionable.serialize()},i.prototype.setLight=function(e,i){if(void 0===i&&(i={}),!this._validate(t.validateLight,e,i))for(var n in e){var r=e[n];t.endsWith(n,"-transition")?this._transitionable.setTransition(n.slice(0,-"-transition".length),r):this._transitionable.setValue(n,r)}},i.prototype.updateTransitions=function(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)},i.prototype.hasTransition=function(){return this._transitioning.hasTransition()},i.prototype.recalculate=function(t){this.properties=this._transitioning.possiblyEvaluate(t)},i.prototype._validate=function(e,i,n){return(!n||!1!==n.validate)&&t.emitValidationErrors(this,e.call(t.validateStyle,t.extend({value:i,style:{glyphs:!0,sprite:!0},styleSpec:t.styleSpec})))},i}(t.Evented),S=function(t,e){this.width=t,this.height=e,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};S.prototype.getDash=function(t,e){var i=t.join(",")+String(e);return this.dashEntry[i]||(this.dashEntry[i]=this.addDash(t,e)),this.dashEntry[i]},S.prototype.getDashRanges=function(t,e,i){var n=[],r=t.length%2==1?-t[t.length-1]*i:0,a=t[0]*i,o=!0;n.push({left:r,right:a,isDash:o,zeroLength:0===t[0]});for(var s=t[0],l=1;l<t.length;l++){var c=t[l];n.push({left:r=s*i,right:a=(s+=c)*i,isDash:o=!o,zeroLength:0===c})}return n},S.prototype.addRoundDash=function(t,e,i){for(var n=e/2,r=-i;r<=i;r++)for(var a=this.width*(this.nextRow+i+r),o=0,s=t[o],l=0;l<this.width;l++){l/s.right>1&&(s=t[++o]);var c=Math.abs(l-s.left),u=Math.abs(l-s.right),h=Math.min(c,u),p=void 0,d=r/i*(n+1);if(s.isDash){var f=n-Math.abs(d);p=Math.sqrt(h*h+f*f)}else p=n-Math.sqrt(h*h+d*d);this.data[a+l]=Math.max(0,Math.min(255,p+128))}},S.prototype.addRegularDash=function(t){for(var e=t.length-1;e>=0;--e){var i=t[e],n=t[e+1];i.zeroLength?t.splice(e,1):n&&n.isDash===i.isDash&&(n.left=i.left,t.splice(e,1))}var r=t[0],a=t[t.length-1];r.isDash===a.isDash&&(r.left=a.left-this.width,a.right=r.right+this.width);for(var o=this.width*this.nextRow,s=0,l=t[s],c=0;c<this.width;c++){c/l.right>1&&(l=t[++s]);var u=Math.abs(c-l.left),h=Math.abs(c-l.right),p=Math.min(u,h);this.data[o+c]=Math.max(0,Math.min(255,(l.isDash?p:-p)+128))}},S.prototype.addDash=function(e,i){var n=i?7:0,r=2*n+1;if(this.nextRow+r>this.height)return t.warnOnce("LineAtlas out of space"),null;for(var a=0,o=0;o<e.length;o++)a+=e[o];if(0!==a){var s=this.width/a,l=this.getDashRanges(e,this.width,s);i?this.addRoundDash(l,s,n):this.addRegularDash(l)}var c={y:(this.nextRow+n+.5)/this.height,height:2*n/this.height,width:a};return this.nextRow+=r,this.dirty=!0,c},S.prototype.bind=function(t){var e=t.gl;this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.width,this.height,e.ALPHA,e.UNSIGNED_BYTE,this.data))):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.ALPHA,this.width,this.height,0,e.ALPHA,e.UNSIGNED_BYTE,this.data))};var E=function e(i,n){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=t.uniqueId();for(var r=this.workerPool.acquire(this.id),a=0;a<r.length;a++){var o=new e.Actor(r[a],n,this.id);o.name="Worker "+a,this.actors.push(o)}};function T(e,i,n){var r=function(r,a){if(r)return n(r);if(a){var o=t.pick(t.extend(a,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);a.vector_layers&&(o.vectorLayers=a.vector_layers,o.vectorLayerIds=o.vectorLayers.map((function(t){return t.id}))),o.tiles=i.canonicalizeTileset(o,e.url),n(null,o)}};return e.url?t.getJSON(i.transformRequest(i.normalizeSourceURL(e.url),t.ResourceType.Source),r):t.browser.frame((function(){return r(null,e)}))}E.prototype.broadcast=function(e,i,n){t.asyncAll(this.actors,(function(t,n){t.send(e,i,n)}),n=n||function(){})},E.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},E.prototype.remove=function(){this.actors.forEach((function(t){t.remove()})),this.actors=[],this.workerPool.release(this.id)},E.Actor=t.Actor;var M=function(e,i,n){this.bounds=t.LngLatBounds.convert(this.validateBounds(e)),this.minzoom=i||0,this.maxzoom=n||24};M.prototype.validateBounds=function(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]},M.prototype.contains=function(e){var i=Math.pow(2,e.z),n=Math.floor(t.mercatorXfromLng(this.bounds.getWest())*i),r=Math.floor(t.mercatorYfromLat(this.bounds.getNorth())*i),a=Math.ceil(t.mercatorXfromLng(this.bounds.getEast())*i),o=Math.ceil(t.mercatorYfromLat(this.bounds.getSouth())*i);return e.x>=n&&e.x<a&&e.y>=r&&e.y<o};var C=function(e){function i(i,n,r,a){if(e.call(this),this.id=i,this.dispatcher=r,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.extend(this,t.pick(n,["url","scheme","tileSize","promoteId"])),this._options=t.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(a)}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.load=function(){var e=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=T(this._options,this.map._requestManager,(function(i,n){e._tileJSONRequest=null,e._loaded=!0,i?e.fire(new t.ErrorEvent(i)):n&&(t.extend(e,n),n.bounds&&(e.tileBounds=new M(n.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(n.tiles,e.map._requestManager._customAccessToken),t.postMapLoadEvent(n.tiles,e.map._getMapId(),e.map._requestManager._skuToken,e.map._requestManager._customAccessToken),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))}))},i.prototype.loaded=function(){return this._loaded},i.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},i.prototype.onAdd=function(t){this.map=t,this.load()},i.prototype.setSourceProperty=function(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},i.prototype.setTiles=function(t){var e=this;return this.setSourceProperty((function(){e._options.tiles=t})),this},i.prototype.setUrl=function(t){var e=this;return this.setSourceProperty((function(){e.url=t,e._options.url=t})),this},i.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},i.prototype.serialize=function(){return t.extend({},this._options)},i.prototype.loadTile=function(e,i){var n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),r={request:this.map._requestManager.transformRequest(n,t.ResourceType.Tile),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function a(n,r){return delete e.request,e.aborted?i(null):n&&404!==n.status?i(n):(r&&r.resourceTiming&&(e.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&r&&e.setExpiryData(r),e.loadVectorData(r,this.map.painter),t.cacheEntryPossiblyAdded(this.dispatcher),i(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}r.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state?"loading"===e.state?e.reloadCallback=i:e.request=e.actor.send("reloadTile",r,a.bind(this)):(e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",r,a.bind(this)))},i.prototype.abortTile=function(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)},i.prototype.unloadTile=function(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)},i.prototype.hasTransition=function(){return!1},i}(t.Evented),I=function(e){function i(i,n,r,a){e.call(this),this.id=i,this.dispatcher=r,this.setEventedParent(a),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.extend({type:"raster"},n),t.extend(this,t.pick(n,["url","scheme","tileSize"]))}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.load=function(){var e=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=T(this._options,this.map._requestManager,(function(i,n){e._tileJSONRequest=null,e._loaded=!0,i?e.fire(new t.ErrorEvent(i)):n&&(t.extend(e,n),n.bounds&&(e.tileBounds=new M(n.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(n.tiles),t.postMapLoadEvent(n.tiles,e.map._getMapId(),e.map._requestManager._skuToken),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))}))},i.prototype.loaded=function(){return this._loaded},i.prototype.onAdd=function(t){this.map=t,this.load()},i.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},i.prototype.serialize=function(){return t.extend({},this._options)},i.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},i.prototype.loadTile=function(e,i){var n=this,r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);e.request=t.getImage(this.map._requestManager.transformRequest(r,t.ResourceType.Tile),(function(r,a){if(delete e.request,e.aborted)e.state="unloaded",i(null);else if(r)e.state="errored",i(r);else if(a){n.map._refreshExpiredTiles&&e.setExpiryData(a),delete a.cacheControl,delete a.expires;var o=n.map.painter.context,s=o.gl;e.texture=n.map.painter.getTileTexture(a.width),e.texture?e.texture.update(a,{useMipmap:!0}):(e.texture=new t.Texture(o,a,s.RGBA,{useMipmap:!0}),e.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),o.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax)),e.state="loaded",t.cacheEntryPossiblyAdded(n.dispatcher),i(null)}}))},i.prototype.abortTile=function(t,e){t.request&&(t.request.cancel(),delete t.request),e()},i.prototype.unloadTile=function(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),e()},i.prototype.hasTransition=function(){return!1},i}(t.Evented),A=function(e){function i(i,n,r,a){e.call(this,i,n,r,a),this.type="raster-dem",this.maxzoom=22,this._options=t.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},i.prototype.loadTile=function(e,i){var n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function r(t,n){t&&(e.state="errored",i(t)),n&&(e.dem=n,e.needsHillshadePrepare=!0,e.state="loaded",i(null))}e.request=t.getImage(this.map._requestManager.transformRequest(n,t.ResourceType.Tile),function(n,a){if(delete e.request,e.aborted)e.state="unloaded",i(null);else if(n)e.state="errored",i(n);else if(a){this.map._refreshExpiredTiles&&e.setExpiryData(a),delete a.cacheControl,delete a.expires;var o=t.window.ImageBitmap&&a instanceof t.window.ImageBitmap&&t.offscreenCanvasSupported()?a:t.browser.getImageData(a,1),s={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:o,encoding:this.encoding};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",s,r.bind(this)))}}.bind(this)),e.neighboringTiles=this._getNeighboringTiles(e.tileID)},i.prototype._getNeighboringTiles=function(e){var i=e.canonical,n=Math.pow(2,i.z),r=(i.x-1+n)%n,a=0===i.x?e.wrap-1:e.wrap,o=(i.x+1+n)%n,s=i.x+1===n?e.wrap+1:e.wrap,l={};return l[new t.OverscaledTileID(e.overscaledZ,a,i.z,r,i.y).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,s,i.z,o,i.y).key]={backfilled:!1},i.y>0&&(l[new t.OverscaledTileID(e.overscaledZ,a,i.z,r,i.y-1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,e.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,s,i.z,o,i.y-1).key]={backfilled:!1}),i.y+1<n&&(l[new t.OverscaledTileID(e.overscaledZ,a,i.z,r,i.y+1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,e.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,s,i.z,o,i.y+1).key]={backfilled:!1}),l},i.prototype.unloadTile=function(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})},i}(I),k=function(e){function i(i,n,r,a){e.call(this),this.id=i,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=r.getActor(),this.setEventedParent(a),this._data=n.data,this._options=t.extend({},n),this._collectResourceTiming=n.collectResourceTiming,this._resourceTiming=[],void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;var o=t.EXTENT/this.tileSize;this.workerOptions=t.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(void 0!==n.buffer?n.buffer:128)*o,tolerance:(void 0!==n.tolerance?n.tolerance:.375)*o,extent:t.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:void 0!==n.clusterMaxZoom?Math.min(n.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:t.EXTENT,radius:(n.clusterRadius||50)*o,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.load=function(){var e=this;this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(i){if(i)e.fire(new t.ErrorEvent(i));else{var n={dataType:"source",sourceDataType:"metadata"};e._collectResourceTiming&&e._resourceTiming&&e._resourceTiming.length>0&&(n.resourceTiming=e._resourceTiming,e._resourceTiming=[]),e.fire(new t.Event("data",n))}}))},i.prototype.onAdd=function(t){this.map=t,this.load()},i.prototype.setData=function(e){var i=this;return this._data=e,this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(e){if(e)i.fire(new t.ErrorEvent(e));else{var n={dataType:"source",sourceDataType:"content"};i._collectResourceTiming&&i._resourceTiming&&i._resourceTiming.length>0&&(n.resourceTiming=i._resourceTiming,i._resourceTiming=[]),i.fire(new t.Event("data",n))}})),this},i.prototype.getClusterExpansionZoom=function(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},e),this},i.prototype.getClusterChildren=function(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},e),this},i.prototype.getClusterLeaves=function(t,e,i,n){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:e,offset:i},n),this},i.prototype._updateWorkerData=function(e){var i=this;this._loaded=!1;var n=t.extend({},this.workerOptions),r=this._data;"string"==typeof r?(n.request=this.map._requestManager.transformRequest(t.browser.resolveURL(r),t.ResourceType.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(r),this.actor.send(this.type+".loadData",n,(function(t,r){i._removed||r&&r.abandoned||(i._loaded=!0,r&&r.resourceTiming&&r.resourceTiming[i.id]&&(i._resourceTiming=r.resourceTiming[i.id].slice(0)),i.actor.send(i.type+".coalesce",{source:n.source},null),e(t))}))},i.prototype.loaded=function(){return this._loaded},i.prototype.loadTile=function(e,i){var n=this,r=e.actor?"reloadTile":"loadTile";e.actor=this.actor,e.request=this.actor.send(r,{type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(function(t,a){return delete e.request,e.unloadVectorData(),e.aborted?i(null):t?i(t):(e.loadVectorData(a,n.map.painter,"reloadTile"===r),i(null))}))},i.prototype.abortTile=function(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0},i.prototype.unloadTile=function(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})},i.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},i.prototype.serialize=function(){return t.extend({},this._options,{type:this.type,data:this._data})},i.prototype.hasTransition=function(){return!1},i}(t.Evented),R=t.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),z=function(e){function i(t,i,n,r){e.call(this),this.id=t,this.dispatcher=n,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(r),this.options=i}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.load=function(e,i){var n=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this.url=this.options.url,t.getImage(this.map._requestManager.transformRequest(this.url,t.ResourceType.Image),(function(r,a){n._loaded=!0,r?n.fire(new t.ErrorEvent(r)):a&&(n.image=a,e&&(n.coordinates=e),i&&i(),n._finishLoading())}))},i.prototype.loaded=function(){return this._loaded},i.prototype.updateImage=function(t){var e=this;return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,(function(){e.texture=null})),this):this},i.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})))},i.prototype.onAdd=function(t){this.map=t,this.load()},i.prototype.setCoordinates=function(e){var i=this;this.coordinates=e;var n=e.map(t.MercatorCoordinate.fromLngLat);this.tileID=function(e){for(var i=1/0,n=1/0,r=-1/0,a=-1/0,o=0,s=e;o<s.length;o+=1){var l=s[o];i=Math.min(i,l.x),n=Math.min(n,l.y),r=Math.max(r,l.x),a=Math.max(a,l.y)}var c=Math.max(r-i,a-n),u=Math.max(0,Math.floor(-Math.log(c)/Math.LN2)),h=Math.pow(2,u);return new t.CanonicalTileID(u,Math.floor((i+r)/2*h),Math.floor((n+a)/2*h))}(n),this.minzoom=this.maxzoom=this.tileID.z;var r=n.map((function(t){return i.tileID.getTilePoint(t)._round()}));return this._boundsArray=new t.StructArrayLayout4i8,this._boundsArray.emplaceBack(r[0].x,r[0].y,0,0),this._boundsArray.emplaceBack(r[1].x,r[1].y,t.EXTENT,0),this._boundsArray.emplaceBack(r[3].x,r[3].y,0,t.EXTENT),this._boundsArray.emplaceBack(r[2].x,r[2].y,t.EXTENT,t.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})),this},i.prototype.prepare=function(){if(0!==Object.keys(this.tiles).length&&this.image){var e=this.map.painter.context,i=e.gl;for(var n in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,R.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new t.Texture(e,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this.tiles){var r=this.tiles[n];"loaded"!==r.state&&(r.state="loaded",r.texture=this.texture)}}},i.prototype.loadTile=function(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))},i.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},i.prototype.hasTransition=function(){return!1},i}(t.Evented),P=function(e){function i(t,i,n,r){e.call(this,t,i,n,r),this.roundZoom=!0,this.type="video",this.options=i}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.load=function(){var e=this;this._loaded=!1;var i=this.options;this.urls=[];for(var n=0,r=i.urls;n<r.length;n+=1)this.urls.push(this.map._requestManager.transformRequest(r[n],t.ResourceType.Source).url);t.getVideo(this.urls,(function(i,n){e._loaded=!0,i?e.fire(new t.ErrorEvent(i)):n&&(e.video=n,e.video.loop=!0,e.video.addEventListener("playing",(function(){e.map.triggerRepaint()})),e.map&&e.video.play(),e._finishLoading())}))},i.prototype.pause=function(){this.video&&this.video.pause()},i.prototype.play=function(){this.video&&this.video.play()},i.prototype.seek=function(e){if(this.video){var i=this.video.seekable;e<i.start(0)||e>i.end(0)?this.fire(new t.ErrorEvent(new t.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+i.start(0)+" and "+i.end(0)+"-second mark."))):this.video.currentTime=e}},i.prototype.getVideo=function(){return this.video},i.prototype.onAdd=function(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},i.prototype.prepare=function(){if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){var e=this.map.painter.context,i=e.gl;for(var n in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,R.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new t.Texture(e,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this.tiles){var r=this.tiles[n];"loaded"!==r.state&&(r.state="loaded",r.texture=this.texture)}}},i.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},i.prototype.hasTransition=function(){return this.video&&!this.video.paused},i}(z),D=function(e){function i(i,n,r,a){e.call(this,i,n,r,a),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some((function(t){return!Array.isArray(t)||2!==t.length||t.some((function(t){return"number"!=typeof t}))}))||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+i,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+i,null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new t.ErrorEvent(new t.ValidationError("sources."+i,null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof t.window.HTMLCanvasElement||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+i,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+i,null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof t.window.HTMLCanvasElement?this.options.canvas:t.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},i.prototype.getCanvas=function(){return this.canvas},i.prototype.onAdd=function(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()},i.prototype.onRemove=function(){this.pause()},i.prototype.prepare=function(){var e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){var i=this.map.painter.context,n=i.gl;for(var r in this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,R.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.Texture(i,this.canvas,n.RGBA,{premultiply:!0}),this.tiles){var a=this.tiles[r];"loaded"!==a.state&&(a.state="loaded",a.texture=this.texture)}}},i.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},i.prototype.hasTransition=function(){return this._playing},i.prototype._hasInvalidDimensions=function(){for(var t=0,e=[this.canvas.width,this.canvas.height];t<e.length;t+=1){var i=e[t];if(isNaN(i)||i<=0)return!0}return!1},i}(z),L={vector:C,raster:I,"raster-dem":A,geojson:k,video:P,image:z,canvas:D};function B(e,i){var n=t.identity([]);return t.translate(n,n,[1,1,0]),t.scale(n,n,[.5*e.width,.5*e.height,1]),t.multiply(n,n,e.calculatePosMatrix(i.toUnwrapped()))}function O(t,e,i,n,r,a){var o=function(t,e,i){if(t)for(var n=0,r=t;n<r.length;n+=1){var a=e[r[n]];if(a&&a.source===i&&"fill-extrusion"===a.type)return!0}else for(var o in e){var s=e[o];if(s.source===i&&"fill-extrusion"===s.type)return!0}return!1}(r&&r.layers,e,t.id),s=a.maxPitchScaleFactor(),l=t.tilesIn(n,s,o);l.sort(F);for(var c=[],u=0,h=l;u<h.length;u+=1){var p=h[u];c.push({wrappedTileID:p.tileID.wrapped().key,queryResults:p.tile.queryRenderedFeatures(e,i,t._state,p.queryGeometry,p.cameraQueryGeometry,p.scale,r,a,s,B(t.transform,p.tileID))})}var d=function(t){for(var e={},i={},n=0,r=t;n<r.length;n+=1){var a=r[n],o=a.queryResults,s=a.wrappedTileID,l=i[s]=i[s]||{};for(var c in o)for(var u=o[c],h=l[c]=l[c]||{},p=e[c]=e[c]||[],d=0,f=u;d<f.length;d+=1){var m=f[d];h[m.featureIndex]||(h[m.featureIndex]=!0,p.push(m))}}return e}(c);for(var f in d)d[f].forEach((function(e){var i=e.feature,n=t.getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=n}));return d}function F(t,e){var i=t.tileID,n=e.tileID;return i.overscaledZ-n.overscaledZ||i.canonical.y-n.canonical.y||i.wrap-n.wrap||i.canonical.x-n.canonical.x}var N=function(t,e){this.max=t,this.onRemove=e,this.reset()};N.prototype.reset=function(){for(var t in this.data)for(var e=0,i=this.data[t];e<i.length;e+=1){var n=i[e];n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value)}return this.data={},this.order=[],this},N.prototype.add=function(t,e,i){var n=this,r=t.wrapped().key;void 0===this.data[r]&&(this.data[r]=[]);var a={value:e,timeout:void 0};if(void 0!==i&&(a.timeout=setTimeout((function(){n.remove(t,a)}),i)),this.data[r].push(a),this.order.push(r),this.order.length>this.max){var o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this},N.prototype.has=function(t){return t.wrapped().key in this.data},N.prototype.getAndRemove=function(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null},N.prototype._getAndRemoveByKey=function(t){var e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value},N.prototype.getByKey=function(t){var e=this.data[t];return e?e[0].value:null},N.prototype.get=function(t){return this.has(t)?this.data[t.wrapped().key][0].value:null},N.prototype.remove=function(t,e){if(!this.has(t))return this;var i=t.wrapped().key,n=void 0===e?0:this.data[i].indexOf(e),r=this.data[i][n];return this.data[i].splice(n,1),r.timeout&&clearTimeout(r.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(r.value),this.order.splice(this.order.indexOf(i),1),this},N.prototype.setMaxSize=function(t){for(this.max=t;this.order.length>this.max;){var e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this},N.prototype.filter=function(t){var e=[];for(var i in this.data)for(var n=0,r=this.data[i];n<r.length;n+=1){var a=r[n];t(a.value)||e.push(a)}for(var o=0,s=e;o<s.length;o+=1){var l=s[o];this.remove(l.value.tileID,l)}};var U=function(t,e,i){this.context=t;var n=t.gl;this.buffer=n.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};U.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},U.prototype.updateData=function(t){var e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)},U.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var $={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},V=function(t,e,i,n){this.length=e.length,this.attributes=i,this.itemSize=e.bytesPerElement,this.dynamicDraw=n,this.context=t;var r=t.gl;this.buffer=r.createBuffer(),t.bindVertexBuffer.set(this.buffer),r.bufferData(r.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};V.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},V.prototype.updateData=function(t){var e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)},V.prototype.enableAttributes=function(t,e){for(var i=0;i<this.attributes.length;i++){var n=e.attributes[this.attributes[i].name];void 0!==n&&t.enableVertexAttribArray(n)}},V.prototype.setVertexAttribPointers=function(t,e,i){for(var n=0;n<this.attributes.length;n++){var r=this.attributes[n],a=e.attributes[r.name];void 0!==a&&t.vertexAttribPointer(a,r.components,t[$[r.type]],!1,this.itemSize,r.offset+this.itemSize*(i||0))}},V.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var j=function(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};j.prototype.get=function(){return this.current},j.prototype.set=function(t){},j.prototype.getDefault=function(){return this.default},j.prototype.setDefault=function(){this.set(this.default)};var q=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.getDefault=function(){return t.Color.transparent},i.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},i}(j),G=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 1},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)},e}(j),H=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)},e}(j),W=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return[!0,!0,!0,!0]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},e}(j),Z=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)},e}(j),Y=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 255},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)},e}(j),X=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},e.prototype.set=function(t){var e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)},e}(j),K=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)},e}(j),J=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}},e}(j),Q=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return[0,1]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)},e}(j),tt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}},e}(j),et=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.LESS},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)},e}(j),it=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}},e}(j),nt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[t.ONE,t.ZERO]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)},e}(j),rt=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.getDefault=function(){return t.Color.transparent},i.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},i}(j),at=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.FUNC_ADD},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)},e}(j),ot=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}},e}(j),st=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.BACK},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)},e}(j),lt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.CCW},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)},e}(j),ct=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)},e}(j),ut=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.TEXTURE0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)},e}(j),ht=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},e}(j),pt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}},e}(j),dt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},e}(j),ft=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}},e}(j),mt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}},e}(j),gt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){var e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1},e}(j),_t=function(t){function e(e){t.call(this,e),this.vao=e.extVertexArrayObject}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)},e}(j),yt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 4},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}},e}(j),vt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}},e}(j),xt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}},e}(j),bt=function(t){function e(e,i){t.call(this,e),this.context=e,this.parent=i}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e}(j),wt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.setDirty=function(){this.dirty=!0},e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}},e}(bt),St=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},e}(bt),Et=function(t,e,i,n){this.context=t,this.width=e,this.height=i;var r=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new wt(t,r),n&&(this.depthAttachment=new St(t,r))};Et.prototype.destroy=function(){var t=this.context.gl,e=this.colorAttachment.get();if(e&&t.deleteTexture(e),this.depthAttachment){var i=this.depthAttachment.get();i&&t.deleteRenderbuffer(i)}t.deleteFramebuffer(this.framebuffer)};var Tt=function(t,e,i){this.func=t,this.mask=e,this.range=i};Tt.ReadOnly=!1,Tt.ReadWrite=!0,Tt.disabled=new Tt(519,Tt.ReadOnly,[0,1]);var Mt=function(t,e,i,n,r,a){this.test=t,this.ref=e,this.mask=i,this.fail=n,this.depthFail=r,this.pass=a};Mt.disabled=new Mt({func:519,mask:0},0,0,7680,7680,7680);var Ct=function(t,e,i){this.blendFunction=t,this.blendColor=e,this.mask=i};Ct.disabled=new Ct(Ct.Replace=[1,0],t.Color.transparent,[!1,!1,!1,!1]),Ct.unblended=new Ct(Ct.Replace,t.Color.transparent,[!0,!0,!0,!0]),Ct.alphaBlended=new Ct([1,771],t.Color.transparent,[!0,!0,!0,!0]);var It=function(t,e,i){this.enable=t,this.mode=e,this.frontFace=i};It.disabled=new It(!1,1029,2305),It.backCCW=new It(!0,1029,2305);var At=function(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new q(this),this.clearDepth=new G(this),this.clearStencil=new H(this),this.colorMask=new W(this),this.depthMask=new Z(this),this.stencilMask=new Y(this),this.stencilFunc=new X(this),this.stencilOp=new K(this),this.stencilTest=new J(this),this.depthRange=new Q(this),this.depthTest=new tt(this),this.depthFunc=new et(this),this.blend=new it(this),this.blendFunc=new nt(this),this.blendColor=new rt(this),this.blendEquation=new at(this),this.cullFace=new ot(this),this.cullFaceSide=new st(this),this.frontFace=new lt(this),this.program=new ct(this),this.activeTexture=new ut(this),this.viewport=new ht(this),this.bindFramebuffer=new pt(this),this.bindRenderbuffer=new dt(this),this.bindTexture=new ft(this),this.bindVertexBuffer=new mt(this),this.bindElementBuffer=new gt(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new _t(this),this.pixelStoreUnpack=new yt(this),this.pixelStoreUnpackPremultiplyAlpha=new vt(this),this.pixelStoreUnpackFlipY=new xt(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)};At.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},At.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},At.prototype.createIndexBuffer=function(t,e){return new U(this,t,e)},At.prototype.createVertexBuffer=function(t,e,i){return new V(this,t,e,i)},At.prototype.createRenderbuffer=function(t,e,i){var n=this.gl,r=n.createRenderbuffer();return this.bindRenderbuffer.set(r),n.renderbufferStorage(n.RENDERBUFFER,t,e,i),this.bindRenderbuffer.set(null),r},At.prototype.createFramebuffer=function(t,e,i){return new Et(this,t,e,i)},At.prototype.clear=function(t){var e=t.color,i=t.depth,n=this.gl,r=0;e&&(r|=n.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==i&&(r|=n.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(i),this.depthMask.set(!0)),n.clear(r)},At.prototype.setCullFace=function(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))},At.prototype.setDepthMode=function(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)},At.prototype.setStencilMode=function(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)},At.prototype.setColorMode=function(e){t.deepEqual(e.blendFunction,Ct.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)},At.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var kt=function(e){function i(i,n,r){var a=this;e.call(this),this.id=i,this.dispatcher=r,this.on("data",(function(t){"source"===t.dataType&&"metadata"===t.sourceDataType&&(a._sourceLoaded=!0),a._sourceLoaded&&!a._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(a.reload(),a.transform&&a.update(a.transform))})),this.on("error",(function(){a._sourceErrored=!0})),this._source=function(e,i,n,r){var a=new L[i.type](e,i,n,r);if(a.id!==e)throw new Error("Expected Source id to be "+e+" instead of "+a.id);return t.bindAll(["load","abort","unload","serialize","prepare"],a),a}(i,n,r,this),this._tiles={},this._cache=new N(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new t.SourceFeatureState}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.onAdd=function(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)},i.prototype.onRemove=function(t){this._source&&this._source.onRemove&&this._source.onRemove(t)},i.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(var t in this._tiles){var e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0},i.prototype.getSource=function(){return this._source},i.prototype.pause=function(){this._paused=!0},i.prototype.resume=function(){if(this._paused){var t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}},i.prototype._loadTile=function(t,e){return this._source.loadTile(t,e)},i.prototype._unloadTile=function(t){if(this._source.unloadTile)return this._source.unloadTile(t,(function(){}))},i.prototype._abortTile=function(t){if(this._source.abortTile)return this._source.abortTile(t,(function(){}))},i.prototype.serialize=function(){return this._source.serialize()},i.prototype.prepare=function(t){for(var e in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var i=this._tiles[e];i.upload(t),i.prepare(this.map.style.imageManager)}},i.prototype.getIds=function(){return t.values(this._tiles).map((function(t){return t.tileID})).sort(Rt).map((function(t){return t.key}))},i.prototype.getRenderableIds=function(e){var i=this,n=[];for(var r in this._tiles)this._isIdRenderable(r,e)&&n.push(this._tiles[r]);return e?n.sort((function(e,n){var r=e.tileID,a=n.tileID,o=new t.Point(r.canonical.x,r.canonical.y)._rotate(i.transform.angle),s=new t.Point(a.canonical.x,a.canonical.y)._rotate(i.transform.angle);return r.overscaledZ-a.overscaledZ||s.y-o.y||s.x-o.x})).map((function(t){return t.tileID.key})):n.map((function(t){return t.tileID})).sort(Rt).map((function(t){return t.key}))},i.prototype.hasRenderableParent=function(t){var e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)},i.prototype._isIdRenderable=function(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())},i.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var t in this._cache.reset(),this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(t,"reloading")},i.prototype._reloadTile=function(t,e){var i=this._tiles[t];i&&("loading"!==i.state&&(i.state=e),this._loadTile(i,this._tileLoaded.bind(this,i,t,e)))},i.prototype._tileLoaded=function(e,i,n,r){if(r)return e.state="errored",void(404!==r.status?this._source.fire(new t.ErrorEvent(r,{tile:e})):this.update(this.transform));e.timeAdded=t.browser.now(),"expired"===n&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new t.Event("data",{dataType:"source",tile:e,coord:e.tileID}))},i.prototype._backfillDEM=function(t){for(var e=this.getRenderableIds(),i=0;i<e.length;i++){var n=e[i];if(t.neighboringTiles&&t.neighboringTiles[n]){var r=this.getTileByID(n);a(t,r),a(r,t)}}function a(t,e){t.needsHillshadePrepare=!0;var i=e.tileID.canonical.x-t.tileID.canonical.x,n=e.tileID.canonical.y-t.tileID.canonical.y,r=Math.pow(2,t.tileID.canonical.z),a=e.tileID.key;0===i&&0===n||Math.abs(n)>1||(Math.abs(i)>1&&(1===Math.abs(i+r)?i+=r:1===Math.abs(i-r)&&(i-=r)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,i,n),t.neighboringTiles&&t.neighboringTiles[a]&&(t.neighboringTiles[a].backfilled=!0)))}},i.prototype.getTile=function(t){return this.getTileByID(t.key)},i.prototype.getTileByID=function(t){return this._tiles[t]},i.prototype._retainLoadedChildren=function(t,e,i,n){for(var r in this._tiles){var a=this._tiles[r];if(!(n[r]||!a.hasData()||a.tileID.overscaledZ<=e||a.tileID.overscaledZ>i)){for(var o=a.tileID;a&&a.tileID.overscaledZ>e+1;){var s=a.tileID.scaledTo(a.tileID.overscaledZ-1);(a=this._tiles[s.key])&&a.hasData()&&(o=s)}for(var l=o;l.overscaledZ>e;)if(t[(l=l.scaledTo(l.overscaledZ-1)).key]){n[o.key]=o;break}}}},i.prototype.findLoadedParent=function(t,e){if(t.key in this._loadedParentTiles){var i=this._loadedParentTiles[t.key];return i&&i.tileID.overscaledZ>=e?i:null}for(var n=t.overscaledZ-1;n>=e;n--){var r=t.scaledTo(n),a=this._getLoadedTile(r);if(a)return a}},i.prototype._getLoadedTile=function(t){var e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey(t.wrapped().key)},i.prototype.updateCacheSize=function(t){var e=Math.ceil(t.width/this._source.tileSize)+1,i=Math.ceil(t.height/this._source.tileSize)+1,n=Math.floor(e*i*5),r="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,n):n;this._cache.setMaxSize(r)},i.prototype.handleWrapJump=function(t){var e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){var i={};for(var n in this._tiles){var r=this._tiles[n];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+e),i[r.tileID.key]=r}for(var a in this._tiles=i,this._timers)clearTimeout(this._timers[a]),delete this._timers[a];for(var o in this._tiles)this._setTileReloadTimer(o,this._tiles[o])}},i.prototype.update=function(e){var n=this;if(this.transform=e,this._sourceLoaded&&!this._paused){var r;this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?r=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((function(e){return new t.OverscaledTileID(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y)})):(r=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(r=r.filter((function(t){return n._source.hasTile(t)})))):r=[];var a=e.coveringZoomLevel(this._source),o=Math.max(a-i.maxOverzooming,this._source.minzoom),s=Math.max(a+i.maxUnderzooming,this._source.minzoom),l=this._updateRetainedTiles(r,a);if(zt(this._source.type)){for(var c={},u={},h=0,p=Object.keys(l);h<p.length;h+=1){var d=p[h],f=l[d],m=this._tiles[d];if(m&&!(m.fadeEndTime&&m.fadeEndTime<=t.browser.now())){var g=this.findLoadedParent(f,o);g&&(this._addTile(g.tileID),c[g.tileID.key]=g.tileID),u[d]=f}}for(var _ in this._retainLoadedChildren(u,a,s,l),c)l[_]||(this._coveredTiles[_]=!0,l[_]=c[_])}for(var y in l)this._tiles[y].clearFadeHold();for(var v=0,x=t.keysDifference(this._tiles,l);v<x.length;v+=1){var b=x[v],w=this._tiles[b];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(b)}this._updateLoadedParentTileCache()}},i.prototype.releaseSymbolFadeTiles=function(){for(var t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)},i.prototype._updateRetainedTiles=function(t,e){for(var n={},r={},a=Math.max(e-i.maxOverzooming,this._source.minzoom),o=Math.max(e+i.maxUnderzooming,this._source.minzoom),s={},l=0,c=t;l<c.length;l+=1){var u=c[l],h=this._addTile(u);n[u.key]=u,h.hasData()||e<this._source.maxzoom&&(s[u.key]=u)}this._retainLoadedChildren(s,e,o,n);for(var p=0,d=t;p<d.length;p+=1){var f=d[p],m=this._tiles[f.key];if(!m.hasData()){if(e+1>this._source.maxzoom){var g=f.children(this._source.maxzoom)[0],_=this.getTile(g);if(_&&_.hasData()){n[g.key]=g;continue}}else{var y=f.children(this._source.maxzoom);if(n[y[0].key]&&n[y[1].key]&&n[y[2].key]&&n[y[3].key])continue}for(var v=m.wasRequested(),x=f.overscaledZ-1;x>=a;--x){var b=f.scaledTo(x);if(r[b.key])break;if(r[b.key]=!0,!(m=this.getTile(b))&&v&&(m=this._addTile(b)),m&&(n[b.key]=b,v=m.wasRequested(),m.hasData()))break}}}return n},i.prototype._updateLoadedParentTileCache=function(){for(var t in this._loadedParentTiles={},this._tiles){for(var e=[],i=void 0,n=this._tiles[t].tileID;n.overscaledZ>0;){if(n.key in this._loadedParentTiles){i=this._loadedParentTiles[n.key];break}e.push(n.key);var r=n.scaledTo(n.overscaledZ-1);if(i=this._getLoadedTile(r))break;n=r}for(var a=0,o=e;a<o.length;a+=1)this._loadedParentTiles[o[a]]=i}},i.prototype._addTile=function(e){var i=this._tiles[e.key];if(i)return i;(i=this._cache.getAndRemove(e))&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));var n=Boolean(i);return n||(i=new t.Tile(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))),i?(i.uses++,this._tiles[e.key]=i,n||this._source.fire(new t.Event("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null},i.prototype._setTileReloadTimer=function(t,e){var i=this;t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);var n=e.getExpiryTimeout();n&&(this._timers[t]=setTimeout((function(){i._reloadTile(t,"expired"),delete i._timers[t]}),n))},i.prototype._removeTile=function(t){var e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))},i.prototype.clearTiles=function(){for(var t in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(t);this._cache.reset()},i.prototype.tilesIn=function(e,i,n){var r=this,a=[],o=this.transform;if(!o)return a;for(var s=n?o.getCameraQueryGeometry(e):e,l=e.map((function(t){return o.pointCoordinate(t)})),c=s.map((function(t){return o.pointCoordinate(t)})),u=this.getIds(),h=1/0,p=1/0,d=-1/0,f=-1/0,m=0,g=c;m<g.length;m+=1){var _=g[m];h=Math.min(h,_.x),p=Math.min(p,_.y),d=Math.max(d,_.x),f=Math.max(f,_.y)}for(var y=function(e){var n=r._tiles[u[e]];if(!n.holdingForFade()){var s=n.tileID,m=Math.pow(2,o.zoom-n.tileID.overscaledZ),g=i*n.queryPadding*t.EXTENT/n.tileSize/m,_=[s.getTilePoint(new t.MercatorCoordinate(h,p)),s.getTilePoint(new t.MercatorCoordinate(d,f))];if(_[0].x-g<t.EXTENT&&_[0].y-g<t.EXTENT&&_[1].x+g>=0&&_[1].y+g>=0){var y=l.map((function(t){return s.getTilePoint(t)})),v=c.map((function(t){return s.getTilePoint(t)}));a.push({tile:n,tileID:s,queryGeometry:y,cameraQueryGeometry:v,scale:m})}}},v=0;v<u.length;v++)y(v);return a},i.prototype.getVisibleCoordinates=function(t){for(var e=this,i=this.getRenderableIds(t).map((function(t){return e._tiles[t].tileID})),n=0,r=i;n<r.length;n+=1){var a=r[n];a.posMatrix=this.transform.calculatePosMatrix(a.toUnwrapped())}return i},i.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(zt(this._source.type))for(var e in this._tiles){var i=this._tiles[e];if(void 0!==i.fadeEndTime&&i.fadeEndTime>=t.browser.now())return!0}return!1},i.prototype.setFeatureState=function(t,e,i){this._state.updateState(t=t||"_geojsonTileLayer",e,i)},i.prototype.removeFeatureState=function(t,e,i){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,i)},i.prototype.getFeatureState=function(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)},i.prototype.setDependencies=function(t,e,i){var n=this._tiles[t];n&&n.setDependencies(e,i)},i.prototype.reloadTilesForDependencies=function(t,e){for(var i in this._tiles)this._tiles[i].hasDependency(t,e)&&this._reloadTile(i,"reloading");this._cache.filter((function(i){return!i.hasDependency(t,e)}))},i}(t.Evented);function Rt(t,e){var i=Math.abs(2*t.wrap)-+(t.wrap<0),n=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||n-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function zt(t){return"raster"===t||"image"===t||"video"===t}function Pt(){return new t.window.Worker(Yr.workerUrl)}kt.maxOverzooming=10,kt.maxUnderzooming=3;var Dt="mapboxgl_preloaded_worker_pool",Lt=function(){this.active={}};Lt.prototype.acquire=function(t){if(!this.workers)for(this.workers=[];this.workers.length<Lt.workerCount;)this.workers.push(new Pt);return this.active[t]=!0,this.workers.slice()},Lt.prototype.release=function(t){delete this.active[t],0===this.numActive()&&(this.workers.forEach((function(t){t.terminate()})),this.workers=null)},Lt.prototype.isPreloaded=function(){return!!this.active[Dt]},Lt.prototype.numActive=function(){return Object.keys(this.active).length};var Bt,Ot=Math.floor(t.browser.hardwareConcurrency/2);function Ft(){return Bt||(Bt=new Lt),Bt}function Nt(e,i){var n={};for(var r in e)"ref"!==r&&(n[r]=e[r]);return t.refProperties.forEach((function(t){t in i&&(n[t]=i[t])})),n}function Ut(t){t=t.slice();for(var e=Object.create(null),i=0;i<t.length;i++)e[t[i].id]=t[i];for(var n=0;n<t.length;n++)"ref"in t[n]&&(t[n]=Nt(t[n],e[t[n].ref]));return t}Lt.workerCount=Math.max(Math.min(Ot,6),1);var $t={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Vt(t,e,i){i.push({command:$t.addSource,args:[t,e[t]]})}function jt(t,e,i){e.push({command:$t.removeSource,args:[t]}),i[t]=!0}function qt(t,e,i,n){jt(t,i,n),Vt(t,e,i)}function Gt(e,i,n){var r;for(r in e[n])if(e[n].hasOwnProperty(r)&&"data"!==r&&!t.deepEqual(e[n][r],i[n][r]))return!1;for(r in i[n])if(i[n].hasOwnProperty(r)&&"data"!==r&&!t.deepEqual(e[n][r],i[n][r]))return!1;return!0}function Ht(e,i,n,r,a,o){var s;for(s in i=i||{},e=e||{})e.hasOwnProperty(s)&&(t.deepEqual(e[s],i[s])||n.push({command:o,args:[r,s,i[s],a]}));for(s in i)i.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(t.deepEqual(e[s],i[s])||n.push({command:o,args:[r,s,i[s],a]}))}function Wt(t){return t.id}function Zt(t,e){return t[e.id]=e,t}var Yt=function(t,e){this.reset(t,e)};Yt.prototype.reset=function(t,e){this.points=t||[],this._distances=[0];for(var i=1;i<this.points.length;i++)this._distances[i]=this._distances[i-1]+this.points[i].dist(this.points[i-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(e||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Yt.prototype.lerp=function(e){if(1===this.points.length)return this.points[0];e=t.clamp(e,0,1);for(var i=1,n=this._distances[i],r=e*this.paddedLength+this.padding;n<r&&i<this._distances.length;)n=this._distances[++i];var a=i-1,o=this._distances[a],s=n-o,l=s>0?(r-o)/s:0;return this.points[a].mult(1-l).add(this.points[i].mult(l))};var Xt=function(t,e,i){var n=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(t/i),this.yCellCount=Math.ceil(e/i);for(var a=0;a<this.xCellCount*this.yCellCount;a++)n.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0};function Kt(e,i,n,r,a){var o=t.create();return i?(t.scale(o,o,[1/a,1/a,1]),n||t.rotateZ(o,o,r.angle)):t.multiply(o,r.labelPlaneMatrix,e),o}function Jt(e,i,n,r,a){if(i){var o=t.clone(e);return t.scale(o,o,[a,a,1]),n||t.rotateZ(o,o,-r.angle),o}return r.glCoordMatrix}function Qt(e,i){var n=[e.x,e.y,0,1];ue(n,n,i);var r=n[3];return{point:new t.Point(n[0]/r,n[1]/r),signedDistanceFromCamera:r}}function te(t,e){return.5+t/e*.5}function ee(t,e){var i=t[0]/t[3],n=t[1]/t[3];return i>=-e[0]&&i<=e[0]&&n>=-e[1]&&n<=e[1]}function ie(e,i,n,r,a,o,s,l){var c=r?e.textSizeData:e.iconSizeData,u=t.evaluateSizeForZoom(c,n.transform.zoom),h=[256/n.width*2+1,256/n.height*2+1],p=r?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;p.clear();for(var d=e.lineVertexArray,f=r?e.text.placedSymbolArray:e.icon.placedSymbolArray,m=n.transform.width/n.transform.height,g=!1,_=0;_<f.length;_++){var y=f.get(_);if(y.hidden||y.writingMode===t.WritingMode.vertical&&!g)ce(y.numGlyphs,p);else{g=!1;var v=[y.anchorX,y.anchorY,0,1];if(t.transformMat4(v,v,i),ee(v,h)){var x=te(n.transform.cameraToCenterDistance,v[3]),b=t.evaluateSizeForFeature(c,u,y),w=s?b/x:b*x,S=new t.Point(y.anchorX,y.anchorY),E=Qt(S,a).point,T={},M=ae(y,w,!1,l,i,a,o,e.glyphOffsetArray,d,p,E,S,T,m);g=M.useVertical,(M.notEnoughRoom||g||M.needsFlipping&&ae(y,w,!0,l,i,a,o,e.glyphOffsetArray,d,p,E,S,T,m).notEnoughRoom)&&ce(y.numGlyphs,p)}else ce(y.numGlyphs,p)}}r?e.text.dynamicLayoutVertexBuffer.updateData(p):e.icon.dynamicLayoutVertexBuffer.updateData(p)}function ne(t,e,i,n,r,a,o,s,l,c,u){var h=s.glyphStartIndex+s.numGlyphs,p=s.lineStartIndex,d=s.lineStartIndex+s.lineLength,f=e.getoffsetX(s.glyphStartIndex),m=e.getoffsetX(h-1),g=se(t*f,i,n,r,a,o,s.segment,p,d,l,c,u);if(!g)return null;var _=se(t*m,i,n,r,a,o,s.segment,p,d,l,c,u);return _?{first:g,last:_}:null}function re(e,i,n,r){return e===t.WritingMode.horizontal&&Math.abs(n.y-i.y)>Math.abs(n.x-i.x)*r?{useVertical:!0}:(e===t.WritingMode.vertical?i.y<n.y:i.x>n.x)?{needsFlipping:!0}:null}function ae(e,i,n,r,a,o,s,l,c,u,h,p,d,f){var m,g=i/24,_=e.lineOffsetX*g,y=e.lineOffsetY*g;if(e.numGlyphs>1){var v=e.glyphStartIndex+e.numGlyphs,x=e.lineStartIndex,b=e.lineStartIndex+e.lineLength,w=ne(g,l,_,y,n,h,p,e,c,o,d);if(!w)return{notEnoughRoom:!0};var S=Qt(w.first.point,s).point,E=Qt(w.last.point,s).point;if(r&&!n){var T=re(e.writingMode,S,E,f);if(T)return T}m=[w.first];for(var M=e.glyphStartIndex+1;M<v-1;M++)m.push(se(g*l.getoffsetX(M),_,y,n,h,p,e.segment,x,b,c,o,d));m.push(w.last)}else{if(r&&!n){var C=Qt(p,a).point,I=e.lineStartIndex+e.segment+1,A=new t.Point(c.getx(I),c.gety(I)),k=Qt(A,a),R=k.signedDistanceFromCamera>0?k.point:oe(p,A,C,1,a),z=re(e.writingMode,C,R,f);if(z)return z}var P=se(g*l.getoffsetX(e.glyphStartIndex),_,y,n,h,p,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,c,o,d);if(!P)return{notEnoughRoom:!0};m=[P]}for(var D=0,L=m;D<L.length;D+=1){var B=L[D];t.addDynamicAttributes(u,B.point,B.angle)}return{}}function oe(t,e,i,n,r){var a=Qt(t.add(t.sub(e)._unit()),r).point,o=i.sub(a);return i.add(o._mult(n/o.mag()))}function se(e,i,n,r,a,o,s,l,c,u,h,p){var d=r?e-i:e+i,f=d>0?1:-1,m=0;r&&(f*=-1,m=Math.PI),f<0&&(m+=Math.PI);for(var g=f>0?l+s:l+s+1,_=a,y=a,v=0,x=0,b=Math.abs(d),w=[];v+x<=b;){if((g+=f)<l||g>=c)return null;if(y=_,w.push(_),void 0===(_=p[g])){var S=new t.Point(u.getx(g),u.gety(g)),E=Qt(S,h);if(E.signedDistanceFromCamera>0)_=p[g]=E.point;else{var T=g-f;_=oe(0===v?o:new t.Point(u.getx(T),u.gety(T)),S,y,b-v+1,h)}}v+=x,x=y.dist(_)}var M=(b-v)/x,C=_.sub(y),I=C.mult(M)._add(y);I._add(C._unit()._perp()._mult(n*f));var A=m+Math.atan2(_.y-y.y,_.x-y.x);return w.push(I),{point:I,angle:A,path:w}}Xt.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Xt.prototype.insert=function(t,e,i,n,r){this._forEachCell(e,i,n,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(r)},Xt.prototype.insertCircle=function(t,e,i,n){this._forEachCell(e-n,i-n,e+n,i+n,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(i),this.circles.push(n)},Xt.prototype._insertBoxCell=function(t,e,i,n,r,a){this.boxCells[r].push(a)},Xt.prototype._insertCircleCell=function(t,e,i,n,r,a){this.circleCells[r].push(a)},Xt.prototype._query=function(t,e,i,n,r,a){if(i<0||t>this.width||n<0||e>this.height)return!r&&[];var o=[];if(t<=0&&e<=0&&this.width<=i&&this.height<=n){if(r)return!0;for(var s=0;s<this.boxKeys.length;s++)o.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});for(var l=0;l<this.circleKeys.length;l++){var c=this.circles[3*l],u=this.circles[3*l+1],h=this.circles[3*l+2];o.push({key:this.circleKeys[l],x1:c-h,y1:u-h,x2:c+h,y2:u+h})}return a?o.filter(a):o}return this._forEachCell(t,e,i,n,this._queryCell,o,{hitTest:r,seenUids:{box:{},circle:{}}},a),r?o.length>0:o},Xt.prototype._queryCircle=function(t,e,i,n,r){var a=t-i,o=t+i,s=e-i,l=e+i;if(o<0||a>this.width||l<0||s>this.height)return!n&&[];var c=[];return this._forEachCell(a,s,o,l,this._queryCellCircle,c,{hitTest:n,circle:{x:t,y:e,radius:i},seenUids:{box:{},circle:{}}},r),n?c.length>0:c},Xt.prototype.query=function(t,e,i,n,r){return this._query(t,e,i,n,!1,r)},Xt.prototype.hitTest=function(t,e,i,n,r){return this._query(t,e,i,n,!0,r)},Xt.prototype.hitTestCircle=function(t,e,i,n){return this._queryCircle(t,e,i,!0,n)},Xt.prototype._queryCell=function(t,e,i,n,r,a,o,s){var l=o.seenUids,c=this.boxCells[r];if(null!==c)for(var u=this.bboxes,h=0,p=c;h<p.length;h+=1){var d=p[h];if(!l.box[d]){l.box[d]=!0;var f=4*d;if(t<=u[f+2]&&e<=u[f+3]&&i>=u[f+0]&&n>=u[f+1]&&(!s||s(this.boxKeys[d]))){if(o.hitTest)return a.push(!0),!0;a.push({key:this.boxKeys[d],x1:u[f],y1:u[f+1],x2:u[f+2],y2:u[f+3]})}}}var m=this.circleCells[r];if(null!==m)for(var g=this.circles,_=0,y=m;_<y.length;_+=1){var v=y[_];if(!l.circle[v]){l.circle[v]=!0;var x=3*v;if(this._circleAndRectCollide(g[x],g[x+1],g[x+2],t,e,i,n)&&(!s||s(this.circleKeys[v]))){if(o.hitTest)return a.push(!0),!0;var b=g[x],w=g[x+1],S=g[x+2];a.push({key:this.circleKeys[v],x1:b-S,y1:w-S,x2:b+S,y2:w+S})}}}},Xt.prototype._queryCellCircle=function(t,e,i,n,r,a,o,s){var l=o.circle,c=o.seenUids,u=this.boxCells[r];if(null!==u)for(var h=this.bboxes,p=0,d=u;p<d.length;p+=1){var f=d[p];if(!c.box[f]){c.box[f]=!0;var m=4*f;if(this._circleAndRectCollide(l.x,l.y,l.radius,h[m+0],h[m+1],h[m+2],h[m+3])&&(!s||s(this.boxKeys[f])))return a.push(!0),!0}}var g=this.circleCells[r];if(null!==g)for(var _=this.circles,y=0,v=g;y<v.length;y+=1){var x=v[y];if(!c.circle[x]){c.circle[x]=!0;var b=3*x;if(this._circlesCollide(_[b],_[b+1],_[b+2],l.x,l.y,l.radius)&&(!s||s(this.circleKeys[x])))return a.push(!0),!0}}},Xt.prototype._forEachCell=function(t,e,i,n,r,a,o,s){for(var l=this._convertToXCellCoord(t),c=this._convertToYCellCoord(e),u=this._convertToXCellCoord(i),h=this._convertToYCellCoord(n),p=l;p<=u;p++)for(var d=c;d<=h;d++)if(r.call(this,t,e,i,n,this.xCellCount*d+p,a,o,s))return},Xt.prototype._convertToXCellCoord=function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))},Xt.prototype._convertToYCellCoord=function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))},Xt.prototype._circlesCollide=function(t,e,i,n,r,a){var o=n-t,s=r-e,l=i+a;return l*l>o*o+s*s},Xt.prototype._circleAndRectCollide=function(t,e,i,n,r,a,o){var s=(a-n)/2,l=Math.abs(t-(n+s));if(l>s+i)return!1;var c=(o-r)/2,u=Math.abs(e-(r+c));if(u>c+i)return!1;if(l<=s||u<=c)return!0;var h=l-s,p=u-c;return h*h+p*p<=i*i};var le=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ce(t,e){for(var i=0;i<t;i++){var n=e.length;e.resize(n+4),e.float32.set(le,3*n)}}function ue(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[4]*r+i[12],t[1]=i[1]*n+i[5]*r+i[13],t[3]=i[3]*n+i[7]*r+i[15],t}var he=function(t,e,i){void 0===e&&(e=new Xt(t.width+200,t.height+200,25)),void 0===i&&(i=new Xt(t.width+200,t.height+200,25)),this.transform=t,this.grid=e,this.ignoredGrid=i,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+100,this.screenBottomBoundary=t.height+100,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200};function pe(e,i,n){return i*(t.EXTENT/(e.tileSize*Math.pow(2,n-e.tileID.overscaledZ)))}he.prototype.placeCollisionBox=function(t,e,i,n,r){var a=this.projectAndGetPerspectiveRatio(n,t.anchorPointX,t.anchorPointY),o=i*a.perspectiveRatio,s=t.x1*o+a.point.x,l=t.y1*o+a.point.y,c=t.x2*o+a.point.x,u=t.y2*o+a.point.y;return!this.isInsideGrid(s,l,c,u)||!e&&this.grid.hitTest(s,l,c,u,r)?{box:[],offscreen:!1}:{box:[s,l,c,u],offscreen:this.isOffscreen(s,l,c,u)}},he.prototype.placeCollisionCircles=function(e,i,n,r,a,o,s,l,c,u,h,p,d){var f=[],m=new t.Point(i.anchorX,i.anchorY),g=Qt(m,o),_=te(this.transform.cameraToCenterDistance,g.signedDistanceFromCamera),y=(u?a/_:a*_)/t.ONE_EM,v=Qt(m,s).point,x=ne(y,r,i.lineOffsetX*y,i.lineOffsetY*y,!1,v,m,i,n,s,{}),b=!1,w=!1,S=!0;if(x){for(var E=.5*p*_+d,T=new t.Point(-100,-100),M=new t.Point(this.screenRightBoundary,this.screenBottomBoundary),C=new Yt,I=x.first,A=x.last,k=[],R=I.path.length-1;R>=1;R--)k.push(I.path[R]);for(var z=1;z<A.path.length;z++)k.push(A.path[z]);var P=2.5*E;if(l){var D=k.map((function(t){return Qt(t,l)}));k=D.some((function(t){return t.signedDistanceFromCamera<=0}))?[]:D.map((function(t){return t.point}))}var L=[];if(k.length>0){for(var B=k[0].clone(),O=k[0].clone(),F=1;F<k.length;F++)B.x=Math.min(B.x,k[F].x),B.y=Math.min(B.y,k[F].y),O.x=Math.max(O.x,k[F].x),O.y=Math.max(O.y,k[F].y);L=B.x>=T.x&&O.x<=M.x&&B.y>=T.y&&O.y<=M.y?[k]:O.x<T.x||B.x>M.x||O.y<T.y||B.y>M.y?[]:t.clipLine([k],T.x,T.y,M.x,M.y)}for(var N=0,U=L;N<U.length;N+=1){var $;C.reset(U[N],.25*E),$=C.length<=.5*E?1:Math.ceil(C.paddedLength/P)+1;for(var V=0;V<$;V++){var j=V/Math.max($-1,1),q=C.lerp(j),G=q.x+100,H=q.y+100;f.push(G,H,E,0);var W=G-E,Z=H-E,Y=G+E,X=H+E;if(S=S&&this.isOffscreen(W,Z,Y,X),w=w||this.isInsideGrid(W,Z,Y,X),!e&&this.grid.hitTestCircle(G,H,E,h)&&(b=!0,!c))return{circles:[],offscreen:!1,collisionDetected:b}}}}return{circles:!c&&b||!w?[]:f,offscreen:S,collisionDetected:b}},he.prototype.queryRenderedSymbols=function(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};for(var i=[],n=1/0,r=1/0,a=-1/0,o=-1/0,s=0,l=e;s<l.length;s+=1){var c=l[s],u=new t.Point(c.x+100,c.y+100);n=Math.min(n,u.x),r=Math.min(r,u.y),a=Math.max(a,u.x),o=Math.max(o,u.y),i.push(u)}for(var h={},p={},d=0,f=this.grid.query(n,r,a,o).concat(this.ignoredGrid.query(n,r,a,o));d<f.length;d+=1){var m=f[d],g=m.key;if(void 0===h[g.bucketInstanceId]&&(h[g.bucketInstanceId]={}),!h[g.bucketInstanceId][g.featureIndex]){var _=[new t.Point(m.x1,m.y1),new t.Point(m.x2,m.y1),new t.Point(m.x2,m.y2),new t.Point(m.x1,m.y2)];t.polygonIntersectsPolygon(i,_)&&(h[g.bucketInstanceId][g.featureIndex]=!0,void 0===p[g.bucketInstanceId]&&(p[g.bucketInstanceId]=[]),p[g.bucketInstanceId].push(g.featureIndex))}}return p},he.prototype.insertCollisionBox=function(t,e,i,n,r){(e?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:n,collisionGroupID:r},t[0],t[1],t[2],t[3])},he.prototype.insertCollisionCircles=function(t,e,i,n,r){for(var a=e?this.ignoredGrid:this.grid,o={bucketInstanceId:i,featureIndex:n,collisionGroupID:r},s=0;s<t.length;s+=4)a.insertCircle(o,t[s],t[s+1],t[s+2])},he.prototype.projectAndGetPerspectiveRatio=function(e,i,n){var r=[i,n,0,1];return ue(r,r,e),{point:new t.Point((r[0]/r[3]+1)/2*this.transform.width+100,(-r[1]/r[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/r[3]*.5}},he.prototype.isOffscreen=function(t,e,i,n){return i<100||t>=this.screenRightBoundary||n<100||e>this.screenBottomBoundary},he.prototype.isInsideGrid=function(t,e,i,n){return i>=0&&t<this.gridRightBoundary&&n>=0&&e<this.gridBottomBoundary},he.prototype.getViewportMatrix=function(){var e=t.identity([]);return t.translate(e,e,[-100,-100,0]),e};var de=function(t,e,i,n){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):n&&i?1:0,this.placed=i};de.prototype.isHidden=function(){return 0===this.opacity&&!this.placed};var fe=function(t,e,i,n,r){this.text=new de(t?t.text:null,e,i,r),this.icon=new de(t?t.icon:null,e,n,r)};fe.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var me=function(t,e,i){this.text=t,this.icon=e,this.skipFade=i},ge=function(){this.invProjMatrix=t.create(),this.viewportMatrix=t.create(),this.circles=[]},_e=function(t,e,i,n,r){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=i,this.bucketIndex=n,this.tileID=r},ye=function(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}};function ve(e,i,n,r,a){var o=t.getAnchorAlignment(e),s=-(o.horizontalAlign-.5)*i,l=-(o.verticalAlign-.5)*n,c=t.evaluateVariableOffset(e,r);return new t.Point(s+c[0]*a,l+c[1]*a)}function xe(e,i,n,r,a,o){var s=e.x1,l=e.x2,c=e.y1,u=e.y2,h=e.anchorPointX,p=e.anchorPointY,d=new t.Point(i,n);return r&&d._rotate(a?o:-o),{x1:s+d.x,y1:c+d.y,x2:l+d.x,y2:u+d.y,anchorPointX:h,anchorPointY:p}}ye.prototype.get=function(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){var e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:function(t){return t.collisionGroupID===e}}}return this.collisionGroups[t]};var be=function(t,e,i,n){this.transform=t.clone(),this.collisionIndex=new he(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new ye(i),this.collisionCircleArrays={},this.prevPlacement=n,n&&(n.prevPlacement=void 0),this.placedOrientations={}};function we(t,e,i,n,r){t.emplaceBack(e?1:0,i?1:0,n||0,r||0),t.emplaceBack(e?1:0,i?1:0,n||0,r||0),t.emplaceBack(e?1:0,i?1:0,n||0,r||0),t.emplaceBack(e?1:0,i?1:0,n||0,r||0)}be.prototype.getBucketParts=function(e,i,n,r){var a=n.getBucket(i),o=n.latestFeatureIndex;if(a&&o&&i.id===a.layerIds[0]){var s=n.collisionBoxArray,l=a.layers[0].layout,c=Math.pow(2,this.transform.zoom-n.tileID.overscaledZ),u=n.tileSize/t.EXTENT,h=this.transform.calculatePosMatrix(n.tileID.toUnwrapped()),p="map"===l.get("text-pitch-alignment"),d="map"===l.get("text-rotation-alignment"),f=pe(n,1,this.transform.zoom),m=Kt(h,p,d,this.transform,f),g=null;if(p){var _=Jt(h,p,d,this.transform,f);g=t.multiply([],this.transform.labelPlaneMatrix,_)}this.retainedQueryData[a.bucketInstanceId]=new _e(a.bucketInstanceId,o,a.sourceLayerIndex,a.index,n.tileID);var y={bucket:a,layout:l,posMatrix:h,textLabelPlaneMatrix:m,labelToScreenMatrix:g,scale:c,textPixelRatio:u,holdingForFade:n.holdingForFade(),collisionBoxArray:s,partiallyEvaluatedTextSize:t.evaluateSizeForZoom(a.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(a.sourceID)};if(r)for(var v=0,x=a.sortKeyRanges;v<x.length;v+=1){var b=x[v];e.push({sortKey:b.sortKey,symbolInstanceStart:b.symbolInstanceStart,symbolInstanceEnd:b.symbolInstanceEnd,parameters:y})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:a.symbolInstances.length,parameters:y})}},be.prototype.attemptAnchorPlacement=function(t,e,i,n,r,a,o,s,l,c,u,h,p,d,f){var m,g=[h.textOffset0,h.textOffset1],_=ve(t,i,n,g,r),y=this.collisionIndex.placeCollisionBox(xe(e,_.x,_.y,a,o,this.transform.angle),u,s,l,c.predicate);if(!f||0!==this.collisionIndex.placeCollisionBox(xe(f,_.x,_.y,a,o,this.transform.angle),u,s,l,c.predicate).box.length)return y.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID].text&&(m=this.prevPlacement.variableOffsets[h.crossTileID].anchor),this.variableOffsets[h.crossTileID]={textOffset:g,width:i,height:n,anchor:t,textBoxScale:r,prevAnchor:m},this.markUsedJustification(p,t,h,d),p.allowVerticalPlacement&&(this.markUsedOrientation(p,d,h),this.placedOrientations[h.crossTileID]=d),{shift:_,placedGlyphBoxes:y}):void 0},be.prototype.placeLayerBucketPart=function(e,i,n){var r=this,a=e.parameters,o=a.bucket,s=a.layout,l=a.posMatrix,c=a.textLabelPlaneMatrix,u=a.labelToScreenMatrix,h=a.textPixelRatio,p=a.holdingForFade,d=a.collisionBoxArray,f=a.partiallyEvaluatedTextSize,m=a.collisionGroup,g=s.get("text-optional"),_=s.get("icon-optional"),y=s.get("text-allow-overlap"),v=s.get("icon-allow-overlap"),x="map"===s.get("text-rotation-alignment"),b="map"===s.get("text-pitch-alignment"),w="none"!==s.get("icon-text-fit"),S="viewport-y"===s.get("symbol-z-order"),E=y&&(v||!o.hasIconData()||_),T=v&&(y||!o.hasTextData()||g);!o.collisionArrays&&d&&o.deserializeCollisionBoxes(d);var M=function(e,a){if(!i[e.crossTileID])if(p)r.placements[e.crossTileID]=new me(!1,!1,!1);else{var d,S=!1,M=!1,C=!0,I=null,A={box:null,offscreen:null},k={box:null,offscreen:null},R=null,z=null,P=0,D=0,L=0;a.textFeatureIndex?P=a.textFeatureIndex:e.useRuntimeCollisionCircles&&(P=e.featureIndex),a.verticalTextFeatureIndex&&(D=a.verticalTextFeatureIndex);var B=a.textBox;if(B){var O=function(i){var n=t.WritingMode.horizontal;if(o.allowVerticalPlacement&&!i&&r.prevPlacement){var a=r.prevPlacement.placedOrientations[e.crossTileID];a&&(r.placedOrientations[e.crossTileID]=a,r.markUsedOrientation(o,n=a,e))}return n},F=function(i,n){if(o.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&a.verticalTextBox)for(var r=0,s=o.writingModes;r<s.length&&(s[r]===t.WritingMode.vertical?(A=n(),k=A):A=i(),!(A&&A.box&&A.box.length));r+=1);else A=i()};if(s.get("text-variable-anchor")){var N=s.get("text-variable-anchor");if(r.prevPlacement&&r.prevPlacement.variableOffsets[e.crossTileID]){var U=r.prevPlacement.variableOffsets[e.crossTileID];N.indexOf(U.anchor)>0&&(N=N.filter((function(t){return t!==U.anchor}))).unshift(U.anchor)}var $=function(t,i,n){for(var a=t.x2-t.x1,s=t.y2-t.y1,c=e.textBoxScale,u=w&&!v?i:null,p={box:[],offscreen:!1},d=y?2*N.length:N.length,f=0;f<d;++f){var g=r.attemptAnchorPlacement(N[f%N.length],t,a,s,c,x,b,h,l,m,f>=N.length,e,o,n,u);if(g&&(p=g.placedGlyphBoxes)&&p.box&&p.box.length){S=!0,I=g.shift;break}}return p};F((function(){return $(B,a.iconBox,t.WritingMode.horizontal)}),(function(){var i=a.verticalTextBox;return o.allowVerticalPlacement&&!(A&&A.box&&A.box.length)&&e.numVerticalGlyphVertices>0&&i?$(i,a.verticalIconBox,t.WritingMode.vertical):{box:null,offscreen:null}})),A&&(S=A.box,C=A.offscreen);var V=O(A&&A.box);if(!S&&r.prevPlacement){var j=r.prevPlacement.variableOffsets[e.crossTileID];j&&(r.variableOffsets[e.crossTileID]=j,r.markUsedJustification(o,j.anchor,e,V))}}else{var q=function(t,i){var n=r.collisionIndex.placeCollisionBox(t,y,h,l,m.predicate);return n&&n.box&&n.box.length&&(r.markUsedOrientation(o,i,e),r.placedOrientations[e.crossTileID]=i),n};F((function(){return q(B,t.WritingMode.horizontal)}),(function(){var i=a.verticalTextBox;return o.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&i?q(i,t.WritingMode.vertical):{box:null,offscreen:null}})),O(A&&A.box&&A.box.length)}}if(S=(d=A)&&d.box&&d.box.length>0,C=d&&d.offscreen,e.useRuntimeCollisionCircles){var G=o.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex),H=t.evaluateSizeForFeature(o.textSizeData,f,G),W=s.get("text-padding");R=r.collisionIndex.placeCollisionCircles(y,G,o.lineVertexArray,o.glyphOffsetArray,H,l,c,u,n,b,m.predicate,e.collisionCircleDiameter,W),S=y||R.circles.length>0&&!R.collisionDetected,C=C&&R.offscreen}if(a.iconFeatureIndex&&(L=a.iconFeatureIndex),a.iconBox){var Z=function(t){var e=w&&I?xe(t,I.x,I.y,x,b,r.transform.angle):t;return r.collisionIndex.placeCollisionBox(e,v,h,l,m.predicate)};M=k&&k.box&&k.box.length&&a.verticalIconBox?(z=Z(a.verticalIconBox)).box.length>0:(z=Z(a.iconBox)).box.length>0,C=C&&z.offscreen}var Y=g||0===e.numHorizontalGlyphVertices&&0===e.numVerticalGlyphVertices,X=_||0===e.numIconVertices;if(Y||X?X?Y||(M=M&&S):S=M&&S:M=S=M&&S,S&&d&&d.box&&r.collisionIndex.insertCollisionBox(d.box,s.get("text-ignore-placement"),o.bucketInstanceId,k&&k.box&&D?D:P,m.ID),M&&z&&r.collisionIndex.insertCollisionBox(z.box,s.get("icon-ignore-placement"),o.bucketInstanceId,L,m.ID),R&&(S&&r.collisionIndex.insertCollisionCircles(R.circles,s.get("text-ignore-placement"),o.bucketInstanceId,P,m.ID),n)){var K=o.bucketInstanceId,J=r.collisionCircleArrays[K];void 0===J&&(J=r.collisionCircleArrays[K]=new ge);for(var Q=0;Q<R.circles.length;Q+=4)J.circles.push(R.circles[Q+0]),J.circles.push(R.circles[Q+1]),J.circles.push(R.circles[Q+2]),J.circles.push(R.collisionDetected?1:0)}r.placements[e.crossTileID]=new me(S||E,M||T,C||o.justReloaded),i[e.crossTileID]=!0}};if(S)for(var C=o.getSortedSymbolIndexes(this.transform.angle),I=C.length-1;I>=0;--I){var A=C[I];M(o.symbolInstances.get(A),o.collisionArrays[A])}else for(var k=e.symbolInstanceStart;k<e.symbolInstanceEnd;k++)M(o.symbolInstances.get(k),o.collisionArrays[k]);if(n&&o.bucketInstanceId in this.collisionCircleArrays){var R=this.collisionCircleArrays[o.bucketInstanceId];t.invert(R.invProjMatrix,l),R.viewportMatrix=this.collisionIndex.getViewportMatrix()}o.justReloaded=!1},be.prototype.markUsedJustification=function(e,i,n,r){var a;a=r===t.WritingMode.vertical?n.verticalPlacedTextSymbolIndex:{left:n.leftJustifiedTextSymbolIndex,center:n.centerJustifiedTextSymbolIndex,right:n.rightJustifiedTextSymbolIndex}[t.getAnchorJustification(i)];for(var o=0,s=[n.leftJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.rightJustifiedTextSymbolIndex,n.verticalPlacedTextSymbolIndex];o<s.length;o+=1){var l=s[o];l>=0&&(e.text.placedSymbolArray.get(l).crossTileID=a>=0&&l!==a?0:n.crossTileID)}},be.prototype.markUsedOrientation=function(e,i,n){for(var r=i===t.WritingMode.horizontal||i===t.WritingMode.horizontalOnly?i:0,a=i===t.WritingMode.vertical?i:0,o=0,s=[n.leftJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.rightJustifiedTextSymbolIndex];o<s.length;o+=1)e.text.placedSymbolArray.get(s[o]).placedOrientation=r;n.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(n.verticalPlacedTextSymbolIndex).placedOrientation=a)},be.prototype.commit=function(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;var e=this.prevPlacement,i=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;var n=e?e.symbolFadeChange(t):1,r=e?e.opacities:{},a=e?e.variableOffsets:{},o=e?e.placedOrientations:{};for(var s in this.placements){var l=this.placements[s],c=r[s];c?(this.opacities[s]=new fe(c,n,l.text,l.icon),i=i||l.text!==c.text.placed||l.icon!==c.icon.placed):(this.opacities[s]=new fe(null,n,l.text,l.icon,l.skipFade),i=i||l.text||l.icon)}for(var u in r){var h=r[u];if(!this.opacities[u]){var p=new fe(h,n,!1,!1);p.isHidden()||(this.opacities[u]=p,i=i||h.text.placed||h.icon.placed)}}for(var d in a)this.variableOffsets[d]||!this.opacities[d]||this.opacities[d].isHidden()||(this.variableOffsets[d]=a[d]);for(var f in o)this.placedOrientations[f]||!this.opacities[f]||this.opacities[f].isHidden()||(this.placedOrientations[f]=o[f]);i?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)},be.prototype.updateLayerOpacities=function(t,e){for(var i={},n=0,r=e;n<r.length;n+=1){var a=r[n],o=a.getBucket(t);o&&a.latestFeatureIndex&&t.id===o.layerIds[0]&&this.updateBucketOpacities(o,i,a.collisionBoxArray)}},be.prototype.updateBucketOpacities=function(e,i,n){var r=this;e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();var a=e.layers[0].layout,o=new fe(null,0,!1,!1,!0),s=a.get("text-allow-overlap"),l=a.get("icon-allow-overlap"),c=a.get("text-variable-anchor"),u="map"===a.get("text-rotation-alignment"),h="map"===a.get("text-pitch-alignment"),p="none"!==a.get("icon-text-fit"),d=new fe(null,0,s&&(l||!e.hasIconData()||a.get("icon-optional")),l&&(s||!e.hasTextData()||a.get("text-optional")),!0);!e.collisionArrays&&n&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(n);for(var f=function(t,e,i){for(var n=0;n<e/4;n++)t.opacityVertexArray.emplaceBack(i)},m=function(n){var a=e.symbolInstances.get(n),s=a.numHorizontalGlyphVertices,l=a.numVerticalGlyphVertices,m=a.crossTileID,g=r.opacities[m];i[m]?g=o:g||(r.opacities[m]=g=d),i[m]=!0;var _=a.numIconVertices>0,y=r.placedOrientations[a.crossTileID],v=y===t.WritingMode.vertical,x=y===t.WritingMode.horizontal||y===t.WritingMode.horizontalOnly;if(s>0||l>0){var b=ke(g.text);f(e.text,s,v?Re:b),f(e.text,l,x?Re:b);var w=g.text.isHidden();[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((function(t){t>=0&&(e.text.placedSymbolArray.get(t).hidden=w||v?1:0)})),a.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).hidden=w||x?1:0);var S=r.variableOffsets[a.crossTileID];S&&r.markUsedJustification(e,S.anchor,a,y);var E=r.placedOrientations[a.crossTileID];E&&(r.markUsedJustification(e,"left",a,E),r.markUsedOrientation(e,E,a))}if(_){var T=ke(g.icon),M=!(p&&a.verticalPlacedIconSymbolIndex&&v);a.placedIconSymbolIndex>=0&&(f(e.icon,a.numIconVertices,M?T:Re),e.icon.placedSymbolArray.get(a.placedIconSymbolIndex).hidden=g.icon.isHidden()),a.verticalPlacedIconSymbolIndex>=0&&(f(e.icon,a.numVerticalIconVertices,M?Re:T),e.icon.placedSymbolArray.get(a.verticalPlacedIconSymbolIndex).hidden=g.icon.isHidden())}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){var C=e.collisionArrays[n];if(C){var I=new t.Point(0,0);if(C.textBox||C.verticalTextBox){var A=!0;if(c){var k=r.variableOffsets[m];k?(I=ve(k.anchor,k.width,k.height,k.textOffset,k.textBoxScale),u&&I._rotate(h?r.transform.angle:-r.transform.angle)):A=!1}C.textBox&&we(e.textCollisionBox.collisionVertexArray,g.text.placed,!A||v,I.x,I.y),C.verticalTextBox&&we(e.textCollisionBox.collisionVertexArray,g.text.placed,!A||x,I.x,I.y)}var R=Boolean(!x&&C.verticalIconBox);C.iconBox&&we(e.iconCollisionBox.collisionVertexArray,g.icon.placed,R,p?I.x:0,p?I.y:0),C.verticalIconBox&&we(e.iconCollisionBox.collisionVertexArray,g.icon.placed,!R,p?I.x:0,p?I.y:0)}}},g=0;g<e.symbolInstances.length;g++)m(g);if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){var _=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=_.invProjMatrix,e.placementViewportMatrix=_.viewportMatrix,e.collisionCircleArray=_.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}},be.prototype.symbolFadeChange=function(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},be.prototype.zoomAdjustment=function(t){return Math.max(0,(this.transform.zoom-t)/1.5)},be.prototype.hasTransitions=function(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration},be.prototype.stillRecent=function(t,e){var i=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*i>t},be.prototype.setStale=function(){this.stale=!0};var Se=Math.pow(2,25),Ee=Math.pow(2,24),Te=Math.pow(2,17),Me=Math.pow(2,16),Ce=Math.pow(2,9),Ie=Math.pow(2,8),Ae=Math.pow(2,1);function ke(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;var e=t.placed?1:0,i=Math.floor(127*t.opacity);return i*Se+e*Ee+i*Te+e*Me+i*Ce+e*Ie+i*Ae+e}var Re=0,ze=function(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};ze.prototype.continuePlacement=function(t,e,i,n,r){for(var a=this._bucketParts;this._currentTileIndex<t.length;)if(e.getBucketParts(a,n,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,r())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,a.sort((function(t,e){return t.sortKey-e.sortKey})));this._currentPartIndex<a.length;)if(e.placeLayerBucketPart(a[this._currentPartIndex],this._seenCrossTileIDs,i),this._currentPartIndex++,r())return!0;return!1};var Pe=function(t,e,i,n,r,a,o){this.placement=new be(t,r,a,o),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=n,this._done=!1};Pe.prototype.isDone=function(){return this._done},Pe.prototype.continuePlacement=function(e,i,n){for(var r=this,a=t.browser.now(),o=function(){var e=t.browser.now()-a;return!r._forceFullPlacement&&e>2};this._currentPlacementIndex>=0;){var s=i[e[this._currentPlacementIndex]],l=this.placement.collisionIndex.transform.zoom;if("symbol"===s.type&&(!s.minzoom||s.minzoom<=l)&&(!s.maxzoom||s.maxzoom>l)){if(this._inProgressLayer||(this._inProgressLayer=new ze(s)),this._inProgressLayer.continuePlacement(n[s.source],this.placement,this._showCollisionBoxes,s,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Pe.prototype.commit=function(t){return this.placement.commit(t),this.placement};var De=512/t.EXTENT/2,Le=function(t,e,i){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=i;for(var n=0;n<e.length;n++){var r=e.get(n),a=r.key;this.indexedSymbolInstances[a]||(this.indexedSymbolInstances[a]=[]),this.indexedSymbolInstances[a].push({crossTileID:r.crossTileID,coord:this.getScaledCoordinates(r,t)})}};Le.prototype.getScaledCoordinates=function(e,i){var n=De/Math.pow(2,i.canonical.z-this.tileID.canonical.z);return{x:Math.floor((i.canonical.x*t.EXTENT+e.anchorX)*n),y:Math.floor((i.canonical.y*t.EXTENT+e.anchorY)*n)}},Le.prototype.findMatches=function(t,e,i){for(var n=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z),r=0;r<t.length;r++){var a=t.get(r);if(!a.crossTileID){var o=this.indexedSymbolInstances[a.key];if(o)for(var s=this.getScaledCoordinates(a,e),l=0,c=o;l<c.length;l+=1){var u=c[l];if(Math.abs(u.coord.x-s.x)<=n&&Math.abs(u.coord.y-s.y)<=n&&!i[u.crossTileID]){i[u.crossTileID]=!0,a.crossTileID=u.crossTileID;break}}}}};var Be=function(){this.maxCrossTileID=0};Be.prototype.generate=function(){return++this.maxCrossTileID};var Oe=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Oe.prototype.handleWrapJump=function(t){var e=Math.round((t-this.lng)/360);if(0!==e)for(var i in this.indexes){var n=this.indexes[i],r={};for(var a in n){var o=n[a];o.tileID=o.tileID.unwrapTo(o.tileID.wrap+e),r[o.tileID.key]=o}this.indexes[i]=r}this.lng=t},Oe.prototype.addBucket=function(t,e,i){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(var n=0;n<e.symbolInstances.length;n++)e.symbolInstances.get(n).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});var r=this.usedCrossTileIDs[t.overscaledZ];for(var a in this.indexes){var o=this.indexes[a];if(Number(a)>t.overscaledZ)for(var s in o){var l=o[s];l.tileID.isChildOf(t)&&l.findMatches(e.symbolInstances,t,r)}else{var c=o[t.scaledTo(Number(a)).key];c&&c.findMatches(e.symbolInstances,t,r)}}for(var u=0;u<e.symbolInstances.length;u++){var h=e.symbolInstances.get(u);h.crossTileID||(h.crossTileID=i.generate(),r[h.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Le(t,e.symbolInstances,e.bucketInstanceId),!0},Oe.prototype.removeBucketCrossTileIDs=function(t,e){for(var i in e.indexedSymbolInstances)for(var n=0,r=e.indexedSymbolInstances[i];n<r.length;n+=1)delete this.usedCrossTileIDs[t][r[n].crossTileID]},Oe.prototype.removeStaleBuckets=function(t){var e=!1;for(var i in this.indexes){var n=this.indexes[i];for(var r in n)t[n[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,n[r]),delete n[r],e=!0)}return e};var Fe=function(){this.layerIndexes={},this.crossTileIDs=new Be,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Fe.prototype.addLayer=function(t,e,i){var n=this.layerIndexes[t.id];void 0===n&&(n=this.layerIndexes[t.id]=new Oe);var r=!1,a={};n.handleWrapJump(i);for(var o=0,s=e;o<s.length;o+=1){var l=s[o],c=l.getBucket(t);c&&t.id===c.layerIds[0]&&(c.bucketInstanceId||(c.bucketInstanceId=++this.maxBucketInstanceId),n.addBucket(l.tileID,c,this.crossTileIDs)&&(r=!0),a[c.bucketInstanceId]=!0)}return n.removeStaleBuckets(a)&&(r=!0),r},Fe.prototype.pruneUnusedLayers=function(t){var e={};for(var i in t.forEach((function(t){e[t]=!0})),this.layerIndexes)e[i]||delete this.layerIndexes[i]};var Ne=function(e,i){return t.emitValidationErrors(e,i&&i.filter((function(t){return"source.canvas"!==t.identifier})))},Ue=t.pick($t,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),$e=t.pick($t,["setCenter","setZoom","setBearing","setPitch"]),Ve=function(){var e={},i=t.styleSpec.$version;for(var n in t.styleSpec.$root){var r,a=t.styleSpec.$root[n];a.required&&null!=(r="version"===n?i:"array"===a.type?[]:{})&&(e[n]=r)}return e}(),je=function(e){function i(n,r){var a=this;void 0===r&&(r={}),e.call(this),this.map=n,this.dispatcher=new E(Ft(),this),this.imageManager=new p,this.imageManager.setEventedParent(this),this.glyphManager=new v(n._requestManager,r.localIdeographFontFamily),this.lineAtlas=new S(256,512),this.crossTileSymbolIndex=new Fe,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new t.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",t.getReferrer());var o=this;this._rtlTextPluginCallback=i.registerForPluginStateChange((function(e){o.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:e.pluginStatus,pluginURL:e.pluginURL},(function(e,i){if(t.triggerPluginCompletionEvent(e),i&&i.every((function(t){return t})))for(var n in o.sourceCaches)o.sourceCaches[n].reload()}))})),this.on("data",(function(t){if("source"===t.dataType&&"metadata"===t.sourceDataType){var e=a.sourceCaches[t.sourceId];if(e){var i=e.getSource();if(i&&i.vectorLayerIds)for(var n in a._layers){var r=a._layers[n];r.source===i.id&&a._validateLayer(r)}}}}))}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.loadURL=function(e,i){var n=this;void 0===i&&(i={}),this.fire(new t.Event("dataloading",{dataType:"style"}));var r="boolean"==typeof i.validate?i.validate:!t.isMapboxURL(e);e=this.map._requestManager.normalizeStyleURL(e,i.accessToken);var a=this.map._requestManager.transformRequest(e,t.ResourceType.Style);this._request=t.getJSON(a,(function(e,i){n._request=null,e?n.fire(new t.ErrorEvent(e)):i&&n._load(i,r)}))},i.prototype.loadJSON=function(e,i){var n=this;void 0===i&&(i={}),this.fire(new t.Event("dataloading",{dataType:"style"})),this._request=t.browser.frame((function(){n._request=null,n._load(e,!1!==i.validate)}))},i.prototype.loadEmpty=function(){this.fire(new t.Event("dataloading",{dataType:"style"})),this._load(Ve,!1)},i.prototype._load=function(e,i){if(!i||!Ne(this,t.validateStyle(e))){for(var n in this._loaded=!0,this.stylesheet=e,e.sources)this.addSource(n,e.sources[n],{validate:!1});e.sprite?this._loadSprite(e.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(e.glyphs);var r=Ut(this.stylesheet.layers);this._order=r.map((function(t){return t.id})),this._layers={},this._serializedLayers={};for(var a=0,o=r;a<o.length;a+=1){var s=o[a];(s=t.createStyleLayer(s)).setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=s,this._serializedLayers[s.id]=s.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new w(this.stylesheet.light),this.fire(new t.Event("data",{dataType:"style"})),this.fire(new t.Event("style.load"))}},i.prototype._loadSprite=function(e){var i=this;this._spriteRequest=function(e,i,n){var r,a,o,s=t.browser.devicePixelRatio>1?"@2x":"",l=t.getJSON(i.transformRequest(i.normalizeSpriteURL(e,s,".json"),t.ResourceType.SpriteJSON),(function(t,e){l=null,o||(o=t,r=e,u())})),c=t.getImage(i.transformRequest(i.normalizeSpriteURL(e,s,".png"),t.ResourceType.SpriteImage),(function(t,e){c=null,o||(o=t,a=e,u())}));function u(){if(o)n(o);else if(r&&a){var e=t.browser.getImageData(a),i={};for(var s in r){var l=r[s],c=l.width,u=l.height,h=l.x,p=l.y,d=l.sdf,f=l.pixelRatio,m=l.stretchX,g=l.stretchY,_=l.content,y=new t.RGBAImage({width:c,height:u});t.RGBAImage.copy(e,y,{x:h,y:p},{x:0,y:0},{width:c,height:u}),i[s]={data:y,pixelRatio:f,sdf:d,stretchX:m,stretchY:g,content:_}}n(null,i)}}return{cancel:function(){l&&(l.cancel(),l=null),c&&(c.cancel(),c=null)}}}(e,this.map._requestManager,(function(e,n){if(i._spriteRequest=null,e)i.fire(new t.ErrorEvent(e));else if(n)for(var r in n)i.imageManager.addImage(r,n[r]);i.imageManager.setLoaded(!0),i._availableImages=i.imageManager.listImages(),i.dispatcher.broadcast("setImages",i._availableImages),i.fire(new t.Event("data",{dataType:"style"}))}))},i.prototype._validateLayer=function(e){var i=this.sourceCaches[e.source];if(i){var n=e.sourceLayer;if(n){var r=i.getSource();("geojson"===r.type||r.vectorLayerIds&&-1===r.vectorLayerIds.indexOf(n))&&this.fire(new t.ErrorEvent(new Error('Source layer "'+n+'" does not exist on source "'+r.id+'" as specified by style layer "'+e.id+'"')))}}},i.prototype.loaded=function(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()},i.prototype._serializeLayers=function(t){for(var e=[],i=0,n=t;i<n.length;i+=1){var r=this._layers[n[i]];"custom"!==r.type&&e.push(r.serialize())}return e},i.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(var e in this._layers)if(this._layers[e].hasTransition())return!0;return!1},i.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},i.prototype.update=function(e){if(this._loaded){var i=this._changed;if(this._changed){var n=Object.keys(this._updatedLayers),r=Object.keys(this._removedLayers);for(var a in(n.length||r.length)&&this._updateWorkerLayers(n,r),this._updatedSources){var o=this._updatedSources[a];"reload"===o?this._reloadSource(a):"clear"===o&&this._clearSource(a)}for(var s in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[s].updateTransitions(e);this.light.updateTransitions(e),this._resetUpdates()}var l={};for(var c in this.sourceCaches){var u=this.sourceCaches[c];l[c]=u.used,u.used=!1}for(var h=0,p=this._order;h<p.length;h+=1){var d=this._layers[p[h]];d.recalculate(e,this._availableImages),!d.isHidden(e.zoom)&&d.source&&(this.sourceCaches[d.source].used=!0)}for(var f in l){var m=this.sourceCaches[f];l[f]!==m.used&&m.fire(new t.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:f}))}this.light.recalculate(e),this.z=e.zoom,i&&this.fire(new t.Event("data",{dataType:"style"}))}},i.prototype._updateTilesForChangedImages=function(){var t=Object.keys(this._changedImages);if(t.length){for(var e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}},i.prototype._updateWorkerLayers=function(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e})},i.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},i.prototype.setState=function(e){var i=this;if(this._checkLoaded(),Ne(this,t.validateStyle(e)))return!1;(e=t.clone$1(e)).layers=Ut(e.layers);var n=function(e,i){if(!e)return[{command:$t.setStyle,args:[i]}];var n=[];try{if(!t.deepEqual(e.version,i.version))return[{command:$t.setStyle,args:[i]}];t.deepEqual(e.center,i.center)||n.push({command:$t.setCenter,args:[i.center]}),t.deepEqual(e.zoom,i.zoom)||n.push({command:$t.setZoom,args:[i.zoom]}),t.deepEqual(e.bearing,i.bearing)||n.push({command:$t.setBearing,args:[i.bearing]}),t.deepEqual(e.pitch,i.pitch)||n.push({command:$t.setPitch,args:[i.pitch]}),t.deepEqual(e.sprite,i.sprite)||n.push({command:$t.setSprite,args:[i.sprite]}),t.deepEqual(e.glyphs,i.glyphs)||n.push({command:$t.setGlyphs,args:[i.glyphs]}),t.deepEqual(e.transition,i.transition)||n.push({command:$t.setTransition,args:[i.transition]}),t.deepEqual(e.light,i.light)||n.push({command:$t.setLight,args:[i.light]});var r={},a=[];!function(e,i,n,r){var a;for(a in i=i||{},e=e||{})e.hasOwnProperty(a)&&(i.hasOwnProperty(a)||jt(a,n,r));for(a in i)i.hasOwnProperty(a)&&(e.hasOwnProperty(a)?t.deepEqual(e[a],i[a])||("geojson"===e[a].type&&"geojson"===i[a].type&&Gt(e,i,a)?n.push({command:$t.setGeoJSONSourceData,args:[a,i[a].data]}):qt(a,i,n,r)):Vt(a,i,n))}(e.sources,i.sources,a,r);var o=[];e.layers&&e.layers.forEach((function(t){r[t.source]?n.push({command:$t.removeLayer,args:[t.id]}):o.push(t)})),n=n.concat(a),function(e,i,n){i=i||[];var r,a,o,s,l,c,u,h=(e=e||[]).map(Wt),p=i.map(Wt),d=e.reduce(Zt,{}),f=i.reduce(Zt,{}),m=h.slice(),g=Object.create(null);for(r=0,a=0;r<h.length;r++)f.hasOwnProperty(o=h[r])?a++:(n.push({command:$t.removeLayer,args:[o]}),m.splice(m.indexOf(o,a),1));for(r=0,a=0;r<p.length;r++)m[m.length-1-r]!==(o=p[p.length-1-r])&&(d.hasOwnProperty(o)?(n.push({command:$t.removeLayer,args:[o]}),m.splice(m.lastIndexOf(o,m.length-a),1)):a++,n.push({command:$t.addLayer,args:[f[o],c=m[m.length-r]]}),m.splice(m.length-r,0,o),g[o]=!0);for(r=0;r<p.length;r++)if(s=d[o=p[r]],l=f[o],!g[o]&&!t.deepEqual(s,l))if(t.deepEqual(s.source,l.source)&&t.deepEqual(s["source-layer"],l["source-layer"])&&t.deepEqual(s.type,l.type)){for(u in Ht(s.layout,l.layout,n,o,null,$t.setLayoutProperty),Ht(s.paint,l.paint,n,o,null,$t.setPaintProperty),t.deepEqual(s.filter,l.filter)||n.push({command:$t.setFilter,args:[o,l.filter]}),t.deepEqual(s.minzoom,l.minzoom)&&t.deepEqual(s.maxzoom,l.maxzoom)||n.push({command:$t.setLayerZoomRange,args:[o,l.minzoom,l.maxzoom]}),s)s.hasOwnProperty(u)&&"layout"!==u&&"paint"!==u&&"filter"!==u&&"metadata"!==u&&"minzoom"!==u&&"maxzoom"!==u&&(0===u.indexOf("paint.")?Ht(s[u],l[u],n,o,u.slice(6),$t.setPaintProperty):t.deepEqual(s[u],l[u])||n.push({command:$t.setLayerProperty,args:[o,u,l[u]]}));for(u in l)l.hasOwnProperty(u)&&!s.hasOwnProperty(u)&&"layout"!==u&&"paint"!==u&&"filter"!==u&&"metadata"!==u&&"minzoom"!==u&&"maxzoom"!==u&&(0===u.indexOf("paint.")?Ht(s[u],l[u],n,o,u.slice(6),$t.setPaintProperty):t.deepEqual(s[u],l[u])||n.push({command:$t.setLayerProperty,args:[o,u,l[u]]}))}else n.push({command:$t.removeLayer,args:[o]}),c=m[m.lastIndexOf(o)+1],n.push({command:$t.addLayer,args:[l,c]})}(o,i.layers,n)}catch(t){console.warn("Unable to compute style diff:",t),n=[{command:$t.setStyle,args:[i]}]}return n}(this.serialize(),e).filter((function(t){return!(t.command in $e)}));if(0===n.length)return!1;var r=n.filter((function(t){return!(t.command in Ue)}));if(r.length>0)throw new Error("Unimplemented: "+r.map((function(t){return t.command})).join(", ")+".");return n.forEach((function(t){"setTransition"!==t.command&&i[t.command].apply(i,t.args)})),this.stylesheet=e,!0},i.prototype.addImage=function(e,i){if(this.getImage(e))return this.fire(new t.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(e,i),this._afterImageUpdated(e)},i.prototype.updateImage=function(t,e){this.imageManager.updateImage(t,e)},i.prototype.getImage=function(t){return this.imageManager.getImage(t)},i.prototype.removeImage=function(e){if(!this.getImage(e))return this.fire(new t.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(e),this._afterImageUpdated(e)},i.prototype._afterImageUpdated=function(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new t.Event("data",{dataType:"style"}))},i.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},i.prototype.addSource=function(e,i,n){var r=this;if(void 0===n&&(n={}),this._checkLoaded(),void 0!==this.sourceCaches[e])throw new Error("There is already a source with this ID");if(!i.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(i).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(t.validateStyle.source,"sources."+e,i,null,n))){this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);var a=this.sourceCaches[e]=new kt(e,i,this.dispatcher);a.style=this,a.setEventedParent(this,(function(){return{isSourceLoaded:r.loaded(),source:a.serialize(),sourceId:e}})),a.onAdd(this.map),this._changed=!0}},i.prototype.removeSource=function(e){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw new Error("There is no source with this ID");for(var i in this._layers)if(this._layers[i].source===e)return this.fire(new t.ErrorEvent(new Error('Source "'+e+'" cannot be removed while layer "'+i+'" is using it.')));var n=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],n.fire(new t.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),n.setEventedParent(null),n.clearTiles(),n.onRemove&&n.onRemove(this.map),this._changed=!0},i.prototype.setGeoJSONSourceData=function(t,e){this._checkLoaded(),this.sourceCaches[t].getSource().setData(e),this._changed=!0},i.prototype.getSource=function(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()},i.prototype.addLayer=function(e,i,n){void 0===n&&(n={}),this._checkLoaded();var r=e.id;if(this.getLayer(r))this.fire(new t.ErrorEvent(new Error('Layer with id "'+r+'" already exists on this map')));else{var a;if("custom"===e.type){if(Ne(this,t.validateCustomStyleLayer(e)))return;a=t.createStyleLayer(e)}else{if("object"==typeof e.source&&(this.addSource(r,e.source),e=t.clone$1(e),e=t.extend(e,{source:r})),this._validate(t.validateStyle.layer,"layers."+r,e,{arrayIndex:-1},n))return;a=t.createStyleLayer(e),this._validateLayer(a),a.setEventedParent(this,{layer:{id:r}}),this._serializedLayers[a.id]=a.serialize()}var o=i?this._order.indexOf(i):this._order.length;if(i&&-1===o)this.fire(new t.ErrorEvent(new Error('Layer with id "'+i+'" does not exist on this map.')));else{if(this._order.splice(o,0,r),this._layerOrderChanged=!0,this._layers[r]=a,this._removedLayers[r]&&a.source&&"custom"!==a.type){var s=this._removedLayers[r];delete this._removedLayers[r],s.type!==a.type?this._updatedSources[a.source]="clear":(this._updatedSources[a.source]="reload",this.sourceCaches[a.source].pause())}this._updateLayer(a),a.onAdd&&a.onAdd(this.map)}}},i.prototype.moveLayer=function(e,i){if(this._checkLoaded(),this._changed=!0,this._layers[e]){if(e!==i){var n=this._order.indexOf(e);this._order.splice(n,1);var r=i?this._order.indexOf(i):this._order.length;i&&-1===r?this.fire(new t.ErrorEvent(new Error('Layer with id "'+i+'" does not exist on this map.'))):(this._order.splice(r,0,e),this._layerOrderChanged=!0)}}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be moved.")))},i.prototype.removeLayer=function(e){this._checkLoaded();var i=this._layers[e];if(i){i.setEventedParent(null);var n=this._order.indexOf(e);this._order.splice(n,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=i,delete this._layers[e],delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],i.onRemove&&i.onRemove(this.map)}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be removed.")))},i.prototype.getLayer=function(t){return this._layers[t]},i.prototype.hasLayer=function(t){return t in this._layers},i.prototype.setLayerZoomRange=function(e,i,n){this._checkLoaded();var r=this.getLayer(e);r?r.minzoom===i&&r.maxzoom===n||(null!=i&&(r.minzoom=i),null!=n&&(r.maxzoom=n),this._updateLayer(r)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot have zoom extent.")))},i.prototype.setFilter=function(e,i,n){void 0===n&&(n={}),this._checkLoaded();var r=this.getLayer(e);if(r){if(!t.deepEqual(r.filter,i))return null==i?(r.filter=void 0,void this._updateLayer(r)):void(this._validate(t.validateStyle.filter,"layers."+r.id+".filter",i,null,n)||(r.filter=t.clone$1(i),this._updateLayer(r)))}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be filtered.")))},i.prototype.getFilter=function(e){return t.clone$1(this.getLayer(e).filter)},i.prototype.setLayoutProperty=function(e,i,n,r){void 0===r&&(r={}),this._checkLoaded();var a=this.getLayer(e);a?t.deepEqual(a.getLayoutProperty(i),n)||(a.setLayoutProperty(i,n,r),this._updateLayer(a)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},i.prototype.getLayoutProperty=function(e,i){var n=this.getLayer(e);if(n)return n.getLayoutProperty(i);this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style.")))},i.prototype.setPaintProperty=function(e,i,n,r){void 0===r&&(r={}),this._checkLoaded();var a=this.getLayer(e);a?t.deepEqual(a.getPaintProperty(i),n)||(a.setPaintProperty(i,n,r)&&this._updateLayer(a),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},i.prototype.getPaintProperty=function(t,e){return this.getLayer(t).getPaintProperty(e)},i.prototype.setFeatureState=function(e,i){this._checkLoaded();var n=e.source,r=e.sourceLayer,a=this.sourceCaches[n];if(void 0!==a){var o=a.getSource().type;"geojson"===o&&r?this.fire(new t.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==o||r?(void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),a.setFeatureState(r,e.id,i)):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+n+"' does not exist in the map's style.")))},i.prototype.removeFeatureState=function(e,i){this._checkLoaded();var n=e.source,r=this.sourceCaches[n];if(void 0!==r){var a=r.getSource().type,o="vector"===a?e.sourceLayer:void 0;"vector"!==a||o?i&&"string"!=typeof e.id&&"number"!=typeof e.id?this.fire(new t.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):r.removeFeatureState(o,e.id,i):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+n+"' does not exist in the map's style.")))},i.prototype.getFeatureState=function(e){this._checkLoaded();var i=e.source,n=e.sourceLayer,r=this.sourceCaches[i];if(void 0!==r){if("vector"!==r.getSource().type||n)return void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),r.getFeatureState(n,e.id);this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+i+"' does not exist in the map's style.")))},i.prototype.getTransition=function(){return t.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},i.prototype.serialize=function(){return t.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:t.mapObject(this.sourceCaches,(function(t){return t.serialize()})),layers:this._serializeLayers(this._order)},(function(t){return void 0!==t}))},i.prototype._updateLayer=function(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&"raster"!==this.sourceCaches[t.source].getSource().type&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0},i.prototype._flattenAndSortRenderedFeatures=function(t){for(var e=this,i=function(t){return"fill-extrusion"===e._layers[t].type},n={},r=[],a=this._order.length-1;a>=0;a--){var o=this._order[a];if(i(o)){n[o]=a;for(var s=0,l=t;s<l.length;s+=1){var c=l[s][o];if(c)for(var u=0,h=c;u<h.length;u+=1)r.push(h[u])}}}r.sort((function(t,e){return e.intersectionZ-t.intersectionZ}));for(var p=[],d=this._order.length-1;d>=0;d--){var f=this._order[d];if(i(f))for(var m=r.length-1;m>=0;m--){var g=r[m].feature;if(n[g.layer.id]<d)break;p.push(g),r.pop()}else for(var _=0,y=t;_<y.length;_+=1){var v=y[_][f];if(v)for(var x=0,b=v;x<b.length;x+=1)p.push(b[x].feature)}}return p},i.prototype.queryRenderedFeatures=function(e,i,n){i&&i.filter&&this._validate(t.validateStyle.filter,"queryRenderedFeatures.filter",i.filter,null,i);var r={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new t.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var a=0,o=i.layers;a<o.length;a+=1){var s=o[a],l=this._layers[s];if(!l)return this.fire(new t.ErrorEvent(new Error("The layer '"+s+"' does not exist in the map's style and cannot be queried for features."))),[];r[l.source]=!0}}var c=[];for(var u in i.availableImages=this._availableImages,this.sourceCaches)i.layers&&!r[u]||c.push(O(this.sourceCaches[u],this._layers,this._serializedLayers,e,i,n));return this.placement&&c.push(function(t,e,i,n,r,a,o){for(var s={},l=a.queryRenderedSymbols(n),c=[],u=0,h=Object.keys(l).map(Number);u<h.length;u+=1)c.push(o[h[u]]);c.sort(F);for(var p=function(){var i=f[d],n=i.featureIndex.lookupSymbolFeatures(l[i.bucketInstanceId],e,i.bucketIndex,i.sourceLayerIndex,r.filter,r.layers,r.availableImages,t);for(var a in n){var o=s[a]=s[a]||[],c=n[a];c.sort((function(t,e){var n=i.featureSortOrder;if(n){var r=n.indexOf(t.featureIndex);return n.indexOf(e.featureIndex)-r}return e.featureIndex-t.featureIndex}));for(var u=0,h=c;u<h.length;u+=1)o.push(h[u])}},d=0,f=c;d<f.length;d+=1)p();var m=function(e){s[e].forEach((function(n){var r=n.feature,a=i[t[e].source].getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=a}))};for(var g in s)m(g);return s}(this._layers,this._serializedLayers,this.sourceCaches,e,i,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(c)},i.prototype.querySourceFeatures=function(e,i){i&&i.filter&&this._validate(t.validateStyle.filter,"querySourceFeatures.filter",i.filter,null,i);var n=this.sourceCaches[e];return n?function(t,e){for(var i=t.getRenderableIds().map((function(e){return t.getTileByID(e)})),n=[],r={},a=0;a<i.length;a++){var o=i[a],s=o.tileID.canonical.key;r[s]||(r[s]=!0,o.querySourceFeatures(n,e))}return n}(n,i):[]},i.prototype.addSourceType=function(t,e,n){return i.getSourceType(t)?n(new Error('A source type called "'+t+'" already exists.')):(i.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},n):n(null,null))},i.prototype.getLight=function(){return this.light.getLight()},i.prototype.setLight=function(e,i){void 0===i&&(i={}),this._checkLoaded();var n=this.light.getLight(),r=!1;for(var a in e)if(!t.deepEqual(e[a],n[a])){r=!0;break}if(r){var o={now:t.browser.now(),transition:t.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,i),this.light.updateTransitions(o)}},i.prototype._validate=function(e,i,n,r,a){return void 0===a&&(a={}),(!a||!1!==a.validate)&&Ne(this,e.call(t.validateStyle,t.extend({key:i,style:this.serialize(),value:n,styleSpec:t.styleSpec},r)))},i.prototype._remove=function(){for(var e in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[e].setEventedParent(null);for(var i in this.sourceCaches)this.sourceCaches[i].clearTiles(),this.sourceCaches[i].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},i.prototype._clearSource=function(t){this.sourceCaches[t].clearTiles()},i.prototype._reloadSource=function(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()},i.prototype._updateSources=function(t){for(var e in this.sourceCaches)this.sourceCaches[e].update(t)},i.prototype._generateCollisionBoxes=function(){for(var t in this.sourceCaches)this._reloadSource(t)},i.prototype._updatePlacement=function(e,i,n,r,a){void 0===a&&(a=!1);for(var o=!1,s=!1,l={},c=0,u=this._order;c<u.length;c+=1){var h=this._layers[u[c]];if("symbol"===h.type){if(!l[h.source]){var p=this.sourceCaches[h.source];l[h.source]=p.getRenderableIds(!0).map((function(t){return p.getTileByID(t)})).sort((function(t,e){return e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)}))}var d=this.crossTileSymbolIndex.addLayer(h,l[h.source],e.center.lng);o=o||d}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((a=a||this._layerOrderChanged||0===n)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.browser.now(),e.zoom))&&(this.pauseablePlacement=new Pe(e,this._order,a,i,n,r,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.browser.now()),s=!0),o&&this.pauseablePlacement.placement.setStale()),s||o)for(var f=0,m=this._order;f<m.length;f+=1){var g=this._layers[m[f]];"symbol"===g.type&&this.placement.updateLayerOpacities(g,l[g.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.browser.now())},i.prototype._releaseSymbolFadeTiles=function(){for(var t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()},i.prototype.getImages=function(t,e,i){this.imageManager.getImages(e.icons,i),this._updateTilesForChangedImages();var n=this.sourceCaches[e.source];n&&n.setDependencies(e.tileID.key,e.type,e.icons)},i.prototype.getGlyphs=function(t,e,i){this.glyphManager.getGlyphs(e.stacks,i)},i.prototype.getResource=function(e,i,n){return t.makeRequest(i,n)},i}(t.Evented);je.getSourceType=function(t){return L[t]},je.setSourceType=function(t,e){L[t]=e},je.registerForPluginStateChange=t.registerForPluginStateChange;var qe=t.createLayout([{name:"a_pos",type:"Int16",components:2}]),Ge=_i("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}"),He=_i("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),We=_i("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Ze=_i("varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),Ye=_i("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Xe=_i("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),Ke=_i("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Je=_i("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Qe=_i("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),ti=_i("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),ei=_i("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),ii=_i("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),ni=_i("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),ri=_i("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),ai=_i("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),oi=_i("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),si=_i("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),li=_i("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),ci=_i("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),ui=_i("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),hi=_i("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),pi=_i("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),di=_i("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),fi=_i("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}"),mi=_i("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),gi=_i("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}");function _i(t,e){var i=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,n=e.match(/attribute ([\w]+) ([\w]+)/g),r=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),a=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),o=a?a.concat(r):r,s={};return{fragmentSource:t=t.replace(i,(function(t,e,i,n,r){return s[r]=!0,"define"===e?"\n#ifndef HAS_UNIFORM_u_"+r+"\nvarying "+i+" "+n+" "+r+";\n#else\nuniform "+i+" "+n+" u_"+r+";\n#endif\n":"\n#ifdef HAS_UNIFORM_u_"+r+"\n    "+i+" "+n+" "+r+" = u_"+r+";\n#endif\n"})),vertexSource:e=e.replace(i,(function(t,e,i,n,r){var a="float"===n?"vec2":"vec4",o=r.match(/color/)?"color":a;return s[r]?"define"===e?"\n#ifndef HAS_UNIFORM_u_"+r+"\nuniform lowp float u_"+r+"_t;\nattribute "+i+" "+a+" a_"+r+";\nvarying "+i+" "+n+" "+r+";\n#else\nuniform "+i+" "+n+" u_"+r+";\n#endif\n":"vec4"===o?"\n#ifndef HAS_UNIFORM_u_"+r+"\n    "+r+" = a_"+r+";\n#else\n    "+i+" "+n+" "+r+" = u_"+r+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+r+"\n    "+r+" = unpack_mix_"+o+"(a_"+r+", u_"+r+"_t);\n#else\n    "+i+" "+n+" "+r+" = u_"+r+";\n#endif\n":"define"===e?"\n#ifndef HAS_UNIFORM_u_"+r+"\nuniform lowp float u_"+r+"_t;\nattribute "+i+" "+a+" a_"+r+";\n#else\nuniform "+i+" "+n+" u_"+r+";\n#endif\n":"vec4"===o?"\n#ifndef HAS_UNIFORM_u_"+r+"\n    "+i+" "+n+" "+r+" = a_"+r+";\n#else\n    "+i+" "+n+" "+r+" = u_"+r+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+r+"\n    "+i+" "+n+" "+r+" = unpack_mix_"+o+"(a_"+r+", u_"+r+"_t);\n#else\n    "+i+" "+n+" "+r+" = u_"+r+";\n#endif\n"})),staticAttributes:n,staticUniforms:o}}var yi=Object.freeze({__proto__:null,prelude:Ge,background:He,backgroundPattern:We,circle:Ze,clippingMask:Ye,heatmap:Xe,heatmapTexture:Ke,collisionBox:Je,collisionCircle:Qe,debug:ti,fill:ei,fillOutline:ii,fillOutlinePattern:ni,fillPattern:ri,fillExtrusion:ai,fillExtrusionPattern:oi,hillshadePrepare:si,hillshade:li,line:ci,lineGradient:ui,linePattern:hi,lineSDF:pi,raster:di,symbolIcon:fi,symbolSDF:mi,symbolTextAndIcon:gi}),vi=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function xi(t){for(var e=[],i=0;i<t.length;i++)if(null!==t[i]){var n=t[i].split(" ");e.push(n.pop())}return e}vi.prototype.bind=function(t,e,i,n,r,a,o,s){this.context=t;for(var l=this.boundPaintVertexBuffers.length!==n.length,c=0;!l&&c<n.length;c++)this.boundPaintVertexBuffers[c]!==n[c]&&(l=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===e&&this.boundLayoutVertexBuffer===i&&!l&&this.boundIndexBuffer===r&&this.boundVertexOffset===a&&this.boundDynamicVertexBuffer===o&&this.boundDynamicVertexBuffer2===s?(t.bindVertexArrayOES.set(this.vao),o&&o.bind(),r&&r.dynamicDraw&&r.bind(),s&&s.bind()):this.freshBind(e,i,n,r,a,o,s)},vi.prototype.freshBind=function(t,e,i,n,r,a,o){var s,l=t.numAttributes,c=this.context,u=c.gl;if(c.extVertexArrayObject)this.vao&&this.destroy(),this.vao=c.extVertexArrayObject.createVertexArrayOES(),c.bindVertexArrayOES.set(this.vao),s=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=n,this.boundVertexOffset=r,this.boundDynamicVertexBuffer=a,this.boundDynamicVertexBuffer2=o;else{s=c.currentNumAttributes||0;for(var h=l;h<s;h++)u.disableVertexAttribArray(h)}e.enableAttributes(u,t);for(var p=0,d=i;p<d.length;p+=1)d[p].enableAttributes(u,t);a&&a.enableAttributes(u,t),o&&o.enableAttributes(u,t),e.bind(),e.setVertexAttribPointers(u,t,r);for(var f=0,m=i;f<m.length;f+=1){var g=m[f];g.bind(),g.setVertexAttribPointers(u,t,r)}a&&(a.bind(),a.setVertexAttribPointers(u,t,r)),n&&n.bind(),o&&(o.bind(),o.setVertexAttribPointers(u,t,r)),c.currentNumAttributes=l},vi.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var bi=function(t,e,i,n,r,a){var o=t.gl;this.program=o.createProgram();for(var s=xi(i.staticAttributes),l=n?n.getBinderAttributes():[],c=s.concat(l),u=i.staticUniforms?xi(i.staticUniforms):[],h=n?n.getBinderUniforms():[],p=[],d=0,f=u.concat(h);d<f.length;d+=1){var m=f[d];p.indexOf(m)<0&&p.push(m)}var g=n?n.defines():[];a&&g.push("#define OVERDRAW_INSPECTOR;");var _=g.concat(Ge.fragmentSource,i.fragmentSource).join("\n"),y=g.concat(Ge.vertexSource,i.vertexSource).join("\n"),v=o.createShader(o.FRAGMENT_SHADER);if(o.isContextLost())this.failedToCreate=!0;else{o.shaderSource(v,_),o.compileShader(v),o.attachShader(this.program,v);var x=o.createShader(o.VERTEX_SHADER);if(o.isContextLost())this.failedToCreate=!0;else{o.shaderSource(x,y),o.compileShader(x),o.attachShader(this.program,x),this.attributes={};var b={};this.numAttributes=c.length;for(var w=0;w<this.numAttributes;w++)c[w]&&(o.bindAttribLocation(this.program,w,c[w]),this.attributes[c[w]]=w);o.linkProgram(this.program),o.deleteShader(x),o.deleteShader(v);for(var S=0;S<p.length;S++){var E=p[S];if(E&&!b[E]){var T=o.getUniformLocation(this.program,E);T&&(b[E]=T)}}this.fixedUniforms=r(t,b),this.binderUniforms=n?n.getUniforms(t,b):[]}}};function wi(t,e,i){var n=1/pe(i,1,e.transform.tileZoom),r=Math.pow(2,i.tileID.overscaledZ),a=i.tileSize*Math.pow(2,e.transform.tileZoom)/r,o=a*(i.tileID.canonical.x+i.tileID.wrap*r),s=a*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[n,t.fromScale,t.toScale],u_fade:t.t,u_pixel_coord_upper:[o>>16,s>>16],u_pixel_coord_lower:[65535&o,65535&s]}}bi.prototype.draw=function(t,e,i,n,r,a,o,s,l,c,u,h,p,d,f,m){var g,_=t.gl;if(!this.failedToCreate){for(var y in t.program.set(this.program),t.setDepthMode(i),t.setStencilMode(n),t.setColorMode(r),t.setCullFace(a),this.fixedUniforms)this.fixedUniforms[y].set(o[y]);d&&d.setUniforms(t,this.binderUniforms,h,{zoom:p});for(var v=(g={},g[_.LINES]=2,g[_.TRIANGLES]=3,g[_.LINE_STRIP]=1,g)[e],x=0,b=u.get();x<b.length;x+=1){var w=b[x],S=w.vaos||(w.vaos={});(S[s]||(S[s]=new vi)).bind(t,this,l,d?d.getPaintVertexBuffers():[],c,w.vertexOffset,f,m),_.drawElements(e,w.primitiveLength*v,_.UNSIGNED_SHORT,w.primitiveOffset*v*2)}}};var Si=function(e,i,n,r){var a=i.style.light,o=a.properties.get("position"),s=[o.x,o.y,o.z],l=t.create$1();"viewport"===a.properties.get("anchor")&&t.fromRotation(l,-i.transform.angle),t.transformMat3(s,s,l);var c=a.properties.get("color");return{u_matrix:e,u_lightpos:s,u_lightintensity:a.properties.get("intensity"),u_lightcolor:[c.r,c.g,c.b],u_vertical_gradient:+n,u_opacity:r}},Ei=function(e,i,n,r,a,o,s){return t.extend(Si(e,i,n,r),wi(o,i,s),{u_height_factor:-Math.pow(2,a.overscaledZ)/s.tileSize/8})},Ti=function(t){return{u_matrix:t}},Mi=function(e,i,n,r){return t.extend(Ti(e),wi(n,i,r))},Ci=function(t,e){return{u_matrix:t,u_world:e}},Ii=function(e,i,n,r,a){return t.extend(Mi(e,i,n,r),{u_world:a})},Ai=function(e,i,n,r){var a,o,s=e.transform;if("map"===r.paint.get("circle-pitch-alignment")){var l=pe(n,1,s.zoom);a=!0,o=[l,l]}else a=!1,o=s.pixelsToGLUnits;return{u_camera_to_center_distance:s.cameraToCenterDistance,u_scale_with_map:+("map"===r.paint.get("circle-pitch-scale")),u_matrix:e.translatePosMatrix(i.posMatrix,n,r.paint.get("circle-translate"),r.paint.get("circle-translate-anchor")),u_pitch_with_map:+a,u_device_pixel_ratio:t.browser.devicePixelRatio,u_extrude_scale:o}},ki=function(t,e,i){var n=pe(i,1,e.zoom),r=Math.pow(2,e.zoom-i.tileID.overscaledZ),a=i.tileID.overscaleFactor();return{u_matrix:t,u_camera_to_center_distance:e.cameraToCenterDistance,u_pixels_to_tile_units:n,u_extrude_scale:[e.pixelsToGLUnits[0]/(n*r),e.pixelsToGLUnits[1]/(n*r)],u_overscale_factor:a}},Ri=function(t,e,i){return{u_matrix:t,u_inv_matrix:e,u_camera_to_center_distance:i.cameraToCenterDistance,u_viewport_size:[i.width,i.height]}},zi=function(t,e,i){return void 0===i&&(i=1),{u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:i}},Pi=function(t){return{u_matrix:t}},Di=function(t,e,i,n){return{u_matrix:t,u_extrude_scale:pe(e,1,i),u_intensity:n}},Li=function(e,i,n){var r=e.transform;return{u_matrix:Ui(e,i,n),u_ratio:1/pe(i,1,r.zoom),u_device_pixel_ratio:t.browser.devicePixelRatio,u_units_to_pixels:[1/r.pixelsToGLUnits[0],1/r.pixelsToGLUnits[1]]}},Bi=function(e,i,n,r){return t.extend(Li(e,i,n),{u_image:0,u_image_height:r})},Oi=function(e,i,n,r){var a=e.transform,o=Ni(i,a);return{u_matrix:Ui(e,i,n),u_texsize:i.imageAtlasTexture.size,u_ratio:1/pe(i,1,a.zoom),u_device_pixel_ratio:t.browser.devicePixelRatio,u_image:0,u_scale:[o,r.fromScale,r.toScale],u_fade:r.t,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]]}},Fi=function(e,i,n,r,a){var o=e.lineAtlas,s=Ni(i,e.transform),l="round"===n.layout.get("line-cap"),c=o.getDash(r.from,l),u=o.getDash(r.to,l),h=c.width*a.fromScale,p=u.width*a.toScale;return t.extend(Li(e,i,n),{u_patternscale_a:[s/h,-c.height/2],u_patternscale_b:[s/p,-u.height/2],u_sdfgamma:o.width/(256*Math.min(h,p)*t.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:c.y,u_tex_y_b:u.y,u_mix:a.t})};function Ni(t,e){return 1/pe(t,1,e.tileZoom)}function Ui(t,e,i){return t.translatePosMatrix(e.tileID.posMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}var $i=function(t,e,i,n,r){return{u_matrix:t,u_tl_parent:e,u_scale_parent:i,u_buffer_scale:1,u_fade_t:n.mix,u_opacity:n.opacity*r.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:r.paint.get("raster-brightness-min"),u_brightness_high:r.paint.get("raster-brightness-max"),u_saturation_factor:(o=r.paint.get("raster-saturation"),o>0?1-1/(1.001-o):-o),u_contrast_factor:(a=r.paint.get("raster-contrast"),a>0?1/(1-a):1+a),u_spin_weights:Vi(r.paint.get("raster-hue-rotate"))};var a,o};function Vi(t){t*=Math.PI/180;var e=Math.sin(t),i=Math.cos(t);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}var ji,qi=function(t,e,i,n,r,a,o,s,l,c){var u=r.transform;return{u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:u.cameraToCenterDistance,u_pitch:u.pitch/360*2*Math.PI,u_rotate_symbol:+i,u_aspect_ratio:u.width/u.height,u_fade_change:r.options.fadeDuration?r.symbolFadeChange:1,u_matrix:a,u_label_plane_matrix:o,u_coord_matrix:s,u_is_text:+l,u_pitch_with_map:+n,u_texsize:c,u_texture:0}},Gi=function(e,i,n,r,a,o,s,l,c,u,h){var p=a.transform;return t.extend(qi(e,i,n,r,a,o,s,l,c,u),{u_gamma_scale:r?Math.cos(p._pitch)*p.cameraToCenterDistance:1,u_device_pixel_ratio:t.browser.devicePixelRatio,u_is_halo:+h})},Hi=function(e,i,n,r,a,o,s,l,c,u){return t.extend(Gi(e,i,n,r,a,o,s,l,!0,c,!0),{u_texsize_icon:u,u_texture_icon:1})},Wi=function(t,e,i){return{u_matrix:t,u_opacity:e,u_color:i}},Zi=function(e,i,n,r,a,o){return t.extend(function(t,e,i,n){var r=i.imageManager.getPattern(t.from.toString()),a=i.imageManager.getPattern(t.to.toString()),o=i.imageManager.getPixelSize(),s=o.width,l=o.height,c=Math.pow(2,n.tileID.overscaledZ),u=n.tileSize*Math.pow(2,i.transform.tileZoom)/c,h=u*(n.tileID.canonical.x+n.tileID.wrap*c),p=u*n.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:r.tl,u_pattern_br_a:r.br,u_pattern_tl_b:a.tl,u_pattern_br_b:a.br,u_texsize:[s,l],u_mix:e.t,u_pattern_size_a:r.displaySize,u_pattern_size_b:a.displaySize,u_scale_a:e.fromScale,u_scale_b:e.toScale,u_tile_units_to_pixels:1/pe(n,1,i.transform.tileZoom),u_pixel_coord_upper:[h>>16,p>>16],u_pixel_coord_lower:[65535&h,65535&p]}}(r,o,n,a),{u_matrix:e,u_opacity:i})},Yi={fillExtrusion:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_lightpos:new t.Uniform3f(e,i.u_lightpos),u_lightintensity:new t.Uniform1f(e,i.u_lightintensity),u_lightcolor:new t.Uniform3f(e,i.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,i.u_vertical_gradient),u_opacity:new t.Uniform1f(e,i.u_opacity)}},fillExtrusionPattern:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_lightpos:new t.Uniform3f(e,i.u_lightpos),u_lightintensity:new t.Uniform1f(e,i.u_lightintensity),u_lightcolor:new t.Uniform3f(e,i.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,i.u_vertical_gradient),u_height_factor:new t.Uniform1f(e,i.u_height_factor),u_image:new t.Uniform1i(e,i.u_image),u_texsize:new t.Uniform2f(e,i.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,i.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,i.u_scale),u_fade:new t.Uniform1f(e,i.u_fade),u_opacity:new t.Uniform1f(e,i.u_opacity)}},fill:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix)}},fillPattern:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_image:new t.Uniform1i(e,i.u_image),u_texsize:new t.Uniform2f(e,i.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,i.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,i.u_scale),u_fade:new t.Uniform1f(e,i.u_fade)}},fillOutline:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_world:new t.Uniform2f(e,i.u_world)}},fillOutlinePattern:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_world:new t.Uniform2f(e,i.u_world),u_image:new t.Uniform1i(e,i.u_image),u_texsize:new t.Uniform2f(e,i.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,i.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,i.u_scale),u_fade:new t.Uniform1f(e,i.u_fade)}},circle:function(e,i){return{u_camera_to_center_distance:new t.Uniform1f(e,i.u_camera_to_center_distance),u_scale_with_map:new t.Uniform1i(e,i.u_scale_with_map),u_pitch_with_map:new t.Uniform1i(e,i.u_pitch_with_map),u_extrude_scale:new t.Uniform2f(e,i.u_extrude_scale),u_device_pixel_ratio:new t.Uniform1f(e,i.u_device_pixel_ratio),u_matrix:new t.UniformMatrix4f(e,i.u_matrix)}},collisionBox:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_camera_to_center_distance:new t.Uniform1f(e,i.u_camera_to_center_distance),u_pixels_to_tile_units:new t.Uniform1f(e,i.u_pixels_to_tile_units),u_extrude_scale:new t.Uniform2f(e,i.u_extrude_scale),u_overscale_factor:new t.Uniform1f(e,i.u_overscale_factor)}},collisionCircle:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_inv_matrix:new t.UniformMatrix4f(e,i.u_inv_matrix),u_camera_to_center_distance:new t.Uniform1f(e,i.u_camera_to_center_distance),u_viewport_size:new t.Uniform2f(e,i.u_viewport_size)}},debug:function(e,i){return{u_color:new t.UniformColor(e,i.u_color),u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_overlay:new t.Uniform1i(e,i.u_overlay),u_overlay_scale:new t.Uniform1f(e,i.u_overlay_scale)}},clippingMask:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix)}},heatmap:function(e,i){return{u_extrude_scale:new t.Uniform1f(e,i.u_extrude_scale),u_intensity:new t.Uniform1f(e,i.u_intensity),u_matrix:new t.UniformMatrix4f(e,i.u_matrix)}},heatmapTexture:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_world:new t.Uniform2f(e,i.u_world),u_image:new t.Uniform1i(e,i.u_image),u_color_ramp:new t.Uniform1i(e,i.u_color_ramp),u_opacity:new t.Uniform1f(e,i.u_opacity)}},hillshade:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_image:new t.Uniform1i(e,i.u_image),u_latrange:new t.Uniform2f(e,i.u_latrange),u_light:new t.Uniform2f(e,i.u_light),u_shadow:new t.UniformColor(e,i.u_shadow),u_highlight:new t.UniformColor(e,i.u_highlight),u_accent:new t.UniformColor(e,i.u_accent)}},hillshadePrepare:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_image:new t.Uniform1i(e,i.u_image),u_dimension:new t.Uniform2f(e,i.u_dimension),u_zoom:new t.Uniform1f(e,i.u_zoom),u_unpack:new t.Uniform4f(e,i.u_unpack)}},line:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_ratio:new t.Uniform1f(e,i.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,i.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,i.u_units_to_pixels)}},lineGradient:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_ratio:new t.Uniform1f(e,i.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,i.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,i.u_units_to_pixels),u_image:new t.Uniform1i(e,i.u_image),u_image_height:new t.Uniform1f(e,i.u_image_height)}},linePattern:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_texsize:new t.Uniform2f(e,i.u_texsize),u_ratio:new t.Uniform1f(e,i.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,i.u_device_pixel_ratio),u_image:new t.Uniform1i(e,i.u_image),u_units_to_pixels:new t.Uniform2f(e,i.u_units_to_pixels),u_scale:new t.Uniform3f(e,i.u_scale),u_fade:new t.Uniform1f(e,i.u_fade)}},lineSDF:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_ratio:new t.Uniform1f(e,i.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,i.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,i.u_units_to_pixels),u_patternscale_a:new t.Uniform2f(e,i.u_patternscale_a),u_patternscale_b:new t.Uniform2f(e,i.u_patternscale_b),u_sdfgamma:new t.Uniform1f(e,i.u_sdfgamma),u_image:new t.Uniform1i(e,i.u_image),u_tex_y_a:new t.Uniform1f(e,i.u_tex_y_a),u_tex_y_b:new t.Uniform1f(e,i.u_tex_y_b),u_mix:new t.Uniform1f(e,i.u_mix)}},raster:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_tl_parent:new t.Uniform2f(e,i.u_tl_parent),u_scale_parent:new t.Uniform1f(e,i.u_scale_parent),u_buffer_scale:new t.Uniform1f(e,i.u_buffer_scale),u_fade_t:new t.Uniform1f(e,i.u_fade_t),u_opacity:new t.Uniform1f(e,i.u_opacity),u_image0:new t.Uniform1i(e,i.u_image0),u_image1:new t.Uniform1i(e,i.u_image1),u_brightness_low:new t.Uniform1f(e,i.u_brightness_low),u_brightness_high:new t.Uniform1f(e,i.u_brightness_high),u_saturation_factor:new t.Uniform1f(e,i.u_saturation_factor),u_contrast_factor:new t.Uniform1f(e,i.u_contrast_factor),u_spin_weights:new t.Uniform3f(e,i.u_spin_weights)}},symbolIcon:function(e,i){return{u_is_size_zoom_constant:new t.Uniform1i(e,i.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,i.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,i.u_size_t),u_size:new t.Uniform1f(e,i.u_size),u_camera_to_center_distance:new t.Uniform1f(e,i.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,i.u_pitch),u_rotate_symbol:new t.Uniform1i(e,i.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,i.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,i.u_fade_change),u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,i.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,i.u_coord_matrix),u_is_text:new t.Uniform1i(e,i.u_is_text),u_pitch_with_map:new t.Uniform1i(e,i.u_pitch_with_map),u_texsize:new t.Uniform2f(e,i.u_texsize),u_texture:new t.Uniform1i(e,i.u_texture)}},symbolSDF:function(e,i){return{u_is_size_zoom_constant:new t.Uniform1i(e,i.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,i.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,i.u_size_t),u_size:new t.Uniform1f(e,i.u_size),u_camera_to_center_distance:new t.Uniform1f(e,i.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,i.u_pitch),u_rotate_symbol:new t.Uniform1i(e,i.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,i.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,i.u_fade_change),u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,i.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,i.u_coord_matrix),u_is_text:new t.Uniform1i(e,i.u_is_text),u_pitch_with_map:new t.Uniform1i(e,i.u_pitch_with_map),u_texsize:new t.Uniform2f(e,i.u_texsize),u_texture:new t.Uniform1i(e,i.u_texture),u_gamma_scale:new t.Uniform1f(e,i.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,i.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,i.u_is_halo)}},symbolTextAndIcon:function(e,i){return{u_is_size_zoom_constant:new t.Uniform1i(e,i.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,i.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,i.u_size_t),u_size:new t.Uniform1f(e,i.u_size),u_camera_to_center_distance:new t.Uniform1f(e,i.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,i.u_pitch),u_rotate_symbol:new t.Uniform1i(e,i.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,i.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,i.u_fade_change),u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,i.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,i.u_coord_matrix),u_is_text:new t.Uniform1i(e,i.u_is_text),u_pitch_with_map:new t.Uniform1i(e,i.u_pitch_with_map),u_texsize:new t.Uniform2f(e,i.u_texsize),u_texsize_icon:new t.Uniform2f(e,i.u_texsize_icon),u_texture:new t.Uniform1i(e,i.u_texture),u_texture_icon:new t.Uniform1i(e,i.u_texture_icon),u_gamma_scale:new t.Uniform1f(e,i.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,i.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,i.u_is_halo)}},background:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_opacity:new t.Uniform1f(e,i.u_opacity),u_color:new t.UniformColor(e,i.u_color)}},backgroundPattern:function(e,i){return{u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_opacity:new t.Uniform1f(e,i.u_opacity),u_image:new t.Uniform1i(e,i.u_image),u_pattern_tl_a:new t.Uniform2f(e,i.u_pattern_tl_a),u_pattern_br_a:new t.Uniform2f(e,i.u_pattern_br_a),u_pattern_tl_b:new t.Uniform2f(e,i.u_pattern_tl_b),u_pattern_br_b:new t.Uniform2f(e,i.u_pattern_br_b),u_texsize:new t.Uniform2f(e,i.u_texsize),u_mix:new t.Uniform1f(e,i.u_mix),u_pattern_size_a:new t.Uniform2f(e,i.u_pattern_size_a),u_pattern_size_b:new t.Uniform2f(e,i.u_pattern_size_b),u_scale_a:new t.Uniform1f(e,i.u_scale_a),u_scale_b:new t.Uniform1f(e,i.u_scale_b),u_pixel_coord_upper:new t.Uniform2f(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,i.u_pixel_coord_lower),u_tile_units_to_pixels:new t.Uniform1f(e,i.u_tile_units_to_pixels)}}};function Xi(e,i,n,r,a,o,s){for(var l=e.context,c=l.gl,u=e.useProgram("collisionBox"),h=[],p=0,d=0,f=0;f<r.length;f++){var m=r[f],g=i.getTile(m),_=g.getBucket(n);if(_){var y=m.posMatrix;0===a[0]&&0===a[1]||(y=e.translatePosMatrix(m.posMatrix,g,a,o));var v=s?_.textCollisionBox:_.iconCollisionBox,x=_.collisionCircleArray;if(x.length>0){var b=t.create(),w=y;t.mul(b,_.placementInvProjMatrix,e.transform.glCoordMatrix),t.mul(b,b,_.placementViewportMatrix),h.push({circleArray:x,circleOffset:d,transform:w,invTransform:b}),d=p+=x.length/4}v&&u.draw(l,c.LINES,Tt.disabled,Mt.disabled,e.colorModeForRenderPass(),It.disabled,ki(y,e.transform,g),n.id,v.layoutVertexBuffer,v.indexBuffer,v.segments,null,e.transform.zoom,null,null,v.collisionVertexBuffer)}}if(s&&h.length){var S=e.useProgram("collisionCircle"),E=new t.StructArrayLayout2f1f2i16;E.resize(4*p),E._trim();for(var T=0,M=0,C=h;M<C.length;M+=1)for(var I=C[M],A=0;A<I.circleArray.length/4;A++){var k=4*A,R=I.circleArray[k+0],z=I.circleArray[k+1],P=I.circleArray[k+2],D=I.circleArray[k+3];E.emplace(T++,R,z,P,D,0),E.emplace(T++,R,z,P,D,1),E.emplace(T++,R,z,P,D,2),E.emplace(T++,R,z,P,D,3)}(!ji||ji.length<2*p)&&(ji=function(e){var i=2*e,n=new t.StructArrayLayout3ui6;n.resize(i),n._trim();for(var r=0;r<i;r++){var a=6*r;n.uint16[a+0]=4*r+0,n.uint16[a+1]=4*r+1,n.uint16[a+2]=4*r+2,n.uint16[a+3]=4*r+2,n.uint16[a+4]=4*r+3,n.uint16[a+5]=4*r+0}return n}(p));for(var L=l.createIndexBuffer(ji,!0),B=l.createVertexBuffer(E,t.collisionCircleLayout.members,!0),O=0,F=h;O<F.length;O+=1){var N=F[O],U=Ri(N.transform,N.invTransform,e.transform);S.draw(l,c.TRIANGLES,Tt.disabled,Mt.disabled,e.colorModeForRenderPass(),It.disabled,U,n.id,B,L,t.SegmentVector.simpleSegment(0,2*N.circleOffset,N.circleArray.length,N.circleArray.length/2),null,e.transform.zoom,null,null,null)}B.destroy(),L.destroy()}}var Ki=t.identity(new Float32Array(16));function Ji(e,i,n,r,a,o){var s=t.getAnchorAlignment(e),l=-(s.horizontalAlign-.5)*i,c=-(s.verticalAlign-.5)*n,u=t.evaluateVariableOffset(e,r);return new t.Point((l/a+u[0])*o,(c/a+u[1])*o)}function Qi(e,i,n,r,a,o,s,l,c,u,h){var p=e.text.placedSymbolArray,d=e.text.dynamicLayoutVertexArray,f=e.icon.dynamicLayoutVertexArray,m={};d.clear();for(var g=0;g<p.length;g++){var _=p.get(g),y=_.hidden||!_.crossTileID||e.allowVerticalPlacement&&!_.placedOrientation?null:r[_.crossTileID];if(y){var v=new t.Point(_.anchorX,_.anchorY),x=Qt(v,n?l:s),b=te(o.cameraToCenterDistance,x.signedDistanceFromCamera),w=a.evaluateSizeForFeature(e.textSizeData,u,_)*b/t.ONE_EM;n&&(w*=e.tilePixelRatio/c);for(var S=Ji(y.anchor,y.width,y.height,y.textOffset,y.textBoxScale,w),E=n?Qt(v.add(S),s).point:x.point.add(i?S.rotate(-o.angle):S),T=e.allowVerticalPlacement&&_.placedOrientation===t.WritingMode.vertical?Math.PI/2:0,M=0;M<_.numGlyphs;M++)t.addDynamicAttributes(d,E,T);h&&_.associatedIconIndex>=0&&(m[_.associatedIconIndex]={shiftedAnchor:E,angle:T})}else ce(_.numGlyphs,d)}if(h){f.clear();for(var C=e.icon.placedSymbolArray,I=0;I<C.length;I++){var A=C.get(I);if(A.hidden)ce(A.numGlyphs,f);else{var k=m[I];if(k)for(var R=0;R<A.numGlyphs;R++)t.addDynamicAttributes(f,k.shiftedAnchor,k.angle);else ce(A.numGlyphs,f)}}e.icon.dynamicLayoutVertexBuffer.updateData(f)}e.text.dynamicLayoutVertexBuffer.updateData(d)}function tn(t,e,i){return i.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function en(e,i,n,r,a,o,s,l,c,u,h,p){for(var d=e.context,f=d.gl,m=e.transform,g="map"===l,_="map"===c,y=g&&"point"!==n.layout.get("symbol-placement"),v=g&&!_&&!y,x=void 0!==n.layout.get("symbol-sort-key").constantOr(1),b=!1,w=e.depthModeForSublayer(0,Tt.ReadOnly),S=n.layout.get("text-variable-anchor"),E=[],T=0,M=r;T<M.length;T+=1){var C=M[T],I=i.getTile(C),A=I.getBucket(n);if(A){var k=a?A.text:A.icon;if(k&&k.segments.get().length){var R=k.programConfigurations.get(n.id),z=a||A.sdfIcons,P=a?A.textSizeData:A.iconSizeData,D=_||0!==m.pitch,L=e.useProgram(tn(z,a,A),R),B=t.evaluateSizeForZoom(P,m.zoom),O=void 0,F=[0,0],N=void 0,U=void 0,$=null,V=void 0;if(a)N=I.glyphAtlasTexture,U=f.LINEAR,O=I.glyphAtlasTexture.size,A.iconsInText&&(F=I.imageAtlasTexture.size,$=I.imageAtlasTexture,V=D||e.options.rotating||e.options.zooming||"composite"===P.kind||"camera"===P.kind?f.LINEAR:f.NEAREST);else{var j=1!==n.layout.get("icon-size").constantOr(0)||A.iconsNeedLinear;N=I.imageAtlasTexture,U=z||e.options.rotating||e.options.zooming||j||D?f.LINEAR:f.NEAREST,O=I.imageAtlasTexture.size}var q=pe(I,1,e.transform.zoom),G=Kt(C.posMatrix,_,g,e.transform,q),H=Jt(C.posMatrix,_,g,e.transform,q),W=S&&A.hasTextData(),Z="none"!==n.layout.get("icon-text-fit")&&W&&A.hasIconData();y&&ie(A,C.posMatrix,e,a,G,H,_,u);var Y=e.translatePosMatrix(C.posMatrix,I,o,s),X=y||a&&S||Z?Ki:G,K=e.translatePosMatrix(H,I,o,s,!0),J=z&&0!==n.paint.get(a?"text-halo-width":"icon-halo-width").constantOr(1),Q={program:L,buffers:k,uniformValues:z?A.iconsInText?Hi(P.kind,B,v,_,e,Y,X,K,O,F):Gi(P.kind,B,v,_,e,Y,X,K,a,O,!0):qi(P.kind,B,v,_,e,Y,X,K,a,O),atlasTexture:N,atlasTextureIcon:$,atlasInterpolation:U,atlasInterpolationIcon:V,isSDF:z,hasHalo:J};if(x&&A.canOverlap){b=!0;for(var tt=0,et=k.segments.get();tt<et.length;tt+=1){var it=et[tt];E.push({segments:new t.SegmentVector([it]),sortKey:it.sortKey,state:Q})}}else E.push({segments:k.segments,sortKey:0,state:Q})}}}b&&E.sort((function(t,e){return t.sortKey-e.sortKey}));for(var nt=0,rt=E;nt<rt.length;nt+=1){var at=rt[nt],ot=at.state;if(d.activeTexture.set(f.TEXTURE0),ot.atlasTexture.bind(ot.atlasInterpolation,f.CLAMP_TO_EDGE),ot.atlasTextureIcon&&(d.activeTexture.set(f.TEXTURE1),ot.atlasTextureIcon&&ot.atlasTextureIcon.bind(ot.atlasInterpolationIcon,f.CLAMP_TO_EDGE)),ot.isSDF){var st=ot.uniformValues;ot.hasHalo&&(st.u_is_halo=1,nn(ot.buffers,at.segments,n,e,ot.program,w,h,p,st)),st.u_is_halo=0}nn(ot.buffers,at.segments,n,e,ot.program,w,h,p,ot.uniformValues)}}function nn(t,e,i,n,r,a,o,s,l){var c=n.context;r.draw(c,c.gl.TRIANGLES,a,o,s,It.disabled,l,i.id,t.layoutVertexBuffer,t.indexBuffer,e,i.paint,n.transform.zoom,t.programConfigurations.get(i.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}function rn(t,e,i,n,r,a,o){var s,l,c,u,h,p=t.context.gl,d=i.paint.get("fill-pattern"),f=d&&d.constantOr(1),m=i.getCrossfadeParameters();o?(l=f&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",s=p.LINES):(l=f?"fillPattern":"fill",s=p.TRIANGLES);for(var g=0,_=n;g<_.length;g+=1){var y=_[g],v=e.getTile(y);if(!f||v.patternsLoaded()){var x=v.getBucket(i);if(x){var b=x.programConfigurations.get(i.id),w=t.useProgram(l,b);f&&(t.context.activeTexture.set(p.TEXTURE0),v.imageAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),b.updatePaintBuffers(m));var S=d.constantOr(null);if(S&&v.imageAtlas){var E=v.imageAtlas,T=E.patternPositions[S.to.toString()],M=E.patternPositions[S.from.toString()];T&&M&&b.setConstantPatternPositions(T,M)}var C=t.translatePosMatrix(y.posMatrix,v,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor"));if(o){u=x.indexBuffer2,h=x.segments2;var I=[p.drawingBufferWidth,p.drawingBufferHeight];c="fillOutlinePattern"===l&&f?Ii(C,t,m,v,I):Ci(C,I)}else u=x.indexBuffer,h=x.segments,c=f?Mi(C,t,m,v):Ti(C);w.draw(t.context,s,r,t.stencilModeForClipping(y),a,It.disabled,c,i.id,x.layoutVertexBuffer,u,h,i.paint,t.transform.zoom,b)}}}}function an(t,e,i,n,r,a,o){for(var s=t.context,l=s.gl,c=i.paint.get("fill-extrusion-pattern"),u=c.constantOr(1),h=i.getCrossfadeParameters(),p=i.paint.get("fill-extrusion-opacity"),d=0,f=n;d<f.length;d+=1){var m=f[d],g=e.getTile(m),_=g.getBucket(i);if(_){var y=_.programConfigurations.get(i.id),v=t.useProgram(u?"fillExtrusionPattern":"fillExtrusion",y);u&&(t.context.activeTexture.set(l.TEXTURE0),g.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),y.updatePaintBuffers(h));var x=c.constantOr(null);if(x&&g.imageAtlas){var b=g.imageAtlas,w=b.patternPositions[x.to.toString()],S=b.patternPositions[x.from.toString()];w&&S&&y.setConstantPatternPositions(w,S)}var E=t.translatePosMatrix(m.posMatrix,g,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),T=i.paint.get("fill-extrusion-vertical-gradient"),M=u?Ei(E,t,T,p,m,h,g):Si(E,t,T,p);v.draw(s,s.gl.TRIANGLES,r,a,o,It.backCCW,M,i.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,i.paint,t.transform.zoom,y)}}}function on(e,i,n,r,a,o){var s=e.context,l=s.gl,c=i.fbo;if(c){var u=e.useProgram("hillshade");s.activeTexture.set(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,c.colorAttachment.get());var h=function(e,i,n){var r=n.paint.get("hillshade-shadow-color"),a=n.paint.get("hillshade-highlight-color"),o=n.paint.get("hillshade-accent-color"),s=n.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===n.paint.get("hillshade-illumination-anchor")&&(s-=e.transform.angle);var l,c,u,h=!e.options.moving;return{u_matrix:e.transform.calculatePosMatrix(i.tileID.toUnwrapped(),h),u_image:0,u_latrange:(l=i.tileID,c=Math.pow(2,l.canonical.z),u=l.canonical.y,[new t.MercatorCoordinate(0,u/c).toLngLat().lat,new t.MercatorCoordinate(0,(u+1)/c).toLngLat().lat]),u_light:[n.paint.get("hillshade-exaggeration"),s],u_shadow:r,u_highlight:a,u_accent:o}}(e,i,n);u.draw(s,l.TRIANGLES,r,a,o,It.disabled,h,n.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments)}}function sn(e,i,n,r,a,o){var s=e.context,l=s.gl,c=i.dem;if(c&&c.data){var u=c.dim,h=c.stride,p=c.getPixels();if(s.activeTexture.set(l.TEXTURE1),s.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||e.getTileTexture(h),i.demTexture){var d=i.demTexture;d.update(p,{premultiply:!1}),d.bind(l.NEAREST,l.CLAMP_TO_EDGE)}else i.demTexture=new t.Texture(s,p,l.RGBA,{premultiply:!1}),i.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);s.activeTexture.set(l.TEXTURE0);var f=i.fbo;if(!f){var m=new t.Texture(s,{width:u,height:u,data:null},l.RGBA);m.bind(l.LINEAR,l.CLAMP_TO_EDGE),(f=i.fbo=s.createFramebuffer(u,u,!0)).colorAttachment.set(m.texture)}s.bindFramebuffer.set(f.framebuffer),s.viewport.set([0,0,u,u]),e.useProgram("hillshadePrepare").draw(s,l.TRIANGLES,r,a,o,It.disabled,function(e,i){var n=i.stride,r=t.create();return t.ortho(r,0,t.EXTENT,-t.EXTENT,0,0,1),t.translate(r,r,[0,-t.EXTENT,0]),{u_matrix:r,u_image:1,u_dimension:[n,n],u_zoom:e.overscaledZ,u_unpack:i.getUnpackVector()}}(i.tileID,c),n.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments),i.needsHillshadePrepare=!1}}function ln(e,i,n,r,a){var o=r.paint.get("raster-fade-duration");if(o>0){var s=t.browser.now(),l=(s-e.timeAdded)/o,c=i?(s-i.timeAdded)/o:-1,u=n.getSource(),h=a.coveringZoomLevel({tileSize:u.tileSize,roundZoom:u.roundZoom}),p=!i||Math.abs(i.tileID.overscaledZ-h)>Math.abs(e.tileID.overscaledZ-h),d=p&&e.refreshedUponExpiration?1:t.clamp(p?l:1-c,0,1);return e.refreshedUponExpiration&&l>=1&&(e.refreshedUponExpiration=!1),i?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}var cn=new t.Color(1,0,0,1),un=new t.Color(0,1,0,1),hn=new t.Color(0,0,1,1),pn=new t.Color(1,0,1,1),dn=new t.Color(0,1,1,1);function fn(t,e,i,n){gn(t,0,e+i/2,t.transform.width,i,n)}function mn(t,e,i,n){gn(t,e-i/2,0,i,t.transform.height,n)}function gn(e,i,n,r,a,o){var s=e.context,l=s.gl;l.enable(l.SCISSOR_TEST),l.scissor(i*t.browser.devicePixelRatio,n*t.browser.devicePixelRatio,r*t.browser.devicePixelRatio,a*t.browser.devicePixelRatio),s.clear({color:o}),l.disable(l.SCISSOR_TEST)}function _n(e,i,n){var r=e.context,a=r.gl,o=n.posMatrix,s=e.useProgram("debug"),l=Tt.disabled,c=Mt.disabled,u=e.colorModeForRenderPass();r.activeTexture.set(a.TEXTURE0),e.emptyTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),s.draw(r,a.LINE_STRIP,l,c,u,It.disabled,zi(o,t.Color.red),"$debug",e.debugBuffer,e.tileBorderIndexBuffer,e.debugSegments);var h=i.getTileByID(n.key).latestRawTileData,p=Math.floor((h&&h.byteLength||0)/1024),d=i.getTile(n).tileSize,f=512/Math.min(d,512)*(n.overscaledZ/e.transform.zoom)*.5,m=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(m+=" => "+n.overscaledZ),function(t,e){t.initDebugOverlayCanvas();var i=t.debugOverlayCanvas,n=t.context.gl,r=t.debugOverlayCanvas.getContext("2d");r.clearRect(0,0,i.width,i.height),r.shadowColor="white",r.shadowBlur=2,r.lineWidth=1.5,r.strokeStyle="white",r.textBaseline="top",r.font="bold 36px Open Sans, sans-serif",r.fillText(e,5,5),r.strokeText(e,5,5),t.debugOverlayTexture.update(i),t.debugOverlayTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}(e,m+" "+p+"kb"),s.draw(r,a.TRIANGLES,l,c,Ct.alphaBlended,It.disabled,zi(o,t.Color.transparent,f),"$debug",e.debugBuffer,e.quadTriangleIndexBuffer,e.debugSegments)}var yn={symbol:function(e,i,n,r,a){if("translucent"===e.renderPass){var o=Mt.disabled,s=e.colorModeForRenderPass();n.layout.get("text-variable-anchor")&&function(e,i,n,r,a,o,s){for(var l=i.transform,c="map"===a,u="map"===o,h=0,p=e;h<p.length;h+=1){var d=p[h],f=r.getTile(d),m=f.getBucket(n);if(m&&m.text&&m.text.segments.get().length){var g=t.evaluateSizeForZoom(m.textSizeData,l.zoom),_=pe(f,1,i.transform.zoom),y=Kt(d.posMatrix,u,c,i.transform,_),v="none"!==n.layout.get("icon-text-fit")&&m.hasIconData();if(g){var x=Math.pow(2,l.zoom-f.tileID.overscaledZ);Qi(m,c,u,s,t.symbolSize,l,y,d.posMatrix,x,g,v)}}}}(r,e,n,i,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),a),0!==n.paint.get("icon-opacity").constantOr(1)&&en(e,i,n,r,!1,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),n.layout.get("icon-rotation-alignment"),n.layout.get("icon-pitch-alignment"),n.layout.get("icon-keep-upright"),o,s),0!==n.paint.get("text-opacity").constantOr(1)&&en(e,i,n,r,!0,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),n.layout.get("text-keep-upright"),o,s),i.map.showCollisionBoxes&&(Xi(e,i,n,r,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),Xi(e,i,n,r,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))}},circle:function(e,i,n,r){if("translucent"===e.renderPass){var a=n.paint.get("circle-opacity"),o=n.paint.get("circle-stroke-width"),s=n.paint.get("circle-stroke-opacity"),l=void 0!==n.layout.get("circle-sort-key").constantOr(1);if(0!==a.constantOr(1)||0!==o.constantOr(1)&&0!==s.constantOr(1)){for(var c=e.context,u=c.gl,h=e.depthModeForSublayer(0,Tt.ReadOnly),p=Mt.disabled,d=e.colorModeForRenderPass(),f=[],m=0;m<r.length;m++){var g=r[m],_=i.getTile(g),y=_.getBucket(n);if(y){var v=y.programConfigurations.get(n.id),x={programConfiguration:v,program:e.useProgram("circle",v),layoutVertexBuffer:y.layoutVertexBuffer,indexBuffer:y.indexBuffer,uniformValues:Ai(e,g,_,n)};if(l)for(var b=0,w=y.segments.get();b<w.length;b+=1){var S=w[b];f.push({segments:new t.SegmentVector([S]),sortKey:S.sortKey,state:x})}else f.push({segments:y.segments,sortKey:0,state:x})}}l&&f.sort((function(t,e){return t.sortKey-e.sortKey}));for(var E=0,T=f;E<T.length;E+=1){var M=T[E],C=M.state;C.program.draw(c,u.TRIANGLES,h,p,d,It.disabled,C.uniformValues,n.id,C.layoutVertexBuffer,C.indexBuffer,M.segments,n.paint,e.transform.zoom,C.programConfiguration)}}}},heatmap:function(e,i,n,r){if(0!==n.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){var a=e.context,o=a.gl,s=Mt.disabled,l=new Ct([o.ONE,o.ONE],t.Color.transparent,[!0,!0,!0,!0]);!function(t,e,i){var n=t.gl;t.activeTexture.set(n.TEXTURE1),t.viewport.set([0,0,e.width/4,e.height/4]);var r=i.heatmapFbo;if(r)n.bindTexture(n.TEXTURE_2D,r.colorAttachment.get()),t.bindFramebuffer.set(r.framebuffer);else{var a=n.createTexture();n.bindTexture(n.TEXTURE_2D,a),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),r=i.heatmapFbo=t.createFramebuffer(e.width/4,e.height/4,!1),function(t,e,i,n){var r=t.gl;r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e.width/4,e.height/4,0,r.RGBA,t.extRenderToTextureHalfFloat?t.extTextureHalfFloat.HALF_FLOAT_OES:r.UNSIGNED_BYTE,null),n.colorAttachment.set(i)}(t,e,a,r)}}(a,e,n),a.clear({color:t.Color.transparent});for(var c=0;c<r.length;c++){var u=r[c];if(!i.hasRenderableParent(u)){var h=i.getTile(u),p=h.getBucket(n);if(p){var d=p.programConfigurations.get(n.id);e.useProgram("heatmap",d).draw(a,o.TRIANGLES,Tt.disabled,s,l,It.disabled,Di(u.posMatrix,h,e.transform.zoom,n.paint.get("heatmap-intensity")),n.id,p.layoutVertexBuffer,p.indexBuffer,p.segments,n.paint,e.transform.zoom,d)}}}a.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,i){var n=e.context,r=n.gl,a=i.heatmapFbo;if(a){n.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,a.colorAttachment.get()),n.activeTexture.set(r.TEXTURE1);var o=i.colorRampTexture;o||(o=i.colorRampTexture=new t.Texture(n,i.colorRamp,r.RGBA)),o.bind(r.LINEAR,r.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(n,r.TRIANGLES,Tt.disabled,Mt.disabled,e.colorModeForRenderPass(),It.disabled,function(e,i,n,r){var a=t.create();t.ortho(a,0,e.width,e.height,0,0,1);var o=e.context.gl;return{u_matrix:a,u_world:[o.drawingBufferWidth,o.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:i.paint.get("heatmap-opacity")}}(e,i),i.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,i.paint,e.transform.zoom)}}(e,n))},line:function(e,i,n,r){if("translucent"===e.renderPass){var a=n.paint.get("line-opacity"),o=n.paint.get("line-width");if(0!==a.constantOr(1)&&0!==o.constantOr(1))for(var s=e.depthModeForSublayer(0,Tt.ReadOnly),l=e.colorModeForRenderPass(),c=n.paint.get("line-dasharray"),u=n.paint.get("line-pattern"),h=u.constantOr(1),p=n.paint.get("line-gradient"),d=n.getCrossfadeParameters(),f=h?"linePattern":c?"lineSDF":p?"lineGradient":"line",m=e.context,g=m.gl,_=!0,y=0,v=r;y<v.length;y+=1){var x=v[y],b=i.getTile(x);if(!h||b.patternsLoaded()){var w=b.getBucket(n);if(w){var S=w.programConfigurations.get(n.id),E=e.context.program.get(),T=e.useProgram(f,S),M=_||T.program!==E,C=u.constantOr(null);if(C&&b.imageAtlas){var I=b.imageAtlas,A=I.patternPositions[C.to.toString()],k=I.patternPositions[C.from.toString()];A&&k&&S.setConstantPatternPositions(A,k)}var R=h?Oi(e,b,n,d):c?Fi(e,b,n,c,d):p?Bi(e,b,n,w.lineClipsArray.length):Li(e,b,n);if(h)m.activeTexture.set(g.TEXTURE0),b.imageAtlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),S.updatePaintBuffers(d);else if(c&&(M||e.lineAtlas.dirty))m.activeTexture.set(g.TEXTURE0),e.lineAtlas.bind(m);else if(p){var z=w.gradients[n.id],P=z.texture;if(n.gradientVersion!==z.version){var D=256;if(n.stepInterpolant){var L=i.getSource().maxzoom,B=x.canonical.z===L?Math.ceil(1<<e.transform.maxZoom-x.canonical.z):1;D=t.clamp(t.nextPowerOfTwo(w.maxLineLength/t.EXTENT*1024*B),256,m.maxTextureSize)}z.gradient=t.renderColorRamp({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:D,image:z.gradient||void 0,clips:w.lineClipsArray}),z.texture?z.texture.update(z.gradient):z.texture=new t.Texture(m,z.gradient,g.RGBA),z.version=n.gradientVersion,P=z.texture}m.activeTexture.set(g.TEXTURE0),P.bind(n.stepInterpolant?g.NEAREST:g.LINEAR,g.CLAMP_TO_EDGE)}T.draw(m,g.TRIANGLES,s,e.stencilModeForClipping(x),l,It.disabled,R,n.id,w.layoutVertexBuffer,w.indexBuffer,w.segments,n.paint,e.transform.zoom,S,w.layoutVertexBuffer2),_=!1}}}}},fill:function(e,i,n,r){var a=n.paint.get("fill-color"),o=n.paint.get("fill-opacity");if(0!==o.constantOr(1)){var s=e.colorModeForRenderPass(),l=n.paint.get("fill-pattern"),c=e.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===a.constantOr(t.Color.transparent).a&&1===o.constantOr(0)?"opaque":"translucent";if(e.renderPass===c){var u=e.depthModeForSublayer(1,"opaque"===e.renderPass?Tt.ReadWrite:Tt.ReadOnly);rn(e,i,n,r,u,s,!1)}if("translucent"===e.renderPass&&n.paint.get("fill-antialias")){var h=e.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,Tt.ReadOnly);rn(e,i,n,r,h,s,!0)}}},"fill-extrusion":function(t,e,i,n){var r=i.paint.get("fill-extrusion-opacity");if(0!==r&&"translucent"===t.renderPass){var a=new Tt(t.context.gl.LEQUAL,Tt.ReadWrite,t.depthRangeFor3D);if(1!==r||i.paint.get("fill-extrusion-pattern").constantOr(1))an(t,e,i,n,a,Mt.disabled,Ct.disabled),an(t,e,i,n,a,t.stencilModeFor3D(),t.colorModeForRenderPass());else{var o=t.colorModeForRenderPass();an(t,e,i,n,a,Mt.disabled,o)}}},hillshade:function(t,e,i,n){if("offscreen"===t.renderPass||"translucent"===t.renderPass){for(var r=t.context,a=t.depthModeForSublayer(0,Tt.ReadOnly),o=t.colorModeForRenderPass(),s="translucent"===t.renderPass?t.stencilConfigForOverlap(n):[{},n],l=s[0],c=0,u=s[1];c<u.length;c+=1){var h=u[c],p=e.getTile(h);p.needsHillshadePrepare&&"offscreen"===t.renderPass?sn(t,p,i,a,Mt.disabled,o):"translucent"===t.renderPass&&on(t,p,i,a,l[h.overscaledZ],o)}r.viewport.set([0,0,t.width,t.height])}},raster:function(t,e,i,n){if("translucent"===t.renderPass&&0!==i.paint.get("raster-opacity")&&n.length)for(var r=t.context,a=r.gl,o=e.getSource(),s=t.useProgram("raster"),l=t.colorModeForRenderPass(),c=o instanceof z?[{},n]:t.stencilConfigForOverlap(n),u=c[0],h=c[1],p=h[h.length-1].overscaledZ,d=!t.options.moving,f=0,m=h;f<m.length;f+=1){var g=m[f],_=t.depthModeForSublayer(g.overscaledZ-p,1===i.paint.get("raster-opacity")?Tt.ReadWrite:Tt.ReadOnly,a.LESS),y=e.getTile(g),v=t.transform.calculatePosMatrix(g.toUnwrapped(),d);y.registerFadeDuration(i.paint.get("raster-fade-duration"));var x=e.findLoadedParent(g,0),b=ln(y,x,e,i,t.transform),w=void 0,S=void 0,E="nearest"===i.paint.get("raster-resampling")?a.NEAREST:a.LINEAR;r.activeTexture.set(a.TEXTURE0),y.texture.bind(E,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST),r.activeTexture.set(a.TEXTURE1),x?(x.texture.bind(E,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST),w=Math.pow(2,x.tileID.overscaledZ-y.tileID.overscaledZ),S=[y.tileID.canonical.x*w%1,y.tileID.canonical.y*w%1]):y.texture.bind(E,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST);var T=$i(v,S||[0,0],w||1,b,i);o instanceof z?s.draw(r,a.TRIANGLES,_,Mt.disabled,l,It.disabled,T,i.id,o.boundsBuffer,t.quadTriangleIndexBuffer,o.boundsSegments):s.draw(r,a.TRIANGLES,_,u[g.overscaledZ],l,It.disabled,T,i.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}},background:function(t,e,i){var n=i.paint.get("background-color"),r=i.paint.get("background-opacity");if(0!==r){var a=t.context,o=a.gl,s=t.transform,l=s.tileSize,c=i.paint.get("background-pattern");if(!t.isPatternMissing(c)){var u=!c&&1===n.a&&1===r&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass===u){var h=Mt.disabled,p=t.depthModeForSublayer(0,"opaque"===u?Tt.ReadWrite:Tt.ReadOnly),d=t.colorModeForRenderPass(),f=t.useProgram(c?"backgroundPattern":"background"),m=s.coveringTiles({tileSize:l});c&&(a.activeTexture.set(o.TEXTURE0),t.imageManager.bind(t.context));for(var g=i.getCrossfadeParameters(),_=0,y=m;_<y.length;_+=1){var v=y[_],x=t.transform.calculatePosMatrix(v.toUnwrapped()),b=c?Zi(x,r,t,c,{tileID:v,tileSize:l},g):Wi(x,r,n);f.draw(a,o.TRIANGLES,p,h,d,It.disabled,b,i.id,t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments)}}}}},debug:function(t,e,i){for(var n=0;n<i.length;n++)_n(t,e,i[n])},custom:function(t,e,i){var n=t.context,r=i.implementation;if("offscreen"===t.renderPass){var a=r.prerender;a&&(t.setCustomLayerDefaults(),n.setColorMode(t.colorModeForRenderPass()),a.call(r,n.gl,t.transform.customLayerMatrix()),n.setDirty(),t.setBaseState())}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),n.setColorMode(t.colorModeForRenderPass()),n.setStencilMode(Mt.disabled);var o="3d"===r.renderingMode?new Tt(t.context.gl.LEQUAL,Tt.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,Tt.ReadOnly);n.setDepthMode(o),r.render(n.gl,t.transform.customLayerMatrix()),n.setDirty(),t.setBaseState(),n.bindFramebuffer.set(null)}}},vn=function(t,e){this.context=new At(t),this.transform=e,this._tileTextures={},this.setup(),this.numSublayers=kt.maxUnderzooming+kt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Fe,this.gpuTimers={}};vn.prototype.resize=function(e,i){if(this.width=e*t.browser.devicePixelRatio,this.height=i*t.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var n=0,r=this.style._order;n<r.length;n+=1)this.style._layers[r[n]].resize()},vn.prototype.setup=function(){var e=this.context,i=new t.StructArrayLayout2i4;i.emplaceBack(0,0),i.emplaceBack(t.EXTENT,0),i.emplaceBack(0,t.EXTENT),i.emplaceBack(t.EXTENT,t.EXTENT),this.tileExtentBuffer=e.createVertexBuffer(i,qe.members),this.tileExtentSegments=t.SegmentVector.simpleSegment(0,0,4,2);var n=new t.StructArrayLayout2i4;n.emplaceBack(0,0),n.emplaceBack(t.EXTENT,0),n.emplaceBack(0,t.EXTENT),n.emplaceBack(t.EXTENT,t.EXTENT),this.debugBuffer=e.createVertexBuffer(n,qe.members),this.debugSegments=t.SegmentVector.simpleSegment(0,0,4,5);var r=new t.StructArrayLayout4i8;r.emplaceBack(0,0,0,0),r.emplaceBack(t.EXTENT,0,t.EXTENT,0),r.emplaceBack(0,t.EXTENT,0,t.EXTENT),r.emplaceBack(t.EXTENT,t.EXTENT,t.EXTENT,t.EXTENT),this.rasterBoundsBuffer=e.createVertexBuffer(r,R.members),this.rasterBoundsSegments=t.SegmentVector.simpleSegment(0,0,4,2);var a=new t.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(1,0),a.emplaceBack(0,1),a.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(a,qe.members),this.viewportSegments=t.SegmentVector.simpleSegment(0,0,4,2);var o=new t.StructArrayLayout1ui2;o.emplaceBack(0),o.emplaceBack(1),o.emplaceBack(3),o.emplaceBack(2),o.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(o);var s=new t.StructArrayLayout3ui6;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(s),this.emptyTexture=new t.Texture(e,{width:1,height:1,data:new Uint8Array([0,0,0,0])},e.gl.RGBA);var l=this.context.gl;this.stencilClearMode=new Mt({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO)},vn.prototype.clearStencil=function(){var e=this.context,i=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var n=t.create();t.ortho(n,0,this.width,this.height,0,0,1),t.scale(n,n,[i.drawingBufferWidth,i.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,i.TRIANGLES,Tt.disabled,this.stencilClearMode,Ct.disabled,It.disabled,Pi(n),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},vn.prototype._renderTileClippingMasks=function(t,e){if(this.currentStencilSource!==t.source&&t.isTileClipped()&&e&&e.length){this.currentStencilSource=t.source;var i=this.context,n=i.gl;this.nextStencilID+e.length>256&&this.clearStencil(),i.setColorMode(Ct.disabled),i.setDepthMode(Tt.disabled);var r=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var a=0,o=e;a<o.length;a+=1){var s=o[a],l=this._tileClippingMaskIDs[s.key]=this.nextStencilID++;r.draw(i,n.TRIANGLES,Tt.disabled,new Mt({func:n.ALWAYS,mask:0},l,255,n.KEEP,n.KEEP,n.REPLACE),Ct.disabled,It.disabled,Pi(s.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},vn.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var t=this.nextStencilID++,e=this.context.gl;return new Mt({func:e.NOTEQUAL,mask:255},t,255,e.KEEP,e.KEEP,e.REPLACE)},vn.prototype.stencilModeForClipping=function(t){var e=this.context.gl;return new Mt({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)},vn.prototype.stencilConfigForOverlap=function(t){var e,i=this.context.gl,n=t.sort((function(t,e){return e.overscaledZ-t.overscaledZ})),r=n[n.length-1].overscaledZ,a=n[0].overscaledZ-r+1;if(a>1){this.currentStencilSource=void 0,this.nextStencilID+a>256&&this.clearStencil();for(var o={},s=0;s<a;s++)o[s+r]=new Mt({func:i.GEQUAL,mask:255},s+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=a,[o,n]}return[(e={},e[r]=Mt.disabled,e),n]},vn.prototype.colorModeForRenderPass=function(){var e=this.context.gl;return this._showOverdrawInspector?new Ct([e.CONSTANT_COLOR,e.ONE],new t.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?Ct.unblended:Ct.alphaBlended},vn.prototype.depthModeForSublayer=function(t,e,i){if(!this.opaquePassEnabledForLayer())return Tt.disabled;var n=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Tt(i||this.context.gl.LEQUAL,e,[n,n])},vn.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},vn.prototype.render=function(e,i){var n=this;this.style=e,this.options=i,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(t.browser.now()),this.imageManager.beginFrame();var r=this.style._order,a=this.style.sourceCaches;for(var o in a){var s=a[o];s.used&&s.prepare(this.context)}var l,c,u={},h={},p={};for(var d in a){var f=a[d];u[d]=f.getVisibleCoordinates(),h[d]=u[d].slice().reverse(),p[d]=f.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var m=0;m<r.length;m++)if(this.style._layers[r[m]].is3D()){this.opaquePassCutoff=m;break}this.renderPass="offscreen";for(var g=0,_=r;g<_.length;g+=1){var y=this.style._layers[_[g]];if(y.hasOffscreenPass()&&!y.isHidden(this.transform.zoom)){var v=h[y.source];("custom"===y.type||v.length)&&this.renderLayer(this,a[y.source],y,v)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:i.showOverdrawInspector?t.Color.black:t.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=i.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=r.length-1;this.currentLayer>=0;this.currentLayer--){var x=this.style._layers[r[this.currentLayer]],b=a[x.source],w=u[x.source];this._renderTileClippingMasks(x,w),this.renderLayer(this,b,x,w)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<r.length;this.currentLayer++){var S=this.style._layers[r[this.currentLayer]],E=a[S.source],T=("symbol"===S.type?p:h)[S.source];this._renderTileClippingMasks(S,u[S.source]),this.renderLayer(this,E,S,T)}this.options.showTileBoundaries&&(t.values(this.style._layers).forEach((function(t){t.source&&!t.isHidden(n.transform.zoom)&&(t.source!==(c&&c.id)&&(c=n.style.sourceCaches[t.source]),(!l||l.getSource().maxzoom<c.getSource().maxzoom)&&(l=c))})),l&&yn.debug(this,l,l.getVisibleCoordinates())),this.options.showPadding&&function(t){var e=t.transform.padding;fn(t,t.transform.height-(e.top||0),3,cn),fn(t,e.bottom||0,3,un),mn(t,e.left||0,3,hn),mn(t,t.transform.width-(e.right||0),3,pn);var i=t.transform.centerPoint;!function(t,e,i,n){gn(t,e-1,i-10,2,20,n),gn(t,e-10,i-1,20,2,n)}(t,i.x,t.transform.height-i.y,dn)}(this),this.context.setDefault()},vn.prototype.renderLayer=function(t,e,i,n){i.isHidden(this.transform.zoom)||("background"===i.type||"custom"===i.type||n.length)&&(this.id=i.id,this.gpuTimingStart(i),yn[i.type](t,e,i,n,this.style.placement.variableOffsets),this.gpuTimingEnd())},vn.prototype.gpuTimingStart=function(t){if(this.options.gpuTiming){var e=this.context.extTimerQuery,i=this.gpuTimers[t.id];i||(i=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:e.createQueryEXT()}),i.calls++,e.beginQueryEXT(e.TIME_ELAPSED_EXT,i.query)}},vn.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}},vn.prototype.collectGpuTimers=function(){var t=this.gpuTimers;return this.gpuTimers={},t},vn.prototype.queryGpuTimers=function(t){var e={};for(var i in t){var n=t[i],r=this.context.extTimerQuery,a=r.getQueryObjectEXT(n.query,r.QUERY_RESULT_EXT)/1e6;r.deleteQueryEXT(n.query),e[i]=a}return e},vn.prototype.translatePosMatrix=function(e,i,n,r,a){if(!n[0]&&!n[1])return e;var o=a?"map"===r?this.transform.angle:0:"viewport"===r?-this.transform.angle:0;if(o){var s=Math.sin(o),l=Math.cos(o);n=[n[0]*l-n[1]*s,n[0]*s+n[1]*l]}var c=[a?n[0]:pe(i,n[0],this.transform.zoom),a?n[1]:pe(i,n[1],this.transform.zoom),0],u=new Float32Array(16);return t.translate(u,e,c),u},vn.prototype.saveTileTexture=function(t){var e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]},vn.prototype.getTileTexture=function(t){var e=this._tileTextures[t];return e&&e.length>0?e.pop():null},vn.prototype.isPatternMissing=function(t){if(!t)return!1;if(!t.from||!t.to)return!0;var e=this.imageManager.getPattern(t.from.toString()),i=this.imageManager.getPattern(t.to.toString());return!e||!i},vn.prototype.useProgram=function(t,e){this.cache=this.cache||{};var i=""+t+(e?e.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[i]||(this.cache[i]=new bi(this.context,t,yi[t],e,Yi[t],this._showOverdrawInspector)),this.cache[i]},vn.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},vn.prototype.setBaseState=function(){var t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)},vn.prototype.initDebugOverlayCanvas=function(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=t.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},vn.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var xn=function(t,e){this.points=t,this.planes=e};xn.fromInvProjectionMatrix=function(e,i,n){var r=Math.pow(2,n),a=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((function(i){return t.transformMat4([],i,e)})).map((function(e){return t.scale$1([],e,1/e[3]/i*r)})),o=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((function(e){var i=t.sub([],a[e[0]],a[e[1]]),n=t.sub([],a[e[2]],a[e[1]]),r=t.normalize([],t.cross([],i,n)),o=-t.dot(r,a[e[1]]);return r.concat(o)}));return new xn(a,o)};var bn=function(e,i){this.min=e,this.max=i,this.center=t.scale$2([],t.add([],this.min,this.max),.5)};bn.prototype.quadrant=function(e){for(var i=[e%2==0,e<2],n=t.clone$2(this.min),r=t.clone$2(this.max),a=0;a<i.length;a++)n[a]=i[a]?this.min[a]:this.center[a],r[a]=i[a]?this.center[a]:this.max[a];return r[2]=this.max[2],new bn(n,r)},bn.prototype.distanceX=function(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]},bn.prototype.distanceY=function(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]},bn.prototype.intersects=function(e){for(var i=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],n=!0,r=0;r<e.planes.length;r++){for(var a=e.planes[r],o=0,s=0;s<i.length;s++)o+=t.dot$1(a,i[s])>=0;if(0===o)return 0;o!==i.length&&(n=!1)}if(n)return 2;for(var l=0;l<3;l++){for(var c=Number.MAX_VALUE,u=-Number.MAX_VALUE,h=0;h<e.points.length;h++){var p=e.points[h][l]-this.min[l];c=Math.min(c,p),u=Math.max(u,p)}if(u<0||c>this.max[l]-this.min[l])return 0}return 1};var wn=function(t,e,i,n){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),isNaN(t)||t<0||isNaN(e)||e<0||isNaN(i)||i<0||isNaN(n)||n<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=i,this.right=n};wn.prototype.interpolate=function(e,i,n){return null!=i.top&&null!=e.top&&(this.top=t.number(e.top,i.top,n)),null!=i.bottom&&null!=e.bottom&&(this.bottom=t.number(e.bottom,i.bottom,n)),null!=i.left&&null!=e.left&&(this.left=t.number(e.left,i.left,n)),null!=i.right&&null!=e.right&&(this.right=t.number(e.right,i.right,n)),this},wn.prototype.getCenter=function(e,i){var n=t.clamp((this.left+e-this.right)/2,0,e),r=t.clamp((this.top+i-this.bottom)/2,0,i);return new t.Point(n,r)},wn.prototype.equals=function(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right},wn.prototype.clone=function(){return new wn(this.top,this.bottom,this.left,this.right)},wn.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Sn=function(e,i,n,r,a){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===a||a,this._minZoom=e||0,this._maxZoom=i||22,this._minPitch=null==n?0:n,this._maxPitch=null==r?60:r,this.setMaxBounds(),this.width=0,this.height=0,this._center=new t.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new wn,this._posMatrixCache={},this._alignedPosMatrixCache={}},En={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Sn.prototype.clone=function(){var t=new Sn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._calcMatrices(),t},En.minZoom.get=function(){return this._minZoom},En.minZoom.set=function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))},En.maxZoom.get=function(){return this._maxZoom},En.maxZoom.set=function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))},En.minPitch.get=function(){return this._minPitch},En.minPitch.set=function(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))},En.maxPitch.get=function(){return this._maxPitch},En.maxPitch.set=function(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))},En.renderWorldCopies.get=function(){return this._renderWorldCopies},En.renderWorldCopies.set=function(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t},En.worldSize.get=function(){return this.tileSize*this.scale},En.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},En.size.get=function(){return new t.Point(this.width,this.height)},En.bearing.get=function(){return-this.angle/Math.PI*180},En.bearing.set=function(e){var i=-t.wrap(e,-180,180)*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=t.create$2(),t.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},En.pitch.get=function(){return this._pitch/Math.PI*180},En.pitch.set=function(e){var i=t.clamp(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())},En.fov.get=function(){return this._fov/Math.PI*180},En.fov.set=function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())},En.zoom.get=function(){return this._zoom},En.zoom.set=function(t){var e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this._constrain(),this._calcMatrices())},En.center.get=function(){return this._center},En.center.set=function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())},En.padding.get=function(){return this._edgeInsets.toJSON()},En.padding.set=function(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())},En.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Sn.prototype.isPaddingEqual=function(t){return this._edgeInsets.equals(t)},Sn.prototype.interpolatePadding=function(t,e,i){this._unmodified=!1,this._edgeInsets.interpolate(t,e,i),this._constrain(),this._calcMatrices()},Sn.prototype.coveringZoomLevel=function(t){var e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)},Sn.prototype.getVisibleUnwrappedCoordinates=function(e){var i=[new t.UnwrappedTileID(0,e)];if(this._renderWorldCopies)for(var n=this.pointCoordinate(new t.Point(0,0)),r=this.pointCoordinate(new t.Point(this.width,0)),a=this.pointCoordinate(new t.Point(this.width,this.height)),o=this.pointCoordinate(new t.Point(0,this.height)),s=Math.floor(Math.min(n.x,r.x,a.x,o.x)),l=Math.floor(Math.max(n.x,r.x,a.x,o.x)),c=s-1;c<=l+1;c++)0!==c&&i.push(new t.UnwrappedTileID(c,e));return i},Sn.prototype.coveringTiles=function(e){var i=this.coveringZoomLevel(e),n=i;if(void 0!==e.minzoom&&i<e.minzoom)return[];void 0!==e.maxzoom&&i>e.maxzoom&&(i=e.maxzoom);var r=t.MercatorCoordinate.fromLngLat(this.center),a=Math.pow(2,i),o=[a*r.x,a*r.y,0],s=xn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i),l=e.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(l=i);var c=function(t){return{aabb:new bn([t*a,0,0],[(t+1)*a,a,0]),zoom:0,x:0,y:0,wrap:t,fullyVisible:!1}},u=[],h=[],p=i,d=e.reparseOverscaled?n:i;if(this._renderWorldCopies)for(var f=1;f<=3;f++)u.push(c(-f)),u.push(c(f));for(u.push(c(0));u.length>0;){var m=u.pop(),g=m.x,_=m.y,y=m.fullyVisible;if(!y){var v=m.aabb.intersects(s);if(0===v)continue;y=2===v}var x=m.aabb.distanceX(o),b=m.aabb.distanceY(o),w=Math.max(Math.abs(x),Math.abs(b));if(m.zoom===p||w>3+(1<<p-m.zoom)-2&&m.zoom>=l)h.push({tileID:new t.OverscaledTileID(m.zoom===p?d:m.zoom,m.wrap,m.zoom,g,_),distanceSq:t.sqrLen([o[0]-.5-g,o[1]-.5-_])});else for(var S=0;S<4;S++){var E=(g<<1)+S%2,T=(_<<1)+(S>>1);u.push({aabb:m.aabb.quadrant(S),zoom:m.zoom+1,x:E,y:T,wrap:m.wrap,fullyVisible:y})}}return h.sort((function(t,e){return t.distanceSq-e.distanceSq})).map((function(t){return t.tileID}))},Sn.prototype.resize=function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()},En.unmodified.get=function(){return this._unmodified},Sn.prototype.zoomScale=function(t){return Math.pow(2,t)},Sn.prototype.scaleZoom=function(t){return Math.log(t)/Math.LN2},Sn.prototype.project=function(e){var i=t.clamp(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new t.Point(t.mercatorXfromLng(e.lng)*this.worldSize,t.mercatorYfromLat(i)*this.worldSize)},Sn.prototype.unproject=function(e){return new t.MercatorCoordinate(e.x/this.worldSize,e.y/this.worldSize).toLngLat()},En.point.get=function(){return this.project(this.center)},Sn.prototype.setLocationAtPoint=function(e,i){var n=this.pointCoordinate(i),r=this.pointCoordinate(this.centerPoint),a=this.locationCoordinate(e),o=new t.MercatorCoordinate(a.x-(n.x-r.x),a.y-(n.y-r.y));this.center=this.coordinateLocation(o),this._renderWorldCopies&&(this.center=this.center.wrap())},Sn.prototype.locationPoint=function(t){return this.coordinatePoint(this.locationCoordinate(t))},Sn.prototype.pointLocation=function(t){return this.coordinateLocation(this.pointCoordinate(t))},Sn.prototype.locationCoordinate=function(e){return t.MercatorCoordinate.fromLngLat(e)},Sn.prototype.coordinateLocation=function(t){return t.toLngLat()},Sn.prototype.pointCoordinate=function(e){var i=[e.x,e.y,0,1],n=[e.x,e.y,1,1];t.transformMat4(i,i,this.pixelMatrixInverse),t.transformMat4(n,n,this.pixelMatrixInverse);var r=i[3],a=n[3],o=i[1]/r,s=n[1]/a,l=i[2]/r,c=n[2]/a,u=l===c?0:(0-l)/(c-l);return new t.MercatorCoordinate(t.number(i[0]/r,n[0]/a,u)/this.worldSize,t.number(o,s,u)/this.worldSize)},Sn.prototype.coordinatePoint=function(e){var i=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(i,i,this.pixelMatrix),new t.Point(i[0]/i[3],i[1]/i[3])},Sn.prototype.getBounds=function(){return(new t.LngLatBounds).extend(this.pointLocation(new t.Point(0,0))).extend(this.pointLocation(new t.Point(this.width,0))).extend(this.pointLocation(new t.Point(this.width,this.height))).extend(this.pointLocation(new t.Point(0,this.height)))},Sn.prototype.getMaxBounds=function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new t.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Sn.prototype.setMaxBounds=function(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Sn.prototype.calculatePosMatrix=function(e,i){void 0===i&&(i=!1);var n=e.key,r=i?this._alignedPosMatrixCache:this._posMatrixCache;if(r[n])return r[n];var a=e.canonical,o=this.worldSize/this.zoomScale(a.z),s=a.x+Math.pow(2,a.z)*e.wrap,l=t.identity(new Float64Array(16));return t.translate(l,l,[s*o,a.y*o,0]),t.scale(l,l,[o/t.EXTENT,o/t.EXTENT,1]),t.multiply(l,i?this.alignedProjMatrix:this.projMatrix,l),r[n]=new Float32Array(l),r[n]},Sn.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Sn.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var e,i,n,r,a=-90,o=90,s=-180,l=180,c=this.size,u=this._unmodified;if(this.latRange){var h=this.latRange;a=t.mercatorYfromLat(h[1])*this.worldSize,e=(o=t.mercatorYfromLat(h[0])*this.worldSize)-a<c.y?c.y/(o-a):0}if(this.lngRange){var p=this.lngRange;s=t.mercatorXfromLng(p[0])*this.worldSize,i=(l=t.mercatorXfromLng(p[1])*this.worldSize)-s<c.x?c.x/(l-s):0}var d=this.point,f=Math.max(i||0,e||0);if(f)return this.center=this.unproject(new t.Point(i?(l+s)/2:d.x,e?(o+a)/2:d.y)),this.zoom+=this.scaleZoom(f),this._unmodified=u,void(this._constraining=!1);if(this.latRange){var m=d.y,g=c.y/2;m-g<a&&(r=a+g),m+g>o&&(r=o-g)}if(this.lngRange){var _=d.x,y=c.x/2;_-y<s&&(n=s+y),_+y>l&&(n=l-y)}void 0===n&&void 0===r||(this.center=this.unproject(new t.Point(void 0!==n?n:d.x,void 0!==r?r:d.y))),this._unmodified=u,this._constraining=!1}},Sn.prototype._calcMatrices=function(){if(this.height){var e=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var i=Math.PI/2+this._pitch,n=this._fov*(.5+e.y/this.height),r=Math.sin(n)*this.cameraToCenterDistance/Math.sin(t.clamp(Math.PI-i-n,.01,Math.PI-.01)),a=this.point,o=a.x,s=a.y,l=1.01*(Math.cos(Math.PI/2-this._pitch)*r+this.cameraToCenterDistance),c=this.height/50,u=new Float64Array(16);t.perspective(u,this._fov,this.width/this.height,c,l),u[8]=2*-e.x/this.width,u[9]=2*e.y/this.height,t.scale(u,u,[1,-1,1]),t.translate(u,u,[0,0,-this.cameraToCenterDistance]),t.rotateX(u,u,this._pitch),t.rotateZ(u,u,this.angle),t.translate(u,u,[-o,-s,0]),this.mercatorMatrix=t.scale([],u,[this.worldSize,this.worldSize,this.worldSize]),t.scale(u,u,[1,1,t.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=u,this.invProjMatrix=t.invert([],this.projMatrix);var h=this.width%2/2,p=this.height%2/2,d=Math.cos(this.angle),f=Math.sin(this.angle),m=o-Math.round(o)+d*h+f*p,g=s-Math.round(s)+d*p+f*h,_=new Float64Array(u);if(t.translate(_,_,[m>.5?m-1:m,g>.5?g-1:g,0]),this.alignedProjMatrix=_,u=t.create(),t.scale(u,u,[this.width/2,-this.height/2,1]),t.translate(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=t.create(),t.scale(u,u,[1,-1,1]),t.translate(u,u,[-1,-1,0]),t.scale(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u,this.pixelMatrix=t.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(u=t.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=u,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Sn.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var e=this.pointCoordinate(new t.Point(0,0)),i=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(i,i,this.pixelMatrix)[3]/this.cameraToCenterDistance},Sn.prototype.getCameraPoint=function(){var e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.Point(0,e))},Sn.prototype.getCameraQueryGeometry=function(e){var i=this.getCameraPoint();if(1===e.length)return[e[0],i];for(var n=i.x,r=i.y,a=i.x,o=i.y,s=0,l=e;s<l.length;s+=1){var c=l[s];n=Math.min(n,c.x),r=Math.min(r,c.y),a=Math.max(a,c.x),o=Math.max(o,c.y)}return[new t.Point(n,r),new t.Point(a,r),new t.Point(a,o),new t.Point(n,o),new t.Point(n,r)]},Object.defineProperties(Sn.prototype,En);var Tn=function(e){var i,n,r,a;this._hashName=e&&encodeURIComponent(e),t.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(i=this._updateHashUnthrottled.bind(this),n=!1,r=null,a=function(){r=null,n&&(i(),r=setTimeout(a,300),n=!1)},function(){return n=!0,r||a(),r})};Tn.prototype.addTo=function(e){return this._map=e,t.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Tn.prototype.remove=function(){return t.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Tn.prototype.getHashString=function(e){var i=this._map.getCenter(),n=Math.round(100*this._map.getZoom())/100,r=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),a=Math.pow(10,r),o=Math.round(i.lng*a)/a,s=Math.round(i.lat*a)/a,l=this._map.getBearing(),c=this._map.getPitch(),u="";if(u+=e?"/"+o+"/"+s+"/"+n:n+"/"+s+"/"+o,(l||c)&&(u+="/"+Math.round(10*l)/10),c&&(u+="/"+Math.round(c)),this._hashName){var h=this._hashName,p=!1,d=t.window.location.hash.slice(1).split("&").map((function(t){var e=t.split("=")[0];return e===h?(p=!0,e+"="+u):t})).filter((function(t){return t}));return p||d.push(h+"="+u),"#"+d.join("&")}return"#"+u},Tn.prototype._getCurrentHash=function(){var e,i=this,n=t.window.location.hash.replace("#","");return this._hashName?(n.split("&").map((function(t){return t.split("=")})).forEach((function(t){t[0]===i._hashName&&(e=t)})),(e&&e[1]||"").split("/")):n.split("/")},Tn.prototype._onHashChange=function(){var t=this._getCurrentHash();if(t.length>=3&&!t.some((function(t){return isNaN(t)}))){var e=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:e,pitch:+(t[4]||0)}),!0}return!1},Tn.prototype._updateHashUnthrottled=function(){var e=t.window.location.href.replace(/(#.+)?$/,this.getHashString());try{t.window.history.replaceState(t.window.history.state,null,e)}catch(t){}};var Mn={linearity:.3,easing:t.bezier(0,0,.3,1)},Cn=t.extend({deceleration:2500,maxSpeed:1400},Mn),In=t.extend({deceleration:20,maxSpeed:1400},Mn),An=t.extend({deceleration:1e3,maxSpeed:360},Mn),kn=t.extend({deceleration:1e3,maxSpeed:90},Mn),Rn=function(t){this._map=t,this.clear()};function zn(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function Pn(e,i,n){var r=n.maxSpeed,a=n.linearity,o=n.deceleration,s=t.clamp(e*a/(i/1e3),-r,r),l=Math.abs(s)/(o*a);return{easing:n.easing,duration:1e3*l,amount:s*(l/2)}}Rn.prototype.clear=function(){this._inertiaBuffer=[]},Rn.prototype.record=function(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.browser.now(),settings:e})},Rn.prototype._drainInertiaBuffer=function(){for(var e=this._inertiaBuffer,i=t.browser.now();e.length>0&&i-e[0].time>160;)e.shift()},Rn.prototype._onMoveEnd=function(e){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var i={zoom:0,bearing:0,pitch:0,pan:new t.Point(0,0),pinchAround:void 0,around:void 0},n=0,r=this._inertiaBuffer;n<r.length;n+=1){var a=r[n].settings;i.zoom+=a.zoomDelta||0,i.bearing+=a.bearingDelta||0,i.pitch+=a.pitchDelta||0,a.panDelta&&i.pan._add(a.panDelta),a.around&&(i.around=a.around),a.pinchAround&&(i.pinchAround=a.pinchAround)}var o=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,s={};if(i.pan.mag()){var l=Pn(i.pan.mag(),o,t.extend({},Cn,e||{}));s.offset=i.pan.mult(l.amount/i.pan.mag()),s.center=this._map.transform.center,zn(s,l)}if(i.zoom){var c=Pn(i.zoom,o,In);s.zoom=this._map.transform.zoom+c.amount,zn(s,c)}if(i.bearing){var u=Pn(i.bearing,o,An);s.bearing=this._map.transform.bearing+t.clamp(u.amount,-179,179),zn(s,u)}if(i.pitch){var h=Pn(i.pitch,o,kn);s.pitch=this._map.transform.pitch+h.amount,zn(s,h)}if(s.zoom||s.bearing){var p=void 0===i.pinchAround?i.around:i.pinchAround;s.around=p?this._map.unproject(p):this._map.getCenter()}return this.clear(),t.extend(s,{noMoveStart:!0})}};var Dn=function(e){function n(n,r,a,o){void 0===o&&(o={});var s=i.mousePos(r.getCanvasContainer(),a),l=r.unproject(s);e.call(this,n,t.extend({point:s,lngLat:l,originalEvent:a},o)),this._defaultPrevented=!1,this.target=r}e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n;var r={defaultPrevented:{configurable:!0}};return n.prototype.preventDefault=function(){this._defaultPrevented=!0},r.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(n.prototype,r),n}(t.Event),Ln=function(e){function n(n,r,a){var o="touchend"===n?a.changedTouches:a.touches,s=i.touchPos(r.getCanvasContainer(),o),l=s.map((function(t){return r.unproject(t)})),c=s.reduce((function(t,e,i,n){return t.add(e.div(n.length))}),new t.Point(0,0)),u=r.unproject(c);e.call(this,n,{points:s,point:c,lngLats:l,lngLat:u,originalEvent:a}),this._defaultPrevented=!1}e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n;var r={defaultPrevented:{configurable:!0}};return n.prototype.preventDefault=function(){this._defaultPrevented=!0},r.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(n.prototype,r),n}(t.Event),Bn=function(t){function e(e,i,n){t.call(this,e,{originalEvent:n}),this._defaultPrevented=!1}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={defaultPrevented:{configurable:!0}};return e.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(e.prototype,i),e}(t.Event),On=function(t,e){this._map=t,this._clickTolerance=e.clickTolerance};On.prototype.reset=function(){delete this._mousedownPos},On.prototype.wheel=function(t){return this._firePreventable(new Bn(t.type,this._map,t))},On.prototype.mousedown=function(t,e){return this._mousedownPos=e,this._firePreventable(new Dn(t.type,this._map,t))},On.prototype.mouseup=function(t){this._map.fire(new Dn(t.type,this._map,t))},On.prototype.click=function(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||this._map.fire(new Dn(t.type,this._map,t))},On.prototype.dblclick=function(t){return this._firePreventable(new Dn(t.type,this._map,t))},On.prototype.mouseover=function(t){this._map.fire(new Dn(t.type,this._map,t))},On.prototype.mouseout=function(t){this._map.fire(new Dn(t.type,this._map,t))},On.prototype.touchstart=function(t){return this._firePreventable(new Ln(t.type,this._map,t))},On.prototype.touchmove=function(t){this._map.fire(new Ln(t.type,this._map,t))},On.prototype.touchend=function(t){this._map.fire(new Ln(t.type,this._map,t))},On.prototype.touchcancel=function(t){this._map.fire(new Ln(t.type,this._map,t))},On.prototype._firePreventable=function(t){if(this._map.fire(t),t.defaultPrevented)return{}},On.prototype.isEnabled=function(){return!0},On.prototype.isActive=function(){return!1},On.prototype.enable=function(){},On.prototype.disable=function(){};var Fn=function(t){this._map=t};Fn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Fn.prototype.mousemove=function(t){this._map.fire(new Dn(t.type,this._map,t))},Fn.prototype.mousedown=function(){this._delayContextMenu=!0},Fn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Dn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Fn.prototype.contextmenu=function(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Dn(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()},Fn.prototype.isEnabled=function(){return!0},Fn.prototype.isActive=function(){return!1},Fn.prototype.enable=function(){},Fn.prototype.disable=function(){};var Nn=function(t,e){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1};function Un(t,e){for(var i={},n=0;n<t.length;n++)i[t[n].identifier]=e[n];return i}Nn.prototype.isEnabled=function(){return!!this._enabled},Nn.prototype.isActive=function(){return!!this._active},Nn.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Nn.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Nn.prototype.mousedown=function(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(i.disableDrag(),this._startPos=this._lastPos=e,this._active=!0)},Nn.prototype.mousemoveWindow=function(t,e){if(this._active){var n=e;if(!(this._lastPos.equals(n)||!this._box&&n.dist(this._startPos)<this._clickTolerance)){var r=this._startPos;this._lastPos=n,this._box||(this._box=i.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));var a=Math.min(r.x,n.x),o=Math.max(r.x,n.x),s=Math.min(r.y,n.y),l=Math.max(r.y,n.y);i.setTransform(this._box,"translate("+a+"px,"+s+"px)"),this._box.style.width=o-a+"px",this._box.style.height=l-s+"px"}}},Nn.prototype.mouseupWindow=function(e,n){var r=this;if(this._active&&0===e.button){var a=this._startPos,o=n;if(this.reset(),i.suppressClick(),a.x!==o.x||a.y!==o.y)return this._map.fire(new t.Event("boxzoomend",{originalEvent:e})),{cameraAnimation:function(t){return t.fitScreenCoordinates(a,o,r._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",e)}},Nn.prototype.keydown=function(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))},Nn.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(i.remove(this._box),this._box=null),i.enableDrag(),delete this._startPos,delete this._lastPos},Nn.prototype._fireEvent=function(e,i){return this._map.fire(new t.Event(e,{originalEvent:i}))};var $n=function(t){this.reset(),this.numTouches=t.numTouches};$n.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},$n.prototype.touchstart=function(e,i,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=e.timeStamp),n.length===this.numTouches&&(this.centroid=function(e){for(var i=new t.Point(0,0),n=0,r=e;n<r.length;n+=1)i._add(r[n]);return i.div(e.length)}(i),this.touches=Un(n,i)))},$n.prototype.touchmove=function(t,e,i){if(!this.aborted&&this.centroid){var n=Un(i,e);for(var r in this.touches){var a=n[r];(!a||a.dist(this.touches[r])>30)&&(this.aborted=!0)}}},$n.prototype.touchend=function(t,e,i){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===i.length){var n=!this.aborted&&this.centroid;if(this.reset(),n)return n}};var Vn=function(t){this.singleTap=new $n(t),this.numTaps=t.numTaps,this.reset()};Vn.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Vn.prototype.touchstart=function(t,e,i){this.singleTap.touchstart(t,e,i)},Vn.prototype.touchmove=function(t,e,i){this.singleTap.touchmove(t,e,i)},Vn.prototype.touchend=function(t,e,i){var n=this.singleTap.touchend(t,e,i);if(n){var r=t.timeStamp-this.lastTime<500,a=!this.lastTap||this.lastTap.dist(n)<30;if(r&&a||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=n,this.count===this.numTaps)return this.reset(),n}};var jn=function(){this._zoomIn=new Vn({numTouches:1,numTaps:2}),this._zoomOut=new Vn({numTouches:2,numTaps:1}),this.reset()};jn.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},jn.prototype.touchstart=function(t,e,i){this._zoomIn.touchstart(t,e,i),this._zoomOut.touchstart(t,e,i)},jn.prototype.touchmove=function(t,e,i){this._zoomIn.touchmove(t,e,i),this._zoomOut.touchmove(t,e,i)},jn.prototype.touchend=function(t,e,i){var n=this,r=this._zoomIn.touchend(t,e,i),a=this._zoomOut.touchend(t,e,i);return r?(this._active=!0,t.preventDefault(),setTimeout((function(){return n.reset()}),0),{cameraAnimation:function(e){return e.easeTo({duration:300,zoom:e.getZoom()+1,around:e.unproject(r)},{originalEvent:t})}}):a?(this._active=!0,t.preventDefault(),setTimeout((function(){return n.reset()}),0),{cameraAnimation:function(e){return e.easeTo({duration:300,zoom:e.getZoom()-1,around:e.unproject(a)},{originalEvent:t})}}):void 0},jn.prototype.touchcancel=function(){this.reset()},jn.prototype.enable=function(){this._enabled=!0},jn.prototype.disable=function(){this._enabled=!1,this.reset()},jn.prototype.isEnabled=function(){return this._enabled},jn.prototype.isActive=function(){return this._active};var qn={0:1,2:2},Gn=function(t){this.reset(),this._clickTolerance=t.clickTolerance||1};Gn.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Gn.prototype._correctButton=function(t,e){return!1},Gn.prototype._move=function(t,e){return{}},Gn.prototype.mousedown=function(t,e){if(!this._lastPoint){var n=i.mouseButton(t);this._correctButton(t,n)&&(this._lastPoint=e,this._eventButton=n)}},Gn.prototype.mousemoveWindow=function(t,e){var i=this._lastPoint;if(i)if(t.preventDefault(),function(t,e){var i=qn[e];return void 0===t.buttons||(t.buttons&i)!==i}(t,this._eventButton))this.reset();else if(this._moved||!(e.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=e,this._move(i,e)},Gn.prototype.mouseupWindow=function(t){this._lastPoint&&i.mouseButton(t)===this._eventButton&&(this._moved&&i.suppressClick(),this.reset())},Gn.prototype.enable=function(){this._enabled=!0},Gn.prototype.disable=function(){this._enabled=!1,this.reset()},Gn.prototype.isEnabled=function(){return this._enabled},Gn.prototype.isActive=function(){return this._active};var Hn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.mousedown=function(e,i){t.prototype.mousedown.call(this,e,i),this._lastPoint&&(this._active=!0)},e.prototype._correctButton=function(t,e){return 0===e&&!t.ctrlKey},e.prototype._move=function(t,e){return{around:e,panDelta:e.sub(t)}},e}(Gn),Wn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._correctButton=function(t,e){return 0===e&&t.ctrlKey||2===e},e.prototype._move=function(t,e){var i=.8*(e.x-t.x);if(i)return this._active=!0,{bearingDelta:i}},e.prototype.contextmenu=function(t){t.preventDefault()},e}(Gn),Zn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._correctButton=function(t,e){return 0===e&&t.ctrlKey||2===e},e.prototype._move=function(t,e){var i=-.5*(e.y-t.y);if(i)return this._active=!0,{pitchDelta:i}},e.prototype.contextmenu=function(t){t.preventDefault()},e}(Gn),Yn=function(t){this._minTouches=1,this._clickTolerance=t.clickTolerance||1,this.reset()};Yn.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new t.Point(0,0)},Yn.prototype.touchstart=function(t,e,i){return this._calculateTransform(t,e,i)},Yn.prototype.touchmove=function(t,e,i){if(this._active&&!(i.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,e,i)},Yn.prototype.touchend=function(t,e,i){this._calculateTransform(t,e,i),this._active&&i.length<this._minTouches&&this.reset()},Yn.prototype.touchcancel=function(){this.reset()},Yn.prototype._calculateTransform=function(e,i,n){n.length>0&&(this._active=!0);var r=Un(n,i),a=new t.Point(0,0),o=new t.Point(0,0),s=0;for(var l in r){var c=r[l],u=this._touches[l];u&&(a._add(c),o._add(c.sub(u)),s++,r[l]=c)}if(this._touches=r,!(s<this._minTouches)&&o.mag()){var h=o.div(s);if(this._sum._add(h),!(this._sum.mag()<this._clickTolerance))return{around:a.div(s),panDelta:h}}},Yn.prototype.enable=function(){this._enabled=!0},Yn.prototype.disable=function(){this._enabled=!1,this.reset()},Yn.prototype.isEnabled=function(){return this._enabled},Yn.prototype.isActive=function(){return this._active};var Xn=function(){this.reset()};function Kn(t,e,i){for(var n=0;n<t.length;n++)if(t[n].identifier===i)return e[n]}function Jn(t,e){return Math.log(t/e)/Math.LN2}Xn.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Xn.prototype._start=function(t){},Xn.prototype._move=function(t,e,i){return{}},Xn.prototype.touchstart=function(t,e,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([e[0],e[1]]))},Xn.prototype.touchmove=function(t,e,i){if(this._firstTwoTouches){t.preventDefault();var n=this._firstTwoTouches,r=n[1],a=Kn(i,e,n[0]),o=Kn(i,e,r);if(a&&o){var s=this._aroundCenter?null:a.add(o).div(2);return this._move([a,o],s,t)}}},Xn.prototype.touchend=function(t,e,n){if(this._firstTwoTouches){var r=this._firstTwoTouches,a=r[1],o=Kn(n,e,r[0]),s=Kn(n,e,a);o&&s||(this._active&&i.suppressClick(),this.reset())}},Xn.prototype.touchcancel=function(){this.reset()},Xn.prototype.enable=function(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around},Xn.prototype.disable=function(){this._enabled=!1,this.reset()},Xn.prototype.isEnabled=function(){return this._enabled},Xn.prototype.isActive=function(){return this._active};var Qn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.reset=function(){t.prototype.reset.call(this),delete this._distance,delete this._startDistance},e.prototype._start=function(t){this._startDistance=this._distance=t[0].dist(t[1])},e.prototype._move=function(t,e){var i=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Jn(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Jn(this._distance,i),pinchAround:e}},e}(Xn);function tr(t,e){return 180*t.angleWith(e)/Math.PI}var er=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.reset=function(){t.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},e.prototype._start=function(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])},e.prototype._move=function(t,e){var i=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:tr(this._vector,i),pinchAround:e}},e.prototype._isBelowThreshold=function(t){this._minDiameter=Math.min(this._minDiameter,t.mag());var e=25/(Math.PI*this._minDiameter)*360,i=tr(t,this._startVector);return Math.abs(i)<e},e}(Xn);function ir(t){return Math.abs(t.y)>Math.abs(t.x)}var nr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.reset=function(){t.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},e.prototype._start=function(t){this._lastPoints=t,ir(t[0].sub(t[1]))&&(this._valid=!1)},e.prototype._move=function(t,e,i){var n=t[0].sub(this._lastPoints[0]),r=t[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(n,r,i.timeStamp),this._valid)return this._lastPoints=t,this._active=!0,{pitchDelta:(n.y+r.y)/2*-.5}},e.prototype.gestureBeginsVertically=function(t,e,i){if(void 0!==this._valid)return this._valid;var n=t.mag()>=2,r=e.mag()>=2;if(n||r){if(!n||!r)return void 0===this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;var a=t.y>0==e.y>0;return ir(t)&&ir(e)&&a}},e}(Xn),rr={panStep:100,bearingStep:15,pitchStep:10},ar=function(){var t=rr;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1};function or(t){return t*(2-t)}ar.prototype.reset=function(){this._active=!1},ar.prototype.keydown=function(t){var e=this;if(!(t.altKey||t.ctrlKey||t.metaKey)){var i=0,n=0,r=0,a=0,o=0;switch(t.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:t.shiftKey?n=-1:(t.preventDefault(),a=-1);break;case 39:t.shiftKey?n=1:(t.preventDefault(),a=1);break;case 38:t.shiftKey?r=1:(t.preventDefault(),o=-1);break;case 40:t.shiftKey?r=-1:(t.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(n=0,r=0),{cameraAnimation:function(s){var l=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:or,zoom:i?Math.round(l)+i*(t.shiftKey?2:1):l,bearing:s.getBearing()+n*e._bearingStep,pitch:s.getPitch()+r*e._pitchStep,offset:[-a*e._panStep,-o*e._panStep],center:s.getCenter()},{originalEvent:t})}}}},ar.prototype.enable=function(){this._enabled=!0},ar.prototype.disable=function(){this._enabled=!1,this.reset()},ar.prototype.isEnabled=function(){return this._enabled},ar.prototype.isActive=function(){return this._active},ar.prototype.disableRotation=function(){this._rotationDisabled=!0},ar.prototype.enableRotation=function(){this._rotationDisabled=!1};var sr=function(e,i){this._map=e,this._el=e.getCanvasContainer(),this._handler=i,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,t.bindAll(["_onTimeout"],this)};sr.prototype.setZoomRate=function(t){this._defaultZoomRate=t},sr.prototype.setWheelZoomRate=function(t){this._wheelZoomRate=t},sr.prototype.isEnabled=function(){return!!this._enabled},sr.prototype.isActive=function(){return!!this._active||void 0!==this._finishTimeout},sr.prototype.isZooming=function(){return!!this._zooming},sr.prototype.enable=function(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},sr.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},sr.prototype.wheel=function(e){if(this.isEnabled()){var i=e.deltaMode===t.window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,n=t.browser.now(),r=n-(this._lastWheelEventTime||0);this._lastWheelEventTime=n,0!==i&&i%4.000244140625==0?this._type="wheel":0!==i&&Math.abs(i)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(r*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),e.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=e,this._delta-=i,this._active||this._start(e)),e.preventDefault()}},sr.prototype._onTimeout=function(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)},sr.prototype._start=function(e){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var n=i.mousePos(this._el,e);this._around=t.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(n)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},sr.prototype.renderFrame=function(){var e=this;if(this._frameId&&(this._frameId=null,this.isActive())){var i=this._map.transform;if(0!==this._delta){var n="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,r=2/(1+Math.exp(-Math.abs(this._delta*n)));this._delta<0&&0!==r&&(r=1/r);var a="number"==typeof this._targetZoom?i.zoomScale(this._targetZoom):i.scale;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(a*r))),"wheel"===this._type&&(this._startZoom=i.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var o,s="number"==typeof this._targetZoom?this._targetZoom:i.zoom,l=this._startZoom,c=this._easing,u=!1;if("wheel"===this._type&&l&&c){var h=Math.min((t.browser.now()-this._lastWheelEventTime)/200,1),p=c(h);o=t.number(l,s,p),h<1?this._frameId||(this._frameId=!0):u=!0}else o=s,u=!0;return this._active=!0,u&&(this._active=!1,this._finishTimeout=setTimeout((function(){e._zooming=!1,e._handler._triggerRenderFrame(),delete e._targetZoom,delete e._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!u,zoomDelta:o-i.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},sr.prototype._smoothOutEasing=function(e){var i=t.ease;if(this._prevEase){var n=this._prevEase,r=(t.browser.now()-n.start)/n.duration,a=n.easing(r+.01)-n.easing(r),o=.27/Math.sqrt(a*a+1e-4)*.01,s=Math.sqrt(.0729-o*o);i=t.bezier(o,s,.25,1)}return this._prevEase={start:t.browser.now(),duration:e,easing:i},i},sr.prototype.reset=function(){this._active=!1};var lr=function(t,e){this._clickZoom=t,this._tapZoom=e};lr.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},lr.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},lr.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},lr.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var cr=function(){this.reset()};cr.prototype.reset=function(){this._active=!1},cr.prototype.dblclick=function(t,e){return t.preventDefault(),{cameraAnimation:function(i){i.easeTo({duration:300,zoom:i.getZoom()+(t.shiftKey?-1:1),around:i.unproject(e)},{originalEvent:t})}}},cr.prototype.enable=function(){this._enabled=!0},cr.prototype.disable=function(){this._enabled=!1,this.reset()},cr.prototype.isEnabled=function(){return this._enabled},cr.prototype.isActive=function(){return this._active};var ur=function(){this._tap=new Vn({numTouches:1,numTaps:1}),this.reset()};ur.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},ur.prototype.touchstart=function(t,e,i){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?i.length>0&&(this._swipePoint=e[0],this._swipeTouch=i[0].identifier):this._tap.touchstart(t,e,i))},ur.prototype.touchmove=function(t,e,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;var n=e[0],r=n.y-this._swipePoint.y;return this._swipePoint=n,t.preventDefault(),this._active=!0,{zoomDelta:r/128}}}else this._tap.touchmove(t,e,i)},ur.prototype.touchend=function(t,e,i){this._tapTime?this._swipePoint&&0===i.length&&this.reset():this._tap.touchend(t,e,i)&&(this._tapTime=t.timeStamp)},ur.prototype.touchcancel=function(){this.reset()},ur.prototype.enable=function(){this._enabled=!0},ur.prototype.disable=function(){this._enabled=!1,this.reset()},ur.prototype.isEnabled=function(){return this._enabled},ur.prototype.isActive=function(){return this._active};var hr=function(t,e,i){this._el=t,this._mousePan=e,this._touchPan=i};hr.prototype.enable=function(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},hr.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},hr.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},hr.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var pr=function(t,e,i){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=e,this._mousePitch=i};pr.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},pr.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},pr.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},pr.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var dr=function(t,e,i,n){this._el=t,this._touchZoom=e,this._touchRotate=i,this._tapDragZoom=n,this._rotationDisabled=!1,this._enabled=!0};dr.prototype.enable=function(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},dr.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},dr.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},dr.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},dr.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},dr.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var fr=function(t){return t.zoom||t.drag||t.pitch||t.rotate},mr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(t.Event);function gr(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}var _r=function(e,n){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Rn(e),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n),t.bindAll(["handleEvent","handleWindowEvent"],this);var r=this._el;this._listeners=[[r,"touchstart",{passive:!0}],[r,"touchmove",{passive:!1}],[r,"touchend",void 0],[r,"touchcancel",void 0],[r,"mousedown",void 0],[r,"mousemove",void 0],[r,"mouseup",void 0],[t.window.document,"mousemove",{capture:!0}],[t.window.document,"mouseup",void 0],[r,"mouseover",void 0],[r,"mouseout",void 0],[r,"dblclick",void 0],[r,"click",void 0],[r,"keydown",{capture:!1}],[r,"keyup",void 0],[r,"wheel",{passive:!1}],[r,"contextmenu",void 0],[t.window,"blur",void 0]];for(var a=0,o=this._listeners;a<o.length;a+=1){var s=o[a],l=s[0];i.addEventListener(l,s[1],l===t.window.document?this.handleWindowEvent:this.handleEvent,s[2])}};_r.prototype.destroy=function(){for(var e=0,n=this._listeners;e<n.length;e+=1){var r=n[e],a=r[0];i.removeEventListener(a,r[1],a===t.window.document?this.handleWindowEvent:this.handleEvent,r[2])}},_r.prototype._addDefaultHandlers=function(t){var e=this._map,i=e.getCanvasContainer();this._add("mapEvent",new On(e,t));var n=e.boxZoom=new Nn(e,t);this._add("boxZoom",n);var r=new jn,a=new cr;e.doubleClickZoom=new lr(a,r),this._add("tapZoom",r),this._add("clickZoom",a);var o=new ur;this._add("tapDragZoom",o);var s=e.touchPitch=new nr;this._add("touchPitch",s);var l=new Wn(t),c=new Zn(t);e.dragRotate=new pr(t,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);var u=new Hn(t),h=new Yn(t);e.dragPan=new hr(i,u,h),this._add("mousePan",u),this._add("touchPan",h,["touchZoom","touchRotate"]);var p=new er,d=new Qn;e.touchZoomRotate=new dr(i,d,p,o),this._add("touchRotate",p,["touchPan","touchZoom"]),this._add("touchZoom",d,["touchPan","touchRotate"]);var f=e.scrollZoom=new sr(e,this);this._add("scrollZoom",f,["mousePan"]);var m=e.keyboard=new ar;this._add("keyboard",m),this._add("blockableMapEvent",new Fn(e));for(var g=0,_=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];g<_.length;g+=1){var y=_[g];t.interactive&&t[y]&&e[y].enable(t[y])}},_r.prototype._add=function(t,e,i){this._handlers.push({handlerName:t,handler:e,allowed:i}),this._handlersById[t]=e},_r.prototype.stop=function(t){if(!this._updatingCamera){for(var e=0,i=this._handlers;e<i.length;e+=1)i[e].handler.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}},_r.prototype.isActive=function(){for(var t=0,e=this._handlers;t<e.length;t+=1)if(e[t].handler.isActive())return!0;return!1},_r.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},_r.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},_r.prototype.isMoving=function(){return Boolean(fr(this._eventsInProgress))||this.isZooming()},_r.prototype._blockedByActive=function(t,e,i){for(var n in t)if(n!==i&&(!e||e.indexOf(n)<0))return!0;return!1},_r.prototype.handleWindowEvent=function(t){this.handleEvent(t,t.type+"Window")},_r.prototype._getMapTouches=function(t){for(var e=[],i=0,n=t;i<n.length;i+=1){var r=n[i];this._el.contains(r.target)&&e.push(r)}return e},_r.prototype.handleEvent=function(t,e){if("blur"!==t.type){this._updatingCamera=!0;for(var n="renderFrame"===t.type?void 0:t,r={needsRenderFrame:!1},a={},o={},s=t.touches?this._getMapTouches(t.touches):void 0,l=s?i.touchPos(this._el,s):i.mousePos(this._el,t),c=0,u=this._handlers;c<u.length;c+=1){var h=u[c],p=h.handlerName,d=h.handler,f=h.allowed;if(d.isEnabled()){var m=void 0;this._blockedByActive(o,f,p)?d.reset():d[e||t.type]&&(m=d[e||t.type](t,l,s),this.mergeHandlerResult(r,a,m,p,n),m&&m.needsRenderFrame&&this._triggerRenderFrame()),(m||d.isActive())&&(o[p]=d)}}var g={};for(var _ in this._previousActiveHandlers)o[_]||(g[_]=n);this._previousActiveHandlers=o,(Object.keys(g).length||gr(r))&&(this._changes.push([r,a,g]),this._triggerRenderFrame()),(Object.keys(o).length||gr(r))&&this._map._stop(!0),this._updatingCamera=!1;var y=r.cameraAnimation;y&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],y(this._map))}else this.stop(!0)},_r.prototype.mergeHandlerResult=function(e,i,n,r,a){if(n){t.extend(e,n);var o={handlerName:r,originalEvent:n.originalEvent||a};void 0!==n.zoomDelta&&(i.zoom=o),void 0!==n.panDelta&&(i.drag=o),void 0!==n.pitchDelta&&(i.pitch=o),void 0!==n.bearingDelta&&(i.rotate=o)}},_r.prototype._applyChanges=function(){for(var e={},i={},n={},r=0,a=this._changes;r<a.length;r+=1){var o=a[r],s=o[0],l=o[1],c=o[2];s.panDelta&&(e.panDelta=(e.panDelta||new t.Point(0,0))._add(s.panDelta)),s.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+s.zoomDelta),s.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+s.bearingDelta),s.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+s.pitchDelta),void 0!==s.around&&(e.around=s.around),void 0!==s.pinchAround&&(e.pinchAround=s.pinchAround),s.noInertia&&(e.noInertia=s.noInertia),t.extend(i,l),t.extend(n,c)}this._updateMapTransform(e,i,n),this._changes=[]},_r.prototype._updateMapTransform=function(t,e,i){var n=this._map,r=n.transform;if(!gr(t))return this._fireEvents(e,i,!0);var a=t.panDelta,o=t.zoomDelta,s=t.bearingDelta,l=t.pitchDelta,c=t.around,u=t.pinchAround;void 0!==u&&(c=u),n._stop(!0),c=c||n.transform.centerPoint;var h=r.pointLocation(a?c.sub(a):c);s&&(r.bearing+=s),l&&(r.pitch+=l),o&&(r.zoom+=o),r.setLocationAtPoint(h,c),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(e,i,!0)},_r.prototype._fireEvents=function(e,i,n){var r=this,a=fr(this._eventsInProgress),o=fr(e),s={};for(var l in e)this._eventsInProgress[l]||(s[l+"start"]=e[l].originalEvent),this._eventsInProgress[l]=e[l];for(var c in!a&&o&&this._fireEvent("movestart",o.originalEvent),s)this._fireEvent(c,s[c]);for(var u in o&&this._fireEvent("move",o.originalEvent),e)this._fireEvent(u,e[u].originalEvent);var h,p={};for(var d in this._eventsInProgress){var f=this._eventsInProgress[d],m=f.handlerName,g=f.originalEvent;this._handlersById[m].isActive()||(delete this._eventsInProgress[d],p[d+"end"]=h=i[m]||g)}for(var _ in p)this._fireEvent(_,p[_]);var y=fr(this._eventsInProgress);if(n&&(a||o)&&!y){this._updatingCamera=!0;var v=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),x=function(t){return 0!==t&&-r._bearingSnap<t&&t<r._bearingSnap};v?(x(v.bearing||this._map.getBearing())&&(v.bearing=0),this._map.easeTo(v,{originalEvent:h})):(this._map.fire(new t.Event("moveend",{originalEvent:h})),x(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},_r.prototype._fireEvent=function(e,i){this._map.fire(new t.Event(e,i?{originalEvent:i}:{}))},_r.prototype._requestFrame=function(){var t=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add((function(e){delete t._frameId,t.handleEvent(new mr("renderFrame",{timeStamp:e})),t._applyChanges()}))},_r.prototype._triggerRenderFrame=function(){void 0===this._frameId&&(this._frameId=this._requestFrame())};var yr=function(e){function i(i,n){e.call(this),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=n.bearingSnap,t.bindAll(["_renderFrameCallback"],this)}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.getCenter=function(){return new t.LngLat(this.transform.center.lng,this.transform.center.lat)},i.prototype.setCenter=function(t,e){return this.jumpTo({center:t},e)},i.prototype.panBy=function(e,i,n){return e=t.Point.convert(e).mult(-1),this.panTo(this.transform.center,t.extend({offset:e},i),n)},i.prototype.panTo=function(e,i,n){return this.easeTo(t.extend({center:e},i),n)},i.prototype.getZoom=function(){return this.transform.zoom},i.prototype.setZoom=function(t,e){return this.jumpTo({zoom:t},e),this},i.prototype.zoomTo=function(e,i,n){return this.easeTo(t.extend({zoom:e},i),n)},i.prototype.zoomIn=function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this},i.prototype.zoomOut=function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this},i.prototype.getBearing=function(){return this.transform.bearing},i.prototype.setBearing=function(t,e){return this.jumpTo({bearing:t},e),this},i.prototype.getPadding=function(){return this.transform.padding},i.prototype.setPadding=function(t,e){return this.jumpTo({padding:t},e),this},i.prototype.rotateTo=function(e,i,n){return this.easeTo(t.extend({bearing:e},i),n)},i.prototype.resetNorth=function(e,i){return this.rotateTo(0,t.extend({duration:1e3},e),i),this},i.prototype.resetNorthPitch=function(e,i){return this.easeTo(t.extend({bearing:0,pitch:0,duration:1e3},e),i),this},i.prototype.snapToNorth=function(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this},i.prototype.getPitch=function(){return this.transform.pitch},i.prototype.setPitch=function(t,e){return this.jumpTo({pitch:t},e),this},i.prototype.cameraForBounds=function(e,i){e=t.LngLatBounds.convert(e);var n=i&&i.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),n,i)},i.prototype._cameraForBoxAndBearing=function(e,i,n,r){var a={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=t.extend({padding:a,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){var o=r.padding;r.padding={top:o,bottom:o,right:o,left:o}}r.padding=t.extend(a,r.padding);var s=this.transform,l=s.padding,c=s.project(t.LngLat.convert(e)),u=s.project(t.LngLat.convert(i)),h=c.rotate(-n*Math.PI/180),p=u.rotate(-n*Math.PI/180),d=new t.Point(Math.max(h.x,p.x),Math.max(h.y,p.y)),f=new t.Point(Math.min(h.x,p.x),Math.min(h.y,p.y)),m=d.sub(f),g=(s.width-(l.left+l.right+r.padding.left+r.padding.right))/m.x,_=(s.height-(l.top+l.bottom+r.padding.top+r.padding.bottom))/m.y;if(!(_<0||g<0)){var y=Math.min(s.scaleZoom(s.scale*Math.min(g,_)),r.maxZoom),v="number"==typeof r.offset.x?new t.Point(r.offset.x,r.offset.y):t.Point.convert(r.offset),x=new t.Point((r.padding.left-r.padding.right)/2,(r.padding.top-r.padding.bottom)/2).rotate(n*Math.PI/180),b=v.add(x).mult(s.scale/s.zoomScale(y));return{center:s.unproject(c.add(u).div(2).sub(b)),zoom:y,bearing:n}}t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},i.prototype.fitBounds=function(t,e,i){return this._fitInternal(this.cameraForBounds(t,e),e,i)},i.prototype.fitScreenCoordinates=function(e,i,n,r,a){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(t.Point.convert(e)),this.transform.pointLocation(t.Point.convert(i)),n,r),r,a)},i.prototype._fitInternal=function(e,i,n){return e?(delete(i=t.extend(e,i)).padding,i.linear?this.easeTo(i,n):this.flyTo(i,n)):this},i.prototype.jumpTo=function(e,i){this.stop();var n=this.transform,r=!1,a=!1,o=!1;return"zoom"in e&&n.zoom!==+e.zoom&&(r=!0,n.zoom=+e.zoom),void 0!==e.center&&(n.center=t.LngLat.convert(e.center)),"bearing"in e&&n.bearing!==+e.bearing&&(a=!0,n.bearing=+e.bearing),"pitch"in e&&n.pitch!==+e.pitch&&(o=!0,n.pitch=+e.pitch),null==e.padding||n.isPaddingEqual(e.padding)||(n.padding=e.padding),this.fire(new t.Event("movestart",i)).fire(new t.Event("move",i)),r&&this.fire(new t.Event("zoomstart",i)).fire(new t.Event("zoom",i)).fire(new t.Event("zoomend",i)),a&&this.fire(new t.Event("rotatestart",i)).fire(new t.Event("rotate",i)).fire(new t.Event("rotateend",i)),o&&this.fire(new t.Event("pitchstart",i)).fire(new t.Event("pitch",i)).fire(new t.Event("pitchend",i)),this.fire(new t.Event("moveend",i))},i.prototype.easeTo=function(e,i){var n=this;this._stop(!1,e.easeId),(!1===(e=t.extend({offset:[0,0],duration:500,easing:t.ease},e)).animate||!e.essential&&t.browser.prefersReducedMotion)&&(e.duration=0);var r=this.transform,a=this.getZoom(),o=this.getBearing(),s=this.getPitch(),l=this.getPadding(),c="zoom"in e?+e.zoom:a,u="bearing"in e?this._normalizeBearing(e.bearing,o):o,h="pitch"in e?+e.pitch:s,p="padding"in e?e.padding:r.padding,d=t.Point.convert(e.offset),f=r.centerPoint.add(d),m=r.pointLocation(f),g=t.LngLat.convert(e.center||m);this._normalizeCenter(g);var _,y,v=r.project(m),x=r.project(g).sub(v),b=r.zoomScale(c-a);e.around&&(_=t.LngLat.convert(e.around),y=r.locationPoint(_));var w={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||c!==a,this._rotating=this._rotating||o!==u,this._pitching=this._pitching||h!==s,this._padding=!r.isPaddingEqual(p),this._easeId=e.easeId,this._prepareEase(i,e.noMoveStart,w),this._ease((function(e){if(n._zooming&&(r.zoom=t.number(a,c,e)),n._rotating&&(r.bearing=t.number(o,u,e)),n._pitching&&(r.pitch=t.number(s,h,e)),n._padding&&(r.interpolatePadding(l,p,e),f=r.centerPoint.add(d)),_)r.setLocationAtPoint(_,y);else{var m=r.zoomScale(r.zoom-a),g=c>a?Math.min(2,b):Math.max(.5,b),w=Math.pow(g,1-e),S=r.unproject(v.add(x.mult(e*w)).mult(m));r.setLocationAtPoint(r.renderWorldCopies?S.wrap():S,f)}n._fireMoveEvents(i)}),(function(t){n._afterEase(i,t)}),e),this},i.prototype._prepareEase=function(e,i,n){void 0===n&&(n={}),this._moving=!0,i||n.moving||this.fire(new t.Event("movestart",e)),this._zooming&&!n.zooming&&this.fire(new t.Event("zoomstart",e)),this._rotating&&!n.rotating&&this.fire(new t.Event("rotatestart",e)),this._pitching&&!n.pitching&&this.fire(new t.Event("pitchstart",e))},i.prototype._fireMoveEvents=function(e){this.fire(new t.Event("move",e)),this._zooming&&this.fire(new t.Event("zoom",e)),this._rotating&&this.fire(new t.Event("rotate",e)),this._pitching&&this.fire(new t.Event("pitch",e))},i.prototype._afterEase=function(e,i){if(!this._easeId||!i||this._easeId!==i){delete this._easeId;var n=this._zooming,r=this._rotating,a=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,n&&this.fire(new t.Event("zoomend",e)),r&&this.fire(new t.Event("rotateend",e)),a&&this.fire(new t.Event("pitchend",e)),this.fire(new t.Event("moveend",e))}},i.prototype.flyTo=function(e,i){var n=this;if(!e.essential&&t.browser.prefersReducedMotion){var r=t.pick(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(r,i)}this.stop(),e=t.extend({offset:[0,0],speed:1.2,curve:1.42,easing:t.ease},e);var a=this.transform,o=this.getZoom(),s=this.getBearing(),l=this.getPitch(),c=this.getPadding(),u="zoom"in e?t.clamp(+e.zoom,a.minZoom,a.maxZoom):o,h="bearing"in e?this._normalizeBearing(e.bearing,s):s,p="pitch"in e?+e.pitch:l,d="padding"in e?e.padding:a.padding,f=a.zoomScale(u-o),m=t.Point.convert(e.offset),g=a.centerPoint.add(m),_=a.pointLocation(g),y=t.LngLat.convert(e.center||_);this._normalizeCenter(y);var v=a.project(_),x=a.project(y).sub(v),b=e.curve,w=Math.max(a.width,a.height),S=w/f,E=x.mag();if("minZoom"in e){var T=t.clamp(Math.min(e.minZoom,o,u),a.minZoom,a.maxZoom),M=w/a.zoomScale(T-o);b=Math.sqrt(M/E*2)}var C=b*b;function I(t){var e=(S*S-w*w+(t?-1:1)*C*C*E*E)/(2*(t?S:w)*C*E);return Math.log(Math.sqrt(e*e+1)-e)}function A(t){return(Math.exp(t)-Math.exp(-t))/2}function k(t){return(Math.exp(t)+Math.exp(-t))/2}var R=I(0),z=function(t){return k(R)/k(R+b*t)},P=function(t){return w*((k(R)*(A(e=R+b*t)/k(e))-A(R))/C)/E;var e},D=(I(1)-R)/b;if(Math.abs(E)<1e-6||!isFinite(D)){if(Math.abs(w-S)<1e-6)return this.easeTo(e,i);var L=S<w?-1:1;D=Math.abs(Math.log(S/w))/b,P=function(){return 0},z=function(t){return Math.exp(L*b*t)}}return e.duration="duration"in e?+e.duration:1e3*D/("screenSpeed"in e?+e.screenSpeed/b:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=s!==h,this._pitching=p!==l,this._padding=!a.isPaddingEqual(d),this._prepareEase(i,!1),this._ease((function(e){var r=e*D,f=1/z(r);a.zoom=1===e?u:o+a.scaleZoom(f),n._rotating&&(a.bearing=t.number(s,h,e)),n._pitching&&(a.pitch=t.number(l,p,e)),n._padding&&(a.interpolatePadding(c,d,e),g=a.centerPoint.add(m));var _=1===e?y:a.unproject(v.add(x.mult(P(r))).mult(f));a.setLocationAtPoint(a.renderWorldCopies?_.wrap():_,g),n._fireMoveEvents(i)}),(function(){return n._afterEase(i)}),e),this},i.prototype.isEasing=function(){return!!this._easeFrameId},i.prototype.stop=function(){return this._stop()},i.prototype._stop=function(t,e){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var i=this._onEaseEnd;delete this._onEaseEnd,i.call(this,e)}if(!t){var n=this.handlers;n&&n.stop(!1)}return this},i.prototype._ease=function(e,i,n){!1===n.animate||0===n.duration?(e(1),i()):(this._easeStart=t.browser.now(),this._easeOptions=n,this._onEaseFrame=e,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},i.prototype._renderFrameCallback=function(){var e=Math.min((t.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},i.prototype._normalizeBearing=function(e,i){e=t.wrap(e,-180,180);var n=Math.abs(e-i);return Math.abs(e-360-i)<n&&(e-=360),Math.abs(e+360-i)<n&&(e+=360),e},i.prototype._normalizeCenter=function(t){var e=this.transform;if(e.renderWorldCopies&&!e.lngRange){var i=t.lng-e.center.lng;t.lng+=i>180?-360:i<-180?360:0}},i}(t.Evented),vr=function(e){void 0===e&&(e={}),this.options=e,t.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};vr.prototype.getDefaultPosition=function(){return"bottom-right"},vr.prototype.onAdd=function(t){var e=this.options&&this.options.compact;return this._map=t,this._container=i.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=i.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=i.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},vr.prototype.onRemove=function(){i.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},vr.prototype._setElementTitle=function(t,e){var i=this._map._getUIString("AttributionControl."+e);t.title=i,t.setAttribute("aria-label",i)},vr.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},vr.prototype._updateEditLink=function(){var e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));var i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.config.ACCESS_TOKEN}];if(e){var n=i.reduce((function(t,e,n){return e.value&&(t+=e.key+"="+e.value+(n<i.length-1?"&":"")),t}),"?");e.href=t.config.FEEDBACK_URL+"/"+n+(this._map._hash?this._map._hash.getHashString(!0):""),e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback")}},vr.prototype._updateData=function(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())},vr.prototype._updateAttributions=function(){if(this._map.style){var t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((function(t){return"string"!=typeof t?"":t}))):"string"==typeof this.options.customAttribution&&t.push(this.options.customAttribution)),this._map.style.stylesheet){var e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}var i=this._map.style.sourceCaches;for(var n in i){var r=i[n];if(r.used){var a=r.getSource();a.attribution&&t.indexOf(a.attribution)<0&&t.push(a.attribution)}}t.sort((function(t,e){return t.length-e.length}));var o=(t=t.filter((function(e,i){for(var n=i+1;n<t.length;n++)if(t[n].indexOf(e)>=0)return!1;return!0}))).join(" | ");o!==this._attribHTML&&(this._attribHTML=o,t.length?(this._innerContainer.innerHTML=o,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},vr.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var xr=function(){t.bindAll(["_updateLogo"],this),t.bindAll(["_updateCompact"],this)};xr.prototype.onAdd=function(t){this._map=t,this._container=i.create("div","mapboxgl-ctrl");var e=i.create("a","mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://www.mapbox.com/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},xr.prototype.onRemove=function(){i.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},xr.prototype.getDefaultPosition=function(){return"bottom-left"},xr.prototype._updateLogo=function(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")},xr.prototype._logoRequired=function(){if(this._map.style){var t=this._map.style.sourceCaches;for(var e in t)if(t[e].getSource().mapbox_logo)return!0;return!1}},xr.prototype._updateCompact=function(){var t=this._container.children;if(t.length){var e=t[0];this._map.getCanvasContainer().offsetWidth<250?e.classList.add("mapboxgl-compact"):e.classList.remove("mapboxgl-compact")}};var br=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};br.prototype.add=function(t){var e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e},br.prototype.remove=function(t){for(var e=this._currentlyRunning,i=0,n=e?this._queue.concat(e):this._queue;i<n.length;i+=1){var r=n[i];if(r.id===t)return void(r.cancelled=!0)}},br.prototype.run=function(t){void 0===t&&(t=0);var e=this._currentlyRunning=this._queue;this._queue=[];for(var i=0,n=e;i<n.length;i+=1){var r=n[i];if(!r.cancelled&&(r.callback(t),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},br.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var wr={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Sr=t.window.HTMLImageElement,Er=t.window.HTMLElement,Tr=t.window.ImageBitmap,Mr={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Cr=function(n){function r(e){var i=this;if(null!=(e=t.extend({},Mr,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var r=new Sn(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies);if(n.call(this,r,e),this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=e.collectResourceTiming,this._renderTaskQueue=new br,this._controls=[],this._mapId=t.uniqueId(),this._locale=t.extend({},wr,e.locale),this._clickTolerance=e.clickTolerance,this._requestManager=new t.RequestManager(e.transformRequest,e.accessToken),"string"==typeof e.container){if(this._container=t.window.document.getElementById(e.container),!this._container)throw new Error("Container '"+e.container+"' not found.")}else{if(!(e.container instanceof Er))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),t.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",(function(){return i._update(!1)})),this.on("moveend",(function(){return i._update(!1)})),this.on("zoom",(function(){return i._update(!0)})),void 0!==t.window&&(t.window.addEventListener("online",this._onWindowOnline,!1),t.window.addEventListener("resize",this._onWindowResize,!1),t.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new _r(this,e),this._hash=e.hash&&new Tn("string"==typeof e.hash&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,t.extend({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new vr({customAttribution:e.customAttribution})),this.addControl(new xr,e.logoPosition),this.on("style.load",(function(){i.transform.unmodified&&i.jumpTo(i.style.stylesheet)})),this.on("data",(function(e){i._update("style"===e.dataType),i.fire(new t.Event(e.dataType+"data",e))})),this.on("dataloading",(function(e){i.fire(new t.Event(e.dataType+"dataloading",e))}))}n&&(r.__proto__=n),(r.prototype=Object.create(n&&n.prototype)).constructor=r;var a={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return r.prototype._getMapId=function(){return this._mapId},r.prototype.addControl=function(e,i){if(void 0===i&&(i=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var n=e.onAdd(this);this._controls.push(e);var r=this._controlPositions[i];return-1!==i.indexOf("bottom")?r.insertBefore(n,r.firstChild):r.appendChild(n),this},r.prototype.removeControl=function(e){if(!e||!e.onRemove)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var i=this._controls.indexOf(e);return i>-1&&this._controls.splice(i,1),e.onRemove(this),this},r.prototype.hasControl=function(t){return this._controls.indexOf(t)>-1},r.prototype.resize=function(e){var i=this._containerDimensions(),n=i[0],r=i[1];this._resizeCanvas(n,r),this.transform.resize(n,r),this.painter.resize(n,r);var a=!this._moving;return a&&(this.stop(),this.fire(new t.Event("movestart",e)).fire(new t.Event("move",e))),this.fire(new t.Event("resize",e)),a&&this.fire(new t.Event("moveend",e)),this},r.prototype.getBounds=function(){return this.transform.getBounds()},r.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},r.prototype.setMaxBounds=function(e){return this.transform.setMaxBounds(t.LngLatBounds.convert(e)),this._update()},r.prototype.setMinZoom=function(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},r.prototype.getMinZoom=function(){return this.transform.minZoom},r.prototype.setMaxZoom=function(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")},r.prototype.getMaxZoom=function(){return this.transform.maxZoom},r.prototype.setMinPitch=function(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},r.prototype.getMinPitch=function(){return this.transform.minPitch},r.prototype.setMaxPitch=function(t){if((t=null==t?60:t)>60)throw new Error("maxPitch must be less than or equal to 60");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")},r.prototype.getMaxPitch=function(){return this.transform.maxPitch},r.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},r.prototype.setRenderWorldCopies=function(t){return this.transform.renderWorldCopies=t,this._update()},r.prototype.project=function(e){return this.transform.locationPoint(t.LngLat.convert(e))},r.prototype.unproject=function(e){return this.transform.pointLocation(t.Point.convert(e))},r.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},r.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},r.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},r.prototype._createDelegatedListener=function(t,e,i){var n,r=this;if("mouseenter"===t||"mouseover"===t){var a=!1;return{layer:e,listener:i,delegates:{mousemove:function(n){var o=r.getLayer(e)?r.queryRenderedFeatures(n.point,{layers:[e]}):[];o.length?a||(a=!0,i.call(r,new Dn(t,r,n.originalEvent,{features:o}))):a=!1},mouseout:function(){a=!1}}}}if("mouseleave"===t||"mouseout"===t){var o=!1;return{layer:e,listener:i,delegates:{mousemove:function(n){(r.getLayer(e)?r.queryRenderedFeatures(n.point,{layers:[e]}):[]).length?o=!0:o&&(o=!1,i.call(r,new Dn(t,r,n.originalEvent)))},mouseout:function(e){o&&(o=!1,i.call(r,new Dn(t,r,e.originalEvent)))}}}}return{layer:e,listener:i,delegates:(n={},n[t]=function(t){var n=r.getLayer(e)?r.queryRenderedFeatures(t.point,{layers:[e]}):[];n.length&&(t.features=n,i.call(r,t),delete t.features)},n)}},r.prototype.on=function(t,e,i){if(void 0===i)return n.prototype.on.call(this,t,e);var r=this._createDelegatedListener(t,e,i);for(var a in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(r),r.delegates)this.on(a,r.delegates[a]);return this},r.prototype.once=function(t,e,i){if(void 0===i)return n.prototype.once.call(this,t,e);var r=this._createDelegatedListener(t,e,i);for(var a in r.delegates)this.once(a,r.delegates[a]);return this},r.prototype.off=function(t,e,i){var r=this;return void 0===i?n.prototype.off.call(this,t,e):(this._delegatedListeners&&this._delegatedListeners[t]&&function(n){for(var a=n[t],o=0;o<a.length;o++){var s=a[o];if(s.layer===e&&s.listener===i){for(var l in s.delegates)r.off(l,s.delegates[l]);return a.splice(o,1),r}}}(this._delegatedListeners),this)},r.prototype.queryRenderedFeatures=function(e,i){if(!this.style)return[];var n;if(void 0!==i||void 0===e||e instanceof t.Point||Array.isArray(e)||(i=e,e=void 0),i=i||{},(e=e||[[0,0],[this.transform.width,this.transform.height]])instanceof t.Point||"number"==typeof e[0])n=[t.Point.convert(e)];else{var r=t.Point.convert(e[0]),a=t.Point.convert(e[1]);n=[r,new t.Point(a.x,r.y),a,new t.Point(r.x,a.y),r]}return this.style.queryRenderedFeatures(n,i,this.transform)},r.prototype.querySourceFeatures=function(t,e){return this.style.querySourceFeatures(t,e)},r.prototype.setStyle=function(e,i){return!1!==(i=t.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&e?(this._diffStyle(e,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._updateStyle(e,i))},r.prototype._getUIString=function(t){var e=this._locale[t];if(null==e)throw new Error("Missing UI string '"+t+"'");return e},r.prototype._updateStyle=function(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove()),t?(this.style=new je(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t),this):(delete this.style,this)},r.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new je(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},r.prototype._diffStyle=function(e,i){var n=this;if("string"==typeof e){var r=this._requestManager.normalizeStyleURL(e),a=this._requestManager.transformRequest(r,t.ResourceType.Style);t.getJSON(a,(function(e,r){e?n.fire(new t.ErrorEvent(e)):r&&n._updateDiff(r,i)}))}else"object"==typeof e&&this._updateDiff(e,i)},r.prototype._updateDiff=function(e,i){try{this.style.setState(e)&&this._update(!0)}catch(n){t.warnOnce("Unable to perform style diff: "+(n.message||n.error||n)+".  Rebuilding the style from scratch."),this._updateStyle(e,i)}},r.prototype.getStyle=function(){if(this.style)return this.style.serialize()},r.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():t.warnOnce("There is no style added to the map.")},r.prototype.addSource=function(t,e){return this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)},r.prototype.isSourceLoaded=function(e){var i=this.style&&this.style.sourceCaches[e];if(void 0!==i)return i.loaded();this.fire(new t.ErrorEvent(new Error("There is no source with ID '"+e+"'")))},r.prototype.areTilesLoaded=function(){var t=this.style&&this.style.sourceCaches;for(var e in t){var i=t[e]._tiles;for(var n in i){var r=i[n];if("loaded"!==r.state&&"errored"!==r.state)return!1}}return!0},r.prototype.addSourceType=function(t,e,i){return this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,i)},r.prototype.removeSource=function(t){return this.style.removeSource(t),this._update(!0)},r.prototype.getSource=function(t){return this.style.getSource(t)},r.prototype.addImage=function(e,i,n){void 0===n&&(n={});var r=n.pixelRatio;void 0===r&&(r=1);var a=n.sdf;void 0===a&&(a=!1);var o=n.stretchX,s=n.stretchY,l=n.content;if(this._lazyInitEmptyStyle(),i instanceof Sr||Tr&&i instanceof Tr){var c=t.browser.getImageData(i);this.style.addImage(e,{data:new t.RGBAImage({width:c.width,height:c.height},c.data),pixelRatio:r,stretchX:o,stretchY:s,content:l,sdf:a,version:0})}else{if(void 0===i.width||void 0===i.height)return this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var u=i;this.style.addImage(e,{data:new t.RGBAImage({width:i.width,height:i.height},new Uint8Array(i.data)),pixelRatio:r,stretchX:o,stretchY:s,content:l,sdf:a,version:0,userImage:u}),u.onAdd&&u.onAdd(this,e)}},r.prototype.updateImage=function(e,i){var n=this.style.getImage(e);if(!n)return this.fire(new t.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var r=i instanceof Sr||Tr&&i instanceof Tr?t.browser.getImageData(i):i,a=r.width,o=r.height,s=r.data;return void 0===a||void 0===o?this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):a!==n.data.width||o!==n.data.height?this.fire(new t.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(n.data.replace(s,!(i instanceof Sr||Tr&&i instanceof Tr)),void this.style.updateImage(e,n))},r.prototype.hasImage=function(e){return e?!!this.style.getImage(e):(this.fire(new t.ErrorEvent(new Error("Missing required image id"))),!1)},r.prototype.removeImage=function(t){this.style.removeImage(t)},r.prototype.loadImage=function(e,i){t.getImage(this._requestManager.transformRequest(e,t.ResourceType.Image),i)},r.prototype.listImages=function(){return this.style.listImages()},r.prototype.addLayer=function(t,e){return this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)},r.prototype.moveLayer=function(t,e){return this.style.moveLayer(t,e),this._update(!0)},r.prototype.removeLayer=function(t){return this.style.removeLayer(t),this._update(!0)},r.prototype.getLayer=function(t){return this.style.getLayer(t)},r.prototype.setLayerZoomRange=function(t,e,i){return this.style.setLayerZoomRange(t,e,i),this._update(!0)},r.prototype.setFilter=function(t,e,i){return void 0===i&&(i={}),this.style.setFilter(t,e,i),this._update(!0)},r.prototype.getFilter=function(t){return this.style.getFilter(t)},r.prototype.setPaintProperty=function(t,e,i,n){return void 0===n&&(n={}),this.style.setPaintProperty(t,e,i,n),this._update(!0)},r.prototype.getPaintProperty=function(t,e){return this.style.getPaintProperty(t,e)},r.prototype.setLayoutProperty=function(t,e,i,n){return void 0===n&&(n={}),this.style.setLayoutProperty(t,e,i,n),this._update(!0)},r.prototype.getLayoutProperty=function(t,e){return this.style.getLayoutProperty(t,e)},r.prototype.setLight=function(t,e){return void 0===e&&(e={}),this._lazyInitEmptyStyle(),this.style.setLight(t,e),this._update(!0)},r.prototype.getLight=function(){return this.style.getLight()},r.prototype.setFeatureState=function(t,e){return this.style.setFeatureState(t,e),this._update()},r.prototype.removeFeatureState=function(t,e){return this.style.removeFeatureState(t,e),this._update()},r.prototype.getFeatureState=function(t){return this.style.getFeatureState(t)},r.prototype.getContainer=function(){return this._container},r.prototype.getCanvasContainer=function(){return this._canvasContainer},r.prototype.getCanvas=function(){return this._canvas},r.prototype._containerDimensions=function(){var t=0,e=0;return this._container&&(t=this._container.clientWidth||400,e=this._container.clientHeight||300),[t,e]},r.prototype._detectMissingCSS=function(){"rgb(250, 128, 114)"!==t.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&t.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},r.prototype._setupContainer=function(){var t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=i.create("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();var e=this._canvasContainer=i.create("div","mapboxgl-canvas-container",t);this._interactive&&e.classList.add("mapboxgl-interactive"),this._canvas=i.create("canvas","mapboxgl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var n=this._containerDimensions();this._resizeCanvas(n[0],n[1]);var r=this._controlContainer=i.create("div","mapboxgl-control-container",t),a=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((function(t){a[t]=i.create("div","mapboxgl-ctrl-"+t,r)})),this._container.addEventListener("scroll",this._onMapScroll,!1)},r.prototype._resizeCanvas=function(e,i){var n=t.browser.devicePixelRatio||1;this._canvas.width=n*e,this._canvas.height=n*i,this._canvas.style.width=e+"px",this._canvas.style.height=i+"px"},r.prototype._setupPainter=function(){var i=t.extend({},e.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl",i)||this._canvas.getContext("experimental-webgl",i);n?(this.painter=new vn(n,this.transform),t.webpSupported.testSupport(n)):this.fire(new t.ErrorEvent(new Error("Failed to initialize WebGL")))},r.prototype._contextLost=function(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.Event("webglcontextlost",{originalEvent:e}))},r.prototype._contextRestored=function(e){this._setupPainter(),this.resize(),this._update(),this.fire(new t.Event("webglcontextrestored",{originalEvent:e}))},r.prototype._onMapScroll=function(t){if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},r.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},r.prototype._update=function(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this},r.prototype._requestRenderFrame=function(t){return this._update(),this._renderTaskQueue.add(t)},r.prototype._cancelRenderFrame=function(t){this._renderTaskQueue.remove(t)},r.prototype._render=function(e){var i,n=this,r=0,a=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(i=a.createQueryEXT(),a.beginQueryEXT(a.TIME_ELAPSED_EXT,i),r=t.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(e),!this._removed){var o=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var s=this.transform.zoom,l=t.browser.now();this.style.zoomHistory.update(s,l);var c=new t.EvaluationParameters(s,{now:l,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),u=c.crossFadingFactor();1===u&&u===this._crossFadingFactor||(o=!0,this._crossFadingFactor=u),this.style.update(c)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new t.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new t.Event("load"))),this.style&&(this.style.hasTransitions()||o)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var h=t.browser.now()-r;a.endQueryEXT(a.TIME_ELAPSED_EXT,i),setTimeout((function(){var e=a.getQueryObjectEXT(i,a.QUERY_RESULT_EXT)/1e6;a.deleteQueryEXT(i),n.fire(new t.Event("gpu-timing-frame",{cpuTime:h,gpuTime:e}))}),50)}if(this.listens("gpu-timing-layer")){var p=this.painter.collectGpuTimers();setTimeout((function(){var e=n.painter.queryGpuTimers(p);n.fire(new t.Event("gpu-timing-layer",{layerTimes:e}))}),50)}var d=this._sourcesDirty||this._styleDirty||this._placementDirty;return d||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new t.Event("idle")),!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0),this}},r.prototype.remove=function(){this._hash&&this._hash.remove();for(var e=0,i=this._controls;e<i.length;e+=1)i[e].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==t.window&&(t.window.removeEventListener("resize",this._onWindowResize,!1),t.window.removeEventListener("orientationchange",this._onWindowResize,!1),t.window.removeEventListener("online",this._onWindowOnline,!1));var n=this.painter.context.gl.getExtension("WEBGL_lose_context");n&&n.loseContext(),Ir(this._canvasContainer),Ir(this._controlContainer),Ir(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new t.Event("remove"))},r.prototype.triggerRepaint=function(){var e=this;this.style&&!this._frame&&(this._frame=t.browser.frame((function(t){e._frame=null,e._render(t)})))},r.prototype._onWindowOnline=function(){this._update()},r.prototype._onWindowResize=function(t){this._trackResize&&this.resize({originalEvent:t})._update()},a.showTileBoundaries.get=function(){return!!this._showTileBoundaries},a.showTileBoundaries.set=function(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())},a.showPadding.get=function(){return!!this._showPadding},a.showPadding.set=function(t){this._showPadding!==t&&(this._showPadding=t,this._update())},a.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},a.showCollisionBoxes.set=function(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())},a.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},a.showOverdrawInspector.set=function(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())},a.repaint.get=function(){return!!this._repaint},a.repaint.set=function(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())},a.vertices.get=function(){return!!this._vertices},a.vertices.set=function(t){this._vertices=t,this._update()},r.prototype._setCacheLimits=function(e,i){t.setCacheLimits(e,i)},a.version.get=function(){return t.version},Object.defineProperties(r.prototype,a),r}(yr);function Ir(t){t.parentNode&&t.parentNode.removeChild(t)}var Ar={showCompass:!0,showZoom:!0,visualizePitch:!1},kr=function(e){var n=this;this.options=t.extend({},Ar,e),this._container=i.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(function(t){return t.preventDefault()})),this.options.showZoom&&(t.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(function(t){return n._map.zoomIn({},{originalEvent:t})})),i.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(function(t){return n._map.zoomOut({},{originalEvent:t})})),i.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(t.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(function(t){n.options.visualizePitch?n._map.resetNorthPitch({},{originalEvent:t}):n._map.resetNorth({},{originalEvent:t})})),this._compassIcon=i.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};kr.prototype._updateZoomButtons=function(){var t=this._map.getZoom(),e=t===this._map.getMaxZoom(),i=t===this._map.getMinZoom();this._zoomInButton.disabled=e,this._zoomOutButton.disabled=i,this._zoomInButton.setAttribute("aria-disabled",e.toString()),this._zoomOutButton.setAttribute("aria-disabled",i.toString())},kr.prototype._rotateCompassArrow=function(){var t=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=t},kr.prototype.onAdd=function(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Rr(this._map,this._compass,this.options.visualizePitch)),this._container},kr.prototype.onRemove=function(){i.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},kr.prototype._createButton=function(t,e){var n=i.create("button",t,this._container);return n.type="button",n.addEventListener("click",e),n},kr.prototype._setButtonTitle=function(t,e){var i=this._map._getUIString("NavigationControl."+e);t.title=i,t.setAttribute("aria-label",i)};var Rr=function(e,n,r){void 0===r&&(r=!1),this._clickTolerance=10,this.element=n,this.mouseRotate=new Wn({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,r&&(this.mousePitch=new Zn({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),t.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),i.addEventListener(n,"mousedown",this.mousedown),i.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),i.addEventListener(n,"touchmove",this.touchmove),i.addEventListener(n,"touchend",this.touchend),i.addEventListener(n,"touchcancel",this.reset)};function zr(e,i,n){if(e=new t.LngLat(e.lng,e.lat),i){var r=new t.LngLat(e.lng-360,e.lat),a=new t.LngLat(e.lng+360,e.lat),o=n.locationPoint(e).distSqr(i);n.locationPoint(r).distSqr(i)<o?e=r:n.locationPoint(a).distSqr(i)<o&&(e=a)}for(;Math.abs(e.lng-n.center.lng)>180;){var s=n.locationPoint(e);if(s.x>=0&&s.y>=0&&s.x<=n.width&&s.y<=n.height)break;e.lng>n.center.lng?e.lng-=360:e.lng+=360}return e}Rr.prototype.down=function(t,e){this.mouseRotate.mousedown(t,e),this.mousePitch&&this.mousePitch.mousedown(t,e),i.disableDrag()},Rr.prototype.move=function(t,e){var i=this.map,n=this.mouseRotate.mousemoveWindow(t,e);if(n&&n.bearingDelta&&i.setBearing(i.getBearing()+n.bearingDelta),this.mousePitch){var r=this.mousePitch.mousemoveWindow(t,e);r&&r.pitchDelta&&i.setPitch(i.getPitch()+r.pitchDelta)}},Rr.prototype.off=function(){var t=this.element;i.removeEventListener(t,"mousedown",this.mousedown),i.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),i.removeEventListener(t,"touchmove",this.touchmove),i.removeEventListener(t,"touchend",this.touchend),i.removeEventListener(t,"touchcancel",this.reset),this.offTemp()},Rr.prototype.offTemp=function(){i.enableDrag(),i.removeEventListener(t.window,"mousemove",this.mousemove),i.removeEventListener(t.window,"mouseup",this.mouseup)},Rr.prototype.mousedown=function(e){this.down(t.extend({},e,{ctrlKey:!0,preventDefault:function(){return e.preventDefault()}}),i.mousePos(this.element,e)),i.addEventListener(t.window,"mousemove",this.mousemove),i.addEventListener(t.window,"mouseup",this.mouseup)},Rr.prototype.mousemove=function(t){this.move(t,i.mousePos(this.element,t))},Rr.prototype.mouseup=function(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()},Rr.prototype.touchstart=function(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=i.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return t.preventDefault()}},this._startPos))},Rr.prototype.touchmove=function(t){1!==t.targetTouches.length?this.reset():(this._lastPos=i.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:function(){return t.preventDefault()}},this._lastPos))},Rr.prototype.touchend=function(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Rr.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Pr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Dr(t,e,i){var n=t.classList;for(var r in Pr)n.remove("mapboxgl-"+i+"-anchor-"+r);n.add("mapboxgl-"+i+"-anchor-"+e)}var Lr,Br=function(e){function n(n,r){if(e.call(this),(n instanceof t.window.HTMLElement||r)&&(n=t.extend({element:n},r)),t.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&"auto"!==n.pitchAlignment?n.pitchAlignment:this._rotationAlignment,n&&n.element)this._element=n.element,this._offset=t.Point.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=i.create("div"),this._element.setAttribute("aria-label","Map marker");var a=i.createNS("http://www.w3.org/2000/svg","svg");a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height","41px"),a.setAttributeNS(null,"width","27px"),a.setAttributeNS(null,"viewBox","0 0 27 41");var o=i.createNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"stroke","none"),o.setAttributeNS(null,"stroke-width","1"),o.setAttributeNS(null,"fill","none"),o.setAttributeNS(null,"fill-rule","evenodd");var s=i.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"fill-rule","nonzero");var l=i.createNS("http://www.w3.org/2000/svg","g");l.setAttributeNS(null,"transform","translate(3.0, 29.0)"),l.setAttributeNS(null,"fill","#000000");for(var c=0,u=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];c<u.length;c+=1){var h=u[c],p=i.createNS("http://www.w3.org/2000/svg","ellipse");p.setAttributeNS(null,"opacity","0.04"),p.setAttributeNS(null,"cx","10.5"),p.setAttributeNS(null,"cy","5.80029008"),p.setAttributeNS(null,"rx",h.rx),p.setAttributeNS(null,"ry",h.ry),l.appendChild(p)}var d=i.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"fill",this._color);var f=i.createNS("http://www.w3.org/2000/svg","path");f.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),d.appendChild(f);var m=i.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"opacity","0.25"),m.setAttributeNS(null,"fill","#000000");var g=i.createNS("http://www.w3.org/2000/svg","path");g.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),m.appendChild(g);var _=i.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"transform","translate(6.0, 7.0)"),_.setAttributeNS(null,"fill","#FFFFFF");var y=i.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"transform","translate(8.0, 8.0)");var v=i.createNS("http://www.w3.org/2000/svg","circle");v.setAttributeNS(null,"fill","#000000"),v.setAttributeNS(null,"opacity","0.25"),v.setAttributeNS(null,"cx","5.5"),v.setAttributeNS(null,"cy","5.5"),v.setAttributeNS(null,"r","5.4999962");var x=i.createNS("http://www.w3.org/2000/svg","circle");x.setAttributeNS(null,"fill","#FFFFFF"),x.setAttributeNS(null,"cx","5.5"),x.setAttributeNS(null,"cy","5.5"),x.setAttributeNS(null,"r","5.4999962"),y.appendChild(v),y.appendChild(x),s.appendChild(l),s.appendChild(d),s.appendChild(m),s.appendChild(_),s.appendChild(y),a.appendChild(s),a.setAttributeNS(null,"height",41*this._scale+"px"),a.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(a),this._offset=t.Point.convert(n&&n.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(function(t){t.preventDefault()})),this._element.addEventListener("mousedown",(function(t){t.preventDefault()})),Dr(this._element,this._anchor,"marker"),this._popup=null}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.addTo=function(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},n.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),i.remove(this._element),this._popup&&this._popup.remove(),this},n.prototype.getLngLat=function(){return this._lngLat},n.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},n.prototype.getElement=function(){return this._element},n.prototype.setPopup=function(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){var e=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[e,-1*(24.6+e)],"bottom-right":[-e,-1*(24.6+e)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},n.prototype._onKeyPress=function(t){var e=t.code,i=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==i&&13!==i||this.togglePopup()},n.prototype._onMapClick=function(t){var e=t.originalEvent.target,i=this._element;this._popup&&(e===i||i.contains(e))&&this.togglePopup()},n.prototype.getPopup=function(){return this._popup},n.prototype.togglePopup=function(){var t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this},n.prototype._update=function(t){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=zr(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var e="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?e="rotateZ("+this._rotation+"deg)":"map"===this._rotationAlignment&&(e="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var n="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?n="rotateX(0deg)":"map"===this._pitchAlignment&&(n="rotateX("+this._map.getPitch()+"deg)"),t&&"moveend"!==t.type||(this._pos=this._pos.round()),i.setTransform(this._element,Pr[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+n+" "+e)}},n.prototype.getOffset=function(){return this._offset},n.prototype.setOffset=function(e){return this._offset=t.Point.convert(e),this._update(),this},n.prototype._onMove=function(e){if(!this._isDragging){var i=this._clickTolerance||this._map._clickTolerance;this._isDragging=e.point.dist(this._pointerdownPos)>=i}this._isDragging&&(this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.Event("dragstart"))),this.fire(new t.Event("drag")))},n.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new t.Event("dragend")),this._state="inactive"},n.prototype._addDragHandler=function(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},n.prototype.setDraggable=function(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},n.prototype.isDraggable=function(){return this._draggable},n.prototype.setRotation=function(t){return this._rotation=t||0,this._update(),this},n.prototype.getRotation=function(){return this._rotation},n.prototype.setRotationAlignment=function(t){return this._rotationAlignment=t||"auto",this._update(),this},n.prototype.getRotationAlignment=function(){return this._rotationAlignment},n.prototype.setPitchAlignment=function(t){return this._pitchAlignment=t&&"auto"!==t?t:this._rotationAlignment,this._update(),this},n.prototype.getPitchAlignment=function(){return this._pitchAlignment},n}(t.Evented),Or={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Fr=0,Nr=!1,Ur=function(e){function n(i){e.call(this),this.options=t.extend({},Or,i),t.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.onAdd=function(e){var n;return this._map=e,this._container=i.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),n=this._setupUI,void 0!==Lr?n(Lr):void 0!==t.window.navigator.permissions?t.window.navigator.permissions.query({name:"geolocation"}).then((function(t){n(Lr="denied"!==t.state)})):n(Lr=!!t.window.navigator.geolocation),this._container},n.prototype.onRemove=function(){void 0!==this._geolocationWatchID&&(t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),i.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Fr=0,Nr=!1},n.prototype._isOutOfMapMaxBounds=function(t){var e=this._map.getMaxBounds(),i=t.coords;return e&&(i.longitude<e.getWest()||i.longitude>e.getEast()||i.latitude<e.getSouth()||i.latitude>e.getNorth())},n.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},n.prototype._onSuccess=function(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new t.Event("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("geolocate",e)),this._finish()}},n.prototype._updateCamera=function(e){var i=new t.LngLat(e.coords.longitude,e.coords.latitude),n=e.coords.accuracy,r=this._map.getBearing(),a=t.extend({bearing:r},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(n),a,{geolocateSource:!0})},n.prototype._updateMarker=function(e){if(e){var i=new t.LngLat(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},n.prototype._updateCircleRadius=function(){var t=this._map._container.clientHeight/2,e=this._map.unproject([0,t]),i=this._map.unproject([1,t]),n=e.distanceTo(i),r=Math.ceil(2*this._accuracy/n);this._circleElement.style.width=r+"px",this._circleElement.style.height=r+"px"},n.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},n.prototype._onError=function(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&Nr)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("error",e)),this._finish()}},n.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},n.prototype._setupUI=function(e){var n=this;if(this._container.addEventListener("contextmenu",(function(t){return t.preventDefault()})),this._geolocateButton=i.create("button","mapboxgl-ctrl-geolocate",this._container),i.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===e){t.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{var a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=i.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Br(this._dotElement),this._circleElement=i.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Br({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(function(e){e.geolocateSource||"ACTIVE_LOCK"!==n._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(n._watchState="BACKGROUND",n._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),n._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),n.fire(new t.Event("trackuserlocationend")))}))},n.prototype.trigger=function(){if(!this._setup)return t.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Fr--,Nr=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){var e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Fr>1?(e={maximumAge:6e5,timeout:0},Nr=!0):(e=this.options.positionOptions,Nr=!1),this._geolocationWatchID=t.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,e)}}else t.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},n.prototype._clearWatch=function(){t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},n}(t.Evented),$r={maxWidth:100,unit:"metric"},Vr=function(e){this.options=t.extend({},$r,e),t.bindAll(["_onMove","setUnit"],this)};function jr(t,e,i){var n=i&&i.maxWidth||100,r=t._container.clientHeight/2,a=t.unproject([0,r]),o=t.unproject([n,r]),s=a.distanceTo(o);if(i&&"imperial"===i.unit){var l=3.2808*s;l>5280?qr(e,n,l/5280,t._getUIString("ScaleControl.Miles")):qr(e,n,l,t._getUIString("ScaleControl.Feet"))}else i&&"nautical"===i.unit?qr(e,n,s/1852,t._getUIString("ScaleControl.NauticalMiles")):s>=1e3?qr(e,n,s/1e3,t._getUIString("ScaleControl.Kilometers")):qr(e,n,s,t._getUIString("ScaleControl.Meters"))}function qr(t,e,i,n){var r,a,o,s=(r=i,(a=Math.pow(10,(""+Math.floor(r)).length-1))*(o=(o=r/a)>=10?10:o>=5?5:o>=3?3:o>=2?2:o>=1?1:function(t){var e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(o)));t.style.width=e*(s/i)+"px",t.innerHTML=s+"&nbsp;"+n}Vr.prototype.getDefaultPosition=function(){return"bottom-left"},Vr.prototype._onMove=function(){jr(this._map,this._container,this.options)},Vr.prototype.onAdd=function(t){return this._map=t,this._container=i.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Vr.prototype.onRemove=function(){i.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Vr.prototype.setUnit=function(t){this.options.unit=t,jr(this._map,this._container,this.options)};var Gr=function(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof t.window.HTMLElement?this._container=e.container:t.warnOnce("Full screen control 'container' must be a DOM element.")),t.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in t.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in t.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in t.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in t.window.document&&(this._fullscreenchange="MSFullscreenChange")};Gr.prototype.onAdd=function(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=i.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Gr.prototype.onRemove=function(){i.remove(this._controlContainer),this._map=null,t.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Gr.prototype._checkFullscreenSupport=function(){return!!(t.window.document.fullscreenEnabled||t.window.document.mozFullScreenEnabled||t.window.document.msFullscreenEnabled||t.window.document.webkitFullscreenEnabled)},Gr.prototype._setupUI=function(){var e=this._fullscreenButton=i.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);i.create("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden",!0),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),t.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Gr.prototype._updateTitle=function(){var t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.title=t},Gr.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Gr.prototype._isFullscreen=function(){return this._fullscreen},Gr.prototype._changeIcon=function(){(t.window.document.fullscreenElement||t.window.document.mozFullScreenElement||t.window.document.webkitFullscreenElement||t.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Gr.prototype._onClickFullscreen=function(){this._isFullscreen()?t.window.document.exitFullscreen?t.window.document.exitFullscreen():t.window.document.mozCancelFullScreen?t.window.document.mozCancelFullScreen():t.window.document.msExitFullscreen?t.window.document.msExitFullscreen():t.window.document.webkitCancelFullScreen&&t.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Hr={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Wr=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Zr=function(e){function n(i){e.call(this),this.options=t.extend(Object.create(Hr),i),t.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.addTo=function(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new t.Event("open")),this},n.prototype.isOpen=function(){return!!this._map},n.prototype.remove=function(){return this._content&&i.remove(this._content),this._container&&(i.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new t.Event("close")),this},n.prototype.getLngLat=function(){return this._lngLat},n.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},n.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},n.prototype.getElement=function(){return this._container},n.prototype.setText=function(e){return this.setDOMContent(t.window.document.createTextNode(e))},n.prototype.setHTML=function(e){var i,n=t.window.document.createDocumentFragment(),r=t.window.document.createElement("body");for(r.innerHTML=e;i=r.firstChild;)n.appendChild(i);return this.setDOMContent(n)},n.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},n.prototype.setMaxWidth=function(t){return this.options.maxWidth=t,this._update(),this},n.prototype.setDOMContent=function(t){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=i.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(t),this._createCloseButton(),this._update(),this._focusFirstElement(),this},n.prototype.addClassName=function(t){this._container&&this._container.classList.add(t)},n.prototype.removeClassName=function(t){this._container&&this._container.classList.remove(t)},n.prototype.setOffset=function(t){return this.options.offset=t,this._update(),this},n.prototype.toggleClassName=function(t){if(this._container)return this._container.classList.toggle(t)},n.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=i.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},n.prototype._onMouseUp=function(t){this._update(t.point)},n.prototype._onMouseMove=function(t){this._update(t.point)},n.prototype._onDrag=function(t){this._update(t.point)},n.prototype._update=function(e){var n=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=i.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=i.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach((function(t){return n._container.classList.add(t)})),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=zr(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||e)){var r=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat),a=this.options.anchor,o=function e(i){if(i){if("number"==typeof i){var n=Math.round(Math.sqrt(.5*Math.pow(i,2)));return{center:new t.Point(0,0),top:new t.Point(0,i),"top-left":new t.Point(n,n),"top-right":new t.Point(-n,n),bottom:new t.Point(0,-i),"bottom-left":new t.Point(n,-n),"bottom-right":new t.Point(-n,-n),left:new t.Point(i,0),right:new t.Point(-i,0)}}if(i instanceof t.Point||Array.isArray(i)){var r=t.Point.convert(i);return{center:r,top:r,"top-left":r,"top-right":r,bottom:r,"bottom-left":r,"bottom-right":r,left:r,right:r}}return{center:t.Point.convert(i.center||[0,0]),top:t.Point.convert(i.top||[0,0]),"top-left":t.Point.convert(i["top-left"]||[0,0]),"top-right":t.Point.convert(i["top-right"]||[0,0]),bottom:t.Point.convert(i.bottom||[0,0]),"bottom-left":t.Point.convert(i["bottom-left"]||[0,0]),"bottom-right":t.Point.convert(i["bottom-right"]||[0,0]),left:t.Point.convert(i.left||[0,0]),right:t.Point.convert(i.right||[0,0])}}return e(new t.Point(0,0))}(this.options.offset);if(!a){var s,l=this._container.offsetWidth,c=this._container.offsetHeight;s=r.y+o.bottom.y<c?["top"]:r.y>this._map.transform.height-c?["bottom"]:[],r.x<l/2?s.push("left"):r.x>this._map.transform.width-l/2&&s.push("right"),a=0===s.length?"bottom":s.join("-")}var u=r.add(o[a]).round();i.setTransform(this._container,Pr[a]+" translate("+u.x+"px,"+u.y+"px)"),Dr(this._container,a,"popup")}},n.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var t=this._container.querySelector(Wr);t&&t.focus()}},n.prototype._onClose=function(){this.remove()},n}(t.Evented),Yr={version:t.version,supported:e,setRTLTextPlugin:t.setRTLTextPlugin,getRTLTextPluginStatus:t.getRTLTextPluginStatus,Map:Cr,NavigationControl:kr,GeolocateControl:Ur,AttributionControl:vr,ScaleControl:Vr,FullscreenControl:Gr,Popup:Zr,Marker:Br,Style:je,LngLat:t.LngLat,LngLatBounds:t.LngLatBounds,Point:t.Point,MercatorCoordinate:t.MercatorCoordinate,Evented:t.Evented,config:t.config,prewarm:function(){Ft().acquire(Dt)},clearPrewarmedResources:function(){var t=Bt;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(Dt),Bt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return t.config.ACCESS_TOKEN},set accessToken(e){t.config.ACCESS_TOKEN=e},get baseApiUrl(){return t.config.API_URL},set baseApiUrl(e){t.config.API_URL=e},get workerCount(){return Lt.workerCount},set workerCount(t){Lt.workerCount=t},get maxParallelImageRequests(){return t.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){t.config.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage:function(e){t.clearTileCache(e)},workerUrl:""};return Yr})),i}()}},function(t){var e;e=302,t(t.s=e)}]);
//# sourceMappingURL=main.js.map